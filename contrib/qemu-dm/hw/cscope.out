cscope 15 $HOME/devel/xen-3.2.1/tools/ioemu/hw               0002110203
	@acpi.c

19 
	~"vl.h
"

24 
	#PM_FREQ
 3579545

	)

26 
	#ACPI_DBG_IO_ADDR
 0xb044

	)

27 
	#SMB_IO_BASE
 0xb100

	)

29 
	sPIIX4PMSèã
 {

30 
PCIDevi˚
 
	mdev
;

31 
uöt16_t
 
	mpm°s
;

32 
uöt16_t
 
	mpmí
;

33 
uöt16_t
 
	mpm˙ål
;

34 
uöt8_t
 
	m≠mc
;

35 
uöt8_t
 
	m≠ms
;

36 
QEMUTimî
 *
	mtmr_timî
;

37 
öt64_t
 
	mtmr_ovîÊow_time
;

38 
SMBusDevi˚
 *
	msmb_dev
[128];

39 
uöt8_t
 
	msmb_°©
;

40 
uöt8_t
 
	msmb_˘l
;

41 
uöt8_t
 
	msmb_cmd
;

42 
uöt8_t
 
	msmb_addr
;

43 
uöt8_t
 
	msmb_d©a0
;

44 
uöt8_t
 
	msmb_d©a1
;

45 
uöt8_t
 
	msmb_d©a
[32];

46 
uöt8_t
 
	msmb_ödex
;

47 } 
	tPIIX4PMSèã
;

49 
	#RTC_EN
 (1 << 10)

	)

50 
	#PWRBTN_EN
 (1 << 8)

	)

51 
	#GBL_EN
 (1 << 5)

	)

52 
	#TMROF_EN
 (1 << 0)

	)

54 
	#SCI_EN
 (1 << 0)

	)

56 
	#SUS_EN
 (1 << 13)

	)

58 
	#SMBHSTSTS
 0x00

	)

59 
	#SMBHSTCNT
 0x02

	)

60 
	#SMBHSTCMD
 0x03

	)

61 
	#SMBHSTADD
 0x04

	)

62 
	#SMBHSTDAT0
 0x05

	)

63 
	#SMBHSTDAT1
 0x06

	)

64 
	#SMBBLKDAT
 0x07

	)

67 
PIIX4PMSèã
 *
	gpiix4_pm_°©e
;

69 
uöt32_t
 
	$gë_pmtmr
(
PIIX4PMSèã
 *
s
)

71 
uöt32_t
 
d
;

72 
d
 = 
	`muldiv64
(
	`qemu_gë_˛ock
(
vm_˛ock
), 
PM_FREQ
, 
ticks_≥r_£c
);

73  
d
 & 0xffffff;

74 
	}
}

76 
	$gë_pm°s
(
PIIX4PMSèã
 *
s
)

78 
öt64_t
 
d
;

79 
pm°s
;

80 
pm°s
 = 
s
->pmsts;

81 
d
 = 
	`muldiv64
(
	`qemu_gë_˛ock
(
vm_˛ock
), 
PM_FREQ
, 
ticks_≥r_£c
);

82 i‡(
d
 >
s
->
tmr_ovîÊow_time
)

83 
s
->
pm°s
 |
TMROF_EN
;

84  
pm°s
;

85 
	}
}

87 
	$pm_upd©e_sci
(
PIIX4PMSèã
 *
s
)

89 
sci_Àvñ
, 
pm°s
;

90 
öt64_t
 
expúe_time
;

92 
pm°s
 = 
	`gë_pm°s
(
s
);

93 
sci_Àvñ
 = (((
pm°s
 & 
s
->
pmí
) &

94 (
RTC_EN
 | 
PWRBTN_EN
 | 
GBL_EN
 | 
TMROF_EN
)) != 0);

95 
	`pci_£t_úq
(&
s
->
dev
, 0, 
sci_Àvñ
);

97 i‡((
s
->
pmí
 & 
TMROF_EN
Ë&& !(
pm°s
 & TMROF_EN)) {

98 
expúe_time
 = 
	`muldiv64
(
s
->
tmr_ovîÊow_time
, 
ticks_≥r_£c
, 
PM_FREQ
);

99 
	`qemu_mod_timî
(
s
->
tmr_timî
, 
expúe_time
);

101 
	`qemu_dñ_timî
(
s
->
tmr_timî
);

103 
	}
}

105 
	$pm_tmr_timî
(*
›aque
)

107 
PIIX4PMSèã
 *
s
 = 
›aque
;

108 
	`pm_upd©e_sci
(
s
);

109 
	}
}

111 
	$pm_i›‹t_wrôew
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

113 
PIIX4PMSèã
 *
s
 = 
›aque
;

114 
addr
 &= 0x3f;

115 
addr
) {

118 
öt64_t
 
d
;

119 
pm°s
;

120 
pm°s
 = 
	`gë_pm°s
(
s
);

121 i‡(
pm°s
 & 
vÆ
 & 
TMROF_EN
) {

123 
d
 = 
	`muldiv64
(
	`qemu_gë_˛ock
(
vm_˛ock
), 
PM_FREQ
, 
ticks_≥r_£c
);

124 
s
->
tmr_ovîÊow_time
 = (
d
 + 0x800000LL) & ~0x7fffffLL;

126 
s
->
pm°s
 &~
vÆ
;

127 
	`pm_upd©e_sci
(
s
);

131 
s
->
pmí
 = 
vÆ
;

132 
	`pm_upd©e_sci
(
s
);

136 
sus_typ
;

137 
s
->
pm˙ål
 = 
vÆ
 & ~(
SUS_EN
);

138 i‡(
vÆ
 & 
SUS_EN
) {

140 
sus_typ
 = (
vÆ
 >> 10) & 3;

141 
sus_typ
) {

143 
	`qemu_sy°em_shutdown_ªque°
();

154 #ifde‡
DEBUG


155 
	`¥ötf
("PM wrôewÖ‹t=0x%04x vÆ=0x%04x\n", 
addr
, 
vÆ
);

157 
	}
}

159 
uöt32_t
 
	$pm_i›‹t_ªadw
(*
›aque
, 
uöt32_t
 
addr
)

161 
PIIX4PMSèã
 *
s
 = 
›aque
;

162 
uöt32_t
 
vÆ
;

164 
addr
 &= 0x3f;

165 
addr
) {

167 
vÆ
 = 
	`gë_pm°s
(
s
);

170 
vÆ
 = 
s
->
pmí
;

173 
vÆ
 = 
s
->
pm˙ål
;

176 
vÆ
 = 0;

179 #ifde‡
DEBUG


180 
	`¥ötf
("PMÑódwÖ‹t=0x%04x vÆ=0x%04x\n", 
addr
, 
vÆ
);

182  
vÆ
;

183 
	}
}

185 
	$pm_i›‹t_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

188 
addr
 &= 0x3f;

189 #ifde‡
DEBUG


190 
	`¥ötf
("PM wrôñÖ‹t=0x%04x vÆ=0x%08x\n", 
addr
, 
vÆ
);

192 
	}
}

194 
uöt32_t
 
	$pm_i›‹t_ªadl
(*
›aque
, 
uöt32_t
 
addr
)

196 
PIIX4PMSèã
 *
s
 = 
›aque
;

197 
uöt32_t
 
vÆ
;

199 
addr
 &= 0x3f;

200 
addr
) {

202 
vÆ
 = 
	`gë_pmtmr
(
s
);

205 
vÆ
 = 0;

208 #ifde‡
DEBUG


209 
	`¥ötf
("PMÑód»p‹t=0x%04x vÆ=0x%08x\n", 
addr
, 
vÆ
);

211  
vÆ
;

212 
	}
}

214 
	$pm_smi_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

216 
PIIX4PMSèã
 *
s
 = 
›aque
;

217 
addr
 &= 1;

218 #ifde‡
DEBUG


219 
	`¥ötf
("pm_smi_wrôebáddr=0x%x vÆ=0x%02x\n", 
addr
, 
vÆ
);

221 i‡(
addr
 == 0) {

222 
s
->
≠mc
 = 
vÆ
;

223 i‡(
s
->
dev
.
c⁄fig
[0x5b] & (1 << 1)) {

224 
	`˝u_öãºu±
(
fú°_˝u
, 
CPU_INTERRUPT_SMI
);

227 
s
->
≠ms
 = 
vÆ
;

229 
	}
}

231 
uöt32_t
 
	$pm_smi_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

233 
PIIX4PMSèã
 *
s
 = 
›aque
;

234 
uöt32_t
 
vÆ
;

236 
addr
 &= 1;

237 i‡(
addr
 == 0) {

238 
vÆ
 = 
s
->
≠mc
;

240 
vÆ
 = 
s
->
≠ms
;

242 #ifde‡
DEBUG


243 
	`¥ötf
("pm_smi_ªadbáddr=0x%x vÆ=0x%02x\n", 
addr
, 
vÆ
);

245  
vÆ
;

246 
	}
}

248 
	$a˝i_dbg_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

250 #i‡
	`deföed
(
DEBUG
)

251 
	`¥ötf
("ACPI: DBG: 0x%08x\n", 
vÆ
);

253 
	}
}

255 
	$smb_å™ß˘i⁄
(
PIIX4PMSèã
 *
s
)

257 
uöt8_t
 
¥Ÿ
 = (
s
->
smb_˘l
 >> 2) & 0x07;

258 
uöt8_t
 
ªad
 = 
s
->
smb_addr
 & 0x01;

259 
uöt8_t
 
cmd
 = 
s
->
smb_cmd
;

260 
uöt8_t
 
addr
 = 
s
->
smb_addr
 >> 1;

261 
SMBusDevi˚
 *
dev
 = 
s
->
smb_dev
[
addr
];

263 #ifde‡
DEBUG


264 
	`¥ötf
("SMBu†å™†addr=0x%02xÖrŸ=0x%02x\n", 
addr
, 
¥Ÿ
);

266 i‡(!
dev
Ë
îr‹
;

268 
¥Ÿ
) {

270 i‡(!
dev
->
quick_cmd
Ë
îr‹
;

271 (*
dev
->
quick_cmd
)(dev, 
ªad
);

274 i‡(
ªad
) {

275 i‡(!
dev
->
ª˚ive_byã
Ë
îr‹
;

276 
s
->
smb_d©a0
 = (*
dev
->
ª˚ive_byã
)(dev);

279 i‡(!
dev
->
£nd_byã
Ë
îr‹
;

280 (*
dev
->
£nd_byã
)(dev, 
cmd
);

284 i‡(
ªad
) {

285 i‡(!
dev
->
ªad_byã
Ë
îr‹
;

286 
s
->
smb_d©a0
 = (*
dev
->
ªad_byã
)(dev, 
cmd
);

289 i‡(!
dev
->
wrôe_byã
Ë
îr‹
;

290 (*
dev
->
wrôe_byã
)(dev, 
cmd
, 
s
->
smb_d©a0
);

294 i‡(
ªad
) {

295 
uöt16_t
 
vÆ
;

296 i‡(!
dev
->
ªad_w‹d
Ë
îr‹
;

297 
vÆ
 = (*
dev
->
ªad_w‹d
)(dev, 
cmd
);

298 
s
->
smb_d©a0
 = 
vÆ
;

299 
s
->
smb_d©a1
 = 
vÆ
 >> 8;

302 i‡(!
dev
->
wrôe_w‹d
Ë
îr‹
;

303 (*
dev
->
wrôe_w‹d
)(dev, 
cmd
, (
s
->
smb_d©a1
 << 8Ë| s->
smb_d©a0
);

307 i‡(
ªad
) {

308 i‡(!
dev
->
ªad_block
Ë
îr‹
;

309 
s
->
smb_d©a0
 = (*
dev
->
ªad_block
)(dev, 
cmd
, s->
smb_d©a
);

312 i‡(!
dev
->
wrôe_block
Ë
îr‹
;

313 (*
dev
->
wrôe_block
)(dev, 
cmd
, 
s
->
smb_d©a0
, s->
smb_d©a
);

317 
îr‹
;

321 
îr‹
:

322 
s
->
smb_°©
 |= 0x04;

323 
	}
}

325 
	$smb_i›‹t_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

327 
PIIX4PMSèã
 *
s
 = 
›aque
;

328 
addr
 &= 0x3f;

329 #ifde‡
DEBUG


330 
	`¥ötf
("SMB wrôebÖ‹t=0x%04x vÆ=0x%02x\n", 
addr
, 
vÆ
);

332 
addr
) {

333 
SMBHSTSTS
:

334 
s
->
smb_°©
 = 0;

335 
s
->
smb_ödex
 = 0;

337 
SMBHSTCNT
:

338 
s
->
smb_˘l
 = 
vÆ
;

339 i‡(
vÆ
 & 0x40)

340 
	`smb_å™ß˘i⁄
(
s
);

342 
SMBHSTCMD
:

343 
s
->
smb_cmd
 = 
vÆ
;

345 
SMBHSTADD
:

346 
s
->
smb_addr
 = 
vÆ
;

348 
SMBHSTDAT0
:

349 
s
->
smb_d©a0
 = 
vÆ
;

351 
SMBHSTDAT1
:

352 
s
->
smb_d©a1
 = 
vÆ
;

354 
SMBBLKDAT
:

355 
s
->
smb_d©a
[s->
smb_ödex
++] = 
vÆ
;

356 i‡(
s
->
smb_ödex
 > 31)

357 
s
->
smb_ödex
 = 0;

362 
	}
}

364 
uöt32_t
 
	$smb_i›‹t_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

366 
PIIX4PMSèã
 *
s
 = 
›aque
;

367 
uöt32_t
 
vÆ
;

369 
addr
 &= 0x3f;

370 
addr
) {

371 
SMBHSTSTS
:

372 
vÆ
 = 
s
->
smb_°©
;

374 
SMBHSTCNT
:

375 
s
->
smb_ödex
 = 0;

376 
vÆ
 = 
s
->
smb_˘l
 & 0x1f;

378 
SMBHSTCMD
:

379 
vÆ
 = 
s
->
smb_cmd
;

381 
SMBHSTADD
:

382 
vÆ
 = 
s
->
smb_addr
;

384 
SMBHSTDAT0
:

385 
vÆ
 = 
s
->
smb_d©a0
;

387 
SMBHSTDAT1
:

388 
vÆ
 = 
s
->
smb_d©a1
;

390 
SMBBLKDAT
:

391 
vÆ
 = 
s
->
smb_d©a
[s->
smb_ödex
++];

392 i‡(
s
->
smb_ödex
 > 31)

393 
s
->
smb_ödex
 = 0;

396 
vÆ
 = 0;

399 #ifde‡
DEBUG


400 
	`¥ötf
("SMBÑódbÖ‹t=0x%04x vÆ=0x%02x\n", 
addr
, 
vÆ
);

402  
vÆ
;

403 
	}
}

405 
	$pm_io_•a˚_upd©e
(
PIIX4PMSèã
 *
s
)

407 
uöt32_t
 
pm_io_ba£
;

409 i‡(
s
->
dev
.
c⁄fig
[0x80] & 1) {

410 
pm_io_ba£
 = 
	`À32_to_˝u
(*(
uöt32_t
 *)(
s
->
dev
.
c⁄fig
 + 0x40));

411 
pm_io_ba£
 &= 0xfffe;

414 #i‡
	`deföed
(
DEBUG
)

415 
	`¥ötf
("PM: m≠pögÅÿ0x%x\n", 
pm_io_ba£
);

417 
	`ªgi°î_i›‹t_wrôe
(
pm_io_ba£
, 64, 2, 
pm_i›‹t_wrôew
, 
s
);

418 
	`ªgi°î_i›‹t_ªad
(
pm_io_ba£
, 64, 2, 
pm_i›‹t_ªadw
, 
s
);

419 
	`ªgi°î_i›‹t_wrôe
(
pm_io_ba£
, 64, 4, 
pm_i›‹t_wrôñ
, 
s
);

420 
	`ªgi°î_i›‹t_ªad
(
pm_io_ba£
, 64, 4, 
pm_i›‹t_ªadl
, 
s
);

422 
	}
}

424 
	$pm_wrôe_c⁄fig
(
PCIDevi˚
 *
d
,

425 
uöt32_t
 
addªss
, uöt32_à
vÆ
, 
Àn
)

427 
	`pci_deÁu…_wrôe_c⁄fig
(
d
, 
addªss
, 
vÆ
, 
Àn
);

428 i‡(
addªss
 == 0x80)

429 
	`pm_io_•a˚_upd©e
((
PIIX4PMSèã
 *)
d
);

430 
	}
}

432 
	$pm_ßve
(
QEMUFûe
* 
f
,*
›aque
)

434 
PIIX4PMSèã
 *
s
 = 
›aque
;

436 
	`pci_devi˚_ßve
(&
s
->
dev
, 
f
);

438 
	`qemu_put_be16s
(
f
, &
s
->
pm°s
);

439 
	`qemu_put_be16s
(
f
, &
s
->
pmí
);

440 
	`qemu_put_be16s
(
f
, &
s
->
pm˙ål
);

441 
	`qemu_put_8s
(
f
, &
s
->
≠mc
);

442 
	`qemu_put_8s
(
f
, &
s
->
≠ms
);

443 
	`qemu_put_timî
(
f
, 
s
->
tmr_timî
);

444 
	`qemu_put_be64s
(
f
, &
s
->
tmr_ovîÊow_time
);

445 
	}
}

447 
	$pm_lﬂd
(
QEMUFûe
* 
f
,* 
›aque
,
vîsi⁄_id
)

449 
PIIX4PMSèã
 *
s
 = 
›aque
;

450 
ªt
;

452 i‡(
vîsi⁄_id
 > 1)

453  -
EINVAL
;

455 
ªt
 = 
	`pci_devi˚_lﬂd
(&
s
->
dev
, 
f
);

456 i‡(
ªt
 < 0)

457  
ªt
;

459 
	`qemu_gë_be16s
(
f
, &
s
->
pm°s
);

460 
	`qemu_gë_be16s
(
f
, &
s
->
pmí
);

461 
	`qemu_gë_be16s
(
f
, &
s
->
pm˙ål
);

462 
	`qemu_gë_8s
(
f
, &
s
->
≠mc
);

463 
	`qemu_gë_8s
(
f
, &
s
->
≠ms
);

464 
	`qemu_gë_timî
(
f
, 
s
->
tmr_timî
);

465 
	`qemu_gë_be64s
(
f
, &
s
->
tmr_ovîÊow_time
);

467 
	`pm_io_•a˚_upd©e
(
s
);

470 
	}
}

472 
	$piix4_pm_öô
(
PCIBus
 *
bus
, 
dev‚
)

474 
PIIX4PMSèã
 *
s
;

475 
uöt8_t
 *
pci_c⁄f
;

476 
uöt32_t
 
pm_io_ba£
, 
smb_io_ba£
;

478 
s
 = (
PIIX4PMSèã
 *)
	`pci_ªgi°î_devi˚
(
bus
,

479 "PM", (
PIIX4PMSèã
),

480 
dev‚
, 
NULL
, 
pm_wrôe_c⁄fig
);

481 
pci_c⁄f
 = 
s
->
dev
.
c⁄fig
;

482 
pci_c⁄f
[0x00] = 0x86;

483 
pci_c⁄f
[0x01] = 0x80;

484 
pci_c⁄f
[0x02] = 0x13;

485 
pci_c⁄f
[0x03] = 0x71;

486 
pci_c⁄f
[0x08] = 0x00;

487 
pci_c⁄f
[0x09] = 0x00;

488 
pci_c⁄f
[0x0a] = 0x80;

489 
pci_c⁄f
[0x0b] = 0x06;

490 
pci_c⁄f
[0x0e] = 0x00;

491 
pci_c⁄f
[0x3d] = 0x01;

493 
pci_c⁄f
[0x40] = 0x01;

495 
	`ªgi°î_i›‹t_wrôe
(0xb2, 2, 1, 
pm_smi_wrôeb
, 
s
);

496 
	`ªgi°î_i›‹t_ªad
(0xb2, 2, 1, 
pm_smi_ªadb
, 
s
);

498 
	`ªgi°î_i›‹t_wrôe
(
ACPI_DBG_IO_ADDR
, 4, 4, 
a˝i_dbg_wrôñ
, 
s
);

502 
pci_c⁄f
[0x5f] = (
∑øŒñ_hds
[0] !
NULL
 ? 0x80 : 0) | 0x10;

503 
pci_c⁄f
[0x63] = 0x60;

504 
pci_c⁄f
[0x67] = (
£rül_hds
[0] !
NULL
 ? 0x08 : 0) |

505 (
£rül_hds
[1] !
NULL
 ? 0x90 : 0);

507 
smb_io_ba£
 = 
SMB_IO_BASE
;

508 
pci_c⁄f
[0x90] = 
smb_io_ba£
 | 1;

509 
pci_c⁄f
[0x91] = 
smb_io_ba£
 >> 8;

510 
pci_c⁄f
[0xd2] = 0x09;

511 
	`ªgi°î_i›‹t_wrôe
(
smb_io_ba£
, 64, 1, 
smb_i›‹t_wrôeb
, 
s
);

512 
	`ªgi°î_i›‹t_ªad
(
smb_io_ba£
, 64, 1, 
smb_i›‹t_ªadb
, 
s
);

514 
s
->
tmr_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
pm_tmr_timî
, s);

516 
	`ªgi°î_ßvevm
("piix4_pm", 0, 1, 
pm_ßve
, 
pm_lﬂd
, 
s
);

517 
piix4_pm_°©e
 = 
s
;

518 
	}
}

520 
	$piix4_smbus_ªgi°î_devi˚
(
SMBusDevi˚
 *
dev
, 
uöt8_t
 
addr
)

522 
piix4_pm_°©e
->
smb_dev
[
addr
] = 
dev
;

523 
	}
}

	@adb.c

24 
	~"vl.h
"

27 
	#ADB_BUSRESET
 0x00

	)

28 
	#ADB_FLUSH
 0x01

	)

29 
	#ADB_WRITEREG
 0x08

	)

30 
	#ADB_READREG
 0x0c

	)

33 
	#ADB_CMD_SELF_TEST
 0xff

	)

34 
	#ADB_CMD_CHANGE_ID
 0x„

	)

35 
	#ADB_CMD_CHANGE_ID_AND_ACT
 0xfd

	)

36 
	#ADB_CMD_CHANGE_ID_AND_ENABLE
 0x00

	)

39 
	#ADB_DONGLE
 1

	)

40 
	#ADB_KEYBOARD
 2

	)

41 
	#ADB_MOUSE
 3

	)

42 
	#ADB_TABLET
 4

	)

43 
	#ADB_MODEM
 5

	)

44 
	#ADB_MISC
 7

	)

47 
	#ADB_RET_NOTPRESENT
 (-2)

	)

49 
	$adb_ªque°
(
ADBBusSèã
 *
s
, 
uöt8_t
 *
obuf
, c⁄° uöt8_à*
buf
, 
Àn
)

51 
ADBDevi˚
 *
d
;

52 
devaddr
, 
cmd
, 
i
;

54 
cmd
 = 
buf
[0] & 0xf;

55 i‡(
cmd
 =
ADB_BUSRESET
) {

56 
i
 = 0; i < 
s
->
nb_devi˚s
; i++) {

57 
d
 = &
s
->
devi˚s
[
i
];

58 i‡(
d
->
devª£t
) {

59 
d
->
	`devª£t
(d);

64 
devaddr
 = 
buf
[0] >> 4;

65 
i
 = 0; i < 
s
->
nb_devi˚s
; i++) {

66 
d
 = &
s
->
devi˚s
[
i
];

67 i‡(
d
->
devaddr
 == devaddr) {

68  
d
->
	`devªq
(d, 
obuf
, 
buf
, 
Àn
);

71  
ADB_RET_NOTPRESENT
;

72 
	}
}

75 
	$adb_pﬁl
(
ADBBusSèã
 *
s
, 
uöt8_t
 *
obuf
)

77 
ADBDevi˚
 *
d
;

78 
ﬁí
, 
i
;

79 
uöt8_t
 
buf
[1];

81 
ﬁí
 = 0;

82 
i
 = 0; i < 
s
->
nb_devi˚s
; i++) {

83 i‡(
s
->
pﬁl_ödex
 >s->
nb_devi˚s
)

84 
s
->
pﬁl_ödex
 = 0;

85 
d
 = &
s
->
devi˚s
[s->
pﬁl_ödex
];

86 
buf
[0] = 
ADB_READREG
 | (
d
->
devaddr
 << 4);

87 
ﬁí
 = 
	`adb_ªque°
(
s
, 
obuf
 + 1, 
buf
, 1);

89 i‡(
ﬁí
 > 0) {

90 
obuf
[0] = 
buf
[0];

91 
ﬁí
++;

94 
s
->
pﬁl_ödex
++;

96  
ﬁí
;

97 
	}
}

99 
ADBDevi˚
 *
	$adb_ªgi°î_devi˚
(
ADBBusSèã
 *
s
, 
devaddr
,

100 
ADBDevi˚Reque°
 *
devªq
,

101 
ADBDevi˚Re£t
 *
devª£t
,

102 *
›aque
)

104 
ADBDevi˚
 *
d
;

105 i‡(
s
->
nb_devi˚s
 >
MAX_ADB_DEVICES
)

106  
NULL
;

107 
d
 = &
s
->
devi˚s
[s->
nb_devi˚s
++];

108 
d
->
bus
 = 
s
;

109 
d
->
devaddr
 = devaddr;

110 
d
->
devªq
 = devreq;

111 
d
->
devª£t
 = devreset;

112 
d
->
›aque
 = opaque;

113  
d
;

114 
	}
}

119 
	sKBDSèã
 {

120 
uöt8_t
 
	md©a
[128];

121 
	mΩå
, 
	mw±r
, 
	mcou¡
;

122 } 
	tKBDSèã
;

124 c⁄° 
uöt8_t
 
	gpc_to_adb_keycode
[256] = {

143 
	$adb_kbd_put_keycode
(*
›aque
, 
keycode
)

145 
ADBDevi˚
 *
d
 = 
›aque
;

146 
KBDSèã
 *
s
 = 
d
->
›aque
;

148 i‡(
s
->
cou¡
 < (s->
d©a
)) {

149 
s
->
d©a
[s->
w±r
] = 
keycode
;

150 i‡(++
s
->
w±r
 =(s->
d©a
))

151 
s
->
w±r
 = 0;

152 
s
->
cou¡
++;

154 
	}
}

156 
	$adb_kbd_pﬁl
(
ADBDevi˚
 *
d
, 
uöt8_t
 *
obuf
)

158 
ext_keycode
;

159 
KBDSèã
 *
s
 = 
d
->
›aque
;

160 
adb_keycode
, 
keycode
;

161 
ﬁí
;

163 
ﬁí
 = 0;

165 i‡(
s
->
cou¡
 == 0)

167 
keycode
 = 
s
->
d©a
[s->
Ωå
];

168 i‡(++
s
->
Ωå
 =(s->
d©a
))

169 
s
->
Ωå
 = 0;

170 
s
->
cou¡
--;

172 i‡(
keycode
 == 0xe0) {

173 
ext_keycode
 = 1;

175 i‡(
ext_keycode
)

176 
adb_keycode
 = 
pc_to_adb_keycode
[
keycode
 | 0x80];

178 
adb_keycode
 = 
pc_to_adb_keycode
[
keycode
 & 0x7f];

179 
obuf
[0] = 
adb_keycode
 | (
keycode
 & 0x80);

181 
obuf
[1] = 0xff;

182 
ﬁí
 = 2;

183 
ext_keycode
 = 0;

187  
ﬁí
;

188 
	}
}

190 
	$adb_kbd_ªque°
(
ADBDevi˚
 *
d
, 
uöt8_t
 *
obuf
,

191 c⁄° 
uöt8_t
 *
buf
, 
Àn
)

193 
KBDSèã
 *
s
 = 
d
->
›aque
;

194 
cmd
, 
ªg
, 
ﬁí
;

196 i‡((
buf
[0] & 0x0fË=
ADB_FLUSH
) {

198 
s
->
w±r
 = s->
Ωå
 = s->
cou¡
 = 0;

202 
cmd
 = 
buf
[0] & 0xc;

203 
ªg
 = 
buf
[0] & 0x3;

204 
ﬁí
 = 0;

205 
cmd
) {

206 
ADB_WRITEREG
:

207 
ªg
) {

212 
buf
[2]) {

213 
ADB_CMD_SELF_TEST
:

215 
ADB_CMD_CHANGE_ID
:

216 
ADB_CMD_CHANGE_ID_AND_ACT
:

217 
ADB_CMD_CHANGE_ID_AND_ENABLE
:

218 
d
->
devaddr
 = 
buf
[1] & 0xf;

222 
d
->
devaddr
 = 
buf
[1] & 0xf;

223 
d
->
h™dÀr
 = 
buf
[2];

228 
ADB_READREG
:

229 
ªg
) {

231 
ﬁí
 = 
	`adb_kbd_pﬁl
(
d
, 
obuf
);

236 
obuf
[0] = 0x00;

237 
obuf
[1] = 0x07;

238 
ﬁí
 = 2;

241 
obuf
[0] = 
d
->
h™dÀr
;

242 
obuf
[1] = 
d
->
devaddr
;

243 
ﬁí
 = 2;

248  
ﬁí
;

249 
	}
}

251 
	$adb_kbd_ª£t
(
ADBDevi˚
 *
d
)

253 
KBDSèã
 *
s
 = 
d
->
›aque
;

255 
d
->
h™dÀr
 = 1;

256 
d
->
devaddr
 = 
ADB_KEYBOARD
;

257 
	`mem£t
(
s
, 0, (
KBDSèã
));

260 
	}
}

262 
	$adb_kbd_öô
(
ADBBusSèã
 *
bus
)

264 
ADBDevi˚
 *
d
;

265 
KBDSèã
 *
s
;

266 
s
 = 
	`qemu_mÆlocz
((
KBDSèã
));

267 
d
 = 
	`adb_ªgi°î_devi˚
(
bus
, 
ADB_KEYBOARD
, 
adb_kbd_ªque°
,

268 
adb_kbd_ª£t
, 
s
);

269 
	`adb_kbd_ª£t
(
d
);

270 
	`qemu_add_kbd_evít_h™dÀr
(
adb_kbd_put_keycode
, 
d
);

271 
	}
}

276 
	sMou£Sèã
 {

277 
	mbuâ⁄s_°©e
, 
	mœ°_buâ⁄s_°©e
;

278 
	mdx
, 
	mdy
, 
	mdz
;

279 } 
	tMou£Sèã
;

281 
	$adb_mou£_evít
(*
›aque
,

282 
dx1
, 
dy1
, 
dz1
, 
buâ⁄s_°©e
)

284 
ADBDevi˚
 *
d
 = 
›aque
;

285 
Mou£Sèã
 *
s
 = 
d
->
›aque
;

287 
s
->
dx
 +
dx1
;

288 
s
->
dy
 +
dy1
;

289 
s
->
dz
 +
dz1
;

290 
s
->
buâ⁄s_°©e
 = buttons_state;

291 
	}
}

294 
	$adb_mou£_pﬁl
(
ADBDevi˚
 *
d
, 
uöt8_t
 *
obuf
)

296 
Mou£Sèã
 *
s
 = 
d
->
›aque
;

297 
dx
, 
dy
;

299 i‡(
s
->
œ°_buâ⁄s_°©e
 =s->
buâ⁄s_°©e
 &&

300 
s
->
dx
 =0 && s->
dy
 == 0)

303 
dx
 = 
s
->dx;

304 i‡(
dx
 < -63)

305 
dx
 = -63;

306 i‡(
dx
 > 63)

307 
dx
 = 63;

309 
dy
 = 
s
->dy;

310 i‡(
dy
 < -63)

311 
dy
 = -63;

312 i‡(
dy
 > 63)

313 
dy
 = 63;

315 
s
->
dx
 -= dx;

316 
s
->
dy
 -= dy;

317 
s
->
œ°_buâ⁄s_°©e
 = s->
buâ⁄s_°©e
;

319 
dx
 &= 0x7f;

320 
dy
 &= 0x7f;

322 i‡(!(
s
->
buâ⁄s_°©e
 & 
MOUSE_EVENT_LBUTTON
))

323 
dy
 |= 0x80;

324 i‡(!(
s
->
buâ⁄s_°©e
 & 
MOUSE_EVENT_RBUTTON
))

325 
dx
 |= 0x80;

327 
obuf
[0] = 
dy
;

328 
obuf
[1] = 
dx
;

330 
	}
}

332 
	$adb_mou£_ªque°
(
ADBDevi˚
 *
d
, 
uöt8_t
 *
obuf
,

333 c⁄° 
uöt8_t
 *
buf
, 
Àn
)

335 
Mou£Sèã
 *
s
 = 
d
->
›aque
;

336 
cmd
, 
ªg
, 
ﬁí
;

338 i‡((
buf
[0] & 0x0fË=
ADB_FLUSH
) {

340 
s
->
buâ⁄s_°©e
 = s->
œ°_buâ⁄s_°©e
;

341 
s
->
dx
 = 0;

342 
s
->
dy
 = 0;

343 
s
->
dz
 = 0;

347 
cmd
 = 
buf
[0] & 0xc;

348 
ªg
 = 
buf
[0] & 0x3;

349 
ﬁí
 = 0;

350 
cmd
) {

351 
ADB_WRITEREG
:

352 
ªg
) {

356 
buf
[2]) {

357 
ADB_CMD_SELF_TEST
:

359 
ADB_CMD_CHANGE_ID
:

360 
ADB_CMD_CHANGE_ID_AND_ACT
:

361 
ADB_CMD_CHANGE_ID_AND_ENABLE
:

362 
d
->
devaddr
 = 
buf
[1] & 0xf;

366 
d
->
devaddr
 = 
buf
[1] & 0xf;

371 
ADB_READREG
:

372 
ªg
) {

374 
ﬁí
 = 
	`adb_mou£_pﬁl
(
d
, 
obuf
);

379 
obuf
[0] = 
d
->
h™dÀr
;

380 
obuf
[1] = 
d
->
devaddr
;

381 
ﬁí
 = 2;

386  
ﬁí
;

387 
	}
}

389 
	$adb_mou£_ª£t
(
ADBDevi˚
 *
d
)

391 
Mou£Sèã
 *
s
 = 
d
->
›aque
;

393 
d
->
h™dÀr
 = 2;

394 
d
->
devaddr
 = 
ADB_MOUSE
;

395 
	`mem£t
(
s
, 0, (
Mou£Sèã
));

398 
	}
}

400 
	$adb_mou£_öô
(
ADBBusSèã
 *
bus
)

402 
ADBDevi˚
 *
d
;

403 
Mou£Sèã
 *
s
;

405 
s
 = 
	`qemu_mÆlocz
((
Mou£Sèã
));

406 
d
 = 
	`adb_ªgi°î_devi˚
(
bus
, 
ADB_MOUSE
, 
adb_mou£_ªque°
,

407 
adb_mou£_ª£t
, 
s
);

408 
	`adb_mou£_ª£t
(
d
);

409 
	`qemu_add_mou£_evít_h™dÀr
(
adb_mou£_evít
, 
d
, 0, "QEMU ADB Mouse");

410 
	}
}

	@adlib.c

24 
	~<as£π.h
>

25 
	~"vl.h
"

27 
	#ADLIB_KILL_TIMERS
 1

	)

29 
	#dﬁog
(...Ë
	`AUD_log
 ("adlib", 
__VA_ARGS__
)

	)

30 #ifde‡
DEBUG


31 
	#ldebug
(...Ë
	`dﬁog
 (
__VA_ARGS__
)

	)

33 
	#ldebug
(...)

	)

36 #ifde‡
HAS_YMF262


37 
	~"ymf262.h
"

38 
YMF262Upd©eO√QEMU
 (
which
, 
INT16
 *
d°
, 
Àngth
);

39 
	#SHIFT
 2

	)

41 
	~"fm›l.h
"

42 
	#SHIFT
 1

	)

45 
	#IO_READ_PROTO
(
«me
) \

46 
uöt32_t
 
	`«me
 (*
›aque
, uöt32_à
≈‹t
)

	)

47 
	#IO_WRITE_PROTO
(
«me
) \

48 
	`«me
 (*
›aque
, 
uöt32_t
 
≈‹t
, uöt32_à
vÆ
)

	)

51 
	mp‹t
;

52 
	m‰eq
;

53 } 
	gc⁄f
 = {0x220, 44100};

56 
QEMUSoundC¨d
 
	mˇrd
;

57 
	mtickög
[2];

58 
	míabÀd
;

59 
	ma˘ive
;

60 
	mbuÂos
;

61 #ifde‡
DEBUG


62 
öt64_t
 
	mexp
[2];

64 
öt16_t
 *
	mmixbuf
;

65 
uöt64_t
 
	mdexp
[2];

66 
SWVoi˚Out
 *
	mvoi˚
;

67 
	mÀ·
, 
	mpos
, 
	mßm∂es
;

68 
QEMUAudioTimeSèmp
 
	m©s
;

69 #i‚de‡
HAS_YMF262


70 
FM_OPL
 *
	m›l
;

72 } 
	tAdlibSèã
;

74 
AdlibSèã
 
	gglob_adlib
;

76 
	$adlib_°›_›l_timî
 (
AdlibSèã
 *
s
, 
size_t
 
n
)

78 #ifde‡
HAS_YMF262


79 
	`YMF262TimîOvî
 (0, 
n
);

81 
	`OPLTimîOvî
 (
s
->
›l
, 
n
);

83 
s
->
tickög
[
n
] = 0;

84 
	}
}

86 
	$adlib_kûl_timîs
 (
AdlibSèã
 *
s
)

88 
size_t
 
i
;

90 
i
 = 0; i < 2; ++i) {

91 i‡(
s
->
tickög
[
i
]) {

92 
uöt64_t
 
dñè
;

94 
dñè
 = 
	`AUD_gë_ñ≠£d_u£c_out
 (
s
->
voi˚
, &s->
©s
);

95 
	`ldebug
 (

97 
dñè
 / 1000000.0,

98 
s
->
dexp
[
i
] / 1000000.0,

99 
dñè
 >
s
->
dexp
[
i
]

101 i‡(
ADLIB_KILL_TIMERS
 || 
dñè
 >
s
->
dexp
[
i
]) {

102 
	`adlib_°›_›l_timî
 (
s
, 
i
);

103 
	`AUD_öô_time_°amp_out
 (
s
->
voi˚
, &s->
©s
);

107 
	}
}

109 
	$IO_WRITE_PROTO
(
adlib_wrôe
)

111 
AdlibSèã
 *
s
 = 
›aque
;

112 
a
 = 
≈‹t
 & 3;

113 
°©us
;

115 
s
->
a˘ive
 = 1;

116 
	`AUD_£t_a˘ive_out
 (
s
->
voi˚
, 1);

118 
	`adlib_kûl_timîs
 (
s
);

120 #ifde‡
HAS_YMF262


121 
°©us
 = 
	`YMF262Wrôe
 (0, 
a
, 
vÆ
);

123 
°©us
 = 
	`OPLWrôe
 (
s
->
›l
, 
a
, 
vÆ
);

125 
	}
}

127 
	$IO_READ_PROTO
(
adlib_ªad
)

129 
AdlibSèã
 *
s
 = 
›aque
;

130 
uöt8_t
 
d©a
;

131 
a
 = 
≈‹t
 & 3;

133 
	`adlib_kûl_timîs
 (
s
);

135 #ifde‡
HAS_YMF262


136 
d©a
 = 
	`YMF262Ród
 (0, 
a
);

138 
d©a
 = 
	`OPLRód
 (
s
->
›l
, 
a
);

140  
d©a
;

141 
	}
}

143 
	$timî_h™dÀr
 (
c
, 
öãrvÆ_Sec
)

145 
AdlibSèã
 *
s
 = &
glob_adlib
;

146 
n
 = 
c
 & 1;

147 #ifde‡
DEBUG


148 
öãrvÆ
;

149 
öt64_t
 
exp
;

152 i‡(
öãrvÆ_Sec
 == 0.0) {

153 
s
->
tickög
[
n
] = 0;

157 
s
->
tickög
[
n
] = 1;

158 #ifde‡
DEBUG


159 
öãrvÆ
 = 
ticks_≥r_£c
 * 
öãrvÆ_Sec
;

160 
exp
 = 
	`qemu_gë_˛ock
 (
vm_˛ock
Ë+ 
öãrvÆ
;

161 
s
->
exp
[
n
] =Éxp;

164 
s
->
dexp
[
n
] = 
öãrvÆ_Sec
 * 1000000.0;

165 
	`AUD_öô_time_°amp_out
 (
s
->
voi˚
, &s->
©s
);

166 
	}
}

168 
	$wrôe_audio
 (
AdlibSèã
 *
s
, 
ßm∂es
)

170 
√t
 = 0;

171 
pos
 = 
s
->pos;

173 
ßm∂es
) {

174 
nbyãs
, 
wbyãs
, 
wßm∂
;

176 
nbyãs
 = 
ßm∂es
 << 
SHIFT
;

177 
wbyãs
 = 
	`AUD_wrôe
 (

178 
s
->
voi˚
,

179 
s
->
mixbuf
 + (
pos
 << (
SHIFT
 - 1)),

180 
nbyãs


183 i‡(
wbyãs
) {

184 
wßm∂
 = 
wbyãs
 >> 
SHIFT
;

186 
ßm∂es
 -
wßm∂
;

187 
pos
 = (po†+ 
wßm∂
Ë% 
s
->
ßm∂es
;

189 
√t
 +
wßm∂
;

196  
√t
;

197 
	}
}

199 
	$adlib_ˇŒback
 (*
›aque
, 
‰ì
)

201 
AdlibSèã
 *
s
 = 
›aque
;

202 
ßm∂es
, 
√t
 = 0, 
to_∂ay
, 
wrôãn
;

204 
ßm∂es
 = 
‰ì
 >> 
SHIFT
;

205 i‡(!(
s
->
a˘ive
 && s->
íabÀd
Ë|| !
ßm∂es
) {

209 
to_∂ay
 = 
	`audio_MIN
 (
s
->
À·
, 
ßm∂es
);

210 
to_∂ay
) {

211 
wrôãn
 = 
	`wrôe_audio
 (
s
, 
to_∂ay
);

213 i‡(
wrôãn
) {

214 
s
->
À·
 -
wrôãn
;

215 
ßm∂es
 -
wrôãn
;

216 
to_∂ay
 -
wrôãn
;

217 
s
->
pos
 = (s->po†+ 
wrôãn
Ë% s->
ßm∂es
;

224 
ßm∂es
 = 
	`audio_MIN
 (ßm∂es, 
s
->ßm∂e†- s->
pos
);

225 i‡(!
ßm∂es
) {

229 #ifde‡
HAS_YMF262


230 
	`YMF262Upd©eO√QEMU
 (0, 
s
->
mixbuf
 + s->
pos
 * 2, 
ßm∂es
);

232 
	`YM3812Upd©eO√
 (
s
->
›l
, s->
mixbuf
 + s->
pos
, 
ßm∂es
);

235 
ßm∂es
) {

236 
wrôãn
 = 
	`wrôe_audio
 (
s
, 
ßm∂es
);

238 i‡(
wrôãn
) {

239 
√t
 +
wrôãn
;

240 
ßm∂es
 -
wrôãn
;

241 
s
->
pos
 = (s->po†+ 
wrôãn
Ë% s->
ßm∂es
;

244 
s
->
À·
 = 
ßm∂es
;

248 
	}
}

250 
	$Adlib_föi
 (
AdlibSèã
 *
s
)

252 #ifde‡
HAS_YMF262


253 
	`YMF262Shutdown
 ();

255 i‡(
s
->
›l
) {

256 
	`OPLDe°roy
 (
s
->
›l
);

257 
s
->
›l
 = 
NULL
;

261 i‡(
s
->
mixbuf
) {

262 
	`qemu_‰ì
 (
s
->
mixbuf
);

265 
s
->
a˘ive
 = 0;

266 
s
->
íabÀd
 = 0;

267 
	`AUD_ªmove_ˇrd
 (&
s
->
ˇrd
);

268 
	}
}

270 
	$Adlib_öô
 (
AudioSèã
 *
audio
)

272 
AdlibSèã
 *
s
 = &
glob_adlib
;

273 
aud£âögs_t
 
as
;

275 i‡(!
audio
) {

276 
	`dﬁog
 ("Noáudio state\n");

280 #ifde‡
HAS_YMF262


281 i‡(
	`YMF262Inô
 (1, 14318180, 
c⁄f
.
‰eq
)) {

282 
	`dﬁog
 ("YMF262Inô %d faûed\n", 
c⁄f
.
‰eq
);

286 
	`YMF262SëTimîH™dÀr
 (0, 
timî_h™dÀr
, 0);

287 
s
->
íabÀd
 = 1;

290 
s
->
›l
 = 
	`OPLCª©e
 (
OPL_TYPE_YM3812
, 3579545, 
c⁄f
.
‰eq
);

291 i‡(!
s
->
›l
) {

292 
	`dﬁog
 ("OPLCª©ê%d faûed\n", 
c⁄f
.
‰eq
);

296 
	`OPLSëTimîH™dÀr
 (
s
->
›l
, 
timî_h™dÀr
, 0);

297 
s
->
íabÀd
 = 1;

301 
as
.
‰eq
 = 
c⁄f
.freq;

302 
as
.
nch™√ls
 = 
SHIFT
;

303 
as
.
fmt
 = 
AUD_FMT_S16
;

304 
as
.
ídü¬ess
 = 
AUDIO_HOST_ENDIANNESS
;

306 
	`AUD_ªgi°î_ˇrd
 (
audio
, "adlib", &
s
->
ˇrd
);

308 
s
->
voi˚
 = 
	`AUD_›í_out
 (

309 &
s
->
ˇrd
,

310 
s
->
voi˚
,

312 
s
,

313 
adlib_ˇŒback
,

314 &
as


316 i‡(!
s
->
voi˚
) {

317 
	`Adlib_föi
 (
s
);

321 
s
->
ßm∂es
 = 
	`AUD_gë_buf„r_size_out
 (s->
voi˚
Ë>> 
SHIFT
;

322 
s
->
mixbuf
 = 
	`qemu_mÆlocz
 (s->
ßm∂es
 << 
SHIFT
);

324 i‡(!
s
->
mixbuf
) {

325 
	`dﬁog
 ("CouldÇotállocate mixing buffer, %d samples (each %d bytes)\n",

326 
s
->
ßm∂es
, 1 << 
SHIFT
);

327 
	`Adlib_föi
 (
s
);

331 
	`ªgi°î_i›‹t_ªad
 (0x388, 4, 1, 
adlib_ªad
, 
s
);

332 
	`ªgi°î_i›‹t_wrôe
 (0x388, 4, 1, 
adlib_wrôe
, 
s
);

334 
	`ªgi°î_i›‹t_ªad
 (
c⁄f
.
p‹t
, 4, 1, 
adlib_ªad
, 
s
);

335 
	`ªgi°î_i›‹t_wrôe
 (
c⁄f
.
p‹t
, 4, 1, 
adlib_wrôe
, 
s
);

337 
	`ªgi°î_i›‹t_ªad
 (
c⁄f
.
p‹t
 + 8, 2, 1, 
adlib_ªad
, 
s
);

338 
	`ªgi°î_i›‹t_wrôe
 (
c⁄f
.
p‹t
 + 8, 2, 1, 
adlib_wrôe
, 
s
);

341 
	}
}

	@apb_pci.c

29 
	~"vl.h
"

30 
èrgë_phys_addr_t
 
	tpci_addr_t
;

31 
	~"pci_ho°.h
"

33 
PCIHo°Sèã
 
	tAPBSèã
;

35 
	$pci_≠b_c⁄fig_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

36 
uöt32_t
 
vÆ
)

38 
APBSèã
 *
s
 = 
›aque
;

39 
i
;

41 
i
 = 11; i < 32; i++) {

42 i‡((
vÆ
 & (1 << 
i
)) != 0)

45 
s
->
c⁄fig_ªg
 = (1 << 16Ë| (
vÆ
 & 0x7FCË| (
i
 << 11);

46 
	}
}

48 
uöt32_t
 
	$pci_≠b_c⁄fig_ªadl
 (*
›aque
,

49 
èrgë_phys_addr_t
 
addr
)

51 
APBSèã
 *
s
 = 
›aque
;

52 
uöt32_t
 
vÆ
;

53 
dev‚
;

55 
dev‚
 = (
s
->
c⁄fig_ªg
 >> 8) & 0xFF;

56 
vÆ
 = (1 << (
dev‚
 >> 3)Ë| ((dev‚ & 0x07Ë<< 8Ë| (
s
->
c⁄fig_ªg
 & 0xFC);

57  
vÆ
;

58 
	}
}

60 
CPUWrôeMem‹yFunc
 *
	gpci_≠b_c⁄fig_wrôe
[] = {

61 &
pci_≠b_c⁄fig_wrôñ
,

62 &
pci_≠b_c⁄fig_wrôñ
,

63 &
pci_≠b_c⁄fig_wrôñ
,

66 
CPURódMem‹yFunc
 *
	gpci_≠b_c⁄fig_ªad
[] = {

67 &
pci_≠b_c⁄fig_ªadl
,

68 &
pci_≠b_c⁄fig_ªadl
,

69 &
pci_≠b_c⁄fig_ªadl
,

72 
	$≠b_c⁄fig_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

73 
uöt32_t
 
vÆ
)

77 
addr
 & 0x3f) {

87 
	}
}

89 
uöt32_t
 
	$≠b_c⁄fig_ªadl
 (*
›aque
,

90 
èrgë_phys_addr_t
 
addr
)

93 
uöt32_t
 
vÆ
;

95 
addr
 & 0x3f) {

103 
vÆ
 = 0;

106  
vÆ
;

107 
	}
}

109 
CPUWrôeMem‹yFunc
 *
	g≠b_c⁄fig_wrôe
[] = {

110 &
≠b_c⁄fig_wrôñ
,

111 &
≠b_c⁄fig_wrôñ
,

112 &
≠b_c⁄fig_wrôñ
,

115 
CPURódMem‹yFunc
 *
	g≠b_c⁄fig_ªad
[] = {

116 &
≠b_c⁄fig_ªadl
,

117 &
≠b_c⁄fig_ªadl
,

118 &
≠b_c⁄fig_ªadl
,

121 
CPUWrôeMem‹yFunc
 *
	gpci_≠b_wrôe
[] = {

122 &
pci_ho°_d©a_wrôeb
,

123 &
pci_ho°_d©a_wrôew
,

124 &
pci_ho°_d©a_wrôñ
,

127 
CPURódMem‹yFunc
 *
	gpci_≠b_ªad
[] = {

128 &
pci_ho°_d©a_ªadb
,

129 &
pci_ho°_d©a_ªadw
,

130 &
pci_ho°_d©a_ªadl
,

133 
	$pci_≠b_iowrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

134 
uöt32_t
 
vÆ
)

136 
	`˝u_outb
(
NULL
, 
addr
 & 0xffff, 
vÆ
);

137 
	}
}

139 
	$pci_≠b_iowrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

140 
uöt32_t
 
vÆ
)

142 
	`˝u_outw
(
NULL
, 
addr
 & 0xffff, 
vÆ
);

143 
	}
}

145 
	$pci_≠b_iowrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

146 
uöt32_t
 
vÆ
)

148 
	`˝u_oué
(
NULL
, 
addr
 & 0xffff, 
vÆ
);

149 
	}
}

151 
uöt32_t
 
	$pci_≠b_i‹ódb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

153 
uöt32_t
 
vÆ
;

155 
vÆ
 = 
	`˝u_öb
(
NULL
, 
addr
 & 0xffff);

156  
vÆ
;

157 
	}
}

159 
uöt32_t
 
	$pci_≠b_i‹ódw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

161 
uöt32_t
 
vÆ
;

163 
vÆ
 = 
	`˝u_öw
(
NULL
, 
addr
 & 0xffff);

164  
vÆ
;

165 
	}
}

167 
uöt32_t
 
	$pci_≠b_i‹ódl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

169 
uöt32_t
 
vÆ
;

171 
vÆ
 = 
	`˝u_öl
(
NULL
, 
addr
 & 0xffff);

172  
vÆ
;

173 
	}
}

175 
CPUWrôeMem‹yFunc
 *
	gpci_≠b_iowrôe
[] = {

176 &
pci_≠b_iowrôeb
,

177 &
pci_≠b_iowrôew
,

178 &
pci_≠b_iowrôñ
,

181 
CPURódMem‹yFunc
 *
	gpci_≠b_i‹ód
[] = {

182 &
pci_≠b_i‹ódb
,

183 &
pci_≠b_i‹ódw
,

184 &
pci_≠b_i‹ódl
,

188 
	$pci_≠b_m≠_úq
(
PCIDevi˚
 *
pci_dev
, 
úq_num
)

190  ((
pci_dev
->
dev‚
 & 0x18Ë>> 1Ë+ 
úq_num
;

191 
	}
}

193 
	$pci_pbm_m≠_úq
(
PCIDevi˚
 *
pci_dev
, 
úq_num
)

195 
bus_off£t
;

196 i‡(
pci_dev
->
dev‚
 & 1)

197 
bus_off£t
 = 16;

199 
bus_off£t
 = 0;

200  
bus_off£t
 + 
úq_num
;

201 
	}
}

203 
	$pci_≠b_£t_úq
(*
pic
, 
úq_num
, 
Àvñ
)

206 
	`pic_£t_úq_√w
(
pic
, 
úq_num
, 
Àvñ
);

207 
	}
}

209 
PCIBus
 *
	$pci_≠b_öô
(
èrgë_ul⁄g
 
•ecül_ba£
,Å¨gë_ul⁄g 
mem_ba£
,

210 *
pic
)

212 
APBSèã
 *
s
;

213 
PCIDevi˚
 *
d
;

214 
pci_mem_c⁄fig
, 
pci_mem_d©a
, 
≠b_c⁄fig
, 
pci_i›‹t
;

215 
PCIDevi˚
 *
≠b
;

216 
PCIBus
 *
£c⁄d¨y
;

218 
s
 = 
	`qemu_mÆlocz
((
APBSèã
));

220 
s
->
bus
 = 
	`pci_ªgi°î_bus
(
pci_≠b_£t_úq
, 
pci_pbm_m≠_úq
, 
pic
, 0, 32);

222 
pci_mem_c⁄fig
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_≠b_c⁄fig_ªad
,

223 
pci_≠b_c⁄fig_wrôe
, 
s
);

224 
≠b_c⁄fig
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
≠b_c⁄fig_ªad
,

225 
≠b_c⁄fig_wrôe
, 
s
);

226 
pci_mem_d©a
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_≠b_ªad
,

227 
pci_≠b_wrôe
, 
s
);

228 
pci_i›‹t
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_≠b_i‹ód
,

229 
pci_≠b_iowrôe
, 
s
);

231 
	`˝u_ªgi°î_physiˇl_mem‹y
(
•ecül_ba£
 + 0x2000ULL, 0x40, 
≠b_c⁄fig
);

232 
	`˝u_ªgi°î_physiˇl_mem‹y
(
•ecül_ba£
 + 0x1000000ULL, 0x10, 
pci_mem_c⁄fig
);

233 
	`˝u_ªgi°î_physiˇl_mem‹y
(
•ecül_ba£
 + 0x2000000ULL, 0x10000, 
pci_i›‹t
);

234 
	`˝u_ªgi°î_physiˇl_mem‹y
(
mem_ba£
, 0x10000000, 
pci_mem_d©a
);

236 
d
 = 
	`pci_ªgi°î_devi˚
(
s
->
bus
, "Adv™˚d PCI Bus", (
PCIDevi˚
),

237 0, 
NULL
, NULL);

238 
d
->
c⁄fig
[0x00] = 0x8e;

239 
d
->
c⁄fig
[0x01] = 0x10;

240 
d
->
c⁄fig
[0x02] = 0x00;

241 
d
->
c⁄fig
[0x03] = 0xa0;

242 
d
->
c⁄fig
[0x04] = 0x06;

243 
d
->
c⁄fig
[0x05] = 0x00;

244 
d
->
c⁄fig
[0x06] = 0xa0;

245 
d
->
c⁄fig
[0x07] = 0x03;

246 
d
->
c⁄fig
[0x08] = 0x00;

247 
d
->
c⁄fig
[0x09] = 0x00;

248 
d
->
c⁄fig
[0x0A] = 0x00;

249 
d
->
c⁄fig
[0x0B] = 0x06;

250 
d
->
c⁄fig
[0x0D] = 0x10;

251 
d
->
c⁄fig
[0x0E] = 0x00;

254 
£c⁄d¨y
 = 
	`pci_bridge_öô
(
s
->
bus
, 8, 0x108e5000, 
pci_≠b_m≠_úq
, "Advanced PCI Bus secondary bridge 1");

255 
	`pci_bridge_öô
(
s
->
bus
, 9, 0x108e5000, 
pci_≠b_m≠_úq
, "Advanced PCI Bus secondary bridge 2");

256  
£c⁄d¨y
;

257 
	}
}

	@apic.c

20 
	~"vl.h
"

26 
	#APIC_LVT_TIMER
 0

	)

27 
	#APIC_LVT_THERMAL
 1

	)

28 
	#APIC_LVT_PERFORM
 2

	)

29 
	#APIC_LVT_LINT0
 3

	)

30 
	#APIC_LVT_LINT1
 4

	)

31 
	#APIC_LVT_ERROR
 5

	)

32 
	#APIC_LVT_NB
 6

	)

35 
	#APIC_DM_FIXED
 0

	)

36 
	#APIC_DM_LOWPRI
 1

	)

37 
	#APIC_DM_SMI
 2

	)

38 
	#APIC_DM_NMI
 4

	)

39 
	#APIC_DM_INIT
 5

	)

40 
	#APIC_DM_SIPI
 6

	)

41 
	#APIC_DM_EXTINT
 7

	)

44 
	#APIC_DESTMODE_FLAT
 0xf

	)

45 
	#APIC_DESTMODE_CLUSTER
 1

	)

47 
	#APIC_TRIGGER_EDGE
 0

	)

48 
	#APIC_TRIGGER_LEVEL
 1

	)

50 
	#APIC_LVT_TIMER_PERIODIC
 (1<<17)

	)

51 
	#APIC_LVT_MASKED
 (1<<16)

	)

52 
	#APIC_LVT_LEVEL_TRIGGER
 (1<<15)

	)

53 
	#APIC_LVT_REMOTE_IRR
 (1<<14)

	)

54 
	#APIC_INPUT_POLARITY
 (1<<13)

	)

55 
	#APIC_SEND_PENDING
 (1<<12)

	)

57 
	#IOAPIC_NUM_PINS
 0x18

	)

59 
	#ESR_ILLEGAL_ADDRESS
 (1 << 7)

	)

61 
	#APIC_SV_ENABLE
 (1 << 8)

	)

63 
	#MAX_APICS
 255

	)

64 
	#MAX_APIC_WORDS
 8

	)

66 
	sAPICSèã
 {

67 
CPUSèã
 *
	m˝u_ív
;

68 
uöt32_t
 
	m≠icba£
;

69 
uöt8_t
 
	mid
;

70 
uöt8_t
 
	m¨b_id
;

71 
uöt8_t
 
	mçr
;

72 
uöt32_t
 
	m•urious_vec
;

73 
uöt8_t
 
	mlog_de°
;

74 
uöt8_t
 
	mde°_mode
;

75 
uöt32_t
 
	mi§
[8];

76 
uöt32_t
 
	mtmr
[8];

77 
uöt32_t
 
	múr
[8];

78 
uöt32_t
 
	mlvt
[
APIC_LVT_NB
];

79 
uöt32_t
 
	me§
;

80 
uöt32_t
 
	mi¸
[2];

82 
uöt32_t
 
	mdivide_c⁄f
;

83 
	mcou¡_shi·
;

84 
uöt32_t
 
	möôül_cou¡
;

85 
öt64_t
 
	möôül_cou¡_lﬂd_time
, 
	m√xt_time
;

86 
QEMUTimî
 *
	mtimî
;

87 } 
	tAPICSèã
;

89 
	sIOAPICSèã
 {

90 
uöt8_t
 
	mid
;

91 
uöt8_t
 
	mi‹eg£l
;

93 
uöt32_t
 
	múr
;

94 
uöt64_t
 
	mi‹edtbl
[
IOAPIC_NUM_PINS
];

97 
	g≠ic_io_mem‹y
;

98 
APICSèã
 *
	gloˇl_≠ics
[
MAX_APICS
 + 1];

99 
	gœ°_≠ic_id
 = 0;

101 
≠ic_öô_ùi
(
APICSèã
 *
s
);

102 
≠ic_£t_úq
(
APICSèã
 *
s
, 
ve˘‹_num
, 
åiggî_mode
);

103 
≠ic_upd©e_úq
(
APICSèã
 *
s
);

106 
	$Ês_bô
(
uöt32_t
 
vÆue
)

108 
ªt
 = 0;

110 #i‡
	`deföed
(
HOST_I386
)

111 
__asm__
 
	`__vﬁ©ûe__
 ("b§ %1, %0\n" : "+r" (
ªt
Ë: "rm" (
vÆue
));

112  
ªt
;

114 i‡(
vÆue
 > 0xffff)

115 
vÆue
 >>16, 
ªt
 = 16;

116 i‡(
vÆue
 > 0xff)

117 
vÆue
 >>8, 
ªt
 += 8;

118 i‡(
vÆue
 > 0xf)

119 
vÆue
 >>4, 
ªt
 += 4;

120 i‡(
vÆue
 > 0x3)

121 
vÆue
 >>2, 
ªt
 += 2;

122  
ªt
 + (
vÆue
 >> 1);

124 
	}
}

127 
	$ffs_bô
(
uöt32_t
 
vÆue
)

129 
ªt
 = 0;

131 #i‡
	`deföed
(
HOST_I386
)

132 
__asm__
 
	`__vﬁ©ûe__
 ("bs‡%1, %0\n" : "+r" (
ªt
Ë: "rm" (
vÆue
));

133  
ªt
;

135 i‡(!
vÆue
)

137 i‡(!(
vÆue
 & 0xffff))

138 
vÆue
 >>16, 
ªt
 = 16;

139 i‡(!(
vÆue
 & 0xff))

140 
vÆue
 >>8, 
ªt
 += 8;

141 i‡(!(
vÆue
 & 0xf))

142 
vÆue
 >>4, 
ªt
 += 4;

143 i‡(!(
vÆue
 & 0x3))

144 
vÆue
 >>2, 
ªt
 += 2;

145 i‡(!(
vÆue
 & 0x1))

146 
ªt
++;

147  
ªt
;

149 
	}
}

151 
ölöe
 
	$£t_bô
(
uöt32_t
 *
èb
, 
ödex
)

153 
i
, 
mask
;

154 
i
 = 
ödex
 >> 5;

155 
mask
 = 1 << (
ödex
 & 0x1f);

156 
èb
[
i
] |
mask
;

157 
	}
}

159 
ölöe
 
	$ª£t_bô
(
uöt32_t
 *
èb
, 
ödex
)

161 
i
, 
mask
;

162 
i
 = 
ödex
 >> 5;

163 
mask
 = 1 << (
ödex
 & 0x1f);

164 
èb
[
i
] &~
mask
;

165 
	}
}

167 
	#f‹óch_≠ic
(
≠ic
, 
dñivî_bômask
, 
code
) \

169 
__i
, 
__j
, 
__mask
;\

170 
__i
 = 0; __ò< 
MAX_APIC_WORDS
; __i++) {\

171 
__mask
 = 
dñivî_bômask
[
__i
];\

172 i‡(
__mask
) {\

173 
__j
 = 0; __j < 32; __j++) {\

174 i‡(
__mask
 & (1 << 
__j
)) {\

175 
≠ic
 = 
loˇl_≠ics
[
__i
 * 32 + 
__j
];\

176 i‡(
≠ic
) {\

177 
code
;\

183 }

	)

185 
	$≠ic_bus_dñivî
(c⁄° 
uöt32_t
 *
dñivî_bômask
,

186 
uöt8_t
 
dñivîy_mode
,

187 
uöt8_t
 
ve˘‹_num
, uöt8_à
pﬁ¨ôy
,

188 
uöt8_t
 
åiggî_mode
)

190 
APICSèã
 *
≠ic_ôî
;

192 
dñivîy_mode
) {

193 
APIC_DM_LOWPRI
:

196 
i
, 
d
;

197 
d
 = -1;

198 
i
 = 0; i < 
MAX_APIC_WORDS
; i++) {

199 i‡(
dñivî_bômask
[
i
]) {

200 
d
 = 
i
 * 32 + 
	`ffs_bô
(
dñivî_bômask
[i]);

204 i‡(
d
 >= 0) {

205 
≠ic_ôî
 = 
loˇl_≠ics
[
d
];

206 i‡(
≠ic_ôî
) {

207 
	`≠ic_£t_úq
(
≠ic_ôî
, 
ve˘‹_num
, 
åiggî_mode
);

213 
APIC_DM_FIXED
:

216 
APIC_DM_SMI
:

217 
APIC_DM_NMI
:

220 
APIC_DM_INIT
:

222 
	`f‹óch_≠ic
(
≠ic_ôî
, 
dñivî_bômask
,

223 
	`≠ic_öô_ùi
(
≠ic_ôî
) );

226 
APIC_DM_EXTINT
:

234 
	`f‹óch_≠ic
(
≠ic_ôî
, 
dñivî_bômask
,

235 
	`≠ic_£t_úq
(
≠ic_ôî
, 
ve˘‹_num
, 
åiggî_mode
) );

236 
	}
}

238 
	$˝u_£t_≠ic_ba£
(
CPUSèã
 *
ív
, 
uöt64_t
 
vÆ
)

240 
APICSèã
 *
s
 = 
ív
->
≠ic_°©e
;

241 #ifde‡
DEBUG_APIC


242 
	`¥ötf
("˝u_£t_≠ic_ba£: %016" 
PRIx64
 "\n", 
vÆ
);

244 
s
->
≠icba£
 = (
vÆ
 & 0xfffff000) |

245 (
s
->
≠icba£
 & (
MSR_IA32_APICBASE_BSP
 | 
MSR_IA32_APICBASE_ENABLE
));

247 i‡(!(
vÆ
 & 
MSR_IA32_APICBASE_ENABLE
)) {

248 
s
->
≠icba£
 &~
MSR_IA32_APICBASE_ENABLE
;

249 
ív
->
˝uid_„©uªs
 &~
CPUID_APIC
;

250 
s
->
•urious_vec
 &~
APIC_SV_ENABLE
;

252 
	}
}

254 
uöt64_t
 
	$˝u_gë_≠ic_ba£
(
CPUSèã
 *
ív
)

256 
APICSèã
 *
s
 = 
ív
->
≠ic_°©e
;

257 #ifde‡
DEBUG_APIC


258 
	`¥ötf
("˝u_gë_≠ic_ba£: %016" 
PRIx64
 "\n", (
uöt64_t
)
s
->
≠icba£
);

260  
s
->
≠icba£
;

261 
	}
}

263 
	$˝u_£t_≠ic_çr
(
CPUX86Sèã
 *
ív
, 
uöt8_t
 
vÆ
)

265 
APICSèã
 *
s
 = 
ív
->
≠ic_°©e
;

266 
s
->
çr
 = (
vÆ
 & 0x0f) << 4;

267 
	`≠ic_upd©e_úq
(
s
);

268 
	}
}

270 
uöt8_t
 
	$˝u_gë_≠ic_çr
(
CPUX86Sèã
 *
ív
)

272 
APICSèã
 *
s
 = 
ív
->
≠ic_°©e
;

273  
s
->
çr
 >> 4;

274 
	}
}

277 
	$gë_highe°_¥i‹ôy_öt
(
uöt32_t
 *
èb
)

279 
i
;

280 
i
 = 7; i >= 0; i--) {

281 i‡(
èb
[
i
] != 0) {

282  
i
 * 32 + 
	`Ês_bô
(
èb
[i]);

286 
	}
}

288 
	$≠ic_gë_µr
(
APICSèã
 *
s
)

290 
çr
, 
i§v
, 
µr
;

292 
çr
 = (
s
->tpr >> 4);

293 
i§v
 = 
	`gë_highe°_¥i‹ôy_öt
(
s
->
i§
);

294 i‡(
i§v
 < 0)

295 
i§v
 = 0;

296 
i§v
 >>= 4;

297 i‡(
çr
 >
i§v
)

298 
µr
 = 
s
->
çr
;

300 
µr
 = 
i§v
 << 4;

301  
µr
;

302 
	}
}

304 
	$≠ic_gë_¨b_¥i
(
APICSèã
 *
s
)

308 
	}
}

311 
	$≠ic_upd©e_úq
(
APICSèã
 *
s
)

313 
úrv
, 
µr
;

314 i‡(!(
s
->
•urious_vec
 & 
APIC_SV_ENABLE
))

316 
úrv
 = 
	`gë_highe°_¥i‹ôy_öt
(
s
->
úr
);

317 i‡(
úrv
 < 0)

319 
µr
 = 
	`≠ic_gë_µr
(
s
);

320 i‡(
µr
 && (
úrv
 & 0xf0) <= (ppr & 0xf0))

322 
	`˝u_öãºu±
(
s
->
˝u_ív
, 
CPU_INTERRUPT_HARD
);

323 
	}
}

325 
	$≠ic_£t_úq
(
APICSèã
 *
s
, 
ve˘‹_num
, 
åiggî_mode
)

327 
	`£t_bô
(
s
->
úr
, 
ve˘‹_num
);

328 i‡(
åiggî_mode
)

329 
	`£t_bô
(
s
->
tmr
, 
ve˘‹_num
);

331 
	`ª£t_bô
(
s
->
tmr
, 
ve˘‹_num
);

332 
	`≠ic_upd©e_úq
(
s
);

333 
	}
}

335 
	$≠ic_eoi
(
APICSèã
 *
s
)

337 
i§v
;

338 
i§v
 = 
	`gë_highe°_¥i‹ôy_öt
(
s
->
i§
);

339 i‡(
i§v
 < 0)

341 
	`ª£t_bô
(
s
->
i§
, 
i§v
);

344 
	`≠ic_upd©e_úq
(
s
);

345 
	}
}

347 
	$≠ic_gë_dñivîy_bômask
(
uöt32_t
 *
dñivî_bômask
,

348 
uöt8_t
 
de°
, uöt8_à
de°_mode
)

350 
APICSèã
 *
≠ic_ôî
;

351 
i
;

353 i‡(
de°_mode
 == 0) {

354 i‡(
de°
 == 0xff) {

355 
	`mem£t
(
dñivî_bômask
, 0xff, 
MAX_APIC_WORDS
 * (
uöt32_t
));

357 
	`mem£t
(
dñivî_bômask
, 0x00, 
MAX_APIC_WORDS
 * (
uöt32_t
));

358 
	`£t_bô
(
dñivî_bômask
, 
de°
);

362 
	`mem£t
(
dñivî_bômask
, 0x00, 
MAX_APIC_WORDS
 * (
uöt32_t
));

363 
i
 = 0; i < 
MAX_APICS
; i++) {

364 
≠ic_ôî
 = 
loˇl_≠ics
[
i
];

365 i‡(
≠ic_ôî
) {

366 i‡(
≠ic_ôî
->
de°_mode
 == 0xf) {

367 i‡(
de°
 & 
≠ic_ôî
->
log_de°
)

368 
	`£t_bô
(
dñivî_bômask
, 
i
);

369 } i‡(
≠ic_ôî
->
de°_mode
 == 0x0) {

370 i‡((
de°
 & 0xf0Ë=(
≠ic_ôî
->
log_de°
 & 0xf0) &&

371 (
de°
 & 
≠ic_ôî
->
log_de°
 & 0x0f)) {

372 
	`£t_bô
(
dñivî_bômask
, 
i
);

378 
	}
}

381 
	$≠ic_öô_ùi
(
APICSèã
 *
s
)

383 
i
;

385 
s
->
çr
 = 0;

386 
s
->
•urious_vec
 = 0xff;

387 
s
->
log_de°
 = 0;

388 
s
->
de°_mode
 = 0xf;

389 
	`mem£t
(
s
->
i§
, 0, (s->isr));

390 
	`mem£t
(
s
->
tmr
, 0, (s->tmr));

391 
	`mem£t
(
s
->
úr
, 0, (s->irr));

392 
i
 = 0; i < 
APIC_LVT_NB
; i++)

393 
s
->
lvt
[
i
] = 1 << 16;

394 
s
->
e§
 = 0;

395 
	`mem£t
(
s
->
i¸
, 0, (s->icr));

396 
s
->
divide_c⁄f
 = 0;

397 
s
->
cou¡_shi·
 = 0;

398 
s
->
öôül_cou¡
 = 0;

399 
s
->
öôül_cou¡_lﬂd_time
 = 0;

400 
s
->
√xt_time
 = 0;

401 
	}
}

404 
	$≠ic_°¨tup
(
APICSèã
 *
s
, 
ve˘‹_num
)

406 
CPUSèã
 *
ív
 = 
s
->
˝u_ív
;

407 i‡(!(
ív
->
hÊags
 & 
HF_HALTED_MASK
))

409 
ív
->
eù
 = 0;

410 
	`˝u_x86_lﬂd_£g_ˇche
(
ív
, 
R_CS
, 
ve˘‹_num
 << 8, vector_num << 12,

412 
ív
->
hÊags
 &~
HF_HALTED_MASK
;

413 
	}
}

415 
	$≠ic_dñivî
(
APICSèã
 *
s
, 
uöt8_t
 
de°
, uöt8_à
de°_mode
,

416 
uöt8_t
 
dñivîy_mode
, uöt8_à
ve˘‹_num
,

417 
uöt8_t
 
pﬁ¨ôy
, uöt8_à
åiggî_mode
)

419 
uöt32_t
 
dñivî_bômask
[
MAX_APIC_WORDS
];

420 
de°_sh‹th™d
 = (
s
->
i¸
[0] >> 18) & 3;

421 
APICSèã
 *
≠ic_ôî
;

423 
de°_sh‹th™d
) {

425 
	`≠ic_gë_dñivîy_bômask
(
dñivî_bômask
, 
de°
, 
de°_mode
);

428 
	`mem£t
(
dñivî_bômask
, 0x00, (deliver_bitmask));

429 
	`£t_bô
(
dñivî_bômask
, 
s
->
id
);

432 
	`mem£t
(
dñivî_bômask
, 0xff, (deliver_bitmask));

435 
	`mem£t
(
dñivî_bômask
, 0xff, (deliver_bitmask));

436 
	`ª£t_bô
(
dñivî_bômask
, 
s
->
id
);

440 
dñivîy_mode
) {

441 
APIC_DM_INIT
:

443 
åig_mode
 = (
s
->
i¸
[0] >> 15) & 1;

444 
Àvñ
 = (
s
->
i¸
[0] >> 14) & 1;

445 i‡(
Àvñ
 =0 && 
åig_mode
 == 1) {

446 
	`f‹óch_≠ic
(
≠ic_ôî
, 
dñivî_bômask
,

447 
≠ic_ôî
->
¨b_id
 =ápic_ôî->
id
 );

453 
APIC_DM_SIPI
:

454 
	`f‹óch_≠ic
(
≠ic_ôî
, 
dñivî_bômask
,

455 
	`≠ic_°¨tup
(
≠ic_ôî
, 
ve˘‹_num
) );

459 
	`≠ic_bus_dñivî
(
dñivî_bômask
, 
dñivîy_mode
, 
ve˘‹_num
, 
pﬁ¨ôy
,

460 
åiggî_mode
);

461 
	}
}

463 
	$≠ic_gë_öãºu±
(
CPUSèã
 *
ív
)

465 
APICSèã
 *
s
 = 
ív
->
≠ic_°©e
;

466 
öäo
;

470 i‡(!
s
)

472 i‡(!(
s
->
•urious_vec
 & 
APIC_SV_ENABLE
))

476 
öäo
 = 
	`gë_highe°_¥i‹ôy_öt
(
s
->
úr
);

477 i‡(
öäo
 < 0)

479 i‡(
s
->
çr
 && 
öäo
 <= s->tpr)

480  
s
->
•urious_vec
 & 0xff;

481 
	`ª£t_bô
(
s
->
úr
, 
öäo
);

482 
	`£t_bô
(
s
->
i§
, 
öäo
);

483 
	`≠ic_upd©e_úq
(
s
);

484  
öäo
;

485 
	}
}

487 
uöt32_t
 
	$≠ic_gë_cuºít_cou¡
(
APICSèã
 *
s
)

489 
öt64_t
 
d
;

490 
uöt32_t
 
vÆ
;

491 
d
 = (
	`qemu_gë_˛ock
(
vm_˛ock
Ë- 
s
->
öôül_cou¡_lﬂd_time
) >>

492 
s
->
cou¡_shi·
;

493 i‡(
s
->
lvt
[
APIC_LVT_TIMER
] & 
APIC_LVT_TIMER_PERIODIC
) {

495 
vÆ
 = 
s
->
öôül_cou¡
 - (
d
 % ((
uöt64_t
)s->initial_count + 1));

497 i‡(
d
 >
s
->
öôül_cou¡
)

498 
vÆ
 = 0;

500 
vÆ
 = 
s
->
öôül_cou¡
 - 
d
;

502  
vÆ
;

503 
	}
}

505 
	$≠ic_timî_upd©e
(
APICSèã
 *
s
, 
öt64_t
 
cuºít_time
)

507 
öt64_t
 
√xt_time
, 
d
;

509 i‡(!(
s
->
lvt
[
APIC_LVT_TIMER
] & 
APIC_LVT_MASKED
)) {

510 
d
 = (
cuºít_time
 - 
s
->
öôül_cou¡_lﬂd_time
) >>

511 
s
->
cou¡_shi·
;

512 i‡(
s
->
lvt
[
APIC_LVT_TIMER
] & 
APIC_LVT_TIMER_PERIODIC
) {

513 
d
 = ((d / ((
uöt64_t
)
s
->
öôül_cou¡
 + 1)) + 1) * ((uint64_t)s->initial_count + 1);

515 i‡(
d
 >
s
->
öôül_cou¡
)

516 
no_timî
;

517 
d
 = (
uöt64_t
)
s
->
öôül_cou¡
 + 1;

519 
√xt_time
 = 
s
->
öôül_cou¡_lﬂd_time
 + (
d
 << s->
cou¡_shi·
);

520 
	`qemu_mod_timî
(
s
->
timî
, 
√xt_time
);

521 
s
->
√xt_time
 =Çext_time;

523 
no_timî
:

524 
	`qemu_dñ_timî
(
s
->
timî
);

526 
	}
}

528 
	$≠ic_timî
(*
›aque
)

530 
APICSèã
 *
s
 = 
›aque
;

532 i‡(!(
s
->
lvt
[
APIC_LVT_TIMER
] & 
APIC_LVT_MASKED
)) {

533 
	`≠ic_£t_úq
(
s
, s->
lvt
[
APIC_LVT_TIMER
] & 0xff, 
APIC_TRIGGER_EDGE
);

535 
	`≠ic_timî_upd©e
(
s
, s->
√xt_time
);

536 
	}
}

538 
uöt32_t
 
	$≠ic_mem_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

541 
	}
}

543 
uöt32_t
 
	$≠ic_mem_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

546 
	}
}

548 
	$≠ic_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

550 
	}
}

552 
	$≠ic_mem_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

554 
	}
}

556 
uöt32_t
 
	$≠ic_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

558 
CPUSèã
 *
ív
;

559 
APICSèã
 *
s
;

560 
uöt32_t
 
vÆ
;

561 
ödex
;

563 
ív
 = 
˝u_sögÀ_ív
;

564 i‡(!
ív
)

566 
s
 = 
ív
->
≠ic_°©e
;

568 
ödex
 = (
addr
 >> 4) & 0xff;

569 
ödex
) {

571 
vÆ
 = 
s
->
id
 << 24;

574 
vÆ
 = 0x11 | ((
APIC_LVT_NB
 - 1) << 16);

577 
vÆ
 = 
s
->
çr
;

580 
vÆ
 = 
	`≠ic_gë_¨b_¥i
(
s
);

584 
vÆ
 = 
	`≠ic_gë_µr
(
s
);

587 
vÆ
 = 
s
->
log_de°
 << 24;

590 
vÆ
 = 
s
->
de°_mode
 << 28;

593 
vÆ
 = 
s
->
•urious_vec
;

596 
vÆ
 = 
s
->
i§
[
ödex
 & 7];

599 
vÆ
 = 
s
->
tmr
[
ödex
 & 7];

602 
vÆ
 = 
s
->
úr
[
ödex
 & 7];

605 
vÆ
 = 
s
->
e§
;

609 
vÆ
 = 
s
->
i¸
[
ödex
 & 1];

612 
vÆ
 = 
s
->
lvt
[
ödex
 - 0x32];

615 
vÆ
 = 
s
->
öôül_cou¡
;

618 
vÆ
 = 
	`≠ic_gë_cuºít_cou¡
(
s
);

621 
vÆ
 = 
s
->
divide_c⁄f
;

624 
s
->
e§
 |
ESR_ILLEGAL_ADDRESS
;

625 
vÆ
 = 0;

628 #ifde‡
DEBUG_APIC


629 
	`¥ötf
("APICÑód: %08x = %08x\n", (
uöt32_t
)
addr
, 
vÆ
);

631  
vÆ
;

632 
	}
}

634 
	$≠ic_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

636 
CPUSèã
 *
ív
;

637 
APICSèã
 *
s
;

638 
ödex
;

640 
ív
 = 
˝u_sögÀ_ív
;

641 i‡(!
ív
)

643 
s
 = 
ív
->
≠ic_°©e
;

645 #ifde‡
DEBUG_APIC


646 
	`¥ötf
("APIC wrôe: %08x = %08x\n", (
uöt32_t
)
addr
, 
vÆ
);

649 
ödex
 = (
addr
 >> 4) & 0xff;

650 
ödex
) {

652 
s
->
id
 = (
vÆ
 >> 24);

657 
s
->
çr
 = 
vÆ
;

658 
	`≠ic_upd©e_úq
(
s
);

664 
	`≠ic_eoi
(
s
);

667 
s
->
log_de°
 = 
vÆ
 >> 24;

670 
s
->
de°_mode
 = 
vÆ
 >> 28;

673 
s
->
•urious_vec
 = 
vÆ
 & 0x1ff;

674 
	`≠ic_upd©e_úq
(
s
);

682 
s
->
i¸
[0] = 
vÆ
;

683 
	`≠ic_dñivî
(
s
, (s->
i¸
[1] >> 24) & 0xff, (s->icr[0] >> 11) & 1,

684 (
s
->
i¸
[0] >> 8) & 7, (s->icr[0] & 0xff),

685 (
s
->
i¸
[0] >> 14) & 1, (s->icr[0] >> 15) & 1);

688 
s
->
i¸
[1] = 
vÆ
;

692 
n
 = 
ödex
 - 0x32;

693 
s
->
lvt
[
n
] = 
vÆ
;

694 i‡(
n
 =
APIC_LVT_TIMER
)

695 
	`≠ic_timî_upd©e
(
s
, 
	`qemu_gë_˛ock
(
vm_˛ock
));

699 
s
->
öôül_cou¡
 = 
vÆ
;

700 
s
->
öôül_cou¡_lﬂd_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

701 
	`≠ic_timî_upd©e
(
s
, s->
öôül_cou¡_lﬂd_time
);

707 
v
;

708 
s
->
divide_c⁄f
 = 
vÆ
 & 0xb;

709 
v
 = (
s
->
divide_c⁄f
 & 3) | ((s->divide_conf >> 1) & 4);

710 
s
->
cou¡_shi·
 = (
v
 + 1) & 7;

714 
s
->
e§
 |
ESR_ILLEGAL_ADDRESS
;

717 
	}
}

719 
	$≠ic_ßve
(
QEMUFûe
 *
f
, *
›aque
)

721 
APICSèã
 *
s
 = 
›aque
;

722 
i
;

724 
	`qemu_put_be32s
(
f
, &
s
->
≠icba£
);

725 
	`qemu_put_8s
(
f
, &
s
->
id
);

726 
	`qemu_put_8s
(
f
, &
s
->
¨b_id
);

727 
	`qemu_put_8s
(
f
, &
s
->
çr
);

728 
	`qemu_put_be32s
(
f
, &
s
->
•urious_vec
);

729 
	`qemu_put_8s
(
f
, &
s
->
log_de°
);

730 
	`qemu_put_8s
(
f
, &
s
->
de°_mode
);

731 
i
 = 0; i < 8; i++) {

732 
	`qemu_put_be32s
(
f
, &
s
->
i§
[
i
]);

733 
	`qemu_put_be32s
(
f
, &
s
->
tmr
[
i
]);

734 
	`qemu_put_be32s
(
f
, &
s
->
úr
[
i
]);

736 
i
 = 0; i < 
APIC_LVT_NB
; i++) {

737 
	`qemu_put_be32s
(
f
, &
s
->
lvt
[
i
]);

739 
	`qemu_put_be32s
(
f
, &
s
->
e§
);

740 
	`qemu_put_be32s
(
f
, &
s
->
i¸
[0]);

741 
	`qemu_put_be32s
(
f
, &
s
->
i¸
[1]);

742 
	`qemu_put_be32s
(
f
, &
s
->
divide_c⁄f
);

743 
	`qemu_put_be32s
(
f
, &
s
->
cou¡_shi·
);

744 
	`qemu_put_be32s
(
f
, &
s
->
öôül_cou¡
);

745 
	`qemu_put_be64s
(
f
, &
s
->
öôül_cou¡_lﬂd_time
);

746 
	`qemu_put_be64s
(
f
, &
s
->
√xt_time
);

748 
	`qemu_put_timî
(
f
, 
s
->
timî
);

749 
	}
}

751 
	$≠ic_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

753 
APICSèã
 *
s
 = 
›aque
;

754 
i
;

756 i‡(
vîsi⁄_id
 > 2)

757  -
EINVAL
;

760 
	`qemu_gë_be32s
(
f
, &
s
->
≠icba£
);

761 
	`qemu_gë_8s
(
f
, &
s
->
id
);

762 
	`qemu_gë_8s
(
f
, &
s
->
¨b_id
);

763 
	`qemu_gë_8s
(
f
, &
s
->
çr
);

764 
	`qemu_gë_be32s
(
f
, &
s
->
•urious_vec
);

765 
	`qemu_gë_8s
(
f
, &
s
->
log_de°
);

766 
	`qemu_gë_8s
(
f
, &
s
->
de°_mode
);

767 
i
 = 0; i < 8; i++) {

768 
	`qemu_gë_be32s
(
f
, &
s
->
i§
[
i
]);

769 
	`qemu_gë_be32s
(
f
, &
s
->
tmr
[
i
]);

770 
	`qemu_gë_be32s
(
f
, &
s
->
úr
[
i
]);

772 
i
 = 0; i < 
APIC_LVT_NB
; i++) {

773 
	`qemu_gë_be32s
(
f
, &
s
->
lvt
[
i
]);

775 
	`qemu_gë_be32s
(
f
, &
s
->
e§
);

776 
	`qemu_gë_be32s
(
f
, &
s
->
i¸
[0]);

777 
	`qemu_gë_be32s
(
f
, &
s
->
i¸
[1]);

778 
	`qemu_gë_be32s
(
f
, &
s
->
divide_c⁄f
);

779 
	`qemu_gë_be32s
(
f
, &
s
->
cou¡_shi·
);

780 
	`qemu_gë_be32s
(
f
, &
s
->
öôül_cou¡
);

781 
	`qemu_gë_be64s
(
f
, &
s
->
öôül_cou¡_lﬂd_time
);

782 
	`qemu_gë_be64s
(
f
, &
s
->
√xt_time
);

784 i‡(
vîsi⁄_id
 >= 2)

785 
	`qemu_gë_timî
(
f
, 
s
->
timî
);

787 
	}
}

789 
	$≠ic_ª£t
(*
›aque
)

791 
APICSèã
 *
s
 = 
›aque
;

792 
	`≠ic_öô_ùi
(
s
);

793 
	}
}

795 
CPURódMem‹yFunc
 *
	g≠ic_mem_ªad
[3] = {

796 
≠ic_mem_ªadb
,

797 
≠ic_mem_ªadw
,

798 
≠ic_mem_ªadl
,

801 
CPUWrôeMem‹yFunc
 *
	g≠ic_mem_wrôe
[3] = {

802 
≠ic_mem_wrôeb
,

803 
≠ic_mem_wrôew
,

804 
≠ic_mem_wrôñ
,

807 
	$≠ic_öô
(
CPUSèã
 *
ív
)

809 
APICSèã
 *
s
;

811 i‡(
œ°_≠ic_id
 >
MAX_APICS
)

813 
s
 = 
	`qemu_mÆlocz
((
APICSèã
));

814 i‡(!
s
)

816 
ív
->
≠ic_°©e
 = 
s
;

817 
	`≠ic_öô_ùi
(
s
);

818 
s
->
id
 = 
œ°_≠ic_id
++;

819 
s
->
˝u_ív
 = 
ív
;

820 
s
->
≠icba£
 = 0xfee00000 |

821 (
s
->
id
 ? 0 : 
MSR_IA32_APICBASE_BSP
Ë| 
MSR_IA32_APICBASE_ENABLE
;

824 i‡(
≠ic_io_mem‹y
 == 0) {

827 
≠ic_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
≠ic_mem_ªad
,

828 
≠ic_mem_wrôe
, 
NULL
);

829 
	`˝u_ªgi°î_physiˇl_mem‹y
(
s
->
≠icba£
 & ~0xfff, 0x1000,

830 
≠ic_io_mem‹y
);

832 
s
->
timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
≠ic_timî
, s);

834 
	`ªgi°î_ßvevm
("≠ic", 0, 2, 
≠ic_ßve
, 
≠ic_lﬂd
, 
s
);

835 
	`qemu_ªgi°î_ª£t
(
≠ic_ª£t
, 
s
);

837 
loˇl_≠ics
[
s
->
id
] = s;

839 
	}
}

841 
	$iﬂpic_£rvi˚
(
IOAPICSèã
 *
s
)

843 
uöt8_t
 
i
;

844 
uöt8_t
 
åig_mode
;

845 
uöt8_t
 
ve˘‹
;

846 
uöt8_t
 
dñivîy_mode
;

847 
uöt32_t
 
mask
;

848 
uöt64_t
 
íåy
;

849 
uöt8_t
 
de°
;

850 
uöt8_t
 
de°_mode
;

851 
uöt8_t
 
pﬁ¨ôy
;

852 
uöt32_t
 
dñivî_bômask
[
MAX_APIC_WORDS
];

854 
i
 = 0; i < 
IOAPIC_NUM_PINS
; i++) {

855 
mask
 = 1 << 
i
;

856 i‡(
s
->
úr
 & 
mask
) {

857 
íåy
 = 
s
->
i‹edtbl
[
i
];

858 i‡(!(
íåy
 & 
APIC_LVT_MASKED
)) {

859 
åig_mode
 = ((
íåy
 >> 15) & 1);

860 
de°
 = 
íåy
 >> 56;

861 
de°_mode
 = (
íåy
 >> 11) & 1;

862 
dñivîy_mode
 = (
íåy
 >> 8) & 7;

863 
pﬁ¨ôy
 = (
íåy
 >> 13) & 1;

864 i‡(
åig_mode
 =
APIC_TRIGGER_EDGE
)

865 
s
->
úr
 &~
mask
;

866 i‡(
dñivîy_mode
 =
APIC_DM_EXTINT
)

867 
ve˘‹
 = 
	`pic_ªad_úq
(
iß_pic
);

869 
ve˘‹
 = 
íåy
 & 0xff;

871 
	`≠ic_gë_dñivîy_bômask
(
dñivî_bômask
, 
de°
, 
de°_mode
);

872 
	`≠ic_bus_dñivî
(
dñivî_bômask
, 
dñivîy_mode
,

873 
ve˘‹
, 
pﬁ¨ôy
, 
åig_mode
);

877 
	}
}

879 
	$iﬂpic_£t_úq
(*
›aque
, 
ve˘‹
, 
Àvñ
)

881 
IOAPICSèã
 *
s
 = 
›aque
;

883 i‡(
ve˘‹
 >0 && ve˘‹ < 
IOAPIC_NUM_PINS
) {

884 
uöt32_t
 
mask
 = 1 << 
ve˘‹
;

885 
uöt64_t
 
íåy
 = 
s
->
i‹edtbl
[
ve˘‹
];

887 i‡((
íåy
 >> 15) & 1) {

889 i‡(
Àvñ
) {

890 
s
->
úr
 |
mask
;

891 
	`iﬂpic_£rvi˚
(
s
);

893 
s
->
úr
 &~
mask
;

897 i‡(
Àvñ
) {

898 
s
->
úr
 |
mask
;

899 
	`iﬂpic_£rvi˚
(
s
);

903 
	}
}

905 
uöt32_t
 
	$iﬂpic_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

907 
IOAPICSèã
 *
s
 = 
›aque
;

908 
ödex
;

909 
uöt32_t
 
vÆ
 = 0;

911 
addr
 &= 0xff;

912 i‡(
addr
 == 0x00) {

913 
vÆ
 = 
s
->
i‹eg£l
;

914 } i‡(
addr
 == 0x10) {

915 
s
->
i‹eg£l
) {

917 
vÆ
 = 
s
->
id
 << 24;

920 
vÆ
 = 0x11 | ((
IOAPIC_NUM_PINS
 - 1) << 16);

923 
vÆ
 = 0;

926 
ödex
 = (
s
->
i‹eg£l
 - 0x10) >> 1;

927 i‡(
ödex
 >0 && index < 
IOAPIC_NUM_PINS
) {

928 i‡(
s
->
i‹eg£l
 & 1)

929 
vÆ
 = 
s
->
i‹edtbl
[
ödex
] >> 32;

931 
vÆ
 = 
s
->
i‹edtbl
[
ödex
] & 0xffffffff;

934 #ifde‡
DEBUG_IOAPIC


935 
	`¥ötf
("I/O APICÑód: %08x = %08x\n", 
s
->
i‹eg£l
, 
vÆ
);

938  
vÆ
;

939 
	}
}

941 
	$iﬂpic_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

943 
IOAPICSèã
 *
s
 = 
›aque
;

944 
ödex
;

946 
addr
 &= 0xff;

947 i‡(
addr
 == 0x00) {

948 
s
->
i‹eg£l
 = 
vÆ
;

950 } i‡(
addr
 == 0x10) {

951 #ifde‡
DEBUG_IOAPIC


952 
	`¥ötf
("I/O APIC wrôe: %08x = %08x\n", 
s
->
i‹eg£l
, 
vÆ
);

954 
s
->
i‹eg£l
) {

956 
s
->
id
 = (
vÆ
 >> 24) & 0xff;

962 
ödex
 = (
s
->
i‹eg£l
 - 0x10) >> 1;

963 i‡(
ödex
 >0 && index < 
IOAPIC_NUM_PINS
) {

964 i‡(
s
->
i‹eg£l
 & 1) {

965 
s
->
i‹edtbl
[
ödex
] &= 0xffffffff;

966 
s
->
i‹edtbl
[
ödex
] |(
uöt64_t
)
vÆ
 << 32;

968 
s
->
i‹edtbl
[
ödex
] &= ~0xffffffffULL;

969 
s
->
i‹edtbl
[
ödex
] |
vÆ
;

971 
	`iﬂpic_£rvi˚
(
s
);

975 
	}
}

977 
	$iﬂpic_ßve
(
QEMUFûe
 *
f
, *
›aque
)

979 
IOAPICSèã
 *
s
 = 
›aque
;

980 
i
;

982 
	`qemu_put_8s
(
f
, &
s
->
id
);

983 
	`qemu_put_8s
(
f
, &
s
->
i‹eg£l
);

984 
i
 = 0; i < 
IOAPIC_NUM_PINS
; i++) {

985 
	`qemu_put_be64s
(
f
, &
s
->
i‹edtbl
[
i
]);

987 
	}
}

989 
	$iﬂpic_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

991 
IOAPICSèã
 *
s
 = 
›aque
;

992 
i
;

994 i‡(
vîsi⁄_id
 != 1)

995  -
EINVAL
;

997 
	`qemu_gë_8s
(
f
, &
s
->
id
);

998 
	`qemu_gë_8s
(
f
, &
s
->
i‹eg£l
);

999 
i
 = 0; i < 
IOAPIC_NUM_PINS
; i++) {

1000 
	`qemu_gë_be64s
(
f
, &
s
->
i‹edtbl
[
i
]);

1003 
	}
}

1005 
	$iﬂpic_ª£t
(*
›aque
)

1007 
IOAPICSèã
 *
s
 = 
›aque
;

1008 
i
;

1010 
	`mem£t
(
s
, 0, (*s));

1011 
i
 = 0; i < 
IOAPIC_NUM_PINS
; i++)

1012 
s
->
i‹edtbl
[
i
] = 1 << 16;

1013 
	}
}

1015 
CPURódMem‹yFunc
 *
	giﬂpic_mem_ªad
[3] = {

1016 
iﬂpic_mem_ªadl
,

1017 
iﬂpic_mem_ªadl
,

1018 
iﬂpic_mem_ªadl
,

1021 
CPUWrôeMem‹yFunc
 *
	giﬂpic_mem_wrôe
[3] = {

1022 
iﬂpic_mem_wrôñ
,

1023 
iﬂpic_mem_wrôñ
,

1024 
iﬂpic_mem_wrôñ
,

1027 
IOAPICSèã
 *
	$iﬂpic_öô
()

1029 
IOAPICSèã
 *
s
;

1030 
io_mem‹y
;

1032 
s
 = 
	`qemu_mÆlocz
((
IOAPICSèã
));

1033 i‡(!
s
)

1034  
NULL
;

1035 
	`iﬂpic_ª£t
(
s
);

1036 
s
->
id
 = 
œ°_≠ic_id
++;

1038 
io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
iﬂpic_mem_ªad
,

1039 
iﬂpic_mem_wrôe
, 
s
);

1040 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x„c00000, 0x1000, 
io_mem‹y
);

1042 
	`ªgi°î_ßvevm
("iﬂpic", 0, 1, 
iﬂpic_ßve
, 
iﬂpic_lﬂd
, 
s
);

1043 
	`qemu_ªgi°î_ª£t
(
iﬂpic_ª£t
, 
s
);

1045  
s
;

1046 
	}
}

	@arm_boot.c

10 
	~"vl.h
"

12 
	#KERNEL_ARGS_ADDR
 0x100

	)

13 
	#KERNEL_LOAD_ADDR
 0x00010000

	)

14 
	#INITRD_LOAD_ADDR
 0x00800000

	)

17 
uöt32_t
 
	gboŸlﬂdî
[] = {

27 
	$£t_kî√l_¨gs
(
uöt32_t
 
øm_size
, 
öôrd_size
,

28 c⁄° *
kî√l_cmdlöe
)

30 
uöt32_t
 *
p
;

32 
p
 = (
uöt32_t
 *)(
phys_øm_ba£
 + 
KERNEL_ARGS_ADDR
);

34 
	`°l_øw
(
p
++, 5);

35 
	`°l_øw
(
p
++, 0x54410001);

36 
	`°l_øw
(
p
++, 1);

37 
	`°l_øw
(
p
++, 0x1000);

38 
	`°l_øw
(
p
++, 0);

40 
	`°l_øw
(
p
++, 4);

41 
	`°l_øw
(
p
++, 0x54410002);

42 
	`°l_øw
(
p
++, 
øm_size
);

43 
	`°l_øw
(
p
++, 0);

44 i‡(
öôrd_size
) {

46 
	`°l_øw
(
p
++, 4);

47 
	`°l_øw
(
p
++, 0x54420005);

48 
	`°l_øw
(
p
++, 
INITRD_LOAD_ADDR
);

49 
	`°l_øw
(
p
++, 
öôrd_size
);

51 i‡(
kî√l_cmdlöe
 && *kernel_cmdline) {

53 
cmdlöe_size
;

55 
cmdlöe_size
 = 
	`°æí
(
kî√l_cmdlöe
);

56 
	`mem˝y
 (
p
 + 2, 
kî√l_cmdlöe
, 
cmdlöe_size
 + 1);

57 
cmdlöe_size
 = (cmdline_size >> 2) + 1;

58 
	`°l_øw
(
p
++, 
cmdlöe_size
 + 2);

59 
	`°l_øw
(
p
++, 0x54410009);

60 
p
 +
cmdlöe_size
;

63 
	`°l_øw
(
p
++, 0);

64 
	`°l_øw
(
p
++, 0);

65 
	}
}

67 
	$¨m_lﬂd_kî√l
(
CPUSèã
 *
ív
, 
øm_size
, c⁄° *
kî√l_fûíame
,

68 c⁄° *
kî√l_cmdlöe
, c⁄° *
öôrd_fûíame
,

69 
bﬂrd_id
)

71 
kî√l_size
;

72 
öôrd_size
;

73 
n
;

74 
uöt64_t
 
íåy
;

77 i‡(!
kî√l_fûíame
) {

78 
	`Ârötf
(
°dîr
, "Kernel image must be specified\n");

79 
	`exô
(1);

82 
kî√l_size
 = 
	`lﬂd_ñf
(
kî√l_fûíame
, 0, &
íåy
);

83 i‡(
kî√l_size
 >= 0) {

85 
ív
->
ªgs
[15] = 
íåy
 & 0xfffffffe;

86 
ív
->
thumb
 = 
íåy
 & 1;

89 
kî√l_size
 = 
	`lﬂd_image
(
kî√l_fûíame
,

90 
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
);

91 i‡(
kî√l_size
 < 0) {

92 
	`Ârötf
(
°dîr
, "qemu: couldÇŸÜﬂd kî√»'%s'\n", 
kî√l_fûíame
);

93 
	`exô
(1);

95 i‡(
öôrd_fûíame
) {

96 
öôrd_size
 = 
	`lﬂd_image
(
öôrd_fûíame
,

97 
phys_øm_ba£
 + 
INITRD_LOAD_ADDR
);

98 i‡(
öôrd_size
 < 0) {

99 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad initrd '%s'\n",

100 
öôrd_fûíame
);

101 
	`exô
(1);

104 
öôrd_size
 = 0;

106 
boŸlﬂdî
[1] |
bﬂrd_id
 & 0xff;

107 
boŸlﬂdî
[2] |(
bﬂrd_id
 >> 8) & 0xff;

108 
boŸlﬂdî
[5] = 
KERNEL_ARGS_ADDR
;

109 
boŸlﬂdî
[6] = 
KERNEL_LOAD_ADDR
;

110 
n
 = 0;Ç < (
boŸlﬂdî
) / 4;Ç++)

111 
	`°l_øw
(
phys_øm_ba£
 + (
n
 * 4), 
boŸlﬂdî
[n]);

112 
	`£t_kî√l_¨gs
(
øm_size
, 
öôrd_size
, 
kî√l_cmdlöe
);

114 
	}
}

	@arm_gic.c

13 
	~"vl.h
"

14 
	~"¨m_pic.h
"

18 #ifde‡
DEBUG_GIC


19 
	#DPRINTF
(
fmt
, 
¨gs
...) \

20 dÿ{ 
	`¥ötf
("¨m_gic: " 
fmt
 , ##
¨gs
); } 0)

	)

22 
	#DPRINTF
(
fmt
, 
¨gs
...Ëdÿ{} 0)

	)

27 c⁄° 
uöt8_t
 
	ggic_id
[] =

30 
	#GIC_NIRQ
 96

	)

32 
	sgic_úq_°©e


34 
	míabÀd
:1;

35 
	m≥ndög
:1;

36 
	ma˘ive
:1;

37 
	mÀvñ
:1;

38 
	mmodñ
:1;

39 
	måiggî
:1;

40 } 
	tgic_úq_°©e
;

42 
	#GIC_SET_ENABLED
(
úq
Ë
s
->
úq_°©e
[úq].
íabÀd
 = 1

	)

43 
	#GIC_CLEAR_ENABLED
(
úq
Ë
s
->
úq_°©e
[úq].
íabÀd
 = 0

	)

44 
	#GIC_TEST_ENABLED
(
úq
Ë
s
->
úq_°©e
[úq].
íabÀd


	)

45 
	#GIC_SET_PENDING
(
úq
Ë
s
->
úq_°©e
[úq].
≥ndög
 = 1

	)

46 
	#GIC_CLEAR_PENDING
(
úq
Ë
s
->
úq_°©e
[úq].
≥ndög
 = 0

	)

47 
	#GIC_TEST_PENDING
(
úq
Ë
s
->
úq_°©e
[úq].
≥ndög


	)

48 
	#GIC_SET_ACTIVE
(
úq
Ë
s
->
úq_°©e
[úq].
a˘ive
 = 1

	)

49 
	#GIC_CLEAR_ACTIVE
(
úq
Ë
s
->
úq_°©e
[úq].
a˘ive
 = 0

	)

50 
	#GIC_TEST_ACTIVE
(
úq
Ë
s
->
úq_°©e
[úq].
a˘ive


	)

51 
	#GIC_SET_MODEL
(
úq
Ë
s
->
úq_°©e
[úq].
modñ
 = 1

	)

52 
	#GIC_CLEAR_MODEL
(
úq
Ë
s
->
úq_°©e
[úq].
modñ
 = 0

	)

53 
	#GIC_TEST_MODEL
(
úq
Ë
s
->
úq_°©e
[úq].
modñ


	)

54 
	#GIC_SET_LEVEL
(
úq
Ë
s
->
úq_°©e
[úq].
Àvñ
 = 1

	)

55 
	#GIC_CLEAR_LEVEL
(
úq
Ë
s
->
úq_°©e
[úq].
Àvñ
 = 0

	)

56 
	#GIC_TEST_LEVEL
(
úq
Ë
s
->
úq_°©e
[úq].
Àvñ


	)

57 
	#GIC_SET_TRIGGER
(
úq
Ë
s
->
úq_°©e
[úq].
åiggî
 = 1

	)

58 
	#GIC_CLEAR_TRIGGER
(
úq
Ë
s
->
úq_°©e
[úq].
åiggî
 = 0

	)

59 
	#GIC_TEST_TRIGGER
(
úq
Ë
s
->
úq_°©e
[úq].
åiggî


	)

61 
	sgic_°©e


63 
¨m_pic_h™dÀr
 
	mh™dÀr
;

64 
uöt32_t
 
	mba£
;

65 *
	m∑ª¡
;

66 
	m∑ª¡_úq
;

67 
	míabÀd
;

68 
	m˝u_íabÀd
;

70 
gic_úq_°©e
 
	múq_°©e
[
GIC_NIRQ
];

71 
	múq_èrgë
[
GIC_NIRQ
];

72 
	m¥i‹ôy
[
GIC_NIRQ
];

73 
	mœ°_a˘ive
[
GIC_NIRQ
];

75 
	m¥i‹ôy_mask
;

76 
	mru¬ög_úq
;

77 
	mru¬ög_¥i‹ôy
;

78 
	mcuºít_≥ndög
;

79 } 
	tgic_°©e
;

83 
	$gic_upd©e
(
gic_°©e
 *
s
)

85 
be°_úq
;

86 
be°_¥io
;

87 
úq
;

89 
s
->
cuºít_≥ndög
 = 1023;

90 i‡(!
s
->
íabÀd
 || !s->
˝u_íabÀd
) {

91 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
∑ª¡_úq
, 0);

94 
be°_¥io
 = 0x100;

95 
be°_úq
 = 1023;

96 
úq
 = 0; irq < 96; irq++) {

97 i‡(
	`GIC_TEST_ENABLED
(
úq
Ë&& 
	`GIC_TEST_PENDING
(irq)) {

98 i‡(
s
->
¥i‹ôy
[
úq
] < 
be°_¥io
) {

99 
be°_¥io
 = 
s
->
¥i‹ôy
[
úq
];

100 
be°_úq
 = 
úq
;

104 i‡(
be°_¥io
 > 
s
->
¥i‹ôy_mask
) {

105 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
∑ª¡_úq
, 0);

107 
s
->
cuºít_≥ndög
 = 
be°_úq
;

108 i‡(
be°_¥io
 < 
s
->
ru¬ög_¥i‹ôy
) {

109 
	`DPRINTF
("Rai£dÖídög IRQ %d\n", 
be°_úq
);

110 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
∑ª¡_úq
, 1);

113 
	}
}

115 
	$gic_£t_úq
(*
›aque
, 
úq
, 
Àvñ
)

117 
gic_°©e
 *
s
 = (gic_°©ê*)
›aque
;

119 
úq
 += 32;

120 i‡(
Àvñ
 =
	`GIC_TEST_LEVEL
(
úq
))

123 i‡(
Àvñ
) {

124 
	`GIC_SET_LEVEL
(
úq
);

125 i‡(
	`GIC_TEST_TRIGGER
(
úq
Ë|| 
	`GIC_TEST_ENABLED
(irq)) {

126 
	`DPRINTF
("Së %dÖídög\n", 
úq
);

127 
	`GIC_SET_PENDING
(
úq
);

130 
	`GIC_CLEAR_LEVEL
(
úq
);

132 
	`gic_upd©e
(
s
);

133 
	}
}

135 
	$gic_£t_ru¬ög_úq
(
gic_°©e
 *
s
, 
úq
)

137 
s
->
ru¬ög_úq
 = 
úq
;

138 i‡(
úq
 == 1023)

139 
s
->
ru¬ög_¥i‹ôy
 = 0x100;

141 
s
->
ru¬ög_¥i‹ôy
 = s->
¥i‹ôy
[
úq
];

142 
	`gic_upd©e
(
s
);

143 
	}
}

145 
uöt32_t
 
	$gic_acknowÀdge_úq
(
gic_°©e
 *
s
)

147 
√w_úq
;

148 
√w_úq
 = 
s
->
cuºít_≥ndög
;

149 i‡(
√w_úq
 =1023 || 
s
->
¥i‹ôy
[√w_úq] >s->
ru¬ög_¥i‹ôy
) {

150 
	`DPRINTF
("ACKÇoÖending IRQ\n");

153 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
∑ª¡_úq
, 0);

154 
s
->
œ°_a˘ive
[
√w_úq
] = s->
ru¬ög_úq
;

157 
	`GIC_CLEAR_PENDING
(
√w_úq
);

158 
	`gic_£t_ru¬ög_úq
(
s
, 
√w_úq
);

159 
	`DPRINTF
("ACK %d\n", 
√w_úq
);

160  
√w_úq
;

161 
	}
}

163 
	$gic_com∂ëe_úq
(
gic_°©e
 * 
s
, 
úq
)

165 
upd©e
 = 0;

166 
	`DPRINTF
("EOI %d\n", 
úq
);

167 i‡(
s
->
ru¬ög_úq
 == 1023)

169 i‡(
úq
 != 1023) {

172 i‡(!
	`GIC_TEST_TRIGGER
(
úq
Ë&& 
	`GIC_TEST_ENABLED
(irq)

173 && 
	`GIC_TEST_LEVEL
(
úq
)) {

174 
	`GIC_SET_PENDING
(
úq
);

175 
upd©e
 = 1;

178 i‡(
úq
 !
s
->
ru¬ög_úq
) {

180 
tmp
 = 
s
->
ru¬ög_úq
;

181 
s
->
œ°_a˘ive
[
tmp
] != 1023) {

182 i‡(
s
->
œ°_a˘ive
[
tmp
] =
úq
) {

183 
s
->
œ°_a˘ive
[
tmp
] = s->œ°_a˘ive[
úq
];

186 
tmp
 = 
s
->
œ°_a˘ive
[tmp];

188 i‡(
upd©e
) {

189 
	`gic_upd©e
(
s
);

193 
	`gic_£t_ru¬ög_úq
(
s
, s->
œ°_a˘ive
[s->
ru¬ög_úq
]);

195 
	}
}

197 
uöt32_t
 
	$gic_di°_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

199 
gic_°©e
 *
s
 = (gic_°©ê*)
›aque
;

200 
uöt32_t
 
ªs
;

201 
úq
;

202 
i
;

204 
off£t
 -
s
->
ba£
 + 0x1000;

205 i‡(
off£t
 < 0x100) {

206 i‡(
off£t
 == 0)

207  
s
->
íabÀd
;

208 i‡(
off£t
 == 4)

209  (
GIC_NIRQ
 / 32) - 1;

210 i‡(
off£t
 < 0x08)

212 
bad_ªg
;

213 } i‡(
off£t
 < 0x200) {

215 i‡(
off£t
 < 0x180)

216 
úq
 = (
off£t
 - 0x100) * 8;

218 
úq
 = (
off£t
 - 0x180) * 8;

219 i‡(
úq
 >
GIC_NIRQ
)

220 
bad_ªg
;

221 
ªs
 = 0;

222 
i
 = 0; i < 8; i++) {

223 i‡(
	`GIC_TEST_ENABLED
(
úq
 + 
i
)) {

224 
ªs
 |(1 << 
i
);

227 } i‡(
off£t
 < 0x300) {

229 i‡(
off£t
 < 0x280)

230 
úq
 = (
off£t
 - 0x200) * 8;

232 
úq
 = (
off£t
 - 0x280) * 8;

233 i‡(
úq
 >
GIC_NIRQ
)

234 
bad_ªg
;

235 
ªs
 = 0;

236 
i
 = 0; i < 8; i++) {

237 i‡(
	`GIC_TEST_PENDING
(
úq
 + 
i
)) {

238 
ªs
 |(1 << 
i
);

241 } i‡(
off£t
 < 0x400) {

243 
úq
 = (
off£t
 - 0x300) * 8;

244 i‡(
úq
 >
GIC_NIRQ
)

245 
bad_ªg
;

246 
ªs
 = 0;

247 
i
 = 0; i < 8; i++) {

248 i‡(
	`GIC_TEST_ACTIVE
(
úq
 + 
i
)) {

249 
ªs
 |(1 << 
i
);

252 } i‡(
off£t
 < 0x800) {

254 
úq
 = 
off£t
 - 0x400;

255 i‡(
úq
 >
GIC_NIRQ
)

256 
bad_ªg
;

257 
ªs
 = 
s
->
¥i‹ôy
[
úq
];

258 } i‡(
off£t
 < 0xc00) {

260 
úq
 = 
off£t
 - 0x800;

261 i‡(
úq
 >
GIC_NIRQ
)

262 
bad_ªg
;

263 
ªs
 = 
s
->
úq_èrgë
[
úq
];

264 } i‡(
off£t
 < 0xf00) {

266 
úq
 = (
off£t
 - 0xc00) * 2;

267 i‡(
úq
 >
GIC_NIRQ
)

268 
bad_ªg
;

269 
ªs
 = 0;

270 
i
 = 0; i < 4; i++) {

271 i‡(
	`GIC_TEST_MODEL
(
úq
 + 
i
))

272 
ªs
 |(1 << (
i
 * 2));

273 i‡(
	`GIC_TEST_TRIGGER
(
úq
 + 
i
))

274 
ªs
 |(2 << (
i
 * 2));

276 } i‡(
off£t
 < 0xfe0) {

277 
bad_ªg
;

279 i‡(
off£t
 & 3) {

280 
ªs
 = 0;

282 
ªs
 = 
gic_id
[(
off£t
 - 0xfe0) >> 2];

285  
ªs
;

286 
bad_ªg
:

287 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "gic_di°_ªadb: Bad off£à%x\n", 
off£t
);

289 
	}
}

291 
uöt32_t
 
	$gic_di°_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

293 
uöt32_t
 
vÆ
;

294 
vÆ
 = 
	`gic_di°_ªadb
(
›aque
, 
off£t
);

295 
vÆ
 |
	`gic_di°_ªadb
(
›aque
, 
off£t
 + 1) << 8;

296  
vÆ
;

297 
	}
}

299 
uöt32_t
 
	$gic_di°_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

301 
uöt32_t
 
vÆ
;

302 
vÆ
 = 
	`gic_di°_ªadw
(
›aque
, 
off£t
);

303 
vÆ
 |
	`gic_di°_ªadw
(
›aque
, 
off£t
 + 2) << 16;

304  
vÆ
;

305 
	}
}

307 
	$gic_di°_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

308 
uöt32_t
 
vÆue
)

310 
gic_°©e
 *
s
 = (gic_°©ê*)
›aque
;

311 
úq
;

312 
i
;

314 
off£t
 -
s
->
ba£
 + 0x1000;

315 i‡(
off£t
 < 0x100) {

316 i‡(
off£t
 == 0) {

317 
s
->
íabÀd
 = (
vÆue
 & 1);

318 
	`DPRINTF
("Di°ributi⁄ %ßbÀd\n", 
s
->
íabÀd
 ? "En" : "Dis");

319 } i‡(
off£t
 < 4) {

322 
bad_ªg
;

324 } i‡(
off£t
 < 0x180) {

326 
úq
 = (
off£t
 - 0x100) * 8;

327 i‡(
úq
 >
GIC_NIRQ
)

328 
bad_ªg
;

329 
i
 = 0; i < 8; i++) {

330 i‡(
vÆue
 & (1 << 
i
)) {

331 i‡(!
	`GIC_TEST_ENABLED
(
úq
 + 
i
))

332 
	`DPRINTF
("E«bÀd IRQ %d\n", 
úq
 + 
i
);

333 
	`GIC_SET_ENABLED
(
úq
 + 
i
);

336 i‡(
	`GIC_TEST_LEVEL
(
úq
 + 
i
Ë&& !
	`GIC_TEST_TRIGGER
(irq + i))

337 
	`GIC_SET_PENDING
(
úq
 + 
i
);

340 } i‡(
off£t
 < 0x200) {

342 
úq
 = (
off£t
 - 0x180) * 8;

343 i‡(
úq
 >
GIC_NIRQ
)

344 
bad_ªg
;

345 
i
 = 0; i < 8; i++) {

346 i‡(
vÆue
 & (1 << 
i
)) {

347 i‡(
	`GIC_TEST_ENABLED
(
úq
 + 
i
))

348 
	`DPRINTF
("DißbÀd IRQ %d\n", 
úq
 + 
i
);

349 
	`GIC_CLEAR_ENABLED
(
úq
 + 
i
);

352 } i‡(
off£t
 < 0x280) {

354 
úq
 = (
off£t
 - 0x200) * 8;

355 i‡(
úq
 >
GIC_NIRQ
)

356 
bad_ªg
;

357 
i
 = 0; i < 8; i++) {

358 i‡(
vÆue
 & (1 << 
i
)) {

359 
	`GIC_SET_PENDING
(
úq
 + 
i
);

362 } i‡(
off£t
 < 0x300) {

364 
úq
 = (
off£t
 - 0x280) * 8;

365 i‡(
úq
 >
GIC_NIRQ
)

366 
bad_ªg
;

367 
i
 = 0; i < 8; i++) {

368 i‡(
vÆue
 & (1 << 
i
)) {

369 
	`GIC_CLEAR_PENDING
(
úq
 + 
i
);

372 } i‡(
off£t
 < 0x400) {

374 
bad_ªg
;

375 } i‡(
off£t
 < 0x800) {

377 
úq
 = 
off£t
 - 0x400;

378 i‡(
úq
 >
GIC_NIRQ
)

379 
bad_ªg
;

380 
s
->
¥i‹ôy
[
úq
] = 
vÆue
;

381 } i‡(
off£t
 < 0xc00) {

383 
úq
 = 
off£t
 - 0x800;

384 i‡(
úq
 >
GIC_NIRQ
)

385 
bad_ªg
;

386 
s
->
úq_èrgë
[
úq
] = 
vÆue
;

387 } i‡(
off£t
 < 0xf00) {

389 
úq
 = (
off£t
 - 0xc00) * 4;

390 i‡(
úq
 >
GIC_NIRQ
)

391 
bad_ªg
;

392 
i
 = 0; i < 4; i++) {

393 i‡(
vÆue
 & (1 << (
i
 * 2))) {

394 
	`GIC_SET_MODEL
(
úq
 + 
i
);

396 
	`GIC_CLEAR_MODEL
(
úq
 + 
i
);

398 i‡(
vÆue
 & (2 << (
i
 * 2))) {

399 
	`GIC_SET_TRIGGER
(
úq
 + 
i
);

401 
	`GIC_CLEAR_TRIGGER
(
úq
 + 
i
);

406 
bad_ªg
;

408 
	`gic_upd©e
(
s
);

410 
bad_ªg
:

411 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "gic_di°_wrôeb: Bad off£à%x\n", 
off£t
);

412 
	}
}

414 
	$gic_di°_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

415 
uöt32_t
 
vÆue
)

417 
gic_°©e
 *
s
 = (gic_°©ê*)
›aque
;

418 i‡(
off£t
 - 
s
->
ba£
 == 0xf00) {

419 
	`GIC_SET_PENDING
(
vÆue
 & 0x3ff);

420 
	`gic_upd©e
(
s
);

423 
	`gic_di°_wrôeb
(
›aque
, 
off£t
, 
vÆue
 & 0xff);

424 
	`gic_di°_wrôeb
(
›aque
, 
off£t
 + 1, 
vÆue
 >> 8);

425 
	}
}

427 
	$gic_di°_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

428 
uöt32_t
 
vÆue
)

430 
	`gic_di°_wrôew
(
›aque
, 
off£t
, 
vÆue
 & 0xffff);

431 
	`gic_di°_wrôew
(
›aque
, 
off£t
 + 2, 
vÆue
 >> 16);

432 
	}
}

434 
CPURódMem‹yFunc
 *
	ggic_di°_ªad‚
[] = {

435 
gic_di°_ªadb
,

436 
gic_di°_ªadw
,

437 
gic_di°_ªadl


440 
CPUWrôeMem‹yFunc
 *
	ggic_di°_wrôe‚
[] = {

441 
gic_di°_wrôeb
,

442 
gic_di°_wrôew
,

443 
gic_di°_wrôñ


446 
uöt32_t
 
	$gic_˝u_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

448 
gic_°©e
 *
s
 = (gic_°©ê*)
›aque
;

449 
off£t
 -
s
->
ba£
;

450 
off£t
) {

452  
s
->
˝u_íabÀd
;

454  
s
->
¥i‹ôy_mask
;

459  
	`gic_acknowÀdge_úq
(
s
);

461  
s
->
ru¬ög_¥i‹ôy
;

463  
s
->
cuºít_≥ndög
;

465 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "gic_˝u_wrôeb: Bad off£à%x\n", 
off£t
);

468 
	}
}

470 
	$gic_˝u_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

471 
uöt32_t
 
vÆue
)

473 
gic_°©e
 *
s
 = (gic_°©ê*)
›aque
;

474 
off£t
 -
s
->
ba£
;

475 
off£t
) {

477 
s
->
˝u_íabÀd
 = (
vÆue
 & 1);

478 
	`DPRINTF
("CPU %ßbÀd\n", 
s
->
˝u_íabÀd
 ? "En" : "Dis");

481 
s
->
¥i‹ôy_mask
 = (
vÆue
 & 0x3ff);

487  
	`gic_com∂ëe_úq
(
s
, 
vÆue
 & 0x3ff);

489 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "gic_˝u_wrôeb: Bad off£à%x\n", 
off£t
);

492 
	`gic_upd©e
(
s
);

493 
	}
}

495 
CPURódMem‹yFunc
 *
	ggic_˝u_ªad‚
[] = {

496 
gic_˝u_ªad
,

497 
gic_˝u_ªad
,

498 
gic_˝u_ªad


501 
CPUWrôeMem‹yFunc
 *
	ggic_˝u_wrôe‚
[] = {

502 
gic_˝u_wrôe
,

503 
gic_˝u_wrôe
,

504 
gic_˝u_wrôe


507 
	$gic_ª£t
(
gic_°©e
 *
s
)

509 
i
;

510 
	`mem£t
(
s
->
úq_°©e
, 0, 
GIC_NIRQ
 * (
gic_úq_°©e
));

511 
s
->
¥i‹ôy_mask
 = 0xf0;

512 
s
->
cuºít_≥ndög
 = 1023;

513 
s
->
ru¬ög_úq
 = 1023;

514 
s
->
ru¬ög_¥i‹ôy
 = 0x100;

515 
i
 = 0; i < 15; i++) {

516 
	`GIC_SET_ENABLED
(
i
);

517 
	`GIC_SET_TRIGGER
(
i
);

519 
s
->
íabÀd
 = 0;

520 
s
->
˝u_íabÀd
 = 0;

521 
	}
}

523 *
	$¨m_gic_öô
(
uöt32_t
 
ba£
, *
∑ª¡
, 
∑ª¡_úq
)

525 
gic_°©e
 *
s
;

526 
iomemty≥
;

528 
s
 = (
gic_°©e
 *)
	`qemu_mÆlocz
((gic_state));

529 i‡(!
s
)

530  
NULL
;

531 
s
->
h™dÀr
 = 
gic_£t_úq
;

532 
s
->
∑ª¡
 =Öarent;

533 
s
->
∑ª¡_úq
 =Öarent_irq;

534 i‡(
ba£
 != 0xffffffff) {

535 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
gic_˝u_ªad‚
,

536 
gic_˝u_wrôe‚
, 
s
);

537 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

538 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
gic_di°_ªad‚
,

539 
gic_di°_wrôe‚
, 
s
);

540 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x1000, 0x00000fff, 
iomemty≥
);

541 
s
->
ba£
 = base;

543 
s
->
ba£
 = 0;

545 
	`gic_ª£t
(
s
);

546  
s
;

547 
	}
}

	@arm_pic.c

10 
	~"vl.h
"

11 
	~"¨m_pic.h
"

14 
	$pic_£t_úq
(
úq
, 
Àvñ
)

16 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "pic_set_irq");

17 
	}
}

19 
	$pic_öfo
()

21 
	}
}

23 
	$úq_öfo
()

25 
	}
}

28 
	$pic_£t_úq_√w
(*
›aque
, 
úq
, 
Àvñ
)

30 
¨m_pic_h™dÀr
 *
p
 = (¨m_pic_h™dÀ∏*)
›aque
;

32 (*
p
)(
›aque
, 
úq
, 
Àvñ
);

33 
	}
}

39 
¨m_pic_h™dÀr
 
	mh™dÀr
;

40 
CPUSèã
 *
	m˝u_ív
;

41 } 
	t¨m_pic_˝u_°©e
;

43 
	$¨m_pic_˝u_h™dÀr
(*
›aque
, 
úq
, 
Àvñ
)

45 
¨m_pic_˝u_°©e
 *
s
 = (¨m_pic_˝u_°©ê*)
›aque
;

46 
úq
) {

47 
ARM_PIC_CPU_IRQ
:

48 i‡(
Àvñ
)

49 
	`˝u_öãºu±
(
s
->
˝u_ív
, 
CPU_INTERRUPT_HARD
);

51 
	`˝u_ª£t_öãºu±
(
s
->
˝u_ív
, 
CPU_INTERRUPT_HARD
);

53 
ARM_PIC_CPU_FIQ
:

54 i‡(
Àvñ
)

55 
	`˝u_öãºu±
(
s
->
˝u_ív
, 
CPU_INTERRUPT_FIQ
);

57 
	`˝u_ª£t_öãºu±
(
s
->
˝u_ív
, 
CPU_INTERRUPT_FIQ
);

60 
	`˝u_ab‹t
(
s
->
˝u_ív
, "arm_pic_cpu_handler: Bad interrputÜine %d\n",

61 
úq
);

63 
	}
}

65 *
	$¨m_pic_öô_˝u
(
CPUSèã
 *
ív
)

67 
¨m_pic_˝u_°©e
 *
s
;

69 
s
 = (
¨m_pic_˝u_°©e
 *)
	`mÆloc
((arm_pic_cpu_state));

70 
s
->
h™dÀr
 = 
¨m_pic_˝u_h™dÀr
;

71 
s
->
˝u_ív
 = 
ív
;

72  
s
;

73 
	}
}

	@arm_pic.h

14 #i‚de‡
ARM_INTERRUPT_H


15 
	#ARM_INTERRUPT_H
 1

	)

19 (*
	t¨m_pic_h™dÀr
)(*
	t›aque
, 
	túq
, 
	tÀvñ
);

22 
	#ARM_PIC_CPU_IRQ
 0

	)

23 
	#ARM_PIC_CPU_FIQ
 1

	)

24 *
	`¨m_pic_öô_˝u
(
CPUSèã
 *
ív
);

	@arm_sysctl.c

10 
	~"vl.h
"

11 
	~"¨m_pic.h
"

13 
	#LOCK_VALUE
 0xa05f

	)

16 
uöt32_t
 
	mba£
;

17 
uöt32_t
 
	msys_id
;

18 
uöt32_t
 
	mÀds
;

19 
uöt16_t
 
	mlockvÆ
;

20 
uöt32_t
 
	mcfgd©a1
;

21 
uöt32_t
 
	mcfgd©a2
;

22 
uöt32_t
 
	mÊags
;

23 
uöt32_t
 
	mnvÊags
;

24 
uöt32_t
 
	mª£éevñ
;

25 } 
	t¨m_sys˘l_°©e
;

27 
uöt32_t
 
	$¨m_sys˘l_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

29 
¨m_sys˘l_°©e
 *
s
 = (¨m_sys˘l_°©ê*)
›aque
;

31 
off£t
 -
s
->
ba£
;

32 
off£t
) {

34  
s
->
sys_id
;

40  
s
->
Àds
;

42  
s
->
lockvÆ
;

52  
s
->
cfgd©a1
;

54  
s
->
cfgd©a2
;

56  
s
->
Êags
;

58  
s
->
nvÊags
;

60  
s
->
ª£éevñ
;

101 
	`¥ötf
 ("¨m_sys˘l_ªad: BadÑegi°î off£à0x%x\n", ()
off£t
);

104 
	}
}

106 
	$¨m_sys˘l_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

107 
uöt32_t
 
vÆ
)

109 
¨m_sys˘l_°©e
 *
s
 = (¨m_sys˘l_°©ê*)
›aque
;

110 
off£t
 -
s
->
ba£
;

112 
off£t
) {

114 
s
->
Àds
 = 
vÆ
;

123 i‡(
vÆ
 =
LOCK_VALUE
)

124 
s
->
lockvÆ
 = 
vÆ
;

126 
s
->
lockvÆ
 = 
vÆ
 & 0x7fff;

130 
s
->
cfgd©a1
 = 
vÆ
;

134 
s
->
cfgd©a2
 = 
vÆ
;

137 
s
->
Êags
 |
vÆ
;

140 
s
->
Êags
 &~
vÆ
;

143 
s
->
nvÊags
 |
vÆ
;

146 
s
->
nvÊags
 &~
vÆ
;

149 i‡(
s
->
lockvÆ
 =
LOCK_VALUE
) {

150 
s
->
ª£éevñ
 = 
vÆ
;

151 i‡(
vÆ
 & 0x100)

152 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "BoardÑeset\n");

176 
	`¥ötf
 ("¨m_sys˘l_wrôe: BadÑegi°î off£à0x%x\n", ()
off£t
);

179 
	}
}

181 
CPURódMem‹yFunc
 *
	g¨m_sys˘l_ªad‚
[] = {

182 
¨m_sys˘l_ªad
,

183 
¨m_sys˘l_ªad
,

184 
¨m_sys˘l_ªad


187 
CPUWrôeMem‹yFunc
 *
	g¨m_sys˘l_wrôe‚
[] = {

188 
¨m_sys˘l_wrôe
,

189 
¨m_sys˘l_wrôe
,

190 
¨m_sys˘l_wrôe


193 
	$¨m_sys˘l_öô
(
uöt32_t
 
ba£
, uöt32_à
sys_id
)

195 
¨m_sys˘l_°©e
 *
s
;

196 
iomemty≥
;

198 
s
 = (
¨m_sys˘l_°©e
 *)
	`qemu_mÆlocz
((arm_sysctl_state));

199 i‡(!
s
)

201 
s
->
ba£
 = base;

202 
s
->
sys_id
 = sys_id;

203 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
¨m_sys˘l_ªad‚
,

204 
¨m_sys˘l_wrôe‚
, 
s
);

205 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

207 
	}
}

	@arm_timer.c

10 
	~"vl.h
"

11 
	~"¨m_pic.h
"

15 
	#TIMER_CTRL_ONESHOT
 (1 << 0)

	)

16 
	#TIMER_CTRL_32BIT
 (1 << 1)

	)

17 
	#TIMER_CTRL_DIV1
 (0 << 2)

	)

18 
	#TIMER_CTRL_DIV16
 (1 << 2)

	)

19 
	#TIMER_CTRL_DIV256
 (2 << 2)

	)

20 
	#TIMER_CTRL_IE
 (1 << 5)

	)

21 
	#TIMER_CTRL_PERIODIC
 (1 << 6)

	)

22 
	#TIMER_CTRL_ENABLE
 (1 << 7)

	)

25 
öt64_t
 
	m√xt_time
;

26 
öt64_t
 
	mexpúes
;

27 
öt64_t
 
	mlﬂded
;

28 
QEMUTimî
 *
	mtimî
;

29 
uöt32_t
 
	mc⁄åﬁ
;

30 
uöt32_t
 
	mcou¡
;

31 
uöt32_t
 
	mlimô
;

32 
	møw_‰eq
;

33 
	m‰eq
;

34 
	möt_Àvñ
;

35 *
	mpic
;

36 
	múq
;

37 } 
	t¨m_timî_°©e
;

41 
	$¨m_timî_ªlﬂd
(
¨m_timî_°©e
 *
s
)

43 
öt64_t
 
dñay
;

45 
s
->
lﬂded
 = s->
expúes
;

46 
dñay
 = 
	`muldiv64
(
s
->
cou¡
, 
ticks_≥r_£c
, s->
‰eq
);

47 i‡(
dñay
 == 0)

48 
dñay
 = 1;

49 
s
->
expúes
 +
dñay
;

50 
	}
}

54 
	$¨m_timî_upd©e
(
¨m_timî_°©e
 *
s
, 
öt64_t
 
now
)

56 
öt64_t
 
√xt
;

59 i‡((
s
->
c⁄åﬁ
 & 
TIMER_CTRL_ENABLE
) == 0)

62 i‡(
s
->
cou¡
 =0 && (s->
c⁄åﬁ
 & 
TIMER_CTRL_ONESHOT
))

64 i‡(
s
->
expúes
 - 
now
 <= 0) {

66 
s
->
öt_Àvñ
 = 1;

67 i‡(
s
->
c⁄åﬁ
 & 
TIMER_CTRL_ONESHOT
) {

69 
s
->
cou¡
 = 0;

71 i‡((
s
->
c⁄åﬁ
 & 
TIMER_CTRL_PERIODIC
) == 0) {

73 i‡(
s
->
c⁄åﬁ
 & 
TIMER_CTRL_32BIT
)

74 
s
->
cou¡
 = 0xffffffff;

76 
s
->
cou¡
 = 0xffff;

79 
s
->
cou¡
 = s->
limô
;

83 
s
->
expúes
 - 
now
 <= 0) {

84 
	`¨m_timî_ªlﬂd
(
s
);

87 i‡(
s
->
öt_Àvñ
 && (s->
c⁄åﬁ
 & 
TIMER_CTRL_IE
)) {

88 
	`pic_£t_úq_√w
(
s
->
pic
, s->
úq
, 1);

90 
	`pic_£t_úq_√w
(
s
->
pic
, s->
úq
, 0);

93 
√xt
 = 
now
;

94 i‡(
√xt
 - 
s
->
expúes
 < 0)

95 
√xt
 = 
s
->
expúes
;

98 i‡(
√xt
 =
now
) {

99 
	`qemu_dñ_timî
(
s
->
timî
);

100 
s
->
√xt_time
 = 0;

101 } i‡(
√xt
 !
s
->
√xt_time
) {

102 
	`qemu_mod_timî
(
s
->
timî
, 
√xt
);

103 
s
->
√xt_time
 = 
√xt
;

105 
	}
}

108 
uöt32_t
 
	$¨m_timî_gëcou¡
(
¨m_timî_°©e
 *
s
, 
öt64_t
 
now
)

110 
öt64_t
 
À·
;

111 
öt64_t
 
≥riod
;

113 i‡(
s
->
cou¡
 == 0)

115 i‡((
s
->
c⁄åﬁ
 & 
TIMER_CTRL_ENABLE
) == 0)

116  
s
->
cou¡
;

117 
À·
 = 
s
->
expúes
 - 
now
;

118 
≥riod
 = 
s
->
expúes
 - s->
lﬂded
;

124 i‡(
À·
 < 0)

128 
≥riod
 !(
öt32_t
)period) {

129 
≥riod
 >>= 1;

130 
À·
 >>= 1;

132  ((
uöt64_t
)
s
->
cou¡
 * (uöt64_t)(
öt32_t
)
À·
)

133 / (
öt32_t
)
≥riod
;

134 
	}
}

136 
uöt32_t
 
	$¨m_timî_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

138 
¨m_timî_°©e
 *
s
 = (¨m_timî_°©ê*)
›aque
;

140 
off£t
 >> 2) {

143  
s
->
limô
;

145  
	`¨m_timî_gëcou¡
(
s
, 
	`qemu_gë_˛ock
(
vm_˛ock
));

147  
s
->
c⁄åﬁ
;

149  
s
->
öt_Àvñ
;

151 i‡((
s
->
c⁄åﬁ
 & 
TIMER_CTRL_IE
) == 0)

153  
s
->
öt_Àvñ
;

155 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "¨m_timî_ªad: Bad off£à%x\n", 
off£t
);

158 
	}
}

160 
	$¨m_timî_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

161 
uöt32_t
 
vÆue
)

163 
¨m_timî_°©e
 *
s
 = (¨m_timî_°©ê*)
›aque
;

164 
öt64_t
 
now
;

166 
now
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

167 
off£t
 >> 2) {

169 
s
->
limô
 = 
vÆue
;

170 
s
->
cou¡
 = 
vÆue
;

171 
s
->
expúes
 = 
now
;

172 
	`¨m_timî_ªlﬂd
(
s
);

179 i‡(
s
->
c⁄åﬁ
 & 
TIMER_CTRL_ENABLE
) {

183 
s
->
cou¡
 = 
	`¨m_timî_gëcou¡
(s, 
now
);

185 
s
->
c⁄åﬁ
 = 
vÆue
;

186 
s
->
‰eq
 = s->
øw_‰eq
;

188 (
vÆue
 >> 2) & 3) {

189 1: 
s
->
‰eq
 >>= 4; ;

190 2: 
s
->
‰eq
 >>= 8; ;

192 i‡(
s
->
c⁄åﬁ
 & 
TIMER_CTRL_ENABLE
) {

194 
s
->
expúes
 = 
now
;

195 
	`¨m_timî_ªlﬂd
(
s
);

199 
s
->
öt_Àvñ
 = 0;

202 
s
->
limô
 = 
vÆue
;

205 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "¨m_timî_wrôe: Bad off£à%x\n", 
off£t
);

207 
	`¨m_timî_upd©e
(
s
, 
now
);

208 
	}
}

210 
	$¨m_timî_tick
(*
›aque
)

212 
öt64_t
 
now
;

214 
now
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

215 
	`¨m_timî_upd©e
((
¨m_timî_°©e
 *)
›aque
, 
now
);

216 
	}
}

218 *
	$¨m_timî_öô
(
uöt32_t
 
‰eq
, *
pic
, 
úq
)

220 
¨m_timî_°©e
 *
s
;

222 
s
 = (
¨m_timî_°©e
 *)
	`qemu_mÆlocz
((arm_timer_state));

223 
s
->
pic
 =Öic;

224 
s
->
úq
 = irq;

225 
s
->
øw_‰eq
 = s->
‰eq
 = 1000000;

226 
s
->
c⁄åﬁ
 = 
TIMER_CTRL_IE
;

227 
s
->
cou¡
 = 0xffffffff;

229 
s
->
timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
¨m_timî_tick
, s);

231  
s
;

232 
	}
}

241 
¨m_pic_h™dÀr
 
	mh™dÀr
;

242 *
	mtimî
[2];

243 
	mÀvñ
[2];

244 
uöt32_t
 
	mba£
;

246 *
	mpic
;

247 
	múq
;

248 } 
	t•804_°©e
;

250 
	$•804_£t_úq
(*
›aque
, 
úq
, 
Àvñ
)

252 
•804_°©e
 *
s
 = (•804_°©ê*)
›aque
;

254 
s
->
Àvñ
[
úq
] =Üevel;

255 
	`pic_£t_úq_√w
(
s
->
pic
, s->
úq
, s->
Àvñ
[0] || s->level[1]);

256 
	}
}

258 
uöt32_t
 
	$•804_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

260 
•804_°©e
 *
s
 = (•804_°©ê*)
›aque
;

263 
off£t
 -
s
->
ba£
;

264 i‡(
off£t
 < 0x20) {

265  
	`¨m_timî_ªad
(
s
->
timî
[0], 
off£t
);

267  
	`¨m_timî_ªad
(
s
->
timî
[1], 
off£t
 - 0x20);

269 
	}
}

271 
	$•804_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

272 
uöt32_t
 
vÆue
)

274 
•804_°©e
 *
s
 = (•804_°©ê*)
›aque
;

276 
off£t
 -
s
->
ba£
;

277 i‡(
off£t
 < 0x20) {

278 
	`¨m_timî_wrôe
(
s
->
timî
[0], 
off£t
, 
vÆue
);

280 
	`¨m_timî_wrôe
(
s
->
timî
[1], 
off£t
 - 0x20, 
vÆue
);

282 
	}
}

284 
CPURódMem‹yFunc
 *
	g•804_ªad‚
[] = {

285 
•804_ªad
,

286 
•804_ªad
,

287 
•804_ªad


290 
CPUWrôeMem‹yFunc
 *
	g•804_wrôe‚
[] = {

291 
•804_wrôe
,

292 
•804_wrôe
,

293 
•804_wrôe


296 
	$•804_öô
(
uöt32_t
 
ba£
, *
pic
, 
úq
)

298 
iomemty≥
;

299 
•804_°©e
 *
s
;

301 
s
 = (
•804_°©e
 *)
	`qemu_mÆlocz
((sp804_state));

302 
s
->
h™dÀr
 = 
•804_£t_úq
;

303 
s
->
ba£
 = base;

304 
s
->
pic
 =Öic;

305 
s
->
úq
 = irq;

308 
s
->
timî
[0] = 
	`¨m_timî_öô
(1000000, s, 0);

309 
s
->
timî
[1] = 
	`¨m_timî_öô
(1000000, s, 1);

310 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
•804_ªad‚
,

311 
•804_wrôe‚
, 
s
);

312 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

314 
	}
}

320 *
	mtimî
[3];

321 
uöt32_t
 
	mba£
;

322 } 
	ti˝_pô_°©e
;

324 
uöt32_t
 
	$i˝_pô_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

326 
i˝_pô_°©e
 *
s
 = (i˝_pô_°©ê*)
›aque
;

327 
n
;

330 
off£t
 -
s
->
ba£
;

331 
n
 = 
off£t
 >> 8;

332 i‡(
n
 > 3)

333 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "•804_ªad: BadÅimî %d\n", 
n
);

335  
	`¨m_timî_ªad
(
s
->
timî
[
n
], 
off£t
 & 0xff);

336 
	}
}

338 
	$i˝_pô_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

339 
uöt32_t
 
vÆue
)

341 
i˝_pô_°©e
 *
s
 = (i˝_pô_°©ê*)
›aque
;

342 
n
;

344 
off£t
 -
s
->
ba£
;

345 
n
 = 
off£t
 >> 8;

346 i‡(
n
 > 3)

347 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "•804_wrôe: BadÅimî %d\n", 
n
);

349 
	`¨m_timî_wrôe
(
s
->
timî
[
n
], 
off£t
 & 0xff, 
vÆue
);

350 
	}
}

353 
CPURódMem‹yFunc
 *
	gi˝_pô_ªad‚
[] = {

354 
i˝_pô_ªad
,

355 
i˝_pô_ªad
,

356 
i˝_pô_ªad


359 
CPUWrôeMem‹yFunc
 *
	gi˝_pô_wrôe‚
[] = {

360 
i˝_pô_wrôe
,

361 
i˝_pô_wrôe
,

362 
i˝_pô_wrôe


365 
	$i˝_pô_öô
(
uöt32_t
 
ba£
, *
pic
, 
úq
)

367 
iomemty≥
;

368 
i˝_pô_°©e
 *
s
;

370 
s
 = (
i˝_pô_°©e
 *)
	`qemu_mÆlocz
((icp_pit_state));

371 
s
->
ba£
 = base;

373 
s
->
timî
[0] = 
	`¨m_timî_öô
(40000000, 
pic
, 
úq
);

375 
s
->
timî
[1] = 
	`¨m_timî_öô
(1000000, 
pic
, 
úq
 + 1);

376 
s
->
timî
[2] = 
	`¨m_timî_öô
(1000000, 
pic
, 
úq
 + 2);

378 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
i˝_pô_ªad‚
,

379 
i˝_pô_wrôe‚
, 
s
);

380 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

382 
	}
}

	@cdrom.c

28 
	~<vl.h
>

30 
	$lba_to_msf
(
uöt8_t
 *
buf
, 
lba
)

32 
lba
 += 150;

33 
buf
[0] = (
lba
 / 75) / 60;

34 
buf
[1] = (
lba
 / 75) % 60;

35 
buf
[2] = 
lba
 % 75;

36 
	}
}

40 
	$cdrom_ªad_toc
(
nb_£˘‹s
, 
uöt8_t
 *
buf
, 
msf
, 
°¨t_åack
)

42 
uöt8_t
 *
q
;

43 
Àn
;

45 i‡(
°¨t_åack
 > 1 && start_track != 0xaa)

47 
q
 = 
buf
 + 2;

48 *
q
++ = 1;

49 *
q
++ = 1;

50 i‡(
°¨t_åack
 <= 1) {

51 *
q
++ = 0;

52 *
q
++ = 0x14;

53 *
q
++ = 1;

54 *
q
++ = 0;

55 i‡(
msf
) {

56 *
q
++ = 0;

57 
	`lba_to_msf
(
q
, 0);

58 
q
 += 3;

61 
	`˝u_to_be32wu
((
uöt32_t
 *)
q
, 0);

62 
q
 += 4;

66 *
q
++ = 0;

67 *
q
++ = 0x16;

68 *
q
++ = 0xaa;

69 *
q
++ = 0;

70 i‡(
msf
) {

71 *
q
++ = 0;

72 
	`lba_to_msf
(
q
, 
nb_£˘‹s
);

73 
q
 += 3;

75 
	`˝u_to_be32wu
((
uöt32_t
 *)
q
, 
nb_£˘‹s
);

76 
q
 += 4;

78 
Àn
 = 
q
 - 
buf
;

79 
	`˝u_to_be16wu
((
uöt16_t
 *)
buf
, 
Àn
 - 2);

80  
Àn
;

81 
	}
}

84 
	$cdrom_ªad_toc_øw
(
nb_£˘‹s
, 
uöt8_t
 *
buf
, 
msf
, 
£ssi⁄_num
)

86 
uöt8_t
 *
q
;

87 
Àn
;

89 
q
 = 
buf
 + 2;

90 *
q
++ = 1;

91 *
q
++ = 1;

93 *
q
++ = 1;

94 *
q
++ = 0x14;

95 *
q
++ = 0;

96 *
q
++ = 0xa0;

97 *
q
++ = 0;

98 *
q
++ = 0;

99 *
q
++ = 0;

100 *
q
++ = 0;

101 *
q
++ = 1;

102 *
q
++ = 0x00;

103 *
q
++ = 0x00;

105 *
q
++ = 1;

106 *
q
++ = 0x14;

107 *
q
++ = 0;

108 *
q
++ = 0xa1;

109 *
q
++ = 0;

110 *
q
++ = 0;

111 *
q
++ = 0;

112 *
q
++ = 0;

113 *
q
++ = 1;

114 *
q
++ = 0x00;

115 *
q
++ = 0x00;

117 *
q
++ = 1;

118 *
q
++ = 0x14;

119 *
q
++ = 0;

120 *
q
++ = 0xa2;

121 *
q
++ = 0;

122 *
q
++ = 0;

123 *
q
++ = 0;

124 i‡(
msf
) {

125 *
q
++ = 0;

126 
	`lba_to_msf
(
q
, 
nb_£˘‹s
);

127 
q
 += 3;

129 
	`˝u_to_be32wu
((
uöt32_t
 *)
q
, 
nb_£˘‹s
);

130 
q
 += 4;

133 *
q
++ = 1;

134 *
q
++ = 0x14;

135 *
q
++ = 0;

136 *
q
++ = 1;

137 *
q
++ = 0;

138 *
q
++ = 0;

139 *
q
++ = 0;

140 i‡(
msf
) {

141 *
q
++ = 0;

142 
	`lba_to_msf
(
q
, 0);

143 
q
 += 3;

145 *
q
++ = 0;

146 *
q
++ = 0;

147 *
q
++ = 0;

148 *
q
++ = 0;

151 
Àn
 = 
q
 - 
buf
;

152 
	`˝u_to_be16wu
((
uöt16_t
 *)
buf
, 
Àn
 - 2);

153  
Àn
;

154 
	}
}

	@cirrus_vga.c

29 
	~"vl.h
"

30 
	~"vga_öt.h
"

31 #i‚de‡
_WIN32


32 
	~<sys/mm™.h
>

51 
	#qemu_MIN
(
a
,
b
Ë(◊Ë< (bË? (aË: (b))

	)

54 
	#CIRRUS_ID_CLGD5422
 (0x23<<2)

	)

55 
	#CIRRUS_ID_CLGD5426
 (0x24<<2)

	)

56 
	#CIRRUS_ID_CLGD5424
 (0x25<<2)

	)

57 
	#CIRRUS_ID_CLGD5428
 (0x26<<2)

	)

58 
	#CIRRUS_ID_CLGD5430
 (0x28<<2)

	)

59 
	#CIRRUS_ID_CLGD5434
 (0x2A<<2)

	)

60 
	#CIRRUS_ID_CLGD5436
 (0x2B<<2)

	)

61 
	#CIRRUS_ID_CLGD5446
 (0x2E<<2)

	)

64 
	#CIRRUS_SR7_BPP_VGA
 0x00

	)

65 
	#CIRRUS_SR7_BPP_SVGA
 0x01

	)

66 
	#CIRRUS_SR7_BPP_MASK
 0x0e

	)

67 
	#CIRRUS_SR7_BPP_8
 0x00

	)

68 
	#CIRRUS_SR7_BPP_16_DOUBLEVCLK
 0x02

	)

69 
	#CIRRUS_SR7_BPP_24
 0x04

	)

70 
	#CIRRUS_SR7_BPP_16
 0x06

	)

71 
	#CIRRUS_SR7_BPP_32
 0x08

	)

72 
	#CIRRUS_SR7_ISAADDR_MASK
 0xe0

	)

75 
	#CIRRUS_MEMSIZE_512k
 0x08

	)

76 
	#CIRRUS_MEMSIZE_1M
 0x10

	)

77 
	#CIRRUS_MEMSIZE_2M
 0x18

	)

78 
	#CIRRUS_MEMFLAGS_BANKSWITCH
 0x80

79 

	)

81 
	#CIRRUS_CURSOR_SHOW
 0x01

	)

82 
	#CIRRUS_CURSOR_HIDDENPEL
 0x02

	)

83 
	#CIRRUS_CURSOR_LARGE
 0x04

84 

	)

86 
	#CIRRUS_BUSTYPE_VLBFAST
 0x10

	)

87 
	#CIRRUS_BUSTYPE_PCI
 0x20

	)

88 
	#CIRRUS_BUSTYPE_VLBSLOW
 0x30

	)

89 
	#CIRRUS_BUSTYPE_ISA
 0x38

	)

90 
	#CIRRUS_MMIO_ENABLE
 0x04

	)

91 
	#CIRRUS_MMIO_USE_PCIADDR
 0x40

92 
	#CIRRUS_MEMSIZEEXT_DOUBLE
 0x80

	)

95 
	#CIRRUS_BANKING_DUAL
 0x01

	)

96 
	#CIRRUS_BANKING_GRANULARITY_16K
 0x20

97 

	)

99 
	#CIRRUS_BLTMODE_BACKWARDS
 0x01

	)

100 
	#CIRRUS_BLTMODE_MEMSYSDEST
 0x02

	)

101 
	#CIRRUS_BLTMODE_MEMSYSSRC
 0x04

	)

102 
	#CIRRUS_BLTMODE_TRANSPARENTCOMP
 0x08

	)

103 
	#CIRRUS_BLTMODE_PATTERNCOPY
 0x40

	)

104 
	#CIRRUS_BLTMODE_COLOREXPAND
 0x80

	)

105 
	#CIRRUS_BLTMODE_PIXELWIDTHMASK
 0x30

	)

106 
	#CIRRUS_BLTMODE_PIXELWIDTH8
 0x00

	)

107 
	#CIRRUS_BLTMODE_PIXELWIDTH16
 0x10

	)

108 
	#CIRRUS_BLTMODE_PIXELWIDTH24
 0x20

	)

109 
	#CIRRUS_BLTMODE_PIXELWIDTH32
 0x30

	)

112 
	#CIRRUS_BLT_BUSY
 0x01

	)

113 
	#CIRRUS_BLT_START
 0x02

	)

114 
	#CIRRUS_BLT_RESET
 0x04

	)

115 
	#CIRRUS_BLT_FIFOUSED
 0x10

	)

116 
	#CIRRUS_BLT_AUTOSTART
 0x80

	)

119 
	#CIRRUS_ROP_0
 0x00

	)

120 
	#CIRRUS_ROP_SRC_AND_DST
 0x05

	)

121 
	#CIRRUS_ROP_NOP
 0x06

	)

122 
	#CIRRUS_ROP_SRC_AND_NOTDST
 0x09

	)

123 
	#CIRRUS_ROP_NOTDST
 0x0b

	)

124 
	#CIRRUS_ROP_SRC
 0x0d

	)

125 
	#CIRRUS_ROP_1
 0x0e

	)

126 
	#CIRRUS_ROP_NOTSRC_AND_DST
 0x50

	)

127 
	#CIRRUS_ROP_SRC_XOR_DST
 0x59

	)

128 
	#CIRRUS_ROP_SRC_OR_DST
 0x6d

	)

129 
	#CIRRUS_ROP_NOTSRC_OR_NOTDST
 0x90

	)

130 
	#CIRRUS_ROP_SRC_NOTXOR_DST
 0x95

	)

131 
	#CIRRUS_ROP_SRC_OR_NOTDST
 0xad

	)

132 
	#CIRRUS_ROP_NOTSRC
 0xd0

	)

133 
	#CIRRUS_ROP_NOTSRC_OR_DST
 0xd6

	)

134 
	#CIRRUS_ROP_NOTSRC_AND_NOTDST
 0xda

	)

136 
	#CIRRUS_ROP_NOP_INDEX
 2

	)

137 
	#CIRRUS_ROP_SRC_INDEX
 5

	)

140 
	#CIRRUS_BLTMODEEXT_SOLIDFILL
 0x04

	)

141 
	#CIRRUS_BLTMODEEXT_COLOREXPINV
 0x02

	)

142 
	#CIRRUS_BLTMODEEXT_DWORDGRANULARITY
 0x01

	)

145 
	#CIRRUS_MMIO_BLTBGCOLOR
 0x00

146 
	#CIRRUS_MMIO_BLTFGCOLOR
 0x04

147 
	#CIRRUS_MMIO_BLTWIDTH
 0x08

148 
	#CIRRUS_MMIO_BLTHEIGHT
 0x0a

149 
	#CIRRUS_MMIO_BLTDESTPITCH
 0x0c

150 
	#CIRRUS_MMIO_BLTSRCPITCH
 0x0e

151 
	#CIRRUS_MMIO_BLTDESTADDR
 0x10

152 
	#CIRRUS_MMIO_BLTSRCADDR
 0x14

153 
	#CIRRUS_MMIO_BLTWRITEMASK
 0x17

154 
	#CIRRUS_MMIO_BLTMODE
 0x18

155 
	#CIRRUS_MMIO_BLTROP
 0x1a

156 
	#CIRRUS_MMIO_BLTMODEEXT
 0x1b

157 
	#CIRRUS_MMIO_BLTTRANSPARENTCOLOR
 0x1c

158 
	#CIRRUS_MMIO_BLTTRANSPARENTCOLORMASK
 0x20

159 
	#CIRRUS_MMIO_LINEARDRAW_START_X
 0x24

160 
	#CIRRUS_MMIO_LINEARDRAW_START_Y
 0x26

161 
	#CIRRUS_MMIO_LINEARDRAW_END_X
 0x28

162 
	#CIRRUS_MMIO_LINEARDRAW_END_Y
 0x2a

163 
	#CIRRUS_MMIO_LINEARDRAW_LINESTYLE_INC
 0x2c

164 
	#CIRRUS_MMIO_LINEARDRAW_LINESTYLE_ROLLOVER
 0x2d

165 
	#CIRRUS_MMIO_LINEARDRAW_LINESTYLE_MASK
 0x2e

166 
	#CIRRUS_MMIO_LINEARDRAW_LINESTYLE_ACCUM
 0x2f

167 
	#CIRRUS_MMIO_BRESENHAM_K1
 0x30

168 
	#CIRRUS_MMIO_BRESENHAM_K3
 0x32

169 
	#CIRRUS_MMIO_BRESENHAM_ERROR
 0x34

170 
	#CIRRUS_MMIO_BRESENHAM_DELTA_MAJOR
 0x36

171 
	#CIRRUS_MMIO_BRESENHAM_DIRECTION
 0x38

172 
	#CIRRUS_MMIO_LINEDRAW_MODE
 0x39

173 
	#CIRRUS_MMIO_BLTSTATUS
 0x40

174 

	)

176 
	#PCI_VENDOR_CIRRUS
 0x1013

	)

177 
	#PCI_DEVICE_CLGD5462
 0x00d0

	)

178 
	#PCI_DEVICE_CLGD5465
 0x00d6

	)

181 
	#PCI_COMMAND_IOACCESS
 0x0001

	)

182 
	#PCI_COMMAND_MEMACCESS
 0x0002

	)

183 
	#PCI_COMMAND_BUSMASTER
 0x0004

	)

184 
	#PCI_COMMAND_SPECIALCYCLE
 0x0008

	)

185 
	#PCI_COMMAND_MEMWRITEINVALID
 0x0010

	)

186 
	#PCI_COMMAND_PALETTESNOOPING
 0x0020

	)

187 
	#PCI_COMMAND_PARITYDETECTION
 0x0040

	)

188 
	#PCI_COMMAND_ADDRESSDATASTEPPING
 0x0080

	)

189 
	#PCI_COMMAND_SERR
 0x0100

	)

190 
	#PCI_COMMAND_BACKTOBACKTRANS
 0x0200

	)

192 
	#PCI_CLASS_BASE_DISPLAY
 0x03

	)

194 
	#PCI_CLASS_SUB_VGA
 0x00

	)

196 
	#PCI_CLASS_HEADERTYPE_00h
 0x00

	)

200 
	#PCI_MAP_MEM
 0x0

	)

201 
	#PCI_MAP_IO
 0x1

	)

202 
	#PCI_MAP_MEM_ADDR_MASK
 (~0xf)

	)

203 
	#PCI_MAP_IO_ADDR_MASK
 (~0x3)

	)

204 
	#PCI_MAP_MEMFLAGS_32BIT
 0x0

	)

205 
	#PCI_MAP_MEMFLAGS_32BIT_1M
 0x1

	)

206 
	#PCI_MAP_MEMFLAGS_64BIT
 0x4

	)

207 
	#PCI_MAP_MEMFLAGS_CACHEABLE
 0x8

	)

211 
	#PCI_ROMBIOS_ENABLED
 0x1

	)

216 
	#CIRRUS_PNPMMIO_SIZE
 0x1000

	)

220 
	#CIRRUS_HOOK_NOT_HANDLED
 0

	)

221 
	#CIRRUS_HOOK_HANDLED
 1

	)

223 
	gCúrusVGASèã
;

224 (*
	tcúrus_bôb…_r›_t
Ë(
	tCúrusVGASèã
 *
	ts
,

225 
	tuöt8_t
 * 
	td°
, c⁄° uöt8_à* 
	t§c
,

226 
	td°pôch
, 
	t§˝ôch
,

227 
	tb…width
, 
	tb…height
);

228 (*
	tcúrus_fûl_t
)(
	tCúrusVGASèã
 *
	ts
,

229 
	tuöt8_t
 *
	td°
, 
	td°_pôch
, 
	twidth
, 
	theight
);

231 
	sCúrusVGASèã
 {

232 
VGA_STATE_COMMON


234 
cúrus_löór_io_addr
;

235 
cúrus_löór_bôb…_io_addr
;

236 
cúrus_mmio_io_addr
;

237 
cúrus_lfb_addr
;

238 
cúrus_lfb_íd
;

239 
uöt32_t
 
cúrus_addr_mask
;

240 
uöt32_t
 
löór_mmio_mask
;

241 
uöt8_t
 
cúrus_shadow_gr0
;

242 
uöt8_t
 
cúrus_shadow_gr1
;

243 
uöt8_t
 
cúrus_hiddí_dac_locködex
;

244 
uöt8_t
 
cúrus_hiddí_dac_d©a
;

245 
uöt32_t
 
cúrus_b™k_ba£
[2];

246 
uöt32_t
 
cúrus_b™k_limô
[2];

247 
uöt8_t
 
cúrus_hiddí_∑Àâe
[48];

248 
uöt32_t
 
hw_curs‹_x
;

249 
uöt32_t
 
hw_curs‹_y
;

250 
cúrus_b…_pixñwidth
;

251 
cúrus_b…_width
;

252 
cúrus_b…_height
;

253 
cúrus_b…_d°pôch
;

254 
cúrus_b…_§˝ôch
;

255 
uöt32_t
 
cúrus_b…_fgcﬁ
;

256 
uöt32_t
 
cúrus_b…_bgcﬁ
;

257 
uöt32_t
 
cúrus_b…_d°addr
;

258 
uöt32_t
 
cúrus_b…_§ˇddr
;

259 
uöt8_t
 
cúrus_b…_mode
;

260 
uöt8_t
 
cúrus_b…_modìxt
;

261 
cúrus_bôb…_r›_t
 
cúrus_r›
;

262 
	#CIRRUS_BLTBUFSIZE
 (2048 * 4Ë

	)

263 
uöt8_t
 
cúrus_b…buf
[
CIRRUS_BLTBUFSIZE
];

264 
uöt8_t
 *
cúrus_§˝å
;

265 
uöt8_t
 *
cúrus_§˝å_íd
;

266 
uöt32_t
 
cúrus_§ccou¡î
;

268 
œ°_hw_curs‹_size
;

269 
œ°_hw_curs‹_x
;

270 
œ°_hw_curs‹_y
;

271 
œ°_hw_curs‹_y_°¨t
;

272 
œ°_hw_curs‹_y_íd
;

273 
ªÆ_vøm_size
;

274 
CPUWrôeMem‹yFunc
 **
cúrus_löór_wrôe
;

275 
m≠_addr
;

276 
m≠_íd
;

277 } 
	tCúrusVGASèã
;

279 
	sPCICúrusVGASèã
 {

280 
PCIDevi˚
 
dev
;

281 
CúrusVGASèã
 
cúrus_vga
;

282 } 
	tPCICúrusVGASèã
;

284 
uöt8_t
 
r›_to_ödex
[256];

286 *
sh¨ed_vøm
;

295 
	`cúrus_bôb…_ª£t
(
CúrusVGASèã
 *
s
);

296 
	`cúrus_upd©e_mem‹y_ac˚ss
(
CúrusVGASèã
 *
s
);

297 
	`cúrus_vga_mem_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
);

305 
	$cúrus_bôb…_r›_n›
(
CúrusVGASèã
 *
s
,

306 
uöt8_t
 *
d°
,c⁄° uöt8_à*
§c
,

307 
d°pôch
,
§˝ôch
,

308 
b…width
,
b…height
)

310 
	}
}

312 
	$cúrus_bôb…_fûl_n›
(
CúrusVGASèã
 *
s
,

313 
uöt8_t
 *
d°
,

314 
d°pôch
, 
b…width
,
b…height
)

316 
	}
}

318 
	#ROP_NAME
 0

	)

319 
	#ROP_OP
(
d
, 
s
Ëd = 0

	)

320 
	~"cúrus_vga_r›.h
"

322 
	#ROP_NAME
 
§c_™d_d°


	)

323 
	#ROP_OP
(
d
, 
s
Ëd = (sË& (d)

	)

324 
	~"cúrus_vga_r›.h
"

326 
	#ROP_NAME
 
§c_™d_nŸd°


	)

327 
	#ROP_OP
(
d
, 
s
Ëd = (sË& (~(d))

	)

328 
	~"cúrus_vga_r›.h
"

330 
	#ROP_NAME
 
nŸd°


	)

331 
	#ROP_OP
(
d
, 
s
Ëd = ~(d)

	)

332 
	~"cúrus_vga_r›.h
"

334 
	#ROP_NAME
 
§c


	)

335 
	#ROP_OP
(
d
, 
s
Ëd = 
	)
s

336 
	~"cúrus_vga_r›.h
"

338 
	#ROP_NAME
 1

	)

339 
	#ROP_OP
(
d
, 
s
Ëd = ~0

	)

340 
	~"cúrus_vga_r›.h
"

342 
	#ROP_NAME
 
nŸ§c_™d_d°


	)

343 
	#ROP_OP
(
d
, 
s
Ëd = (~(s)Ë& (d)

	)

344 
	~"cúrus_vga_r›.h
"

346 
	#ROP_NAME
 
§c_x‹_d°


	)

347 
	#ROP_OP
(
d
, 
s
Ëd = (sË^ (d)

	)

348 
	~"cúrus_vga_r›.h
"

350 
	#ROP_NAME
 
§c_‹_d°


	)

351 
	#ROP_OP
(
d
, 
s
Ëd = (sË| (d)

	)

352 
	~"cúrus_vga_r›.h
"

354 
	#ROP_NAME
 
nŸ§c_‹_nŸd°


	)

355 
	#ROP_OP
(
d
, 
s
Ëd = (~(s)Ë| (~(d))

	)

356 
	~"cúrus_vga_r›.h
"

358 
	#ROP_NAME
 
§c_nŸx‹_d°


	)

359 
	#ROP_OP
(
d
, 
s
Ëd = ~((sË^ (d))

	)

360 
	~"cúrus_vga_r›.h
"

362 
	#ROP_NAME
 
§c_‹_nŸd°


	)

363 
	#ROP_OP
(
d
, 
s
Ëd = (sË| (~(d))

	)

364 
	~"cúrus_vga_r›.h
"

366 
	#ROP_NAME
 
nŸ§c


	)

367 
	#ROP_OP
(
d
, 
s
Ëd = (~(s))

	)

368 
	~"cúrus_vga_r›.h
"

370 
	#ROP_NAME
 
nŸ§c_‹_d°


	)

371 
	#ROP_OP
(
d
, 
s
Ëd = (~(s)Ë| (d)

	)

372 
	~"cúrus_vga_r›.h
"

374 
	#ROP_NAME
 
nŸ§c_™d_nŸd°


	)

375 
	#ROP_OP
(
d
, 
s
Ëd = (~(s)Ë& (~(d))

	)

376 
	~"cúrus_vga_r›.h
"

378 c⁄° 
cúrus_bôb…_r›_t
 
	gcúrus_fwd_r›
[16] = {

379 
cúrus_bôb…_r›_fwd_0
,

380 
cúrus_bôb…_r›_fwd_§c_™d_d°
,

381 
cúrus_bôb…_r›_n›
,

382 
cúrus_bôb…_r›_fwd_§c_™d_nŸd°
,

383 
cúrus_bôb…_r›_fwd_nŸd°
,

384 
cúrus_bôb…_r›_fwd_§c
,

385 
cúrus_bôb…_r›_fwd_1
,

386 
cúrus_bôb…_r›_fwd_nŸ§c_™d_d°
,

387 
cúrus_bôb…_r›_fwd_§c_x‹_d°
,

388 
cúrus_bôb…_r›_fwd_§c_‹_d°
,

389 
cúrus_bôb…_r›_fwd_nŸ§c_‹_nŸd°
,

390 
cúrus_bôb…_r›_fwd_§c_nŸx‹_d°
,

391 
cúrus_bôb…_r›_fwd_§c_‹_nŸd°
,

392 
cúrus_bôb…_r›_fwd_nŸ§c
,

393 
cúrus_bôb…_r›_fwd_nŸ§c_‹_d°
,

394 
cúrus_bôb…_r›_fwd_nŸ§c_™d_nŸd°
,

397 c⁄° 
cúrus_bôb…_r›_t
 
	gcúrus_bkwd_r›
[16] = {

398 
cúrus_bôb…_r›_bkwd_0
,

399 
cúrus_bôb…_r›_bkwd_§c_™d_d°
,

400 
cúrus_bôb…_r›_n›
,

401 
cúrus_bôb…_r›_bkwd_§c_™d_nŸd°
,

402 
cúrus_bôb…_r›_bkwd_nŸd°
,

403 
cúrus_bôb…_r›_bkwd_§c
,

404 
cúrus_bôb…_r›_bkwd_1
,

405 
cúrus_bôb…_r›_bkwd_nŸ§c_™d_d°
,

406 
cúrus_bôb…_r›_bkwd_§c_x‹_d°
,

407 
cúrus_bôb…_r›_bkwd_§c_‹_d°
,

408 
cúrus_bôb…_r›_bkwd_nŸ§c_‹_nŸd°
,

409 
cúrus_bôb…_r›_bkwd_§c_nŸx‹_d°
,

410 
cúrus_bôb…_r›_bkwd_§c_‹_nŸd°
,

411 
cúrus_bôb…_r›_bkwd_nŸ§c
,

412 
cúrus_bôb…_r›_bkwd_nŸ§c_‹_d°
,

413 
cúrus_bôb…_r›_bkwd_nŸ§c_™d_nŸd°
,

416 
	#ROP2
(
«me
) {\

417 
«me
 ## 
_8
,\

418 
«me
 ## 
_16
,\

419 
«me
 ## 
_24
,\

420 
«me
 ## 
_32
,\

421 }

	)

423 
	#ROP_NOP2
(
func
) {\

424 
func
,\

425 
func
,\

426 
func
,\

427 
func
,\

428 }

	)

430 c⁄° 
cúrus_bôb…_r›_t
 
	gcúrus_∑âînfûl
[16][4] = {

431 
ROP2
(
cúrus_∑âînfûl_0
),

432 
ROP2
(
cúrus_∑âînfûl_§c_™d_d°
),

433 
ROP_NOP2
(
cúrus_bôb…_r›_n›
),

434 
ROP2
(
cúrus_∑âînfûl_§c_™d_nŸd°
),

435 
ROP2
(
cúrus_∑âînfûl_nŸd°
),

436 
ROP2
(
cúrus_∑âînfûl_§c
),

437 
ROP2
(
cúrus_∑âînfûl_1
),

438 
ROP2
(
cúrus_∑âînfûl_nŸ§c_™d_d°
),

439 
ROP2
(
cúrus_∑âînfûl_§c_x‹_d°
),

440 
ROP2
(
cúrus_∑âînfûl_§c_‹_d°
),

441 
ROP2
(
cúrus_∑âînfûl_nŸ§c_‹_nŸd°
),

442 
ROP2
(
cúrus_∑âînfûl_§c_nŸx‹_d°
),

443 
ROP2
(
cúrus_∑âînfûl_§c_‹_nŸd°
),

444 
ROP2
(
cúrus_∑âînfûl_nŸ§c
),

445 
ROP2
(
cúrus_∑âînfûl_nŸ§c_‹_d°
),

446 
ROP2
(
cúrus_∑âînfûl_nŸ§c_™d_nŸd°
),

449 c⁄° 
cúrus_bôb…_r›_t
 
	gcúrus_cﬁ‹ex∑nd_å™•
[16][4] = {

450 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_0
),

451 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_§c_™d_d°
),

452 
ROP_NOP2
(
cúrus_bôb…_r›_n›
),

453 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_§c_™d_nŸd°
),

454 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_nŸd°
),

455 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_§c
),

456 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_1
),

457 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_nŸ§c_™d_d°
),

458 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_§c_x‹_d°
),

459 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_§c_‹_d°
),

460 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_nŸ§c_‹_nŸd°
),

461 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_§c_nŸx‹_d°
),

462 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_§c_‹_nŸd°
),

463 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_nŸ§c
),

464 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_nŸ§c_‹_d°
),

465 
ROP2
(
cúrus_cﬁ‹ex∑nd_å™•_nŸ§c_™d_nŸd°
),

468 c⁄° 
cúrus_bôb…_r›_t
 
	gcúrus_cﬁ‹ex∑nd
[16][4] = {

469 
ROP2
(
cúrus_cﬁ‹ex∑nd_0
),

470 
ROP2
(
cúrus_cﬁ‹ex∑nd_§c_™d_d°
),

471 
ROP_NOP2
(
cúrus_bôb…_r›_n›
),

472 
ROP2
(
cúrus_cﬁ‹ex∑nd_§c_™d_nŸd°
),

473 
ROP2
(
cúrus_cﬁ‹ex∑nd_nŸd°
),

474 
ROP2
(
cúrus_cﬁ‹ex∑nd_§c
),

475 
ROP2
(
cúrus_cﬁ‹ex∑nd_1
),

476 
ROP2
(
cúrus_cﬁ‹ex∑nd_nŸ§c_™d_d°
),

477 
ROP2
(
cúrus_cﬁ‹ex∑nd_§c_x‹_d°
),

478 
ROP2
(
cúrus_cﬁ‹ex∑nd_§c_‹_d°
),

479 
ROP2
(
cúrus_cﬁ‹ex∑nd_nŸ§c_‹_nŸd°
),

480 
ROP2
(
cúrus_cﬁ‹ex∑nd_§c_nŸx‹_d°
),

481 
ROP2
(
cúrus_cﬁ‹ex∑nd_§c_‹_nŸd°
),

482 
ROP2
(
cúrus_cﬁ‹ex∑nd_nŸ§c
),

483 
ROP2
(
cúrus_cﬁ‹ex∑nd_nŸ§c_‹_d°
),

484 
ROP2
(
cúrus_cﬁ‹ex∑nd_nŸ§c_™d_nŸd°
),

487 c⁄° 
cúrus_bôb…_r›_t
 
	gcúrus_cﬁ‹ex∑nd_∑âîn_å™•
[16][4] = {

488 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_0
),

489 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_§c_™d_d°
),

490 
ROP_NOP2
(
cúrus_bôb…_r›_n›
),

491 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_§c_™d_nŸd°
),

492 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_nŸd°
),

493 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_§c
),

494 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_1
),

495 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_nŸ§c_™d_d°
),

496 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_§c_x‹_d°
),

497 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_§c_‹_d°
),

498 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_nŸ§c_‹_nŸd°
),

499 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_§c_nŸx‹_d°
),

500 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_§c_‹_nŸd°
),

501 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_nŸ§c
),

502 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_nŸ§c_‹_d°
),

503 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_nŸ§c_™d_nŸd°
),

506 c⁄° 
cúrus_bôb…_r›_t
 
	gcúrus_cﬁ‹ex∑nd_∑âîn
[16][4] = {

507 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_0
),

508 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_§c_™d_d°
),

509 
ROP_NOP2
(
cúrus_bôb…_r›_n›
),

510 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_§c_™d_nŸd°
),

511 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_nŸd°
),

512 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_§c
),

513 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_1
),

514 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_nŸ§c_™d_d°
),

515 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_§c_x‹_d°
),

516 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_§c_‹_d°
),

517 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_nŸ§c_‹_nŸd°
),

518 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_§c_nŸx‹_d°
),

519 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_§c_‹_nŸd°
),

520 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_nŸ§c
),

521 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_nŸ§c_‹_d°
),

522 
ROP2
(
cúrus_cﬁ‹ex∑nd_∑âîn_nŸ§c_™d_nŸd°
),

525 c⁄° 
cúrus_fûl_t
 
	gcúrus_fûl
[16][4] = {

526 
ROP2
(
cúrus_fûl_0
),

527 
ROP2
(
cúrus_fûl_§c_™d_d°
),

528 
ROP_NOP2
(
cúrus_bôb…_fûl_n›
),

529 
ROP2
(
cúrus_fûl_§c_™d_nŸd°
),

530 
ROP2
(
cúrus_fûl_nŸd°
),

531 
ROP2
(
cúrus_fûl_§c
),

532 
ROP2
(
cúrus_fûl_1
),

533 
ROP2
(
cúrus_fûl_nŸ§c_™d_d°
),

534 
ROP2
(
cúrus_fûl_§c_x‹_d°
),

535 
ROP2
(
cúrus_fûl_§c_‹_d°
),

536 
ROP2
(
cúrus_fûl_nŸ§c_‹_nŸd°
),

537 
ROP2
(
cúrus_fûl_§c_nŸx‹_d°
),

538 
ROP2
(
cúrus_fûl_§c_‹_nŸd°
),

539 
ROP2
(
cúrus_fûl_nŸ§c
),

540 
ROP2
(
cúrus_fûl_nŸ§c_‹_d°
),

541 
ROP2
(
cúrus_fûl_nŸ§c_™d_nŸd°
),

544 
ölöe
 
	$cúrus_bôb…_fgcﬁ
(
CúrusVGASèã
 *
s
)

546 
cﬁ‹
;

547 
s
->
cúrus_b…_pixñwidth
) {

549 
s
->
cúrus_b…_fgcﬁ
 = s->
cúrus_shadow_gr1
;

552 
cﬁ‹
 = 
s
->
cúrus_shadow_gr1
 | (s->
gr
[0x11] << 8);

553 
s
->
cúrus_b…_fgcﬁ
 = 
	`À16_to_˝u
(
cﬁ‹
);

556 
s
->
cúrus_b…_fgcﬁ
 = s->
cúrus_shadow_gr1
 |

557 (
s
->
gr
[0x11] << 8) | (s->gr[0x13] << 16);

561 
cﬁ‹
 = 
s
->
cúrus_shadow_gr1
 | (s->
gr
[0x11] << 8) |

562 (
s
->
gr
[0x13] << 16) | (s->gr[0x15] << 24);

563 
s
->
cúrus_b…_fgcﬁ
 = 
	`À32_to_˝u
(
cﬁ‹
);

566 
	}
}

568 
ölöe
 
	$cúrus_bôb…_bgcﬁ
(
CúrusVGASèã
 *
s
)

570 
cﬁ‹
;

571 
s
->
cúrus_b…_pixñwidth
) {

573 
s
->
cúrus_b…_bgcﬁ
 = s->
cúrus_shadow_gr0
;

576 
cﬁ‹
 = 
s
->
cúrus_shadow_gr0
 | (s->
gr
[0x10] << 8);

577 
s
->
cúrus_b…_bgcﬁ
 = 
	`À16_to_˝u
(
cﬁ‹
);

580 
s
->
cúrus_b…_bgcﬁ
 = s->
cúrus_shadow_gr0
 |

581 (
s
->
gr
[0x10] << 8) | (s->gr[0x12] << 16);

585 
cﬁ‹
 = 
s
->
cúrus_shadow_gr0
 | (s->
gr
[0x10] << 8) |

586 (
s
->
gr
[0x12] << 16) | (s->gr[0x14] << 24);

587 
s
->
cúrus_b…_bgcﬁ
 = 
	`À32_to_˝u
(
cﬁ‹
);

590 
	}
}

592 
	$cúrus_övÆid©e_ªgi⁄
(
CúrusVGASèã
 * 
s
, 
off_begö
,

593 
off_pôch
, 
byã•îlöe
,

594 
löes
)

596 
y
;

597 
off_cur
;

598 
off_cur_íd
;

600 
y
 = 0; y < 
löes
; y++) {

601 
off_cur
 = 
off_begö
;

602 
off_cur_íd
 = 
off_cur
 + 
byã•îlöe
;

603 
off_cur
 &
TARGET_PAGE_MASK
;

604 
off_cur
 < 
off_cur_íd
) {

605 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 +

606 (
off_cur
 & 
s
->
cúrus_addr_mask
));

607 
off_cur
 +
TARGET_PAGE_SIZE
;

609 
off_begö
 +
off_pôch
;

611 
	}
}

613 
	$cúrus_bôb…_comm⁄_∑âînc›y
(
CúrusVGASèã
 * 
s
,

614 c⁄° 
uöt8_t
 * 
§c
)

616 
uöt8_t
 *
d°
;

618 
d°
 = 
s
->
vøm_±r
 + s->
cúrus_b…_d°addr
;

619 (*
s
->
cúrus_r›
Ë(s, 
d°
, 
§c
,

620 
s
->
cúrus_b…_d°pôch
, 0,

621 
s
->
cúrus_b…_width
, s->
cúrus_b…_height
);

622 
	`cúrus_övÆid©e_ªgi⁄
(
s
, s->
cúrus_b…_d°addr
,

623 
s
->
cúrus_b…_d°pôch
, s->
cúrus_b…_width
,

624 
s
->
cúrus_b…_height
);

626 
	}
}

630 
	$cúrus_bôb…_sﬁidfûl
(
CúrusVGASèã
 *
s
, 
b…_r›
)

632 
cúrus_fûl_t
 
r›_func
;

634 
r›_func
 = 
cúrus_fûl
[
r›_to_ödex
[
b…_r›
]][
s
->
cúrus_b…_pixñwidth
 - 1];

635 
	`r›_func
(
s
, s->
vøm_±r
 + s->
cúrus_b…_d°addr
,

636 
s
->
cúrus_b…_d°pôch
,

637 
s
->
cúrus_b…_width
, s->
cúrus_b…_height
);

638 
	`cúrus_övÆid©e_ªgi⁄
(
s
, s->
cúrus_b…_d°addr
,

639 
s
->
cúrus_b…_d°pôch
, s->
cúrus_b…_width
,

640 
s
->
cúrus_b…_height
);

641 
	`cúrus_bôb…_ª£t
(
s
);

643 
	}
}

651 
	$cúrus_bôb…_videŸovideo_∑âînc›y
(
CúrusVGASèã
 * 
s
)

653  
	`cúrus_bôb…_comm⁄_∑âînc›y
(
s
,

654 
s
->
vøm_±r
 +

655 (
s
->
cúrus_b…_§ˇddr
 & ~7));

656 
	}
}

658 
	$cúrus_do_c›y
(
CúrusVGASèã
 *
s
, 
d°
, 
§c
, 
w
, 
h
)

660 
sx
, 
sy
;

661 
dx
, 
dy
;

662 
width
, 
height
;

663 
dïth
;

664 
nŸify
 = 0;

666 
dïth
 = 
s
->
	`gë_bµ
((
VGASèã
 *)s) / 8;

667 
s
->
	`gë_ªsﬁuti⁄
((
VGASèã
 *)s, &
width
, &
height
);

670 
sx
 = (
§c
 % (
width
 * 
dïth
)) / depth;

671 
sy
 = (
§c
 / (
width
 * 
dïth
));

672 
dx
 = (
d°
 % (
width
 *
dïth
)) / depth;

673 
dy
 = (
d°
 / (
width
 * 
dïth
));

676 
w
 /
dïth
;

681 i‡(
s
->
cúrus_b…_d°pôch
 < 0) {

682 
sx
 -(
s
->
cúrus_b…_width
 / 
dïth
) - 1;

683 
dx
 -(
s
->
cúrus_b…_width
 / 
dïth
) - 1;

684 
sy
 -
s
->
cúrus_b…_height
 - 1;

685 
dy
 -
s
->
cúrus_b…_height
 - 1;

689 i‡(
sx
 >0 && 
sy
 >0 && 
dx
 >0 && 
dy
 >= 0 &&

690 (
sx
 + 
w
Ë<
width
 && (
sy
 + 
h
Ë<
height
 &&

691 (
dx
 + 
w
Ë<
width
 && (
dy
 + 
h
Ë<
height
) {

692 
nŸify
 = 1;

696 i‡(*
s
->
cúrus_r›
 !
cúrus_bôb…_r›_fwd_§c
 &&

697 *
s
->
cúrus_r›
 !
cúrus_bôb…_r›_bkwd_§c
)

698 
nŸify
 = 0;

702 i‡(
nŸify
)

703 
	`vga_hw_upd©e
();

705 (*
s
->
cúrus_r›
Ë(s, s->
vøm_±r
 + s->
cúrus_b…_d°addr
,

706 
s
->
vøm_±r
 + s->
cúrus_b…_§ˇddr
,

707 
s
->
cúrus_b…_d°pôch
, s->
cúrus_b…_§˝ôch
,

708 
s
->
cúrus_b…_width
, s->
cúrus_b…_height
);

710 i‡(
nŸify
)

711 
s
->
ds
->
	`dpy_c›y
(s->ds,

712 
sx
, 
sy
, 
dx
, 
dy
,

713 
s
->
cúrus_b…_width
 / 
dïth
,

714 
s
->
cúrus_b…_height
);

719 i‡(!
nŸify
)

720 
	`cúrus_övÆid©e_ªgi⁄
(
s
, s->
cúrus_b…_d°addr
,

721 
s
->
cúrus_b…_d°pôch
, s->
cúrus_b…_width
,

722 
s
->
cúrus_b…_height
);

723 
	}
}

725 
	$cúrus_bôb…_videŸovideo_c›y
(
CúrusVGASèã
 * 
s
)

727 i‡(
s
->
ds
->
dpy_c›y
) {

728 
	`cúrus_do_c›y
(
s
, s->
cúrus_b…_d°addr
 - s->
°¨t_addr
,

729 
s
->
cúrus_b…_§ˇddr
 - s->
°¨t_addr
,

730 
s
->
cúrus_b…_width
, s->
cúrus_b…_height
);

732 (*
s
->
cúrus_r›
Ë(s, s->
vøm_±r
 + s->
cúrus_b…_d°addr
,

733 
s
->
vøm_±r
 + s->
cúrus_b…_§ˇddr
,

734 
s
->
cúrus_b…_d°pôch
, s->
cúrus_b…_§˝ôch
,

735 
s
->
cúrus_b…_width
, s->
cúrus_b…_height
);

737 
	`cúrus_övÆid©e_ªgi⁄
(
s
, s->
cúrus_b…_d°addr
,

738 
s
->
cúrus_b…_d°pôch
, s->
cúrus_b…_width
,

739 
s
->
cúrus_b…_height
);

743 
	}
}

751 
	$cúrus_bôb…_˝utovideo_√xt
(
CúrusVGASèã
 * 
s
)

753 
c›y_cou¡
;

754 
uöt8_t
 *
íd_±r
;

756 i‡(
s
->
cúrus_§ccou¡î
 > 0) {

757 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_PATTERNCOPY
) {

758 
	`cúrus_bôb…_comm⁄_∑âînc›y
(
s
, s->
cúrus_b…buf
);

759 
the_íd
:

760 
s
->
cúrus_§ccou¡î
 = 0;

761 
	`cúrus_bôb…_ª£t
(
s
);

765 (*
s
->
cúrus_r›
)(s, s->
vøm_±r
 + s->
cúrus_b…_d°addr
,

766 
s
->
cúrus_b…buf
, 0, 0, s->
cúrus_b…_width
, 1);

767 
	`cúrus_övÆid©e_ªgi⁄
(
s
, s->
cúrus_b…_d°addr
, 0,

768 
s
->
cúrus_b…_width
, 1);

769 
s
->
cúrus_b…_d°addr
 +s->
cúrus_b…_d°pôch
;

770 
s
->
cúrus_§ccou¡î
 -s->
cúrus_b…_§˝ôch
;

771 i‡(
s
->
cúrus_§ccou¡î
 <= 0)

772 
the_íd
;

776 
íd_±r
 = 
s
->
cúrus_b…buf
 + s->
cúrus_b…_§˝ôch
;

777 
c›y_cou¡
 = 
s
->
cúrus_§˝å_íd
 - 
íd_±r
;

778 
	`memmove
(
s
->
cúrus_b…buf
, 
íd_±r
, 
c›y_cou¡
);

779 
s
->
cúrus_§˝å
 = s->
cúrus_b…buf
 + 
c›y_cou¡
;

780 
s
->
cúrus_§˝å_íd
 = s->
cúrus_b…buf
 + s->
cúrus_b…_§˝ôch
;

781 } 
s
->
cúrus_§˝å
 >s->
cúrus_§˝å_íd
);

784 
	}
}

792 
	$cúrus_bôb…_ª£t
(
CúrusVGASèã
 * 
s
)

794 
s
->
gr
[0x31] &=

795 ~(
CIRRUS_BLT_START
 | 
CIRRUS_BLT_BUSY
 | 
CIRRUS_BLT_FIFOUSED
);

796 
s
->
cúrus_§˝å
 = &s->
cúrus_b…buf
[0];

797 
s
->
cúrus_§˝å_íd
 = &s->
cúrus_b…buf
[0];

798 
s
->
cúrus_§ccou¡î
 = 0;

799 
	`cúrus_upd©e_mem‹y_ac˚ss
(
s
);

800 
	}
}

802 
	$cúrus_bôb…_˝utovideo
(
CúrusVGASèã
 * 
s
)

804 
w
;

806 
s
->
cúrus_b…_mode
 &~
CIRRUS_BLTMODE_MEMSYSSRC
;

807 
s
->
cúrus_§˝å
 = &s->
cúrus_b…buf
[0];

808 
s
->
cúrus_§˝å_íd
 = &s->
cúrus_b…buf
[0];

810 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_PATTERNCOPY
) {

811 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_COLOREXPAND
) {

812 
s
->
cúrus_b…_§˝ôch
 = 8;

815 
s
->
cúrus_b…_§˝ôch
 = 8 * 8 * s->
cúrus_b…_pixñwidth
;

817 
s
->
cúrus_§ccou¡î
 = s->
cúrus_b…_§˝ôch
;

819 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_COLOREXPAND
) {

820 
w
 = 
s
->
cúrus_b…_width
 / s->
cúrus_b…_pixñwidth
;

821 i‡(
s
->
cúrus_b…_modìxt
 & 
CIRRUS_BLTMODEEXT_DWORDGRANULARITY
)

822 
s
->
cúrus_b…_§˝ôch
 = ((
w
 + 31) >> 5);

824 
s
->
cúrus_b…_§˝ôch
 = ((
w
 + 7) >> 3);

827 
s
->
cúrus_b…_§˝ôch
 = (s->
cúrus_b…_width
 + 3) & ~3;

829 
s
->
cúrus_§ccou¡î
 = s->
cúrus_b…_§˝ôch
 * s->
cúrus_b…_height
;

831 
s
->
cúrus_§˝å
 = s->
cúrus_b…buf
;

832 
s
->
cúrus_§˝å_íd
 = s->
cúrus_b…buf
 + s->
cúrus_b…_§˝ôch
;

833 
	`cúrus_upd©e_mem‹y_ac˚ss
(
s
);

835 
	}
}

837 
	$cúrus_bôb…_videŸo˝u
(
CúrusVGASèã
 * 
s
)

840 #ifde‡
DEBUG_BITBLT


841 
	`¥ötf
("cirrus: bitblt (videoÅo cpu) isÇot implemented yet\n");

844 
	}
}

846 
	$cúrus_bôb…_videŸovideo
(
CúrusVGASèã
 * 
s
)

848 
ªt
;

850 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_PATTERNCOPY
) {

851 
ªt
 = 
	`cúrus_bôb…_videŸovideo_∑âînc›y
(
s
);

853 
ªt
 = 
	`cúrus_bôb…_videŸovideo_c›y
(
s
);

855 i‡(
ªt
)

856 
	`cúrus_bôb…_ª£t
(
s
);

857  
ªt
;

858 
	}
}

860 
	$cúrus_bôb…_°¨t
(
CúrusVGASèã
 * 
s
)

862 
uöt8_t
 
b…_r›
;

864 
s
->
gr
[0x31] |
CIRRUS_BLT_BUSY
;

866 
s
->
cúrus_b…_width
 = (s->
gr
[0x20] | (s->gr[0x21] << 8)) + 1;

867 
s
->
cúrus_b…_height
 = (s->
gr
[0x22] | (s->gr[0x23] << 8)) + 1;

868 
s
->
cúrus_b…_d°pôch
 = (s->
gr
[0x24] | (s->gr[0x25] << 8));

869 
s
->
cúrus_b…_§˝ôch
 = (s->
gr
[0x26] | (s->gr[0x27] << 8));

870 
s
->
cúrus_b…_d°addr
 =

871 (
s
->
gr
[0x28] | (s->gr[0x29] << 8) | (s->gr[0x2a] << 16));

872 
s
->
cúrus_b…_§ˇddr
 =

873 (
s
->
gr
[0x2c] | (s->gr[0x2d] << 8) | (s->gr[0x2e] << 16));

874 
s
->
cúrus_b…_mode
 = s->
gr
[0x30];

875 
s
->
cúrus_b…_modìxt
 = s->
gr
[0x33];

876 
b…_r›
 = 
s
->
gr
[0x32];

878 #ifde‡
DEBUG_BITBLT


879 
	`¥ötf
("rop=0x%02x mode=0x%02x modeext=0x%02x w=%d h=%d dpitch=%d spitch=%d daddr=0x%08x saddr=0x%08x writemask=0x%02x\n",

880 
b…_r›
,

881 
s
->
cúrus_b…_mode
,

882 
s
->
cúrus_b…_modìxt
,

883 
s
->
cúrus_b…_width
,

884 
s
->
cúrus_b…_height
,

885 
s
->
cúrus_b…_d°pôch
,

886 
s
->
cúrus_b…_§˝ôch
,

887 
s
->
cúrus_b…_d°addr
,

888 
s
->
cúrus_b…_§ˇddr
,

889 
s
->
gr
[0x2f]);

892 
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_PIXELWIDTHMASK
) {

893 
CIRRUS_BLTMODE_PIXELWIDTH8
:

894 
s
->
cúrus_b…_pixñwidth
 = 1;

896 
CIRRUS_BLTMODE_PIXELWIDTH16
:

897 
s
->
cúrus_b…_pixñwidth
 = 2;

899 
CIRRUS_BLTMODE_PIXELWIDTH24
:

900 
s
->
cúrus_b…_pixñwidth
 = 3;

902 
CIRRUS_BLTMODE_PIXELWIDTH32
:

903 
s
->
cúrus_b…_pixñwidth
 = 4;

906 #ifde‡
DEBUG_BITBLT


907 
	`¥ötf
("cirrus: bitblt -Öixel width is unknown\n");

909 
bôb…_ign‹e
;

911 
s
->
cúrus_b…_mode
 &~
CIRRUS_BLTMODE_PIXELWIDTHMASK
;

913 i‡((
s
->

914 
cúrus_b…_mode
 & (
CIRRUS_BLTMODE_MEMSYSSRC
 |

915 
CIRRUS_BLTMODE_MEMSYSDEST
))

916 =(
CIRRUS_BLTMODE_MEMSYSSRC
 | 
CIRRUS_BLTMODE_MEMSYSDEST
)) {

917 #ifde‡
DEBUG_BITBLT


918 
	`¥ötf
("cirrus: bitblt - memory-to-memory copy isÑequested\n");

920 
bôb…_ign‹e
;

923 i‡((
s
->
cúrus_b…_modìxt
 & 
CIRRUS_BLTMODEEXT_SOLIDFILL
) &&

924 (
s
->
cúrus_b…_mode
 & (
CIRRUS_BLTMODE_MEMSYSDEST
 |

925 
CIRRUS_BLTMODE_TRANSPARENTCOMP
 |

926 
CIRRUS_BLTMODE_PATTERNCOPY
 |

927 
CIRRUS_BLTMODE_COLOREXPAND
)) ==

928 (
CIRRUS_BLTMODE_PATTERNCOPY
 | 
CIRRUS_BLTMODE_COLOREXPAND
)) {

929 
	`cúrus_bôb…_fgcﬁ
(
s
);

930 
	`cúrus_bôb…_sﬁidfûl
(
s
, 
b…_r›
);

932 i‡((
s
->
cúrus_b…_mode
 & (
CIRRUS_BLTMODE_COLOREXPAND
 |

933 
CIRRUS_BLTMODE_PATTERNCOPY
)) ==

934 
CIRRUS_BLTMODE_COLOREXPAND
) {

936 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_TRANSPARENTCOMP
) {

937 i‡(
s
->
cúrus_b…_modìxt
 & 
CIRRUS_BLTMODEEXT_COLOREXPINV
)

938 
	`cúrus_bôb…_bgcﬁ
(
s
);

940 
	`cúrus_bôb…_fgcﬁ
(
s
);

941 
s
->
cúrus_r›
 = 
cúrus_cﬁ‹ex∑nd_å™•
[
r›_to_ödex
[
b…_r›
]][s->
cúrus_b…_pixñwidth
 - 1];

943 
	`cúrus_bôb…_fgcﬁ
(
s
);

944 
	`cúrus_bôb…_bgcﬁ
(
s
);

945 
s
->
cúrus_r›
 = 
cúrus_cﬁ‹ex∑nd
[
r›_to_ödex
[
b…_r›
]][s->
cúrus_b…_pixñwidth
 - 1];

947 } i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_PATTERNCOPY
) {

948 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_COLOREXPAND
) {

949 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_TRANSPARENTCOMP
) {

950 i‡(
s
->
cúrus_b…_modìxt
 & 
CIRRUS_BLTMODEEXT_COLOREXPINV
)

951 
	`cúrus_bôb…_bgcﬁ
(
s
);

953 
	`cúrus_bôb…_fgcﬁ
(
s
);

954 
s
->
cúrus_r›
 = 
cúrus_cﬁ‹ex∑nd_∑âîn_å™•
[
r›_to_ödex
[
b…_r›
]][s->
cúrus_b…_pixñwidth
 - 1];

956 
	`cúrus_bôb…_fgcﬁ
(
s
);

957 
	`cúrus_bôb…_bgcﬁ
(
s
);

958 
s
->
cúrus_r›
 = 
cúrus_cﬁ‹ex∑nd_∑âîn
[
r›_to_ödex
[
b…_r›
]][s->
cúrus_b…_pixñwidth
 - 1];

961 
s
->
cúrus_r›
 = 
cúrus_∑âînfûl
[
r›_to_ödex
[
b…_r›
]][s->
cúrus_b…_pixñwidth
 - 1];

964 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_BACKWARDS
) {

965 
s
->
cúrus_b…_d°pôch
 = -s->cirrus_blt_dstpitch;

966 
s
->
cúrus_b…_§˝ôch
 = -s->cirrus_blt_srcpitch;

967 
s
->
cúrus_r›
 = 
cúrus_bkwd_r›
[
r›_to_ödex
[
b…_r›
]];

969 
s
->
cúrus_r›
 = 
cúrus_fwd_r›
[
r›_to_ödex
[
b…_r›
]];

974 i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_MEMSYSSRC
) {

975 i‡(!
	`cúrus_bôb…_˝utovideo
(
s
))

976 
bôb…_ign‹e
;

977 } i‡(
s
->
cúrus_b…_mode
 & 
CIRRUS_BLTMODE_MEMSYSDEST
) {

978 i‡(!
	`cúrus_bôb…_videŸo˝u
(
s
))

979 
bôb…_ign‹e
;

981 i‡(!
	`cúrus_bôb…_videŸovideo
(
s
))

982 
bôb…_ign‹e
;

986 
bôb…_ign‹e
:;

987 
	`cúrus_bôb…_ª£t
(
s
);

988 
	}
}

990 
	$cúrus_wrôe_bôb…
(
CúrusVGASèã
 * 
s
, 
ªg_vÆue
)

992 
ﬁd_vÆue
;

994 
ﬁd_vÆue
 = 
s
->
gr
[0x31];

995 
s
->
gr
[0x31] = 
ªg_vÆue
;

997 i‡(((
ﬁd_vÆue
 & 
CIRRUS_BLT_RESET
) != 0) &&

998 ((
ªg_vÆue
 & 
CIRRUS_BLT_RESET
) == 0)) {

999 
	`cúrus_bôb…_ª£t
(
s
);

1000 } i‡(((
ﬁd_vÆue
 & 
CIRRUS_BLT_START
) == 0) &&

1001 ((
ªg_vÆue
 & 
CIRRUS_BLT_START
) != 0)) {

1002 
	`cúrus_bôb…_°¨t
(
s
);

1004 
	}
}

1013 
	$cúrus_gë_off£ts
(
VGASèã
 *
s1
,

1014 
uöt32_t
 *
∂öe_off£t
,

1015 
uöt32_t
 *
p°¨t_addr
,

1016 
uöt32_t
 *
∂öe_com∑ª
)

1018 
CúrusVGASèã
 * 
s
 = (CúrusVGASèã *)
s1
;

1019 
uöt32_t
 
°¨t_addr
, 
löe_off£t
, 
löe_com∑ª
;

1021 
löe_off£t
 = 
s
->
¸
[0x13]

1022 | ((
s
->
¸
[0x1b] & 0x10) << 4);

1023 
löe_off£t
 <<= 3;

1024 *
∂öe_off£t
 = 
löe_off£t
;

1026 
°¨t_addr
 = (
s
->
¸
[0x0c] << 8)

1027 | 
s
->
¸
[0x0d]

1028 | ((
s
->
¸
[0x1b] & 0x01) << 16)

1029 | ((
s
->
¸
[0x1b] & 0x0c) << 15)

1030 | ((
s
->
¸
[0x1d] & 0x80) << 12);

1031 *
p°¨t_addr
 = 
°¨t_addr
;

1033 
löe_com∑ª
 = 
s
->
¸
[0x18] |

1034 ((
s
->
¸
[0x07] & 0x10) << 4) |

1035 ((
s
->
¸
[0x09] & 0x40) << 3);

1036 *
∂öe_com∑ª
 = 
löe_com∑ª
;

1037 
	}
}

1039 
uöt32_t
 
	$cúrus_gë_bµ16_dïth
(
CúrusVGASèã
 * 
s
)

1041 
uöt32_t
 
ªt
 = 16;

1043 
s
->
cúrus_hiddí_dac_d©a
 & 0xf) {

1045 
ªt
 = 15;

1048 
ªt
 = 16;

1051 #ifde‡
DEBUG_CIRRUS


1052 
	`¥ötf
("cirrus: invalid DAC value %x in 16bpp\n",

1053 (
s
->
cúrus_hiddí_dac_d©a
 & 0xf));

1055 
ªt
 = 15;

1058  
ªt
;

1059 
	}
}

1061 
	$cúrus_gë_bµ
(
VGASèã
 *
s1
)

1063 
CúrusVGASèã
 * 
s
 = (CúrusVGASèã *)
s1
;

1064 
uöt32_t
 
ªt
 = 8;

1066 i‡((
s
->
§
[0x07] & 0x01) != 0) {

1068 
s
->
§
[0x07] & 
CIRRUS_SR7_BPP_MASK
) {

1069 
CIRRUS_SR7_BPP_8
:

1070 
ªt
 = 8;

1072 
CIRRUS_SR7_BPP_16_DOUBLEVCLK
:

1073 
ªt
 = 
	`cúrus_gë_bµ16_dïth
(
s
);

1075 
CIRRUS_SR7_BPP_24
:

1076 
ªt
 = 24;

1078 
CIRRUS_SR7_BPP_16
:

1079 
ªt
 = 
	`cúrus_gë_bµ16_dïth
(
s
);

1081 
CIRRUS_SR7_BPP_32
:

1082 
ªt
 = 32;

1085 #ifde‡
DEBUG_CIRRUS


1086 
	`¥ötf
("cúrus: unknow¿bµ - sr7=%x\n", 
s
->
§
[0x7]);

1088 
ªt
 = 8;

1093 
ªt
 = 0;

1096  
ªt
;

1097 
	}
}

1099 
	$cúrus_gë_ªsﬁuti⁄
(
VGASèã
 *
s
, *
pwidth
, *
pheight
)

1101 
width
, 
height
;

1103 
width
 = (
s
->
¸
[0x01] + 1) * 8;

1104 
height
 = 
s
->
¸
[0x12] |

1105 ((
s
->
¸
[0x07] & 0x02) << 7) |

1106 ((
s
->
¸
[0x07] & 0x40) << 3);

1107 
height
 = (height + 1);

1109 i‡(
s
->
¸
[0x1a] & 0x01)

1110 
height
 = height * 2;

1111 *
pwidth
 = 
width
;

1112 *
pheight
 = 
height
;

1113 
	}
}

1121 
	$cúrus_upd©e_b™k_±r
(
CúrusVGASèã
 * 
s
, 
b™k_ödex
)

1123 
off£t
;

1124 
limô
;

1126 i‡((
s
->
gr
[0x0b] & 0x01) != 0)

1127 
off£t
 = 
s
->
gr
[0x09 + 
b™k_ödex
];

1129 
off£t
 = 
s
->
gr
[0x09];

1131 i‡((
s
->
gr
[0x0b] & 0x20) != 0)

1132 
off£t
 <<= 14;

1134 
off£t
 <<= 12;

1136 i‡(
s
->
ªÆ_vøm_size
 <
off£t
)

1137 
limô
 = 0;

1139 
limô
 = 
s
->
ªÆ_vøm_size
 - 
off£t
;

1141 i‡(((
s
->
gr
[0x0b] & 0x01Ë=0Ë&& (
b™k_ödex
 != 0)) {

1142 i‡(
limô
 > 0x8000) {

1143 
off£t
 += 0x8000;

1144 
limô
 -= 0x8000;

1146 
limô
 = 0;

1150 i‡(
limô
 > 0) {

1151 
s
->
cúrus_b™k_ba£
[
b™k_ödex
] = 
off£t
;

1152 
s
->
cúrus_b™k_limô
[
b™k_ödex
] = 
limô
;

1154 
s
->
cúrus_b™k_ba£
[
b™k_ödex
] = 0;

1155 
s
->
cúrus_b™k_limô
[
b™k_ödex
] = 0;

1157 
	}
}

1166 
	$cúrus_hook_ªad_§
(
CúrusVGASèã
 * 
s
, 
ªg_ödex
, *
ªg_vÆue
)

1168 
ªg_ödex
) {

1174  
CIRRUS_HOOK_NOT_HANDLED
;

1176 *
ªg_vÆue
 = 
s
->
§
[
ªg_ödex
];

1186 *
ªg_vÆue
 = 
s
->
§
[0x10];

1196 *
ªg_vÆue
 = 
s
->
§
[0x11];

1222 #ifde‡
DEBUG_CIRRUS


1223 
	`¥ötf
("cúrus: h™dÀd i≈‹à§_ödex %02x\n", 
ªg_ödex
);

1225 *
ªg_vÆue
 = 
s
->
§
[
ªg_ödex
];

1228 #ifde‡
DEBUG_CIRRUS


1229 
	`¥ötf
("cúrus: i≈‹à§_ödex %02x\n", 
ªg_ödex
);

1231 *
ªg_vÆue
 = 0xff;

1235  
CIRRUS_HOOK_HANDLED
;

1236 
	}
}

1239 
	$cúrus_hook_wrôe_§
(
CúrusVGASèã
 * 
s
, 
ªg_ödex
, 
ªg_vÆue
)

1241 
ªg_ödex
) {

1247  
CIRRUS_HOOK_NOT_HANDLED
;

1249 
ªg_vÆue
 &= 0x17;

1250 i‡(
ªg_vÆue
 == 0x12) {

1251 
s
->
§
[
ªg_ödex
] = 0x12;

1253 
s
->
§
[
ªg_ödex
] = 0x0f;

1264 
s
->
§
[0x10] = 
ªg_vÆue
;

1265 
s
->
hw_curs‹_x
 = (
ªg_vÆue
 << 3Ë| (
ªg_ödex
 >> 5);

1275 
s
->
§
[0x11] = 
ªg_vÆue
;

1276 
s
->
hw_curs‹_y
 = (
ªg_vÆue
 << 3Ë| (
ªg_ödex
 >> 5);

1300 
s
->
§
[
ªg_ödex
] = 
ªg_vÆue
;

1301 #ifde‡
DEBUG_CIRRUS


1302 
	`¥ötf
("cirrus: handled outport sr_index %02x, sr_value %02x\n",

1303 
ªg_ödex
, 
ªg_vÆue
);

1307 
s
->
§
[
ªg_ödex
] = (s->§[ªg_ödex] & 0x38Ë| (
ªg_vÆue
 & 0xc7);

1308 
	`cúrus_upd©e_mem‹y_ac˚ss
(
s
);

1311 #ifde‡
DEBUG_CIRRUS


1312 
	`¥ötf
("cúrus: ouç‹à§_ödex %02x, sr_vÆuê%02x\n", 
ªg_ödex
,

1313 
ªg_vÆue
);

1318  
CIRRUS_HOOK_HANDLED
;

1319 
	}
}

1327 
	$cúrus_ªad_hiddí_dac
(
CúrusVGASèã
 * 
s
, *
ªg_vÆue
)

1329 *
ªg_vÆue
 = 0xff;

1330 i‡(++
s
->
cúrus_hiddí_dac_locködex
 == 5) {

1331 *
ªg_vÆue
 = 
s
->
cúrus_hiddí_dac_d©a
;

1332 
s
->
cúrus_hiddí_dac_locködex
 = 0;

1334 
	}
}

1336 
	$cúrus_wrôe_hiddí_dac
(
CúrusVGASèã
 * 
s
, 
ªg_vÆue
)

1338 i‡(
s
->
cúrus_hiddí_dac_locködex
 == 4) {

1339 
s
->
cúrus_hiddí_dac_d©a
 = 
ªg_vÆue
;

1340 #i‡
	`deföed
(
DEBUG_CIRRUS
)

1341 
	`¥ötf
("cúrus: ouç‹àhiddí DAC, vÆuê%02x\n", 
ªg_vÆue
);

1344 
s
->
cúrus_hiddí_dac_locködex
 = 0;

1345 
	}
}

1353 
	$cúrus_hook_ªad_∑Àâe
(
CúrusVGASèã
 * 
s
, *
ªg_vÆue
)

1355 i‡(!(
s
->
§
[0x12] & 
CIRRUS_CURSOR_HIDDENPEL
))

1356  
CIRRUS_HOOK_NOT_HANDLED
;

1357 *
ªg_vÆue
 =

1358 
s
->
cúrus_hiddí_∑Àâe
[(s->
dac_ªad_ödex
 & 0x0f) * 3 +

1359 
s
->
dac_sub_ödex
];

1360 i‡(++
s
->
dac_sub_ödex
 == 3) {

1361 
s
->
dac_sub_ödex
 = 0;

1362 
s
->
dac_ªad_ödex
++;

1364  
CIRRUS_HOOK_HANDLED
;

1365 
	}
}

1367 
	$cúrus_hook_wrôe_∑Àâe
(
CúrusVGASèã
 * 
s
, 
ªg_vÆue
)

1369 i‡(!(
s
->
§
[0x12] & 
CIRRUS_CURSOR_HIDDENPEL
))

1370  
CIRRUS_HOOK_NOT_HANDLED
;

1371 
s
->
dac_ˇche
[s->
dac_sub_ödex
] = 
ªg_vÆue
;

1372 i‡(++
s
->
dac_sub_ödex
 == 3) {

1373 
	`mem˝y
(&
s
->
cúrus_hiddí_∑Àâe
[(s->
dac_wrôe_ödex
 & 0x0f) * 3],

1374 
s
->
dac_ˇche
, 3);

1376 
s
->
dac_sub_ödex
 = 0;

1377 
s
->
dac_wrôe_ödex
++;

1379  
CIRRUS_HOOK_HANDLED
;

1380 
	}
}

1389 
	$cúrus_hook_ªad_gr
(
CúrusVGASèã
 * 
s
, 
ªg_ödex
, *
ªg_vÆue
)

1391 
ªg_ödex
) {

1393 *
ªg_vÆue
 = 
s
->
cúrus_shadow_gr0
;

1394  
CIRRUS_HOOK_HANDLED
;

1396 *
ªg_vÆue
 = 
s
->
cúrus_shadow_gr1
;

1397  
CIRRUS_HOOK_HANDLED
;

1404  
CIRRUS_HOOK_NOT_HANDLED
;

1410 i‡(
ªg_ödex
 < 0x3a) {

1411 *
ªg_vÆue
 = 
s
->
gr
[
ªg_ödex
];

1413 #ifde‡
DEBUG_CIRRUS


1414 
	`¥ötf
("cúrus: i≈‹àgr_ödex %02x\n", 
ªg_ödex
);

1416 *
ªg_vÆue
 = 0xff;

1419  
CIRRUS_HOOK_HANDLED
;

1420 
	}
}

1423 
	$cúrus_hook_wrôe_gr
(
CúrusVGASèã
 * 
s
, 
ªg_ödex
, 
ªg_vÆue
)

1425 #i‡
	`deföed
(
DEBUG_BITBLT
) && 0

1426 
	`¥ötf
("gr%02x: %02x\n", 
ªg_ödex
, 
ªg_vÆue
);

1428 
ªg_ödex
) {

1430 
s
->
cúrus_shadow_gr0
 = 
ªg_vÆue
;

1431  
CIRRUS_HOOK_NOT_HANDLED
;

1433 
s
->
cúrus_shadow_gr1
 = 
ªg_vÆue
;

1434  
CIRRUS_HOOK_NOT_HANDLED
;

1441  
CIRRUS_HOOK_NOT_HANDLED
;

1443 
s
->
gr
[
ªg_ödex
] = 
ªg_vÆue
 & 0x7f;

1444 
	`cúrus_upd©e_mem‹y_ac˚ss
(
s
);

1448 
s
->
gr
[
ªg_ödex
] = 
ªg_vÆue
;

1449 
	`cúrus_upd©e_b™k_±r
(
s
, 0);

1450 
	`cúrus_upd©e_b™k_±r
(
s
, 1);

1453 
s
->
gr
[
ªg_ödex
] = 
ªg_vÆue
;

1454 
	`cúrus_upd©e_b™k_±r
(
s
, 0);

1455 
	`cúrus_upd©e_b™k_±r
(
s
, 1);

1456 
	`cúrus_upd©e_mem‹y_ac˚ss
(
s
);

1480 
s
->
gr
[
ªg_ödex
] = 
ªg_vÆue
;

1486 
s
->
gr
[
ªg_ödex
] = 
ªg_vÆue
 & 0x1f;

1489 
s
->
gr
[
ªg_ödex
] = 
ªg_vÆue
 & 0x3f;

1491 i‡(
s
->
gr
[0x31] & 
CIRRUS_BLT_AUTOSTART
) {

1492 
	`cúrus_bôb…_°¨t
(
s
);

1496 
s
->
gr
[
ªg_ödex
] = 
ªg_vÆue
 & 0x3f;

1499 
	`cúrus_wrôe_bôb…
(
s
, 
ªg_vÆue
);

1504 
s
->
gr
[
ªg_ödex
] = 
ªg_vÆue
;

1507 
èrgë_phys_addr_t
 
addr
;

1508 
addr
 = 0xa0000;áddr < 0xa4000;áddr += 2)

1509 
	`cúrus_vga_mem_wrôew
(
s
, 
addr
, (
ªg_vÆue
 << 8Ë| s->
gr
[0xFE]);

1513 #ifde‡
DEBUG_CIRRUS


1514 
	`¥ötf
("cúrus: ouç‹àgr_ödex %02x, gr_vÆuê%02x\n", 
ªg_ödex
,

1515 
ªg_vÆue
);

1520  
CIRRUS_HOOK_HANDLED
;

1521 
	}
}

1530 
	$cúrus_hook_ªad_¸
(
CúrusVGASèã
 * 
s
, 
ªg_ödex
, *
ªg_vÆue
)

1532 
ªg_ödex
) {

1558  
CIRRUS_HOOK_NOT_HANDLED
;

1568 *
ªg_vÆue
 = 
s
->
¸
[
ªg_ödex
];

1571 *
ªg_vÆue
 = 
s
->
¨_ödex
 & 0x3f;

1574 #ifde‡
DEBUG_CIRRUS


1575 
	`¥ötf
("cúrus: i≈‹à¸_ödex %02x\n", 
ªg_ödex
);

1576 *
ªg_vÆue
 = 0xff;

1581  
CIRRUS_HOOK_HANDLED
;

1582 
	}
}

1585 
	$cúrus_hook_wrôe_¸
(
CúrusVGASèã
 * 
s
, 
ªg_ödex
, 
ªg_vÆue
)

1587 
ªg_ödex
) {

1613  
CIRRUS_HOOK_NOT_HANDLED
;

1619 
s
->
¸
[
ªg_ödex
] = 
ªg_vÆue
;

1620 #ifde‡
DEBUG_CIRRUS


1621 
	`¥ötf
("cirrus: handled outport cr_index %02x, cr_value %02x\n",

1622 
ªg_ödex
, 
ªg_vÆue
);

1632 #ifde‡
DEBUG_CIRRUS


1633 
	`¥ötf
("cúrus: ouç‹à¸_ödex %02x, cr_vÆuê%02x\n", 
ªg_ödex
,

1634 
ªg_vÆue
);

1639  
CIRRUS_HOOK_HANDLED
;

1640 
	}
}

1648 
uöt8_t
 
	$cúrus_mmio_b…_ªad
(
CúrusVGASèã
 * 
s
, 
addªss
)

1650 
vÆue
 = 0xff;

1652 
addªss
) {

1653 (
CIRRUS_MMIO_BLTBGCOLOR
 + 0):

1654 
	`cúrus_hook_ªad_gr
(
s
, 0x00, &
vÆue
);

1656 (
CIRRUS_MMIO_BLTBGCOLOR
 + 1):

1657 
	`cúrus_hook_ªad_gr
(
s
, 0x10, &
vÆue
);

1659 (
CIRRUS_MMIO_BLTBGCOLOR
 + 2):

1660 
	`cúrus_hook_ªad_gr
(
s
, 0x12, &
vÆue
);

1662 (
CIRRUS_MMIO_BLTBGCOLOR
 + 3):

1663 
	`cúrus_hook_ªad_gr
(
s
, 0x14, &
vÆue
);

1665 (
CIRRUS_MMIO_BLTFGCOLOR
 + 0):

1666 
	`cúrus_hook_ªad_gr
(
s
, 0x01, &
vÆue
);

1668 (
CIRRUS_MMIO_BLTFGCOLOR
 + 1):

1669 
	`cúrus_hook_ªad_gr
(
s
, 0x11, &
vÆue
);

1671 (
CIRRUS_MMIO_BLTFGCOLOR
 + 2):

1672 
	`cúrus_hook_ªad_gr
(
s
, 0x13, &
vÆue
);

1674 (
CIRRUS_MMIO_BLTFGCOLOR
 + 3):

1675 
	`cúrus_hook_ªad_gr
(
s
, 0x15, &
vÆue
);

1677 (
CIRRUS_MMIO_BLTWIDTH
 + 0):

1678 
	`cúrus_hook_ªad_gr
(
s
, 0x20, &
vÆue
);

1680 (
CIRRUS_MMIO_BLTWIDTH
 + 1):

1681 
	`cúrus_hook_ªad_gr
(
s
, 0x21, &
vÆue
);

1683 (
CIRRUS_MMIO_BLTHEIGHT
 + 0):

1684 
	`cúrus_hook_ªad_gr
(
s
, 0x22, &
vÆue
);

1686 (
CIRRUS_MMIO_BLTHEIGHT
 + 1):

1687 
	`cúrus_hook_ªad_gr
(
s
, 0x23, &
vÆue
);

1689 (
CIRRUS_MMIO_BLTDESTPITCH
 + 0):

1690 
	`cúrus_hook_ªad_gr
(
s
, 0x24, &
vÆue
);

1692 (
CIRRUS_MMIO_BLTDESTPITCH
 + 1):

1693 
	`cúrus_hook_ªad_gr
(
s
, 0x25, &
vÆue
);

1695 (
CIRRUS_MMIO_BLTSRCPITCH
 + 0):

1696 
	`cúrus_hook_ªad_gr
(
s
, 0x26, &
vÆue
);

1698 (
CIRRUS_MMIO_BLTSRCPITCH
 + 1):

1699 
	`cúrus_hook_ªad_gr
(
s
, 0x27, &
vÆue
);

1701 (
CIRRUS_MMIO_BLTDESTADDR
 + 0):

1702 
	`cúrus_hook_ªad_gr
(
s
, 0x28, &
vÆue
);

1704 (
CIRRUS_MMIO_BLTDESTADDR
 + 1):

1705 
	`cúrus_hook_ªad_gr
(
s
, 0x29, &
vÆue
);

1707 (
CIRRUS_MMIO_BLTDESTADDR
 + 2):

1708 
	`cúrus_hook_ªad_gr
(
s
, 0x2a, &
vÆue
);

1710 (
CIRRUS_MMIO_BLTSRCADDR
 + 0):

1711 
	`cúrus_hook_ªad_gr
(
s
, 0x2c, &
vÆue
);

1713 (
CIRRUS_MMIO_BLTSRCADDR
 + 1):

1714 
	`cúrus_hook_ªad_gr
(
s
, 0x2d, &
vÆue
);

1716 (
CIRRUS_MMIO_BLTSRCADDR
 + 2):

1717 
	`cúrus_hook_ªad_gr
(
s
, 0x2e, &
vÆue
);

1719 
CIRRUS_MMIO_BLTWRITEMASK
:

1720 
	`cúrus_hook_ªad_gr
(
s
, 0x2f, &
vÆue
);

1722 
CIRRUS_MMIO_BLTMODE
:

1723 
	`cúrus_hook_ªad_gr
(
s
, 0x30, &
vÆue
);

1725 
CIRRUS_MMIO_BLTROP
:

1726 
	`cúrus_hook_ªad_gr
(
s
, 0x32, &
vÆue
);

1728 
CIRRUS_MMIO_BLTMODEEXT
:

1729 
	`cúrus_hook_ªad_gr
(
s
, 0x33, &
vÆue
);

1731 (
CIRRUS_MMIO_BLTTRANSPARENTCOLOR
 + 0):

1732 
	`cúrus_hook_ªad_gr
(
s
, 0x34, &
vÆue
);

1734 (
CIRRUS_MMIO_BLTTRANSPARENTCOLOR
 + 1):

1735 
	`cúrus_hook_ªad_gr
(
s
, 0x35, &
vÆue
);

1737 (
CIRRUS_MMIO_BLTTRANSPARENTCOLORMASK
 + 0):

1738 
	`cúrus_hook_ªad_gr
(
s
, 0x38, &
vÆue
);

1740 (
CIRRUS_MMIO_BLTTRANSPARENTCOLORMASK
 + 1):

1741 
	`cúrus_hook_ªad_gr
(
s
, 0x39, &
vÆue
);

1743 
CIRRUS_MMIO_BLTSTATUS
:

1744 
	`cúrus_hook_ªad_gr
(
s
, 0x31, &
vÆue
);

1747 #ifde‡
DEBUG_CIRRUS


1748 
	`¥ötf
("cúrus: mmiÿªad -áddªs†0x%04x\n", 
addªss
);

1753  (
uöt8_t
Ë
vÆue
;

1754 
	}
}

1756 
	$cúrus_mmio_b…_wrôe
(
CúrusVGASèã
 * 
s
, 
addªss
,

1757 
uöt8_t
 
vÆue
)

1759 
addªss
) {

1760 (
CIRRUS_MMIO_BLTBGCOLOR
 + 0):

1761 
	`cúrus_hook_wrôe_gr
(
s
, 0x00, 
vÆue
);

1763 (
CIRRUS_MMIO_BLTBGCOLOR
 + 1):

1764 
	`cúrus_hook_wrôe_gr
(
s
, 0x10, 
vÆue
);

1766 (
CIRRUS_MMIO_BLTBGCOLOR
 + 2):

1767 
	`cúrus_hook_wrôe_gr
(
s
, 0x12, 
vÆue
);

1769 (
CIRRUS_MMIO_BLTBGCOLOR
 + 3):

1770 
	`cúrus_hook_wrôe_gr
(
s
, 0x14, 
vÆue
);

1772 (
CIRRUS_MMIO_BLTFGCOLOR
 + 0):

1773 
	`cúrus_hook_wrôe_gr
(
s
, 0x01, 
vÆue
);

1775 (
CIRRUS_MMIO_BLTFGCOLOR
 + 1):

1776 
	`cúrus_hook_wrôe_gr
(
s
, 0x11, 
vÆue
);

1778 (
CIRRUS_MMIO_BLTFGCOLOR
 + 2):

1779 
	`cúrus_hook_wrôe_gr
(
s
, 0x13, 
vÆue
);

1781 (
CIRRUS_MMIO_BLTFGCOLOR
 + 3):

1782 
	`cúrus_hook_wrôe_gr
(
s
, 0x15, 
vÆue
);

1784 (
CIRRUS_MMIO_BLTWIDTH
 + 0):

1785 
	`cúrus_hook_wrôe_gr
(
s
, 0x20, 
vÆue
);

1787 (
CIRRUS_MMIO_BLTWIDTH
 + 1):

1788 
	`cúrus_hook_wrôe_gr
(
s
, 0x21, 
vÆue
);

1790 (
CIRRUS_MMIO_BLTHEIGHT
 + 0):

1791 
	`cúrus_hook_wrôe_gr
(
s
, 0x22, 
vÆue
);

1793 (
CIRRUS_MMIO_BLTHEIGHT
 + 1):

1794 
	`cúrus_hook_wrôe_gr
(
s
, 0x23, 
vÆue
);

1796 (
CIRRUS_MMIO_BLTDESTPITCH
 + 0):

1797 
	`cúrus_hook_wrôe_gr
(
s
, 0x24, 
vÆue
);

1799 (
CIRRUS_MMIO_BLTDESTPITCH
 + 1):

1800 
	`cúrus_hook_wrôe_gr
(
s
, 0x25, 
vÆue
);

1802 (
CIRRUS_MMIO_BLTSRCPITCH
 + 0):

1803 
	`cúrus_hook_wrôe_gr
(
s
, 0x26, 
vÆue
);

1805 (
CIRRUS_MMIO_BLTSRCPITCH
 + 1):

1806 
	`cúrus_hook_wrôe_gr
(
s
, 0x27, 
vÆue
);

1808 (
CIRRUS_MMIO_BLTDESTADDR
 + 0):

1809 
	`cúrus_hook_wrôe_gr
(
s
, 0x28, 
vÆue
);

1811 (
CIRRUS_MMIO_BLTDESTADDR
 + 1):

1812 
	`cúrus_hook_wrôe_gr
(
s
, 0x29, 
vÆue
);

1814 (
CIRRUS_MMIO_BLTDESTADDR
 + 2):

1815 
	`cúrus_hook_wrôe_gr
(
s
, 0x2a, 
vÆue
);

1817 (
CIRRUS_MMIO_BLTDESTADDR
 + 3):

1820 (
CIRRUS_MMIO_BLTSRCADDR
 + 0):

1821 
	`cúrus_hook_wrôe_gr
(
s
, 0x2c, 
vÆue
);

1823 (
CIRRUS_MMIO_BLTSRCADDR
 + 1):

1824 
	`cúrus_hook_wrôe_gr
(
s
, 0x2d, 
vÆue
);

1826 (
CIRRUS_MMIO_BLTSRCADDR
 + 2):

1827 
	`cúrus_hook_wrôe_gr
(
s
, 0x2e, 
vÆue
);

1829 
CIRRUS_MMIO_BLTWRITEMASK
:

1830 
	`cúrus_hook_wrôe_gr
(
s
, 0x2f, 
vÆue
);

1832 
CIRRUS_MMIO_BLTMODE
:

1833 
	`cúrus_hook_wrôe_gr
(
s
, 0x30, 
vÆue
);

1835 
CIRRUS_MMIO_BLTROP
:

1836 
	`cúrus_hook_wrôe_gr
(
s
, 0x32, 
vÆue
);

1838 
CIRRUS_MMIO_BLTMODEEXT
:

1839 
	`cúrus_hook_wrôe_gr
(
s
, 0x33, 
vÆue
);

1841 (
CIRRUS_MMIO_BLTTRANSPARENTCOLOR
 + 0):

1842 
	`cúrus_hook_wrôe_gr
(
s
, 0x34, 
vÆue
);

1844 (
CIRRUS_MMIO_BLTTRANSPARENTCOLOR
 + 1):

1845 
	`cúrus_hook_wrôe_gr
(
s
, 0x35, 
vÆue
);

1847 (
CIRRUS_MMIO_BLTTRANSPARENTCOLORMASK
 + 0):

1848 
	`cúrus_hook_wrôe_gr
(
s
, 0x38, 
vÆue
);

1850 (
CIRRUS_MMIO_BLTTRANSPARENTCOLORMASK
 + 1):

1851 
	`cúrus_hook_wrôe_gr
(
s
, 0x39, 
vÆue
);

1853 
CIRRUS_MMIO_BLTSTATUS
:

1854 
	`cúrus_hook_wrôe_gr
(
s
, 0x31, 
vÆue
);

1857 #ifde‡
DEBUG_CIRRUS


1858 
	`¥ötf
("cirrus: mmio write -áddr 0x%04x val 0x%02x (ignored)\n",

1859 
addªss
, 
vÆue
);

1863 
	}
}

1873 
	$cúrus_mem_wrôeb_mode4™d5_8bµ
(
CúrusVGASèã
 * 
s
,

1874 
mode
,

1875 
off£t
,

1876 
uöt32_t
 
mem_vÆue
)

1878 
x
;

1879 
vÆ
 = 
mem_vÆue
;

1880 
uöt8_t
 *
d°
;

1882 
d°
 = 
s
->
vøm_±r
 + 
off£t
;

1883 
x
 = 0; x < 8; x++) {

1884 i‡(
vÆ
 & 0x80) {

1885 *
d°
 = 
s
->
cúrus_shadow_gr1
;

1886 } i‡(
mode
 == 5) {

1887 *
d°
 = 
s
->
cúrus_shadow_gr0
;

1889 
vÆ
 <<= 1;

1890 
d°
++;

1892 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
off£t
);

1893 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
off£t
 + 7);

1894 
	}
}

1896 
	$cúrus_mem_wrôeb_mode4™d5_16bµ
(
CúrusVGASèã
 * 
s
,

1897 
mode
,

1898 
off£t
,

1899 
uöt32_t
 
mem_vÆue
)

1901 
x
;

1902 
vÆ
 = 
mem_vÆue
;

1903 
uöt8_t
 *
d°
;

1905 
d°
 = 
s
->
vøm_±r
 + 
off£t
;

1906 
x
 = 0; x < 8; x++) {

1907 i‡(
vÆ
 & 0x80) {

1908 *
d°
 = 
s
->
cúrus_shadow_gr1
;

1909 *(
d°
 + 1Ë
s
->
gr
[0x11];

1910 } i‡(
mode
 == 5) {

1911 *
d°
 = 
s
->
cúrus_shadow_gr0
;

1912 *(
d°
 + 1Ë
s
->
gr
[0x10];

1914 
vÆ
 <<= 1;

1915 
d°
 += 2;

1917 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
off£t
);

1918 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
off£t
 + 15);

1919 
	}
}

1927 
uöt32_t
 
	$cúrus_vga_mem_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1929 
CúrusVGASèã
 *
s
 = 
›aque
;

1930 
b™k_ödex
;

1931 
b™k_off£t
;

1932 
uöt32_t
 
vÆ
;

1934 i‡((
s
->
§
[0x07] & 0x01) == 0) {

1935  
	`vga_mem_ªadb
(
s
, 
addr
);

1938 
addr
 &= 0x1ffff;

1940 i‡(
addr
 < 0x10000) {

1943 
b™k_ödex
 = 
addr
 >> 15;

1944 
b™k_off£t
 = 
addr
 & 0x7fff;

1945 i‡(
b™k_off£t
 < 
s
->
cúrus_b™k_limô
[
b™k_ödex
]) {

1946 
b™k_off£t
 +
s
->
cúrus_b™k_ba£
[
b™k_ödex
];

1947 i‡((
s
->
gr
[0x0B] & 0x14) == 0x14) {

1948 
b™k_off£t
 <<= 4;

1949 } i‡(
s
->
gr
[0x0B] & 0x02) {

1950 
b™k_off£t
 <<= 3;

1952 
b™k_off£t
 &
s
->
cúrus_addr_mask
;

1953 
vÆ
 = *(
s
->
vøm_±r
 + 
b™k_off£t
);

1955 
vÆ
 = 0xff;

1956 } i‡(
addr
 >= 0x18000 &&áddr < 0x18100) {

1958 
vÆ
 = 0xff;

1959 i‡((
s
->
§
[0x17] & 0x44) == 0x04) {

1960 
vÆ
 = 
	`cúrus_mmio_b…_ªad
(
s
, 
addr
 & 0xff);

1963 
vÆ
 = 0xff;

1964 #ifde‡
DEBUG_CIRRUS


1965 
	`¥ötf
("cúrus: mem_ªadb %06x\n", 
addr
);

1968  
vÆ
;

1969 
	}
}

1971 
uöt32_t
 
	$cúrus_vga_mem_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1973 
uöt32_t
 
v
;

1974 #ifde‡
TARGET_WORDS_BIGENDIAN


1975 
v
 = 
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
) << 8;

1976 
v
 |
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
 + 1);

1978 
v
 = 
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
);

1979 
v
 |
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
 + 1) << 8;

1981  
v
;

1982 
	}
}

1984 
uöt32_t
 
	$cúrus_vga_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1986 
uöt32_t
 
v
;

1987 #ifde‡
TARGET_WORDS_BIGENDIAN


1988 
v
 = 
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
) << 24;

1989 
v
 |
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
 + 1) << 16;

1990 
v
 |
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
 + 2) << 8;

1991 
v
 |
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
 + 3);

1993 
v
 = 
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
);

1994 
v
 |
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
 + 1) << 8;

1995 
v
 |
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
 + 2) << 16;

1996 
v
 |
	`cúrus_vga_mem_ªadb
(
›aque
, 
addr
 + 3) << 24;

1998  
v
;

1999 
	}
}

2001 
	$cúrus_vga_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2002 
uöt32_t
 
mem_vÆue
)

2004 
CúrusVGASèã
 *
s
 = 
›aque
;

2005 
b™k_ödex
;

2006 
b™k_off£t
;

2007 
mode
;

2009 i‡((
s
->
§
[0x07] & 0x01) == 0) {

2010 
	`vga_mem_wrôeb
(
s
, 
addr
, 
mem_vÆue
);

2014 
addr
 &= 0x1ffff;

2016 i‡(
addr
 < 0x10000) {

2017 i‡(
s
->
cúrus_§˝å
 !s->
cúrus_§˝å_íd
) {

2019 *
s
->
cúrus_§˝å
++ = (
uöt8_t
Ë
mem_vÆue
;

2020 i‡(
s
->
cúrus_§˝å
 >s->
cúrus_§˝å_íd
) {

2021 
	`cúrus_bôb…_˝utovideo_√xt
(
s
);

2025 
b™k_ödex
 = 
addr
 >> 15;

2026 
b™k_off£t
 = 
addr
 & 0x7fff;

2027 i‡(
b™k_off£t
 < 
s
->
cúrus_b™k_limô
[
b™k_ödex
]) {

2028 
b™k_off£t
 +
s
->
cúrus_b™k_ba£
[
b™k_ödex
];

2029 i‡((
s
->
gr
[0x0B] & 0x14) == 0x14) {

2030 
b™k_off£t
 <<= 4;

2031 } i‡(
s
->
gr
[0x0B] & 0x02) {

2032 
b™k_off£t
 <<= 3;

2034 
b™k_off£t
 &
s
->
cúrus_addr_mask
;

2035 
mode
 = 
s
->
gr
[0x05] & 0x7;

2036 i‡(
mode
 < 4 || modê> 5 || ((
s
->
gr
[0x0B] & 0x4) == 0)) {

2037 *(
s
->
vøm_±r
 + 
b™k_off£t
Ë
mem_vÆue
;

2038 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 +

2039 
b™k_off£t
);

2041 i‡((
s
->
gr
[0x0B] & 0x14) != 0x14) {

2042 
	`cúrus_mem_wrôeb_mode4™d5_8bµ
(
s
, 
mode
,

2043 
b™k_off£t
,

2044 
mem_vÆue
);

2046 
	`cúrus_mem_wrôeb_mode4™d5_16bµ
(
s
, 
mode
,

2047 
b™k_off£t
,

2048 
mem_vÆue
);

2053 } i‡(
addr
 >= 0x18000 &&áddr < 0x18100) {

2055 i‡((
s
->
§
[0x17] & 0x44) == 0x04) {

2056 
	`cúrus_mmio_b…_wrôe
(
s
, 
addr
 & 0xff, 
mem_vÆue
);

2059 #ifde‡
DEBUG_CIRRUS


2060 
	`¥ötf
("cúrus: mem_wrôeb %06x vÆuê%02x\n", 
addr
, 
mem_vÆue
);

2063 
	}
}

2065 
	$cúrus_vga_mem_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

2067 #ifde‡
TARGET_WORDS_BIGENDIAN


2068 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 8) & 0xff);

2069 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
 + 1, 
vÆ
 & 0xff);

2071 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

2072 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

2074 
	}
}

2076 
	$cúrus_vga_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

2078 #ifde‡
TARGET_WORDS_BIGENDIAN


2079 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 24) & 0xff);

2080 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 16) & 0xff);

2081 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 8) & 0xff);

2082 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
 + 3, 
vÆ
 & 0xff);

2084 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

2085 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

2086 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 16) & 0xff);

2087 
	`cúrus_vga_mem_wrôeb
(
›aque
, 
addr
 + 3, (
vÆ
 >> 24) & 0xff);

2089 
	}
}

2091 
CPURódMem‹yFunc
 *
	gcúrus_vga_mem_ªad
[3] = {

2092 
cúrus_vga_mem_ªadb
,

2093 
cúrus_vga_mem_ªadw
,

2094 
cúrus_vga_mem_ªadl
,

2097 
CPUWrôeMem‹yFunc
 *
	gcúrus_vga_mem_wrôe
[3] = {

2098 
cúrus_vga_mem_wrôeb
,

2099 
cúrus_vga_mem_wrôew
,

2100 
cúrus_vga_mem_wrôñ
,

2109 
ölöe
 
	$övÆid©e_curs‹1
(
CúrusVGASèã
 *
s
)

2111 i‡(
s
->
œ°_hw_curs‹_size
) {

2112 
	`vga_övÆid©e_sˇ∆öes
((
VGASèã
 *)
s
,

2113 
s
->
œ°_hw_curs‹_y
 + s->
œ°_hw_curs‹_y_°¨t
,

2114 
s
->
œ°_hw_curs‹_y
 + s->
œ°_hw_curs‹_y_íd
);

2116 
	}
}

2118 
ölöe
 
	$cúrus_curs‹_compuã_yønge
(
CúrusVGASèã
 *
s
)

2120 c⁄° 
uöt8_t
 *
§c
;

2121 
uöt32_t
 
c⁄ã¡
;

2122 
y
, 
y_mö
, 
y_max
;

2124 
§c
 = 
s
->
vøm_±r
 + s->
ªÆ_vøm_size
 - 16 * 1024;

2125 i‡(
s
->
§
[0x12] & 
CIRRUS_CURSOR_LARGE
) {

2126 
§c
 +(
s
->
§
[0x13] & 0x3c) * 256;

2127 
y_mö
 = 64;

2128 
y_max
 = -1;

2129 
y
 = 0; y < 64; y++) {

2130 
c⁄ã¡
 = ((
uöt32_t
 *)
§c
)[0] |

2131 ((
uöt32_t
 *)
§c
)[1] |

2132 ((
uöt32_t
 *)
§c
)[2] |

2133 ((
uöt32_t
 *)
§c
)[3];

2134 i‡(
c⁄ã¡
) {

2135 i‡(
y
 < 
y_mö
)

2136 
y_mö
 = 
y
;

2137 i‡(
y
 > 
y_max
)

2138 
y_max
 = 
y
;

2140 
§c
 += 16;

2143 
§c
 +(
s
->
§
[0x13] & 0x3f) * 256;

2144 
y_mö
 = 32;

2145 
y_max
 = -1;

2146 
y
 = 0; y < 32; y++) {

2147 
c⁄ã¡
 = ((
uöt32_t
 *)
§c
)[0] |

2148 ((
uöt32_t
 *)(
§c
 + 128))[0];

2149 i‡(
c⁄ã¡
) {

2150 i‡(
y
 < 
y_mö
)

2151 
y_mö
 = 
y
;

2152 i‡(
y
 > 
y_max
)

2153 
y_max
 = 
y
;

2155 
§c
 += 4;

2158 i‡(
y_mö
 > 
y_max
) {

2159 
s
->
œ°_hw_curs‹_y_°¨t
 = 0;

2160 
s
->
œ°_hw_curs‹_y_íd
 = 0;

2162 
s
->
œ°_hw_curs‹_y_°¨t
 = 
y_mö
;

2163 
s
->
œ°_hw_curs‹_y_íd
 = 
y_max
 + 1;

2165 
	}
}

2169 
	$cúrus_curs‹_övÆid©e
(
VGASèã
 *
s1
)

2171 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *)
s1
;

2172 
size
;

2174 i‡(!
s
->
§
[0x12] & 
CIRRUS_CURSOR_SHOW
) {

2175 
size
 = 0;

2177 i‡(
s
->
§
[0x12] & 
CIRRUS_CURSOR_LARGE
)

2178 
size
 = 64;

2180 
size
 = 32;

2183 i‡(
s
->
œ°_hw_curs‹_size
 !
size
 ||

2184 
s
->
œ°_hw_curs‹_x
 !s->
hw_curs‹_x
 ||

2185 
s
->
œ°_hw_curs‹_y
 !s->
hw_curs‹_y
) {

2187 
	`övÆid©e_curs‹1
(
s
);

2189 
s
->
œ°_hw_curs‹_size
 = 
size
;

2190 
s
->
œ°_hw_curs‹_x
 = s->
hw_curs‹_x
;

2191 
s
->
œ°_hw_curs‹_y
 = s->
hw_curs‹_y
;

2193 
	`cúrus_curs‹_compuã_yønge
(
s
);

2194 
	`övÆid©e_curs‹1
(
s
);

2196 
	}
}

2198 
	$cúrus_curs‹_døw_löe
(
VGASèã
 *
s1
, 
uöt8_t
 *
d1
, 
s¸_y
)

2200 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *)
s1
;

2201 
w
, 
h
, 
bµ
, 
x1
, 
x2
, 
poff£t
;

2202 
cﬁ‹0
, 
cﬁ‹1
;

2203 c⁄° 
uöt8_t
 *
∑Àâe
, *
§c
;

2204 
uöt32_t
 
c⁄ã¡
;

2206 i‡(!(
s
->
§
[0x12] & 
CIRRUS_CURSOR_SHOW
))

2209 i‡(
s
->
§
[0x12] & 
CIRRUS_CURSOR_LARGE
) {

2210 
h
 = 64;

2212 
h
 = 32;

2214 i‡(
s¸_y
 < 
s
->
hw_curs‹_y
 ||

2215 
s¸_y
 >(
s
->
hw_curs‹_y
 + 
h
))

2218 
§c
 = 
s
->
vøm_±r
 + s->
ªÆ_vøm_size
 - 16 * 1024;

2219 i‡(
s
->
§
[0x12] & 
CIRRUS_CURSOR_LARGE
) {

2220 
§c
 +(
s
->
§
[0x13] & 0x3c) * 256;

2221 
§c
 +(
s¸_y
 - 
s
->
hw_curs‹_y
) * 16;

2222 
poff£t
 = 8;

2223 
c⁄ã¡
 = ((
uöt32_t
 *)
§c
)[0] |

2224 ((
uöt32_t
 *)
§c
)[1] |

2225 ((
uöt32_t
 *)
§c
)[2] |

2226 ((
uöt32_t
 *)
§c
)[3];

2228 
§c
 +(
s
->
§
[0x13] & 0x3f) * 256;

2229 
§c
 +(
s¸_y
 - 
s
->
hw_curs‹_y
) * 4;

2230 
poff£t
 = 128;

2231 
c⁄ã¡
 = ((
uöt32_t
 *)
§c
)[0] |

2232 ((
uöt32_t
 *)(
§c
 + 128))[0];

2235 i‡(!
c⁄ã¡
)

2237 
w
 = 
h
;

2239 
x1
 = 
s
->
hw_curs‹_x
;

2240 i‡(
x1
 >
s
->
œ°_s¸_width
)

2242 
x2
 = 
s
->
hw_curs‹_x
 + 
w
;

2243 i‡(
x2
 > 
s
->
œ°_s¸_width
)

2244 
x2
 = 
s
->
œ°_s¸_width
;

2245 
w
 = 
x2
 - 
x1
;

2246 
∑Àâe
 = 
s
->
cúrus_hiddí_∑Àâe
;

2247 
cﬁ‹0
 = 
s
->
	`rgb_to_pixñ
(
	`c6_to_8
(
∑Àâe
[0x0 * 3]),

2248 
	`c6_to_8
(
∑Àâe
[0x0 * 3 + 1]),

2249 
	`c6_to_8
(
∑Àâe
[0x0 * 3 + 2]));

2250 
cﬁ‹1
 = 
s
->
	`rgb_to_pixñ
(
	`c6_to_8
(
∑Àâe
[0xf * 3]),

2251 
	`c6_to_8
(
∑Àâe
[0xf * 3 + 1]),

2252 
	`c6_to_8
(
∑Àâe
[0xf * 3 + 2]));

2253 
bµ
 = ((
s
->
ds
->
dïth
 + 7) >> 3);

2254 
d1
 +
x1
 * 
bµ
;

2255 
s
->
ds
->
dïth
) {

2259 
	`vga_døw_curs‹_löe_8
(
d1
, 
§c
, 
poff£t
, 
w
, 
cﬁ‹0
, 
cﬁ‹1
, 0xff);

2262 
	`vga_døw_curs‹_löe_16
(
d1
, 
§c
, 
poff£t
, 
w
, 
cﬁ‹0
, 
cﬁ‹1
, 0x7fff);

2265 
	`vga_døw_curs‹_löe_16
(
d1
, 
§c
, 
poff£t
, 
w
, 
cﬁ‹0
, 
cﬁ‹1
, 0xffff);

2268 
	`vga_døw_curs‹_löe_32
(
d1
, 
§c
, 
poff£t
, 
w
, 
cﬁ‹0
, 
cﬁ‹1
, 0xffffff);

2271 
	}
}

2279 
uöt32_t
 
	$cúrus_löór_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2281 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *Ë
›aque
;

2282 
uöt32_t
 
ªt
;

2284 
addr
 &
s
->
cúrus_addr_mask
;

2286 i‡(((
s
->
§
[0x17] & 0x44) == 0x44) &&

2287 ((
addr
 & 
s
->
löór_mmio_mask
) == s->linear_mmio_mask)) {

2289 
ªt
 = 
	`cúrus_mmio_b…_ªad
(
s
, 
addr
 & 0xff);

2292 
ªt
 = 0xff;

2295 i‡((
s
->
gr
[0x0B] & 0x14) == 0x14) {

2296 
addr
 <<= 4;

2297 } i‡(
s
->
gr
[0x0B] & 0x02) {

2298 
addr
 <<= 3;

2300 
addr
 &
s
->
cúrus_addr_mask
;

2301 
ªt
 = *(
s
->
vøm_±r
 + 
addr
);

2304  
ªt
;

2305 
	}
}

2307 
uöt32_t
 
	$cúrus_löór_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2309 
uöt32_t
 
v
;

2310 #ifde‡
TARGET_WORDS_BIGENDIAN


2311 
v
 = 
	`cúrus_löór_ªadb
(
›aque
, 
addr
) << 8;

2312 
v
 |
	`cúrus_löór_ªadb
(
›aque
, 
addr
 + 1);

2314 
v
 = 
	`cúrus_löór_ªadb
(
›aque
, 
addr
);

2315 
v
 |
	`cúrus_löór_ªadb
(
›aque
, 
addr
 + 1) << 8;

2317  
v
;

2318 
	}
}

2320 
uöt32_t
 
	$cúrus_löór_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2322 
uöt32_t
 
v
;

2323 #ifde‡
TARGET_WORDS_BIGENDIAN


2324 
v
 = 
	`cúrus_löór_ªadb
(
›aque
, 
addr
) << 24;

2325 
v
 |
	`cúrus_löór_ªadb
(
›aque
, 
addr
 + 1) << 16;

2326 
v
 |
	`cúrus_löór_ªadb
(
›aque
, 
addr
 + 2) << 8;

2327 
v
 |
	`cúrus_löór_ªadb
(
›aque
, 
addr
 + 3);

2329 
v
 = 
	`cúrus_löór_ªadb
(
›aque
, 
addr
);

2330 
v
 |
	`cúrus_löór_ªadb
(
›aque
, 
addr
 + 1) << 8;

2331 
v
 |
	`cúrus_löór_ªadb
(
›aque
, 
addr
 + 2) << 16;

2332 
v
 |
	`cúrus_löór_ªadb
(
›aque
, 
addr
 + 3) << 24;

2334  
v
;

2335 
	}
}

2337 
	$cúrus_löór_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2338 
uöt32_t
 
vÆ
)

2340 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *Ë
›aque
;

2341 
mode
;

2343 
addr
 &
s
->
cúrus_addr_mask
;

2345 i‡(((
s
->
§
[0x17] & 0x44) == 0x44) &&

2346 ((
addr
 & 
s
->
löór_mmio_mask
) == s->linear_mmio_mask)) {

2348 
	`cúrus_mmio_b…_wrôe
(
s
, 
addr
 & 0xff, 
vÆ
);

2349 } i‡(
s
->
cúrus_§˝å
 !s->
cúrus_§˝å_íd
) {

2351 *
s
->
cúrus_§˝å
++ = (
uöt8_t
Ë
vÆ
;

2352 i‡(
s
->
cúrus_§˝å
 >s->
cúrus_§˝å_íd
) {

2353 
	`cúrus_bôb…_˝utovideo_√xt
(
s
);

2357 i‡((
s
->
gr
[0x0B] & 0x14) == 0x14) {

2358 
addr
 <<= 4;

2359 } i‡(
s
->
gr
[0x0B] & 0x02) {

2360 
addr
 <<= 3;

2362 
addr
 &
s
->
cúrus_addr_mask
;

2364 
mode
 = 
s
->
gr
[0x05] & 0x7;

2365 i‡(
mode
 < 4 || modê> 5 || ((
s
->
gr
[0x0B] & 0x4) == 0)) {

2366 *(
s
->
vøm_±r
 + 
addr
Ë(
uöt8_t
Ë
vÆ
;

2367 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
addr
);

2369 i‡((
s
->
gr
[0x0B] & 0x14) != 0x14) {

2370 
	`cúrus_mem_wrôeb_mode4™d5_8bµ
(
s
, 
mode
, 
addr
, 
vÆ
);

2372 
	`cúrus_mem_wrôeb_mode4™d5_16bµ
(
s
, 
mode
, 
addr
, 
vÆ
);

2376 
	}
}

2378 
	$cúrus_löór_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2379 
uöt32_t
 
vÆ
)

2381 #ifde‡
TARGET_WORDS_BIGENDIAN


2382 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 8) & 0xff);

2383 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
 + 1, 
vÆ
 & 0xff);

2385 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

2386 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

2388 
	}
}

2390 
	$cúrus_löór_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2391 
uöt32_t
 
vÆ
)

2393 #ifde‡
TARGET_WORDS_BIGENDIAN


2394 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 24) & 0xff);

2395 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 16) & 0xff);

2396 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 8) & 0xff);

2397 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
 + 3, 
vÆ
 & 0xff);

2399 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

2400 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

2401 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 16) & 0xff);

2402 
	`cúrus_löór_wrôeb
(
›aque
, 
addr
 + 3, (
vÆ
 >> 24) & 0xff);

2404 
	}
}

2407 
CPURódMem‹yFunc
 *
	gcúrus_löór_ªad
[3] = {

2408 
cúrus_löór_ªadb
,

2409 
cúrus_löór_ªadw
,

2410 
cúrus_löór_ªadl
,

2413 
CPUWrôeMem‹yFunc
 *
	gcúrus_löór_wrôe
[3] = {

2414 
cúrus_löór_wrôeb
,

2415 
cúrus_löór_wrôew
,

2416 
cúrus_löór_wrôñ
,

2419 
	$cúrus_löór_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2420 
uöt32_t
 
vÆ
)

2422 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *Ë
›aque
;

2424 
addr
 &
s
->
cúrus_addr_mask
;

2425 *(
s
->
vøm_±r
 + 
addr
Ë
vÆ
;

2426 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
addr
);

2427 
	}
}

2429 
	$cúrus_löór_mem_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2430 
uöt32_t
 
vÆ
)

2432 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *Ë
›aque
;

2434 
addr
 &
s
->
cúrus_addr_mask
;

2435 
	`˝u_to_À16w
((
uöt16_t
 *)(
s
->
vøm_±r
 + 
addr
), 
vÆ
);

2436 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
addr
);

2437 
	}
}

2439 
	$cúrus_löór_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2440 
uöt32_t
 
vÆ
)

2442 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *Ë
›aque
;

2444 
addr
 &
s
->
cúrus_addr_mask
;

2445 
	`˝u_to_À32w
((
uöt32_t
 *)(
s
->
vøm_±r
 + 
addr
), 
vÆ
);

2446 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
addr
);

2447 
	}
}

2456 
uöt32_t
 
	$cúrus_löór_bôb…_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2458 
uöt32_t
 
ªt
;

2461 
ªt
 = 0xff;

2462  
ªt
;

2463 
	}
}

2465 
uöt32_t
 
	$cúrus_löór_bôb…_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2467 
uöt32_t
 
v
;

2468 #ifde‡
TARGET_WORDS_BIGENDIAN


2469 
v
 = 
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
) << 8;

2470 
v
 |
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
 + 1);

2472 
v
 = 
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
);

2473 
v
 |
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
 + 1) << 8;

2475  
v
;

2476 
	}
}

2478 
uöt32_t
 
	$cúrus_löór_bôb…_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2480 
uöt32_t
 
v
;

2481 #ifde‡
TARGET_WORDS_BIGENDIAN


2482 
v
 = 
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
) << 24;

2483 
v
 |
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
 + 1) << 16;

2484 
v
 |
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
 + 2) << 8;

2485 
v
 |
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
 + 3);

2487 
v
 = 
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
);

2488 
v
 |
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
 + 1) << 8;

2489 
v
 |
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
 + 2) << 16;

2490 
v
 |
	`cúrus_löór_bôb…_ªadb
(
›aque
, 
addr
 + 3) << 24;

2492  
v
;

2493 
	}
}

2495 
	$cúrus_löór_bôb…_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2496 
uöt32_t
 
vÆ
)

2498 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *Ë
›aque
;

2500 i‡(
s
->
cúrus_§˝å
 !s->
cúrus_§˝å_íd
) {

2502 *
s
->
cúrus_§˝å
++ = (
uöt8_t
Ë
vÆ
;

2503 i‡(
s
->
cúrus_§˝å
 >s->
cúrus_§˝å_íd
) {

2504 
	`cúrus_bôb…_˝utovideo_√xt
(
s
);

2507 
	}
}

2509 
	$cúrus_löór_bôb…_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2510 
uöt32_t
 
vÆ
)

2512 #ifde‡
TARGET_WORDS_BIGENDIAN


2513 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 8) & 0xff);

2514 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
 + 1, 
vÆ
 & 0xff);

2516 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

2517 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

2519 
	}
}

2521 
	$cúrus_löór_bôb…_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2522 
uöt32_t
 
vÆ
)

2524 #ifde‡
TARGET_WORDS_BIGENDIAN


2525 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 24) & 0xff);

2526 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 16) & 0xff);

2527 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 8) & 0xff);

2528 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
 + 3, 
vÆ
 & 0xff);

2530 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

2531 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

2532 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 16) & 0xff);

2533 
	`cúrus_löór_bôb…_wrôeb
(
›aque
, 
addr
 + 3, (
vÆ
 >> 24) & 0xff);

2535 
	}
}

2538 
CPURódMem‹yFunc
 *
	gcúrus_löór_bôb…_ªad
[3] = {

2539 
cúrus_löór_bôb…_ªadb
,

2540 
cúrus_löór_bôb…_ªadw
,

2541 
cúrus_löór_bôb…_ªadl
,

2544 
CPUWrôeMem‹yFunc
 *
	gcúrus_löór_bôb…_wrôe
[3] = {

2545 
cúrus_löór_bôb…_wrôeb
,

2546 
cúrus_löór_bôb…_wrôew
,

2547 
cúrus_löór_bôb…_wrôñ
,

2550 *
	$£t_vøm_m≠pög
(
begö
, 
íd
)

2552 
xí_p‚_t
 *
exã¡_°¨t
 = 
NULL
;

2553 
ƒ_exã¡s
;

2554 *
vøm_poöãr
 = 
NULL
;

2555 
i
;

2558 
begö
 = begö & 
TARGET_PAGE_MASK
;

2559 
íd
 = 
begö
 + 
VGA_RAM_SIZE
;

2560 
íd
 = (íd + 
TARGET_PAGE_SIZE
 -1 ) & 
TARGET_PAGE_MASK
;

2561 
ƒ_exã¡s
 = (
íd
 - 
begö
Ë>> 
TARGET_PAGE_BITS
;

2563 
exã¡_°¨t
 = 
	`mÆloc
((
xí_p‚_t
Ë* 
ƒ_exã¡s
);

2564 i‡(
exã¡_°¨t
 =
NULL
) {

2565 
	`Ârötf
(
°dîr
, "Failed malloc on set_vram_mapping\n");

2566  
NULL
;

2569 
	`mem£t
(
exã¡_°¨t
, 0, (
xí_p‚_t
Ë* 
ƒ_exã¡s
);

2571 
i
 = 0; i < 
ƒ_exã¡s
; i++)

2572 
exã¡_°¨t
[
i
] = (
begö
 + i * 
TARGET_PAGE_SIZE
Ë>> 
TARGET_PAGE_BITS
;

2574 i‡(
	`£t_mm_m≠pög
(
xc_h™dÀ
, 
domid
, 
ƒ_exã¡s
, 0, 
exã¡_°¨t
) < 0) {

2575 
	`Ârötf
(
logfûe
, "Failed set_mm_mapping\n");

2576 
	`‰ì
(
exã¡_°¨t
);

2577  
NULL
;

2580 ()
	`xc_domaö_pö_mem‹y_ˇchóâr
(

2581 
xc_h™dÀ
, 
domid
,

2582 
begö
 >> 
TARGET_PAGE_BITS
,

2583 
íd
 >> 
TARGET_PAGE_BITS
,

2584 
XEN_DOMCTL_MEM_CACHEATTR_WB
);

2586 
vøm_poöãr
 = 
	`xc_m≠_f‹eign_∑ges
(
xc_h™dÀ
, 
domid
,

2587 
PROT_READ
|
PROT_WRITE
,

2588 
exã¡_°¨t
, 
ƒ_exã¡s
);

2589 i‡(
vøm_poöãr
 =
NULL
) {

2590 
	`Ârötf
(
logfûe
, "xc_map_foreign_batch vgaramÑeturnedÉrror %d\n",

2591 
î∫o
);

2592 
	`‰ì
(
exã¡_°¨t
);

2593  
NULL
;

2596 
	`mem£t
(
vøm_poöãr
, 0, 
ƒ_exã¡s
 * 
TARGET_PAGE_SIZE
);

2598 
	`‰ì
(
exã¡_°¨t
);

2600  
vøm_poöãr
;

2601 
	}
}

2603 
	$un£t_vøm_m≠pög
(
begö
, 
íd
,

2604 *
m≠pög
)

2606 
xí_p‚_t
 *
exã¡_°¨t
 = 
NULL
;

2607 
ƒ_exã¡s
;

2608 
i
;

2612 
íd
 = 
begö
 + 
VGA_RAM_SIZE
;

2613 
begö
 = begö & 
TARGET_PAGE_MASK
;

2614 
íd
 = (íd + 
TARGET_PAGE_SIZE
 -1 ) & 
TARGET_PAGE_MASK
;

2615 
ƒ_exã¡s
 = (
íd
 - 
begö
Ë>> 
TARGET_PAGE_BITS
;

2617 
exã¡_°¨t
 = 
	`mÆloc
((
xí_p‚_t
Ë* 
ƒ_exã¡s
);

2619 i‡(
exã¡_°¨t
 =
NULL
) {

2620 
	`Ârötf
(
°dîr
, "Failed malloc on set_mm_mapping\n");

2625 
	`munm≠
(
m≠pög
, 
ƒ_exã¡s
 * 
TARGET_PAGE_SIZE
);

2628 
	`mem£t
(
exã¡_°¨t
, 0, (
xí_p‚_t
Ë* 
ƒ_exã¡s
);

2629 
i
 = 0; i < 
ƒ_exã¡s
; i++)

2630 
exã¡_°¨t
[
i
] = (
begö
 + (ò* 
TARGET_PAGE_SIZE
)Ë>> 
TARGET_PAGE_BITS
;

2631 
	`un£t_mm_m≠pög
(
xc_h™dÀ
, 
domid
, 
ƒ_exã¡s
, 0, 
exã¡_°¨t
);

2633 
	`‰ì
(
exã¡_°¨t
);

2636 
	}
}

2639 
	$cúrus_upd©e_mem‹y_ac˚ss
(
CúrusVGASèã
 *
s
)

2641 
mode
;

2643 i‡((
s
->
§
[0x17] & 0x44) == 0x44) {

2644 
gíîic_io
;

2645 } i‡(
s
->
cúrus_§˝å
 !s->
cúrus_§˝å_íd
) {

2646 
gíîic_io
;

2648 i‡((
s
->
gr
[0x0B] & 0x14) == 0x14) {

2649 
gíîic_io
;

2650 } i‡(
s
->
gr
[0x0B] & 0x02) {

2651 
gíîic_io
;

2654 
mode
 = 
s
->
gr
[0x05] & 0x7;

2655 i‡(
mode
 < 4 || modê> 5 || ((
s
->
gr
[0x0B] & 0x4) == 0)) {

2656 i‡(
s
->
cúrus_lfb_addr
 && s->
cúrus_lfb_íd
 && !s->
m≠_addr
) {

2657 *
vøm_poöãr
, *
ﬁd_vøm
;

2659 
vøm_poöãr
 = 
	`£t_vøm_m≠pög
(
s
->
cúrus_lfb_addr
,

2660 
s
->
cúrus_lfb_íd
);

2661 i‡(!
vøm_poöãr
)

2662 
	`Ârötf
(
°dîr
, "NULL vram_pointer\n");

2664 
ﬁd_vøm
 = 
	`vga_upd©e_vøm
((
VGASèã
 *)
s
, 
vøm_poöãr
,

2665 
VGA_RAM_SIZE
);

2666 
	`qemu_‰ì
(
ﬁd_vøm
);

2668 
s
->
m≠_addr
 = s->
cúrus_lfb_addr
;

2669 
s
->
m≠_íd
 = s->
cúrus_lfb_íd
;

2671 
s
->
cúrus_löór_wrôe
[0] = 
cúrus_löór_mem_wrôeb
;

2672 
s
->
cúrus_löór_wrôe
[1] = 
cúrus_löór_mem_wrôew
;

2673 
s
->
cúrus_löór_wrôe
[2] = 
cúrus_löór_mem_wrôñ
;

2675 
gíîic_io
:

2676 i‡(
s
->
cúrus_lfb_addr
 && s->
cúrus_lfb_íd
 && s->
m≠_addr
) {

2677 *
ﬁd_vøm
;

2679 
ﬁd_vøm
 = 
	`vga_upd©e_vøm
((
VGASèã
 *)
s
, 
NULL
, 
VGA_RAM_SIZE
);

2681 
	`un£t_vøm_m≠pög
(
s
->
cúrus_lfb_addr
,

2682 
s
->
cúrus_lfb_íd
,

2683 
ﬁd_vøm
);

2685 
s
->
m≠_addr
 = s->
m≠_íd
 = 0;

2687 
s
->
cúrus_löór_wrôe
[0] = 
cúrus_löór_wrôeb
;

2688 
s
->
cúrus_löór_wrôe
[1] = 
cúrus_löór_wrôew
;

2689 
s
->
cúrus_löór_wrôe
[2] = 
cúrus_löór_wrôñ
;

2692 
	}
}

2697 
uöt32_t
 
	$vga_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

2699 
CúrusVGASèã
 *
s
 = 
›aque
;

2700 
vÆ
, 
ödex
;

2703 i‡((
addr
 >0x3b0 &&ádd∏<0x3b‡&& (
s
->
m§
 & 
MSR_COLOR_EMULATION
))

2704 || (
addr
 >= 0x3d0 &&áddr <= 0x3df

2705 && !(
s
->
m§
 & 
MSR_COLOR_EMULATION
))) {

2706 
vÆ
 = 0xff;

2708 
addr
) {

2710 i‡(
s
->
¨_Êù_Ê›
 == 0) {

2711 
vÆ
 = 
s
->
¨_ödex
;

2713 
vÆ
 = 0;

2717 
ödex
 = 
s
->
¨_ödex
 & 0x1f;

2718 i‡(
ödex
 < 21)

2719 
vÆ
 = 
s
->
¨
[
ödex
];

2721 
vÆ
 = 0;

2724 
vÆ
 = 
s
->
°00
;

2727 
vÆ
 = 
s
->
§_ödex
;

2730 i‡(
	`cúrus_hook_ªad_§
(
s
, s->
§_ödex
, &
vÆ
))

2732 
vÆ
 = 
s
->
§
[s->
§_ödex
];

2733 #ifde‡
DEBUG_VGA_REG


2734 
	`¥ötf
("vga:Ñód SR%x = 0x%02x\n", 
s
->
§_ödex
, 
vÆ
);

2738 
	`cúrus_ªad_hiddí_dac
(
s
, &
vÆ
);

2741 
vÆ
 = 
s
->
dac_°©e
;

2744 
vÆ
 = 
s
->
dac_wrôe_ödex
;

2745 
s
->
cúrus_hiddí_dac_locködex
 = 0;

2748 i‡(
	`cúrus_hook_ªad_∑Àâe
(
s
, &
vÆ
))

2750 
vÆ
 = 
s
->
∑Àâe
[s->
dac_ªad_ödex
 * 3 + s->
dac_sub_ödex
];

2751 i‡(++
s
->
dac_sub_ödex
 == 3) {

2752 
s
->
dac_sub_ödex
 = 0;

2753 
s
->
dac_ªad_ödex
++;

2757 
vÆ
 = 
s
->
f¸
;

2760 
vÆ
 = 
s
->
m§
;

2763 
vÆ
 = 
s
->
gr_ödex
;

2766 i‡(
	`cúrus_hook_ªad_gr
(
s
, s->
gr_ödex
, &
vÆ
))

2768 
vÆ
 = 
s
->
gr
[s->
gr_ödex
];

2769 #ifde‡
DEBUG_VGA_REG


2770 
	`¥ötf
("vga:Ñód GR%x = 0x%02x\n", 
s
->
gr_ödex
, 
vÆ
);

2775 
vÆ
 = 
s
->
¸_ödex
;

2779 i‡(
	`cúrus_hook_ªad_¸
(
s
, s->
¸_ödex
, &
vÆ
))

2781 
vÆ
 = 
s
->
¸
[s->
¸_ödex
];

2782 #ifde‡
DEBUG_VGA_REG


2783 
	`¥ötf
("vga:Ñód CR%x = 0x%02x\n", 
s
->
¸_ödex
, 
vÆ
);

2789 
s
->
°01
 ^
ST01_V_RETRACE
 | 
ST01_DISP_ENABLE
;

2790 
vÆ
 = 
s
->
°01
;

2791 
s
->
¨_Êù_Ê›
 = 0;

2794 
vÆ
 = 0x00;

2798 #i‡
	`deföed
(
DEBUG_VGA
)

2799 
	`¥ötf
("VGA:Ñódáddr=0x%04x d©a=0x%02x\n", 
addr
, 
vÆ
);

2801  
vÆ
;

2802 
	}
}

2804 
	$vga_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2806 
CúrusVGASèã
 *
s
 = 
›aque
;

2807 
ödex
;

2810 i‡((
addr
 >0x3b0 &&ádd∏<0x3b‡&& (
s
->
m§
 & 
MSR_COLOR_EMULATION
))

2811 || (
addr
 >= 0x3d0 &&áddr <= 0x3df

2812 && !(
s
->
m§
 & 
MSR_COLOR_EMULATION
)))

2815 #ifde‡
DEBUG_VGA


2816 
	`¥ötf
("VGA: wrôêaddr=0x%04x d©a=0x%02x\n", 
addr
, 
vÆ
);

2819 
addr
) {

2821 i‡(
s
->
¨_Êù_Ê›
 == 0) {

2822 
vÆ
 &= 0x3f;

2823 
s
->
¨_ödex
 = 
vÆ
;

2825 
ödex
 = 
s
->
¨_ödex
 & 0x1f;

2826 
ödex
) {

2828 
s
->
¨
[
ödex
] = 
vÆ
 & 0x3f;

2831 
s
->
¨
[
ödex
] = 
vÆ
 & ~0x10;

2834 
s
->
¨
[
ödex
] = 
vÆ
;

2837 
s
->
¨
[
ödex
] = 
vÆ
 & ~0xc0;

2840 
s
->
¨
[
ödex
] = 
vÆ
 & ~0xf0;

2843 
s
->
¨
[
ödex
] = 
vÆ
 & ~0xf0;

2849 
s
->
¨_Êù_Ê›
 ^= 1;

2852 
s
->
m§
 = 
vÆ
 & ~0x10;

2855 
s
->
§_ödex
 = 
vÆ
;

2858 i‡(
	`cúrus_hook_wrôe_§
(
s
, s->
§_ödex
, 
vÆ
))

2860 #ifde‡
DEBUG_VGA_REG


2861 
	`¥ötf
("vga: wrôêSR%x = 0x%02x\n", 
s
->
§_ödex
, 
vÆ
);

2863 
s
->
§
[s->
§_ödex
] = 
vÆ
 & 
§_mask
[s->sr_index];

2866 
	`cúrus_wrôe_hiddí_dac
(
s
, 
vÆ
);

2869 
s
->
dac_ªad_ödex
 = 
vÆ
;

2870 
s
->
dac_sub_ödex
 = 0;

2871 
s
->
dac_°©e
 = 3;

2874 
s
->
dac_wrôe_ödex
 = 
vÆ
;

2875 
s
->
dac_sub_ödex
 = 0;

2876 
s
->
dac_°©e
 = 0;

2879 i‡(
	`cúrus_hook_wrôe_∑Àâe
(
s
, 
vÆ
))

2881 
s
->
dac_ˇche
[s->
dac_sub_ödex
] = 
vÆ
;

2882 i‡(++
s
->
dac_sub_ödex
 == 3) {

2883 
	`mem˝y
(&
s
->
∑Àâe
[s->
dac_wrôe_ödex
 * 3], s->
dac_ˇche
, 3);

2884 
s
->
dac_sub_ödex
 = 0;

2885 
s
->
dac_wrôe_ödex
++;

2889 
s
->
gr_ödex
 = 
vÆ
;

2892 i‡(
	`cúrus_hook_wrôe_gr
(
s
, s->
gr_ödex
, 
vÆ
))

2894 #ifde‡
DEBUG_VGA_REG


2895 
	`¥ötf
("vga: wrôêGR%x = 0x%02x\n", 
s
->
gr_ödex
, 
vÆ
);

2897 
s
->
gr
[s->
gr_ödex
] = 
vÆ
 & 
gr_mask
[s->gr_index];

2901 
s
->
¸_ödex
 = 
vÆ
;

2905 i‡(
	`cúrus_hook_wrôe_¸
(
s
, s->
¸_ödex
, 
vÆ
))

2907 #ifde‡
DEBUG_VGA_REG


2908 
	`¥ötf
("vga: wrôêCR%x = 0x%02x\n", 
s
->
¸_ödex
, 
vÆ
);

2911 i‡((
s
->
¸
[0x11] & 0x80Ë&& s->
¸_ödex
 <= 7) {

2913 i‡(
s
->
¸_ödex
 == 7)

2914 
s
->
¸
[7] = (s->¸[7] & ~0x10Ë| (
vÆ
 & 0x10);

2917 
s
->
¸_ödex
) {

2924 
s
->
¸
[s->
¸_ödex
] = 
vÆ
;

2928 
s
->
¸
[s->
¸_ödex
] = 
vÆ
;

2934 
s
->
f¸
 = 
vÆ
 & 0x10;

2937 
	}
}

2945 
uöt32_t
 
	$cúrus_mmio_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2947 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *Ë
›aque
;

2949 
addr
 &
CIRRUS_PNPMMIO_SIZE
 - 1;

2951 i‡(
addr
 >= 0x100) {

2952  
	`cúrus_mmio_b…_ªad
(
s
, 
addr
 - 0x100);

2954  
	`vga_i›‹t_ªad
(
s
, 
addr
 + 0x3c0);

2956 
	}
}

2958 
uöt32_t
 
	$cúrus_mmio_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2960 
uöt32_t
 
v
;

2961 #ifde‡
TARGET_WORDS_BIGENDIAN


2962 
v
 = 
	`cúrus_mmio_ªadb
(
›aque
, 
addr
) << 8;

2963 
v
 |
	`cúrus_mmio_ªadb
(
›aque
, 
addr
 + 1);

2965 
v
 = 
	`cúrus_mmio_ªadb
(
›aque
, 
addr
);

2966 
v
 |
	`cúrus_mmio_ªadb
(
›aque
, 
addr
 + 1) << 8;

2968  
v
;

2969 
	}
}

2971 
uöt32_t
 
	$cúrus_mmio_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2973 
uöt32_t
 
v
;

2974 #ifde‡
TARGET_WORDS_BIGENDIAN


2975 
v
 = 
	`cúrus_mmio_ªadb
(
›aque
, 
addr
) << 24;

2976 
v
 |
	`cúrus_mmio_ªadb
(
›aque
, 
addr
 + 1) << 16;

2977 
v
 |
	`cúrus_mmio_ªadb
(
›aque
, 
addr
 + 2) << 8;

2978 
v
 |
	`cúrus_mmio_ªadb
(
›aque
, 
addr
 + 3);

2980 
v
 = 
	`cúrus_mmio_ªadb
(
›aque
, 
addr
);

2981 
v
 |
	`cúrus_mmio_ªadb
(
›aque
, 
addr
 + 1) << 8;

2982 
v
 |
	`cúrus_mmio_ªadb
(
›aque
, 
addr
 + 2) << 16;

2983 
v
 |
	`cúrus_mmio_ªadb
(
›aque
, 
addr
 + 3) << 24;

2985  
v
;

2986 
	}
}

2988 
	$cúrus_mmio_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

2989 
uöt32_t
 
vÆ
)

2991 
CúrusVGASèã
 *
s
 = (CúrusVGASèã *Ë
›aque
;

2993 
addr
 &
CIRRUS_PNPMMIO_SIZE
 - 1;

2995 i‡(
addr
 >= 0x100) {

2996 
	`cúrus_mmio_b…_wrôe
(
s
, 
addr
 - 0x100, 
vÆ
);

2998 
	`vga_i›‹t_wrôe
(
s
, 
addr
 + 0x3c0, 
vÆ
);

3000 
	}
}

3002 
	$cúrus_mmio_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

3003 
uöt32_t
 
vÆ
)

3005 #ifde‡
TARGET_WORDS_BIGENDIAN


3006 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 8) & 0xff);

3007 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
 + 1, 
vÆ
 & 0xff);

3009 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

3010 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

3012 
	}
}

3014 
	$cúrus_mmio_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

3015 
uöt32_t
 
vÆ
)

3017 #ifde‡
TARGET_WORDS_BIGENDIAN


3018 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 24) & 0xff);

3019 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 16) & 0xff);

3020 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 8) & 0xff);

3021 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
 + 3, 
vÆ
 & 0xff);

3023 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

3024 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

3025 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 16) & 0xff);

3026 
	`cúrus_mmio_wrôeb
(
›aque
, 
addr
 + 3, (
vÆ
 >> 24) & 0xff);

3028 
	}
}

3031 
CPURódMem‹yFunc
 *
	gcúrus_mmio_ªad
[3] = {

3032 
cúrus_mmio_ªadb
,

3033 
cúrus_mmio_ªadw
,

3034 
cúrus_mmio_ªadl
,

3037 
CPUWrôeMem‹yFunc
 *
	gcúrus_mmio_wrôe
[3] = {

3038 
cúrus_mmio_wrôeb
,

3039 
cúrus_mmio_wrôew
,

3040 
cúrus_mmio_wrôñ
,

3043 
	$cúrus_°›_acc
(
CúrusVGASèã
 *
s
)

3045 i‡(
s
->
m≠_addr
){

3046 
îr‹
;

3047 
s
->
m≠_addr
 = 0;

3048 
îr‹
 = 
	`un£t_vøm_m≠pög
(
s
->
cúrus_lfb_addr
,

3049 
s
->
cúrus_lfb_íd
, s->
vøm_±r
);

3050 
	`Ârötf
(
°dîr
, "cirrus_stop_acc:unset_vram_mapping.\n");

3052 
	}
}

3054 
	$cúrus_ª°¨t_acc
(
CúrusVGASèã
 *
s
)

3056 i‡(
s
->
cúrus_lfb_addr
 && s->
cúrus_lfb_íd
) {

3057 *
vøm_poöãr
, *
ﬁd_vøm
;

3058 
	`Ârötf
(
°dîr
, "cirrus_vga_load:re-enable vgaácc.lfb_addr=0x%lx,Üfb_end=0x%lx.\n",

3059 
s
->
cúrus_lfb_addr
, s->
cúrus_lfb_íd
);

3060 
vøm_poöãr
 = 
	`£t_vøm_m≠pög
(
s
->
cúrus_lfb_addr
 ,s->
cúrus_lfb_íd
);

3061 i‡(!
vøm_poöãr
){

3062 
	`Ârötf
(
°dîr
, "cirrus_vga_load:NULL vram_pointer\n");

3064 
ﬁd_vøm
 = 
	`vga_upd©e_vøm
((
VGASèã
 *)
s
, 
vøm_poöãr
,

3065 
VGA_RAM_SIZE
);

3066 
	`qemu_‰ì
(
ﬁd_vøm
);

3067 
s
->
m≠_addr
 = s->
cúrus_lfb_addr
;

3068 
s
->
m≠_íd
 = s->
cúrus_lfb_íd
;

3071 
	}
}

3075 
	$cúrus_vga_ßve
(
QEMUFûe
 *
f
, *
›aque
)

3077 
CúrusVGASèã
 *
s
 = 
›aque
;

3078 
uöt8_t
 
vga_acc
;

3080 i‡(
s
->
pci_dev
)

3081 
	`pci_devi˚_ßve
(
s
->
pci_dev
, 
f
);

3083 
	`qemu_put_be32s
(
f
, &
s
->
œtch
);

3084 
	`qemu_put_8s
(
f
, &
s
->
§_ödex
);

3085 
	`qemu_put_buf„r
(
f
, 
s
->
§
, 256);

3086 
	`qemu_put_8s
(
f
, &
s
->
gr_ödex
);

3087 
	`qemu_put_8s
(
f
, &
s
->
cúrus_shadow_gr0
);

3088 
	`qemu_put_8s
(
f
, &
s
->
cúrus_shadow_gr1
);

3089 
	`qemu_put_buf„r
(
f
, 
s
->
gr
 + 2, 254);

3090 
	`qemu_put_8s
(
f
, &
s
->
¨_ödex
);

3091 
	`qemu_put_buf„r
(
f
, 
s
->
¨
, 21);

3092 
	`qemu_put_be32s
(
f
, &
s
->
¨_Êù_Ê›
);

3093 
	`qemu_put_8s
(
f
, &
s
->
¸_ödex
);

3094 
	`qemu_put_buf„r
(
f
, 
s
->
¸
, 256);

3095 
	`qemu_put_8s
(
f
, &
s
->
m§
);

3096 
	`qemu_put_8s
(
f
, &
s
->
f¸
);

3097 
	`qemu_put_8s
(
f
, &
s
->
°00
);

3098 
	`qemu_put_8s
(
f
, &
s
->
°01
);

3100 
	`qemu_put_8s
(
f
, &
s
->
dac_°©e
);

3101 
	`qemu_put_8s
(
f
, &
s
->
dac_sub_ödex
);

3102 
	`qemu_put_8s
(
f
, &
s
->
dac_ªad_ödex
);

3103 
	`qemu_put_8s
(
f
, &
s
->
dac_wrôe_ödex
);

3104 
	`qemu_put_buf„r
(
f
, 
s
->
dac_ˇche
, 3);

3105 
	`qemu_put_buf„r
(
f
, 
s
->
∑Àâe
, 768);

3107 
	`qemu_put_be32s
(
f
, &
s
->
b™k_off£t
);

3109 
	`qemu_put_8s
(
f
, &
s
->
cúrus_hiddí_dac_locködex
);

3110 
	`qemu_put_8s
(
f
, &
s
->
cúrus_hiddí_dac_d©a
);

3112 
	`qemu_put_be32s
(
f
, &
s
->
hw_curs‹_x
);

3113 
	`qemu_put_be32s
(
f
, &
s
->
hw_curs‹_y
);

3117 
vga_acc
 = (!!
s
->
m≠_addr
);

3118 
	`qemu_put_8s
(
f
, &
vga_acc
);

3119 
	`qemu_put_be64s
(
f
, (
uöt64_t
*)&
s
->
cúrus_lfb_addr
);

3120 
	`qemu_put_be64s
(
f
, (
uöt64_t
*)&
s
->
cúrus_lfb_íd
);

3121 
	`qemu_put_buf„r
(
f
, 
s
->
vøm_±r
, 
VGA_RAM_SIZE
);

3122 
	}
}

3124 
	$cúrus_vga_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

3126 
CúrusVGASèã
 *
s
 = 
›aque
;

3127 
uöt8_t
 
vga_acc
 = 0;

3128 
ªt
;

3130 i‡(
vîsi⁄_id
 > 2)

3131  -
EINVAL
;

3133 i‡(
s
->
pci_dev
 && 
vîsi⁄_id
 >= 2) {

3134 
ªt
 = 
	`pci_devi˚_lﬂd
(
s
->
pci_dev
, 
f
);

3135 i‡(
ªt
 < 0)

3136  
ªt
;

3139 
	`qemu_gë_be32s
(
f
, &
s
->
œtch
);

3140 
	`qemu_gë_8s
(
f
, &
s
->
§_ödex
);

3141 
	`qemu_gë_buf„r
(
f
, 
s
->
§
, 256);

3142 
	`qemu_gë_8s
(
f
, &
s
->
gr_ödex
);

3143 
	`qemu_gë_8s
(
f
, &
s
->
cúrus_shadow_gr0
);

3144 
	`qemu_gë_8s
(
f
, &
s
->
cúrus_shadow_gr1
);

3145 
s
->
gr
[0x00] = s->
cúrus_shadow_gr0
 & 0x0f;

3146 
s
->
gr
[0x01] = s->
cúrus_shadow_gr1
 & 0x0f;

3147 
	`qemu_gë_buf„r
(
f
, 
s
->
gr
 + 2, 254);

3148 
	`qemu_gë_8s
(
f
, &
s
->
¨_ödex
);

3149 
	`qemu_gë_buf„r
(
f
, 
s
->
¨
, 21);

3150 
	`qemu_gë_be32s
(
f
, &
s
->
¨_Êù_Ê›
);

3151 
	`qemu_gë_8s
(
f
, &
s
->
¸_ödex
);

3152 
	`qemu_gë_buf„r
(
f
, 
s
->
¸
, 256);

3153 
	`qemu_gë_8s
(
f
, &
s
->
m§
);

3154 
	`qemu_gë_8s
(
f
, &
s
->
f¸
);

3155 
	`qemu_gë_8s
(
f
, &
s
->
°00
);

3156 
	`qemu_gë_8s
(
f
, &
s
->
°01
);

3158 
	`qemu_gë_8s
(
f
, &
s
->
dac_°©e
);

3159 
	`qemu_gë_8s
(
f
, &
s
->
dac_sub_ödex
);

3160 
	`qemu_gë_8s
(
f
, &
s
->
dac_ªad_ödex
);

3161 
	`qemu_gë_8s
(
f
, &
s
->
dac_wrôe_ödex
);

3162 
	`qemu_gë_buf„r
(
f
, 
s
->
dac_ˇche
, 3);

3163 
	`qemu_gë_buf„r
(
f
, 
s
->
∑Àâe
, 768);

3165 
	`qemu_gë_be32s
(
f
, &
s
->
b™k_off£t
);

3167 
	`qemu_gë_8s
(
f
, &
s
->
cúrus_hiddí_dac_locködex
);

3168 
	`qemu_gë_8s
(
f
, &
s
->
cúrus_hiddí_dac_d©a
);

3170 
	`qemu_gë_be32s
(
f
, &
s
->
hw_curs‹_x
);

3171 
	`qemu_gë_be32s
(
f
, &
s
->
hw_curs‹_y
);

3173 
	`qemu_gë_8s
(
f
, &
vga_acc
);

3174 
	`qemu_gë_be64s
(
f
, (
uöt64_t
*)&
s
->
cúrus_lfb_addr
);

3175 
	`qemu_gë_be64s
(
f
, (
uöt64_t
*)&
s
->
cúrus_lfb_íd
);

3176 
	`qemu_gë_buf„r
(
f
, 
s
->
vøm_±r
, 
VGA_RAM_SIZE
);

3177 i‡(
vga_acc
){

3178 
	`cúrus_ª°¨t_acc
(
s
);

3182 
s
->
gøphic_mode
 = -1;

3183 
	`cúrus_upd©e_b™k_±r
(
s
, 0);

3184 
	`cúrus_upd©e_b™k_±r
(
s
, 1);

3186 
	}
}

3194 
	$cúrus_öô_comm⁄
(
CúrusVGASèã
 * 
s
, 
devi˚_id
, 
is_pci
)

3196 
vga_io_mem‹y
, 
i
;

3197 
öôed
;

3199 i‡(!
öôed
) {

3200 
öôed
 = 1;

3201 
i
 = 0;i < 256; i++)

3202 
r›_to_ödex
[
i
] = 
CIRRUS_ROP_NOP_INDEX
;

3203 
r›_to_ödex
[
CIRRUS_ROP_0
] = 0;

3204 
r›_to_ödex
[
CIRRUS_ROP_SRC_AND_DST
] = 1;

3205 
r›_to_ödex
[
CIRRUS_ROP_NOP
] = 2;

3206 
r›_to_ödex
[
CIRRUS_ROP_SRC_AND_NOTDST
] = 3;

3207 
r›_to_ödex
[
CIRRUS_ROP_NOTDST
] = 4;

3208 
r›_to_ödex
[
CIRRUS_ROP_SRC
] = 5;

3209 
r›_to_ödex
[
CIRRUS_ROP_1
] = 6;

3210 
r›_to_ödex
[
CIRRUS_ROP_NOTSRC_AND_DST
] = 7;

3211 
r›_to_ödex
[
CIRRUS_ROP_SRC_XOR_DST
] = 8;

3212 
r›_to_ödex
[
CIRRUS_ROP_SRC_OR_DST
] = 9;

3213 
r›_to_ödex
[
CIRRUS_ROP_NOTSRC_OR_NOTDST
] = 10;

3214 
r›_to_ödex
[
CIRRUS_ROP_SRC_NOTXOR_DST
] = 11;

3215 
r›_to_ödex
[
CIRRUS_ROP_SRC_OR_NOTDST
] = 12;

3216 
r›_to_ödex
[
CIRRUS_ROP_NOTSRC
] = 13;

3217 
r›_to_ödex
[
CIRRUS_ROP_NOTSRC_OR_DST
] = 14;

3218 
r›_to_ödex
[
CIRRUS_ROP_NOTSRC_AND_NOTDST
] = 15;

3221 
	`ªgi°î_i›‹t_wrôe
(0x3c0, 16, 1, 
vga_i›‹t_wrôe
, 
s
);

3223 
	`ªgi°î_i›‹t_wrôe
(0x3b4, 2, 1, 
vga_i›‹t_wrôe
, 
s
);

3224 
	`ªgi°î_i›‹t_wrôe
(0x3d4, 2, 1, 
vga_i›‹t_wrôe
, 
s
);

3225 
	`ªgi°î_i›‹t_wrôe
(0x3ba, 1, 1, 
vga_i›‹t_wrôe
, 
s
);

3226 
	`ªgi°î_i›‹t_wrôe
(0x3da, 1, 1, 
vga_i›‹t_wrôe
, 
s
);

3228 
	`ªgi°î_i›‹t_ªad
(0x3c0, 16, 1, 
vga_i›‹t_ªad
, 
s
);

3230 
	`ªgi°î_i›‹t_ªad
(0x3b4, 2, 1, 
vga_i›‹t_ªad
, 
s
);

3231 
	`ªgi°î_i›‹t_ªad
(0x3d4, 2, 1, 
vga_i›‹t_ªad
, 
s
);

3232 
	`ªgi°î_i›‹t_ªad
(0x3ba, 1, 1, 
vga_i›‹t_ªad
, 
s
);

3233 
	`ªgi°î_i›‹t_ªad
(0x3da, 1, 1, 
vga_i›‹t_ªad
, 
s
);

3235 
vga_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
cúrus_vga_mem_ªad
,

3236 
cúrus_vga_mem_wrôe
, 
s
);

3237 
	`˝u_ªgi°î_physiˇl_mem‹y
(
iß_mem_ba£
 + 0x000a0000, 0x20000,

3238 
vga_io_mem‹y
);

3240 
s
->
§
[0x06] = 0x0f;

3241 i‡(
devi˚_id
 =
CIRRUS_ID_CLGD5446
) {

3243 
s
->
§
[0x1F] = 0x2d;

3244 
s
->
gr
[0x18] = 0x0f;

3246 
s
->
§
[0x0f] = 0x98;

3247 
s
->
§
[0x17] = 0x20;

3248 
s
->
§
[0x15] = 0x04;

3249 
s
->
ªÆ_vøm_size
 = 4096 * 1024;

3251 
s
->
§
[0x0f] = 0x18;

3252 
s
->
§
[0x17] = 0x20;

3253 
s
->
§
[0x15] = 0x03;

3254 
s
->
ªÆ_vøm_size
 = 2048 * 1024;

3257 
s
->
§
[0x1F] = 0x22;

3258 
s
->
§
[0x0F] = 
CIRRUS_MEMSIZE_2M
;

3259 i‡(
is_pci
)

3260 
s
->
§
[0x17] = 
CIRRUS_BUSTYPE_PCI
;

3262 
s
->
§
[0x17] = 
CIRRUS_BUSTYPE_ISA
;

3263 
s
->
ªÆ_vøm_size
 = 2048 * 1024;

3264 
s
->
§
[0x15] = 0x03;

3266 
s
->
¸
[0x27] = 
devi˚_id
;

3270 
	`mem£t
(
s
->
vøm_±r
, 0xff, s->
ªÆ_vøm_size
);

3272 
s
->
cúrus_hiddí_dac_locködex
 = 5;

3273 
s
->
cúrus_hiddí_dac_d©a
 = 0;

3276 
s
->
cúrus_löór_io_addr
 =

3277 
	`˝u_ªgi°î_io_mem‹y
(0, 
cúrus_löór_ªad
, 
cúrus_löór_wrôe
,

3278 
s
);

3279 
s
->
cúrus_löór_wrôe
 = 
	`˝u_gë_io_mem‹y_wrôe
(s->
cúrus_löór_io_addr
);

3282 
s
->
cúrus_löór_bôb…_io_addr
 =

3283 
	`˝u_ªgi°î_io_mem‹y
(0, 
cúrus_löór_bôb…_ªad
, 
cúrus_löór_bôb…_wrôe
,

3284 
s
);

3287 
s
->
cúrus_mmio_io_addr
 =

3288 
	`˝u_ªgi°î_io_mem‹y
(0, 
cúrus_mmio_ªad
, 
cúrus_mmio_wrôe
, 
s
);

3291 
s
->
cúrus_addr_mask
 = s->
ªÆ_vøm_size
 - 1;

3292 
s
->
löór_mmio_mask
 = s->
ªÆ_vøm_size
 - 256;

3294 
s
->
gë_bµ
 = 
cúrus_gë_bµ
;

3295 
s
->
gë_off£ts
 = 
cúrus_gë_off£ts
;

3296 
s
->
gë_ªsﬁuti⁄
 = 
cúrus_gë_ªsﬁuti⁄
;

3297 
s
->
curs‹_övÆid©e
 = 
cúrus_curs‹_övÆid©e
;

3298 
s
->
curs‹_døw_löe
 = 
cúrus_curs‹_døw_löe
;

3300 
	`ªgi°î_ßvevm
("cúrus_vga", 0, 2, 
cúrus_vga_ßve
, 
cúrus_vga_lﬂd
, 
s
);

3301 
	}
}

3309 
	$iß_cúrus_vga_öô
(
Di•œySèã
 *
ds
, 
uöt8_t
 *
vga_øm_ba£
,

3310 
vga_øm_off£t
, 
vga_øm_size
)

3312 
CúrusVGASèã
 *
s
;

3314 
s
 = 
	`qemu_mÆlocz
((
CúrusVGASèã
));

3316 
	`vga_comm⁄_öô
((
VGASèã
 *)
s
,

3317 
ds
, 
vga_øm_ba£
, 
vga_øm_off£t
, 
vga_øm_size
);

3318 
	`cúrus_öô_comm⁄
(
s
, 
CIRRUS_ID_CLGD5430
, 0);

3320 
	}
}

3328 
	$cúrus_pci_lfb_m≠
(
PCIDevi˚
 *
d
, 
ªgi⁄_num
,

3329 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

3331 
CúrusVGASèã
 *
s
 = &((
PCICúrusVGASèã
 *)
d
)->
cúrus_vga
;

3334 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
s
->
vøm_size
,

3335 
s
->
cúrus_löór_io_addr
);

3336 
s
->
cúrus_lfb_addr
 = 
addr
;

3337 
s
->
cúrus_lfb_íd
 = 
addr
 + 
VGA_RAM_SIZE
;

3339 i‡(
s
->
m≠_addr
 && (s->
cúrus_lfb_addr
 != s->map_addr) &&

3340 (
s
->
cúrus_lfb_íd
 !s->
m≠_íd
))

3341 
	`Ârötf
(
logfûe
, "cirrus vga map change while onÜfb mode\n");

3343 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x1000000, 0x400000,

3344 
s
->
cúrus_löór_bôb…_io_addr
);

3345 
	}
}

3347 
	$cúrus_pci_mmio_m≠
(
PCIDevi˚
 *
d
, 
ªgi⁄_num
,

3348 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

3350 
CúrusVGASèã
 *
s
 = &((
PCICúrusVGASèã
 *)
d
)->
cúrus_vga
;

3352 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
CIRRUS_PNPMMIO_SIZE
,

3353 
s
->
cúrus_mmio_io_addr
);

3354 
	}
}

3356 
	$pci_cúrus_vga_öô
(
PCIBus
 *
bus
, 
Di•œySèã
 *
ds
, 
uöt8_t
 *
vga_øm_ba£
,

3357 
vga_øm_off£t
, 
vga_øm_size
)

3359 
PCICúrusVGASèã
 *
d
;

3360 
uöt8_t
 *
pci_c⁄f
;

3361 
CúrusVGASèã
 *
s
;

3362 
devi˚_id
;

3364 
devi˚_id
 = 
CIRRUS_ID_CLGD5446
;

3367 
d
 = (
PCICúrusVGASèã
 *)
	`pci_ªgi°î_devi˚
(
bus
, "Cirrus VGA",

3368 (
PCICúrusVGASèã
),

3369 -1, 
NULL
, NULL);

3370 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

3371 
pci_c⁄f
[0x00] = (
uöt8_t
Ë(
PCI_VENDOR_CIRRUS
 & 0xff);

3372 
pci_c⁄f
[0x01] = (
uöt8_t
Ë(
PCI_VENDOR_CIRRUS
 >> 8);

3373 
pci_c⁄f
[0x02] = (
uöt8_t
Ë(
devi˚_id
 & 0xff);

3374 
pci_c⁄f
[0x03] = (
uöt8_t
Ë(
devi˚_id
 >> 8);

3375 
pci_c⁄f
[0x04] = 
PCI_COMMAND_IOACCESS
 | 
PCI_COMMAND_MEMACCESS
;

3376 
pci_c⁄f
[0x0a] = 
PCI_CLASS_SUB_VGA
;

3377 
pci_c⁄f
[0x0b] = 
PCI_CLASS_BASE_DISPLAY
;

3378 
pci_c⁄f
[0x0e] = 
PCI_CLASS_HEADERTYPE_00h
;

3379 
pci_c⁄f
[0x2c] = 0x53;

3380 
pci_c⁄f
[0x2d] = 0x58;

3381 
pci_c⁄f
[0x2e] = 0x01;

3382 
pci_c⁄f
[0x2f] = 0x00;

3385 
s
 = &
d
->
cúrus_vga
;

3386 
	`vga_comm⁄_öô
((
VGASèã
 *)
s
,

3387 
ds
, 
vga_øm_ba£
, 
vga_øm_off£t
, 
vga_øm_size
);

3388 
	`cúrus_öô_comm⁄
(
s
, 
devi˚_id
, 1);

3389 
s
->
pci_dev
 = (
PCIDevi˚
 *)
d
;

3395 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 0, 0x2000000,

3396 
PCI_ADDRESS_SPACE_MEM_PREFETCH
, 
cúrus_pci_lfb_m≠
);

3397 i‡(
devi˚_id
 =
CIRRUS_ID_CLGD5446
) {

3398 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 1, 
CIRRUS_PNPMMIO_SIZE
,

3399 
PCI_ADDRESS_SPACE_MEM
, 
cúrus_pci_mmio_m≠
);

3402 
	}
}

	@cirrus_vga_rop.h

25 
	#gë_ba£
(
p
, 
s
, 
b
) do { \

26 i‡((
p
Ë>(
s
)->
vøm_±r
 && (pË< (s)->vøm_±∏+ (s)->
vøm_size
) \

27 (
b
Ë(
s
)->
vøm_±r
; \

28 i‡((
p
Ë>&(
s
)->
cúrus_b…buf
[0] && \

29 (
p
Ë< &(
s
)->
cúrus_b…buf
[
CIRRUS_BLTBUFSIZE
]) \

30 (
b
Ë&(
s
)->
cúrus_b…buf
[0]; \

33 } 0)

	)

35 
	#m
(
x
Ë((xË& 
s
->
cúrus_addr_mask
)

	)

38 
	$glue
(
cúrus_bôb…_r›_fwd_
, 
ROP_NAME
)(
CúrusVGASèã
 *
s
,

39 
uöt8_t
 *
d°_
,c⁄° uöt8_à*
§c_
,

40 
d°pôch
,
§˝ôch
,

41 
b…width
,
b…height
)

43 
x
,
y
;

44 
uöt32_t
 
d°
, 
§c
;

45 
uöt8_t
 *
d°_ba£
, *
§c_ba£
;

46 
	`gë_ba£
(
d°_
, 
s
, 
d°_ba£
);

47 
	`gë_ba£
(
§c_
, 
s
, 
§c_ba£
);

48 
d°
 = 
d°_
 - 
d°_ba£
;

49 
§c
 = 
§c_
 - 
§c_ba£
;

50 
d°pôch
 -
b…width
;

51 
§˝ôch
 -
b…width
;

52 
y
 = 0; y < 
b…height
; y++) {

53 
x
 = 0; x < 
b…width
; x++) {

54 
	`ROP_OP
(*(
d°_ba£
 + 
	`m
(
d°
)), *(
§c_ba£
 + m(
§c
)));

55 
d°
++;

56 
§c
++;

58 
d°
 +
d°pôch
;

59 
§c
 +
§˝ôch
;

61 
	}
}

64 
	$glue
(
cúrus_bôb…_r›_bkwd_
, 
ROP_NAME
)(
CúrusVGASèã
 *
s
,

65 
uöt8_t
 *
d°_
,c⁄° uöt8_à*
§c_
,

66 
d°pôch
,
§˝ôch
,

67 
b…width
,
b…height
)

69 
x
,
y
;

70 
uöt32_t
 
d°
, 
§c
;

71 
uöt8_t
 *
d°_ba£
, *
§c_ba£
;

72 
	`gë_ba£
(
d°_
, 
s
, 
d°_ba£
);

73 
	`gë_ba£
(
§c_
, 
s
, 
§c_ba£
);

74 
d°
 = 
d°_
 - 
d°_ba£
;

75 
§c
 = 
§c_
 - 
§c_ba£
;

76 
d°pôch
 +
b…width
;

77 
§˝ôch
 +
b…width
;

78 
y
 = 0; y < 
b…height
; y++) {

79 
x
 = 0; x < 
b…width
; x++) {

80 
	`ROP_OP
(*(
d°_ba£
 + 
	`m
(
d°
)), *(
§c_ba£
 + m(
§c
)));

81 
d°
--;

82 
§c
--;

84 
d°
 +
d°pôch
;

85 
§c
 +
§˝ôch
;

87 
	}
}

89 
	#DEPTH
 8

	)

90 
	~"cúrus_vga_r›2.h
"

92 
	#DEPTH
 16

	)

93 
	~"cúrus_vga_r›2.h
"

95 
	#DEPTH
 24

	)

96 
	~"cúrus_vga_r›2.h
"

98 
	#DEPTH
 32

	)

99 
	~"cúrus_vga_r›2.h
"

101 #unde‡
ROP_NAME


102 #unde‡
ROP_OP


104 #unde‡
gë_ba£


105 #unde‡
m


	@cirrus_vga_rop2.h

25 #i‡
DEPTH
 == 8

26 
	#PUTPIXEL
(Ë
	`ROP_OP
((
d°_ba£
 + 
	`m
(
d
))[0], 
cﬁ
)

	)

27 #ñi‡
DEPTH
 == 16

28 
	#PUTPIXEL
(Ë
	`ROP_OP
(((
uöt16_t
 *)(
d°_ba£
 + 
	`m
(
d
)))[0], 
cﬁ
);

	)

29 #ñi‡
DEPTH
 == 24

30 
	#PUTPIXEL
(Ë
	`ROP_OP
((
d°_ba£
 + 
	`m
(
d
))[0], 
cﬁ
); \

31 
	`ROP_OP
((
d°_ba£
 + 
	`m
(
d
))[1], (
cﬁ
 >> 8)); \

32 
	`ROP_OP
((
d°_ba£
 + 
	`m
(
d
))[2], (
cﬁ
 >> 16))

	)

33 #ñi‡
DEPTH
 == 32

34 
	#PUTPIXEL
(Ë
	`ROP_OP
(((
uöt32_t
 *)(
d°_ba£
 + 
	`m
(
d
)))[0], 
cﬁ
)

	)

36 #îr‹ 
unsuµ‹ãd
 
DEPTH


40 
glue
(glue(glue(
cúrus_∑âînfûl_
, 
ROP_NAME
), 
_
),
DEPTH
)

41 (
CúrusVGASèã
 * 
	gs
, 
uöt8_t
 * 
	gd°_
,

42 c⁄° 
uöt8_t
 * 
	g§c_
,

43 
	gd°pôch
, 
	g§˝ôch
,

44 
	gb…width
, 
	gb…height
)

46 
uöt8_t
 *
	gd°_ba£
, *
	g§c_ba£
;

47 
uöt32_t
 
	g§c
, 
	gd°
;

48 
uöt32_t
 
	gd
;

49 
	gx
, 
	gy
, 
	g∑âîn_y
, 
	g∑âîn_pôch
, 
	g∑âîn_x
;

50 
	gcﬁ
;

51 
uöt32_t
 
	g§c1
;

52 #i‡
DEPTH
 == 24

53 
	gskùÀ·
 = 
s
->
gr
[0x2f] & 0x1f;

55 
	gskùÀ·
 = (
s
->
gr
[0x2f] & 0x07Ë* (
DEPTH
 / 8);

58 
gë_ba£
(
d°_
, 
s
, 
d°_ba£
);

59 
gë_ba£
(
§c_
, 
s
, 
§c_ba£
);

60 
	gd°
 = 
d°_
 - 
d°_ba£
;

61 
	g§c
 = 
§c_
 - 
§c_ba£
;

62 #i‡
DEPTH
 == 8

63 
	g∑âîn_pôch
 = 8;

64 #ñi‡
DEPTH
 == 16

65 
	g∑âîn_pôch
 = 16;

67 
	g∑âîn_pôch
 = 32;

69 
	g∑âîn_y
 = 
s
->
cúrus_b…_§ˇddr
 & 7;

70 
	gy
 = 0; y < 
	gb…height
; y++) {

71 
	g∑âîn_x
 = 
skùÀ·
;

72 
	gd
 = 
d°
 + 
skùÀ·
;

73 
	g§c1
 = 
§c
 + 
∑âîn_y
 * 
∑âîn_pôch
;

74 
	gx
 = 
skùÀ·
; x < 
	gb…width
; x +(
DEPTH
 / 8)) {

75 #i‡
DEPTH
 == 8

76 
cﬁ
 = *(
§c_ba£
 + 
m
(
§c1
 + 
∑âîn_x
));

77 
	g∑âîn_x
 = (
∑âîn_x
 + 1) & 7;

78 #ñi‡
DEPTH
 == 16

79 
	gcﬁ
 = *(
uöt16_t
 *)(
§c_ba£
 + 
m
(
§c1
 + 
∑âîn_x
));

80 
	g∑âîn_x
 = (
∑âîn_x
 + 2) & 15;

81 #ñi‡
DEPTH
 == 24

83 c⁄° 
uöt8_t
 *
	g§c2
 = 
§c_ba£
 + 
m
(
§c1
 + 
∑âîn_x
 * 3);

84 
	gcﬁ
 = 
§c2
[0] | (src2[1] << 8) | (src2[2] << 16);

85 
	g∑âîn_x
 = (
∑âîn_x
 + 1) & 7;

88 
	gcﬁ
 = *(
uöt32_t
 *)(
§c_ba£
 + 
m
(
§c1
 + 
∑âîn_x
));

89 
	g∑âîn_x
 = (
∑âîn_x
 + 4) & 31;

91 
PUTPIXEL
();

92 
	gd
 +(
DEPTH
 / 8);

94 
	g∑âîn_y
 = (
∑âîn_y
 + 1) & 7;

95 
	gd°
 +
d°pôch
;

101 
glue
(glue(glue(
cúrus_cﬁ‹ex∑nd_å™•_
, 
ROP_NAME
), 
_
),
DEPTH
)

102 (
CúrusVGASèã
 * 
	gs
, 
uöt8_t
 * 
	gd°_
,

103 c⁄° 
uöt8_t
 * 
	g§c_
,

104 
	gd°pôch
, 
	g§˝ôch
,

105 
	gb…width
, 
	gb…height
)

107 
uöt8_t
 *
	gd°_ba£
, *
	g§c_ba£
;

108 
uöt32_t
 
	g§c
, 
	gd°
;

109 
uöt32_t
 
	gd
;

110 
	gx
, 
	gy
;

111 
	gbôs
, 
	gbôs_x‹
;

112 
	gcﬁ
;

113 
	gbômask
;

114 
	gödex
;

115 #i‡
DEPTH
 == 24

116 
	gd°skùÀ·
 = 
s
->
gr
[0x2f] & 0x1f;

117 
	g§cskùÀ·
 = 
d°skùÀ·
 / 3;

119 
	g§cskùÀ·
 = 
s
->
gr
[0x2f] & 0x07;

120 
	gd°skùÀ·
 = 
§cskùÀ·
 * (
DEPTH
 / 8);

123 
gë_ba£
(
d°_
, 
s
, 
d°_ba£
);

124 
gë_ba£
(
§c_
, 
s
, 
§c_ba£
);

125 
	gd°
 = 
d°_
 - 
d°_ba£
;

126 
	g§c
 = 
§c_
 - 
§c_ba£
;

127 i‡(
	gs
->
	gcúrus_b…_modìxt
 & 
	gCIRRUS_BLTMODEEXT_COLOREXPINV
) {

128 
	gbôs_x‹
 = 0xff;

129 
	gcﬁ
 = 
s
->
cúrus_b…_bgcﬁ
;

131 
	gbôs_x‹
 = 0x00;

132 
	gcﬁ
 = 
s
->
cúrus_b…_fgcﬁ
;

135 
	gy
 = 0; y < 
	gb…height
; y++) {

136 
	gbômask
 = 0x80 >> 
§cskùÀ·
;

137 
	gbôs
 = *(
§c_ba£
 + 
m
(
§c
++)Ë^ 
bôs_x‹
;

138 
	gd
 = 
d°
 + 
d°skùÀ·
;

139 
	gx
 = 
d°skùÀ·
; x < 
	gb…width
; x +(
DEPTH
 / 8)) {

140 i‡((
bômask
 & 0xff) == 0) {

141 
bômask
 = 0x80;

142 
	gbôs
 = *(
§c_ba£
 + 
m
(
§c
++)Ë^ 
bôs_x‹
;

144 
	gödex
 = (
bôs
 & 
bômask
);

145 i‡(
	gödex
) {

146 
PUTPIXEL
();

148 
	gd
 +(
DEPTH
 / 8);

149 
	gbômask
 >>= 1;

151 
	gd°
 +
d°pôch
;

156 
glue
(glue(glue(
cúrus_cﬁ‹ex∑nd_
, 
ROP_NAME
), 
_
),
DEPTH
)

157 (
CúrusVGASèã
 * 
	gs
, 
uöt8_t
 * 
	gd°_
,

158 c⁄° 
uöt8_t
 * 
	g§c_
,

159 
	gd°pôch
, 
	g§˝ôch
,

160 
	gb…width
, 
	gb…height
)

162 
uöt8_t
 *
	gd°_ba£
, *
	g§c_ba£
;

163 
uöt32_t
 
	g§c
, 
	gd°
;

164 
uöt32_t
 
	gcﬁ‹s
[2];

165 
uöt32_t
 
	gd
;

166 
	gx
, 
	gy
;

167 
	gbôs
;

168 
	gcﬁ
;

169 
	gbômask
;

170 
	g§cskùÀ·
 = 
s
->
gr
[0x2f] & 0x07;

171 
	gd°skùÀ·
 = 
§cskùÀ·
 * (
DEPTH
 / 8);

173 
gë_ba£
(
d°_
, 
s
, 
d°_ba£
);

174 
gë_ba£
(
§c_
, 
s
, 
§c_ba£
);

175 
	gd°
 = 
d°_
 - 
d°_ba£
;

176 
	g§c
 = 
§c_
 - 
§c_ba£
;

177 
	gcﬁ‹s
[0] = 
s
->
cúrus_b…_bgcﬁ
;

178 
	gcﬁ‹s
[1] = 
s
->
cúrus_b…_fgcﬁ
;

179 
	gy
 = 0; y < 
	gb…height
; y++) {

180 
	gbômask
 = 0x80 >> 
§cskùÀ·
;

181 
	gbôs
 = *(
§c_ba£
 + 
m
(
§c
++));

182 
	gd
 = 
d°
 + 
d°skùÀ·
;

183 
	gx
 = 
d°skùÀ·
; x < 
	gb…width
; x +(
DEPTH
 / 8)) {

184 i‡((
bômask
 & 0xff) == 0) {

185 
bômask
 = 0x80;

186 
	gbôs
 = *(
§c_ba£
 + 
m
(
§c
++));

188 
	gcﬁ
 = 
cﬁ‹s
[!!(
bôs
 & 
bômask
)];

189 
PUTPIXEL
();

190 
	gd
 +(
DEPTH
 / 8);

191 
	gbômask
 >>= 1;

193 
	gd°
 +
d°pôch
;

198 
glue
(glue(glue(
cúrus_cﬁ‹ex∑nd_∑âîn_å™•_
, 
ROP_NAME
), 
_
),
DEPTH
)

199 (
CúrusVGASèã
 * 
	gs
, 
uöt8_t
 * 
	gd°_
,

200 c⁄° 
uöt8_t
 * 
	g§c_
,

201 
	gd°pôch
, 
	g§˝ôch
,

202 
	gb…width
, 
	gb…height
)

204 
uöt8_t
 *
	gd°_ba£
, *
	g§c_ba£
;

205 
uöt32_t
 
	g§c
, 
	gd°
;

206 
uöt32_t
 
	gd
;

207 
	gx
, 
	gy
, 
	gbôpos
, 
	g∑âîn_y
;

208 
	gbôs
, 
	gbôs_x‹
;

209 
	gcﬁ
;

210 #i‡
DEPTH
 == 24

211 
	gd°skùÀ·
 = 
s
->
gr
[0x2f] & 0x1f;

212 
	g§cskùÀ·
 = 
d°skùÀ·
 / 3;

214 
	g§cskùÀ·
 = 
s
->
gr
[0x2f] & 0x07;

215 
	gd°skùÀ·
 = 
§cskùÀ·
 * (
DEPTH
 / 8);

218 
gë_ba£
(
d°_
, 
s
, 
d°_ba£
);

219 
gë_ba£
(
§c_
, 
s
, 
§c_ba£
);

220 
	gd°
 = 
d°_
 - 
d°_ba£
;

221 
	g§c
 = 
§c_
 - 
§c_ba£
;

222 i‡(
	gs
->
	gcúrus_b…_modìxt
 & 
	gCIRRUS_BLTMODEEXT_COLOREXPINV
) {

223 
	gbôs_x‹
 = 0xff;

224 
	gcﬁ
 = 
s
->
cúrus_b…_bgcﬁ
;

226 
	gbôs_x‹
 = 0x00;

227 
	gcﬁ
 = 
s
->
cúrus_b…_fgcﬁ
;

229 
	g∑âîn_y
 = 
s
->
cúrus_b…_§ˇddr
 & 7;

231 
	gy
 = 0; y < 
	gb…height
; y++) {

232 
	gbôs
 = *(
§c_ba£
 + 
m
(
§c
 + 
∑âîn_y
)Ë^ 
bôs_x‹
;

233 
	gbôpos
 = 7 - 
§cskùÀ·
;

234 
	gd
 = 
d°
 + 
d°skùÀ·
;

235 
	gx
 = 
d°skùÀ·
; x < 
	gb…width
; x +(
DEPTH
 / 8)) {

236 i‡((
bôs
 >> 
bôpos
) & 1) {

237 
PUTPIXEL
();

239 
	gd
 +(
DEPTH
 / 8);

240 
	gbôpos
 = (
bôpos
 - 1) & 7;

242 
	g∑âîn_y
 = (
∑âîn_y
 + 1) & 7;

243 
	gd°
 +
d°pôch
;

248 
glue
(glue(glue(
cúrus_cﬁ‹ex∑nd_∑âîn_
, 
ROP_NAME
), 
_
),
DEPTH
)

249 (
CúrusVGASèã
 * 
	gs
, 
uöt8_t
 * 
	gd°_
,

250 c⁄° 
uöt8_t
 * 
	g§c_
,

251 
	gd°pôch
, 
	g§˝ôch
,

252 
	gb…width
, 
	gb…height
)

254 
uöt8_t
 *
	gd°_ba£
, *
	g§c_ba£
;

255 
uöt32_t
 
	g§c
, 
	gd°
;

256 
uöt32_t
 
	gcﬁ‹s
[2];

257 
uöt32_t
 
	gd
;

258 
	gx
, 
	gy
, 
	gbôpos
, 
	g∑âîn_y
;

259 
	gbôs
;

260 
	gcﬁ
;

261 
	g§cskùÀ·
 = 
s
->
gr
[0x2f] & 0x07;

262 
	gd°skùÀ·
 = 
§cskùÀ·
 * (
DEPTH
 / 8);

264 
gë_ba£
(
d°_
, 
s
, 
d°_ba£
);

265 
gë_ba£
(
§c_
, 
s
, 
§c_ba£
);

266 
	gd°
 = 
d°_
 - 
d°_ba£
;

267 
	g§c
 = 
§c_
 - 
§c_ba£
;

268 
	gcﬁ‹s
[0] = 
s
->
cúrus_b…_bgcﬁ
;

269 
	gcﬁ‹s
[1] = 
s
->
cúrus_b…_fgcﬁ
;

270 
	g∑âîn_y
 = 
s
->
cúrus_b…_§ˇddr
 & 7;

272 
	gy
 = 0; y < 
	gb…height
; y++) {

273 
	gbôs
 = *(
§c_ba£
 + 
m
(
§c
 + 
∑âîn_y
));

274 
	gbôpos
 = 7 - 
§cskùÀ·
;

275 
	gd
 = 
d°
 + 
d°skùÀ·
;

276 
	gx
 = 
d°skùÀ·
; x < 
	gb…width
; x +(
DEPTH
 / 8)) {

277 
cﬁ
 = 
cﬁ‹s
[(
bôs
 >> 
bôpos
) & 1];

278 
PUTPIXEL
();

279 
	gd
 +(
DEPTH
 / 8);

280 
	gbôpos
 = (
bôpos
 - 1) & 7;

282 
	g∑âîn_y
 = (
∑âîn_y
 + 1) & 7;

283 
	gd°
 +
d°pôch
;

288 
glue
(glue(glue(
cúrus_fûl_
, 
ROP_NAME
), 
_
),
DEPTH
)

289 (
CúrusVGASèã
 *
	gs
,

290 
uöt8_t
 *
	gd°_
, 
	gd°_pôch
,

291 
	gwidth
, 
	gheight
)

293 
uöt8_t
 *
	gd°_ba£
;

294 
uöt32_t
 
	gd°
;

295 
uöt32_t
 
	gd
, 
	gd1
;

296 
uöt32_t
 
	gcﬁ
;

297 
	gx
, 
	gy
;

299 
gë_ba£
(
d°_
, 
s
, 
d°_ba£
);

300 
	gd°
 = 
d°_
 - 
d°_ba£
;

301 
	gcﬁ
 = 
s
->
cúrus_b…_fgcﬁ
;

303 
	gd1
 = 
d°
;

304 
	gy
 = 0; y < 
	gheight
; y++) {

305 
	gd
 = 
d1
;

306 
	gx
 = 0; x < 
	gwidth
; x +(
DEPTH
 / 8)) {

307 
PUTPIXEL
();

308 
	gd
 +(
DEPTH
 / 8);

310 
	gd1
 +
d°_pôch
;

314 #unde‡
DEPTH


315 #unde‡
PUTPIXEL


	@cs4231.c

24 
	~"vl.h
"

32 
	#CS_MAXADDR
 0x3f

	)

33 
	#CS_REGS
 16

	)

34 
	#CS_DREGS
 32

	)

35 
	#CS_MAXDREG
 (
CS_DREGS
 - 1)

	)

37 
	sCSSèã
 {

38 
uöt32_t
 
	mªgs
[
CS_REGS
];

39 
uöt8_t
 
	mdªgs
[
CS_DREGS
];

40 *
	möt˘l
;

41 } 
	tCSSèã
;

43 
	#CS_RAP
(
s
Ë((s)->
ªgs
[0] & 
CS_MAXDREG
)

	)

44 
	#CS_VER
 0xa0

	)

45 
	#CS_CDC_VER
 0x8a

	)

47 #ifde‡
DEBUG_CS


48 
	#DPRINTF
(
fmt
, 
¨gs
...) \

49 dÿ{ 
	`¥ötf
("CS: " 
fmt
 , ##
¨gs
); } 0)

	)

50 
	#pic_£t_úq_√w
(
öt˘l
, 
úq
, 
Àvñ
) \

51 dÿ{ 
	`¥ötf
("CS: së_úq(%d): %d\n", (
úq
), (
Àvñ
)); \

52 
	`pic_£t_úq_√w
((
öt˘l
), (
úq
),(
Àvñ
));} 0)

	)

54 
	#DPRINTF
(
fmt
, 
¨gs
...)

	)

57 
	$cs_ª£t
(*
›aque
)

59 
CSSèã
 *
s
 = 
›aque
;

61 
	`mem£t
(
s
->
ªgs
, 0, 
CS_REGS
 * 4);

62 
	`mem£t
(
s
->
dªgs
, 0, 
CS_DREGS
);

63 
s
->
dªgs
[12] = 
CS_CDC_VER
;

64 
s
->
dªgs
[25] = 
CS_VER
;

65 
	}
}

67 
uöt32_t
 
	$cs_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

69 
CSSèã
 *
s
 = 
›aque
;

70 
uöt32_t
 
ßddr
, 
ªt
;

72 
ßddr
 = (
addr
 & 
CS_MAXADDR
) >> 2;

73 
ßddr
) {

75 
	`CS_RAP
(
s
)) {

77 
ªt
 = 0;

80 
ªt
 = 
s
->
dªgs
[
	`CS_RAP
(s)];

83 
	`DPRINTF
("ªad dªg[%d]: 0x%8.8x\n", 
	`CS_RAP
(
s
), 
ªt
);

86 
ªt
 = 
s
->
ªgs
[
ßddr
];

87 
	`DPRINTF
("ªadÑeg[%d]: 0x%8.8x\n", 
ßddr
, 
ªt
);

90  
ªt
;

91 
	}
}

93 
	$cs_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

95 
CSSèã
 *
s
 = 
›aque
;

96 
uöt32_t
 
ßddr
;

98 
ßddr
 = (
addr
 & 
CS_MAXADDR
) >> 2;

99 
	`DPRINTF
("wrôêªg[%d]: 0x%8.8x -> 0x%8.8x\n", 
ßddr
, 
s
->
ªgs
[ßddr], 
vÆ
);

100 
ßddr
) {

102 
	`DPRINTF
("wrôêdªg[%d]: 0x%2.2x -> 0x%2.2x\n", 
	`CS_RAP
(
s
), s->
dªgs
[CS_RAP(s)], 
vÆ
);

103 
	`CS_RAP
(
s
)) {

108 
vÆ
 &= 0x40;

109 
vÆ
 |
CS_CDC_VER
;

110 
s
->
dªgs
[
	`CS_RAP
(s)] = 
vÆ
;

113 
s
->
dªgs
[
	`CS_RAP
(s)] = 
vÆ
;

120 i‡(
vÆ
 & 1)

121 
	`cs_ª£t
(
s
);

122 
vÆ
 &= 0x7f;

123 
s
->
ªgs
[
ßddr
] = 
vÆ
;

126 
s
->
ªgs
[
ßddr
] = 
vÆ
;

129 
	}
}

131 
CPURódMem‹yFunc
 *
	gcs_mem_ªad
[3] = {

132 
cs_mem_ªadl
,

133 
cs_mem_ªadl
,

134 
cs_mem_ªadl
,

137 
CPUWrôeMem‹yFunc
 *
	gcs_mem_wrôe
[3] = {

138 
cs_mem_wrôñ
,

139 
cs_mem_wrôñ
,

140 
cs_mem_wrôñ
,

143 
	$cs_ßve
(
QEMUFûe
 *
f
, *
›aque
)

145 
CSSèã
 *
s
 = 
›aque
;

146 
i
;

148 
i
 = 0; i < 
CS_REGS
; i++)

149 
	`qemu_put_be32s
(
f
, &
s
->
ªgs
[
i
]);

151 
	`qemu_put_buf„r
(
f
, 
s
->
dªgs
, 
CS_DREGS
);

152 
	}
}

154 
	$cs_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

156 
CSSèã
 *
s
 = 
›aque
;

157 
i
;

159 i‡(
vîsi⁄_id
 > 1)

160  -
EINVAL
;

162 
i
 = 0; i < 
CS_REGS
; i++)

163 
	`qemu_gë_be32s
(
f
, &
s
->
ªgs
[
i
]);

165 
	`qemu_gë_buf„r
(
f
, 
s
->
dªgs
, 
CS_DREGS
);

167 
	}
}

169 
	$cs_öô
(
èrgë_phys_addr_t
 
ba£
, 
úq
, *
öt˘l
)

171 
cs_io_mem‹y
;

172 
CSSèã
 *
s
;

174 
s
 = 
	`qemu_mÆlocz
((
CSSèã
));

175 i‡(!
s
)

178 
cs_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
cs_mem_ªad
, 
cs_mem_wrôe
, 
s
);

179 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 
CS_MAXADDR
, 
cs_io_mem‹y
);

180 
	`ªgi°î_ßvevm
("cs4231", 
ba£
, 1, 
cs_ßve
, 
cs_lﬂd
, 
s
);

181 
	`qemu_ªgi°î_ª£t
(
cs_ª£t
, 
s
);

182 
	`cs_ª£t
(
s
);

183 
	}
}

	@cuda.c

24 
	~"vl.h
"

32 
	#TREQ
 0x08

	)

33 
	#TACK
 0x10

	)

34 
	#TIP
 0x20

	)

37 
	#SR_CTRL
 0x1¯

	)

38 
	#SR_EXT
 0x0¯

	)

39 
	#SR_OUT
 0x10

	)

42 
	#IER_SET
 0x80

	)

43 
	#IER_CLR
 0

	)

44 
	#SR_INT
 0x04

	)

45 
	#T1_INT
 0x40

	)

46 
	#T2_INT
 0x20

	)

49 
	#T1MODE
 0xc0

	)

50 
	#T1MODE_CONT
 0x40

	)

53 
	#ADB_PACKET
 0

	)

54 
	#CUDA_PACKET
 1

	)

55 
	#ERROR_PACKET
 2

	)

56 
	#TIMER_PACKET
 3

	)

57 
	#POWER_PACKET
 4

	)

58 
	#MACIIC_PACKET
 5

	)

59 
	#PMU_PACKET
 6

	)

63 
	#CUDA_WARM_START
 0x0

	)

64 
	#CUDA_AUTOPOLL
 0x1

	)

65 
	#CUDA_GET_6805_ADDR
 0x2

	)

66 
	#CUDA_GET_TIME
 0x3

	)

67 
	#CUDA_GET_PRAM
 0x7

	)

68 
	#CUDA_SET_6805_ADDR
 0x8

	)

69 
	#CUDA_SET_TIME
 0x9

	)

70 
	#CUDA_POWERDOWN
 0xa

	)

71 
	#CUDA_POWERUP_TIME
 0xb

	)

72 
	#CUDA_SET_PRAM
 0xc

	)

73 
	#CUDA_MS_RESET
 0xd

	)

74 
	#CUDA_SEND_DFAC
 0xe

	)

75 
	#CUDA_BATTERY_SWAP_SENSE
 0x10

	)

76 
	#CUDA_RESET_SYSTEM
 0x11

	)

77 
	#CUDA_SET_IPL
 0x12

	)

78 
	#CUDA_FILE_SERVER_FLAG
 0x13

	)

79 
	#CUDA_SET_AUTO_RATE
 0x14

	)

80 
	#CUDA_GET_AUTO_RATE
 0x16

	)

81 
	#CUDA_SET_DEVICE_LIST
 0x19

	)

82 
	#CUDA_GET_DEVICE_LIST
 0x1a

	)

83 
	#CUDA_SET_ONE_SECOND_MODE
 0x1b

	)

84 
	#CUDA_SET_POWER_MESSAGES
 0x21

	)

85 
	#CUDA_GET_SET_IIC
 0x22

	)

86 
	#CUDA_WAKEUP
 0x23

	)

87 
	#CUDA_TIMER_TICKLE
 0x24

	)

88 
	#CUDA_COMBINED_FORMAT_IIC
 0x25

	)

90 
	#CUDA_TIMER_FREQ
 (4700000 / 6)

	)

91 
	#CUDA_ADB_POLL_FREQ
 50

	)

94 
	#RTC_OFFSET
 2082844800

	)

96 
	sCUDATimî
 {

97 
	mödex
;

98 
uöt16_t
 
	mœtch
;

99 
uöt16_t
 
	mcou¡î_vÆue
;

100 
öt64_t
 
	mlﬂd_time
;

101 
öt64_t
 
	m√xt_úq_time
;

102 
QEMUTimî
 *
	mtimî
;

103 } 
	tCUDATimî
;

105 
	sCUDASèã
 {

107 
uöt8_t
 
	mb
;

108 
uöt8_t
 
	ma
;

109 
uöt8_t
 
	mdúb
;

110 
uöt8_t
 
	mdúa
;

111 
uöt8_t
 
	m§
;

112 
uöt8_t
 
	ma¸
;

113 
uöt8_t
 
	mp¸
;

114 
uöt8_t
 
	mi‰
;

115 
uöt8_t
 
	mõr
;

116 
uöt8_t
 
	m™h
;

118 
CUDATimî
 
	mtimîs
[2];

120 
uöt8_t
 
	mœ°_b
;

121 
uöt8_t
 
	mœ°_a¸
;

123 
	md©a_ö_size
;

124 
	md©a_ö_ödex
;

125 
	md©a_out_ödex
;

127 
SëIRQFunc
 *
	m£t_úq
;

128 
	múq
;

129 *
	múq_›aque
;

130 
uöt8_t
 
	maut›ﬁl
;

131 
uöt8_t
 
	md©a_ö
[128];

132 
uöt8_t
 
	md©a_out
[16];

133 
QEMUTimî
 *
	madb_pﬁl_timî
;

134 } 
	tCUDASèã
;

136 
CUDASèã
 
	gcuda_°©e
;

137 
ADBBusSèã
 
	gadb_bus
;

139 
cuda_upd©e
(
CUDASèã
 *
s
);

140 
cuda_ª˚ive_∑ckë_‰om_ho°
(
CUDASèã
 *
s
,

141 c⁄° 
uöt8_t
 *
d©a
, 
Àn
);

142 
cuda_timî_upd©e
(
CUDASèã
 *
s
, 
CUDATimî
 *
ti
,

143 
öt64_t
 
cuºít_time
);

145 
	$cuda_upd©e_úq
(
CUDASèã
 *
s
)

147 i‡(
s
->
i‰
 & s->
õr
 & (
SR_INT
 | 
T1_INT
)) {

148 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 1);

150 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 0);

152 
	}
}

154 
	$gë_cou¡î
(
CUDATimî
 *
s
)

156 
öt64_t
 
d
;

157 
cou¡î
;

159 
d
 = 
	`muldiv64
(
	`qemu_gë_˛ock
(
vm_˛ock
Ë- 
s
->
lﬂd_time
,

160 
CUDA_TIMER_FREQ
, 
ticks_≥r_£c
);

161 i‡(
s
->
ödex
 == 0) {

163 i‡(
d
 <(
s
->
cou¡î_vÆue
 + 1)) {

164 
cou¡î
 = (
s
->
cou¡î_vÆue
 - 
d
) & 0xffff;

166 
cou¡î
 = (
d
 - (
s
->
cou¡î_vÆue
 + 1)Ë% (s->
œtch
 + 2);

167 
cou¡î
 = (
s
->
œtch
 - counter) & 0xffff;

170 
cou¡î
 = (
s
->
cou¡î_vÆue
 - 
d
) & 0xffff;

172  
cou¡î
;

173 
	}
}

175 
	$£t_cou¡î
(
CUDASèã
 *
s
, 
CUDATimî
 *
ti
, 
vÆ
)

177 #ifde‡
DEBUG_CUDA


178 
	`¥ötf
("cuda: T%d.counter=%d\n",

179 1 + (
ti
->
timî
 =
NULL
), 
vÆ
);

181 
ti
->
lﬂd_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

182 
ti
->
cou¡î_vÆue
 = 
vÆ
;

183 
	`cuda_timî_upd©e
(
s
, 
ti
,Åi->
lﬂd_time
);

184 
	}
}

186 
öt64_t
 
	$gë_√xt_úq_time
(
CUDATimî
 *
s
, 
öt64_t
 
cuºít_time
)

188 
öt64_t
 
d
, 
√xt_time
;

189 
cou¡î
;

192 
d
 = 
	`muldiv64
(
cuºít_time
 - 
s
->
lﬂd_time
,

193 
CUDA_TIMER_FREQ
, 
ticks_≥r_£c
);

195 i‡(
d
 <(
s
->
cou¡î_vÆue
 + 1)) {

196 
cou¡î
 = (
s
->
cou¡î_vÆue
 - 
d
) & 0xffff;

198 
cou¡î
 = (
d
 - (
s
->
cou¡î_vÆue
 + 1)Ë% (s->
œtch
 + 2);

199 
cou¡î
 = (
s
->
œtch
 - counter) & 0xffff;

203 i‡(
cou¡î
 == 0xffff) {

204 
√xt_time
 = 
d
 + 
s
->
œtch
 + 1;

205 } i‡(
cou¡î
 == 0) {

206 
√xt_time
 = 
d
 + 
s
->
œtch
 + 2;

208 
√xt_time
 = 
d
 + 
cou¡î
;

211 #ifde‡
DEBUG_CUDA


212 
	`¥ötf
("œtch=%d cou¡î=%" 
PRId64
 " delta_next=%" PRId64 "\n",

213 
s
->
œtch
, 
d
, 
√xt_time
 - d);

216 
√xt_time
 = 
	`muldiv64
“ext_time, 
ticks_≥r_£c
, 
CUDA_TIMER_FREQ
) +

217 
s
->
lﬂd_time
;

218 i‡(
√xt_time
 <
cuºít_time
)

219 
√xt_time
 = 
cuºít_time
 + 1;

220  
√xt_time
;

221 
	}
}

223 
	$cuda_timî_upd©e
(
CUDASèã
 *
s
, 
CUDATimî
 *
ti
,

224 
öt64_t
 
cuºít_time
)

226 i‡(!
ti
->
timî
)

228 i‡((
s
->
a¸
 & 
T1MODE
Ë!
T1MODE_CONT
) {

229 
	`qemu_dñ_timî
(
ti
->
timî
);

231 
ti
->
√xt_úq_time
 = 
	`gë_√xt_úq_time
—i, 
cuºít_time
);

232 
	`qemu_mod_timî
(
ti
->
timî
,Åi->
√xt_úq_time
);

234 
	}
}

236 
	$cuda_timî1
(*
›aque
)

238 
CUDASèã
 *
s
 = 
›aque
;

239 
CUDATimî
 *
ti
 = &
s
->
timîs
[0];

241 
	`cuda_timî_upd©e
(
s
, 
ti
,Åi->
√xt_úq_time
);

242 
s
->
i‰
 |
T1_INT
;

243 
	`cuda_upd©e_úq
(
s
);

244 
	}
}

246 
uöt32_t
 
	$cuda_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

248 
CUDASèã
 *
s
 = 
›aque
;

249 
uöt32_t
 
vÆ
;

251 
addr
 = (addr >> 9) & 0xf;

252 
addr
) {

254 
vÆ
 = 
s
->
b
;

257 
vÆ
 = 
s
->
a
;

260 
vÆ
 = 
s
->
dúb
;

263 
vÆ
 = 
s
->
dúa
;

266 
vÆ
 = 
	`gë_cou¡î
(&
s
->
timîs
[0]) & 0xff;

267 
s
->
i‰
 &~
T1_INT
;

268 
	`cuda_upd©e_úq
(
s
);

271 
vÆ
 = 
	`gë_cou¡î
(&
s
->
timîs
[0]) >> 8;

272 
	`cuda_upd©e_úq
(
s
);

275 
vÆ
 = 
s
->
timîs
[0].
œtch
 & 0xff;

279 
vÆ
 = (
s
->
timîs
[0].
œtch
 >> 8) & 0xff;

282 
vÆ
 = 
	`gë_cou¡î
(&
s
->
timîs
[1]) & 0xff;

283 
s
->
i‰
 &~
T2_INT
;

286 
vÆ
 = 
	`gë_cou¡î
(&
s
->
timîs
[1]) >> 8;

289 
vÆ
 = 
s
->
§
;

290 
s
->
i‰
 &~
SR_INT
;

291 
	`cuda_upd©e_úq
(
s
);

294 
vÆ
 = 
s
->
a¸
;

297 
vÆ
 = 
s
->
p¸
;

300 
vÆ
 = 
s
->
i‰
;

301 i‡(
s
->
i‰
 & s->
õr
)

302 
vÆ
 |= 0x80;

305 
vÆ
 = 
s
->
õr
 | 0x80;

309 
vÆ
 = 
s
->
™h
;

312 #ifde‡
DEBUG_CUDA


313 i‡(
addr
 !13 || 
vÆ
 != 0)

314 
	`¥ötf
("cuda:Ñód:Ñeg=0x%x vÆ=%02x\n", 
addr
, 
vÆ
);

316  
vÆ
;

317 
	}
}

319 
	$cuda_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

321 
CUDASèã
 *
s
 = 
›aque
;

323 
addr
 = (addr >> 9) & 0xf;

324 #ifde‡
DEBUG_CUDA


325 
	`¥ötf
("cuda: wrôe:Ñeg=0x%x vÆ=%02x\n", 
addr
, 
vÆ
);

328 
addr
) {

330 
s
->
b
 = 
vÆ
;

331 
	`cuda_upd©e
(
s
);

334 
s
->
a
 = 
vÆ
;

337 
s
->
dúb
 = 
vÆ
;

340 
s
->
dúa
 = 
vÆ
;

343 
s
->
timîs
[0].
œtch
 = (s->timîs[0].œtch & 0xff00Ë| 
vÆ
;

344 
	`cuda_timî_upd©e
(
s
, &s->
timîs
[0], 
	`qemu_gë_˛ock
(
vm_˛ock
));

347 
s
->
timîs
[0].
œtch
 = (s->timîs[0].œtch & 0xffË| (
vÆ
 << 8);

348 
s
->
i‰
 &~
T1_INT
;

349 
	`£t_cou¡î
(
s
, &s->
timîs
[0], s->timîs[0].
œtch
);

352 
s
->
timîs
[0].
œtch
 = (s->timîs[0].œtch & 0xff00Ë| 
vÆ
;

353 
	`cuda_timî_upd©e
(
s
, &s->
timîs
[0], 
	`qemu_gë_˛ock
(
vm_˛ock
));

356 
s
->
timîs
[0].
œtch
 = (s->timîs[0].œtch & 0xffË| (
vÆ
 << 8);

357 
s
->
i‰
 &~
T1_INT
;

358 
	`cuda_timî_upd©e
(
s
, &s->
timîs
[0], 
	`qemu_gë_˛ock
(
vm_˛ock
));

361 
s
->
timîs
[1].
œtch
 = 
vÆ
;

362 
	`£t_cou¡î
(
s
, &s->
timîs
[1], 
vÆ
);

365 
	`£t_cou¡î
(
s
, &s->
timîs
[1], (
vÆ
 << 8Ë| s->timîs[1].
œtch
);

368 
s
->
§
 = 
vÆ
;

371 
s
->
a¸
 = 
vÆ
;

372 
	`cuda_timî_upd©e
(
s
, &s->
timîs
[0], 
	`qemu_gë_˛ock
(
vm_˛ock
));

373 
	`cuda_upd©e
(
s
);

376 
s
->
p¸
 = 
vÆ
;

380 
s
->
i‰
 &~
vÆ
;

381 
	`cuda_upd©e_úq
(
s
);

384 i‡(
vÆ
 & 
IER_SET
) {

386 
s
->
õr
 |
vÆ
 & 0x7f;

389 
s
->
õr
 &~
vÆ
;

391 
	`cuda_upd©e_úq
(
s
);

395 
s
->
™h
 = 
vÆ
;

398 
	}
}

401 
	$cuda_upd©e
(
CUDASèã
 *
s
)

403 
∑ckë_ª˚ived
, 
Àn
;

405 
∑ckë_ª˚ived
 = 0;

406 i‡(!(
s
->
b
 & 
TIP
)) {

409 i‡(
s
->
a¸
 & 
SR_OUT
) {

411 i‡((
s
->
b
 & (
TACK
 | 
TIP
)Ë!(s->
œ°_b
 & (TACK | TIP))) {

412 i‡(
s
->
d©a_out_ödex
 < (s->
d©a_out
)) {

413 #ifde‡
DEBUG_CUDA


414 
	`¥ötf
("cuda: síd: %02x\n", 
s
->
§
);

416 
s
->
d©a_out
[s->
d©a_out_ödex
++] = s->
§
;

417 
s
->
i‰
 |
SR_INT
;

418 
	`cuda_upd©e_úq
(
s
);

422 i‡(
s
->
d©a_ö_ödex
 < s->
d©a_ö_size
) {

424 i‡((
s
->
b
 & (
TACK
 | 
TIP
)Ë!(s->
œ°_b
 & (TACK | TIP))) {

425 
s
->
§
 = s->
d©a_ö
[s->
d©a_ö_ödex
++];

426 #ifde‡
DEBUG_CUDA


427 
	`¥ötf
("cuda:Ñecv: %02x\n", 
s
->
§
);

430 i‡(
s
->
d©a_ö_ödex
 >s->
d©a_ö_size
) {

431 
s
->
b
 = (s->b | 
TREQ
);

433 
s
->
i‰
 |
SR_INT
;

434 
	`cuda_upd©e_úq
(
s
);

440 i‡((
s
->
œ°_b
 & 
TIP
Ë&& (s->
b
 & 
TACK
) != (s->last_b & TACK)) {

442 i‡(
s
->
b
 & 
TACK
)

443 
s
->
b
 = (s->b | 
TREQ
);

445 
s
->
b
 = (s->b & ~
TREQ
);

446 
s
->
i‰
 |
SR_INT
;

447 
	`cuda_upd©e_úq
(
s
);

449 i‡(!(
s
->
œ°_b
 & 
TIP
)) {

451 
∑ckë_ª˚ived
 = (
s
->
d©a_out_ödex
 > 0);

453 
s
->
i‰
 |
SR_INT
;

454 
	`cuda_upd©e_úq
(
s
);

457 i‡(
s
->
d©a_ö_ödex
 < s->
d©a_ö_size
) {

458 
s
->
b
 = (s->b & ~
TREQ
);

463 
s
->
œ°_a¸
 = s->
a¸
;

464 
s
->
œ°_b
 = s->
b
;

468 i‡(
∑ckë_ª˚ived
) {

469 
Àn
 = 
s
->
d©a_out_ödex
;

470 
s
->
d©a_out_ödex
 = 0;

471 
	`cuda_ª˚ive_∑ckë_‰om_ho°
(
s
, s->
d©a_out
, 
Àn
);

473 
	}
}

475 
	$cuda_£nd_∑ckë_to_ho°
(
CUDASèã
 *
s
,

476 c⁄° 
uöt8_t
 *
d©a
, 
Àn
)

478 #ifde‡
DEBUG_CUDA_PACKET


480 
i
;

481 
	`¥ötf
("cuda_send_packet_to_host:\n");

482 
i
 = 0; i < 
Àn
; i++)

483 
	`¥ötf
(" %02x", 
d©a
[
i
]);

484 
	`¥ötf
("\n");

487 
	`mem˝y
(
s
->
d©a_ö
, 
d©a
, 
Àn
);

488 
s
->
d©a_ö_size
 = 
Àn
;

489 
s
->
d©a_ö_ödex
 = 0;

490 
	`cuda_upd©e
(
s
);

491 
s
->
i‰
 |
SR_INT
;

492 
	`cuda_upd©e_úq
(
s
);

493 
	}
}

495 
	$cuda_adb_pﬁl
(*
›aque
)

497 
CUDASèã
 *
s
 = 
›aque
;

498 
uöt8_t
 
obuf
[
ADB_MAX_OUT_LEN
 + 2];

499 
ﬁí
;

501 
ﬁí
 = 
	`adb_pﬁl
(&
adb_bus
, 
obuf
 + 2);

502 i‡(
ﬁí
 > 0) {

503 
obuf
[0] = 
ADB_PACKET
;

504 
obuf
[1] = 0x40;

505 
	`cuda_£nd_∑ckë_to_ho°
(
s
, 
obuf
, 
ﬁí
 + 2);

507 
	`qemu_mod_timî
(
s
->
adb_pﬁl_timî
,

508 
	`qemu_gë_˛ock
(
vm_˛ock
) +

509 (
ticks_≥r_£c
 / 
CUDA_ADB_POLL_FREQ
));

510 
	}
}

512 
	$cuda_ª˚ive_∑ckë
(
CUDASèã
 *
s
,

513 c⁄° 
uöt8_t
 *
d©a
, 
Àn
)

515 
uöt8_t
 
obuf
[16];

516 
ti
, 
aut›ﬁl
;

518 
d©a
[0]) {

519 
CUDA_AUTOPOLL
:

520 
aut›ﬁl
 = (
d©a
[1] != 0);

521 i‡(
aut›ﬁl
 !
s
->autopoll) {

522 
s
->
aut›ﬁl
 =áutopoll;

523 i‡(
aut›ﬁl
) {

524 
	`qemu_mod_timî
(
s
->
adb_pﬁl_timî
,

525 
	`qemu_gë_˛ock
(
vm_˛ock
) +

526 (
ticks_≥r_£c
 / 
CUDA_ADB_POLL_FREQ
));

528 
	`qemu_dñ_timî
(
s
->
adb_pﬁl_timî
);

531 
obuf
[0] = 
CUDA_PACKET
;

532 
obuf
[1] = 
d©a
[1];

533 
	`cuda_£nd_∑ckë_to_ho°
(
s
, 
obuf
, 2);

535 
CUDA_GET_TIME
:

536 
CUDA_SET_TIME
:

538 
ti
 = 
	`time
(
NULL
Ë+ 
RTC_OFFSET
;

539 
obuf
[0] = 
CUDA_PACKET
;

540 
obuf
[1] = 0;

541 
obuf
[2] = 0;

542 
obuf
[3] = 
ti
 >> 24;

543 
obuf
[4] = 
ti
 >> 16;

544 
obuf
[5] = 
ti
 >> 8;

545 
obuf
[6] = 
ti
;

546 
	`cuda_£nd_∑ckë_to_ho°
(
s
, 
obuf
, 7);

548 
CUDA_FILE_SERVER_FLAG
:

549 
CUDA_SET_DEVICE_LIST
:

550 
CUDA_SET_AUTO_RATE
:

551 
CUDA_SET_POWER_MESSAGES
:

552 
obuf
[0] = 
CUDA_PACKET
;

553 
obuf
[1] = 0;

554 
	`cuda_£nd_∑ckë_to_ho°
(
s
, 
obuf
, 2);

556 
CUDA_POWERDOWN
:

557 
obuf
[0] = 
CUDA_PACKET
;

558 
obuf
[1] = 0;

559 
	`cuda_£nd_∑ckë_to_ho°
(
s
, 
obuf
, 2);

560 
	`qemu_sy°em_shutdown_ªque°
();

565 
	}
}

567 
	$cuda_ª˚ive_∑ckë_‰om_ho°
(
CUDASèã
 *
s
,

568 c⁄° 
uöt8_t
 *
d©a
, 
Àn
)

570 #ifde‡
DEBUG_CUDA_PACKET


572 
i
;

573 
	`¥ötf
("cuda_receive_packet_from_host:\n");

574 
i
 = 0; i < 
Àn
; i++)

575 
	`¥ötf
(" %02x", 
d©a
[
i
]);

576 
	`¥ötf
("\n");

579 
d©a
[0]) {

580 
ADB_PACKET
:

582 
uöt8_t
 
obuf
[
ADB_MAX_OUT_LEN
 + 2];

583 
ﬁí
;

584 
ﬁí
 = 
	`adb_ªque°
(&
adb_bus
, 
obuf
 + 2, 
d©a
 + 1, 
Àn
 - 1);

585 i‡(
ﬁí
 > 0) {

586 
obuf
[0] = 
ADB_PACKET
;

587 
obuf
[1] = 0x00;

590 
obuf
[0] = 
ADB_PACKET
;

591 
obuf
[1] = -
ﬁí
;

592 
ﬁí
 = 0;

594 
	`cuda_£nd_∑ckë_to_ho°
(
s
, 
obuf
, 
ﬁí
 + 2);

597 
CUDA_PACKET
:

598 
	`cuda_ª˚ive_∑ckë
(
s
, 
d©a
 + 1, 
Àn
 - 1);

601 
	}
}

603 
	$cuda_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

605 
	}
}

607 
	$cuda_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

609 
	}
}

611 
uöt32_t
 
	$cuda_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

614 
	}
}

616 
uöt32_t
 
	$cuda_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

619 
	}
}

621 
CPUWrôeMem‹yFunc
 *
	gcuda_wrôe
[] = {

622 &
cuda_wrôeb
,

623 &
cuda_wrôew
,

624 &
cuda_wrôñ
,

627 
CPURódMem‹yFunc
 *
	gcuda_ªad
[] = {

628 &
cuda_ªadb
,

629 &
cuda_ªadw
,

630 &
cuda_ªadl
,

633 
	$cuda_öô
(
SëIRQFunc
 *
£t_úq
, *
úq_›aque
, 
úq
)

635 
CUDASèã
 *
s
 = &
cuda_°©e
;

636 
cuda_mem_ödex
;

638 
s
->
£t_úq
 = set_irq;

639 
s
->
úq_›aque
 = irq_opaque;

640 
s
->
úq
 = irq;

642 
s
->
timîs
[0].
ödex
 = 0;

643 
s
->
timîs
[0].
timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
cuda_timî1
, s);

644 
s
->
timîs
[0].
œtch
 = 0xffff;

645 
	`£t_cou¡î
(
s
, &s->
timîs
[0], 0xffff);

647 
s
->
timîs
[1].
ödex
 = 1;

648 
s
->
timîs
[1].
œtch
 = 0;

650 
s
->
õr
 = 0;

651 
	`£t_cou¡î
(
s
, &s->
timîs
[1], 0xffff);

653 
s
->
adb_pﬁl_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
cuda_adb_pﬁl
, s);

654 
cuda_mem_ödex
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
cuda_ªad
, 
cuda_wrôe
, 
s
);

655  
cuda_mem_ödex
;

656 
	}
}

	@dma.c

24 
	~"vl.h
"

28 
	#dﬁog
(...Ë
	`Ârötf
 (
°dîr
, "dma: " 
__VA_ARGS__
)

	)

29 #ifde‡
DEBUG_DMA


30 
	#lw¨n
(...Ë
	`Ârötf
 (
°dîr
, "dma: " 
__VA_ARGS__
)

	)

31 
	#löfo
(...Ë
	`Ârötf
 (
°dîr
, "dma: " 
__VA_ARGS__
)

	)

32 
	#ldebug
(...Ë
	`Ârötf
 (
°dîr
, "dma: " 
__VA_ARGS__
)

	)

34 
	#lw¨n
(...)

	)

35 
	#löfo
(...)

	)

36 
	#ldebug
(...)

	)

39 
	#LENOFA
(
a
Ë((Ë(◊)/◊[0])))

	)

41 
	sdma_ªgs
 {

42 
	mnow
[2];

43 
uöt16_t
 
	mba£
[2];

44 
uöt8_t
 
	mmode
;

45 
uöt8_t
 
	m∑ge
;

46 
uöt8_t
 
	m∑geh
;

47 
uöt8_t
 
	mdack
;

48 
uöt8_t
 
	me›
;

49 
DMA_å™s„r_h™dÀr
 
	må™s„r_h™dÀr
;

50 *
	m›aque
;

53 
	#ADDR
 0

	)

54 
	#COUNT
 1

	)

56 
	sdma_c⁄t
 {

57 
uöt8_t
 
	m°©us
;

58 
uöt8_t
 
	mcomm™d
;

59 
uöt8_t
 
	mmask
;

60 
uöt8_t
 
	mÊù_Ê›
;

61 
	mdshi·
;

62 
dma_ªgs
 
	mªgs
[4];

63 } 
	gdma_c⁄åﬁÀrs
[2];

66 
	mCMD_MEMORY_TO_MEMORY
 = 0x01,

67 
	mCMD_FIXED_ADDRESS
 = 0x02,

68 
	mCMD_BLOCK_CONTROLLER
 = 0x04,

69 
	mCMD_COMPRESSED_TIME
 = 0x08,

70 
	mCMD_CYCLIC_PRIORITY
 = 0x10,

71 
	mCMD_EXTENDED_WRITE
 = 0x20,

72 
	mCMD_LOW_DREQ
 = 0x40,

73 
	mCMD_LOW_DACK
 = 0x80,

74 
	mCMD_NOT_SUPPORTED
 = 
CMD_MEMORY_TO_MEMORY
 | 
CMD_FIXED_ADDRESS


75 | 
CMD_COMPRESSED_TIME
 | 
CMD_CYCLIC_PRIORITY
 | 
CMD_EXTENDED_WRITE


76 | 
CMD_LOW_DREQ
 | 
CMD_LOW_DACK


80 
	gch™√ls
[8] = {-1, 2, 3, 1, -1, -1, -1, 0};

82 
	$wrôe_∑ge
 (*
›aque
, 
uöt32_t
 
≈‹t
, uöt32_à
d©a
)

84 
dma_c⁄t
 *
d
 = 
›aque
;

85 
ich™
;

87 
ich™
 = 
ch™√ls
[
≈‹t
 & 7];

88 i‡(-1 =
ich™
) {

89 
	`dﬁog
 ("övÆid ch™√»%#x %#x\n", 
≈‹t
, 
d©a
);

92 
d
->
ªgs
[
ich™
].
∑ge
 = 
d©a
;

93 
	}
}

95 
	$wrôe_∑geh
 (*
›aque
, 
uöt32_t
 
≈‹t
, uöt32_à
d©a
)

97 
dma_c⁄t
 *
d
 = 
›aque
;

98 
ich™
;

100 
ich™
 = 
ch™√ls
[
≈‹t
 & 7];

101 i‡(-1 =
ich™
) {

102 
	`dﬁog
 ("övÆid ch™√»%#x %#x\n", 
≈‹t
, 
d©a
);

105 
d
->
ªgs
[
ich™
].
∑geh
 = 
d©a
;

106 
	}
}

108 
uöt32_t
 
	$ªad_∑ge
 (*
›aque
, 
uöt32_t
 
≈‹t
)

110 
dma_c⁄t
 *
d
 = 
›aque
;

111 
ich™
;

113 
ich™
 = 
ch™√ls
[
≈‹t
 & 7];

114 i‡(-1 =
ich™
) {

115 
	`dﬁog
 ("övÆid ch™√»ªad %#x\n", 
≈‹t
);

118  
d
->
ªgs
[
ich™
].
∑ge
;

119 
	}
}

121 
uöt32_t
 
	$ªad_∑geh
 (*
›aque
, 
uöt32_t
 
≈‹t
)

123 
dma_c⁄t
 *
d
 = 
›aque
;

124 
ich™
;

126 
ich™
 = 
ch™√ls
[
≈‹t
 & 7];

127 i‡(-1 =
ich™
) {

128 
	`dﬁog
 ("övÆid ch™√»ªad %#x\n", 
≈‹t
);

131  
d
->
ªgs
[
ich™
].
∑geh
;

132 
	}
}

134 
ölöe
 
	$öô_ch™
 (
dma_c⁄t
 *
d
, 
ich™
)

136 
dma_ªgs
 *
r
;

138 
r
 = 
d
->
ªgs
 + 
ich™
;

139 
r
->
now
[
ADDR
] =Ñ->
ba£
[ADDR] << 
d
->
dshi·
;

140 
r
->
now
[
COUNT
] = 0;

141 
	}
}

143 
ölöe
 
	$gëff
 (
dma_c⁄t
 *
d
)

145 
ff
;

147 
ff
 = 
d
->
Êù_Ê›
;

148 
d
->
Êù_Ê›
 = !
ff
;

149  
ff
;

150 
	}
}

152 
uöt32_t
 
	$ªad_ch™
 (*
›aque
, 
uöt32_t
 
≈‹t
)

154 
dma_c⁄t
 *
d
 = 
›aque
;

155 
ich™
, 
ƒeg
, 
ù‹t
, 
ff
, 
vÆ
, 
dú
;

156 
dma_ªgs
 *
r
;

158 
ù‹t
 = (
≈‹t
 >> 
d
->
dshi·
) & 0x0f;

159 
ich™
 = 
ù‹t
 >> 1;

160 
ƒeg
 = 
ù‹t
 & 1;

161 
r
 = 
d
->
ªgs
 + 
ich™
;

163 
dú
 = ((
r
->
mode
 >> 5) & 1) ? -1 : 1;

164 
ff
 = 
	`gëff
 (
d
);

165 i‡(
ƒeg
)

166 
vÆ
 = (
r
->
ba£
[
COUNT
] << 
d
->
dshi·
Ë-Ñ->
now
[COUNT];

168 
vÆ
 = 
r
->
now
[
ADDR
] +Ñ->now[
COUNT
] * 
dú
;

170 
	`ldebug
 ("ªad_ch™ %#x -> %d\n", 
ù‹t
, 
vÆ
);

171  (
vÆ
 >> (
d
->
dshi·
 + (
ff
 << 3))) & 0xff;

172 
	}
}

174 
	$wrôe_ch™
 (*
›aque
, 
uöt32_t
 
≈‹t
, uöt32_à
d©a
)

176 
dma_c⁄t
 *
d
 = 
›aque
;

177 
ù‹t
, 
ich™
, 
ƒeg
;

178 
dma_ªgs
 *
r
;

180 
ù‹t
 = (
≈‹t
 >> 
d
->
dshi·
) & 0x0f;

181 
ich™
 = 
ù‹t
 >> 1;

182 
ƒeg
 = 
ù‹t
 & 1;

183 
r
 = 
d
->
ªgs
 + 
ich™
;

184 i‡(
	`gëff
 (
d
)) {

185 
r
->
ba£
[
ƒeg
] = (r->ba£[ƒeg] & 0xffË| ((
d©a
 << 8) & 0xff00);

186 
	`öô_ch™
 (
d
, 
ich™
);

188 
r
->
ba£
[
ƒeg
] = (r->ba£[ƒeg] & 0xff00Ë| (
d©a
 & 0xff);

190 
	}
}

192 
	$wrôe_c⁄t
 (*
›aque
, 
uöt32_t
 
≈‹t
, uöt32_à
d©a
)

194 
dma_c⁄t
 *
d
 = 
›aque
;

195 
ù‹t
, 
ich™
 = 0;

197 
ù‹t
 = (
≈‹t
 >> 
d
->
dshi·
) & 0x0f;

198 
ù‹t
) {

200 i‡((
d©a
 !0Ë&& (d©®& 
CMD_NOT_SUPPORTED
)) {

201 
	`dﬁog
 ("comm™d %#xÇŸ suµ‹ãd\n", 
d©a
);

204 
d
->
comm™d
 = 
d©a
;

208 
ich™
 = 
d©a
 & 3;

209 i‡(
d©a
 & 4) {

210 
d
->
°©us
 |1 << (
ich™
 + 4);

213 
d
->
°©us
 &~(1 << (
ich™
 + 4));

215 
d
->
°©us
 &~(1 << 
ich™
);

219 i‡(
d©a
 & 4)

220 
d
->
mask
 |1 << (
d©a
 & 3);

222 
d
->
mask
 &~(1 << (
d©a
 & 3));

227 
ich™
 = 
d©a
 & 3;

228 #ifde‡
DEBUG_DMA


230 
›
, 
ai
, 
dú
, 
›mode
;

231 
›
 = (
d©a
 >> 2) & 3;

232 
ai
 = (
d©a
 >> 4) & 1;

233 
dú
 = (
d©a
 >> 5) & 1;

234 
›mode
 = (
d©a
 >> 6) & 3;

236 
	`löfo
 ("ichan %d, op %d,ái %d, dir %d, opmode %d\n",

237 
ich™
, 
›
, 
ai
, 
dú
, 
›mode
);

240 
d
->
ªgs
[
ich™
].
mode
 = 
d©a
;

245 
d
->
Êù_Ê›
 = 0;

249 
d
->
Êù_Ê›
 = 0;

250 
d
->
mask
 = ~0;

251 
d
->
°©us
 = 0;

252 
d
->
comm™d
 = 0;

256 
d
->
mask
 = 0;

260 
d
->
mask
 = 
d©a
;

264 
	`dﬁog
 ("unknow¿ù‹à%#x\n", 
ù‹t
);

268 #ifde‡
DEBUG_DMA


269 i‡(0x¯!
ù‹t
) {

270 
	`löfo
 ("write_cont:Çport %#06x, ichan % 2d, val %#06x\n",

271 
≈‹t
, 
ich™
, 
d©a
);

274 
	}
}

276 
uöt32_t
 
	$ªad_c⁄t
 (*
›aque
, 
uöt32_t
 
≈‹t
)

278 
dma_c⁄t
 *
d
 = 
›aque
;

279 
ù‹t
, 
vÆ
;

281 
ù‹t
 = (
≈‹t
 >> 
d
->
dshi·
) & 0x0f;

282 
ù‹t
) {

284 
vÆ
 = 
d
->
°©us
;

285 
d
->
°©us
 &= 0xf0;

288 
vÆ
 = 
d
->
mask
;

291 
vÆ
 = 0;

295 
	`ldebug
 ("ªad_c⁄t:Çp‹à%#06x, ip‹à%#04x vÆ %#x\n", 
≈‹t
, 
ù‹t
, 
vÆ
);

296  
vÆ
;

297 
	}
}

299 
	$DMA_gë_ch™√l_mode
 (
nch™
)

301  
dma_c⁄åﬁÀrs
[
nch™
 > 3].
ªgs
[nch™ & 3].
mode
;

302 
	}
}

304 
	$DMA_hﬁd_DREQ
 (
nch™
)

306 
nc⁄t
, 
ich™
;

308 
nc⁄t
 = 
nch™
 > 3;

309 
ich™
 = 
nch™
 & 3;

310 
	`löfo
 ("hñd c⁄t=%d ch™=%d\n", 
nc⁄t
, 
ich™
);

311 
dma_c⁄åﬁÀrs
[
nc⁄t
].
°©us
 |1 << (
ich™
 + 4);

312 
	}
}

314 
	$DMA_ªÀa£_DREQ
 (
nch™
)

316 
nc⁄t
, 
ich™
;

318 
nc⁄t
 = 
nch™
 > 3;

319 
ich™
 = 
nch™
 & 3;

320 
	`löfo
 ("ªÀa£d c⁄t=%d ch™=%d\n", 
nc⁄t
, 
ich™
);

321 
dma_c⁄åﬁÀrs
[
nc⁄t
].
°©us
 &~(1 << (
ich™
 + 4));

322 
	}
}

324 
	$ch™√l_run
 (
nc⁄t
, 
ich™
)

326 
n
;

327 
dma_ªgs
 *
r
 = &
dma_c⁄åﬁÀrs
[
nc⁄t
].
ªgs
[
ich™
];

328 #ifde‡
DEBUG_DMA


329 
dú
, 
›mode
;

331 
dú
 = (
r
->
mode
 >> 5) & 1;

332 
›mode
 = (
r
->
mode
 >> 6) & 3;

334 i‡(
dú
) {

335 
	`dﬁog
 ("DMA ináddress decrement mode\n");

337 i‡(
›mode
 != 1) {

338 
	`dﬁog
 ("DMAÇŸ i¿sögÀ modê£À˘ %#x\n", 
›mode
);

342 
r
 = 
dma_c⁄åﬁÀrs
[
nc⁄t
].
ªgs
 + 
ich™
;

343 i‡(
r
->
å™s„r_h™dÀr
 =
NULL
)

345 
n
 = 
r
->
	`å™s„r_h™dÀr
 (r->
›aque
, 
ich™
 + (
nc⁄t
 << 2),

346 
r
->
now
[
COUNT
], (r->
ba£
[COUNT] + 1Ë<< 
nc⁄t
);

347 
r
->
now
[
COUNT
] = 
n
;

348 
	`ldebug
 ("dma_po†%d sizê%d\n", 
n
, (
r
->
ba£
[
COUNT
] + 1Ë<< 
nc⁄t
);

349 
	}
}

351 
	$DMA_run
 ()

353 
dma_c⁄t
 *
d
;

354 
ic⁄t
, 
ich™
;

356 
d
 = 
dma_c⁄åﬁÀrs
;

358 
ic⁄t
 = 0; ic⁄à< 2; ic⁄t++, 
d
++) {

359 
ich™
 = 0; ichan < 4; ichan++) {

360 
mask
;

362 
mask
 = 1 << 
ich™
;

364 i‡((0 =(
d
->
mask
 & mask)Ë&& (0 !(d->
°©us
 & (mask << 4))))

365 
	`ch™√l_run
 (
ic⁄t
, 
ich™
);

368 
	}
}

370 
	$DMA_ªgi°î_ch™√l
 (
nch™
,

371 
DMA_å™s„r_h™dÀr
 
å™s„r_h™dÀr
,

372 *
›aque
)

374 
dma_ªgs
 *
r
;

375 
ich™
, 
nc⁄t
;

377 
nc⁄t
 = 
nch™
 > 3;

378 
ich™
 = 
nch™
 & 3;

380 
r
 = 
dma_c⁄åﬁÀrs
[
nc⁄t
].
ªgs
 + 
ich™
;

381 
r
->
å™s„r_h™dÀr
 =Åransfer_handler;

382 
r
->
›aque
 = opaque;

383 
	}
}

385 
	$DMA_ªad_mem‹y
 (
nch™
, *
buf
, 
pos
, 
Àn
)

387 
dma_ªgs
 *
r
 = &
dma_c⁄åﬁÀrs
[
nch™
 > 3].
ªgs
[nchan & 3];

388 
èrgë_ul⁄g
 
addr
 = ((
r
->
∑geh
 & 0x7fË<< 24Ë| (r->
∑ge
 << 16Ë|Ñ->
now
[
ADDR
];

390 i‡(
r
->
mode
 & 0x20) {

391 
i
;

392 
uöt8_t
 *
p
 = 
buf
;

394 
	`˝u_physiˇl_mem‹y_ªad
 (
addr
 - 
pos
 - 
Àn
, 
buf
,Üen);

396 
i
 = 0; i < 
Àn
 >> 1; i++) {

397 
uöt8_t
 
b
 = 
p
[
Àn
 - 
i
 - 1];

398 
p
[
i
] = 
b
;

402 
	`˝u_physiˇl_mem‹y_ªad
 (
addr
 + 
pos
, 
buf
, 
Àn
);

404  
Àn
;

405 
	}
}

407 
	$DMA_wrôe_mem‹y
 (
nch™
, *
buf
, 
pos
, 
Àn
)

409 
dma_ªgs
 *
r
 = &
dma_c⁄åﬁÀrs
[
nch™
 > 3].
ªgs
[nchan & 3];

410 
èrgë_ul⁄g
 
addr
 = ((
r
->
∑geh
 & 0x7fË<< 24Ë| (r->
∑ge
 << 16Ë|Ñ->
now
[
ADDR
];

412 i‡(
r
->
mode
 & 0x20) {

413 
i
;

414 
uöt8_t
 *
p
 = 
buf
;

416 
	`˝u_physiˇl_mem‹y_wrôe
 (
addr
 - 
pos
 - 
Àn
, 
buf
,Üen);

418 
i
 = 0; i < 
Àn
; i++) {

419 
uöt8_t
 
b
 = 
p
[
Àn
 - 
i
 - 1];

420 
p
[
i
] = 
b
;

424 
	`˝u_physiˇl_mem‹y_wrôe
 (
addr
 + 
pos
, 
buf
, 
Àn
);

426  
Àn
;

427 
	}
}

430 
	$DMA_scheduÀ
(
nch™
)

432 
CPUSèã
 *
ív
 = 
˝u_sögÀ_ív
;

433 i‡(
ív
)

434 
	`˝u_öãºu±
(
ív
, 
CPU_INTERRUPT_EXIT
);

435 
	}
}

437 
	$dma_ª£t
(*
›aque
)

439 
dma_c⁄t
 *
d
 = 
›aque
;

440 
	`wrôe_c⁄t
 (
d
, (0x0d << d->
dshi·
), 0);

441 
	}
}

444 
	$dma_öô2
(
dma_c⁄t
 *
d
, 
ba£
, 
dshi·
,

445 
∑ge_ba£
, 
∑geh_ba£
)

447 c⁄° 
∑ge_p‹t_li°
[] = { 0x1, 0x2, 0x3, 0x7 };

448 
i
;

450 
d
->
dshi·
 = dshift;

451 
i
 = 0; i < 8; i++) {

452 
	`ªgi°î_i›‹t_wrôe
 (
ba£
 + (
i
 << 
dshi·
), 1, 1, 
wrôe_ch™
, 
d
);

453 
	`ªgi°î_i›‹t_ªad
 (
ba£
 + (
i
 << 
dshi·
), 1, 1, 
ªad_ch™
, 
d
);

455 
i
 = 0; i < 
	`LENOFA
 (
∑ge_p‹t_li°
); i++) {

456 
	`ªgi°î_i›‹t_wrôe
 (
∑ge_ba£
 + 
∑ge_p‹t_li°
[
i
], 1, 1,

457 
wrôe_∑ge
, 
d
);

458 
	`ªgi°î_i›‹t_ªad
 (
∑ge_ba£
 + 
∑ge_p‹t_li°
[
i
], 1, 1,

459 
ªad_∑ge
, 
d
);

460 i‡(
∑geh_ba£
 >= 0) {

461 
	`ªgi°î_i›‹t_wrôe
 (
∑geh_ba£
 + 
∑ge_p‹t_li°
[
i
], 1, 1,

462 
wrôe_∑geh
, 
d
);

463 
	`ªgi°î_i›‹t_ªad
 (
∑geh_ba£
 + 
∑ge_p‹t_li°
[
i
], 1, 1,

464 
ªad_∑geh
, 
d
);

467 
i
 = 0; i < 8; i++) {

468 
	`ªgi°î_i›‹t_wrôe
 (
ba£
 + ((
i
 + 8Ë<< 
dshi·
), 1, 1,

469 
wrôe_c⁄t
, 
d
);

470 
	`ªgi°î_i›‹t_ªad
 (
ba£
 + ((
i
 + 8Ë<< 
dshi·
), 1, 1,

471 
ªad_c⁄t
, 
d
);

473 
	`qemu_ªgi°î_ª£t
(
dma_ª£t
, 
d
);

474 
	`dma_ª£t
(
d
);

475 
	}
}

477 
	$dma_ßve
 (
QEMUFûe
 *
f
, *
›aque
)

479 
dma_c⁄t
 *
d
 = 
›aque
;

480 
i
;

483 
	`qemu_put_8s
 (
f
, &
d
->
comm™d
);

484 
	`qemu_put_8s
 (
f
, &
d
->
mask
);

485 
	`qemu_put_8s
 (
f
, &
d
->
Êù_Ê›
);

486 
	`qemu_put_be32s
 (
f
, &
d
->
dshi·
);

488 
i
 = 0; i < 4; ++i) {

489 
dma_ªgs
 *
r
 = &
d
->
ªgs
[
i
];

490 
	`qemu_put_be32s
 (
f
, &
r
->
now
[0]);

491 
	`qemu_put_be32s
 (
f
, &
r
->
now
[1]);

492 
	`qemu_put_be16s
 (
f
, &
r
->
ba£
[0]);

493 
	`qemu_put_be16s
 (
f
, &
r
->
ba£
[1]);

494 
	`qemu_put_8s
 (
f
, &
r
->
mode
);

495 
	`qemu_put_8s
 (
f
, &
r
->
∑ge
);

496 
	`qemu_put_8s
 (
f
, &
r
->
∑geh
);

497 
	`qemu_put_8s
 (
f
, &
r
->
dack
);

498 
	`qemu_put_8s
 (
f
, &
r
->
e›
);

500 
	}
}

502 
	$dma_lﬂd
 (
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

504 
dma_c⁄t
 *
d
 = 
›aque
;

505 
i
;

507 i‡(
vîsi⁄_id
 != 1)

508  -
EINVAL
;

511 
	`qemu_gë_8s
 (
f
, &
d
->
comm™d
);

512 
	`qemu_gë_8s
 (
f
, &
d
->
mask
);

513 
	`qemu_gë_8s
 (
f
, &
d
->
Êù_Ê›
);

514 
	`qemu_gë_be32s
 (
f
, &
d
->
dshi·
);

516 
i
 = 0; i < 4; ++i) {

517 
dma_ªgs
 *
r
 = &
d
->
ªgs
[
i
];

518 
	`qemu_gë_be32s
 (
f
, &
r
->
now
[0]);

519 
	`qemu_gë_be32s
 (
f
, &
r
->
now
[1]);

520 
	`qemu_gë_be16s
 (
f
, &
r
->
ba£
[0]);

521 
	`qemu_gë_be16s
 (
f
, &
r
->
ba£
[1]);

522 
	`qemu_gë_8s
 (
f
, &
r
->
mode
);

523 
	`qemu_gë_8s
 (
f
, &
r
->
∑ge
);

524 
	`qemu_gë_8s
 (
f
, &
r
->
∑geh
);

525 
	`qemu_gë_8s
 (
f
, &
r
->
dack
);

526 
	`qemu_gë_8s
 (
f
, &
r
->
e›
);

529 
	}
}

531 
	$DMA_öô
 (
high_∑ge_íabÀ
)

533 
	`dma_öô2
(&
dma_c⁄åﬁÀrs
[0], 0x00, 0, 0x80,

534 
high_∑ge_íabÀ
 ? 0x480 : -1);

535 
	`dma_öô2
(&
dma_c⁄åﬁÀrs
[1], 0xc0, 1, 0x88,

536 
high_∑ge_íabÀ
 ? 0x488 : -1);

537 
	`ªgi°î_ßvevm
 ("dma", 0, 1, 
dma_ßve
, 
dma_lﬂd
, &
dma_c⁄åﬁÀrs
[0]);

538 
	`ªgi°î_ßvevm
 ("dma", 1, 1, 
dma_ßve
, 
dma_lﬂd
, &
dma_c⁄åﬁÀrs
[1]);

539 
	}
}

	@e100.c

36 
	~<as£π.h
>

37 
	~"vl.h
"

41 
	mE100_PCI_VENDOR_ID
 = 0x00,

42 
	mE100_PCI_DEVICE_ID
 = 0x02,

43 
	mE100_PCI_COMMAND
 = 0x04,

44 
	mE100_PCI_STATUS
 = 0x06,

45 
	mE100_PCI_REVISION_ID
 = 0x08,

46 
	mE100_PCI_CLASS_CODE
 = 0x0b,

47 
	mE100_PCI_SUBCLASS_CODE
 = 0x0a,

48 
	mE100_PCI_HEADER_TYPE
 = 0x0e,

49 
	mE100_PCI_BASE_ADDRESS_0
 = 0x10,

50 
	mE100_PCI_BASE_ADDRESS_1
 = 0x14,

51 
	mE100_PCI_BASE_ADDRESS_2
 = 0x18,

52 
	mE100_PCI_BASE_ADDRESS_3
 = 0x1c,

53 
	mE100_PCI_BASE_ADDRESS_4
 = 0x20,

54 
	mE100_PCI_BASE_ADDRESS_5
 = 0x24

55 }
	gPCI_CONFIGURE_SPACE
;

57 
	#PCI_CONFIG_8
(
off£t
, 
vÆue
) \

58 (*(
uöt8_t
 *)&
pci_c⁄f
[
off£t
] = (
vÆue
))

	)

59 
	#PCI_CONFIG_16
(
off£t
, 
vÆue
) \

60 (*(
uöt16_t
 *)&
pci_c⁄f
[
off£t
] = 
	`˝u_to_À16
(
vÆue
))

	)

61 
	#PCI_CONFIG_32
(
off£t
, 
vÆue
) \

62 (*(
uöt32_t
 *)&
pci_c⁄f
[
off£t
] = 
	`˝u_to_À32
(
vÆue
))

	)

65 
	#CSR_STATUS
 
scb_°©us


	)

66 
	#CSR_CMD
 
scb_cmd


	)

67 
	#CSR_POINTER
 
scb_poöãr


	)

68 
	#CSR_PORT
 
p‹t


	)

69 
	#CSR_EEPROM
 
ì¥om_˘æ


	)

70 
	#CSR_MDI
 
mdi_˘æ


	)

71 
	#CSR_PM
 
pm_ªg


	)

73 
	#CSR
(
˛ass
, 
fõld
) \

74 (
s
->
pci_mem
.
c§
.
˛ass
.
u
.
fõld
)

	)

75 
	#CSR_VAL
(
˛ass
) \

76 (
s
->
pci_mem
.
c§
.
˛ass
.
vÆ
)

	)

78 
	#CSR_READ
(
x
, 
ty≥
) \

80 
ty≥
 
t
; \

81 
	`mem˝y
(&
t
, &
s
->
pci_mem
.
mem
[
x
], (
ty≥
)); \

82 
t
; \

83 })

	)

85 
	#CSR_WRITE
(
x
, 
vÆ
, 
ty≥
) \

87 
ty≥
 
t
 = 
vÆ
; \

88 
	`mem˝y
(&
s
->
pci_mem
.
mem
[
x
], &
t
, (
ty≥
)); \

89 })

	)

91 
	#SET_CU_STATE
(
vÆ
) \

92 (
	`CSR
(
CSR_STATUS
, 
cus
Ë
vÆ
)

	)

93 
	#GET_CU_STATE
 \

94 (
	`CSR
(
CSR_STATUS
, 
cus
))

	)

96 
	#SET_RU_STATE
(
vÆ
) \

97 (
	`CSR
(
CSR_STATUS
, 
rus
Ë
vÆ
)

	)

98 
	#GET_RU_STATE
 \

99 (
	`CSR
(
CSR_STATUS
, 
rus
))

	)

101 
	#KiB
 1024

	)

103 
	#EEPROM_SIZE
 64

	)

105 
	#BIT
(
n
Ë(1U << (n))

	)

110 #ifde‡
DEBUG_E100


111 
	#logout
(
fmt
, 
¨gs
...Ë
	`Ârötf
(
°dîr
, "EE100\t%-28s" fmt, 
__func__
, ##¨gs)

	)

113 
	#logout
(
fmt
, 
¨gs
...Ë(()0)

	)

116 
	#MAX_ETH_FRAME_SIZE
 1514

	)

119 
	#i82551
 0x82551

	)

120 
	#i82557B
 0x82557b

	)

121 
	#i82557C
 0x82557c

	)

122 
	#i82558B
 0x82558b

	)

123 
	#i82559C
 0x82559c

	)

124 
	#i82559ER
 0x82559e

	)

125 
	#i82562
 0x82562

	)

127 
	#PCI_MEM_SIZE
 (4 * 
KiB
)

	)

128 
	#PCI_IO_SIZE
 (64)

	)

129 
	#PCI_FLASH_SIZE
 (128 * 
KiB
)

	)

133 
	mOP_READ
,

134 
	mOP_WRITE
,

135 } 
	gOPERTAION_DIRECTION
;

140 
	mCU_NOP
 = 0x0000,

141 
	mCU_START
 = 0x0010,

142 
	mCU_RESUME
 = 0x0020,

143 
	mCU_STATSADDR
 = 0x0040,

144 
	mCU_SHOWSTATS
 = 0x0050,

145 
	mCU_CMD_BASE
 = 0x0060,

146 
	mCU_DUMPSTATS
 = 0x0070,

147 
	mCU_S_RESUME
 = 0x00a0

148 }
	gCONTROL_UNIT_COMMAND
;

152 
	mRU_NOP
 = 0x0000,

153 
	mRU_START
 = 0x0001,

154 
	mRU_RESUME
 = 0x0002,

155 
	mRU_DMA_REDIRECT
 = 0x0003,

156 
	mRU_ABORT
 = 0x0004,

157 
	mRU_LOAD_HDS
 = 0x0005,

158 
	mRU_ADDR_LOAD
 = 0x0006,

159 
	mRU_RESUMENR
 = 0x0007,

160 }
	gRECEIVE_UNIT_COMMAND
;

165 
	mCU_IDLE
 = 0,

166 
	mCU_SUSPENDED
 = 1,

167 
	mCU_LPQ_ACTIVE
 = 2,

168 
	mCU_HQP_ACTIVE
 = 3

169 } 
	gCONTROL_UINT_STATE
;

173 
	mRU_IDLE
 = 0,

174 
	mRU_SUSPENDED
 = 1,

175 
	mRU_NO_RESOURCES
 =2,

176 
	mRU_READY
 = 4

177 } 
	gRECEIVE_UNIT_STATE
;

181 
	mPORT_SOFTWARE_RESET
 = 0,

182 
	mPORT_SELF_TEST
 = 1,

183 
	mPORT_SELECTIVE_RESET
 = 2,

184 
	mPORT_DUMP
 = 3,

185 
	mPORT_DUMP_WAKE_UP
 = 7,

186 }
	gSCB_PORT_SELECTION_FUNCTION
;

190 
	mCBL_NOP
 = 0,

191 
	mCBL_IASETUP
 = 1,

192 
	mCBL_CONFIGURE
 = 2,

193 
	mCBL_MULTCAST_ADDR_SETUP
 = 3,

194 
	mCBL_TRANSMIT
 = 4,

195 
	mCBL_LOAD_MICROCODE
 = 5,

196 
	mCBL_DUMP
 = 6,

197 
	mCBL_DIAGNOSE
 = 7,

198 }
	gCBL_COMMAND
;

202 
	mSCB_STATUS
 = 0,

203 
	mSCB_ACK
 = 1,

204 
	mSCB_CMD
 = 2,

205 
	mSCB_INTERRUPT_MASK
 = 3,

206 
	mSCB_POINTER
 = 4,

207 
	mSCB_PORT
 = 8,

208 
	mSCB_EEPROM
 = 0xe,

209 
	mSCB_MDI
 =0x10,

210 } 
	gCSR_OFFSETS
;

214 
	mEEPROM_SK
 = 0x01,

215 
	mEEPROM_CS
 = 0x02,

216 
	mEEPROM_DI
 = 0x04,

217 
	mEEPROM_DO
 = 0x08,

218 } 
	gEEPROM_CONTROL_REGISTER
;

222 
	mEEPROM_READ
 = 0x2,

223 
	mEEPROM_WRITE
 = 0x1,

224 
	mEEPROM_ERASE
 = 0x3,

225 } 
	gEEPROM_OPCODE
;

229 
	mMDI_WRITE
 = 0x1,

230 
	mMDI_READ
 = 0x2,

231 } 
	gMDI_OPCODE
;

235 
	mINT_FCP
 = 
BIT
(8),

236 
	mINT_SWI
 = 
BIT
(10),

237 
	mINT_MDI
 = 
BIT
(11),

238 
	mINT_RNR
 = 
BIT
(12),

239 
	mINT_CNA
 = 
BIT
(13),

240 
	mINT_FR
 = 
BIT
(14),

241 
	mINT_CX_TNO
 = 
BIT
(15),

242 } 
	gE100_INTERRUPT
;

246 
	mCSR_MEMORY_BASE
,

247 
	mCSR_IO_BASE
,

248 
	mFLASH_MEMORY_BASE
,

249 
	mREGION_NUM


250 }
	gE100_PCI_MEMORY_REGION
;

253 
uöt32_t
 
	mtx_good_‰ames
,

254 
	mtx_max_cﬁlisi⁄s
,

255 
	mtx_œã_cﬁlisi⁄s
,

256 
	mtx_undîruns
,

257 
	mtx_lo°_¸s
,

258 
	mtx_de„ºed
,

259 
	mtx_sögÀ_cﬁlisi⁄s
,

260 
	mtx_mu…ùÀ_cﬁlisi⁄s
,

261 
	mtx_tŸÆ_cﬁlisi⁄s
,

263 
	mrx_good_‰ames
,

264 
	mrx_¸c_îr‹s
,

265 
	mrx_Æignmít_îr‹s
,

266 
	mrx_ªsour˚_îr‹s
,

267 
	mrx_ovîrun_îr‹s
,

268 
	mrx_cdt_îr‹s
,

269 
	mrx_sh‹t_‰ame_îr‹s
,

271 
	mcom∂ëe_w‹d
;

275 } 
	t__©åibuã__
 ((
	t∑cked
)Ë
	te100_°©s_t
;

277 
	#EEPROM_I82557_ADDRBIT
 6

	)

279 c⁄° 
uöt16_t
 
	gì¥om_i82557
[] =

288 c⁄° 
uöt8_t
 
	ge100_pci_c⁄figuª
[] =

310 
	#OPCODE
 0xb

	)

311 
	#ADDR
 0xc

	)

312 
	#DATA
 0xd

	)

313 
	#NOP
 0xe

	)

315 
	#EEPROM_RESET_ALL
 0x„

	)

316 
	#EEPROM_SELECT_RESET
 0xff

	)

317 
uöt8_t
 
	m°¨t_bô
;

318 
uöt8_t
 
	m›code
;

319 
uöt8_t
 
	maddªss
;

320 
uöt16_t
 
	md©a
;

322 
uöt32_t
 
	mvÆ
;

323 
uöt32_t
 
	mvÆ_Àn
;

324 
uöt8_t
 
	mvÆ_ty≥
;

326 
uöt8_t
 
	mcs
;

327 
uöt8_t
 
	msk
;

330 
uöt16_t
 
	maddr_Àn
;

331 
uöt16_t
 
	mc⁄ã¡s
[256];

332 } 
	tì¥om_t
;

340 
uöt16_t
 
	mvÆ
;

343 
uöt8_t
 
	mrs1
:2;

344 
uöt8_t
 
	mrus
:4;

345 
uöt8_t
 
	mcus
:2;

346 
uöt8_t
 
	m°©_ack
;

347 }
	mu
;

348 }
	mscb_°©us
;

353 
uöt16_t
 
	mvÆ
;

356 
uöt8_t
 
	mru_cmd
:3;

357 
uöt8_t
 
	mrs1
:1;

358 
uöt8_t
 
	mcu_cmd
:4;

359 
uöt8_t
 
	mm
:1;

360 
uöt8_t
 
	msi
:1;

361 
uöt8_t
 
	msimb
:6;

362 }
	mu
;

363 }
	mscb_cmd
;

368 
uöt32_t
 
	mvÆ
;

371 
uöt32_t
 
	mscb_±r
;

372 }
	mu
;

373 }
	mscb_poöãr
;

378 
uöt32_t
 
	mvÆ
;

381 
uöt8_t
 
	m›code
:4;

382 
uöt32_t
 
	m±r
:28;

383 }
	mu
;

384 }
	mp‹t
;

386 
uöt16_t
 
	mrs1
;

391 
uöt16_t
 
	mvÆ
;

394 
uöt8_t
 
	mìsk
:1;

395 
uöt8_t
 
	mìcs
:1;

396 
uöt8_t
 
	mìdi
:1;

397 
uöt8_t
 
	mìdo
:1;

398 
uöt8_t
 
	mrs1
:4;

399 
uöt8_t
 
	md©a
;

400 }
	mu
;

401 }
	mì¥om_˘æ
;

406 
uöt32_t
 
	mvÆ
;

409 
uöt16_t
 
	md©a
;

410 
uöt8_t
 
	mªgaddr
:5;

411 
uöt8_t
 
	mphyaddr
:5;

412 
uöt8_t
 
	m›code
:2;

413 
uöt8_t
 
	mr
:1;

414 
uöt8_t
 
	mõ
:1;

415 
uöt8_t
 
	mrs1
:2;

416 }
	mu
;

417 } 
	mmdi_˘æ
;

420 
uöt32_t
 
	mrx_byã_cou¡î
;

423 
uöt8_t
 
	móæy_öãºu±
;

428 
uöt16_t
 
	mvÆ
;

429 }
	mÊow_˘æ
;

434 
uöt8_t
 
	mvÆ
;

437 
uöt8_t
 
	mpme_s
:1;

438 
uöt8_t
 
	mtco_r
:1;

439 
uöt8_t
 
	mf_tco_i
:1;

440 
uöt8_t
 
	mtco_ª
:1;

441 
uöt8_t
 
	mrs1
:1;

442 
uöt8_t
 
	mi•
:1;

443 
uöt8_t
 
	mmg
:1;

444 
uöt8_t
 
	mlsci
:1;

445 }
	mu
;

446 }
	mpm_ªg
;

449 
uöt8_t
 
	mgí_˘æ
;

452 
uöt8_t
 
	mgí_°©us
;

455 
uöt8_t
 
	mŸhîs
[30];

456 } 
	t__©åibuã__
 ((
	t∑cked
)Ë
	tc§_t
;

460 
uöt8_t
 
	mbyã_cou¡
;

461 
uöt8_t
 
	mrx_fifo_limô
:4;

462 
uöt8_t
 
	mtx_fifo_limô
:4;

463 
uöt8_t
 
	mad±_öf_•acög
;

464 
uöt8_t
 
	mrs1
;

465 
uöt8_t
 
	mrx_dma_max_byãs
;

466 
uöt8_t
 
	mtx_dma_max_byãs
:7;

467 
uöt8_t
 
	mdmbc_í
:1;

468 
uöt8_t
 
	mœã_scb
:1,

469 
	mrs2
:1,

470 
	mäo_öå
:1,

471 
	mci_öå
:1,

472 
	mrs3
:1,

473 
	mrs4
:1,

474 
	mdis_ovîrun_rx
:1,

475 
	mßve_bad_‰ame
:1;

476 
uöt8_t
 
	mdis_sh‹t_rx
:1,

477 
	mundîrun_ªåy
:2,

478 
	mrs5
:5;

479 
uöt8_t
 
	mmii
:1,

480 
	mrs6
:7;

481 
uöt8_t
 
	mrs7
;

482 
uöt8_t
 
	mrs8
:3,

483 
	mnßi
:1,

484 
	m¥ómbÀ_Àn
:2,

485 
	mlo›back
:2;

486 
uöt8_t
 
	mlöór_¥io
:3,

487 
	mrs9
:5;

488 
uöt8_t
 
	m¥i_mode
:1,

489 
	mrs10
:3,

490 
	möãr‰ame_•acög
:4;

491 
uöt16_t
 
	mrs11
;

492 
uöt8_t
 
	m¥omiscuous
:1,

493 
	mbrﬂdˇ°_dis
:1,

494 
	mrs12
:5,

495 
	m¸s_cdt
:1;

496 
uöt16_t
 
	mrs13
;

497 
uöt8_t
 
	m°rù
:1,

498 
	m∑ddög
:1,

499 
	mrx_¸c
:1,

500 
	mrs14
:5;

501 
uöt8_t
 
	mrs15
:6,

502 
	mf‹˚_fdx
:1,

503 
	mfdx_í
:1;

504 
uöt8_t
 
	mrs16
:6,

505 
	mmul_ü
:2;

506 
uöt8_t
 
	mrs17
:3,

507 
	mmul_Æl
:1,

508 
	mrs18
:4;

509 } 
	t__©åibuã__
 ((
	t∑cked
)Ë
	ti82557_cfg_t
;

512 
VLANClõ¡Sèã
 *
	mvc
;

513 
PCIDevi˚
 *
	mpci_dev
;

514 
	mmmio_ödex
;

515 
uöt8_t
 
	mscb_°©
;

516 
uöt32_t
 
	mªgi⁄_ba£_addr
[
REGION_NUM
];

517 
uöt8_t
 
	mmaˇddr
[6];

518 
uöt16_t
 
	mmdimem
[32];

519 
ì¥om_t
 
	mì¥om
;

520 
uöt32_t
 
	mdevi˚
;

522 
uöt8_t
 
	mmu…_li°
[8];

523 
	mis_mu…ˇ°_íabÀ
;

526 
uöt32_t
 
	mcu_ba£
;

527 
uöt32_t
 
	mcu_off£t
;

528 
uöt32_t
 
	mcu_√xt
;

531 
uöt32_t
 
	mru_ba£
;

532 
uöt32_t
 
	mru_off£t
;

534 
uöt32_t
 
	m°©ßddr
;

536 
e100_°©s_t
 
	m°©i°ics
;

539 
i82557_cfg_t
 
	mc⁄fig
;

542 
uöt8_t
 
	mpkt_buf
[
MAX_ETH_FRAME_SIZE
+4];

544 
	mpkt_buf_Àn
;

549 
c§_t
 
	mc§
;

550 
uöt8_t
 
	mmem
[
PCI_MEM_SIZE
];

551 }
	mpci_mem
;

553 } 
	tE100Sèã
;

560 
	sc⁄åﬁ_block


562 
uöt16_t
 
	mrs1
:13;

563 
uöt8_t
 
	mok
:1;

564 
uöt8_t
 
	mrs2
:1;

565 
uöt8_t
 
	mc
:1;

566 
uöt8_t
 
	mcmd
:3;

567 
uöt16_t
 
	mrs3
:10;

568 
uöt8_t
 
	mi
:1;

569 
uöt8_t
 
	ms
:1;

570 
uöt8_t
 
	mñ
:1;

571 
uöt32_t
 
	mlök_addr
;

572 } 
__©åibuã__
 ((
∑cked
));

576 
uöt32_t
 
	mtx_desc_addr
;

577 
uöt16_t
 
	mtcb_byãs
:14;

578 
uöt8_t
 
	mrs1
:1;

579 
uöt8_t
 
	meof
:1;

580 
uöt8_t
 
	mtx_thªshﬁd
;

581 
uöt8_t
 
	mtbd_num
;

582 } 
	t__©åibuã__
 ((
	t∑cked
)Ë
	ttbd_t
;

587 
uöt16_t
 
	m°©us
:13;

588 
uöt8_t
 
	mok
:1;

589 
uöt8_t
 
	mrs1
:1;

590 
uöt8_t
 
	mc
:1;

591 
uöt8_t
 
	mrs2
:3;

592 
uöt8_t
 
	msf
:1;

593 
uöt8_t
 
	mh
:1;

594 
uöt16_t
 
	mrs3
:9;

595 
uöt8_t
 
	ms
:1;

596 
uöt8_t
 
	mñ
:1;

597 
uöt32_t
 
	mlök_addr
;

598 
uöt32_t
 
	mrs4
;

599 
uöt16_t
 
	mcou¡
:14;

600 
uöt8_t
 
	mf
:1;

601 
uöt8_t
 
	meof
:1;

602 
uöt16_t
 
	msize
:14;

603 
uöt8_t
 
	mrs5
:2;

604 } 
	t__©åibuã__
 ((
	t∑cked
)Ë
	trfd_t
;

608 
	mRX_COLLISION
 = 
BIT
(0),

609 
	mRX_IA_MATCH
 = 
BIT
(1),

610 
	mRX_NO_MATCH
 = 
BIT
(2),

611 
	mRX_ERR
 = 
BIT
(4),

612 
	mRX_TYPE
 = 
BIT
(5),

613 
	mRX_SHORT
 = 
BIT
(7),

614 
	mRX_DMA_ERR
 = 
BIT
(8),

615 
	mRX_LARGE
 = 
BIT
(9),

616 
	mRX_CRC_ERR
 = 
BIT
(10),

617 } 
	gRFD_STATUS
;

619 
	sPCIE100Sèã
 {

620 
PCIDevi˚
 
	mdev
;

621 
E100Sèã
 
	me100
;

622 } 
	tPCIE100Sèã
;

625 c⁄° 
uöt16_t
 
	ge100_mdi_deÁu…
[] = {

635 c⁄° 
uöt8_t
 
	gbrﬂdˇ°_maˇddr
[6] =

639 #ifde‡ 
DEBUG_E100


641 
	$e100_dump
(*
commít
, 
uöt8_t
 *
öfo
, 
Àn
)

643 
i
;

645 i‡–!
commít
 || !
öfo
 )

648 
	`Ârötf
(
°dîr
, "EE100\t%-24s%s", 
__func__
, 
commít
);

649  
i
=0; i<
Àn
; i++ )

650 
	`Ârötf
(
°dîr
, "%x ", 
öfo
[
i
]);

652 
	`Ârötf
(
°dîr
, "\n");

653 
	}
}

655 c⁄° *
	gªg«me
[] =

663 
	#SCBNAME
(
x
) \

664 –(
x
Ë< ((
ªg«me
Ë/ ‘eg«me[0])Ë?Ñeg«me[(x)] : "Unknow¿SCB Regi°î" )

	)

666 c⁄° *
	gcb_cmd_«me
[] =

668 [
CBL_NOP
] = "NOP", [
CBL_IASETUP
] = "Individualáddress setup",

669 [
CBL_CONFIGURE
] = "C⁄figuª", [
CBL_MULTCAST_ADDR_SETUP
] = "Set MultcastáddressÜist",

670 [
CBL_TRANSMIT
] = "Tønsmô", [
CBL_LOAD_MICROCODE
] = "Load microcode",

671 [
CBL_DUMP
] = "Dump", [
CBL_DIAGNOSE
] = "Diagnose",

673 
	#CB_CMD_NAME
(
x
) \

674 –(
x
Ë< ((
cb_cmd_«me
Ë/ (cb_cmd_«me[0])Ë? cb_cmd_«me[(x)] : "Unknow¿CB comm™d" )

	)

676 c⁄° *
	gì¥om_›code_«me
[] =

678 [0] = "Unknow", [
EEPROM_WRITE
] = "Write",

679 [
EEPROM_READ
] = "Ród", [
EEPROM_ERASE
] = "Erase",

681 
	#EEPROM_OPCODE_NAME
(
x
) \

682 –(
x
Ë< ((
ì¥om_›code_«me
) / (eeprom_opcode_name[0])) ? \

683 
ì¥om_›code_«me
[(
x
)] : "Unknown" )

	)

685 
	sì¥om_åa˚_d©a


687 
uöt8_t
 
	mìdo
[256];

688 
uöt8_t
 
	mdi
[256];

689 
	m›
;

690 
	mi
;

691 
uöt32_t
 
	md©a
;

692 }
	gëd
 = {.
›
 = 
NOP
};

694 
	$ì¥om_åa˚
(
ìdo
, 
di
, 
dú
, 
√xt_›
, 
˛r
)

696 
i
;

698 i‡–
˛r
 )

700 *
›«me
 = 
NULL
;

702  
ëd
.
›
 )

704 
NOP
:

706 
OPCODE
:

707 
›«me
 = "opcode";

709 
ADDR
:

710 
›«me
 = "address";

712 
DATA
:

713 
›«me
 = "dataÅransfer";

716 
›«me
 = "Unknown";

719 i‡–
›«me
 )

721 
	`logout
("EEPROMÅrace:\n");

722 
	`Ârötf
(
°dîr
, "\t›î©i⁄: %s\n", 
›«me
);

723 
	`Ârötf
(
°dîr
, "\tDIÅrack:");

724  
i
=0; i<
ëd
.i; i++ )

725 
	`Ârötf
(
°dîr
, "%x ", 
ëd
.
di
[
i
]);

726 
	`Ârötf
(
°dîr
, "\n\tDOÅrack:");

727  
i
=0; i<
ëd
.i; i++ )

728 
	`Ârötf
(
°dîr
, "%x ", 
ëd
.
ìdo
[
i
]);

729 
	`Ârötf
(
°dîr
, "\n\tD©a:%#x\n", 
ëd
.
d©a
);

733 
	`mem£t
(&
ëd
, 0x0, (etd));

734 
ëd
.
›
 = 
√xt_›
;

739 
ëd
.
ìdo
[ëd.
i
] =Éedo;

740 
ëd
.
di
[ëd.
i
] = di;

741 
ëd
.
i
 ++;

742 i‡–
dú
 =
EEPROM_READ
 && 
ëd
.
›
 =
DATA
 )

743 
ëd
.
d©a
 = (ëd.d©®<< 1Ë| 
ìdo
;

745 
ëd
.
d©a
 = (ëd.d©®<< 1Ë| 
di
;

746 
	}
}

748 
	#INT_NAME
(
x
) \

750 *
«me
 = 
NULL
; \

751 
x
) \

753 
INT_FCP
: \

754 
«me
 = "FCP"; \

756 
INT_SWI
: \

757 
«me
 = "SWI"; \

759 
INT_MDI
: \

760 
«me
 = "MDI"; \

762 
INT_RNR
: \

763 
«me
 = "RNR"; \

765 
INT_CNA
: \

766 
«me
 = "CNA"; \

768 
INT_FR
: \

769 
«me
 = "FR"; \

771 
INT_CX_TNO
: \

772 
«me
 ="CX/TNO"; \

775 
«me
 ="Unknown"; \

777 
«me
; \

778 })

	)

781 
	$e100_dump
(*
commít
, 
uöt8_t
 *
öfo
, 
Àn
Ë{
	}
}

782 
	$ì¥om_åa˚
(
ìdo
, 
di
, 
dú
, 
√xt_›
, 
˛r
Ë{
	}
}

785 
	$pci_ª£t
(
E100Sèã
 * 
s
)

787 
uöt8_t
 *
pci_c⁄f
 = 
s
->
pci_dev
->
c⁄fig
;

789 
	`mem˝y
(
pci_c⁄f
, &
e100_pci_c⁄figuª
[0], (e100_pci_configure));

790 
	`logout
("%p\n", 
s
);

793 
	`PCI_CONFIG_8
(
E100_PCI_REVISION_ID
, 0x01);

795 
	`PCI_CONFIG_8
(0x3c, 0x0);

797 
	}
}

799 
	$e100_£À˘ive_ª£t
(
E100Sèã
 * 
s
)

802 
	`mem£t
(
s
->
pci_mem
.
mem
, 0x0, (s->pci_mem.mem));

804 
	`SET_CU_STATE
(
CU_IDLE
);

805 
	`SET_RU_STATE
(
RU_IDLE
);

806 
	`logout
("CUánd RU goÅo idle\n");

808 
s
->
ru_off£t
 = 0;

809 
s
->
cu_off£t
 = 0;

810 
s
->
cu_√xt
 = 0;

813 
	`CSR
(
CSR_CMD
, 
simb
) = 0x3f;

815 
	`CSR_VAL
(
CSR_MDI
Ë|
	`BIT
(21);

820 
	`CSR
(
CSR_EEPROM
, 
ìdo
) = 1;

822 
s
->
scb_°©
 = 0;

825 
	}
}

827 
	$e100_so·w¨e_ª£t
(
E100Sèã
 *
s
)

829 
	`mem£t
(
s
->
pci_mem
.
mem
, 0x0, (s->pci_mem.mem));

831 
	`mem£t
(
s
->
mu…_li°
, 0x0, (s->mult_list));

833 
	`mem˝y
(&
s
->
mdimem
[0], &
e100_mdi_deÁu…
[0], (s->mdimem));

834 
s
->
is_mu…ˇ°_íabÀ
 = 1;

836 
	`mem£t
(
s
->
pkt_buf
, 0x0, (s->pkt_buf));

837 
s
->
pkt_buf_Àn
 = 0;

839 
	`mem£t
(&
s
->
°©i°ics
, 0x0, (s->statistics));

840 
	`e100_£À˘ive_ª£t
(
s
);

842 
	}
}

844 
	$e100_ª£t
(*
›aque
)

846 
E100Sèã
 *
s
 = (E100Sèã *Ë
›aque
;

847 
	`logout
("%p\n", 
s
);

848 
	`e100_so·w¨e_ª£t
(
s
);

849 
	}
}

852 
	$e100_ßve
(
QEMUFûe
 * 
f
, *
›aque
)

856 
	}
}

858 
	$e100_lﬂd
(
QEMUFûe
 * 
f
, *
›aque
, 
vîsi⁄_id
)

862 
	}
}

865 
	$e100_öãºu±
(
E100Sèã
 *
s
, 
uöt16_t
 
öt_ty≥
)

869 i‡–!
	`CSR
(
CSR_CMD
,
m
) )

872 
	`CSR_VAL
(
CSR_STATUS
Ë|
öt_ty≥
;

873 
s
->
scb_°©
 = 
	`CSR
(
CSR_STATUS
, 
°©_ack
);

876 
	`logout
("Triggerán interrupt(type = %s(%#x), SCB Status = %#x)\n",

877 
	`INT_NAME
(
öt_ty≥
), i¡_ty≥, 
	`CSR_VAL
(
CSR_STATUS
));

878 
	`pci_£t_úq
(
s
->
pci_dev
, 0, 1);

880 
	}
}

882 
	$e100_öãºu±_ack
(
E100Sèã
 * 
s
, 
uöt8_t
 
ack
)

888 i‡–!
ack
 || !(
s
->
scb_°©
 &áck) )

890 
	`logout
("Illegal interruptáck(ack=%#x, SCB Stat/Ack=%#x), ignore it\n",

891 
ack
, 
s
->
scb_°©
);

894 
	`CSR
(
CSR_STATUS
, 
°©_ack
Ë
s
->
scb_°©
;

898 
s
->
scb_°©
 &~
ack
;

899 
	`CSR
(
CSR_STATUS
, 
°©_ack
Ë
s
->
scb_°©
;

901 
	`logout
("I¡îru±áck“ame=%s,vÆ=%#x)\n", 
	`INT_NAME
(({
uöt16_t
 
bô
 = 
ack
<<8;bit;})),ack);

902 i‡–!
s
->
scb_°©
 )

904 
	`logout
("All interruptsáreácknowledeged, de-assert interruptÜine\n");

905 
	`pci_£t_úq
(
s
->
pci_dev
, 0, 0);

907 
	}
}

909 
	$e100_£lf_ã°
(
uöt32_t
 
ªs_addr
)

913 
uöt32_t
 
°_sign
;

914 
uöt32_t
 
°_ªsu…
;

915 } 
ã°_ªs
;

917 
ã°_ªs
.
°_sign
 = (
uöt32_t
)-1;

918 
ã°_ªs
.
°_ªsu…
 = 0;

919 
	`˝u_physiˇl_mem‹y_wrôe
(
ªs_addr
, (
uöt8_t
 *)&
ã°_ªs
, (test_res));

921 
	`logout
("Wrôê£l‡ã°Ñesu…Åÿ%#x\n", 
ªs_addr
);

922 
	}
}

924 
	$scb_p‹t_func
(
E100Sèã
 *
s
, 
uöt32_t
 
vÆ
, 
dú
)

926 
	#PORT_SELECTION_MASK
 0xfU

	)

928 
uöt32_t
 
£l
 = 
vÆ
 & 
PORT_SELECTION_MASK
;

930  
£l
 )

932 
PORT_SOFTWARE_RESET
:

933 
	`logout
("do PORT_SOFTWARE_RESET!\n");

934 
	`e100_so·w¨e_ª£t
(
s
);

936 
PORT_SELF_TEST
:

937 
	`e100_£lf_ã°
(
vÆ
 & ~
PORT_SELECTION_MASK
);

938 
	`logout
("do PORT_SELF_TEST!\n");

940 
PORT_SELECTIVE_RESET
:

941 
	`logout
("do PORT_SELECTIVE_RESET!\n");

942 
	`e100_£À˘ive_ª£t
(
s
);

944 
PORT_DUMP
:

945 
	`logout
("do PORT_SOFTWARE_RESET!\n");

947 
PORT_DUMP_WAKE_UP
:

948 
	`logout
("do PORT_SOFTWARE_RESET!\n");

951 
	`logout
("Unk⁄w SCBÖ‹àcomm™d(£À˘i⁄ fun˘i⁄ = %#x)\n", 
£l
);

953 
	}
}

955 
	$e100_wrôe_mdi
(
E100Sèã
 *
s
, 
uöt32_t
 
vÆ
)

957 
uöt32_t
 
õ
 = (
vÆ
 & 0x20000000) >> 29;

958 
uöt32_t
 
›code
 = (
vÆ
 & 0x0c000000) >> 26;

959 
uöt32_t
 
phyaddr
 = (
vÆ
 & 0x03e00000) >> 21;

960 
uöt32_t
 
ªgaddr
 = (
vÆ
 & 0x001f0000) >> 16;

961 
uöt32_t
 
d©a
 = 
vÆ
 & 0x0000ffff;

963 
	`logout
("Write MDI:\n"

969 
›code
, 
phyaddr
, 
ªgaddr
, 
õ
, 
d©a
);

975 i‡–
phyaddr
 != 1 )

977 
	`logout
("Unsuµ‹àPHYáddªss’hy = %#x)\n", 
phyaddr
);

978 
d⁄e
;

983 i‡–
›code
 !
MDI_WRITE
 && opcodê!
MDI_READ
 )

985 
	`logout
("InvÆid Opcode(›codê%#x)\n", 
›code
);

990 i‡–
ªgaddr
 > 6 )

992 
	`logout
("InvÆidÖhyÑegi°î index–phyÑegi°îádd∏%#x)\n", 
ªgaddr
);

995 i‡–
›code
 =
MDI_WRITE
 )

998  
ªgaddr
 )

1001 i‡–
d©a
 & 0x8000 )

1004 
s
->
mdimem
[0] = 
e100_mdi_deÁu…
[0];

1005 
s
->
mdimem
[1] = 
e100_mdi_deÁu…
[1];

1006 
d©a
 = 
s
->
mdimem
[
ªgaddr
];

1011 
d©a
 &= ~0x0200;

1015 
	`logout
("InvÆid wrôê⁄Ñód⁄lyÑegi°î(›codê%#x)\n", 
›code
);

1016 
d©a
 = 
s
->
mdimem
[
ªgaddr
];

1025 
s
->
mdimem
[
ªgaddr
] = 
d©a
;

1026 
	`logout
("MDI WRITE:Ñeg = %#x, d©®%#x\n", 
ªgaddr
, 
d©a
);

1028 i‡–
›code
 =
MDI_READ
 )

1031  
ªgaddr
 )

1034 i‡–
d©a
 & 0x8000 )

1037 
s
->
mdimem
[0] = 
e100_mdi_deÁu…
[0];

1038 
s
->
mdimem
[1] = 
e100_mdi_deÁu…
[1];

1043 
s
->
mdimem
[
ªgaddr
] |= 0x0026;

1049 
s
->
mdimem
[
ªgaddr
] = 0x41fe;

1052 
s
->
mdimem
[
ªgaddr
] = 0x0001;

1055 
d©a
 = 
s
->
mdimem
[
ªgaddr
];

1056 
	`logout
("MDI READ:Ñeg = %#x, d©®%#x\n", 
ªgaddr
, 
d©a
);

1061 
d⁄e
:

1062 
vÆ
 |
	`BIT
(28);

1063 
vÆ
 = (vÆ & 0xffff0000Ë+ 
d©a
;

1064 
	`CSR_WRITE
(
SCB_MDI
, 
vÆ
, 
uöt32_t
);

1066 i‡–
õ
 )

1067 
	`e100_öãºu±
(
s
, (
uöt16_t
)
INT_MDI
);

1068 
	}
}

1070 
	$scb_mdi_func
(
E100Sèã
 *
s
, 
uöt32_t
 
vÆ
, 
dú
)

1072 i‡–
dú
 =
OP_READ
 )

1074 
	`CSR_VAL
(
CSR_MDI
Ë|
	`BIT
(28);

1075 i‡–
dú
 =
OP_WRITE
 )

1076 
	`e100_wrôe_mdi
(
s
, 
vÆ
);

1078 
	`logout
("InvÆid o≥øti⁄ dúe˘i⁄(dú=%x)\n", 
dú
);

1080 
	}
}

1082 
	$ì¥om_ª£t
(
E100Sèã
 *
s
, 
ty≥
)

1084 
ì¥om_t
 *
e
 = &
s
->
ì¥om
;

1086 i‡–
ty≥
 =
EEPROM_RESET_ALL
 )

1088 
	`mem£t
(
e
, 0x0, (
ì¥om_t
));

1089 
e
->
vÆ_ty≥
 = 
NOP
;

1090 
	`logout
("EEPROMÑesetáll\n");

1094 
	`CSR
(
CSR_EEPROM
, 
ìdo
) = 1;

1095 
e
->
°¨t_bô
 = 0;

1096 
e
->
›code
 = 0;

1097 
e
->
addªss
 = 0;

1098 
e
->
d©a
 = 0;

1100 
e
->
vÆ
 = 0;

1101 
e
->
vÆ_Àn
 = 0;

1102 
e
->
vÆ_ty≥
 = 
NOP
;

1104 
e
->
cs
 = 0;

1105 
e
->
sk
 = 0;

1106 
	`logout
("EEPROM selectÑeset\n");

1107 
	}
}

1109 
	$do_ì¥om_›
(
E100Sèã
 *
s
, 
ì¥om_t
 *
e
, 
cs
, 
sk
, 
di
, 
dú
)

1111 
as£π_cs
 = (
cs
 =1 && 
e
->cs == 0);

1112 
de_as£π_cs
 = (
cs
 =0 && 
e
->cs == 1);

1113 
de_as£π_sk
 = (
sk
 =0 && 
e
->sk == 1);

1116 i‡–
cs
 =0 && 
e
->cs == 0 )

1118 
	`logout
("Invalid EECS signal\n");

1123 
e
->
cs
 = cs;

1124 
e
->
sk
 = sk;

1127 i‡–
as£π_cs
 )

1129 
	`logout
("EECSássert\n");

1134 i‡–
de_as£π_cs
 )

1136 i‡–
e
->
vÆ_ty≥
 =
DATA
 &&É->
›code
 =
EEPROM_WRITE
 )

1138 
e
->
d©a
 =É->
vÆ
;

1139 
	`mem˝y
((*)(()
e
->
c⁄ã¡s
 +É->
addªss
),

1140 &
e
->
d©a
, (e->data));

1141 
	`logout
("EEPROM wrôêcom∂ëe(d©a=%#x)\n", 
e
->
d©a
);

1143 
	`ì¥om_åa˚
(0,0,0,
NOP
,1);

1144 
	`ì¥om_ª£t
(
s
, 
EEPROM_SELECT_RESET
);

1145 
	`logout
("EECS de-asserted\n");

1150 i‡–
cs
 =1 && 
de_as£π_sk
 == 1)

1153 i‡–
e
->
°¨t_bô
 =0 && 
di
 == 1 )

1155 
e
->
°¨t_bô
 = 
di
;

1156 
e
->
vÆ_Àn
 = 0;

1157 
e
->
vÆ
 = 0;

1158 
e
->
vÆ_ty≥
 = 
OPCODE
;

1160 
	`ì¥om_åa˚
(0,0,0,
OPCODE
,1);

1161 
	`logout
("EEPROM start bit set\n");

1165 i‡–
e
->
°¨t_bô
 == 1 )

1168 i‡–!(
e
->
vÆ_ty≥
 =
DATA
 &&É->
›code
 =
EEPROM_READ
) )

1170 
e
->
vÆ
 = (e->vÆ << 1Ë| 
di
;

1171 
e
->
vÆ_Àn
 ++;

1174  
e
->
vÆ_ty≥
 )

1177 
OPCODE
:

1178 
	`ì¥om_åa˚
(
	`CSR
(
CSR_EEPROM
, 
ìdo
), 
di
, 
e
->
›code
, 0, 0);

1179 i‡–
e
->
vÆ_Àn
 == 2 )

1181 
e
->
›code
 =É->
vÆ
;

1182 
e
->
vÆ
 = 0;

1183 
e
->
vÆ_Àn
 = 0;

1184 
e
->
vÆ_ty≥
 = 
ADDR
;

1186 
	`ì¥om_åa˚
(0,0,0,
ADDR
,1);

1187 
	`logout
("EEPROM get opcode(opcodeÇame=%s,opcode=%#x )\n",

1188 
	`EEPROM_OPCODE_NAME
(
e
->
›code
),É->opcode);

1192 
ADDR
:

1193 
	`ì¥om_åa˚
(
	`CSR
(
CSR_EEPROM
, 
ìdo
), 
di
, 
e
->
›code
, 0, 0);

1194 i‡–
e
->
vÆ_Àn
 =e->
addr_Àn
 )

1196 
e
->
addªss
 =É->
vÆ
;

1197 
e
->
vÆ
 = 0;

1198 
e
->
vÆ_Àn
 = 0;

1199 
e
->
vÆ_ty≥
 = 
DATA
;

1202 i‡–
e
->
›code
 =
EEPROM_READ
 )

1204 
	`mem˝y
(&
e
->
d©a
, (*)”->
c⁄ã¡s
 +É->
addªss
),

1205 (
e
->
d©a
));

1206 
	`logout
("EEPROMÖrepare dataÅoÑead(addr=%#x,data=%#x)\n",

1207 
e
->
addªss
,É->
d©a
);

1211 
	`CSR
(
CSR_EEPROM
, 
ìdo
) = 0;

1212 
	`ì¥om_åa˚
(0,0,0,
DATA
,1);

1213 
	`logout
("EEPROM gëáddªss◊ddr=%#x)\n", 
e
->
addªss
);

1217 
DATA
:

1218 i‡–
e
->
›code
 =
EEPROM_READ
 )

1222 
uöt16_t
 
t
 = !!(
e
->
d©a
 & (0x8000U >>É->
vÆ_Àn
));

1224 
	`CSR
(
CSR_EEPROM
, 
ìdo
Ë
t
;

1226 
	`logout
("EEPROMÑead(regáddress=%#x,Ñeg val=%#x, do=%#x,Üen=%#x)\n",

1227 
e
->
addªss
,É->
d©a
, 
t
,É->
vÆ_Àn
);

1229 i‡–
e
->
vÆ_Àn
 > ”->
d©a
)*8 )

1235 
e
->
vÆ_ty≥
 = 
NOP
;

1236 
	`logout
("Read complete\n");

1241 
e
->
vÆ_Àn
 ++;

1243 
	`ì¥om_åa˚
(
	`CSR
(
CSR_EEPROM
, 
ìdo
), 
di
, 
e
->
›code
, 0, 0);

1253 
	}
}

1256 
	$scb_ì¥om_func
(
E100Sèã
 *
s
, 
uöt32_t
 
vÆ
, 
dú
)

1258 
ìcs
 = ((
vÆ
 & 
EEPROM_CS
) != 0);

1259 
ìsk
 = ((
vÆ
 & 
EEPROM_SK
) != 0);

1260 
ìdi
 = ((
vÆ
 & 
EEPROM_DI
) != 0);

1262 
	`logout
("EEPROM: Old(cs=%#x, sk=%#x), New(cs=%#x, sk=%#x, di=%#x)\n",

1263 
s
->
ì¥om
.
cs
, s->ì¥om.
sk
, 
ìcs
, 
ìsk
, 
ìdi
);

1265 
	`do_ì¥om_›
(
s
, &s->
ì¥om
, 
ìcs
, 
ìsk
, 
ìdi
, 
dú
);

1268 
	}
}

1270 
	$e100_ru_comm™d
(
E100Sèã
 *
s
, 
uöt8_t
 
vÆ
)

1272  
vÆ
 )

1274 
RU_NOP
:

1277 
RU_START
:

1280 
	`SET_RU_STATE
(
RU_READY
);

1281 
	`logout
("RU is setÅoÑeady\n");

1282 
s
->
ru_off£t
 = 
	`CSR_VAL
(
CSR_POINTER
);

1283 
	`logout
("RFD off£ài†© %#x\n", 
s
->
ru_off£t
);

1285 
RU_RESUME
:

1287 i‡–
GET_RU_STATE
 =
RU_SUSPENDED
 )

1288 
	`SET_RU_STATE
(
RU_READY
);

1289 
	`logout
("RUÑesumeÅoÑeady\n");

1291 
RU_ADDR_LOAD
:

1293 
s
->
ru_ba£
 = 
	`CSR_VAL
(
CSR_POINTER
);

1294 
	`logout
("Lﬂd RU ba£áddªs†© %#x\n", 
s
->
ru_ba£
);

1296 
RU_DMA_REDIRECT
:

1297 
	`logout
("RU DMAÑedirectÇot implemented\n");

1299 
RU_ABORT
:

1300 
	`e100_öãºu±
(
s
, 
INT_RNR
);

1301 
	`SET_RU_STATE
(
RU_IDLE
);

1302 
	`logout
("RUábort, goÅo idle\n");

1304 
RU_LOAD_HDS
:

1305 
	`logout
("RUÜoad header data size(HDS)Çot implemented\n");

1309 
	}
}

1313 
	$e100_execuã_cb_li°
(
E100Sèã
 *
s
, 
is_ªsume
)

1316 
c⁄åﬁ_block
 
cb
 = {0};

1317 
uöt32_t
 
cb_addr
;

1319 i‡–!
is_ªsume
 )

1320 
s
->
cu_off£t
 = 
	`CSR_VAL
(
CSR_POINTER
);

1326 
cb_addr
 = 
s
->
cu_ba£
 + s->
cu_off£t
;

1327 
	`˝u_physiˇl_mem‹y_ªad
(
cb_addr
, (
uöt8_t
 *)&
cb
, (cb));

1330  
cb
.
cmd
 )

1332 
CBL_NOP
:

1335 
CBL_IASETUP
:

1336 
	`˝u_physiˇl_mem‹y_ªad
(
cb_addr
 + 8, &
s
->
maˇddr
[0], (s->macaddr));

1337 
	`e100_dump
("Sëu∞IndividuÆ Addªss:", &
s
->
maˇddr
[0], 6);

1339 
CBL_CONFIGURE
:

1341 
i82557_cfg_t
 *
cfg
 = &
s
->
c⁄fig
;

1343 
	`as£π
((
s
->
c⁄fig
) == 22);

1344 
	`˝u_physiˇl_mem‹y_ªad
(
cb_addr
 + 8, (
uöt8_t
 *)
cfg
, (
s
->
c⁄fig
));

1345 
	`logout
("Setup card configuration:"

1377 
cfg
->
byã_cou¡
, cfg->
rx_fifo_limô
, cfg->
tx_fifo_limô
,

1378 
cfg
->
ad±_öf_•acög
, cfg->
rx_dma_max_byãs
, cfg->
tx_dma_max_byãs
,

1379 
cfg
->
dmbc_í
, cfg->
œã_scb
, cfg->
äo_öå
, cfg->
ci_öå
,

1380 
cfg
->
dis_ovîrun_rx
, cfg->
ßve_bad_‰ame
, cfg->
dis_sh‹t_rx
,

1381 
cfg
->
undîrun_ªåy
, cfg->
mii
, cfg->
nßi
, cfg->
¥ómbÀ_Àn
,

1382 
cfg
->
lo›back
, cfg->
löór_¥io
, cfg->
¥i_mode
, cfg->
öãr‰ame_•acög
,

1383 
cfg
->
¥omiscuous
, cfg->
brﬂdˇ°_dis
, cfg->
¸s_cdt
, cfg->
°rù
,

1384 
cfg
->
∑ddög
, cfg->
rx_¸c
, cfg->
f‹˚_fdx
, cfg->
fdx_í
,

1385 
cfg
->
mul_ü
, cfg->
mul_Æl
);

1388 
CBL_MULTCAST_ADDR_SETUP
:

1390 
uöt16_t
 
mu…_li°_cou¡
 = 0;

1391 
uöt16_t
 
size
 = 0;

1393 
	`˝u_physiˇl_mem‹y_ªad
(
cb_addr
 + 8, (
uöt8_t
 *)&
mu…_li°_cou¡
, 2);

1394 
mu…_li°_cou¡
 = (mult_list_count << 2) >> 2;

1396 i‡–!
mu…_li°_cou¡
 )

1398 
	`logout
("Multcast disabled(multicast count=0)\n");

1399 
s
->
is_mu…ˇ°_íabÀ
 = 0;

1400 
	`mem£t
(
s
->
mu…_li°
, 0x0, (s->mult_list));

1403 
size
 = 
mu…_li°_cou¡
 > (
s
->
mu…_li°
) ?

1404 (
s
->
mu…_li°
Ë: 
mu…_li°_cou¡
;

1405 
	`˝u_physiˇl_mem‹y_ªad
(
cb_addr
 + 12, &
s
->
mu…_li°
[0], 
size
);

1407 
	`e100_dump
("Sëu∞Mu…iˇ°Üi°: ", &
s
->
mu…_li°
[0], 
size
);

1410 
CBL_TRANSMIT
:

1414 
c⁄åﬁ_block
 
cb
;

1415 
tbd_t
 
tbd
;

1416 } 
	`__©åibuã__
 ((
∑cked
)Ë
tx
;

1420 
uöt32_t
 
addr
;

1421 
uöt16_t
 
size
;

1422 
uöt16_t
 
is_ñ_£t
;

1423 } 
tx_buf
 = {0};

1425 
uöt32_t
 
tbd_¨øy
;

1426 
uöt16_t
 
tcb_byãs
;

1427 
uöt8_t
 
sf
;

1428 
Àn
 = 
s
->
pkt_buf_Àn
;

1430 
	`as£π
–
Àn
 < (
s
->
pkt_buf
));

1432 
	`˝u_physiˇl_mem‹y_ªad
(
cb_addr
, (
uöt8_t
 *)&
tx
, (tx));

1433 
tbd_¨øy
 = 
	`À32_to_˝u
(
tx
.
tbd
.
tx_desc_addr
);

1434 
tcb_byãs
 = 
	`À16_to_˝u
(
tx
.
tbd
.tcb_bytes);

1436 
sf
 = 
tx
.
cb
.
rs3
 & 0x1;

1438 
	`logout
("Getá TBD:\n"

1445 
tbd_¨øy
, 
tcb_byãs
, 
tx
.
tbd
.
eof
,

1446 
tx
.
tbd
.
tx_thªshﬁd
,Åx.tbd.
tbd_num
,

1447 
sf
 ? "Flexible" : "Simple");

1449 i‡–!
sf
 || 
tbd_¨øy
 =(
uöt32_t
)-1 )

1456 i‡–!
tcb_byãs
 ||Åcb_byã†> (
s
->
pkt_buf
) )

1459 
	`˝u_physiˇl_mem‹y_ªad
(
cb_addr
+16, &
s
->
pkt_buf
[0], 
tcb_byãs
);

1460 
Àn
 = 
tcb_byãs
;

1461 
	`logout
("sim∂êmode(size=%d)\n", 
Àn
);

1471 i‡–!
tx
.
tbd
.
tbd_num
 )

1475 i‡–
s
->
devi˚
 =
i82557C
 || s->devi˚ =
i82557B
 )

1479 
i
;

1481  
i
=0; i<
tx
.
tbd
.
tbd_num
; i++ )

1484 
	`˝u_physiˇl_mem‹y_ªad
(
tbd_¨øy
, (
uöt8_t
 *)&
tx_buf
,

1485 (
tx_buf
));

1486 
tx_buf
.
is_ñ_£t
 &= 0x1;

1487 
tx_buf
.
size
 &= 0x7fff;

1488 
tbd_¨øy
 += 8;

1490 i‡–
tx_buf
.
size
 > (
s
->
pkt_buf
Ë- 
Àn
 )

1492 
	`logout
("Warning: GetáÅoo big TBD, ignore it"

1494 
tx_buf
.
addr
,Åx_buf.
size
,Åx_buf.
is_ñ_£t
);

1498 
	`˝u_physiˇl_mem‹y_ªad
(
tx_buf
.
addr
, &
s
->
pkt_buf
[
Àn
],

1499 
tx_buf
.
size
);

1501 
	`logout
("TBD (standard mode): bufáddr %#x, size %d,Él:%#x\n",

1502 
tx_buf
.
addr
,Åx_buf.
size
,Åx_buf.
is_ñ_£t
);

1503 
Àn
 +
tx_buf
.
size
;

1505 i‡–
tx_buf
.
is_ñ_£t
 )

1516 
uöt32_t
 
tbd_addr
 = 
cb_addr
+16;

1517 
i
 = 0;

1520  ; 
i
<2 && i<
tx
.
tbd
.
tbd_num
; i++ )

1523 
	`˝u_physiˇl_mem‹y_ªad
(
tbd_¨øy
, (
uöt8_t
 *)&
tx_buf
,

1524 (
tx_buf
));

1525 
tx_buf
.
is_ñ_£t
 &= 0x1;

1526 
tbd_addr
 += 8;

1531 i‡–
tx_buf
.
size
 == 0 )

1533 
tx_buf
.
is_ñ_£t
 = 1;

1537 i‡–
tx_buf
.
size
 + 
Àn
 > (
s
->
pkt_buf
) )

1539 
	`logout
("TX frame isÅooÜarge, discarding it"

1540 "(bu‡addr=%#x, size=%#x)\n", 
tx_buf
.
addr
,

1541 
tx_buf
.
size
);

1546 
	`logout
("TBD (extended mode): bufáddr %#08x, size %#04x,Él:%#x\n",

1547 
tx_buf
.
addr
,Åx_buf.
size
,Åx_buf.
is_ñ_£t
);

1548 
	`˝u_physiˇl_mem‹y_ªad
(
tx_buf
.
addr
, &
s
->
pkt_buf
[
Àn
],

1549 
tx_buf
.
size
);

1551 
Àn
 +
tx_buf
.
size
;

1553 i‡–
tx_buf
.
is_ñ_£t
 )

1561 i‡–
tbd_¨øy
 !(
uöt32_t
)-1 && !
tx_buf
.
is_ñ_£t
 )

1563 
tbd_addr
 = 
tbd_¨øy
;

1568  ; 
i
<
tx
.
tbd
.
tbd_num
; i++ )

1570 
	`˝u_physiˇl_mem‹y_ªad
(
tbd_addr
, (
uöt8_t
 *)&
tx_buf
,

1571 (
tx_buf
));

1572 
tx_buf
.
is_ñ_£t
 &= 0x1;

1573 
tbd_addr
 += 8;

1575 
	`˝u_physiˇl_mem‹y_ªad
(
tx_buf
.
addr
, &
s
->
pkt_buf
[
Àn
],

1576 
tx_buf
.
size
);

1577 
	`logout
("TBD (extended mode): bufáddr 0x%#08x, size 0x%#04x\n",

1578 
tx_buf
.
addr
,Åx_buf.
size
);

1580 
Àn
 +
tx_buf
.
size
;

1582 i‡–
tx_buf
.
is_ñ_£t
 )

1590 
s
->
pkt_buf_Àn
 = 
Àn
;

1600 i‡–
tx
.
tbd
.
tx_thªshﬁd
 && 
s
->
pkt_buf_Àn
 <Åx.tbd.tx_threshold * 8 )

1602 
	`logout
("Cuºíàd©®Àngth i¿FIFO buf„r:%d\n", 
s
->
pkt_buf_Àn
);

1607 i‡–
s
->
pkt_buf_Àn
 )

1609 
	`qemu_£nd_∑ckë
(
s
->
vc
, s->
pkt_buf
, s->
pkt_buf_Àn
);

1610 
s
->
°©i°ics
.
tx_good_‰ames
 ++;

1611 
	`logout
("Send out frame successful(size=%d,"

1612 "Æªady síà%d fømes)\n", 
s
->
pkt_buf_Àn
,

1613 
s
->
°©i°ics
.
tx_good_‰ames
);

1614 
s
->
pkt_buf_Àn
 = 0;

1617 
	`e100_dump
("De°áddr:", (
uöt8_t
 *)
s
->
pkt_buf
, 6);

1618 
	`e100_dump
("Sr¯addr:", (
uöt8_t
 *)(
s
->
pkt_buf
+6), 6);

1619 
	`e100_dump
("ty≥:", (
uöt8_t
 *)(
s
->
pkt_buf
+8), 2);

1623 
CBL_LOAD_MICROCODE
:

1624 #ifde‡
DEBUG_E100


1627 
	#MICRO_CODE_LEN
 256

	)

1628 
uöt8_t
 
mi¸o_code
[
MICRO_CODE_LEN
] = {0};

1629 
	`˝u_physiˇl_mem‹y_ªad
(
cb_addr
+8, 
mi¸o_code
, 
MICRO_CODE_LEN
);

1630 
	`e100_dump
("Lﬂd mi¸ÿcode:", 
mi¸o_code
, 
MICRO_CODE_LEN
);

1634 
CBL_DUMP
:

1635 
	`logout
("Control block dump\n");

1637 
CBL_DIAGNOSE
:

1638 
	`logout
("Control block diagnose\n");

1641 
	`logout
("Unknow¿C⁄åﬁ block comm™d(vÆ=%#x)\n", 
cb
.
cmd
);

1648 
cb
.
c
 = 1;

1649 
cb
.
ok
 = 1;

1651 
	`˝u_physiˇl_mem‹y_wrôe
(
cb_addr
, (
uöt8_t
 *)&
cb
, 2);

1653 
	`logout
("Finishedá command from CBÜist:\n"

1661 
cb
.
ok
, cb.
c
, 
	`CB_CMD_NAME
(cb.
cmd
), cb.cmd,

1662 
cb
.
i
, cb.
s
, cb.
ñ
, cb.
lök_addr
);

1664 i‡–
cb
.
i
 )

1665 
	`e100_öãºu±
(
s
, (
uöt16_t
)
INT_CX_TNO
);

1668 i‡–
cb
.
s
 )

1670 
	`logout
("CU goÅo suspend\n");

1671 
	`SET_CU_STATE
(
CU_SUSPENDED
);

1672 
s
->
cu_√xt
 = 
cb
.
lök_addr
;

1675 i‡–!(
s
->
c⁄fig
.
ci_öå
Ë&& 
cb
.
i
 )

1676 
	`e100_öãºu±
(
s
, (
uöt16_t
)
INT_CNA
);

1682 i‡–
cb
.
ñ
 )

1684 
	`logout
("Command blockÜist isÉmpty, CU goÅo idle\n");

1685 
	`SET_CU_STATE
(
CU_IDLE
);

1689 i‡–
cb
.
i
 )

1690 
	`e100_öãºu±
(
s
, (
uöt16_t
)
INT_CNA
);

1695 
s
->
cu_off£t
 = 
	`À32_to_˝u
(
cb
.
lök_addr
);

1697 
	}
}

1699 
	$dump_°©i°ics
(
E100Sèã
 * 
s
, 
uöt32_t
 
com∂ëe_w‹d
)

1704 
s
->
°©i°ics
.
com∂ëe_w‹d
 = complete_word;

1705 
	`˝u_physiˇl_mem‹y_wrôe
(
s
->
°©ßddr
, (
uöt8_t
 *)&s->
°©i°ics
, (s->statistics));

1707 
	}
}

1709 
	$e100_cu_comm™d
(
E100Sèã
 *
s
, 
uöt8_t
 
vÆ
)

1712  
vÆ
 )

1714 
CU_NOP
:

1717 
CU_START
:

1719 i‡–
GET_CU_STATE
 !
CU_IDLE
 && GET_CU_STATE !
CU_SUSPENDED
 )

1721 
	`logout
("Illegal CU start command. Device isÇot idle or suspend\n");

1725 
	`SET_CU_STATE
(
CU_LPQ_ACTIVE
);

1726 
	`logout
("CU start\n");

1728 
	`e100_execuã_cb_li°
(
s
, 0);

1730 
CU_RESUME
:

1732 
uöt32_t
 
¥evious_cb
 = 
s
->
cu_ba£
 + s->
cu_off£t
;

1733 
c⁄åﬁ_block
 
cb
;

1741 i‡–
GET_CU_STATE
 =
CU_IDLE
 )

1743 
	`logout
("IllegalÑesume form IDLE\n");

1746 
	`˝u_physiˇl_mem‹y_ªad
(
¥evious_cb
, (
uöt8_t
 *)&
cb
,

1747 (
cb
));

1754 i‡–
cb
.
s
 )

1756 
	`logout
("CU still in suspend\n");

1760 
	`SET_CU_STATE
(
CU_LPQ_ACTIVE
);

1761 i‡–
cb
.
ñ
 )

1763 
	`logout
("CBÜist isÉmpty, CU just goÅoáctive\n");

1768 
s
->
cu_off£t
 = s->
cu_√xt
;

1770 
	`e100_execuã_cb_li°
(
s
, 1);

1772 
	`logout
("CUÑesume\n");

1775 
CU_STATSADDR
:

1777 
s
->
°©ßddr
 = 
	`CSR_VAL
(
CSR_POINTER
);

1778 
	`logout
("Lﬂd Sèt†addªs†© %#x\n", 
s
->
°©ßddr
);

1780 
CU_SHOWSTATS
:

1782 
	`dump_°©i°ics
(
s
, 0xa005);

1783 
	`logout
("Execute dump statistics\n");

1785 
CU_CMD_BASE
:

1787 
s
->
cu_ba£
 = 
	`CSR_VAL
(
CSR_POINTER
);

1788 
	`logout
("Lﬂd CU ba£áà%x\n", 
s
->
cu_ba£
);

1790 
CU_DUMPSTATS
:

1792 
	`dump_°©i°ics
(
s
, 0xa007);

1793 
	`mem£t
(&
s
->
°©i°ics
, 0x0, (s->statistics));

1794 
	`logout
("Execute dumpándÑeset statistics\n");

1796 
CU_S_RESUME
:

1798 
	`logout
("CU staticÑesume isÇot implemented\n");

1801 
	`logout
("Unknow¿CU comm™d(vÆ=%#x)\n", 
vÆ
);

1805 
	}
}

1807 
	$scb_cmd_func
(
E100Sèã
 *
s
, 
uöt16_t
 
vÆ
, 
dú
)

1810 i‡–
vÆ
 & 0x0f )

1812 
	`e100_ru_comm™d
(
s
, 
vÆ
 & 0x0f);

1813 
	`CSR
(
CSR_CMD
, 
ru_cmd
) = 0;

1815 i‡–
vÆ
 & 0xf0 )

1817 
	`e100_cu_comm™d
(
s
, 
vÆ
 & 0xf0);

1818 
	`CSR
(
CSR_CMD
, 
cu_cmd
) = 0;

1821 
	}
}

1825 
	mWRITEB
,

1826 
	mWRITEW
,

1827 
	mWRITEL
,

1828 
	mOP_IS_READ
,

1829 } 
	gWRITE_BYTES
;

1836 
	$e100_execuã
(
E100Sèã
 *
s
, 
uöt32_t
 
addr_off£t
,

1837 
uöt32_t
 
vÆ
, 
dú
, 
byãs
)

1840  
addr_off£t
 )

1842 
SCB_STATUS
:

1843 i‡–
byãs
 =
WRITEB
 )

1845 
SCB_ACK
:

1846 i‡–
dú
 =
OP_WRITE
 )

1848 
uöt8_t
 
_vÆ
 = 0;

1849 i‡–
byãs
 =
WRITEB
 )

1850 
_vÆ
 = (
uöt8_t
)
vÆ
;

1851 i‡–
byãs
 =
WRITEW
 )

1852 
_vÆ
 = ((
uöt16_t
)
vÆ
) >> 8;

1853 i‡–
byãs
 =
WRITEL
)

1856 
_vÆ
 = ((
uöt16_t
)
vÆ
) >> 8;

1857 
	`logout
("WARNNING: Drvier write 4 bytesÅo CSRÑegisterát offset %d,"

1858 "emuœt‹ may dÿthög†wr⁄g!!!\n", 
addr_off£t
);

1861 
	`e100_öãºu±_ack
(
s
, 
_vÆ
);

1864 
SCB_CMD
:

1865 i‡–
dú
 =
OP_WRITE
 )

1866 
	`scb_cmd_func
(
s
, 
vÆ
, 
dú
);

1874 i‡–
byãs
 =
WRITEW
 && (
vÆ
&0xff00) != 0 )

1880 
SCB_INTERRUPT_MASK
:

1881 i‡–
dú
 =
OP_WRITE
 )

1883 
uöt8_t
 
_vÆ
 = 0;

1884 i‡–
byãs
 =
WRITEB
 )

1885 
_vÆ
 = (
uöt8_t
)
vÆ
;

1886 i‡–
byãs
 =
WRITEW
 )

1887 
_vÆ
 = (
vÆ
 & 0xff00) >> 8;

1889 
	`logout
("WARNNING: Drvier write 4 bytesÅo CSRÑegisterát offset %d,"

1890 "emuœt‹ may dÿthög†wr⁄g!!!\n", 
addr_off£t
);

1893 i‡–
_vÆ
 & 
	`BIT
(1) )

1894 
	`e100_öãºu±
(
s
, 
INT_SWI
);

1897 
SCB_PORT
 ... SCB_PORT + 3:

1898 i‡–
dú
 =
OP_WRITE
 )

1901 i‡–(
byãs
 =
WRITEB
 && 
addr_off£t
 !
SCB_PORT
 + 3) ||

1902 (
byãs
 =
WRITEW
 && 
addr_off£t
 !
SCB_PORT
 + 2) )

1905 
	`scb_p‹t_func
(
s
, 
	`CSR_VAL
(
CSR_PORT
), 
dú
);

1908 
SCB_MDI
 ... SCB_MDI + 3:

1909 i‡–
dú
 =
OP_WRITE
 )

1912 i‡–(
byãs
 =
WRITEB
 && 
addr_off£t
 !
SCB_MDI
 + 3) ||

1913 (
byãs
 =
WRITEW
 && 
addr_off£t
 !
SCB_MDI
 + 2) )

1917 
	`scb_mdi_func
(
s
, 
	`CSR_VAL
(
CSR_MDI
), 
dú
);

1919 
SCB_EEPROM
:

1920 i‡–
dú
 =
OP_WRITE
 )

1921 
	`scb_ì¥om_func
(
s
, 
vÆ
, 
dú
);

1924 
SCB_POINTER
:

1927 
	`logout
("Driver operate on CSRÑeg(offset=%#x,dir=%s,val=%#x)\n",

1928 
addr_off£t
, 
dú
==
OP_WRITE
?"wrôe":"ªad", 
vÆ
);

1931 
	}
}

1934 
uöt8_t
 
	$e100_ªad1
(
E100Sèã
 * 
s
, 
uöt32_t
 
addr_off£t
)

1936 
uöt8_t
 
vÆ
 = -1;

1938 i‡–
addr_off£t
 + (
vÆ
Ë>(
s
->
pci_mem
.
mem
) )

1940 
	`logout
("InvaûdÑód, bey⁄d mem‹y bound¨y◊ddr:%#x)\n", 
addr_off£t


1941 + 
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
]);

1942  
vÆ
;

1946 
	`e100_execuã
(
s
, 
addr_off£t
, 
vÆ
, 
OP_READ
, 
OP_IS_READ
);

1947 
vÆ
 = 
	`CSR_READ
(
addr_off£t
, 
uöt8_t
);

1948 
	`logout
("READ1: Regi°îÇamê%s,áddr_off£à%#x, vÆ=%#x\n", 
	`SCBNAME
(
addr_off£t
),áddr_off£t, 
vÆ
);

1950  
vÆ
;

1951 
	}
}

1953 
uöt16_t
 
	$e100_ªad2
(
E100Sèã
 * 
s
, 
uöt32_t
 
addr_off£t
)

1955 
uöt16_t
 
vÆ
 = -1;

1957 i‡–
addr_off£t
 + (
vÆ
Ë>(
s
->
pci_mem
.
mem
) )

1959 
	`logout
("InvaûdÑód, bey⁄d mem‹y bound¨y◊ddr:%#x)\n", 
addr_off£t


1960 + 
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
]);

1961  
vÆ
;

1964 
	`e100_execuã
(
s
, 
addr_off£t
, 
vÆ
, 
OP_READ
, 
OP_IS_READ
);

1965 
vÆ
 = 
	`CSR_READ
(
addr_off£t
, 
uöt16_t
);

1966 
	`logout
("READ2: Regi°îÇamê%s,áddr_off£à%#x, vÆ=%#x\n", 
	`SCBNAME
(
addr_off£t
),áddr_off£t, 
vÆ
);

1968  
vÆ
;

1970 
	}
}

1972 
uöt32_t
 
	$e100_ªad4
(
E100Sèã
 * 
s
, 
uöt32_t
 
addr_off£t
)

1974 
uöt32_t
 
vÆ
 = -1;

1976 i‡–
addr_off£t
 + (
vÆ
Ë>(
s
->
pci_mem
.
mem
) )

1978 
	`logout
("InvaûdÑód, bey⁄d mem‹y bound¨y◊ddr:%#x)\n", 
addr_off£t


1979 + 
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
]);

1980  
vÆ
;

1983 
	`e100_execuã
(
s
, 
addr_off£t
, 
vÆ
, 
OP_READ
, 
OP_IS_READ
);

1984 
vÆ
 = 
	`CSR_READ
(
addr_off£t
, 
uöt32_t
);

1985 
	`logout
("READ4: Regi°îÇamê%s,áddr_off£à%#x, vÆ=%#x\n", 
	`SCBNAME
(
addr_off£t
),áddr_off£t, 
vÆ
);

1987  
vÆ
;

1989 
	}
}

1991 
uöt32_t
 
	$pci_mmio_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1993 
E100Sèã
 *
s
 = 
›aque
;

1994 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
];

1995  
	`e100_ªad1
(
s
, 
addr
);

1996 
	}
}

1998 
uöt32_t
 
	$pci_mmio_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2000 
E100Sèã
 *
s
 = 
›aque
;

2001 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
];

2002  
	`e100_ªad2
(
s
, 
addr
);

2003 
	}
}

2005 
uöt32_t
 
	$pci_mmio_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

2007 
E100Sèã
 *
s
 = 
›aque
;

2008 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
];

2009  
	`e100_ªad4
(
s
, 
addr
);

2010 
	}
}

2012 
CPURódMem‹yFunc
 *
	gpci_mmio_ªad
[] = {

2013 
pci_mmio_ªadb
,

2014 
pci_mmio_ªadw
,

2015 
pci_mmio_ªadl


2018 
	$e100_wrôe1
(
E100Sèã
 * 
s
, 
uöt32_t
 
addr_off£t
, 
uöt8_t
 
vÆ
)

2020 i‡–
addr_off£t
 + (
vÆ
Ë>(
s
->
pci_mem
.
mem
) )

2022 
	`logout
("Invaûd wrôe, bey⁄d mem‹y bound¨y◊dd∏%#x, vÆ = %#x\n", 
addr_off£t


2023 + 
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
], 
vÆ
);

2028 i‡–
addr_off£t
 =
SCB_STATUS
 )

2033 i‡–
addr_off£t
 =
SCB_EEPROM
 )

2035 
ìdo
 = 
	`BIT
(3Ë& 
	`CSR_VAL
(
CSR_EEPROM
);

2036 
	`CSR_WRITE
(
addr_off£t
, 
vÆ
, 
uöt8_t
);

2037 
	`CSR
(
CSR_EEPROM
, 
ìdo
Ë!!”edÿ& 
EEPROM_DO
);

2039 
	`logout
("WRITE1: Regi°îÇamê%s,áddr_off£à%#x, vÆ = %#x\n", 
	`SCBNAME
(
addr_off£t
),addr_off£t, (
uöt8_t
)
	`CSR_VAL
(
CSR_EEPROM
));

2044 
	`CSR_WRITE
(
addr_off£t
, 
vÆ
, 
uöt8_t
);

2047 
	`logout
("WRITE1: Regi°îÇamê%s,áddr_off£à%#x, vÆ = %#x\n", 
	`SCBNAME
(
addr_off£t
),addr_off£t, 
vÆ
);

2049 
	}
}

2051 
	$e100_wrôe2
(
E100Sèã
 * 
s
, 
uöt32_t
 
addr_off£t
, 
uöt16_t
 
vÆ
)

2053 i‡–
addr_off£t
 + (
vÆ
Ë>(
s
->
pci_mem
.
mem
) )

2055 
	`logout
("Invaûd wrôe, bey⁄d mem‹y bound¨y◊dd∏%#x, vÆ = %#x\n", 
addr_off£t


2056 + 
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
], 
vÆ
);

2061 i‡–
addr_off£t
 =
SCB_STATUS
 )

2063 
uöt8_t
 
__vÆ
 = 
vÆ
 >> 8;

2064 
	`CSR_WRITE
(
addr_off£t
+1, 
__vÆ
, 
uöt8_t
);

2067 i‡–
addr_off£t
 =
SCB_EEPROM
 )

2069 
ìdo
 = 
	`BIT
(3Ë& 
	`CSR_VAL
(
CSR_EEPROM
);

2070 
	`CSR_WRITE
(
addr_off£t
, 
vÆ
, 
uöt16_t
);

2071 
	`CSR
(
CSR_EEPROM
, 
ìdo
Ë!!”edÿ& 
EEPROM_DO
);

2073 
	`logout
("WRITE1: Regi°îÇamê%s,áddr_off£à%#x, vÆ = %#x\n", 
	`SCBNAME
(
addr_off£t
),addr_off£t, 
	`CSR_VAL
(
CSR_EEPROM
));

2078 
	`CSR_WRITE
(
addr_off£t
, 
vÆ
, 
uöt16_t
);

2081 
	`logout
("WRITE2: Regi°îÇamê%s,áddr_off£à%#x, vÆ = %#x\n", 
	`SCBNAME
(
addr_off£t
),addr_off£t, 
vÆ
);

2083 
	}
}

2085 
	$e100_wrôe4
(
E100Sèã
 * 
s
, 
uöt32_t
 
addr_off£t
, uöt32_à
vÆ
)

2087 i‡–
addr_off£t
 + (
vÆ
Ë>(
s
->
pci_mem
.
mem
) )

2089 
	`logout
("Invaûd wrôe, bey⁄d mem‹y bound¨y◊dd∏%#x, vÆ = %#x\n", 
addr_off£t


2090 + 
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
], 
vÆ
);

2095 i‡–
addr_off£t
 =
SCB_STATUS
 )

2097 
uöt8_t
 
__vÆ
[4] = {0};

2100 *(
uöt32_t
 *)&
__vÆ
 = 
vÆ
;

2102 
	`CSR_WRITE
(
addr_off£t
+1, 
__vÆ
[1], 
uöt8_t
);

2103 
	`CSR_WRITE
(
addr_off£t
+2, 
__vÆ
[2], 
uöt8_t
);

2104 
	`CSR_WRITE
(
addr_off£t
+3, 
__vÆ
[3], 
uöt8_t
);

2109 
	`CSR_WRITE
(
addr_off£t
, 
vÆ
, 
uöt32_t
);

2112 
	`logout
("WRITE4: Regi°îÇamê%s,áddr_off£à%#x, vÆ = %#x\n", 
	`SCBNAME
(
addr_off£t
),addr_off£t, 
vÆ
);

2114 
	}
}

2116 
	$pci_mmio_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

2118 
E100Sèã
 *
s
 = 
›aque
;

2119 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
];

2120 
	`e100_wrôe1
(
s
, 
addr
, 
vÆ
);

2121 
	`e100_execuã
(
s
, 
addr
, 
vÆ
, 
OP_WRITE
, 
WRITEB
);

2122 
	}
}

2124 
	$pci_mmio_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

2126 
E100Sèã
 *
s
 = 
›aque
;

2127 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
];

2128 
	`e100_wrôe2
(
s
, 
addr
, 
vÆ
);

2129 
	`e100_execuã
(
s
, 
addr
, 
vÆ
, 
OP_WRITE
, 
WRITEW
);

2130 
	}
}

2132 
	$pci_mmio_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

2134 
E100Sèã
 *
s
 = 
›aque
;

2135 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_MEMORY_BASE
];

2136 
	`e100_wrôe4
(
s
, 
addr
, 
vÆ
);

2137 ()
	`e100_execuã
(
s
, 
addr
, 
vÆ
, 
OP_WRITE
, 
WRITEL
);

2138 
	}
}

2140 
CPUWrôeMem‹yFunc
 *
	gpci_mmio_wrôe
[] = {

2141 
pci_mmio_wrôeb
,

2142 
pci_mmio_wrôew
,

2143 
pci_mmio_wrôñ


2146 
	$pci_mmio_m≠
(
PCIDevi˚
 * 
pci_dev
, 
ªgi⁄_num
,

2147 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

2149 
PCIE100Sèã
 *
d
 = (PCIE100Sèã *Ë
pci_dev
;

2151 
	`logout
("region %d,áddr=0x%08x, size=0x%08x,Åype=%d\n",

2152 
ªgi⁄_num
, 
addr
, 
size
, 
ty≥
);

2154 i‡–
ªgi⁄_num
 =
CSR_MEMORY_BASE
 ) {

2156 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
size
, 
d
->
e100
.
mmio_ödex
);

2157 
d
->
e100
.
ªgi⁄_ba£_addr
[
ªgi⁄_num
] = 
addr
;

2159 
	}
}

2162 
	$i›‹t_wrôe1
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2164 
E100Sèã
 *
s
 = 
›aque
;

2165 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_IO_BASE
];

2166 
	`e100_wrôe1
(
s
, 
addr
, 
vÆ
);

2167 ()
	`e100_execuã
(
s
, 
addr
, (
uöt32_t
)
vÆ
, 
OP_WRITE
, 
WRITEB
);

2168 
	}
}

2170 
	$i›‹t_wrôe2
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2172 
E100Sèã
 *
s
 = 
›aque
;

2173 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_IO_BASE
];

2174 
	`e100_wrôe2
(
s
, 
addr
, 
vÆ
);

2175 ()
	`e100_execuã
(
s
, 
addr
, (
uöt32_t
)
vÆ
, 
OP_WRITE
, 
WRITEW
);

2176 
	}
}

2178 
	$i›‹t_wrôe4
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2180 
E100Sèã
 *
s
 = 
›aque
;

2181 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_IO_BASE
];

2182 
	`e100_wrôe4
(
s
, 
addr
, 
vÆ
);

2183 ()
	`e100_execuã
(
s
, 
addr
, (
uöt32_t
)
vÆ
, 
OP_WRITE
, 
WRITEL
);

2184 
	}
}

2186 
uöt32_t
 
	$i›‹t_ªad1
(*
›aque
, 
uöt32_t
 
addr
)

2188 
E100Sèã
 *
s
 = 
›aque
;

2189 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_IO_BASE
];

2190  
	`e100_ªad1
(
s
, 
addr
);

2191 
	}
}

2193 
uöt32_t
 
	$i›‹t_ªad2
(*
›aque
, 
uöt32_t
 
addr
)

2195 
E100Sèã
 *
s
 = 
›aque
;

2196 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_IO_BASE
];

2197  
	`e100_ªad2
(
s
, 
addr
);

2198 
	}
}

2200 
uöt32_t
 
	$i›‹t_ªad4
(*
›aque
, 
uöt32_t
 
addr
)

2202 
E100Sèã
 *
s
 = 
›aque
;

2203 
addr
 -
s
->
ªgi⁄_ba£_addr
[
CSR_IO_BASE
];

2204  
	`e100_ªad4
(
s
, 
addr
);

2205 
	}
}

2207 
	$pci_i›‹t_m≠
(
PCIDevi˚
 * 
pci_dev
, 
ªgi⁄_num
,

2208 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

2210 
PCIE100Sèã
 *
d
 = (PCIE100Sèã *Ë
pci_dev
;

2211 
E100Sèã
 *
s
 = &
d
->
e100
;

2213 
	`logout
("region %d,áddr=0x%08x, size=0x%08x,Åype=%d\n",

2214 
ªgi⁄_num
, 
addr
, 
size
, 
ty≥
);

2216 i‡–
ªgi⁄_num
 != 1 )

2218 
	`logout
("InvaidÑegionÇumber!\n");

2222 
	`ªgi°î_i›‹t_wrôe
(
addr
, 
size
, 1, 
i›‹t_wrôe1
, 
s
);

2223 
	`ªgi°î_i›‹t_ªad
(
addr
, 
size
, 1, 
i›‹t_ªad1
, 
s
);

2224 
	`ªgi°î_i›‹t_wrôe
(
addr
, 
size
, 2, 
i›‹t_wrôe2
, 
s
);

2225 
	`ªgi°î_i›‹t_ªad
(
addr
, 
size
, 2, 
i›‹t_ªad2
, 
s
);

2226 
	`ªgi°î_i›‹t_wrôe
(
addr
, 
size
, 4, 
i›‹t_wrôe4
, 
s
);

2227 
	`ªgi°î_i›‹t_ªad
(
addr
, 
size
, 4, 
i›‹t_ªad4
, 
s
);

2229 
s
->
ªgi⁄_ba£_addr
[
ªgi⁄_num
] = 
addr
;

2230 
	}
}

2233 
	#POLYNOMIAL
 0x04c11db6

	)

2234 
	$compuã_mˇ°_idx
(c⁄° 
uöt8_t
 *
ï
)

2236 
uöt32_t
 
¸c
;

2237 
ˇºy
, 
i
, 
j
;

2238 
uöt8_t
 
b
;

2240 
¸c
 = 0xffffffff;

2241 
i
 = 0; i < 6; i++) {

2242 
b
 = *
ï
++;

2243 
j
 = 0; j < 8; j++) {

2244 
ˇºy
 = ((
¸c
 & 0x80000000LË? 1 : 0Ë^ (
b
 & 0x01);

2245 
¸c
 <<= 1;

2246 
b
 >>= 1;

2247 i‡(
ˇºy
)

2248 
¸c
 = ((¸¯^ 
POLYNOMIAL
Ë| 
ˇºy
);

2251  (
¸c
 >> 26);

2252 
	}
}

2255 
	$e100_ˇn_ª˚ive
(*
›aque
)

2257 
E100Sèã
 *
s
 = 
›aque
;

2259 
is_ªady
 = (
GET_RU_STATE
 =
RU_READY
);

2260 
	`logout
("%s\n", 
is_ªady
 ? "EEPro100Ñeceiver isÑeady"

2262  
is_ªady
;

2263 
	}
}

2265 
	$e100_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 * 
buf
, 
size
)

2267 
E100Sèã
 *
s
 = 
›aque
;

2268 
uöt32_t
 
rfd_addr
 = 0;

2269 
rfd_t
 
rfd
 = {0};

2272 i‡–
GET_RU_STATE
 !
RU_READY
 )

2278 
rfd_addr
 = 
s
->
ru_ba£
 + s->
ru_off£t
;

2279 
	`˝u_physiˇl_mem‹y_ªad
(
rfd_addr
, (
uöt8_t
 *)&
rfd
, (
rfd_t
));

2281 i‡–(
size
 > 
MAX_ETH_FRAME_SIZE
+4) )

2285 
	`logout
("DisˇrdÜ⁄g føme(size=%d)\n", 
size
);

2289 i‡–!
	`memcmp
(
buf
, 
s
->
maˇddr
, (s->macaddr)) )

2292 
	`logout
("Re˚ivê®‰amêf‹ me(size=%d)\n", 
size
);

2293 
	`e100_dump
("FRAME:", (
uöt8_t
 *)
buf
, 
size
);

2295 i‡–!
	`memcmp
(
buf
, 
brﬂdˇ°_maˇddr
, (broadcast_macaddr)) )

2297 i‡–
s
->
c⁄fig
.
brﬂdˇ°_dis
 && !s->c⁄fig.
¥omiscuous
 )

2299 
	`logout
("Discardá broadcast frame\n");

2304 
rfd
.
°©us
 |
RX_IA_MATCH
;

2305 
	`logout
("Re˚ivê®brﬂdˇ° føme(size=%d)\n", 
size
);

2307 i‡–
s
->
is_mu…ˇ°_íabÀ
 && 
buf
[0] & 0x1 )

2309 
mˇ°_idx
 = 
	`compuã_mˇ°_idx
(
buf
);

2310 i‡–!(
s
->
mu…_li°
[
mˇ°_idx
 >> 3] & (1 << (mcast_idx & 7))) )

2312 
	`logout
("Multicastáddress mismatch, discard\n");

2315 
	`logout
("Re˚ivê®mu…iˇ° føme(size=%d)\n", 
size
);

2317 i‡–
size
 < 64 && (
s
->
c⁄fig
.
dis_sh‹t_rx
) )

2326 i‡–
s
->
c⁄fig
.
ßve_bad_‰ame
 )

2328 
rfd
.
°©us
 |
RX_SHORT
;

2329 
s
->
°©i°ics
.
rx_sh‹t_‰ame_îr‹s
 ++;

2331 
	`logout
("Re˚ivê®sh‹à‰ame(size=%d), disˇrd it\n", 
size
);

2334 i‡–
s
->
c⁄fig
.
¥omiscuous
 )

2337 
	`logout
("Re˚ived fømêöÖromiscuou†mode(size=%d)\n", 
size
);

2338 
rfd
.
°©us
 |
RX_NO_MATCH
;

2342 
	`e100_dump
("Unknow¿‰ame, MAC = ", (
uöt8_t
 *)
buf
, 6);

2345 
	`e100_dump
("Gë føme, MAC = ", (
uöt8_t
 *)
buf
, 6);

2347 
rfd
.
c
 = 1;

2348 
rfd
.
ok
 = 1;

2349 
rfd
.
f
 = 1;

2350 
rfd
.
eof
 = 1;

2351 
rfd
.
°©us
 &~
RX_COLLISION
;

2352 
rfd
.
cou¡
 = 
size
;

2354 
	`logout
("Getá RFD configure:\n"

2360 
rfd
.
°©us
,Ñfd.
ok
,Ñfd.
c
,Ñfd.
sf
,Ñfd.
h
,

2361 
rfd
.
s
,Ñfd.
ñ
,Ñfd.
lök_addr
,Ñfd.
cou¡
,

2362 
rfd
.
f
,Ñfd.
eof
,Ñfd.
size
);

2364 
	`˝u_physiˇl_mem‹y_wrôe
(
rfd_addr
, (
uöt8_t
 *)&
rfd
, (rfd));

2365 
	`˝u_physiˇl_mem‹y_wrôe
(
rfd_addr
 + (
rfd_t
), 
buf
, 
size
);

2366 
s
->
°©i°ics
.
rx_good_‰ames
 ++;

2367 
s
->
ru_off£t
 = 
	`À32_to_˝u
(
rfd
.
lök_addr
);

2369 
	`e100_öãºu±
(
s
, 
INT_FR
);

2371 i‡–
rfd
.
ñ
 ||Ñfd.
s
 )

2374 
	`SET_RU_STATE
(
RU_SUSPENDED
);

2375 
	`e100_öãºu±
(
s
, 
INT_RNR
);

2376 
	`logout
("RFD met S or EL bit set, RU goÅo suspend\n");

2380 
	`logout
("Com∂ëê®‰amêª˚ive(sizê%d)\n", 
size
);

2382 
	}
}

2384 
	$ì¥om_öô
(
E100Sèã
 *
s
)

2386 
i
;

2387 
chksum
 = 0;

2390 
	`ì¥om_ª£t
(
s
, 
EEPROM_RESET_ALL
);

2391 
s
->
ì¥om
.
addr_Àn
 = 
EEPROM_I82557_ADDRBIT
;

2392 
	`mem˝y
(
s
->
ì¥om
.
c⁄ã¡s
, 
ì¥om_i82557
, (eeprom_i82557));

2394 
	`mem˝y
((
uöt8_t
 *)
s
->
ì¥om
.
c⁄ã¡s
, s->
maˇddr
, (s->macaddr));

2400  
i
=0; i<(1<<
s
->
ì¥om
.
addr_Àn
)-1; i++ )

2401 
chksum
 +
s
->
ì¥om
.
c⁄ã¡s
[
i
];

2402 
s
->
ì¥om
.
c⁄ã¡s
[
i
] = 0xBABA - 
chksum
;

2404 
	}
}

2406 
	$e100_öô
(
PCIBus
 * 
bus
, 
NICInfo
 * 
nd
,

2407 c⁄° *
«me
, 
uöt32_t
 
devi˚
)

2409 
PCIE100Sèã
 *
d
;

2410 
E100Sèã
 *
s
;

2412 
	`logout
("\n");

2414 
d
 = (
PCIE100Sèã
 *Ë
	`pci_ªgi°î_devi˚
(
bus
, 
«me
,

2415 (
PCIE100Sèã
), -1,

2416 
NULL
, NULL);

2418 
s
 = &
d
->
e100
;

2419 
s
->
devi˚
 = device;

2420 
s
->
pci_dev
 = &
d
->
dev
;

2422 
	`pci_ª£t
(
s
);

2426 
d
->
e100
.
mmio_ödex
 =

2427 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_mmio_ªad
, 
pci_mmio_wrôe
, 
s
);

2430 
	`pci_ªgi°î_io_ªgi⁄
(&
d
->
dev
, 0, 
PCI_MEM_SIZE
,

2431 
PCI_ADDRESS_SPACE_MEM
 | 
PCI_ADDRESS_SPACE_MEM_PREFETCH
,

2432 
pci_mmio_m≠
);

2434 
	`pci_ªgi°î_io_ªgi⁄
(&
d
->
dev
, 1, 
PCI_IO_SIZE
, 
PCI_ADDRESS_SPACE_IO
,

2435 
pci_i›‹t_m≠
);

2437 
	`pci_ªgi°î_io_ªgi⁄
(&
d
->
dev
, 2, 
PCI_FLASH_SIZE
, 
PCI_ADDRESS_SPACE_MEM
,

2438 
pci_mmio_m≠
);

2440 
	`mem˝y
(
s
->
maˇddr
, 
nd
->macaddr, 6);

2441 
	`e100_dump
("MAC ADDR", (
uöt8_t
 *)&
s
->
maˇddr
[0], 6);

2443 
	`ì¥om_öô
(
s
);

2445 
	`e100_ª£t
(
s
);

2447 
s
->
vc
 = 
	`qemu_√w_vœn_˛õ¡
(
nd
->
vœn
, 
e100_ª˚ive
, 
e100_ˇn_ª˚ive
, s);

2449 
	`¢¥ötf
(
s
->
vc
->
öfo_°r
, (s->vc->info_str),

2451 
s
->
maˇddr
[0],

2452 
s
->
maˇddr
[1],

2453 
s
->
maˇddr
[2], s->macaddr[3], s->macaddr[4], s->macaddr[5]);

2455 
	`qemu_ªgi°î_ª£t
(
e100_ª£t
, 
s
);

2457 
	`ªgi°î_ßvevm
(
«me
, 0, 3, 
e100_ßve
, 
e100_lﬂd
, 
s
);

2458 
	}
}

2460 
	$pci_e100_öô
(
PCIBus
 * 
bus
, 
NICInfo
 * 
nd
)

2462 
	`e100_öô
(
bus
, 
nd
, "e100", 
i82557C
);

2463 
	}
}

	@es1370.c

27 
	#SILENT_ES1370


	)

29 
	~"vl.h
"

50 
	#ES1370_REG_CONTROL
 0x00

	)

51 
	#ES1370_REG_STATUS
 0x04

	)

52 
	#ES1370_REG_UART_DATA
 0x08

	)

53 
	#ES1370_REG_UART_STATUS
 0x09

	)

54 
	#ES1370_REG_UART_CONTROL
 0x09

	)

55 
	#ES1370_REG_UART_TEST
 0x0a

	)

56 
	#ES1370_REG_MEMPAGE
 0x0c

	)

57 
	#ES1370_REG_CODEC
 0x10

	)

58 
	#ES1370_REG_SERIAL_CONTROL
 0x20

	)

59 
	#ES1370_REG_DAC1_SCOUNT
 0x24

	)

60 
	#ES1370_REG_DAC2_SCOUNT
 0x28

	)

61 
	#ES1370_REG_ADC_SCOUNT
 0x2c

	)

63 
	#ES1370_REG_DAC1_FRAMEADR
 0xc30

	)

64 
	#ES1370_REG_DAC1_FRAMECNT
 0xc34

	)

65 
	#ES1370_REG_DAC2_FRAMEADR
 0xc38

	)

66 
	#ES1370_REG_DAC2_FRAMECNT
 0xc3c

	)

67 
	#ES1370_REG_ADC_FRAMEADR
 0xd30

	)

68 
	#ES1370_REG_ADC_FRAMECNT
 0xd34

	)

69 
	#ES1370_REG_PHANTOM_FRAMEADR
 0xd38

	)

70 
	#ES1370_REG_PHANTOM_FRAMECNT
 0xd3c

	)

72 c⁄° 
	gdac1_ßm∂î©e
[] = { 5512, 11025, 22050, 44100 };

74 
	#DAC2_SRTODIV
(
x
Ë(((1411200+(x)/2)/(x))-2)

	)

75 
	#DAC2_DIVTOSR
(
x
Ë(1411200/((x)+2))

	)

77 
	#CTRL_ADC_STOP
 0x80000000

	)

78 
	#CTRL_XCTL1
 0x40000000

	)

79 
	#CTRL_OPEN
 0x20000000

	)

80 
	#CTRL_PCLKDIV
 0x1fff0000

	)

81 
	#CTRL_SH_PCLKDIV
 16

	)

82 
	#CTRL_MSFMTSEL
 0x00008000

	)

83 
	#CTRL_M_SBB
 0x00004000

	)

84 
	#CTRL_WTSRSEL
 0x00003000

	)

85 
	#CTRL_SH_WTSRSEL
 12

	)

86 
	#CTRL_DAC_SYNC
 0x00000800

	)

87 
	#CTRL_CCB_INTRM
 0x00000400

	)

88 
	#CTRL_M_CB
 0x00000200

	)

89 
	#CTRL_XCTL0
 0x00000100

	)

90 
	#CTRL_BREQ
 0x00000080

	)

91 
	#CTRL_DAC1_EN
 0x00000040

	)

92 
	#CTRL_DAC2_EN
 0x00000020

	)

93 
	#CTRL_ADC_EN
 0x00000010

	)

94 
	#CTRL_UART_EN
 0x00000008

	)

95 
	#CTRL_JYSTK_EN
 0x00000004

	)

96 
	#CTRL_CDC_EN
 0x00000002

	)

97 
	#CTRL_SERR_DIS
 0x00000001

	)

99 
	#STAT_INTR
 0x80000000

	)

100 
	#STAT_CSTAT
 0x00000400

	)

101 
	#STAT_CBUSY
 0x00000200

	)

102 
	#STAT_CWRIP
 0x00000100

	)

103 
	#STAT_VC
 0x00000060

	)

104 
	#STAT_SH_VC
 5

	)

105 
	#STAT_MCCB
 0x00000010

	)

106 
	#STAT_UART
 0x00000008

	)

107 
	#STAT_DAC1
 0x00000004

	)

108 
	#STAT_DAC2
 0x00000002

	)

109 
	#STAT_ADC
 0x00000001

	)

111 
	#USTAT_RXINT
 0x80

	)

112 
	#USTAT_TXINT
 0x04

	)

113 
	#USTAT_TXRDY
 0x02

	)

114 
	#USTAT_RXRDY
 0x01

	)

116 
	#UCTRL_RXINTEN
 0x80

	)

117 
	#UCTRL_TXINTEN
 0x60

	)

118 
	#UCTRL_ENA_TXINT
 0x20

	)

119 
	#UCTRL_CNTRL
 0x03

	)

120 
	#UCTRL_CNTRL_SWR
 0x03

	)

122 
	#SCTRL_P2ENDINC
 0x00380000

	)

123 
	#SCTRL_SH_P2ENDINC
 19

	)

124 
	#SCTRL_P2STINC
 0x00070000

	)

125 
	#SCTRL_SH_P2STINC
 16

	)

126 
	#SCTRL_R1LOOPSEL
 0x00008000

	)

127 
	#SCTRL_P2LOOPSEL
 0x00004000

	)

128 
	#SCTRL_P1LOOPSEL
 0x00002000

	)

129 
	#SCTRL_P2PAUSE
 0x00001000

	)

130 
	#SCTRL_P1PAUSE
 0x00000800

	)

131 
	#SCTRL_R1INTEN
 0x00000400

	)

132 
	#SCTRL_P2INTEN
 0x00000200

	)

133 
	#SCTRL_P1INTEN
 0x00000100

	)

134 
	#SCTRL_P1SCTRLD
 0x00000080

	)

135 
	#SCTRL_P2DACSEN
 0x00000040

	)

136 
	#SCTRL_R1SEB
 0x00000020

	)

137 
	#SCTRL_R1SMB
 0x00000010

	)

138 
	#SCTRL_R1FMT
 0x00000030

	)

139 
	#SCTRL_SH_R1FMT
 4

	)

140 
	#SCTRL_P2SEB
 0x00000008

	)

141 
	#SCTRL_P2SMB
 0x00000004

	)

142 
	#SCTRL_P2FMT
 0x0000000¯

	)

143 
	#SCTRL_SH_P2FMT
 2

	)

144 
	#SCTRL_P1SEB
 0x00000002

	)

145 
	#SCTRL_P1SMB
 0x00000001

	)

146 
	#SCTRL_P1FMT
 0x00000003

	)

147 
	#SCTRL_SH_P1FMT
 0

	)

151 
	#NB_CHANNELS
 3

	)

152 
	#DAC1_CHANNEL
 0

	)

153 
	#DAC2_CHANNEL
 1

	)

154 
	#ADC_CHANNEL
 2

	)

156 
	#IO_READ_PROTO
(
n
) \

157 
uöt32_t
 
	`n
 (*
›aque
, uöt32_à
addr
)

	)

158 
	#IO_WRITE_PROTO
(
n
) \

159 
	`n
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

	)

161 
es1370_dac1_ˇŒback
 (*
›aque
, 
‰ì
);

162 
es1370_dac2_ˇŒback
 (*
›aque
, 
‰ì
);

163 
es1370_adc_ˇŒback
 (*
›aque
, 
avaû
);

165 #ifde‡
DEBUG_ES1370


167 
	#ldebug
(...Ë
	`AUD_log
 ("es1370", 
__VA_ARGS__
)

	)

169 
	$¥öt_˘l
 (
uöt32_t
 
vÆ
)

171 
buf
[1024];

173 
buf
[0] = '\0';

174 
	#a
(
n
Ëi‡(
vÆ
 & 
CTRL_
##nË
	`°rˇt
 (
buf
, " "#n)

	)

175 
	`a
 (
ADC_STOP
);

176 
	`a
 (
XCTL1
);

177 
	`a
 (
OPEN
);

178 
	`a
 (
MSFMTSEL
);

179 
	`a
 (
M_SBB
);

180 
	`a
 (
DAC_SYNC
);

181 
	`a
 (
CCB_INTRM
);

182 
	`a
 (
M_CB
);

183 
	`a
 (
XCTL0
);

184 
	`a
 (
BREQ
);

185 
	`a
 (
DAC1_EN
);

186 
	`a
 (
DAC2_EN
);

187 
	`a
 (
ADC_EN
);

188 
	`a
 (
UART_EN
);

189 
	`a
 (
JYSTK_EN
);

190 
	`a
 (
CDC_EN
);

191 
	`a
 (
SERR_DIS
);

192 #unde‡
a


193 
	`AUD_log
 ("es1370", "ctl - PCLKDIV %d(DAC2 freq %d), freq %d,%s\n",

194 (
vÆ
 & 
CTRL_PCLKDIV
Ë>> 
CTRL_SH_PCLKDIV
,

195 
	`DAC2_DIVTOSR
 ((
vÆ
 & 
CTRL_PCLKDIV
Ë>> 
CTRL_SH_PCLKDIV
),

196 
dac1_ßm∂î©e
[(
vÆ
 & 
CTRL_WTSRSEL
Ë>> 
CTRL_SH_WTSRSEL
],

197 
buf
);

198 
	}
}

200 
	$¥öt_s˘l
 (
uöt32_t
 
vÆ
)

202 c⁄° *
fmt_«mes
[] = {"8M", "8S", "16M", "16S"};

203 
buf
[1024];

205 
buf
[0] = '\0';

207 
	#a
(
n
Ëi‡(
vÆ
 & 
SCTRL_
##nË
	`°rˇt
 (
buf
, " "#n)

	)

208 
	#b
(
n
Ëi‡(!(
vÆ
 & 
SCTRL_
##n)Ë
	`°rˇt
 (
buf
, " "#n)

	)

209 
	`b
 (
R1LOOPSEL
);

210 
	`b
 (
P2LOOPSEL
);

211 
	`b
 (
P1LOOPSEL
);

212 
	`a
 (
P2PAUSE
);

213 
	`a
 (
P1PAUSE
);

214 
	`a
 (
R1INTEN
);

215 
	`a
 (
P2INTEN
);

216 
	`a
 (
P1INTEN
);

217 
	`a
 (
P1SCTRLD
);

218 
	`a
 (
P2DACSEN
);

219 i‡(
buf
[0]) {

220 
	`°rˇt
 (
buf
, "\n ");

223 
buf
[0] = ' ';

224 
buf
[1] = '\0';

226 #unde‡
b


227 #unde‡
a


228 
	`AUD_log
 ("es1370",

231 
buf
,

232 (
vÆ
 & 
SCTRL_P2ENDINC
Ë>> 
SCTRL_SH_P2ENDINC
,

233 (
vÆ
 & 
SCTRL_P2STINC
Ë>> 
SCTRL_SH_P2STINC
,

234 
fmt_«mes
 [(
vÆ
 >> 
SCTRL_SH_R1FMT
) & 3],

235 
fmt_«mes
 [(
vÆ
 >> 
SCTRL_SH_P2FMT
) & 3],

236 
fmt_«mes
 [(
vÆ
 >> 
SCTRL_SH_P1FMT
) & 3]

238 
	}
}

240 
	#ldebug
(...)

	)

241 
	#¥öt_˘l
(...)

	)

242 
	#¥öt_s˘l
(...)

	)

245 #ifde‡
VERBOSE_ES1370


246 
	#dﬁog
(...Ë
	`AUD_log
 ("es1370", 
__VA_ARGS__
)

	)

248 
	#dﬁog
(...)

	)

251 #i‚de‡
SILENT_ES1370


252 
	#lw¨n
(...Ë
	`AUD_log
 ("es1370: w¨nög", 
__VA_ARGS__
)

	)

254 
	#lw¨n
(...)

	)

257 
	sch™
 {

258 
uöt32_t
 
	mshi·
;

259 
uöt32_t
 
	mÀ·ovî
;

260 
uöt32_t
 
	mscou¡
;

261 
uöt32_t
 
	m‰ame_addr
;

262 
uöt32_t
 
	m‰ame_˙t
;

265 
	sES1370Sèã
 {

266 
PCIDevi˚
 *
	mpci_dev
;

268 
QEMUSoundC¨d
 
	mˇrd
;

269 
ch™
 
	mch™
[
NB_CHANNELS
];

270 
SWVoi˚Out
 *
	mdac_voi˚
[2];

271 
SWVoi˚In
 *
	madc_voi˚
;

273 
uöt32_t
 
	m˘l
;

274 
uöt32_t
 
	m°©us
;

275 
uöt32_t
 
	mmem∑ge
;

276 
uöt32_t
 
	mcodec
;

277 
uöt32_t
 
	ms˘l
;

278 } 
	tES1370Sèã
;

280 
	sPCIES1370Sèã
 {

281 
PCIDevi˚
 
	mdev
;

282 
ES1370Sèã
 
	mes1370
;

283 } 
	tPCIES1370Sèã
;

285 
	sch™_bôs
 {

286 
uöt32_t
 
	m˘l_í
;

287 
uöt32_t
 
	m°©_öt
;

288 
uöt32_t
 
	ms˘l_∑u£
;

289 
uöt32_t
 
	ms˘l_öãn
;

290 
uöt32_t
 
	ms˘l_fmt
;

291 
uöt32_t
 
	ms˘l_sh_fmt
;

292 
uöt32_t
 
	ms˘l_lo›£l
;

293 (*
	mˇlc_‰eq
Ë(
ES1370Sèã
 *
	ms
, 
uöt32_t
 
	m˘l
,

294 
uöt32_t
 *
	mﬁd_‰eq
, uöt32_à*
	m√w_‰eq
);

297 
es1370_dac1_ˇlc_‰eq
 (
ES1370Sèã
 *
s
, 
uöt32_t
 
˘l
,

298 
uöt32_t
 *
ﬁd_‰eq
, uöt32_à*
√w_‰eq
);

299 
es1370_dac2_™d_adc_ˇlc_‰eq
 (
ES1370Sèã
 *
s
, 
uöt32_t
 
˘l
,

300 
uöt32_t
 *
ﬁd_‰eq
,

301 
uöt32_t
 *
√w_‰eq
);

303 c⁄° 
ch™_bôs
 
	ges1370_ch™_bôs
[] = {

304 {
CTRL_DAC1_EN
, 
STAT_DAC1
, 
SCTRL_P1PAUSE
, 
SCTRL_P1INTEN
,

305 
SCTRL_P1FMT
, 
SCTRL_SH_P1FMT
, 
SCTRL_P1LOOPSEL
,

306 
es1370_dac1_ˇlc_‰eq
},

308 {
CTRL_DAC2_EN
, 
STAT_DAC2
, 
SCTRL_P2PAUSE
, 
SCTRL_P2INTEN
,

309 
SCTRL_P2FMT
, 
SCTRL_SH_P2FMT
, 
SCTRL_P2LOOPSEL
,

310 
es1370_dac2_™d_adc_ˇlc_‰eq
},

312 {
CTRL_ADC_EN
, 
STAT_ADC
, 0, 
SCTRL_R1INTEN
,

313 
SCTRL_R1FMT
, 
SCTRL_SH_R1FMT
, 
SCTRL_R1LOOPSEL
,

314 
es1370_dac2_™d_adc_ˇlc_‰eq
}

317 
	$es1370_upd©e_°©us
 (
ES1370Sèã
 *
s
, 
uöt32_t
 
√w_°©us
)

319 
uöt32_t
 
Àvñ
 = 
√w_°©us
 & (
STAT_DAC1
 | 
STAT_DAC2
 | 
STAT_ADC
);

321 i‡(
Àvñ
) {

322 
s
->
°©us
 = 
√w_°©us
 | 
STAT_INTR
;

325 
s
->
°©us
 = 
√w_°©us
 & ~
STAT_INTR
;

327 
	`pci_£t_úq
 (
s
->
pci_dev
, 0, !!
Àvñ
);

328 
	}
}

330 
	$es1370_ª£t
 (
ES1370Sèã
 *
s
)

332 
size_t
 
i
;

334 
s
->
˘l
 = 1;

335 
s
->
°©us
 = 0x60;

336 
s
->
mem∑ge
 = 0;

337 
s
->
codec
 = 0;

338 
s
->
s˘l
 = 0;

340 
i
 = 0; i < 
NB_CHANNELS
; ++i) {

341 
ch™
 *
d
 = &
s
->ch™[
i
];

342 
d
->
scou¡
 = 0;

343 
d
->
À·ovî
 = 0;

344 i‡(
i
 =
ADC_CHANNEL
) {

345 
	`AUD_˛o£_ö
 (&
s
->
ˇrd
, s->
adc_voi˚
);

346 
s
->
adc_voi˚
 = 
NULL
;

349 
	`AUD_˛o£_out
 (&
s
->
ˇrd
, s->
dac_voi˚
[
i
]);

350 
s
->
dac_voi˚
[
i
] = 
NULL
;

353 
	`pci_£t_úq
 (
s
->
pci_dev
, 0, 0);

354 
	}
}

356 
	$es1370_maybe_lowî_úq
 (
ES1370Sèã
 *
s
, 
uöt32_t
 
s˘l
)

358 
uöt32_t
 
√w_°©us
 = 
s
->
°©us
;

360 i‡(!(
s˘l
 & 
SCTRL_P1INTEN
Ë&& (
s
->sctl & SCTRL_P1INTEN)) {

361 
√w_°©us
 &~
STAT_DAC1
;

364 i‡(!(
s˘l
 & 
SCTRL_P2INTEN
Ë&& (
s
->sctl & SCTRL_P2INTEN)) {

365 
√w_°©us
 &~
STAT_DAC2
;

368 i‡(!(
s˘l
 & 
SCTRL_R1INTEN
Ë&& (
s
->sctl & SCTRL_R1INTEN)) {

369 
√w_°©us
 &~
STAT_ADC
;

372 i‡(
√w_°©us
 !
s
->
°©us
) {

373 
	`es1370_upd©e_°©us
 (
s
, 
√w_°©us
);

375 
	}
}

377 
	$es1370_dac1_ˇlc_‰eq
 (
ES1370Sèã
 *
s
, 
uöt32_t
 
˘l
,

378 
uöt32_t
 *
ﬁd_‰eq
, uöt32_à*
√w_‰eq
)

381 *
ﬁd_‰eq
 = 
dac1_ßm∂î©e
[(
s
->
˘l
 & 
CTRL_WTSRSEL
Ë>> 
CTRL_SH_WTSRSEL
];

382 *
√w_‰eq
 = 
dac1_ßm∂î©e
[(
˘l
 & 
CTRL_WTSRSEL
Ë>> 
CTRL_SH_WTSRSEL
];

383 
	}
}

385 
	$es1370_dac2_™d_adc_ˇlc_‰eq
 (
ES1370Sèã
 *
s
, 
uöt32_t
 
˘l
,

386 
uöt32_t
 *
ﬁd_‰eq
,

387 
uöt32_t
 *
√w_‰eq
)

390 
uöt32_t
 
ﬁd_p˛kdiv
, 
√w_p˛kdiv
;

392 
√w_p˛kdiv
 = (
˘l
 & 
CTRL_PCLKDIV
Ë>> 
CTRL_SH_PCLKDIV
;

393 
ﬁd_p˛kdiv
 = (
s
->
˘l
 & 
CTRL_PCLKDIV
Ë>> 
CTRL_SH_PCLKDIV
;

394 *
√w_‰eq
 = 
	`DAC2_DIVTOSR
 (
√w_p˛kdiv
);

395 *
ﬁd_‰eq
 = 
	`DAC2_DIVTOSR
 (
ﬁd_p˛kdiv
);

396 
	}
}

398 
	$es1370_upd©e_voi˚s
 (
ES1370Sèã
 *
s
, 
uöt32_t
 
˘l
, uöt32_à
s˘l
)

400 
size_t
 
i
;

401 
uöt32_t
 
ﬁd_‰eq
, 
√w_‰eq
, 
ﬁd_fmt
, 
√w_fmt
;

403 
i
 = 0; i < 
NB_CHANNELS
; ++i) {

404 
ch™
 *
d
 = &
s
->ch™[
i
];

405 c⁄° 
ch™_bôs
 *
b
 = &
es1370_ch™_bôs
[
i
];

407 
√w_fmt
 = (
s˘l
 & 
b
->
s˘l_fmt
Ë>> b->
s˘l_sh_fmt
;

408 
ﬁd_fmt
 = (
s
->
s˘l
 & 
b
->
s˘l_fmt
Ë>> b->
s˘l_sh_fmt
;

410 
b
->
	`ˇlc_‰eq
 (
s
, 
˘l
, &
ﬁd_‰eq
, &
√w_‰eq
);

412 i‡((
ﬁd_fmt
 !
√w_fmt
Ë|| (
ﬁd_‰eq
 !
√w_‰eq
)) {

413 
d
->
shi·
 = (
√w_fmt
 & 1) + (new_fmt >> 1);

414 
	`ldebug
 ("channel %d, freq = %d,Çchannels %d, fmt %d, shift %d\n",

415 
i
,

416 
√w_‰eq
,

417 1 << (
√w_fmt
 & 1),

418 (
√w_fmt
 & 2Ë? 
AUD_FMT_S16
 : 
AUD_FMT_U8
,

419 
d
->
shi·
);

420 i‡(
√w_‰eq
) {

421 
aud£âögs_t
 
as
;

423 
as
.
‰eq
 = 
√w_‰eq
;

424 
as
.
nch™√ls
 = 1 << (
√w_fmt
 & 1);

425 
as
.
fmt
 = (
√w_fmt
 & 2Ë? 
AUD_FMT_S16
 : 
AUD_FMT_U8
;

426 
as
.
ídü¬ess
 = 0;

428 i‡(
i
 =
ADC_CHANNEL
) {

429 
s
->
adc_voi˚
 =

430 
	`AUD_›í_ö
 (

431 &
s
->
ˇrd
,

432 
s
->
adc_voi˚
,

434 
s
,

435 
es1370_adc_ˇŒback
,

436 &
as


440 
s
->
dac_voi˚
[
i
] =

441 
	`AUD_›í_out
 (

442 &
s
->
ˇrd
,

443 
s
->
dac_voi˚
[
i
],

444 
i
 ? "es1370.dac2" : "es1370.dac1",

445 
s
,

446 
i
 ? 
es1370_dac2_ˇŒback
 : 
es1370_dac1_ˇŒback
,

447 &
as


453 i‡(((
˘l
 ^ 
s
->˘lË& 
b
->
˘l_í
)

454 || ((
s˘l
 ^ 
s
->s˘lË& 
b
->
s˘l_∑u£
)) {

455 
⁄
 = (
˘l
 & 
b
->
˘l_í
Ë&& !(
s˘l
 & b->
s˘l_∑u£
);

457 i‡(
i
 =
ADC_CHANNEL
) {

458 
	`AUD_£t_a˘ive_ö
 (
s
->
adc_voi˚
, 
⁄
);

461 
	`AUD_£t_a˘ive_out
 (
s
->
dac_voi˚
[
i
], 
⁄
);

466 
s
->
˘l
 = ctl;

467 
s
->
s˘l
 = sctl;

468 
	}
}

470 
ölöe
 
uöt32_t
 
	$es1370_fixup
 (
ES1370Sèã
 *
s
, 
uöt32_t
 
addr
)

472 
addr
 &= 0xff;

473 i‡(
addr
 >= 0x30 &&áddr <= 0x3f)

474 
addr
 |
s
->
mem∑ge
 << 8;

475  
addr
;

476 
	}
}

478 
	$IO_WRITE_PROTO
 (
es1370_wrôeb
)

480 
ES1370Sèã
 *
s
 = 
›aque
;

481 
uöt32_t
 
shi·
, 
mask
;

483 
addr
 = 
	`es1370_fixup
 (
s
,áddr);

485 
addr
) {

486 
ES1370_REG_CONTROL
:

487 
ES1370_REG_CONTROL
 + 1:

488 
ES1370_REG_CONTROL
 + 2:

489 
ES1370_REG_CONTROL
 + 3:

490 
shi·
 = (
addr
 - 
ES1370_REG_CONTROL
) << 3;

491 
mask
 = 0xf‡<< 
shi·
;

492 
vÆ
 = (
s
->
˘l
 & ~
mask
Ë| ((vÆ & 0xffË<< 
shi·
);

493 
	`es1370_upd©e_voi˚s
 (
s
, 
vÆ
, s->
s˘l
);

494 
	`¥öt_˘l
 (
vÆ
);

496 
ES1370_REG_MEMPAGE
:

497 
s
->
mem∑ge
 = 
vÆ
;

499 
ES1370_REG_SERIAL_CONTROL
:

500 
ES1370_REG_SERIAL_CONTROL
 + 1:

501 
ES1370_REG_SERIAL_CONTROL
 + 2:

502 
ES1370_REG_SERIAL_CONTROL
 + 3:

503 
shi·
 = (
addr
 - 
ES1370_REG_SERIAL_CONTROL
) << 3;

504 
mask
 = 0xf‡<< 
shi·
;

505 
vÆ
 = (
s
->
s˘l
 & ~
mask
Ë| ((vÆ & 0xffË<< 
shi·
);

506 
	`es1370_maybe_lowî_úq
 (
s
, 
vÆ
);

507 
	`es1370_upd©e_voi˚s
 (
s
, s->
˘l
, 
vÆ
);

508 
	`¥öt_s˘l
 (
vÆ
);

511 
	`lw¨n
 ("wrôeb %#x <- %#x\n", 
addr
, 
vÆ
);

514 
	}
}

516 
	$IO_WRITE_PROTO
 (
es1370_wrôew
)

518 
ES1370Sèã
 *
s
 = 
›aque
;

519 
addr
 = 
	`es1370_fixup
 (
s
,áddr);

520 
uöt32_t
 
shi·
, 
mask
;

521 
ch™
 *
d
 = &
s
->chan[0];

523 
addr
) {

524 
ES1370_REG_CODEC
:

525 
	`dﬁog
 ("ignored codec writeáddress %#x, data %#x\n",

526 (
vÆ
 >> 8) & 0xff, val & 0xff);

527 
s
->
codec
 = 
vÆ
;

530 
ES1370_REG_CONTROL
:

531 
ES1370_REG_CONTROL
 + 2:

532 
shi·
 = (
addr
 !
ES1370_REG_CONTROL
) << 4;

533 
mask
 = 0xfff‡<< 
shi·
;

534 
vÆ
 = (
s
->
˘l
 & ~
mask
Ë| ((vÆ & 0xffffË<< 
shi·
);

535 
	`es1370_upd©e_voi˚s
 (
s
, 
vÆ
, s->
s˘l
);

536 
	`¥öt_˘l
 (
vÆ
);

539 
ES1370_REG_ADC_SCOUNT
:

540 
d
++;

541 
ES1370_REG_DAC2_SCOUNT
:

542 
d
++;

543 
ES1370_REG_DAC1_SCOUNT
:

544 
d
->
scou¡
 = (d->scou¡ & ~0xffffË| (
vÆ
 & 0xffff);

548 
	`lw¨n
 ("wrôew %#x <- %#x\n", 
addr
, 
vÆ
);

551 
	}
}

553 
	$IO_WRITE_PROTO
 (
es1370_wrôñ
)

555 
ES1370Sèã
 *
s
 = 
›aque
;

556 
ch™
 *
d
 = &
s
->chan[0];

558 
addr
 = 
	`es1370_fixup
 (
s
,áddr);

560 
addr
) {

561 
ES1370_REG_CONTROL
:

562 
	`es1370_upd©e_voi˚s
 (
s
, 
vÆ
, s->
s˘l
);

563 
	`¥öt_˘l
 (
vÆ
);

566 
ES1370_REG_MEMPAGE
:

567 
s
->
mem∑ge
 = 
vÆ
 & 0xf;

570 
ES1370_REG_SERIAL_CONTROL
:

571 
	`es1370_maybe_lowî_úq
 (
s
, 
vÆ
);

572 
	`es1370_upd©e_voi˚s
 (
s
, s->
˘l
, 
vÆ
);

573 
	`¥öt_s˘l
 (
vÆ
);

576 
ES1370_REG_ADC_SCOUNT
:

577 
d
++;

578 
ES1370_REG_DAC2_SCOUNT
:

579 
d
++;

580 
ES1370_REG_DAC1_SCOUNT
:

581 
d
->
scou¡
 = (
vÆ
 & 0xffff) | (d->scount & ~0xffff);

582 
	`ldebug
 ("chan %d CURR_SAMP_CT %d, SAMP_CT %d\n",

583 
d
 - &
s
->
ch™
[0], 
vÆ
 >> 16, (val & 0xffff));

586 
ES1370_REG_ADC_FRAMEADR
:

587 
d
++;

588 
ES1370_REG_DAC2_FRAMEADR
:

589 
d
++;

590 
ES1370_REG_DAC1_FRAMEADR
:

591 
d
->
‰ame_addr
 = 
vÆ
;

592 
	`ldebug
 ("ch™ %d fømêaddªs†%#x\n", 
d
 - &
s
->
ch™
[0], 
vÆ
);

595 
ES1370_REG_PHANTOM_FRAMECNT
:

596 
	`lw¨n
 ("wrôögÅÿph™tom fømêcou¡ %#x\n", 
vÆ
);

598 
ES1370_REG_PHANTOM_FRAMEADR
:

599 
	`lw¨n
 ("wrôögÅÿph™tom fømêaddªs†%#x\n", 
vÆ
);

602 
ES1370_REG_ADC_FRAMECNT
:

603 
d
++;

604 
ES1370_REG_DAC2_FRAMECNT
:

605 
d
++;

606 
ES1370_REG_DAC1_FRAMECNT
:

607 
d
->
‰ame_˙t
 = 
vÆ
;

608 
d
->
À·ovî
 = 0;

609 
	`ldebug
 ("chan %d frame count %d, buffer size %d\n",

610 
d
 - &
s
->
ch™
[0], 
vÆ
 >> 16, val & 0xffff);

614 
	`lw¨n
 ("wrôñ %#x <- %#x\n", 
addr
, 
vÆ
);

617 
	}
}

619 
	$IO_READ_PROTO
 (
es1370_ªadb
)

621 
ES1370Sèã
 *
s
 = 
›aque
;

622 
uöt32_t
 
vÆ
;

624 
addr
 = 
	`es1370_fixup
 (
s
,áddr);

626 
addr
) {

628 
	`lw¨n
 ("AttemptÅoÑead fromÜegacyÑegister\n");

629 
vÆ
 = 5;

631 
ES1370_REG_MEMPAGE
:

632 
vÆ
 = 
s
->
mem∑ge
;

634 
ES1370_REG_CONTROL
 + 0:

635 
ES1370_REG_CONTROL
 + 1:

636 
ES1370_REG_CONTROL
 + 2:

637 
ES1370_REG_CONTROL
 + 3:

638 
vÆ
 = 
s
->
˘l
 >> ((
addr
 - 
ES1370_REG_CONTROL
) << 3);

640 
ES1370_REG_STATUS
 + 0:

641 
ES1370_REG_STATUS
 + 1:

642 
ES1370_REG_STATUS
 + 2:

643 
ES1370_REG_STATUS
 + 3:

644 
vÆ
 = 
s
->
°©us
 >> ((
addr
 - 
ES1370_REG_STATUS
) << 3);

647 
vÆ
 = ~0;

648 
	`lw¨n
 ("ªadb %#x -> %#x\n", 
addr
, 
vÆ
);

651  
vÆ
;

652 
	}
}

654 
	$IO_READ_PROTO
 (
es1370_ªadw
)

656 
ES1370Sèã
 *
s
 = 
›aque
;

657 
ch™
 *
d
 = &
s
->chan[0];

658 
uöt32_t
 
vÆ
;

660 
addr
 = 
	`es1370_fixup
 (
s
,áddr);

662 
addr
) {

663 
ES1370_REG_ADC_SCOUNT
 + 2:

664 
d
++;

665 
ES1370_REG_DAC2_SCOUNT
 + 2:

666 
d
++;

667 
ES1370_REG_DAC1_SCOUNT
 + 2:

668 
vÆ
 = 
d
->
scou¡
 >> 16;

671 
ES1370_REG_ADC_FRAMECNT
:

672 
d
++;

673 
ES1370_REG_DAC2_FRAMECNT
:

674 
d
++;

675 
ES1370_REG_DAC1_FRAMECNT
:

676 
vÆ
 = 
d
->
‰ame_˙t
 & 0xffff;

679 
ES1370_REG_ADC_FRAMECNT
 + 2:

680 
d
++;

681 
ES1370_REG_DAC2_FRAMECNT
 + 2:

682 
d
++;

683 
ES1370_REG_DAC1_FRAMECNT
 + 2:

684 
vÆ
 = 
d
->
‰ame_˙t
 >> 16;

688 
vÆ
 = ~0;

689 
	`lw¨n
 ("ªadw %#x -> %#x\n", 
addr
, 
vÆ
);

693  
vÆ
;

694 
	}
}

696 
	$IO_READ_PROTO
 (
es1370_ªadl
)

698 
ES1370Sèã
 *
s
 = 
›aque
;

699 
uöt32_t
 
vÆ
;

700 
ch™
 *
d
 = &
s
->chan[0];

702 
addr
 = 
	`es1370_fixup
 (
s
,áddr);

704 
addr
) {

705 
ES1370_REG_CONTROL
:

706 
vÆ
 = 
s
->
˘l
;

708 
ES1370_REG_STATUS
:

709 
vÆ
 = 
s
->
°©us
;

711 
ES1370_REG_MEMPAGE
:

712 
vÆ
 = 
s
->
mem∑ge
;

714 
ES1370_REG_CODEC
:

715 
vÆ
 = 
s
->
codec
;

717 
ES1370_REG_SERIAL_CONTROL
:

718 
vÆ
 = 
s
->
s˘l
;

721 
ES1370_REG_ADC_SCOUNT
:

722 
d
++;

723 
ES1370_REG_DAC2_SCOUNT
:

724 
d
++;

725 
ES1370_REG_DAC1_SCOUNT
:

726 
vÆ
 = 
d
->
scou¡
;

727 #ifde‡
DEBUG_ES1370


729 
uöt32_t
 
cuº_cou¡
 = 
d
->
scou¡
 >> 16;

730 
uöt32_t
 
cou¡
 = 
d
->
scou¡
 & 0xffff;

732 
cuº_cou¡
 <<
d
->
shi·
;

733 
cou¡
 <<
d
->
shi·
;

734 
	`dﬁog
 ("ªad scou¡ cuº %d,ÅŸÆ %d\n", 
cuº_cou¡
, 
cou¡
);

739 
ES1370_REG_ADC_FRAMECNT
:

740 
d
++;

741 
ES1370_REG_DAC2_FRAMECNT
:

742 
d
++;

743 
ES1370_REG_DAC1_FRAMECNT
:

744 
vÆ
 = 
d
->
‰ame_˙t
;

745 #ifde‡
DEBUG_ES1370


747 
uöt32_t
 
size
 = ((
d
->
‰ame_˙t
 & 0xffff) + 1) << 2;

748 
uöt32_t
 
cuº
 = ((
d
->
‰ame_˙t
 >> 16) + 1) << 2;

749 i‡(
cuº
 > 
size
)

750 
	`dﬁog
 ("ªad føme˙àcuº %d, sizê%d %d\n", 
cuº
, 
size
,

751 
cuº
 > 
size
);

756 
ES1370_REG_ADC_FRAMEADR
:

757 
d
++;

758 
ES1370_REG_DAC2_FRAMEADR
:

759 
d
++;

760 
ES1370_REG_DAC1_FRAMEADR
:

761 
vÆ
 = 
d
->
‰ame_addr
;

764 
ES1370_REG_PHANTOM_FRAMECNT
:

765 
vÆ
 = ~0U;

766 
	`lw¨n
 ("reading fromÖhantom frame count\n");

768 
ES1370_REG_PHANTOM_FRAMEADR
:

769 
vÆ
 = ~0U;

770 
	`lw¨n
 ("reading fromÖhantom frameáddress\n");

774 
vÆ
 = ~0U;

775 
	`lw¨n
 ("ªad»%#x -> %#x\n", 
addr
, 
vÆ
);

778  
vÆ
;

779 
	}
}

782 
	$es1370_å™s„r_audio
 (
ES1370Sèã
 *
s
, 
ch™
 *
d
, 
lo›_£l
,

783 
max
, *
úq
)

785 
uöt8_t
 
tmpbuf
[4096];

786 
uöt32_t
 
addr
 = 
d
->
‰ame_addr
;

787 
sc
 = 
d
->
scou¡
 & 0xffff;

788 
csc
 = 
d
->
scou¡
 >> 16;

789 
csc_byãs
 = (
csc
 + 1Ë<< 
d
->
shi·
;

790 
˙t
 = 
d
->
‰ame_˙t
 >> 16;

791 
size
 = 
d
->
‰ame_˙t
 & 0xffff;

792 
À·
 = ((
size
 - 
˙t
 + 1Ë<< 2Ë+ 
d
->
À·ovî
;

793 
å™s„ªd
 = 0;

794 
ãmp
 = 
	`audio_MIN
 (
max
,áudio_MIN (
À·
, 
csc_byãs
));

795 
ödex
 = 
d
 - &
s
->
ch™
[0];

797 
addr
 +(
˙t
 << 2Ë+ 
d
->
À·ovî
;

799 i‡(
ödex
 =
ADC_CHANNEL
) {

800 
ãmp
) {

801 
acquúed
, 
to_c›y
;

803 
to_c›y
 = 
	`audio_MIN
 ((
size_t
Ë
ãmp
,  (
tmpbuf
));

804 
acquúed
 = 
	`AUD_ªad
 (
s
->
adc_voi˚
, 
tmpbuf
, 
to_c›y
);

805 i‡(!
acquúed
)

808 
	`˝u_physiˇl_mem‹y_wrôe
 (
addr
, 
tmpbuf
, 
acquúed
);

810 
ãmp
 -
acquúed
;

811 
addr
 +
acquúed
;

812 
å™s„ªd
 +
acquúed
;

816 
SWVoi˚Out
 *
voi˚
 = 
s
->
dac_voi˚
[
ödex
];

818 
ãmp
) {

819 
c›õd
, 
to_c›y
;

821 
to_c›y
 = 
	`audio_MIN
 ((
size_t
Ë
ãmp
,  (
tmpbuf
));

822 
	`˝u_physiˇl_mem‹y_ªad
 (
addr
, 
tmpbuf
, 
to_c›y
);

823 
c›õd
 = 
	`AUD_wrôe
 (
voi˚
, 
tmpbuf
, 
to_c›y
);

824 i‡(!
c›õd
)

826 
ãmp
 -
c›õd
;

827 
addr
 +
c›õd
;

828 
å™s„ªd
 +
c›õd
;

832 i‡(
csc_byãs
 =
å™s„ªd
) {

833 *
úq
 = 1;

834 
d
->
scou¡
 = 
sc
 | (sc << 16);

835 
	`ldebug
 ("sc = %d,Ñate = %f\n",

836 (
sc
 + 1Ë<< 
d
->
shi·
,

837 (
sc
 + 1) / () 44100);

840 *
úq
 = 0;

841 
d
->
scou¡
 = 
sc
 | (((
csc_byãs
 - 
å™s„ªd
 - 1Ë>> d->
shi·
) << 16);

844 
˙t
 +(
å™s„ªd
 + 
d
->
À·ovî
) >> 2;

846 i‡(
s
->
s˘l
 & 
lo›_£l
) {

849 
	`AUD_log
 ("es1370: warning", "nonÜooping mode\n");

852 
d
->
‰ame_˙t
 = 
size
;

854 i‡((
uöt32_t
Ë
˙t
 <
d
->
‰ame_˙t
)

855 
d
->
‰ame_˙t
 |
˙t
 << 16;

858 
d
->
À·ovî
 = (
å™s„ªd
 + d->leftover) & 3;

859 
	}
}

861 
	$es1370_run_ch™√l
 (
ES1370Sèã
 *
s
, 
size_t
 
ch™
, 
‰ì_‹_avaû
)

863 
uöt32_t
 
√w_°©us
 = 
s
->
°©us
;

864 
max_byãs
, 
úq
;

865 
ch™
 *
d
 = &
s
->chan[chan];

866 c⁄° 
ch™_bôs
 *
b
 = &
es1370_ch™_bôs
[
ch™
];

868 i‡(!(
s
->
˘l
 & 
b
->
˘l_í
Ë|| (s->
s˘l
 & b->
s˘l_∑u£
)) {

872 
max_byãs
 = 
‰ì_‹_avaû
;

873 
max_byãs
 &~((1 << 
d
->
shi·
) - 1);

874 i‡(!
max_byãs
) {

878 
	`es1370_å™s„r_audio
 (
s
, 
d
, 
b
->
s˘l_lo›£l
, 
max_byãs
, &
úq
);

880 i‡(
úq
) {

881 i‡(
s
->
s˘l
 & 
b
->
s˘l_öãn
) {

882 
√w_°©us
 |
b
->
°©_öt
;

886 i‡(
√w_°©us
 !
s
->
°©us
) {

887 
	`es1370_upd©e_°©us
 (
s
, 
√w_°©us
);

889 
	}
}

891 
	$es1370_dac1_ˇŒback
 (*
›aque
, 
‰ì
)

893 
ES1370Sèã
 *
s
 = 
›aque
;

895 
	`es1370_run_ch™√l
 (
s
, 
DAC1_CHANNEL
, 
‰ì
);

896 
	}
}

898 
	$es1370_dac2_ˇŒback
 (*
›aque
, 
‰ì
)

900 
ES1370Sèã
 *
s
 = 
›aque
;

902 
	`es1370_run_ch™√l
 (
s
, 
DAC2_CHANNEL
, 
‰ì
);

903 
	}
}

905 
	$es1370_adc_ˇŒback
 (*
›aque
, 
avaû
)

907 
ES1370Sèã
 *
s
 = 
›aque
;

909 
	`es1370_run_ch™√l
 (
s
, 
ADC_CHANNEL
, 
avaû
);

910 
	}
}

912 
	$es1370_m≠
 (
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

913 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

915 
PCIES1370Sèã
 *
d
 = (PCIES1370Sèã *Ë
pci_dev
;

916 
ES1370Sèã
 *
s
 = &
d
->
es1370
;

918 (Ë
ªgi⁄_num
;

919 (Ë
size
;

920 (Ë
ty≥
;

922 
	`ªgi°î_i›‹t_wrôe
 (
addr
, 0x40 * 4, 1, 
es1370_wrôeb
, 
s
);

923 
	`ªgi°î_i›‹t_wrôe
 (
addr
, 0x40 * 2, 2, 
es1370_wrôew
, 
s
);

924 
	`ªgi°î_i›‹t_wrôe
 (
addr
, 0x40, 4, 
es1370_wrôñ
, 
s
);

926 
	`ªgi°î_i›‹t_ªad
 (
addr
, 0x40 * 4, 1, 
es1370_ªadb
, 
s
);

927 
	`ªgi°î_i›‹t_ªad
 (
addr
, 0x40 * 2, 2, 
es1370_ªadw
, 
s
);

928 
	`ªgi°î_i›‹t_ªad
 (
addr
, 0x40, 4, 
es1370_ªadl
, 
s
);

929 
	}
}

931 
	$es1370_ßve
 (
QEMUFûe
 *
f
, *
›aque
)

933 
ES1370Sèã
 *
s
 = 
›aque
;

934 
size_t
 
i
;

936 
i
 = 0; i < 
NB_CHANNELS
; ++i) {

937 
ch™
 *
d
 = &
s
->ch™[
i
];

938 
	`qemu_put_be32s
 (
f
, &
d
->
shi·
);

939 
	`qemu_put_be32s
 (
f
, &
d
->
À·ovî
);

940 
	`qemu_put_be32s
 (
f
, &
d
->
scou¡
);

941 
	`qemu_put_be32s
 (
f
, &
d
->
‰ame_addr
);

942 
	`qemu_put_be32s
 (
f
, &
d
->
‰ame_˙t
);

944 
	`qemu_put_be32s
 (
f
, &
s
->
˘l
);

945 
	`qemu_put_be32s
 (
f
, &
s
->
°©us
);

946 
	`qemu_put_be32s
 (
f
, &
s
->
mem∑ge
);

947 
	`qemu_put_be32s
 (
f
, &
s
->
codec
);

948 
	`qemu_put_be32s
 (
f
, &
s
->
s˘l
);

949 
	}
}

951 
	$es1370_lﬂd
 (
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

953 
uöt32_t
 
˘l
, 
s˘l
;

954 
ES1370Sèã
 *
s
 = 
›aque
;

955 
size_t
 
i
;

957 i‡(
vîsi⁄_id
 != 1)

958  -
EINVAL
;

960 
i
 = 0; i < 
NB_CHANNELS
; ++i) {

961 
ch™
 *
d
 = &
s
->ch™[
i
];

962 
	`qemu_gë_be32s
 (
f
, &
d
->
shi·
);

963 
	`qemu_gë_be32s
 (
f
, &
d
->
À·ovî
);

964 
	`qemu_gë_be32s
 (
f
, &
d
->
scou¡
);

965 
	`qemu_gë_be32s
 (
f
, &
d
->
‰ame_addr
);

966 
	`qemu_gë_be32s
 (
f
, &
d
->
‰ame_˙t
);

967 i‡(
i
 =
ADC_CHANNEL
) {

968 i‡(
s
->
adc_voi˚
) {

969 
	`AUD_˛o£_ö
 (&
s
->
ˇrd
, s->
adc_voi˚
);

970 
s
->
adc_voi˚
 = 
NULL
;

974 i‡(
s
->
dac_voi˚
[
i
]) {

975 
	`AUD_˛o£_out
 (&
s
->
ˇrd
, s->
dac_voi˚
[
i
]);

976 
s
->
dac_voi˚
[
i
] = 
NULL
;

981 
	`qemu_gë_be32s
 (
f
, &
˘l
);

982 
	`qemu_gë_be32s
 (
f
, &
s
->
°©us
);

983 
	`qemu_gë_be32s
 (
f
, &
s
->
mem∑ge
);

984 
	`qemu_gë_be32s
 (
f
, &
s
->
codec
);

985 
	`qemu_gë_be32s
 (
f
, &
s˘l
);

987 
s
->
˘l
 = 0;

988 
s
->
s˘l
 = 0;

989 
	`es1370_upd©e_voi˚s
 (
s
, 
˘l
, 
s˘l
);

991 
	}
}

993 
	$es1370_⁄_ª£t
 (*
›aque
)

995 
ES1370Sèã
 *
s
 = 
›aque
;

996 
	`es1370_ª£t
 (
s
);

997 
	}
}

999 
	$es1370_öô
 (
PCIBus
 *
bus
, 
AudioSèã
 *
audio
)

1001 
PCIES1370Sèã
 *
d
;

1002 
ES1370Sèã
 *
s
;

1003 
uöt8_t
 *
c
;

1005 i‡(!
bus
) {

1006 
	`dﬁog
 ("No PCI bus\n");

1010 i‡(!
audio
) {

1011 
	`dﬁog
 ("Noáudio state\n");

1015 
d
 = (
PCIES1370Sèã
 *Ë
	`pci_ªgi°î_devi˚
 (
bus
, "ES1370",

1016  (
PCIES1370Sèã
),

1017 -1, 
NULL
, NULL);

1019 i‡(!
d
) {

1020 
	`AUD_log
 (
NULL
, "FailedÅoÑegister PCI device for ES1370\n");

1024 
c
 = 
d
->
dev
.
c⁄fig
;

1025 
c
[0x00] = 0x74;

1026 
c
[0x01] = 0x12;

1027 
c
[0x02] = 0x00;

1028 
c
[0x03] = 0x50;

1029 
c
[0x07] = 2 << 1;

1030 
c
[0x0a] = 0x01;

1031 
c
[0x0b] = 0x04;

1034 
c
[0x2c] = 0x42;

1035 
c
[0x2d] = 0x49;

1036 
c
[0x2e] = 0x4c;

1037 
c
[0x2f] = 0x4c;

1039 
c
[0x2c] = 0x74;

1040 
c
[0x2d] = 0x12;

1041 
c
[0x2e] = 0x71;

1042 
c
[0x2f] = 0x13;

1043 
c
[0x34] = 0xdc;

1044 
c
[0x3c] = 10;

1045 
c
[0xdc] = 0x00;

1048 
c
[0x3d] = 1;

1049 
c
[0x3e] = 0x0c;

1050 
c
[0x3f] = 0x80;

1052 
s
 = &
d
->
es1370
;

1053 
s
->
pci_dev
 = &
d
->
dev
;

1055 
	`pci_ªgi°î_io_ªgi⁄
 (&
d
->
dev
, 0, 256, 
PCI_ADDRESS_SPACE_IO
, 
es1370_m≠
);

1056 
	`ªgi°î_ßvevm
 ("es1370", 0, 1, 
es1370_ßve
, 
es1370_lﬂd
, 
s
);

1057 
	`qemu_ªgi°î_ª£t
 (
es1370_⁄_ª£t
, 
s
);

1059 
	`AUD_ªgi°î_ˇrd
 (
audio
, "es1370", &
s
->
ˇrd
);

1060 
	`es1370_ª£t
 (
s
);

1062 
	}
}

	@esp.c

24 
	~"vl.h
"

37 #ifde‡
DEBUG_ESP


38 
	#DPRINTF
(
fmt
, 
¨gs
...) \

39 dÿ{ 
	`¥ötf
("ESP: " 
fmt
 , ##
¨gs
); } 0)

	)

41 
	#DPRINTF
(
fmt
, 
¨gs
...)

	)

44 
	#ESP_MAXREG
 0x3f

	)

45 
	#TI_BUFSZ
 32

	)

47 
	#ESP_MAX_DEVS
 7

	)

49 
ESPSèã
 
	tESPSèã
;

51 
	sESPSèã
 {

52 
BlockDrivîSèã
 **
	mbd
;

53 
uöt8_t
 
	mºegs
[
ESP_MAXREG
];

54 
uöt8_t
 
	mwªgs
[
ESP_MAXREG
];

55 
öt32_t
 
	mti_size
;

56 
uöt32_t
 
	mti_Ωå
, 
	mti_w±r
;

57 
uöt8_t
 
	mti_buf
[
TI_BUFSZ
];

58 
	m£n£
;

59 
	mdma
;

60 
SCSIDevi˚
 *
	mscsi_dev
[
MAX_DISKS
];

61 
SCSIDevi˚
 *
	mcuºít_dev
;

62 
uöt8_t
 
	mcmdbuf
[
TI_BUFSZ
];

63 
	mcmdÀn
;

64 
	mdo_cmd
;

67 
uöt32_t
 
	mdma_À·
;

70 
uöt32_t
 
	mdma_cou¡î
;

71 
uöt8_t
 *
	masync_buf
;

72 
uöt32_t
 
	masync_Àn
;

73 *
	mdma_›aque
;

76 
	#STAT_DO
 0x00

	)

77 
	#STAT_DI
 0x01

	)

78 
	#STAT_CD
 0x02

	)

79 
	#STAT_ST
 0x03

	)

80 
	#STAT_MI
 0x06

	)

81 
	#STAT_MO
 0x07

	)

83 
	#STAT_TC
 0x10

	)

84 
	#STAT_PE
 0x20

	)

85 
	#STAT_GE
 0x40

	)

86 
	#STAT_IN
 0x80

	)

88 
	#INTR_FC
 0x08

	)

89 
	#INTR_BS
 0x10

	)

90 
	#INTR_DC
 0x20

	)

91 
	#INTR_RST
 0x80

	)

93 
	#SEQ_0
 0x0

	)

94 
	#SEQ_CD
 0x4

	)

96 
	$gë_cmd
(
ESPSèã
 *
s
, 
uöt8_t
 *
buf
)

98 
uöt32_t
 
dmÆí
;

99 
èrgë
;

101 
dmÆí
 = 
s
->
ºegs
[0] | (s->rregs[1] << 8);

102 
èrgë
 = 
s
->
wªgs
[4] & 7;

103 
	`DPRINTF
("gë_cmd:Üí %dÅ¨gë %d\n", 
dmÆí
, 
èrgë
);

104 i‡(
s
->
dma
) {

105 
	`e•dma_mem‹y_ªad
(
s
->
dma_›aque
, 
buf
, 
dmÆí
);

107 
buf
[0] = 0;

108 
	`mem˝y
(&
buf
[1], 
s
->
ti_buf
, 
dmÆí
);

109 
dmÆí
++;

112 
s
->
ti_size
 = 0;

113 
s
->
ti_Ωå
 = 0;

114 
s
->
ti_w±r
 = 0;

116 i‡(
s
->
cuºít_dev
) {

118 
	`scsi_ˇn˚l_io
(
s
->
cuºít_dev
, 0);

119 
s
->
async_Àn
 = 0;

122 i‡(
èrgë
 >
MAX_DISKS
 || !
s
->
scsi_dev
[target]) {

124 
s
->
ºegs
[4] = 
STAT_IN
;

125 
s
->
ºegs
[5] = 
INTR_DC
;

126 
s
->
ºegs
[6] = 
SEQ_0
;

127 
	`e•dma_øi£_úq
(
s
->
dma_›aque
);

130 
s
->
cuºít_dev
 = s->
scsi_dev
[
èrgë
];

131  
dmÆí
;

132 
	}
}

134 
	$do_cmd
(
ESPSèã
 *
s
, 
uöt8_t
 *
buf
)

136 
öt32_t
 
d©Æí
;

137 
lun
;

139 
	`DPRINTF
("do_cmd: busid 0x%x\n", 
buf
[0]);

140 
lun
 = 
buf
[0] & 7;

141 
d©Æí
 = 
	`scsi_£nd_comm™d
(
s
->
cuºít_dev
, 0, &
buf
[1], 
lun
);

142 
s
->
ti_size
 = 
d©Æí
;

143 i‡(
d©Æí
 != 0) {

144 
s
->
ºegs
[4] = 
STAT_IN
 | 
STAT_TC
;

145 
s
->
dma_À·
 = 0;

146 
s
->
dma_cou¡î
 = 0;

147 i‡(
d©Æí
 > 0) {

148 
s
->
ºegs
[4] |
STAT_DI
;

149 
	`scsi_ªad_d©a
(
s
->
cuºít_dev
, 0);

151 
s
->
ºegs
[4] |
STAT_DO
;

152 
	`scsi_wrôe_d©a
(
s
->
cuºít_dev
, 0);

155 
s
->
ºegs
[5] = 
INTR_BS
 | 
INTR_FC
;

156 
s
->
ºegs
[6] = 
SEQ_CD
;

157 
	`e•dma_øi£_úq
(
s
->
dma_›aque
);

158 
	}
}

160 
	$h™dÀ_ßä
(
ESPSèã
 *
s
)

162 
uöt8_t
 
buf
[32];

163 
Àn
;

165 
Àn
 = 
	`gë_cmd
(
s
, 
buf
);

166 i‡(
Àn
)

167 
	`do_cmd
(
s
, 
buf
);

168 
	}
}

170 
	$h™dÀ_ßä_°›
(
ESPSèã
 *
s
)

172 
s
->
cmdÀn
 = 
	`gë_cmd
(s, s->
cmdbuf
);

173 i‡(
s
->
cmdÀn
) {

174 
	`DPRINTF
("Së ATN & St›: cmdÀ¿%d\n", 
s
->
cmdÀn
);

175 
s
->
do_cmd
 = 1;

176 
s
->
ºegs
[4] = 
STAT_IN
 | 
STAT_TC
 | 
STAT_CD
;

177 
s
->
ºegs
[5] = 
INTR_BS
 | 
INTR_FC
;

178 
s
->
ºegs
[6] = 
SEQ_CD
;

179 
	`e•dma_øi£_úq
(
s
->
dma_›aque
);

181 
	}
}

183 
	$wrôe_ª•⁄£
(
ESPSèã
 *
s
)

185 
	`DPRINTF
("Tøns„∏°©u†(£n£=%d)\n", 
s
->
£n£
);

186 
s
->
ti_buf
[0] = s->
£n£
;

187 
s
->
ti_buf
[1] = 0;

188 i‡(
s
->
dma
) {

189 
	`e•dma_mem‹y_wrôe
(
s
->
dma_›aque
, s->
ti_buf
, 2);

190 
s
->
ºegs
[4] = 
STAT_IN
 | 
STAT_TC
 | 
STAT_ST
;

191 
s
->
ºegs
[5] = 
INTR_BS
 | 
INTR_FC
;

192 
s
->
ºegs
[6] = 
SEQ_CD
;

194 
s
->
ti_size
 = 2;

195 
s
->
ti_Ωå
 = 0;

196 
s
->
ti_w±r
 = 0;

197 
s
->
ºegs
[7] = 2;

199 
	`e•dma_øi£_úq
(
s
->
dma_›aque
);

200 
	}
}

202 
	$e•_dma_d⁄e
(
ESPSèã
 *
s
)

204 
s
->
ºegs
[4] |
STAT_IN
 | 
STAT_TC
;

205 
s
->
ºegs
[5] = 
INTR_BS
;

206 
s
->
ºegs
[6] = 0;

207 
s
->
ºegs
[7] = 0;

208 
s
->
ºegs
[0] = 0;

209 
s
->
ºegs
[1] = 0;

210 
	`e•dma_øi£_úq
(
s
->
dma_›aque
);

211 
	}
}

213 
	$e•_do_dma
(
ESPSèã
 *
s
)

215 
uöt32_t
 
Àn
;

216 
to_devi˚
;

218 
to_devi˚
 = (
s
->
ti_size
 < 0);

219 
Àn
 = 
s
->
dma_À·
;

220 i‡(
s
->
do_cmd
) {

221 
	`DPRINTF
("comm™dÜí %d + %d\n", 
s
->
cmdÀn
, 
Àn
);

222 
	`e•dma_mem‹y_ªad
(
s
->
dma_›aque
, &s->
cmdbuf
[s->
cmdÀn
], 
Àn
);

223 
s
->
ti_size
 = 0;

224 
s
->
cmdÀn
 = 0;

225 
s
->
do_cmd
 = 0;

226 
	`do_cmd
(
s
, s->
cmdbuf
);

229 i‡(
s
->
async_Àn
 == 0) {

233 i‡(
Àn
 > 
s
->
async_Àn
) {

234 
Àn
 = 
s
->
async_Àn
;

236 i‡(
to_devi˚
) {

237 
	`e•dma_mem‹y_ªad
(
s
->
dma_›aque
, s->
async_buf
, 
Àn
);

239 
	`e•dma_mem‹y_wrôe
(
s
->
dma_›aque
, s->
async_buf
, 
Àn
);

241 
s
->
dma_À·
 -
Àn
;

242 
s
->
async_buf
 +
Àn
;

243 
s
->
async_Àn
 -
Àn
;

244 i‡(
to_devi˚
)

245 
s
->
ti_size
 +
Àn
;

247 
s
->
ti_size
 -
Àn
;

248 i‡(
s
->
async_Àn
 == 0) {

249 i‡(
to_devi˚
) {

251 
	`scsi_wrôe_d©a
(
s
->
cuºít_dev
, 0);

253 
	`scsi_ªad_d©a
(
s
->
cuºít_dev
, 0);

257 i‡(
s
->
dma_À·
 =0 && s->
ti_size
 > 0) {

258 
	`e•_dma_d⁄e
(
s
);

263 
	`e•_dma_d⁄e
(
s
);

265 
	}
}

267 
	$e•_comm™d_com∂ëe
(*
›aque
, 
ªas⁄
, 
uöt32_t
 
èg
,

268 
uöt32_t
 
¨g
)

270 
ESPSèã
 *
s
 = (ESPSèã *)
›aque
;

272 i‡(
ªas⁄
 =
SCSI_REASON_DONE
) {

273 
	`DPRINTF
("SCSI Command complete\n");

274 i‡(
s
->
ti_size
 != 0)

275 
	`DPRINTF
("SCSI command completed unexpectedly\n");

276 
s
->
ti_size
 = 0;

277 
s
->
dma_À·
 = 0;

278 
s
->
async_Àn
 = 0;

279 i‡(
¨g
)

280 
	`DPRINTF
("Command failed\n");

281 
s
->
£n£
 = 
¨g
;

282 
s
->
ºegs
[4] = 
STAT_ST
;

283 
	`e•_dma_d⁄e
(
s
);

284 
s
->
cuºít_dev
 = 
NULL
;

286 
	`DPRINTF
("å™s„∏%d/%d\n", 
s
->
dma_À·
, s->
ti_size
);

287 
s
->
async_Àn
 = 
¨g
;

288 
s
->
async_buf
 = 
	`scsi_gë_buf
(s->
cuºít_dev
, 0);

289 i‡(
s
->
dma_À·
) {

290 
	`e•_do_dma
(
s
);

291 } i‡(
s
->
dma_cou¡î
 !0 && s->
ti_size
 <= 0) {

294 
	`e•_dma_d⁄e
(
s
);

297 
	}
}

299 
	$h™dÀ_ti
(
ESPSèã
 *
s
)

301 
uöt32_t
 
dmÆí
, 
möÀn
;

303 
dmÆí
 = 
s
->
ºegs
[0] | (s->rregs[1] << 8);

304 i‡(
dmÆí
==0) {

305 
dmÆí
=0x10000;

307 
s
->
dma_cou¡î
 = 
dmÆí
;

309 i‡(
s
->
do_cmd
)

310 
möÀn
 = (
dmÆí
 < 32) ? dmalen : 32;

311 i‡(
s
->
ti_size
 < 0)

312 
möÀn
 = (
dmÆí
 < -
s
->
ti_size
) ? dmalen : -s->ti_size;

314 
möÀn
 = (
dmÆí
 < 
s
->
ti_size
) ? dmalen : s->ti_size;

315 
	`DPRINTF
("Tøns„∏Inf‹m©i⁄Üí %d\n", 
möÀn
);

316 i‡(
s
->
dma
) {

317 
s
->
dma_À·
 = 
möÀn
;

318 
s
->
ºegs
[4] &~
STAT_TC
;

319 
	`e•_do_dma
(
s
);

320 } i‡(
s
->
do_cmd
) {

321 
	`DPRINTF
("comm™dÜí %d\n", 
s
->
cmdÀn
);

322 
s
->
ti_size
 = 0;

323 
s
->
cmdÀn
 = 0;

324 
s
->
do_cmd
 = 0;

325 
	`do_cmd
(
s
, s->
cmdbuf
);

328 
	}
}

330 
	$e•_ª£t
(*
›aque
)

332 
ESPSèã
 *
s
 = 
›aque
;

334 
	`mem£t
(
s
->
ºegs
, 0, 
ESP_MAXREG
);

335 
	`mem£t
(
s
->
wªgs
, 0, 
ESP_MAXREG
);

336 
s
->
ºegs
[0x0e] = 0x4;

337 
s
->
ti_size
 = 0;

338 
s
->
ti_Ωå
 = 0;

339 
s
->
ti_w±r
 = 0;

340 
s
->
dma
 = 0;

341 
s
->
do_cmd
 = 0;

342 
	}
}

344 
uöt32_t
 
	$e•_mem_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

346 
ESPSèã
 *
s
 = 
›aque
;

347 
uöt32_t
 
ßddr
;

349 
ßddr
 = (
addr
 & 
ESP_MAXREG
) >> 2;

350 
	`DPRINTF
("ªadÑeg[%d]: 0x%2.2x\n", 
ßddr
, 
s
->
ºegs
[saddr]);

351 
ßddr
) {

354 i‡(
s
->
ti_size
 > 0) {

355 
s
->
ti_size
--;

356 i‡((
s
->
ºegs
[4] & 6) == 0) {

358 
	`Ârötf
(
°dîr
, "esp: PIO dataÑeadÇot implemented\n");

359 
s
->
ºegs
[2] = 0;

361 
s
->
ºegs
[2] = s->
ti_buf
[s->
ti_Ωå
++];

363 
	`e•dma_øi£_úq
(
s
->
dma_›aque
);

365 i‡(
s
->
ti_size
 == 0) {

366 
s
->
ti_Ωå
 = 0;

367 
s
->
ti_w±r
 = 0;

373 
s
->
ºegs
[4] &~(
STAT_IN
 | 
STAT_GE
 | 
STAT_PE
);

374 
	`e•dma_˛ór_úq
(
s
->
dma_›aque
);

379  
s
->
ºegs
[
ßddr
];

380 
	}
}

382 
	$e•_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

384 
ESPSèã
 *
s
 = 
›aque
;

385 
uöt32_t
 
ßddr
;

387 
ßddr
 = (
addr
 & 
ESP_MAXREG
) >> 2;

388 
	`DPRINTF
("wrôêªg[%d]: 0x%2.2x -> 0x%2.2x\n", 
ßddr
, 
s
->
wªgs
[ßddr], 
vÆ
);

389 
ßddr
) {

392 
s
->
ºegs
[4] &~
STAT_TC
;

396 i‡(
s
->
do_cmd
) {

397 
s
->
cmdbuf
[s->
cmdÀn
++] = 
vÆ
 & 0xff;

398 } i‡((
s
->
ºegs
[4] & 6) == 0) {

399 
uöt8_t
 
buf
;

400 
buf
 = 
vÆ
 & 0xff;

401 
s
->
ti_size
--;

402 
	`Ârötf
(
°dîr
, "esp: PIO data writeÇot implemented\n");

404 
s
->
ti_size
++;

405 
s
->
ti_buf
[s->
ti_w±r
++] = 
vÆ
 & 0xff;

409 
s
->
ºegs
[
ßddr
] = 
vÆ
;

411 i‡(
vÆ
 & 0x80) {

412 
s
->
dma
 = 1;

414 
s
->
ºegs
[0] = s->
wªgs
[0];

415 
s
->
ºegs
[1] = s->
wªgs
[1];

417 
s
->
dma
 = 0;

419 
vÆ
 & 0x7f) {

421 
	`DPRINTF
("NOP (%2.2x)\n", 
vÆ
);

424 
	`DPRINTF
("Flush FIFO (%2.2x)\n", 
vÆ
);

426 
s
->
ºegs
[5] = 
INTR_FC
;

427 
s
->
ºegs
[6] = 0;

430 
	`DPRINTF
("ChùÑe£à(%2.2x)\n", 
vÆ
);

431 
	`e•_ª£t
(
s
);

434 
	`DPRINTF
("Bu†ª£à(%2.2x)\n", 
vÆ
);

435 
s
->
ºegs
[5] = 
INTR_RST
;

436 i‡(!(
s
->
wªgs
[8] & 0x40)) {

437 
	`e•dma_øi£_úq
(
s
->
dma_›aque
);

441 
	`h™dÀ_ti
(
s
);

444 
	`DPRINTF
("Inôüt‹ Comm™d Com∂ëêSequí˚ (%2.2x)\n", 
vÆ
);

445 
	`wrôe_ª•⁄£
(
s
);

448 
	`DPRINTF
("MesßgêAc˚±ed (%2.2x)\n", 
vÆ
);

449 
	`wrôe_ª•⁄£
(
s
);

450 
s
->
ºegs
[5] = 
INTR_DC
;

451 
s
->
ºegs
[6] = 0;

454 
	`DPRINTF
("Së ATN (%2.2x)\n", 
vÆ
);

457 
	`DPRINTF
("Së ATN (%2.2x)\n", 
vÆ
);

458 
	`h™dÀ_ßä
(
s
);

461 
	`DPRINTF
("Së ATN & st› (%2.2x)\n", 
vÆ
);

462 
	`h™dÀ_ßä_°›
(
s
);

465 
	`DPRINTF
("Unh™dÀd ESP comm™d (%2.2x)\n", 
vÆ
);

472 
s
->
ºegs
[
ßddr
] = 
vÆ
;

477 
s
->
ºegs
[
ßddr
] = 
vÆ
 & 0x15;

480 
s
->
ºegs
[
ßddr
] = 
vÆ
;

485 
s
->
wªgs
[
ßddr
] = 
vÆ
;

486 
	}
}

488 
CPURódMem‹yFunc
 *
	ge•_mem_ªad
[3] = {

489 
e•_mem_ªadb
,

490 
e•_mem_ªadb
,

491 
e•_mem_ªadb
,

494 
CPUWrôeMem‹yFunc
 *
	ge•_mem_wrôe
[3] = {

495 
e•_mem_wrôeb
,

496 
e•_mem_wrôeb
,

497 
e•_mem_wrôeb
,

500 
	$e•_ßve
(
QEMUFûe
 *
f
, *
›aque
)

502 
ESPSèã
 *
s
 = 
›aque
;

504 
	`qemu_put_buf„r
(
f
, 
s
->
ºegs
, 
ESP_MAXREG
);

505 
	`qemu_put_buf„r
(
f
, 
s
->
wªgs
, 
ESP_MAXREG
);

506 
	`qemu_put_be32s
(
f
, &
s
->
ti_size
);

507 
	`qemu_put_be32s
(
f
, &
s
->
ti_Ωå
);

508 
	`qemu_put_be32s
(
f
, &
s
->
ti_w±r
);

509 
	`qemu_put_buf„r
(
f
, 
s
->
ti_buf
, 
TI_BUFSZ
);

510 
	`qemu_put_be32s
(
f
, &
s
->
dma
);

511 
	}
}

513 
	$e•_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

515 
ESPSèã
 *
s
 = 
›aque
;

517 i‡(
vîsi⁄_id
 != 2)

518  -
EINVAL
;

520 
	`qemu_gë_buf„r
(
f
, 
s
->
ºegs
, 
ESP_MAXREG
);

521 
	`qemu_gë_buf„r
(
f
, 
s
->
wªgs
, 
ESP_MAXREG
);

522 
	`qemu_gë_be32s
(
f
, &
s
->
ti_size
);

523 
	`qemu_gë_be32s
(
f
, &
s
->
ti_Ωå
);

524 
	`qemu_gë_be32s
(
f
, &
s
->
ti_w±r
);

525 
	`qemu_gë_buf„r
(
f
, 
s
->
ti_buf
, 
TI_BUFSZ
);

526 
	`qemu_gë_be32s
(
f
, &
s
->
dma
);

529 
	}
}

531 
	$e•_scsi_©èch
(*
›aque
, 
BlockDrivîSèã
 *
bd
, 
id
)

533 
ESPSèã
 *
s
 = (ESPSèã *)
›aque
;

535 i‡(
id
 < 0) {

536 
id
 = 0; id < 
ESP_MAX_DEVS
; id++) {

537 i‡(
s
->
scsi_dev
[
id
] =
NULL
)

541 i‡(
id
 >
ESP_MAX_DEVS
) {

542 
	`DPRINTF
("Bad Devi˚ ID %d\n", 
id
);

545 i‡(
s
->
scsi_dev
[
id
]) {

546 
	`DPRINTF
("De°royög devi˚ %d\n", 
id
);

547 
	`scsi_disk_de°roy
(
s
->
scsi_dev
[
id
]);

549 
	`DPRINTF
("Aâachög block devi˚ %d\n", 
id
);

551 
s
->
scsi_dev
[
id
] = 
	`scsi_disk_öô
(
bd
, 0, 
e•_comm™d_com∂ëe
, s);

552 
	}
}

554 *
	$e•_öô
(
BlockDrivîSèã
 **
bd
, 
uöt32_t
 
e•addr
, *
dma_›aque
)

556 
ESPSèã
 *
s
;

557 
e•_io_mem‹y
;

559 
s
 = 
	`qemu_mÆlocz
((
ESPSèã
));

560 i‡(!
s
)

561  
NULL
;

563 
s
->
bd
 = bd;

564 
s
->
dma_›aque
 = dma_opaque;

566 
e•_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
e•_mem_ªad
, 
e•_mem_wrôe
, 
s
);

567 
	`˝u_ªgi°î_physiˇl_mem‹y
(
e•addr
, 
ESP_MAXREG
*4, 
e•_io_mem‹y
);

569 
	`e•_ª£t
(
s
);

571 
	`ªgi°î_ßvevm
("e•", 
e•addr
, 2, 
e•_ßve
, 
e•_lﬂd
, 
s
);

572 
	`qemu_ªgi°î_ª£t
(
e•_ª£t
, 
s
);

574  
s
;

575 
	}
}

	@fdc.c

28 
	~"vl.h
"

34 #ifde‡
DEBUG_FLOPPY


35 
	#FLOPPY_DPRINTF
(
fmt
, 
¨gs
...) \

36 dÿ{ 
	`¥ötf
("FLOPPY: " 
fmt
 , ##
¨gs
); } 0)

	)

38 
	#FLOPPY_DPRINTF
(
fmt
, 
¨gs
...)

	)

41 
	#FLOPPY_ERROR
(
fmt
, 
¨gs
...) \

42 dÿ{ 
	`¥ötf
("FLOPPY ERROR: %s: " 
fmt
, 
__func__
 , ##
¨gs
); } 0)

	)

48 
	#FD_SECTOR_LEN
 512

	)

49 
	#FD_SECTOR_SC
 2

	)

52 
	efdisk_ty≥_t
 {

53 
	mFDRIVE_DISK_288
 = 0x01,

54 
	mFDRIVE_DISK_144
 = 0x02,

55 
	mFDRIVE_DISK_720
 = 0x03,

56 
	mFDRIVE_DISK_USER
 = 0x04,

57 
	mFDRIVE_DISK_NONE
 = 0x05,

58 } 
	tfdisk_ty≥_t
;

60 
	efdrive_ty≥_t
 {

61 
	mFDRIVE_DRV_144
 = 0x00,

62 
	mFDRIVE_DRV_288
 = 0x01,

63 
	mFDRIVE_DRV_120
 = 0x02,

64 
	mFDRIVE_DRV_NONE
 = 0x03,

65 } 
	tfdrive_ty≥_t
;

67 
	efdrive_Êags_t
 {

68 
	mFDRIVE_MOTOR_ON
 = 0x01,

69 } 
	tfdrive_Êags_t
;

71 
	efdisk_Êags_t
 {

72 
	mFDISK_DBL_SIDES
 = 0x01,

73 } 
	tfdisk_Êags_t
;

75 
	sfdrive_t
 {

76 
BlockDrivîSèã
 *
	mbs
;

78 
fdrive_ty≥_t
 
	mdrive
;

79 
fdrive_Êags_t
 
	mdrÊags
;

80 
uöt8_t
 
	m≥Ωídicuœr
;

82 
uöt8_t
 
	mhód
;

83 
uöt8_t
 
	måack
;

84 
uöt8_t
 
	m£˘
;

86 
uöt8_t
 
	mdú
;

87 
uöt8_t
 
	mrw
;

89 
fdisk_Êags_t
 
	mÊags
;

90 
uöt8_t
 
	mœ°_£˘
;

91 
uöt8_t
 
	mmax_åack
;

92 
uöt16_t
 
	mbps
;

93 
uöt8_t
 
	mro
;

94 } 
	tfdrive_t
;

96 
	$fd_öô
 (
fdrive_t
 *
drv
, 
BlockDrivîSèã
 *
bs
)

99 
drv
->
bs
 = bs;

100 
drv
->
drive
 = 
FDRIVE_DRV_NONE
;

101 
drv
->
drÊags
 = 0;

102 
drv
->
≥Ωídicuœr
 = 0;

104 
drv
->
œ°_£˘
 = 0;

105 
drv
->
max_åack
 = 0;

106 
	}
}

108 
	$_fd_£˘‹
 (
uöt8_t
 
hód
, uöt8_à
åack
,

109 
uöt8_t
 
£˘
, uöt8_à
œ°_£˘
)

111  (((
åack
 * 2Ë+ 
hód
Ë* 
œ°_£˘
Ë+ 
£˘
 - 1;

112 
	}
}

115 
	$fd_£˘‹
 (
fdrive_t
 *
drv
)

117  
	`_fd_£˘‹
(
drv
->
hód
, drv->
åack
, drv->
£˘
, drv->
œ°_£˘
);

118 
	}
}

120 
	$fd_£ek
 (
fdrive_t
 *
drv
, 
uöt8_t
 
hód
, uöt8_à
åack
, uöt8_à
£˘
,

121 
íabÀ_£ek
)

123 
uöt32_t
 
£˘‹
;

124 
ªt
;

126 i‡(
åack
 > 
drv
->
max_åack
 ||

127 (
hód
 !0 && (
drv
->
Êags
 & 
FDISK_DBL_SIDES
) == 0)) {

128 
	`FLOPPY_DPRINTF
("tryÅoÑead %d %02x %02x (max=%d %d %02x %02x)\n",

129 
hód
, 
åack
, 
£˘
, 1,

130 (
drv
->
Êags
 & 
FDISK_DBL_SIDES
) == 0 ? 0 : 1,

131 
drv
->
max_åack
, drv->
œ°_£˘
);

134 i‡(
£˘
 > 
drv
->
œ°_£˘
) {

135 
	`FLOPPY_DPRINTF
("tryÅoÑead %d %02x %02x (max=%d %d %02x %02x)\n",

136 
hód
, 
åack
, 
£˘
, 1,

137 (
drv
->
Êags
 & 
FDISK_DBL_SIDES
) == 0 ? 0 : 1,

138 
drv
->
max_åack
, drv->
œ°_£˘
);

141 
£˘‹
 = 
	`_fd_£˘‹
(
hód
, 
åack
, 
£˘
, 
drv
->
œ°_£˘
);

142 
ªt
 = 0;

143 i‡(
£˘‹
 !
	`fd_£˘‹
(
drv
)) {

145 i‡(!
íabÀ_£ek
) {

146 
	`FLOPPY_ERROR
("no implicit seek %d %02x %02x (max=%d %02x %02x)\n",

147 
hód
, 
åack
, 
£˘
, 1, 
drv
->
max_åack
, drv->
œ°_£˘
);

151 
drv
->
hód
 = head;

152 i‡(
drv
->
åack
 !=Årack)

153 
ªt
 = 1;

154 
drv
->
åack
 =Årack;

155 
drv
->
£˘
 = sect;

158  
ªt
;

159 
	}
}

162 
	$fd_ªˇlibøã
 (
fdrive_t
 *
drv
)

164 
	`FLOPPY_DPRINTF
("recalibrate\n");

165 
drv
->
hód
 = 0;

166 
drv
->
åack
 = 0;

167 
drv
->
£˘
 = 1;

168 
drv
->
dú
 = 1;

169 
drv
->
rw
 = 0;

170 
	}
}

173 
	sfd_f‹m©_t
 {

174 
fdrive_ty≥_t
 
	mdrive
;

175 
fdisk_ty≥_t
 
	mdisk
;

176 
uöt8_t
 
	mœ°_£˘
;

177 
uöt8_t
 
	mmax_åack
;

178 
uöt8_t
 
	mmax_hód
;

179 c⁄° *
	m°r
;

180 } 
	tfd_f‹m©_t
;

182 
fd_f‹m©_t
 
	gfd_f‹m©s
[] = {

185 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_144
, 18, 80, 1, "1.44 MB 3\"1/2", },

186 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_144
, 20, 80, 1, "1.6 MB 3\"1/2", },

187 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_144
, 21, 80, 1, "1.68 MB 3\"1/2", },

188 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_144
, 21, 82, 1, "1.72 MB 3\"1/2", },

189 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_144
, 21, 83, 1, "1.74 MB 3\"1/2", },

190 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_144
, 22, 80, 1, "1.76 MB 3\"1/2", },

191 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_144
, 23, 80, 1, "1.84 MB 3\"1/2", },

192 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_144
, 24, 80, 1, "1.92 MB 3\"1/2", },

194 { 
FDRIVE_DRV_288
, 
FDRIVE_DISK_288
, 36, 80, 1, "2.88 MB 3\"1/2", },

195 { 
FDRIVE_DRV_288
, 
FDRIVE_DISK_288
, 39, 80, 1, "3.12 MB 3\"1/2", },

196 { 
FDRIVE_DRV_288
, 
FDRIVE_DISK_288
, 40, 80, 1, "3.2 MB 3\"1/2", },

197 { 
FDRIVE_DRV_288
, 
FDRIVE_DISK_288
, 44, 80, 1, "3.52 MB 3\"1/2", },

198 { 
FDRIVE_DRV_288
, 
FDRIVE_DISK_288
, 48, 80, 1, "3.84 MB 3\"1/2", },

200 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_720
, 9, 80, 1, "720 kB 3\"1/2", },

201 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_720
, 10, 80, 1, "800 kB 3\"1/2", },

202 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_720
, 10, 82, 1, "820 kB 3\"1/2", },

203 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_720
, 10, 83, 1, "830 kB 3\"1/2", },

204 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_720
, 13, 80, 1, "1.04 MB 3\"1/2", },

205 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_720
, 14, 80, 1, "1.12 MB 3\"1/2", },

207 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 15, 80, 1, "1.2 kB 5\"1/4", },

208 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 18, 80, 1, "1.44 MB 5\"1/4", },

209 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 18, 82, 1, "1.48 MB 5\"1/4", },

210 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 18, 83, 1, "1.49 MB 5\"1/4", },

211 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 20, 80, 1, "1.6 MB 5\"1/4", },

213 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 9, 80, 1, "720 kB 5\"1/4", },

214 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 11, 80, 1, "880 kB 5\"1/4", },

216 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 9, 40, 1, "360 kB 5\"1/4", },

217 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 9, 40, 0, "180 kB 5\"1/4", },

218 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 10, 41, 1, "410 kB 5\"1/4", },

219 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 10, 42, 1, "420 kB 5\"1/4", },

221 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 8, 40, 1, "320 kB 5\"1/4", },

222 { 
FDRIVE_DRV_120
, 
FDRIVE_DISK_288
, 8, 40, 0, "160 kB 5\"1/4", },

224 { 
FDRIVE_DRV_144
, 
FDRIVE_DISK_720
, 9, 80, 0, "360 kB 3\"1/2", },

226 { 
FDRIVE_DRV_NONE
, 
FDRIVE_DISK_NONE
, -1, -1, 0, 
NULL
, },

230 
	$fd_ªvÆid©e
 (
fdrive_t
 *
drv
)

232 
fd_f‹m©_t
 *
∑r£
;

233 
öt64_t
 
nb_£˘‹s
, 
size
;

234 
i
, 
fú°_m©ch
, 
m©ch
;

235 
nb_hóds
, 
max_åack
, 
œ°_£˘
, 
ro
;

237 
	`FLOPPY_DPRINTF
("revalidate\n");

238 i‡(
drv
->
bs
 !
NULL
 && 
	`bdrv_is_ö£πed
(drv->bs)) {

239 
ro
 = 
	`bdrv_is_ªad_⁄ly
(
drv
->
bs
);

240 
	`bdrv_gë_geomëry_höt
(
drv
->
bs
, &
nb_hóds
, &
max_åack
, &
œ°_£˘
);

241 i‡(
nb_hóds
 !0 && 
max_åack
 !0 && 
œ°_£˘
 != 0) {

242 
	`FLOPPY_DPRINTF
("User defined disk (%d %d %d)",

243 
nb_hóds
 - 1, 
max_åack
, 
œ°_£˘
);

245 
	`bdrv_gë_geomëry
(
drv
->
bs
, &
nb_£˘‹s
);

246 
m©ch
 = -1;

247 
fú°_m©ch
 = -1;

248 
i
 = 0;; i++) {

249 
∑r£
 = &
fd_f‹m©s
[
i
];

250 i‡(
∑r£
->
drive
 =
FDRIVE_DRV_NONE
)

252 i‡(
drv
->
drive
 =
∑r£
->drive ||

253 
drv
->
drive
 =
FDRIVE_DRV_NONE
) {

254 
size
 = (
∑r£
->
max_hód
 + 1Ë*Ö¨£->
max_åack
 *

255 
∑r£
->
œ°_£˘
;

256 i‡(
nb_£˘‹s
 =
size
) {

257 
m©ch
 = 
i
;

260 i‡(
fú°_m©ch
 == -1)

261 
fú°_m©ch
 = 
i
;

264 i‡(
m©ch
 == -1) {

265 i‡(
fú°_m©ch
 == -1)

266 
m©ch
 = 1;

268 
m©ch
 = 
fú°_m©ch
;

269 
∑r£
 = &
fd_f‹m©s
[
m©ch
];

271 
nb_hóds
 = 
∑r£
->
max_hód
 + 1;

272 
max_åack
 = 
∑r£
->max_track;

273 
œ°_£˘
 = 
∑r£
->last_sect;

274 
drv
->
drive
 = 
∑r£
->drive;

275 
	`FLOPPY_DPRINTF
("%†Ê›py disk (%d h %dÅ %d sË%s\n", 
∑r£
->
°r
,

276 
nb_hóds
, 
max_åack
, 
œ°_£˘
, 
ro
 ? "ro" : "rw");

278 i‡(
nb_hóds
 == 1) {

279 
drv
->
Êags
 &~
FDISK_DBL_SIDES
;

281 
drv
->
Êags
 |
FDISK_DBL_SIDES
;

283 
drv
->
max_åack
 = max_track;

284 
drv
->
œ°_£˘
 =Üast_sect;

285 
drv
->
ro
 =Ño;

287 
	`FLOPPY_DPRINTF
("No disk in drive\n");

288 
drv
->
œ°_£˘
 = 0;

289 
drv
->
max_åack
 = 0;

290 
drv
->
Êags
 &~
FDISK_DBL_SIDES
;

292 
	}
}

295 
	$fd_°¨t
 (
fdrive_t
 *
drv
)

297 
drv
->
drÊags
 |
FDRIVE_MOTOR_ON
;

298 
	}
}

300 
	$fd_°›
 (
fdrive_t
 *
drv
)

302 
drv
->
drÊags
 &~
FDRIVE_MOTOR_ON
;

303 
	}
}

306 
	$fd_ª£t
 (
fdrive_t
 *
drv
)

308 
	`fd_°›
(
drv
);

309 
	`fd_ªˇlibøã
(
drv
);

310 
	}
}

315 
fd˘æ_ª£t
 (
fd˘æ_t
 *
fd˘æ
, 
do_úq
);

316 
fd˘æ_ª£t_fifo
 (
fd˘æ_t
 *
fd˘æ
);

317 
fd˘æ_å™s„r_h™dÀr
 (*
›aque
, 
nch™
,

318 
dma_pos
, 
dma_Àn
);

319 
fd˘æ_øi£_úq
 (
fd˘æ_t
 *
fd˘æ
, 
uöt8_t
 
°©us
);

320 
fd˘æ_ªsu…_timî
(*
›aque
);

322 
uöt32_t
 
fd˘æ_ªad_°©usB
 (
fd˘æ_t
 *
fd˘æ
);

323 
uöt32_t
 
fd˘æ_ªad_d‹
 (
fd˘æ_t
 *
fd˘æ
);

324 
fd˘æ_wrôe_d‹
 (
fd˘æ_t
 *
fd˘æ
, 
uöt32_t
 
vÆue
);

325 
uöt32_t
 
fd˘æ_ªad_è≥
 (
fd˘æ_t
 *
fd˘æ
);

326 
fd˘æ_wrôe_è≥
 (
fd˘æ_t
 *
fd˘æ
, 
uöt32_t
 
vÆue
);

327 
uöt32_t
 
fd˘æ_ªad_maö_°©us
 (
fd˘æ_t
 *
fd˘æ
);

328 
fd˘æ_wrôe_øã
 (
fd˘æ_t
 *
fd˘æ
, 
uöt32_t
 
vÆue
);

329 
uöt32_t
 
fd˘æ_ªad_d©a
 (
fd˘æ_t
 *
fd˘æ
);

330 
fd˘æ_wrôe_d©a
 (
fd˘æ_t
 *
fd˘æ
, 
uöt32_t
 
vÆue
);

331 
uöt32_t
 
fd˘æ_ªad_dú
 (
fd˘æ_t
 *
fd˘æ
);

334 
	mFD_CTRL_ACTIVE
 = 0x01,

335 
	mFD_CTRL_RESET
 = 0x02,

336 
	mFD_CTRL_SLEEP
 = 0x04,

337 
	mFD_CTRL_BUSY
 = 0x08,

338 
	mFD_CTRL_INTR
 = 0x10,

342 
	mFD_DIR_WRITE
 = 0,

343 
	mFD_DIR_READ
 = 1,

344 
	mFD_DIR_SCANE
 = 2,

345 
	mFD_DIR_SCANL
 = 3,

346 
	mFD_DIR_SCANH
 = 4,

350 
	mFD_STATE_CMD
 = 0x00,

351 
	mFD_STATE_STATUS
 = 0x01,

352 
	mFD_STATE_DATA
 = 0x02,

353 
	mFD_STATE_STATE
 = 0x03,

354 
	mFD_STATE_MULTI
 = 0x10,

355 
	mFD_STATE_SEEK
 = 0x20,

356 
	mFD_STATE_FORMAT
 = 0x40,

359 
	#FD_STATE
(
°©e
Ë((°©eË& 
FD_STATE_STATE
)

	)

360 
	#FD_SET_STATE
(
°©e
, 
√w_°©e
) \

361 dÿ{ (
°©e
Ë((°©eË& ~
FD_STATE_STATE
Ë| (
√w_°©e
); } 0)

	)

362 
	#FD_MULTI_TRACK
(
°©e
Ë((°©eË& 
FD_STATE_MULTI
)

	)

363 
	#FD_DID_SEEK
(
°©e
Ë((°©eË& 
FD_STATE_SEEK
)

	)

364 
	#FD_FORMAT_CMD
(
°©e
Ë((°©eË& 
FD_STATE_FORMAT
)

	)

366 
	sfd˘æ_t
 {

367 
fd˘æ_t
 *
	mfd˘æ
;

369 
uöt8_t
 
	mvîsi⁄
;

371 
	múq_lvl
;

372 
	mdma_ch™n
;

373 
uöt32_t
 
	mio_ba£
;

375 
QEMUTimî
 *
	mªsu…_timî
;

376 
uöt8_t
 
	m°©e
;

377 
uöt8_t
 
	mdma_í
;

378 
uöt8_t
 
	mcur_drv
;

379 
uöt8_t
 
	mboŸ£l
;

381 
uöt8_t
 
	mfifo
[
FD_SECTOR_LEN
];

382 
uöt32_t
 
	md©a_pos
;

383 
uöt32_t
 
	md©a_Àn
;

384 
uöt8_t
 
	md©a_°©e
;

385 
uöt8_t
 
	md©a_dú
;

386 
uöt8_t
 
	möt_°©us
;

387 
uöt8_t
 
	meŸ
;

390 
uöt8_t
 
	mtimî0
;

391 
uöt8_t
 
	mtimî1
;

393 
uöt8_t
 
	m¥ecomp_åk
;

394 
uöt8_t
 
	mc⁄fig
;

395 
uöt8_t
 
	mlock
;

397 
uöt8_t
 
	mpwrd
;

399 
fdrive_t
 
	mdrives
[2];

402 
uöt32_t
 
	$fd˘æ_ªad
 (*
›aque
, 
uöt32_t
 
ªg
)

404 
fd˘æ_t
 *
fd˘æ
 = 
›aque
;

405 
uöt32_t
 
ªtvÆ
;

407 
ªg
 & 0x07) {

408 #ifde‡
TARGET_SPARC


411 
ªtvÆ
 = 
	`fd˘æ_ªad_°©usB
(
fd˘æ
);

415 
ªtvÆ
 = 
	`fd˘æ_ªad_°©usB
(
fd˘æ
);

418 
ªtvÆ
 = 
	`fd˘æ_ªad_d‹
(
fd˘æ
);

421 
ªtvÆ
 = 
	`fd˘æ_ªad_è≥
(
fd˘æ
);

424 
ªtvÆ
 = 
	`fd˘æ_ªad_maö_°©us
(
fd˘æ
);

427 
ªtvÆ
 = 
	`fd˘æ_ªad_d©a
(
fd˘æ
);

430 
ªtvÆ
 = 
	`fd˘æ_ªad_dú
(
fd˘æ
);

433 
ªtvÆ
 = (
uöt32_t
)(-1);

436 
	`FLOPPY_DPRINTF
("ªadÑeg%d: 0x%02x\n", 
ªg
 & 7, 
ªtvÆ
);

438  
ªtvÆ
;

439 
	}
}

441 
	$fd˘æ_wrôe
 (*
›aque
, 
uöt32_t
 
ªg
, uöt32_à
vÆue
)

443 
fd˘æ_t
 *
fd˘æ
 = 
›aque
;

445 
	`FLOPPY_DPRINTF
("wrôêªg%d: 0x%02x\n", 
ªg
 & 7, 
vÆue
);

447 
ªg
 & 0x07) {

449 
	`fd˘æ_wrôe_d‹
(
fd˘æ
, 
vÆue
);

452 
	`fd˘æ_wrôe_è≥
(
fd˘æ
, 
vÆue
);

455 
	`fd˘æ_wrôe_øã
(
fd˘æ
, 
vÆue
);

458 
	`fd˘æ_wrôe_d©a
(
fd˘æ
, 
vÆue
);

463 
	}
}

465 
uöt32_t
 
	$fd˘æ_ªad_mem
 (*
›aque
, 
èrgë_phys_addr_t
 
ªg
)

467  
	`fd˘æ_ªad
(
›aque
, 
ªg
);

468 
	}
}

470 
	$fd˘æ_wrôe_mem
 (*
›aque
,

471 
èrgë_phys_addr_t
 
ªg
, 
uöt32_t
 
vÆue
)

473 
	`fd˘æ_wrôe
(
›aque
, 
ªg
, 
vÆue
);

474 
	}
}

476 
CPURódMem‹yFunc
 *
	gfd˘æ_mem_ªad
[3] = {

477 
fd˘æ_ªad_mem
,

478 
fd˘æ_ªad_mem
,

479 
fd˘æ_ªad_mem
,

482 
CPUWrôeMem‹yFunc
 *
	gfd˘æ_mem_wrôe
[3] = {

483 
fd˘æ_wrôe_mem
,

484 
fd˘æ_wrôe_mem
,

485 
fd˘æ_wrôe_mem
,

488 
fd˘æ_t
 *
	$fd˘æ_öô
 (
úq_lvl
, 
dma_ch™n
, 
mem_m≠≥d
,

489 
uöt32_t
 
io_ba£
,

490 
BlockDrivîSèã
 **
fds
)

492 
fd˘æ_t
 *
fd˘æ
;

493 
io_mem
;

494 
i
;

496 
	`FLOPPY_DPRINTF
("init controller\n");

497 
fd˘æ
 = 
	`qemu_mÆlocz
((
fd˘æ_t
));

498 i‡(!
fd˘æ
)

499  
NULL
;

500 
fd˘æ
->
ªsu…_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
,

501 
fd˘æ_ªsu…_timî
, 
fd˘æ
);

503 
fd˘æ
->
vîsi⁄
 = 0x90;

504 
fd˘æ
->
úq_lvl
 = irq_lvl;

505 
fd˘æ
->
dma_ch™n
 = dma_chann;

506 
fd˘æ
->
io_ba£
 = io_base;

507 
fd˘æ
->
c⁄fig
 = 0x60;

508 i‡(
fd˘æ
->
dma_ch™n
 != -1) {

509 
fd˘æ
->
dma_í
 = 1;

510 
	`DMA_ªgi°î_ch™√l
(
dma_ch™n
, &
fd˘æ_å™s„r_h™dÀr
, 
fd˘æ
);

512 
fd˘æ
->
dma_í
 = 0;

514 
i
 = 0; i < 2; i++) {

515 
	`fd_öô
(&
fd˘æ
->
drives
[
i
], 
fds
[i]);

517 
	`fd˘æ_ª£t
(
fd˘æ
, 0);

518 
fd˘æ
->
°©e
 = 
FD_CTRL_ACTIVE
;

519 i‡(
mem_m≠≥d
) {

520 
io_mem
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
fd˘æ_mem_ªad
, 
fd˘æ_mem_wrôe
, 
fd˘æ
);

521 
	`˝u_ªgi°î_physiˇl_mem‹y
(
io_ba£
, 0x08, 
io_mem
);

523 
	`ªgi°î_i›‹t_ªad
(
io_ba£
 + 0x01, 5, 1, &
fd˘æ_ªad
, 
fd˘æ
);

524 
	`ªgi°î_i›‹t_ªad
(
io_ba£
 + 0x07, 1, 1, &
fd˘æ_ªad
, 
fd˘æ
);

525 
	`ªgi°î_i›‹t_wrôe
(
io_ba£
 + 0x01, 5, 1, &
fd˘æ_wrôe
, 
fd˘æ
);

526 
	`ªgi°î_i›‹t_wrôe
(
io_ba£
 + 0x07, 1, 1, &
fd˘æ_wrôe
, 
fd˘æ
);

528 
i
 = 0; i < 2; i++) {

529 
	`fd_ªvÆid©e
(&
fd˘æ
->
drives
[
i
]);

532  
fd˘æ
;

533 
	}
}

536 
	$fd˘æ_gë_drive_ty≥
(
fd˘æ_t
 *
fd˘æ
, 
drive_num
)

538  
fd˘æ
->
drives
[
drive_num
].
drive
;

539 
	}
}

542 
	$fd˘æ_ª£t_úq
 (
fd˘æ_t
 *
fd˘æ
)

544 
	`FLOPPY_DPRINTF
("Reset interrupt\n");

545 
	`pic_£t_úq
(
fd˘æ
->
úq_lvl
, 0);

546 
fd˘æ
->
°©e
 &~
FD_CTRL_INTR
;

547 
	}
}

549 
	$fd˘æ_øi£_úq
 (
fd˘æ_t
 *
fd˘æ
, 
uöt8_t
 
°©us
)

551 #ifde‡
TARGET_SPARC


553 i‡(!
fd˘æ
->
dma_í
) {

554 
fd˘æ
->
°©e
 &~
FD_CTRL_BUSY
;

555 
fd˘æ
->
öt_°©us
 = 
°©us
;

559 i‡(~(
fd˘æ
->
°©e
 & 
FD_CTRL_INTR
)) {

560 
	`pic_£t_úq
(
fd˘æ
->
úq_lvl
, 1);

561 
fd˘æ
->
°©e
 |
FD_CTRL_INTR
;

563 
	`FLOPPY_DPRINTF
("Së i¡îru± sètu†tÿ0x%02x\n", 
°©us
);

564 
fd˘æ
->
öt_°©us
 = 
°©us
;

565 
	}
}

568 
	$fd˘æ_ª£t
 (
fd˘æ_t
 *
fd˘æ
, 
do_úq
)

570 
i
;

572 
	`FLOPPY_DPRINTF
("reset controller\n");

573 
	`fd˘æ_ª£t_úq
(
fd˘æ
);

575 
fd˘æ
->
cur_drv
 = 0;

577 
fd˘æ
->
d©a_pos
 = 0;

578 
fd˘æ
->
d©a_Àn
 = 0;

579 
fd˘æ
->
d©a_°©e
 = 
FD_STATE_CMD
;

580 
fd˘æ
->
d©a_dú
 = 
FD_DIR_WRITE
;

581 
i
 = 0; i < 
MAX_FD
; i++)

582 
	`fd_ª£t
(&
fd˘æ
->
drives
[
i
]);

583 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

584 i‡(
do_úq
)

585 
	`fd˘æ_øi£_úq
(
fd˘æ
, 0xc0);

586 
	}
}

588 
ölöe
 
fdrive_t
 *
	$drv0
 (
fd˘æ_t
 *
fd˘æ
)

590  &
fd˘æ
->
drives
[fd˘æ->
boŸ£l
];

591 
	}
}

593 
ölöe
 
fdrive_t
 *
	$drv1
 (
fd˘æ_t
 *
fd˘æ
)

595  &
fd˘æ
->
drives
[1 - fd˘æ->
boŸ£l
];

596 
	}
}

598 
fdrive_t
 *
	$gë_cur_drv
 (
fd˘æ_t
 *
fd˘æ
)

600  
fd˘æ
->
cur_drv
 =0 ? 
	`drv0
(fd˘æË: 
	`drv1
(fdctrl);

601 
	}
}

604 
uöt32_t
 
	$fd˘æ_ªad_°©usB
 (
fd˘æ_t
 *
fd˘æ
)

606 
	`FLOPPY_DPRINTF
("statusÑegister: 0x00\n");

608 
	}
}

611 
uöt32_t
 
	$fd˘æ_ªad_d‹
 (
fd˘æ_t
 *
fd˘æ
)

613 
uöt32_t
 
ªtvÆ
 = 0;

616 i‡(
	`drv0
(
fd˘æ
)->
drÊags
 & 
FDRIVE_MOTOR_ON
)

617 
ªtvÆ
 |= 1 << 5;

618 i‡(
	`drv1
(
fd˘æ
)->
drÊags
 & 
FDRIVE_MOTOR_ON
)

619 
ªtvÆ
 |= 1 << 4;

621 
ªtvÆ
 |
fd˘æ
->
dma_í
 << 3;

623 
ªtvÆ
 |(
fd˘æ
->
°©e
 & 
FD_CTRL_RESET
) == 0 ? 0x04 : 0;

625 
ªtvÆ
 |
fd˘æ
->
cur_drv
;

626 
	`FLOPPY_DPRINTF
("digôÆ ouçuàªgi°î: 0x%02x\n", 
ªtvÆ
);

628  
ªtvÆ
;

629 
	}
}

631 
	$fd˘æ_wrôe_d‹
 (
fd˘æ_t
 *
fd˘æ
, 
uöt32_t
 
vÆue
)

634 i‡(
fd˘æ
->
°©e
 & 
FD_CTRL_RESET
) {

635 i‡(!(
vÆue
 & 0x04)) {

636 
	`FLOPPY_DPRINTF
("Floppy controller in RESET state !\n");

640 
	`FLOPPY_DPRINTF
("digôÆ ouçuàªgi°î sëÅÿ0x%02x\n", 
vÆue
);

642 i‡(
vÆue
 & 0x20)

643 
	`fd_°¨t
(
	`drv1
(
fd˘æ
));

645 
	`fd_°›
(
	`drv1
(
fd˘æ
));

646 i‡(
vÆue
 & 0x10)

647 
	`fd_°¨t
(
	`drv0
(
fd˘æ
));

649 
	`fd_°›
(
	`drv0
(
fd˘æ
));

652 i‡(
fd˘æ
->
dma_ch™n
 != -1)

653 
fd˘æ
->
dma_í
 = 1 - ((
vÆue
 >> 3) & 1);

656 i‡(!(
vÆue
 & 0x04)) {

657 i‡(!(
fd˘æ
->
°©e
 & 
FD_CTRL_RESET
)) {

658 
	`FLOPPY_DPRINTF
("controllerÉnter RESET state\n");

659 
fd˘æ
->
°©e
 |
FD_CTRL_RESET
;

662 i‡(
fd˘æ
->
°©e
 & 
FD_CTRL_RESET
) {

663 
	`FLOPPY_DPRINTF
("controller out of RESET state\n");

664 
	`fd˘æ_ª£t
(
fd˘æ
, 1);

665 
fd˘æ
->
°©e
 &~(
FD_CTRL_RESET
 | 
FD_CTRL_SLEEP
);

669 
fd˘æ
->
cur_drv
 = 
vÆue
 & 1;

670 
	}
}

673 
uöt32_t
 
	$fd˘æ_ªad_è≥
 (
fd˘æ_t
 *
fd˘æ
)

675 
uöt32_t
 
ªtvÆ
 = 0;

678 
ªtvÆ
 |
fd˘æ
->
boŸ£l
 << 2;

680 
	`FLOPPY_DPRINTF
("è≥ drivêªgi°î: 0x%02x\n", 
ªtvÆ
);

682  
ªtvÆ
;

683 
	}
}

685 
	$fd˘æ_wrôe_è≥
 (
fd˘æ_t
 *
fd˘æ
, 
uöt32_t
 
vÆue
)

688 i‡(
fd˘æ
->
°©e
 & 
FD_CTRL_RESET
) {

689 
	`FLOPPY_DPRINTF
("Floppy controller in RESET state !\n");

692 
	`FLOPPY_DPRINTF
("è≥ drivêªgi°î sëÅÿ0x%02x\n", 
vÆue
);

694 
fd˘æ
->
boŸ£l
 = (
vÆue
 >> 2) & 1;

696 
	}
}

699 
uöt32_t
 
	$fd˘æ_ªad_maö_°©us
 (
fd˘æ_t
 *
fd˘æ
)

701 
uöt32_t
 
ªtvÆ
 = 0;

703 
fd˘æ
->
°©e
 &~(
FD_CTRL_SLEEP
 | 
FD_CTRL_RESET
);

704 i‡(!(
fd˘æ
->
°©e
 & 
FD_CTRL_BUSY
)) {

706 
ªtvÆ
 |= 0x80;

708 i‡(
fd˘æ
->
d©a_dú
 =
FD_DIR_READ
)

709 
ªtvÆ
 |= 0x40;

713 i‡(
	`FD_STATE
(
fd˘æ
->
d©a_°©e
Ë=
FD_STATE_DATA
 ||

714 
	`FD_STATE
(
fd˘æ
->
d©a_°©e
Ë=
FD_STATE_STATUS
)

715 
ªtvÆ
 |= 0x10;

716 
	`FLOPPY_DPRINTF
("maö sètu†ªgi°î: 0x%02x\n", 
ªtvÆ
);

718  
ªtvÆ
;

719 
	}
}

722 
	$fd˘æ_wrôe_øã
 (
fd˘æ_t
 *
fd˘æ
, 
uöt32_t
 
vÆue
)

725 i‡(
fd˘æ
->
°©e
 & 
FD_CTRL_RESET
) {

726 
	`FLOPPY_DPRINTF
("Floppy controller in RESET state !\n");

729 
	`FLOPPY_DPRINTF
("£À˘Ñ©êªgi°î sëÅÿ0x%02x\n", 
vÆue
);

731 i‡(
vÆue
 & 0x80) {

732 
fd˘æ
->
°©e
 |
FD_CTRL_RESET
;

733 
	`fd˘æ_ª£t
(
fd˘æ
, 1);

734 
fd˘æ
->
°©e
 &~
FD_CTRL_RESET
;

736 i‡(
vÆue
 & 0x40) {

737 
fd˘æ
->
°©e
 |
FD_CTRL_SLEEP
;

738 
	`fd˘æ_ª£t
(
fd˘æ
, 1);

741 
	}
}

743 
	$fd˘æ_medü_ch™ged
(
fdrive_t
 *
drv
)

745 
ªt
;

746 i‡(!
drv
->
bs
)

748 
ªt
 = 
	`bdrv_medü_ch™ged
(
drv
->
bs
);

749 i‡(
ªt
) {

750 
	`fd_ªvÆid©e
(
drv
);

752  
ªt
;

753 
	}
}

756 
uöt32_t
 
	$fd˘æ_ªad_dú
 (
fd˘æ_t
 *
fd˘æ
)

758 
uöt32_t
 
ªtvÆ
 = 0;

760 i‡(
	`fd˘æ_medü_ch™ged
(
	`drv0
(
fd˘æ
)) ||

761 
	`fd˘æ_medü_ch™ged
(
	`drv1
(
fd˘æ
)))

762 
ªtvÆ
 |= 0x80;

763 i‡(
ªtvÆ
 != 0)

764 
	`FLOPPY_DPRINTF
("Fl›py digôÆ i≈uàªgi°î: 0x%02x\n", 
ªtvÆ
);

766  
ªtvÆ
;

767 
	}
}

770 
	$fd˘æ_ª£t_fifo
 (
fd˘æ_t
 *
fd˘æ
)

772 
fd˘æ
->
d©a_dú
 = 
FD_DIR_WRITE
;

773 
fd˘æ
->
d©a_pos
 = 0;

774 
	`FD_SET_STATE
(
fd˘æ
->
d©a_°©e
, 
FD_STATE_CMD
);

775 
	}
}

778 
	$fd˘æ_£t_fifo
 (
fd˘æ_t
 *
fd˘æ
, 
fifo_Àn
, 
do_úq
)

780 
fd˘æ
->
d©a_dú
 = 
FD_DIR_READ
;

781 
fd˘æ
->
d©a_Àn
 = 
fifo_Àn
;

782 
fd˘æ
->
d©a_pos
 = 0;

783 
	`FD_SET_STATE
(
fd˘æ
->
d©a_°©e
, 
FD_STATE_STATUS
);

784 i‡(
do_úq
)

785 
	`fd˘æ_øi£_úq
(
fd˘æ
, 0x00);

786 
	}
}

789 
	$fd˘æ_unim∂emíãd
 (
fd˘æ_t
 *
fd˘æ
)

792 
fdrive_t
 *
cur_drv
;

794 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

795 
fd˘æ
->
fifo
[0] = 0x60 | (
cur_drv
->
hód
 << 2) | fdctrl->cur_drv;

796 
fd˘æ
->
fifo
[1] = 0x00;

797 
fd˘æ
->
fifo
[2] = 0x00;

798 
	`fd˘æ_£t_fifo
(
fd˘æ
, 3, 1);

801 
fd˘æ
->
fifo
[0] = 0x80;

802 
	`fd˘æ_£t_fifo
(
fd˘æ
, 1, 0);

804 
	}
}

807 
	$fd˘æ_°›_å™s„r
 (
fd˘æ_t
 *
fd˘æ
, 
uöt8_t
 
°©us0
,

808 
uöt8_t
 
°©us1
, uöt8_à
°©us2
)

810 
fdrive_t
 *
cur_drv
;

812 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

813 
	`FLOPPY_DPRINTF
("transfer status: %02x %02x %02x (%02x)\n",

814 
°©us0
, 
°©us1
, 
°©us2
,

815 
°©us0
 | (
cur_drv
->
hód
 << 2Ë| 
fd˘æ
->cur_drv);

816 
fd˘æ
->
fifo
[0] = 
°©us0
 | (
cur_drv
->
hód
 << 2) | fdctrl->cur_drv;

817 
fd˘æ
->
fifo
[1] = 
°©us1
;

818 
fd˘æ
->
fifo
[2] = 
°©us2
;

819 
fd˘æ
->
fifo
[3] = 
cur_drv
->
åack
;

820 
fd˘æ
->
fifo
[4] = 
cur_drv
->
hód
;

821 
fd˘æ
->
fifo
[5] = 
cur_drv
->
£˘
;

822 
fd˘æ
->
fifo
[6] = 
FD_SECTOR_SC
;

823 
fd˘æ
->
d©a_dú
 = 
FD_DIR_READ
;

824 i‡(
fd˘æ
->
°©e
 & 
FD_CTRL_BUSY
) {

825 
	`DMA_ªÀa£_DREQ
(
fd˘æ
->
dma_ch™n
);

826 
fd˘æ
->
°©e
 &~
FD_CTRL_BUSY
;

828 
	`fd˘æ_£t_fifo
(
fd˘æ
, 7, 1);

829 
	}
}

832 
	$fd˘æ_°¨t_å™s„r
 (
fd˘æ_t
 *
fd˘æ
, 
dúe˘i⁄
)

834 
fdrive_t
 *
cur_drv
;

835 
uöt8_t
 
kh
, 
kt
, 
ks
;

836 
did_£ek
;

838 
fd˘æ
->
cur_drv
 = fd˘æ->
fifo
[1] & 1;

839 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

840 
kt
 = 
fd˘æ
->
fifo
[2];

841 
kh
 = 
fd˘æ
->
fifo
[3];

842 
ks
 = 
fd˘æ
->
fifo
[4];

843 
	`FLOPPY_DPRINTF
("StartÅransferát %d %d %02x %02x (%d)\n",

844 
fd˘æ
->
cur_drv
, 
kh
, 
kt
, 
ks
,

845 
	`_fd_£˘‹
(
kh
, 
kt
, 
ks
, 
cur_drv
->
œ°_£˘
));

846 
did_£ek
 = 0;

847 
	`fd_£ek
(
cur_drv
, 
kh
, 
kt
, 
ks
, 
fd˘æ
->
c⁄fig
 & 0x40)) {

850 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x40, 0x00, 0x00);

851 
fd˘æ
->
fifo
[3] = 
kt
;

852 
fd˘æ
->
fifo
[4] = 
kh
;

853 
fd˘æ
->
fifo
[5] = 
ks
;

857 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x40, 0x80, 0x00);

858 
fd˘æ
->
fifo
[3] = 
kt
;

859 
fd˘æ
->
fifo
[4] = 
kh
;

860 
fd˘æ
->
fifo
[5] = 
ks
;

864 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x40, 0x00, 0x00);

865 
fd˘æ
->
fifo
[3] = 
kt
;

866 
fd˘æ
->
fifo
[4] = 
kh
;

867 
fd˘æ
->
fifo
[5] = 
ks
;

870 
did_£ek
 = 1;

876 
fd˘æ
->
d©a_dú
 = 
dúe˘i⁄
;

877 
fd˘æ
->
d©a_pos
 = 0;

878 
	`FD_SET_STATE
(
fd˘æ
->
d©a_°©e
, 
FD_STATE_DATA
);

879 i‡(
fd˘æ
->
fifo
[0] & 0x80)

880 
fd˘æ
->
d©a_°©e
 |
FD_STATE_MULTI
;

882 
fd˘æ
->
d©a_°©e
 &~
FD_STATE_MULTI
;

883 i‡(
did_£ek
)

884 
fd˘æ
->
d©a_°©e
 |
FD_STATE_SEEK
;

886 
fd˘æ
->
d©a_°©e
 &~
FD_STATE_SEEK
;

887 i‡(
fd˘æ
->
fifo
[5] == 00) {

888 
fd˘æ
->
d©a_Àn
 = fd˘æ->
fifo
[8];

890 
tmp
;

891 
fd˘æ
->
d©a_Àn
 = 128 << (fd˘æ->
fifo
[5] > 7 ? 7 : fdctrl->fifo[5]);

892 
tmp
 = (
cur_drv
->
œ°_£˘
 - 
ks
 + 1);

893 i‡(
fd˘æ
->
fifo
[0] & 0x80)

894 
tmp
 +
cur_drv
->
œ°_£˘
;

895 
fd˘æ
->
d©a_Àn
 *
tmp
;

897 
fd˘æ
->
eŸ
 = fd˘æ->
fifo
[6];

898 i‡(
fd˘æ
->
dma_í
) {

899 
dma_mode
;

901 
dma_mode
 = 
	`DMA_gë_ch™√l_mode
(
fd˘æ
->
dma_ch™n
);

902 
dma_mode
 = (dma_mode >> 2) & 3;

903 
	`FLOPPY_DPRINTF
("dma_mode=%d direction=%d (%d - %d)\n",

904 
dma_mode
, 
dúe˘i⁄
,

905 (128 << 
fd˘æ
->
fifo
[5]) *

906 (
cur_drv
->
œ°_£˘
 - 
ks
 + 1), 
fd˘æ
->
d©a_Àn
);

907 i‡(((
dúe˘i⁄
 =
FD_DIR_SCANE
 || dúe˘i⁄ =
FD_DIR_SCANL
 ||

908 
dúe˘i⁄
 =
FD_DIR_SCANH
Ë&& 
dma_mode
 == 0) ||

909 (
dúe˘i⁄
 =
FD_DIR_WRITE
 && 
dma_mode
 == 2) ||

910 (
dúe˘i⁄
 =
FD_DIR_READ
 && 
dma_mode
 == 1)) {

912 
fd˘æ
->
°©e
 |
FD_CTRL_BUSY
;

916 
	`DMA_hﬁd_DREQ
(
fd˘æ
->
dma_ch™n
);

917 
	`DMA_scheduÀ
(
fd˘æ
->
dma_ch™n
);

920 
	`FLOPPY_ERROR
("dma_mode=%d dúe˘i⁄=%d\n", 
dma_mode
, 
dúe˘i⁄
);

923 
	`FLOPPY_DPRINTF
("startÇon-DMAÅransfer\n");

925 
	`fd˘æ_øi£_úq
(
fd˘æ
, 0x00);

928 
	}
}

931 
	$fd˘æ_°¨t_å™s„r_dñ
 (
fd˘æ_t
 *
fd˘æ
, 
dúe˘i⁄
)

936 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x60, 0x00, 0x00);

937 
	}
}

940 
	$fd˘æ_å™s„r_h™dÀr
 (*
›aque
, 
nch™
,

941 
dma_pos
, 
dma_Àn
)

943 
fd˘æ_t
 *
fd˘æ
;

944 
fdrive_t
 *
cur_drv
;

945 
Àn
, 
°¨t_pos
, 
ªl_pos
;

946 
uöt8_t
 
°©us0
 = 0x00, 
°©us1
 = 0x00, 
°©us2
 = 0x00;

948 
fd˘æ
 = 
›aque
;

949 i‡(!(
fd˘æ
->
°©e
 & 
FD_CTRL_BUSY
)) {

950 
	`FLOPPY_DPRINTF
("Not in DMAÅransfer mode !\n");

953 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

954 i‡(
fd˘æ
->
d©a_dú
 =
FD_DIR_SCANE
 || fd˘æ->d©a_dú =
FD_DIR_SCANL
 ||

955 
fd˘æ
->
d©a_dú
 =
FD_DIR_SCANH
)

956 
°©us2
 = 0x04;

957 i‡(
dma_Àn
 > 
fd˘æ
->
d©a_Àn
)

958 
dma_Àn
 = 
fd˘æ
->
d©a_Àn
;

959 i‡(
cur_drv
->
bs
 =
NULL
) {

960 i‡(
fd˘æ
->
d©a_dú
 =
FD_DIR_WRITE
)

961 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x60, 0x00, 0x00);

963 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x40, 0x00, 0x00);

964 
Àn
 = 0;

965 
å™s„r_îr‹
;

967 
ªl_pos
 = 
fd˘æ
->
d©a_pos
 % 
FD_SECTOR_LEN
;

968 
°¨t_pos
 = 
fd˘æ
->
d©a_pos
; fd˘æ->d©a_po†< 
dma_Àn
;) {

969 
Àn
 = 
dma_Àn
 - 
fd˘æ
->
d©a_pos
;

970 i‡(
Àn
 + 
ªl_pos
 > 
FD_SECTOR_LEN
)

971 
Àn
 = 
FD_SECTOR_LEN
 - 
ªl_pos
;

972 
	`FLOPPY_DPRINTF
("copy %d bytes (%d %d %d) %dÖos %d %02x "

973 "(%d-0x%08x 0x%08x)\n", 
Àn
, 
dma_Àn
, 
fd˘æ
->
d©a_pos
,

974 
fd˘æ
->
d©a_Àn
, fd˘æ->
cur_drv
, cur_drv->
hód
,

975 
cur_drv
->
åack
, cur_drv->
£˘
, 
	`fd_£˘‹
(cur_drv),

976 
	`fd_£˘‹
(
cur_drv
) * 512);

977 i‡(
fd˘æ
->
d©a_dú
 !
FD_DIR_WRITE
 ||

978 
Àn
 < 
FD_SECTOR_LEN
 || 
ªl_pos
 != 0) {

980 i‡(
	`bdrv_ªad
(
cur_drv
->
bs
, 
	`fd_£˘‹
(cur_drv),

981 
fd˘æ
->
fifo
, 1) < 0) {

982 
	`FLOPPY_DPRINTF
("Floppy:Érror getting sector %d\n",

983 
	`fd_£˘‹
(
cur_drv
));

985 
	`mem£t
(
fd˘æ
->
fifo
, 0, 
FD_SECTOR_LEN
);

988 
fd˘æ
->
d©a_dú
) {

989 
FD_DIR_READ
:

991 
	`DMA_wrôe_mem‹y
 (
nch™
, 
fd˘æ
->
fifo
 + 
ªl_pos
,

992 
fd˘æ
->
d©a_pos
, 
Àn
);

996 
FD_DIR_WRITE
:

998 
	`DMA_ªad_mem‹y
 (
nch™
, 
fd˘æ
->
fifo
 + 
ªl_pos
,

999 
fd˘æ
->
d©a_pos
, 
Àn
);

1002 i‡(
	`bdrv_wrôe
(
cur_drv
->
bs
, 
	`fd_£˘‹
(cur_drv),

1003 
fd˘æ
->
fifo
, 1) < 0) {

1004 
	`FLOPPY_ERROR
("wrôtög se˘‹ %d\n", 
	`fd_£˘‹
(
cur_drv
));

1005 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x60, 0x00, 0x00);

1006 
å™s„r_îr‹
;

1012 
uöt8_t
 
tmpbuf
[
FD_SECTOR_LEN
];

1013 
ªt
;

1014 
	`DMA_ªad_mem‹y
 (
nch™
, 
tmpbuf
, 
fd˘æ
->
d©a_pos
, 
Àn
);

1017 
ªt
 = 
	`memcmp
(
tmpbuf
, 
fd˘æ
->
fifo
 + 
ªl_pos
, 
Àn
);

1018 i‡(
ªt
 == 0) {

1019 
°©us2
 = 0x08;

1020 
íd_å™s„r
;

1022 i‡((
ªt
 < 0 && 
fd˘æ
->
d©a_dú
 =
FD_DIR_SCANL
) ||

1023 (
ªt
 > 0 && 
fd˘æ
->
d©a_dú
 =
FD_DIR_SCANH
)) {

1024 
°©us2
 = 0x00;

1025 
íd_å™s„r
;

1030 
fd˘æ
->
d©a_pos
 +
Àn
;

1031 
ªl_pos
 = 
fd˘æ
->
d©a_pos
 % 
FD_SECTOR_LEN
;

1032 i‡(
ªl_pos
 == 0) {

1034 
	`FLOPPY_DPRINTF
("seekÅoÇext sector (%d %02x %02x => %d) (%d)\n",

1035 
cur_drv
->
hód
, cur_drv->
åack
, cur_drv->
£˘
,

1036 
	`fd_£˘‹
(
cur_drv
),

1037 
fd˘æ
->
d©a_pos
 - 
Àn
);

1040 i‡(
cur_drv
->
£˘
 >cur_drv->
œ°_£˘
 ||

1041 
cur_drv
->
£˘
 =
fd˘æ
->
eŸ
) {

1042 
cur_drv
->
£˘
 = 1;

1043 i‡(
	`FD_MULTI_TRACK
(
fd˘æ
->
d©a_°©e
)) {

1044 i‡(
cur_drv
->
hód
 == 0 &&

1045 (
cur_drv
->
Êags
 & 
FDISK_DBL_SIDES
) != 0) {

1046 
cur_drv
->
hód
 = 1;

1048 
cur_drv
->
hód
 = 0;

1049 
cur_drv
->
åack
++;

1050 i‡((
cur_drv
->
Êags
 & 
FDISK_DBL_SIDES
) == 0)

1054 
cur_drv
->
åack
++;

1057 
	`FLOPPY_DPRINTF
("seekÅoÇextÅrack (%d %02x %02x => %d)\n",

1058 
cur_drv
->
hód
, cur_drv->
åack
,

1059 
cur_drv
->
£˘
, 
	`fd_£˘‹
(cur_drv));

1061 
cur_drv
->
£˘
++;

1065 
íd_å™s„r
:

1066 
Àn
 = 
fd˘æ
->
d©a_pos
 - 
°¨t_pos
;

1067 
	`FLOPPY_DPRINTF
("endÅransfer %d %d %d\n",

1068 
fd˘æ
->
d©a_pos
, 
Àn
, fd˘æ->
d©a_Àn
);

1069 i‡(
fd˘æ
->
d©a_dú
 =
FD_DIR_SCANE
 ||

1070 
fd˘æ
->
d©a_dú
 =
FD_DIR_SCANL
 ||

1071 
fd˘æ
->
d©a_dú
 =
FD_DIR_SCANH
)

1072 
°©us2
 = 0x08;

1073 i‡(
	`FD_DID_SEEK
(
fd˘æ
->
d©a_°©e
))

1074 
°©us0
 |= 0x20;

1075 
fd˘æ
->
d©a_Àn
 -
Àn
;

1077 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 
°©us0
, 
°©us1
, 
°©us2
);

1078 
å™s„r_îr‹
:

1080  
Àn
;

1081 
	}
}

1084 
uöt32_t
 
	$fd˘æ_ªad_d©a
 (
fd˘æ_t
 *
fd˘æ
)

1086 
fdrive_t
 *
cur_drv
;

1087 
uöt32_t
 
ªtvÆ
 = 0;

1088 
pos
, 
Àn
;

1090 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1091 
fd˘æ
->
°©e
 &~
FD_CTRL_SLEEP
;

1092 i‡(
	`FD_STATE
(
fd˘æ
->
d©a_°©e
Ë=
FD_STATE_CMD
) {

1093 
	`FLOPPY_ERROR
("can'tÑead data in CMD state\n");

1096 
pos
 = 
fd˘æ
->
d©a_pos
;

1097 i‡(
	`FD_STATE
(
fd˘æ
->
d©a_°©e
Ë=
FD_STATE_DATA
) {

1098 
pos
 %
FD_SECTOR_LEN
;

1099 i‡(
pos
 == 0) {

1100 
Àn
 = 
fd˘æ
->
d©a_Àn
 - fd˘æ->
d©a_pos
;

1101 i‡(
Àn
 > 
FD_SECTOR_LEN
)

1102 
Àn
 = 
FD_SECTOR_LEN
;

1103 i‡(
cur_drv
->
bs
) {

1104 
	`bdrv_ªad
(
cur_drv
->
bs
, 
	`fd_£˘‹
(cur_drv),

1105 
fd˘æ
->
fifo
, 
Àn
);

1107 
	`FLOPPY_ERROR
("can'tÑead data from drive\n");

1112 
ªtvÆ
 = 
fd˘æ
->
fifo
[
pos
];

1113 i‡(++
fd˘æ
->
d©a_pos
 =fd˘æ->
d©a_Àn
) {

1114 
fd˘æ
->
d©a_pos
 = 0;

1118 i‡(
	`FD_STATE
(
fd˘æ
->
d©a_°©e
Ë=
FD_STATE_DATA
) {

1119 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x20, 0x00, 0x00);

1121 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1122 
	`fd˘æ_ª£t_úq
(
fd˘æ
);

1125 
	`FLOPPY_DPRINTF
("d©®ªgi°î: 0x%02x\n", 
ªtvÆ
);

1127  
ªtvÆ
;

1128 
	}
}

1130 
	$fd˘æ_f‹m©_£˘‹
 (
fd˘æ_t
 *
fd˘æ
)

1132 
fdrive_t
 *
cur_drv
;

1133 
uöt8_t
 
kh
, 
kt
, 
ks
;

1134 
did_£ek
;

1136 
fd˘æ
->
cur_drv
 = fd˘æ->
fifo
[1] & 1;

1137 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1138 
kt
 = 
fd˘æ
->
fifo
[6];

1139 
kh
 = 
fd˘æ
->
fifo
[7];

1140 
ks
 = 
fd˘æ
->
fifo
[8];

1141 
	`FLOPPY_DPRINTF
("format sectorát %d %d %02x %02x (%d)\n",

1142 
fd˘æ
->
cur_drv
, 
kh
, 
kt
, 
ks
,

1143 
	`_fd_£˘‹
(
kh
, 
kt
, 
ks
, 
cur_drv
->
œ°_£˘
));

1144 
did_£ek
 = 0;

1145 
	`fd_£ek
(
cur_drv
, 
kh
, 
kt
, 
ks
, 
fd˘æ
->
c⁄fig
 & 0x40)) {

1148 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x40, 0x00, 0x00);

1149 
fd˘æ
->
fifo
[3] = 
kt
;

1150 
fd˘æ
->
fifo
[4] = 
kh
;

1151 
fd˘æ
->
fifo
[5] = 
ks
;

1155 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x40, 0x80, 0x00);

1156 
fd˘æ
->
fifo
[3] = 
kt
;

1157 
fd˘æ
->
fifo
[4] = 
kh
;

1158 
fd˘æ
->
fifo
[5] = 
ks
;

1162 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x40, 0x00, 0x00);

1163 
fd˘æ
->
fifo
[3] = 
kt
;

1164 
fd˘æ
->
fifo
[4] = 
kh
;

1165 
fd˘æ
->
fifo
[5] = 
ks
;

1168 
did_£ek
 = 1;

1169 
fd˘æ
->
d©a_°©e
 |
FD_STATE_SEEK
;

1174 
	`mem£t
(
fd˘æ
->
fifo
, 0, 
FD_SECTOR_LEN
);

1175 i‡(
cur_drv
->
bs
 =
NULL
 ||

1176 
	`bdrv_wrôe
(
cur_drv
->
bs
, 
	`fd_£˘‹
(cur_drv), 
fd˘æ
->
fifo
, 1) < 0) {

1177 
	`FLOPPY_ERROR
("f‹m©ög se˘‹ %d\n", 
	`fd_£˘‹
(
cur_drv
));

1178 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x60, 0x00, 0x00);

1180 i‡(
cur_drv
->
£˘
 =cur_drv->
œ°_£˘
) {

1181 
fd˘æ
->
d©a_°©e
 &~
FD_STATE_FORMAT
;

1183 i‡(
	`FD_DID_SEEK
(
fd˘æ
->
d©a_°©e
))

1184 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x20, 0x00, 0x00);

1186 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x00, 0x00, 0x00);

1189 
fd˘æ
->
d©a_pos
 = 0;

1190 
fd˘æ
->
d©a_Àn
 = 4;

1193 
	}
}

1195 
	$fd˘æ_wrôe_d©a
 (
fd˘æ_t
 *
fd˘æ
, 
uöt32_t
 
vÆue
)

1197 
fdrive_t
 *
cur_drv
;

1199 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1201 i‡(
fd˘æ
->
°©e
 & 
FD_CTRL_RESET
) {

1202 
	`FLOPPY_DPRINTF
("Floppy controller in RESET state !\n");

1205 
fd˘æ
->
°©e
 &~
FD_CTRL_SLEEP
;

1206 i‡(
	`FD_STATE
(
fd˘æ
->
d©a_°©e
Ë=
FD_STATE_STATUS
) {

1207 
	`FLOPPY_ERROR
("can't write data in status mode\n");

1211 i‡(
	`FD_STATE
(
fd˘æ
->
d©a_°©e
Ë=
FD_STATE_DATA
) {

1213 
fd˘æ
->
fifo
[fd˘æ->
d©a_pos
++] = 
vÆue
;

1214 i‡(
fd˘æ
->
d©a_pos
 % 
FD_SECTOR_LEN
 == (FD_SECTOR_LEN - 1) ||

1215 
fd˘æ
->
d©a_pos
 =fd˘æ->
d©a_Àn
) {

1216 
	`bdrv_wrôe
(
cur_drv
->
bs
, 
	`fd_£˘‹
(cur_drv),

1217 
fd˘æ
->
fifo
, 
FD_SECTOR_LEN
);

1222 i‡(
	`FD_STATE
(
fd˘æ
->
d©a_°©e
Ë=
FD_STATE_DATA
)

1223 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x20, 0x00, 0x00);

1226 i‡(
fd˘æ
->
d©a_pos
 == 0) {

1228 
vÆue
 & 0x5F) {

1231 
	`FLOPPY_DPRINTF
("READ command\n");

1233 
fd˘æ
->
d©a_Àn
 = 9;

1234 
íqueue
;

1237 
	`FLOPPY_DPRINTF
("READ_DELETED command\n");

1239 
fd˘æ
->
d©a_Àn
 = 9;

1240 
íqueue
;

1243 
	`FLOPPY_DPRINTF
("SCAN_EQUAL command\n");

1245 
fd˘æ
->
d©a_Àn
 = 9;

1246 
íqueue
;

1249 
	`FLOPPY_DPRINTF
("VERIFY command\n");

1251 
fd˘æ
->
d©a_Àn
 = 9;

1252 
íqueue
;

1255 
	`FLOPPY_DPRINTF
("SCAN_LOW_OR_EQUAL command\n");

1257 
fd˘æ
->
d©a_Àn
 = 9;

1258 
íqueue
;

1261 
	`FLOPPY_DPRINTF
("SCAN_HIGH_OR_EQUAL command\n");

1263 
fd˘æ
->
d©a_Àn
 = 9;

1264 
íqueue
;

1268 
vÆue
 & 0x7F) {

1271 
	`FLOPPY_DPRINTF
("WRITE command\n");

1273 
fd˘æ
->
d©a_Àn
 = 9;

1274 
íqueue
;

1277 
	`FLOPPY_DPRINTF
("WRITE_DELETED command\n");

1279 
fd˘æ
->
d©a_Àn
 = 9;

1280 
íqueue
;

1284 
vÆue
) {

1287 
	`FLOPPY_DPRINTF
("SPECIFY command\n");

1289 
fd˘æ
->
d©a_Àn
 = 3;

1290 
íqueue
;

1293 
	`FLOPPY_DPRINTF
("SENSE_DRIVE_STATUS command\n");

1295 
fd˘æ
->
d©a_Àn
 = 2;

1296 
íqueue
;

1299 
	`FLOPPY_DPRINTF
("RECALIBRATE command\n");

1301 
fd˘æ
->
d©a_Àn
 = 2;

1302 
íqueue
;

1305 
	`FLOPPY_DPRINTF
("SENSE_INTERRUPT_STATUS command (%02x)\n",

1306 
fd˘æ
->
öt_°©us
);

1309 
fd˘æ
->
fifo
[0] =

1310 
fd˘æ
->
öt_°©us
 | (
cur_drv
->
hód
 << 2) | fdctrl->cur_drv;

1315 
fd˘æ
->
fifo
[0] =

1316 0x20 | (
cur_drv
->
hód
 << 2Ë| 
fd˘æ
->cur_drv;

1318 
fd˘æ
->
fifo
[1] = 
cur_drv
->
åack
;

1319 
	`fd˘æ_£t_fifo
(
fd˘æ
, 2, 0);

1320 
	`fd˘æ_ª£t_úq
(
fd˘æ
);

1321 
fd˘æ
->
öt_°©us
 = 0xC0;

1325 
	`FLOPPY_DPRINTF
("DUMPREG command\n");

1327 
fd˘æ
->
fifo
[0] = 
	`drv0
(fd˘æ)->
åack
;

1328 
fd˘æ
->
fifo
[1] = 
	`drv1
(fd˘æ)->
åack
;

1329 
fd˘æ
->
fifo
[2] = 0;

1330 
fd˘æ
->
fifo
[3] = 0;

1332 
fd˘æ
->
fifo
[4] = fd˘æ->
timî0
;

1333 
fd˘æ
->
fifo
[5] = (fd˘æ->
timî1
 << 1Ë| fd˘æ->
dma_í
;

1334 
fd˘æ
->
fifo
[6] = 
cur_drv
->
œ°_£˘
;

1335 
fd˘æ
->
fifo
[7] = (fd˘æ->
lock
 << 7) |

1336 (
cur_drv
->
≥Ωídicuœr
 << 2);

1337 
fd˘æ
->
fifo
[8] = fd˘æ->
c⁄fig
;

1338 
fd˘æ
->
fifo
[9] = fd˘æ->
¥ecomp_åk
;

1339 
	`fd˘æ_£t_fifo
(
fd˘æ
, 10, 0);

1343 
	`FLOPPY_DPRINTF
("SEEK command\n");

1345 
fd˘æ
->
d©a_Àn
 = 3;

1346 
íqueue
;

1349 
	`FLOPPY_DPRINTF
("VERSION command\n");

1352 
fd˘æ
->
fifo
[0] = fd˘æ->
vîsi⁄
;

1353 
	`fd˘æ_£t_fifo
(
fd˘æ
, 1, 1);

1357 
	`FLOPPY_DPRINTF
("PERPENDICULAR_MODE command\n");

1359 
fd˘æ
->
d©a_Àn
 = 2;

1360 
íqueue
;

1363 
	`FLOPPY_DPRINTF
("CONFIGURE command\n");

1365 
fd˘æ
->
d©a_Àn
 = 4;

1366 
íqueue
;

1369 
	`FLOPPY_DPRINTF
("UNLOCK command\n");

1371 
fd˘æ
->
lock
 = 0;

1372 
fd˘æ
->
fifo
[0] = 0;

1373 
	`fd˘æ_£t_fifo
(
fd˘æ
, 1, 0);

1377 
	`FLOPPY_DPRINTF
("POWERDOWN_MODE command\n");

1379 
fd˘æ
->
d©a_Àn
 = 3;

1380 
íqueue
;

1383 
	`FLOPPY_DPRINTF
("PART_ID command\n");

1385 
fd˘æ
->
fifo
[0] = 0x41;

1386 
	`fd˘æ_£t_fifo
(
fd˘æ
, 1, 0);

1390 
	`FLOPPY_DPRINTF
("SAVE command\n");

1392 
fd˘æ
->
fifo
[0] = 0;

1393 
fd˘æ
->
fifo
[1] = 0;

1395 
fd˘æ
->
fifo
[2] = 
	`drv0
(fd˘æ)->
åack
;

1396 
fd˘æ
->
fifo
[3] = 
	`drv1
(fd˘æ)->
åack
;

1397 
fd˘æ
->
fifo
[4] = 0;

1398 
fd˘æ
->
fifo
[5] = 0;

1400 
fd˘æ
->
fifo
[6] = fd˘æ->
timî0
;

1401 
fd˘æ
->
fifo
[7] = fd˘æ->
timî1
;

1402 
fd˘æ
->
fifo
[8] = 
cur_drv
->
œ°_£˘
;

1403 
fd˘æ
->
fifo
[9] = (fd˘æ->
lock
 << 7) |

1404 (
cur_drv
->
≥Ωídicuœr
 << 2);

1405 
fd˘æ
->
fifo
[10] = fd˘æ->
c⁄fig
;

1406 
fd˘æ
->
fifo
[11] = fd˘æ->
¥ecomp_åk
;

1407 
fd˘æ
->
fifo
[12] = fd˘æ->
pwrd
;

1408 
fd˘æ
->
fifo
[13] = 0;

1409 
fd˘æ
->
fifo
[14] = 0;

1410 
	`fd˘æ_£t_fifo
(
fd˘æ
, 15, 1);

1414 
	`FLOPPY_DPRINTF
("OPTION command\n");

1416 
fd˘æ
->
d©a_Àn
 = 2;

1417 
íqueue
;

1420 
	`FLOPPY_DPRINTF
("READ_TRACK command\n");

1422 
fd˘æ
->
d©a_Àn
 = 9;

1423 
íqueue
;

1426 
	`FLOPPY_DPRINTF
("READ_ID command\n");

1428 
fd˘æ
->
d©a_Àn
 = 2;

1429 
íqueue
;

1432 
	`FLOPPY_DPRINTF
("RESTORE command\n");

1434 
fd˘æ
->
d©a_Àn
 = 18;

1435 
íqueue
;

1438 
	`FLOPPY_DPRINTF
("FORMAT_TRACK command\n");

1440 
fd˘æ
->
d©a_Àn
 = 6;

1441 
íqueue
;

1444 
	`FLOPPY_DPRINTF
("DRIVE_SPECIFICATION_COMMAND command\n");

1446 
fd˘æ
->
d©a_Àn
 = 6;

1447 
íqueue
;

1450 
	`FLOPPY_DPRINTF
("RELATIVE_SEEK_OUT command\n");

1452 
fd˘æ
->
d©a_Àn
 = 3;

1453 
íqueue
;

1456 
	`FLOPPY_DPRINTF
("LOCK command\n");

1458 
fd˘æ
->
lock
 = 1;

1459 
fd˘æ
->
fifo
[0] = 0x10;

1460 
	`fd˘æ_£t_fifo
(
fd˘æ
, 1, 1);

1464 
	`FLOPPY_DPRINTF
("FORMAT_AND_WRITE command\n");

1466 
fd˘æ
->
d©a_Àn
 = 11;

1467 
íqueue
;

1470 
	`FLOPPY_DPRINTF
("RELATIVE_SEEK_IN command\n");

1472 
fd˘æ
->
d©a_Àn
 = 3;

1473 
íqueue
;

1476 
	`FLOPPY_ERROR
("unknow¿comm™d: 0x%02x\n", 
vÆue
);

1477 
	`fd˘æ_unim∂emíãd
(
fd˘æ
);

1481 
íqueue
:

1482 
	`FLOPPY_DPRINTF
("%s: %02x\n", 
__func__
, 
vÆue
);

1483 
fd˘æ
->
fifo
[fd˘æ->
d©a_pos
] = 
vÆue
;

1484 i‡(++
fd˘æ
->
d©a_pos
 =fd˘æ->
d©a_Àn
) {

1488 i‡(
fd˘æ
->
d©a_°©e
 & 
FD_STATE_FORMAT
) {

1489 
	`fd˘æ_f‹m©_£˘‹
(
fd˘æ
);

1492 
fd˘æ
->
fifo
[0] & 0x1F) {

1496 
	`FLOPPY_DPRINTF
("treat READ command\n");

1497 
	`fd˘æ_°¨t_å™s„r
(
fd˘æ
, 
FD_DIR_READ
);

1503 
	`FLOPPY_ERROR
("treat READ_DELETED command\n");

1504 
	`fd˘æ_°¨t_å™s„r_dñ
(
fd˘æ
, 
FD_DIR_READ
);

1509 
	`FLOPPY_ERROR
("treat VERIFY command\n");

1510 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x20, 0x00, 0x00);

1515 
	`FLOPPY_ERROR
("treat SCAN_EQUAL command\n");

1516 
	`fd˘æ_°¨t_å™s„r
(
fd˘æ
, 
FD_DIR_SCANE
);

1521 
	`FLOPPY_ERROR
("treat SCAN_LOW_OR_EQUAL command\n");

1522 
	`fd˘æ_°¨t_å™s„r
(
fd˘æ
, 
FD_DIR_SCANL
);

1527 
	`FLOPPY_ERROR
("treat SCAN_HIGH_OR_EQUAL command\n");

1528 
	`fd˘æ_°¨t_å™s„r
(
fd˘æ
, 
FD_DIR_SCANH
);

1533 
fd˘æ
->
fifo
[0] & 0x3F) {

1536 
	`FLOPPY_DPRINTF
("åóàWRITE comm™d (%02x)\n", 
fd˘æ
->
fifo
[0]);

1537 
	`fd˘æ_°¨t_å™s„r
(
fd˘æ
, 
FD_DIR_WRITE
);

1542 
	`FLOPPY_ERROR
("treat WRITE_DELETED command\n");

1543 
	`fd˘æ_°¨t_å™s„r_dñ
(
fd˘æ
, 
FD_DIR_WRITE
);

1548 
fd˘æ
->
fifo
[0]) {

1551 
	`FLOPPY_DPRINTF
("treat SPECIFY command\n");

1552 
fd˘æ
->
timî0
 = (fd˘æ->
fifo
[1] >> 4) & 0xF;

1553 
fd˘æ
->
timî1
 = fd˘æ->
fifo
[2] >> 1;

1554 
fd˘æ
->
dma_í
 = 1 - (fd˘æ->
fifo
[2] & 1) ;

1556 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1560 
	`FLOPPY_DPRINTF
("treat SENSE_DRIVE_STATUS command\n");

1561 
fd˘æ
->
cur_drv
 = fd˘æ->
fifo
[1] & 1;

1562 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1563 
cur_drv
->
hód
 = (
fd˘æ
->
fifo
[1] >> 2) & 1;

1565 
fd˘æ
->
fifo
[0] = (
cur_drv
->
ro
 << 6) |

1566 (
cur_drv
->
åack
 == 0 ? 0x10 : 0x00) |

1567 (
cur_drv
->
hód
 << 2) |

1568 
fd˘æ
->
cur_drv
 |

1570 
	`fd˘æ_£t_fifo
(
fd˘æ
, 1, 0);

1574 
	`FLOPPY_DPRINTF
("treat RECALIBRATE command\n");

1575 
fd˘æ
->
cur_drv
 = fd˘æ->
fifo
[1] & 1;

1576 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1577 
	`fd_ªˇlibøã
(
cur_drv
);

1578 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1580 
	`fd˘æ_øi£_úq
(
fd˘æ
, 0x20);

1584 
	`FLOPPY_DPRINTF
("treat SEEK command\n");

1585 
fd˘æ
->
cur_drv
 = fd˘æ->
fifo
[1] & 1;

1586 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1587 
	`fd_°¨t
(
cur_drv
);

1588 i‡(
fd˘æ
->
fifo
[2] <
cur_drv
->
åack
)

1589 
cur_drv
->
dú
 = 1;

1591 
cur_drv
->
dú
 = 0;

1592 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1593 i‡(
fd˘æ
->
fifo
[2] > 
cur_drv
->
max_åack
) {

1594 
	`fd˘æ_øi£_úq
(
fd˘æ
, 0x60);

1596 
cur_drv
->
åack
 = 
fd˘æ
->
fifo
[2];

1598 
	`fd˘æ_øi£_úq
(
fd˘æ
, 0x20);

1603 
	`FLOPPY_DPRINTF
("treat PERPENDICULAR_MODE command\n");

1604 i‡(
fd˘æ
->
fifo
[1] & 0x80)

1605 
cur_drv
->
≥Ωídicuœr
 = 
fd˘æ
->
fifo
[1] & 0x7;

1607 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1611 
	`FLOPPY_DPRINTF
("treat CONFIGURE command\n");

1612 
fd˘æ
->
c⁄fig
 = fd˘æ->
fifo
[2];

1613 
fd˘æ
->
¥ecomp_åk
 = fd˘æ->
fifo
[3];

1615 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1619 
	`FLOPPY_DPRINTF
("treat POWERDOWN_MODE command\n");

1620 
fd˘æ
->
pwrd
 = fd˘æ->
fifo
[1];

1621 
fd˘æ
->
fifo
[0] = fdctrl->fifo[1];

1622 
	`fd˘æ_£t_fifo
(
fd˘æ
, 1, 1);

1626 
	`FLOPPY_DPRINTF
("treat OPTION command\n");

1628 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1633 
	`FLOPPY_ERROR
("treat READ_TRACK command\n");

1634 
	`fd˘æ_°¨t_å™s„r
(
fd˘æ
, 
FD_DIR_READ
);

1638 
	`FLOPPY_DPRINTF
("treat READ_ID command\n");

1640 
cur_drv
->
hód
 = (
fd˘æ
->
fifo
[1] >> 2) & 1;

1641 
	`qemu_mod_timî
(
fd˘æ
->
ªsu…_timî
,

1642 
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ (
ticks_≥r_£c
 / 50));

1646 
	`FLOPPY_DPRINTF
("treat RESTORE command\n");

1648 
	`drv0
(
fd˘æ
)->
åack
 = fd˘æ->
fifo
[3];

1649 
	`drv1
(
fd˘æ
)->
åack
 = fd˘æ->
fifo
[4];

1651 
fd˘æ
->
timî0
 = fd˘æ->
fifo
[7];

1652 
fd˘æ
->
timî1
 = fd˘æ->
fifo
[8];

1653 
cur_drv
->
œ°_£˘
 = 
fd˘æ
->
fifo
[9];

1654 
fd˘æ
->
lock
 = fd˘æ->
fifo
[10] >> 7;

1655 
cur_drv
->
≥Ωídicuœr
 = (
fd˘æ
->
fifo
[10] >> 2) & 0xF;

1656 
fd˘æ
->
c⁄fig
 = fd˘æ->
fifo
[11];

1657 
fd˘æ
->
¥ecomp_åk
 = fd˘æ->
fifo
[12];

1658 
fd˘æ
->
pwrd
 = fd˘æ->
fifo
[13];

1659 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1663 
	`FLOPPY_DPRINTF
("treat FORMAT_TRACK command\n");

1664 
fd˘æ
->
cur_drv
 = fd˘æ->
fifo
[1] & 1;

1665 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1666 
fd˘æ
->
d©a_°©e
 |
FD_STATE_FORMAT
;

1667 i‡(
fd˘æ
->
fifo
[0] & 0x80)

1668 
fd˘æ
->
d©a_°©e
 |
FD_STATE_MULTI
;

1670 
fd˘æ
->
d©a_°©e
 &~
FD_STATE_MULTI
;

1671 
fd˘æ
->
d©a_°©e
 &~
FD_STATE_SEEK
;

1672 
cur_drv
->
bps
 =

1673 
fd˘æ
->
fifo
[2] > 7 ? 16384 : 128 << fdctrl->fifo[2];

1675 
cur_drv
->
œ°_£˘
 =

1676 
cur_drv
->
Êags
 & 
FDISK_DBL_SIDES
 ? 
fd˘æ
->
fifo
[3] :

1677 
fd˘æ
->
fifo
[3] / 2;

1679 
cur_drv
->
œ°_£˘
 = 
fd˘æ
->
fifo
[3];

1685 
fd˘æ
->
d©a_°©e
 &~
FD_STATE_FORMAT
;

1686 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x00, 0x00, 0x00);

1690 
	`FLOPPY_DPRINTF
("treat DRIVE_SPECIFICATION_COMMAND command\n");

1691 i‡(
fd˘æ
->
fifo
[fd˘æ->
d©a_pos
 - 1] & 0x80) {

1693 i‡(
fd˘æ
->
fifo
[fd˘æ->
d©a_pos
 - 1] & 0x40) {

1694 
fd˘æ
->
fifo
[0] = fdctrl->fifo[1];

1695 
fd˘æ
->
fifo
[2] = 0;

1696 
fd˘æ
->
fifo
[3] = 0;

1697 
	`fd˘æ_£t_fifo
(
fd˘æ
, 4, 1);

1699 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1701 } i‡(
fd˘æ
->
d©a_Àn
 > 7) {

1703 
fd˘æ
->
fifo
[0] = 0x80 |

1704 (
cur_drv
->
hód
 << 2Ë| 
fd˘æ
->cur_drv;

1705 
	`fd˘æ_£t_fifo
(
fd˘æ
, 1, 1);

1710 
	`FLOPPY_DPRINTF
("treat RELATIVE_SEEK_OUT command\n");

1711 
fd˘æ
->
cur_drv
 = fd˘æ->
fifo
[1] & 1;

1712 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1713 
	`fd_°¨t
(
cur_drv
);

1714 
cur_drv
->
dú
 = 0;

1715 i‡(
fd˘æ
->
fifo
[2] + 
cur_drv
->
åack
 >cur_drv->
max_åack
) {

1716 
cur_drv
->
åack
 = cur_drv->
max_åack
 - 1;

1718 
cur_drv
->
åack
 +
fd˘æ
->
fifo
[2];

1720 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1721 
	`fd˘æ_øi£_úq
(
fd˘æ
, 0x20);

1726 
	`FLOPPY_ERROR
("treat FORMAT_AND_WRITE command\n");

1727 
	`fd˘æ_unim∂emíãd
(
fd˘æ
);

1731 
	`FLOPPY_DPRINTF
("treat RELATIVE_SEEK_IN command\n");

1732 
fd˘æ
->
cur_drv
 = fd˘æ->
fifo
[1] & 1;

1733 
cur_drv
 = 
	`gë_cur_drv
(
fd˘æ
);

1734 
	`fd_°¨t
(
cur_drv
);

1735 
cur_drv
->
dú
 = 1;

1736 i‡(
fd˘æ
->
fifo
[2] > 
cur_drv
->
åack
) {

1737 
cur_drv
->
åack
 = 0;

1739 
cur_drv
->
åack
 -
fd˘æ
->
fifo
[2];

1741 
	`fd˘æ_ª£t_fifo
(
fd˘æ
);

1743 
	`fd˘æ_øi£_úq
(
fd˘æ
, 0x20);

1747 
	}
}

1749 
	$fd˘æ_ªsu…_timî
(*
›aque
)

1751 
fd˘æ_t
 *
fd˘æ
 = 
›aque
;

1752 
	`fd˘æ_°›_å™s„r
(
fd˘æ
, 0x00, 0x00, 0x00);

1753 
	}
}

	@fmopl.c

34 
	#INLINE
 
__ölöe


	)

35 
	#HAS_YM3812
 1

	)

37 
	~<°dio.h
>

38 
	~<°dlib.h
>

39 
	~<°rög.h
>

40 
	~<°d¨g.h
>

41 
	~<m©h.h
>

43 
	~"fm›l.h
"

45 #i‚de‡
PI


46 
	#PI
 3.14159265358979323846

	)

51 #ifde‡
OPL_OUTPUT_LOG


52 
FILE
 *
	g›l_dbg_Â
 = 
NULL
;

53 
FM_OPL
 *
	g›l_dbg_›l
[16];

54 
	g›l_dbg_maxchù
,
	g›l_dbg_chù
;

59 
	#OPL_ARRATE
 141280

	)

60 
	#OPL_DRRATE
 1956000

	)

62 
	#DELTAT_MIXING_LEVEL
 (1Ë

	)

64 
	#FREQ_BITS
 24

	)

67 
	#FREQ_RATE
 (1<<(
FREQ_BITS
-20))

	)

68 
	#TL_BITS
 (
FREQ_BITS
+2)

	)

71 
	#OPL_OUTSB
 (
TL_BITS
+3-16Ë

	)

72 
	#OPL_MAXOUT
 (0x7fff<<
OPL_OUTSB
)

	)

73 
	#OPL_MINOUT
 (-0x8000<<
OPL_OUTSB
)

	)

79 
	#SIN_ENT
 2048

	)

83 
	#ENV_BITS
 16

	)

85 
	#EG_ENT
 4096

	)

89 
	#EG_OFF
 ((2*
EG_ENT
)<<
ENV_BITS
Ë

	)

90 
	#EG_DED
 
EG_OFF


	)

91 
	#EG_DST
 (
EG_ENT
<<
ENV_BITS
Ë

	)

92 
	#EG_AED
 
EG_DST


	)

93 
	#EG_AST
 0

	)

95 
	#EG_STEP
 (96.0/
EG_ENT
Ë

	)

98 
	#VIB_ENT
 512

	)

99 
	#VIB_SHIFT
 (32-9)

	)

100 
	#AMS_ENT
 512

	)

101 
	#AMS_SHIFT
 (32-9)

	)

103 
	#VIB_RATE
 256

	)

108 
	#SLOT1
 0

	)

109 
	#SLOT2
 1

	)

112 
	#ENV_MOD_RR
 0x00

	)

113 
	#ENV_MOD_DR
 0x01

	)

114 
	#ENV_MOD_AR
 0x02

	)

117 c⁄° 
	g¶Ÿ_¨øy
[32]=

127 
	#DV
 (
EG_STEP
/2)

	)

128 c⁄° 
UINT32
 
	gKSL_TABLE
[8*16]=

131 0.000/
DV
, 0.000/DV, 0.000/DV, 0.000/DV,

132 0.000/
DV
, 0.000/DV, 0.000/DV, 0.000/DV,

133 0.000/
DV
, 0.000/DV, 0.000/DV, 0.000/DV,

134 0.000/
DV
, 0.000/DV, 0.000/DV, 0.000/DV,

136 0.000/
DV
, 0.000/DV, 0.000/DV, 0.000/DV,

137 0.000/
DV
, 0.000/DV, 0.000/DV, 0.000/DV,

138 0.000/
DV
, 0.750/DV, 1.125/DV, 1.500/DV,

139 1.875/
DV
, 2.250/DV, 2.625/DV, 3.000/DV,

141 0.000/
DV
, 0.000/DV, 0.000/DV, 0.000/DV,

142 0.000/
DV
, 1.125/DV, 1.875/DV, 2.625/DV,

143 3.000/
DV
, 3.750/DV, 4.125/DV, 4.500/DV,

144 4.875/
DV
, 5.250/DV, 5.625/DV, 6.000/DV,

146 0.000/
DV
, 0.000/DV, 0.000/DV, 1.875/DV,

147 3.000/
DV
, 4.125/DV, 4.875/DV, 5.625/DV,

148 6.000/
DV
, 6.750/DV, 7.125/DV, 7.500/DV,

149 7.875/
DV
, 8.250/DV, 8.625/DV, 9.000/DV,

151 0.000/
DV
, 0.000/DV, 3.000/DV, 4.875/DV,

152 6.000/
DV
, 7.125/DV, 7.875/DV, 8.625/DV,

153 9.000/
DV
, 9.750/DV,10.125/DV,10.500/DV,

154 10.875/
DV
,11.250/DV,11.625/DV,12.000/DV,

156 0.000/
DV
, 3.000/DV, 6.000/DV, 7.875/DV,

157 9.000/
DV
,10.125/DV,10.875/DV,11.625/DV,

158 12.000/
DV
,12.750/DV,13.125/DV,13.500/DV,

159 13.875/
DV
,14.250/DV,14.625/DV,15.000/DV,

161 0.000/
DV
, 6.000/DV, 9.000/DV,10.875/DV,

162 12.000/
DV
,13.125/DV,13.875/DV,14.625/DV,

163 15.000/
DV
,15.750/DV,16.125/DV,16.500/DV,

164 16.875/
DV
,17.250/DV,17.625/DV,18.000/DV,

166 0.000/
DV
, 9.000/DV,12.000/DV,13.875/DV,

167 15.000/
DV
,16.125/DV,16.875/DV,17.625/DV,

168 18.000/
DV
,18.750/DV,19.125/DV,19.500/DV,

169 19.875/
DV
,20.250/DV,20.625/DV,21.000/DV

171 #unde‡
DV


175 
	#SC
(
db
Ë(db*((3/
EG_STEP
)*(1<<
ENV_BITS
)))+
EG_DST


	)

176 c⁄° 
INT32
 
	gSL_TABLE
[16]={

177 
SC
( 0),SC( 1),SC( 2),SC(3 ),SC(4 ),SC(5 ),SC(6 ),SC( 7),

178 
SC
( 8),SC( 9),SC(10),SC(11),SC(12),SC(13),SC(14),SC(31)

180 #unde‡
SC


182 
	#TL_MAX
 (
EG_ENT
*2Ë

	)

186 
INT32
 *
	gTL_TABLE
;

189 
INT32
 **
	gSIN_TABLE
;

192 
INT32
 *
	gAMS_TABLE
;

193 
INT32
 *
	gVIB_TABLE
;

197 
INT32
 
	gENV_CURVE
[2*
EG_ENT
+1];

200 
	#ML
 2

	)

201 c⁄° 
UINT32
 
	gMUL_TABLE
[16]= {

203 0.50*
ML
, 1.00*ML, 2.00*ML, 3.00*ML, 4.00*ML, 5.00*ML, 6.00*ML, 7.00*ML,

204 8.00*
ML
, 9.00*ML,10.00*ML,10.00*ML,12.00*ML,12.00*ML,15.00*ML,15.00*ML

206 #unde‡
ML


209 
INT32
 
	gRATE_0
[16]=

215 
	gnum_lock
 = 0;

218 *
	gcur_chù
 = 
NULL
;

221 
OPL_CH
 *
	gS_CH
;

222 
OPL_CH
 *
	gE_CH
;

223 
OPL_SLOT
 *
	gSLOT7_1
,*
	gSLOT7_2
,*
	gSLOT8_1
,*
	gSLOT8_2
;

225 
INT32
 
	goutd
[1];

226 
INT32
 
	gams
;

227 
INT32
 
	gvib
;

228 
INT32
 *
	gams_èbÀ
;

229 
INT32
 *
	gvib_èbÀ
;

230 
INT32
 
	gamsIn¸
;

231 
INT32
 
	gvibIn¸
;

232 
INT32
 
	g„edback2
;

235 
	#LOG_ERR
 3

	)

236 
	#LOG_WAR
 2

	)

237 
	#LOG_INF
 1

	)

240 
	#LOG_LEVEL
 
LOG_ERR


	)

243 
	#LOG
(
n
,
x
)

	)

247 
INLINE
 
	$Limô
–
vÆ
, 
max
, 
mö
 ) {

248 i‡–
vÆ
 > 
max
 )

249 
vÆ
 = 
max
;

250 i‡–
vÆ
 < 
mö
 )

251 
vÆ
 = 
mö
;

253  
vÆ
;

254 
	}
}

257 
INLINE
 
	$OPL_STATUS_SET
(
FM_OPL
 *
OPL
,
Êag
)

260 
OPL
->
°©us
 |
Êag
;

261 if(!(
OPL
->
°©us
 & 0x80))

263 if(
OPL
->
°©us
 & OPL->
°©usmask
)

265 
OPL
->
°©us
 |= 0x80;

267 if(
OPL
->
IRQH™dÀr
Ë(OPL->IRQH™dÀr)(OPL->
IRQP¨am
,1);

270 
	}
}

273 
INLINE
 
	$OPL_STATUS_RESET
(
FM_OPL
 *
OPL
,
Êag
)

276 
OPL
->
°©us
 &=~
Êag
;

277 if((
OPL
->
°©us
 & 0x80))

279 i‡(!(
OPL
->
°©us
 & OPL->
°©usmask
) )

281 
OPL
->
°©us
 &= 0x7f;

283 if(
OPL
->
IRQH™dÀr
Ë(OPL->IRQH™dÀr)(OPL->
IRQP¨am
,0);

286 
	}
}

289 
INLINE
 
	$OPL_STATUSMASK_SET
(
FM_OPL
 *
OPL
,
Êag
)

291 
OPL
->
°©usmask
 = 
Êag
;

293 
	`OPL_STATUS_SET
(
OPL
,0);

294 
	`OPL_STATUS_RESET
(
OPL
,0);

295 
	}
}

298 
INLINE
 
	$OPL_KEYON
(
OPL_SLOT
 *
SLOT
)

301 
SLOT
->
C¡
 = 0;

303 
SLOT
->
evm
 = 
ENV_MOD_AR
;

304 
SLOT
->
evs
 = SLOT->
evß
;

305 
SLOT
->
evc
 = 
EG_AST
;

306 
SLOT
->
eve
 = 
EG_AED
;

307 
	}
}

309 
INLINE
 
	$OPL_KEYOFF
(
OPL_SLOT
 *
SLOT
)

311 if–
SLOT
->
evm
 > 
ENV_MOD_RR
)

314 
SLOT
->
evm
 = 
ENV_MOD_RR
;

315 if–!(
SLOT
->
evc
&
EG_DST
) )

317 
SLOT
->
evc
 = 
EG_DST
;

318 
SLOT
->
eve
 = 
EG_DED
;

319 
SLOT
->
evs
 = SLOT->
ev§
;

321 
	}
}

325 
INLINE
 
UINT32
 
	$OPL_CALC_SLOT
–
OPL_SLOT
 *
SLOT
 )

328 if–(
SLOT
->
evc
+=SLOT->
evs
Ë>SLOT->
eve
 )

330  
SLOT
->
evm
 ){

331 
ENV_MOD_AR
:

333 
SLOT
->
evm
 = 
ENV_MOD_DR
;

334 
SLOT
->
evc
 = 
EG_DST
;

335 
SLOT
->
eve
 = SLOT->
SL
;

336 
SLOT
->
evs
 = SLOT->
evsd
;

338 
ENV_MOD_DR
:

339 
SLOT
->
evc
 = SLOT->
SL
;

340 
SLOT
->
eve
 = 
EG_DED
;

341 if(
SLOT
->
eg_typ
)

343 
SLOT
->
evs
 = 0;

347 
SLOT
->
evm
 = 
ENV_MOD_RR
;

348 
SLOT
->
evs
 = SLOT->
ev§
;

351 
ENV_MOD_RR
:

352 
SLOT
->
evc
 = 
EG_OFF
;

353 
SLOT
->
eve
 = 
EG_OFF
+1;

354 
SLOT
->
evs
 = 0;

359  
SLOT
->
TLL
+
ENV_CURVE
[SLOT->
evc
>>
ENV_BITS
]+(SLOT->
ams
 ?áms : 0);

360 
	}
}

363 
	$£t_Æg‹ythm
–
OPL_CH
 *
CH
)

365 
INT32
 *
ˇºõr
 = &
outd
[0];

366 
CH
->
c⁄√˘1
 = CH->
CON
 ? 
ˇºõr
 : &
„edback2
;

367 
CH
->
c⁄√˘2
 = 
ˇºõr
;

368 
	}
}

371 
INLINE
 
	$CALC_FCSLOT
(
OPL_CH
 *
CH
,
OPL_SLOT
 *
SLOT
)

373 
k§
;

376 
SLOT
->
In¸
 = 
CH
->
fc
 * SLOT->
mul
;

377 
k§
 = 
CH
->
kcode
 >> 
SLOT
->
KSR
;

379 if–
SLOT
->
k§
 != ksr )

381 
SLOT
->
k§
 = ksr;

383 
SLOT
->
evß
 = SLOT->
AR
[
k§
];

384 
SLOT
->
evsd
 = SLOT->
DR
[
k§
];

385 
SLOT
->
ev§
 = SLOT->
RR
[
k§
];

387 
SLOT
->
TLL
 = SLOT->
TL
 + (
CH
->
k¶_ba£
>>SLOT->
k¶
);

388 
	}
}

391 
INLINE
 
	$£t_mul
(
FM_OPL
 *
OPL
,
¶Ÿ
,
v
)

393 
OPL_CH
 *
CH
 = &
OPL
->
P_CH
[
¶Ÿ
/2];

394 
OPL_SLOT
 *
SLOT
 = &
CH
->SLOT[
¶Ÿ
&1];

396 
SLOT
->
mul
 = 
MUL_TABLE
[
v
&0x0f];

397 
SLOT
->
KSR
 = (
v
&0x10) ? 0 : 2;

398 
SLOT
->
eg_typ
 = (
v
&0x20)>>5;

399 
SLOT
->
vib
 = (
v
&0x40);

400 
SLOT
->
ams
 = (
v
&0x80);

401 
	`CALC_FCSLOT
(
CH
,
SLOT
);

402 
	}
}

405 
INLINE
 
	$£t_k¶_é
(
FM_OPL
 *
OPL
,
¶Ÿ
,
v
)

407 
OPL_CH
 *
CH
 = &
OPL
->
P_CH
[
¶Ÿ
/2];

408 
OPL_SLOT
 *
SLOT
 = &
CH
->SLOT[
¶Ÿ
&1];

409 
k¶
 = 
v
>>6;

411 
SLOT
->
k¶
 = ksl ? 3-ksl : 31;

412 
SLOT
->
TL
 = (
v
&0x3f)*(0.75/
EG_STEP
);

414 if–!(
OPL
->
mode
&0x80) )

416 
SLOT
->
TLL
 = SLOT->
TL
 + (
CH
->
k¶_ba£
>>SLOT->
k¶
);

418 
	}
}

421 
INLINE
 
	$£t_¨_dr
(
FM_OPL
 *
OPL
,
¶Ÿ
,
v
)

423 
OPL_CH
 *
CH
 = &
OPL
->
P_CH
[
¶Ÿ
/2];

424 
OPL_SLOT
 *
SLOT
 = &
CH
->SLOT[
¶Ÿ
&1];

425 
¨
 = 
v
>>4;

426 
dr
 = 
v
&0x0f;

428 
SLOT
->
AR
 = 
¨
 ? &
OPL
->
AR_TABLE
[¨<<2] : 
RATE_0
;

429 
SLOT
->
evß
 = SLOT->
AR
[SLOT->
k§
];

430 if–
SLOT
->
evm
 =
ENV_MOD_AR
 ) SLOT->
evs
 = SLOT->
evß
;

432 
SLOT
->
DR
 = 
dr
 ? &
OPL
->
DR_TABLE
[dr<<2] : 
RATE_0
;

433 
SLOT
->
evsd
 = SLOT->
DR
[SLOT->
k§
];

434 if–
SLOT
->
evm
 =
ENV_MOD_DR
 ) SLOT->
evs
 = SLOT->
evsd
;

435 
	}
}

438 
INLINE
 
	$£t_¶_º
(
FM_OPL
 *
OPL
,
¶Ÿ
,
v
)

440 
OPL_CH
 *
CH
 = &
OPL
->
P_CH
[
¶Ÿ
/2];

441 
OPL_SLOT
 *
SLOT
 = &
CH
->SLOT[
¶Ÿ
&1];

442 
¶
 = 
v
>>4;

443 
º
 = 
v
 & 0x0f;

445 
SLOT
->
SL
 = 
SL_TABLE
[
¶
];

446 if–
SLOT
->
evm
 =
ENV_MOD_DR
 ) SLOT->
eve
 = SLOT->
SL
;

447 
SLOT
->
RR
 = &
OPL
->
DR_TABLE
[
º
<<2];

448 
SLOT
->
ev§
 = SLOT->
RR
[SLOT->
k§
];

449 if–
SLOT
->
evm
 =
ENV_MOD_RR
 ) SLOT->
evs
 = SLOT->
ev§
;

450 
	}
}

453 
	#OP_OUT
(
¶Ÿ
,
ív
,
c⁄
Ë¶Ÿ->
wavëabÀ
[((¶Ÿ->
C¡
+c⁄)/(0x1000000/
SIN_ENT
))&(SIN_ENT-1)][ív]

	)

455 
INLINE
 
	$OPL_CALC_CH
–
OPL_CH
 *
CH
 )

457 
UINT32
 
ív_out
;

458 
OPL_SLOT
 *
SLOT
;

460 
„edback2
 = 0;

462 
SLOT
 = &
CH
->SLOT[
SLOT1
];

463 
ív_out
=
	`OPL_CALC_SLOT
(
SLOT
);

464 if–
ív_out
 < 
EG_ENT
-1 )

467 if(
SLOT
->
vib
ËSLOT->
C¡
 +(SLOT->
In¸
*vib/
VIB_RATE
);

468 
SLOT
->
C¡
 +SLOT->
In¸
;

470 if(
CH
->
FB
)

472 
„edback1
 = (
CH
->
›1_out
[0]+CH->›1_out[1])>>CH->
FB
;

473 
CH
->
›1_out
[1] = CH->op1_out[0];

474 *
CH
->
c⁄√˘1
 +CH->
›1_out
[0] = 
	`OP_OUT
(
SLOT
,
ív_out
,
„edback1
);

478 *
CH
->
c⁄√˘1
 +
	`OP_OUT
(
SLOT
,
ív_out
,0);

482 
CH
->
›1_out
[1] = CH->op1_out[0];

483 
CH
->
›1_out
[0] = 0;

486 
SLOT
 = &
CH
->SLOT[
SLOT2
];

487 
ív_out
=
	`OPL_CALC_SLOT
(
SLOT
);

488 if–
ív_out
 < 
EG_ENT
-1 )

491 if(
SLOT
->
vib
ËSLOT->
C¡
 +(SLOT->
In¸
*vib/
VIB_RATE
);

492 
SLOT
->
C¡
 +SLOT->
In¸
;

494 
outd
[0] +
	`OP_OUT
(
SLOT
,
ív_out
, 
„edback2
);

496 
	}
}

499 
	#WHITE_NOISE_db
 6.0

	)

500 
INLINE
 
	$OPL_CALC_RH
–
OPL_CH
 *
CH
 )

502 
UINT32
 
ív_èm
,
ív_sd
,
ív_t›
,
ív_hh
;

503 
whôíoi£
 = (
	`ønd
()&1)*(
WHITE_NOISE_db
/
EG_STEP
);

504 
INT32
 
t⁄e8
;

506 
OPL_SLOT
 *
SLOT
;

507 
ív_out
;

510 
„edback2
 = 0;

512 
SLOT
 = &
CH
[6].SLOT[
SLOT1
];

513 
ív_out
=
	`OPL_CALC_SLOT
(
SLOT
);

514 if–
ív_out
 < 
EG_ENT
-1 )

517 if(
SLOT
->
vib
ËSLOT->
C¡
 +(SLOT->
In¸
*vib/
VIB_RATE
);

518 
SLOT
->
C¡
 +SLOT->
In¸
;

520 if(
CH
[6].
FB
)

522 
„edback1
 = (
CH
[6].
›1_out
[0]+CH[6].›1_out[1])>>CH[6].
FB
;

523 
CH
[6].
›1_out
[1] = CH[6].op1_out[0];

524 
„edback2
 = 
CH
[6].
›1_out
[0] = 
	`OP_OUT
(
SLOT
,
ív_out
,
„edback1
);

528 
„edback2
 = 
	`OP_OUT
(
SLOT
,
ív_out
,0);

532 
„edback2
 = 0;

533 
CH
[6].
›1_out
[1] = CH[6].op1_out[0];

534 
CH
[6].
›1_out
[0] = 0;

537 
SLOT
 = &
CH
[6].SLOT[
SLOT2
];

538 
ív_out
=
	`OPL_CALC_SLOT
(
SLOT
);

539 if–
ív_out
 < 
EG_ENT
-1 )

542 if(
SLOT
->
vib
ËSLOT->
C¡
 +(SLOT->
In¸
*vib/
VIB_RATE
);

543 
SLOT
->
C¡
 +SLOT->
In¸
;

545 
outd
[0] +
	`OP_OUT
(
SLOT
,
ív_out
, 
„edback2
)*2;

552 
ív_sd
 =
	`OPL_CALC_SLOT
(
SLOT7_2
Ë+ 
whôíoi£
;

553 
ív_èm
=
	`OPL_CALC_SLOT
(
SLOT8_1
);

554 
ív_t›
=
	`OPL_CALC_SLOT
(
SLOT8_2
);

555 
ív_hh
 =
	`OPL_CALC_SLOT
(
SLOT7_1
Ë+ 
whôíoi£
;

558 if(
SLOT7_1
->
vib
ËSLOT7_1->
C¡
 +(2*SLOT7_1->
In¸
*vib/
VIB_RATE
);

559 
SLOT7_1
->
C¡
 +2*SLOT7_1->
In¸
;

560 if(
SLOT7_2
->
vib
ËSLOT7_2->
C¡
 +((
CH
[7].
fc
*8)*vib/
VIB_RATE
);

561 
SLOT7_2
->
C¡
 +(
CH
[7].
fc
*8);

562 if(
SLOT8_1
->
vib
ËSLOT8_1->
C¡
 +(SLOT8_1->
In¸
*vib/
VIB_RATE
);

563 
SLOT8_1
->
C¡
 +SLOT8_1->
In¸
;

564 if(
SLOT8_2
->
vib
ËSLOT8_2->
C¡
 +((
CH
[8].
fc
*48)*vib/
VIB_RATE
);

565 
SLOT8_2
->
C¡
 +(
CH
[8].
fc
*48);

567 
t⁄e8
 = 
	`OP_OUT
(
SLOT8_2
,
whôíoi£
,0 );

570 if–
ív_sd
 < 
EG_ENT
-1 )

571 
outd
[0] +
	`OP_OUT
(
SLOT7_1
,
ív_sd
, 0)*8;

573 if–
ív_èm
 < 
EG_ENT
-1 )

574 
outd
[0] +
	`OP_OUT
(
SLOT8_1
,
ív_èm
, 0)*2;

576 if–
ív_t›
 < 
EG_ENT
-1 )

577 
outd
[0] +
	`OP_OUT
(
SLOT7_2
,
ív_t›
,
t⁄e8
)*2;

579 if–
ív_hh
 < 
EG_ENT
-1 )

580 
outd
[0] +
	`OP_OUT
(
SLOT7_2
,
ív_hh
,
t⁄e8
)*2;

581 
	}
}

584 
	$öô_timëabÀs
–
FM_OPL
 *
OPL
 , 
ARRATE
 , 
DRRATE
 )

586 
i
;

587 
øã
;

590 
i
 = 0;ò< 4;i++Ë
OPL
->
AR_TABLE
[i] = OPL->
DR_TABLE
[i] = 0;

591 
i
 = 4;i <= 60;i++){

592 
øã
 = 
OPL
->
‰eqba£
;

593 if–
i
 < 60 ) 
øã
 *= 1.0+(i&3)*0.25;

594 
øã
 *1<<((
i
>>2)-1);

595 
øã
 *()(
EG_ENT
<<
ENV_BITS
);

596 
OPL
->
AR_TABLE
[
i
] = 
øã
 / 
ARRATE
;

597 
OPL
->
DR_TABLE
[
i
] = 
øã
 / 
DRRATE
;

599 
i
 = 60;i < 76;i++)

601 
OPL
->
AR_TABLE
[
i
] = 
EG_AED
-1;

602 
OPL
->
DR_TABLE
[
i
] = OPL->DR_TABLE[60];

605 
i
 = 0;i < 64 ;i++){

606 
	`LOG
(
LOG_WAR
,("øã %2d ,á∏%‡m†, d∏%‡m†\n",
i
,

607 (()(
EG_ENT
<<
ENV_BITS
Ë/ 
OPL
->
AR_TABLE
[
i
]Ë* (1000.0 / OPL->
øã
),

608 (()(
EG_ENT
<<
ENV_BITS
Ë/ 
OPL
->
DR_TABLE
[
i
]Ë* (1000.0 / OPL->
øã
) ));

611 
	}
}

614 
	$OPLO≥nTabÀ
( )

616 
s
,
t
;

617 
øã
;

618 
i
,
j
;

619 
pom
;

622 if–(
TL_TABLE
 = 
	`mÆloc
(
TL_MAX
*2*(
INT32
))Ë=
NULL
)

624 if–(
SIN_TABLE
 = 
	`mÆloc
(
SIN_ENT
*4 *(
INT32
 *))Ë=
NULL
)

626 
	`‰ì
(
TL_TABLE
);

629 if–(
AMS_TABLE
 = 
	`mÆloc
(
AMS_ENT
*2 *(
INT32
))Ë=
NULL
)

631 
	`‰ì
(
TL_TABLE
);

632 
	`‰ì
(
SIN_TABLE
);

635 if–(
VIB_TABLE
 = 
	`mÆloc
(
VIB_ENT
*2 *(
INT32
))Ë=
NULL
)

637 
	`‰ì
(
TL_TABLE
);

638 
	`‰ì
(
SIN_TABLE
);

639 
	`‰ì
(
AMS_TABLE
);

643 
t
 = 0;à< 
EG_ENT
-1 ;t++){

644 
øã
 = ((1<<
TL_BITS
)-1)/
	`pow
(10,
EG_STEP
*
t
/20);

645 
TL_TABLE
[ 
t
] = ()
øã
;

646 
TL_TABLE
[
TL_MAX
+
t
] = -TL_TABLE[t];

650  
t
 = 
EG_ENT
-1;Å < 
TL_MAX
 ;t++){

651 
TL_TABLE
[
t
] = TL_TABLE[
TL_MAX
+t] = 0;

656 
SIN_TABLE
[0] = SIN_TABLE[
SIN_ENT
/2] = &
TL_TABLE
[
EG_ENT
-1];

657 
s
 = 1;†<
SIN_ENT
/4;s++){

658 
pom
 = 
	`sö
(2*
PI
*
s
/
SIN_ENT
);

659 
pom
 = 20*
	`log10
(1/pom);

660 
j
 = 
pom
 / 
EG_STEP
;

663 
SIN_TABLE
[ 
s
] = SIN_TABLE[
SIN_ENT
/2-s] = &
TL_TABLE
[
j
];

665 
SIN_TABLE
[
SIN_ENT
/2+
s
] = SIN_TABLE[SIN_ENT -s] = &
TL_TABLE
[
TL_MAX
+
j
];

668 
s
 = 0;†< 
SIN_ENT
;s++)

670 
SIN_TABLE
[
SIN_ENT
*1+
s
] = s<(SIN_ENT/2Ë? SIN_TABLE[s] : &
TL_TABLE
[
EG_ENT
];

671 
SIN_TABLE
[
SIN_ENT
*2+
s
] = SIN_TABLE[s % (SIN_ENT/2)];

672 
SIN_TABLE
[
SIN_ENT
*3+
s
] = (s/(SIN_ENT/4))&1 ? &
TL_TABLE
[
EG_ENT
] : SIN_TABLE[SIN_ENT*2+s];

676 
i
=0; i<
EG_ENT
; i++)

679 
pom
 = 
	`pow
–(()(
EG_ENT
-1-
i
)/EG_ENT) , 8 ) * EG_ENT;

681 
ENV_CURVE
[
i
] = ()
pom
;

683 
ENV_CURVE
[(
EG_DST
>>
ENV_BITS
)+
i
]= i;

686 
ENV_CURVE
[
EG_OFF
>>
ENV_BITS
]
EG_ENT
-1;

688 
i
=0; i<
AMS_ENT
; i++)

690 
pom
 = (1.0+
	`sö
(2*
PI
*
i
/
AMS_ENT
))/2;

691 
AMS_TABLE
[
i
] = (1.0/
EG_STEP
)*
pom
;

692 
AMS_TABLE
[
AMS_ENT
+
i
] = (4.8/
EG_STEP
)*
pom
;

695 
i
=0; i<
VIB_ENT
; i++)

698 
pom
 = ()
VIB_RATE
*0.06*
	`sö
(2*
PI
*
i
/
VIB_ENT
);

699 
VIB_TABLE
[
i
] = 
VIB_RATE
 + (
pom
*0.07);

700 
VIB_TABLE
[
VIB_ENT
+
i
] = 
VIB_RATE
 + (
pom
*0.14);

704 
	}
}

707 
	$OPLClo£TabÀ
( )

709 
	`‰ì
(
TL_TABLE
);

710 
	`‰ì
(
SIN_TABLE
);

711 
	`‰ì
(
AMS_TABLE
);

712 
	`‰ì
(
VIB_TABLE
);

713 
	}
}

716 
INLINE
 
	$CSMKeyC⁄åﬁl
(
OPL_CH
 *
CH
)

718 
OPL_SLOT
 *
¶Ÿ1
 = &
CH
->
SLOT
[
SLOT1
];

719 
OPL_SLOT
 *
¶Ÿ2
 = &
CH
->
SLOT
[
SLOT2
];

721 
	`OPL_KEYOFF
(
¶Ÿ1
);

722 
	`OPL_KEYOFF
(
¶Ÿ2
);

724 
¶Ÿ1
->
TLL
 = slŸ1->
TL
 + (
CH
->
k¶_ba£
>>¶Ÿ1->
k¶
);

725 
¶Ÿ1
->
TLL
 = slŸ1->
TL
 + (
CH
->
k¶_ba£
>>¶Ÿ1->
k¶
);

727 
CH
->
›1_out
[0] = CH->op1_out[1] = 0;

728 
	`OPL_KEYON
(
¶Ÿ1
);

729 
	`OPL_KEYON
(
¶Ÿ2
);

730 
	}
}

733 
	$OPL_öôÆize
(
FM_OPL
 *
OPL
)

735 
‚
;

738 
OPL
->
‰eqba£
 = (OPL->
øã
Ë? (()OPL->
˛ock
 / OPL->rate) / 72 : 0;

740 
OPL
->
TimîBa£
 = 1.0/(()OPL->
˛ock
 / 72.0 );

742 
	`öô_timëabÀs
–
OPL
 , 
OPL_ARRATE
 , 
OPL_DRRATE
 );

744  
‚
=0 ; fn < 1024 ; fn++ )

746 
OPL
->
FN_TABLE
[
‚
] = OPL->
‰eqba£
 * f¿* 
FREQ_RATE
 * (1<<7) / 2;

749 
OPL
->
amsIn¸
 = OPL->
øã
 ? ()
AMS_ENT
*(1<<
AMS_SHIFT
Ë/ OPL->øã * 3.7 * (()OPL->
˛ock
/3600000) : 0;

750 
OPL
->
vibIn¸
 = OPL->
øã
 ? ()
VIB_ENT
*(1<<
VIB_SHIFT
Ë/ OPL->øã * 6.4 * (()OPL->
˛ock
/3600000) : 0;

751 
	}
}

754 
	$OPLWrôeReg
(
FM_OPL
 *
OPL
, 
r
, 
v
)

756 
OPL_CH
 *
CH
;

757 
¶Ÿ
;

758 
block_‚um
;

760 
r
&0xe0)

763 
r
&0x1f)

767 if(
OPL
->
ty≥
&
OPL_TYPE_WAVESEL
)

769 
OPL
->
wave£l
 = 
v
&0x20;

770 if(!
OPL
->
wave£l
)

773 
c
;

774 
c
=0;c<
OPL
->
max_ch
;c++)

776 
OPL
->
P_CH
[
c
].
SLOT
[
SLOT1
].
wavëabÀ
 = &
SIN_TABLE
[0];

777 
OPL
->
P_CH
[
c
].
SLOT
[
SLOT2
].
wavëabÀ
 = &
SIN_TABLE
[0];

783 
OPL
->
T
[0] = (256-
v
)*4;

786 
OPL
->
T
[1] = (256-
v
)*16;

789 if(
v
&0x80)

791 
	`OPL_STATUS_RESET
(
OPL
,0x7f);

795 
UINT8
 
°1
 = 
v
&1;

796 
UINT8
 
°2
 = (
v
>>1)&1;

798 
	`OPL_STATUS_RESET
(
OPL
,
v
&0x78);

799 
	`OPL_STATUSMASK_SET
(
OPL
,((~
v
)&0x78)|0x01);

801 if(
OPL
->
°
[1] !
°2
)

803 
öãrvÆ
 = 
°2
 ? ()
OPL
->
T
[1]*OPL->
TimîBa£
 : 0.0;

804 
OPL
->
°
[1] = 
°2
;

805 i‡(
OPL
->
TimîH™dÀr
Ë(OPL->TimîH™dÀr)(OPL->
TimîP¨am
+1,
öãrvÆ
);

808 if(
OPL
->
°
[0] !
°1
)

810 
öãrvÆ
 = 
°1
 ? ()
OPL
->
T
[0]*OPL->
TimîBa£
 : 0.0;

811 
OPL
->
°
[0] = 
°1
;

812 i‡(
OPL
->
TimîH™dÀr
Ë(OPL->TimîH™dÀr)(OPL->
TimîP¨am
+0,
öãrvÆ
);

816 #i‡
BUILD_Y8950


818 if(
OPL
->
ty≥
&
OPL_TYPE_KEYBOARD
)

820 if(
OPL
->
keybﬂrdh™dÀr_w
)

821 
OPL
->
	`keybﬂrdh™dÀr_w
(OPL->
keybﬂrd_∑øm
,
v
);

823 
	`LOG
(
LOG_WAR
,("OPL:write unmapped KEYBOARDÖort\n"));

827 if(
OPL
->
ty≥
&
OPL_TYPE_ADPCM
)

828 
	`YM_DELTAT_ADPCM_Wrôe
(
OPL
->
dñèt
,
r
-0x07,
v
);

831 
OPL
->
mode
 = 
v
;

832 
v
&=0x1f;

843 if(
OPL
->
ty≥
&
OPL_TYPE_ADPCM
)

844 
	`YM_DELTAT_ADPCM_Wrôe
(
OPL
->
dñèt
,
r
-0x07,
v
);

852 if(
OPL
->
ty≥
&
OPL_TYPE_IO
)

853 
OPL
->
p‹tDúe˘i⁄
 = 
v
&0x0f;

856 if(
OPL
->
ty≥
&
OPL_TYPE_IO
)

858 
OPL
->
p‹tL©ch
 = 
v
;

859 if(
OPL
->
p‹th™dÀr_w
)

860 
OPL
->
	`p‹th™dÀr_w
(OPL->
p‹t_∑øm
,
v
&OPL->
p‹tDúe˘i⁄
);

870 
¶Ÿ
 = 
¶Ÿ_¨øy
[
r
&0x1f];

871 if(
¶Ÿ
 == -1) ;

872 
	`£t_mul
(
OPL
,
¶Ÿ
,
v
);

875 
¶Ÿ
 = 
¶Ÿ_¨øy
[
r
&0x1f];

876 if(
¶Ÿ
 == -1) ;

877 
	`£t_k¶_é
(
OPL
,
¶Ÿ
,
v
);

880 
¶Ÿ
 = 
¶Ÿ_¨øy
[
r
&0x1f];

881 if(
¶Ÿ
 == -1) ;

882 
	`£t_¨_dr
(
OPL
,
¶Ÿ
,
v
);

885 
¶Ÿ
 = 
¶Ÿ_¨øy
[
r
&0x1f];

886 if(
¶Ÿ
 == -1) ;

887 
	`£t_¶_º
(
OPL
,
¶Ÿ
,
v
);

890 
r
)

895 
UINT8
 
rkey
 = 
OPL
->
rythm
^
v
;

896 
OPL
->
ams_èbÀ
 = &
AMS_TABLE
[
v
&0x80 ? 
AMS_ENT
 : 0];

897 
OPL
->
vib_èbÀ
 = &
VIB_TABLE
[
v
&0x40 ? 
VIB_ENT
 : 0];

898 
OPL
->
rythm
 = 
v
&0x3f;

899 if(
OPL
->
rythm
&0x20)

902 
	`u§ötf_showmesßge
("OPL Rythm mode select");

905 if(
rkey
&0x10)

907 if(
v
&0x10)

909 
OPL
->
P_CH
[6].
›1_out
[0] = OPL->P_CH[6].op1_out[1] = 0;

910 
	`OPL_KEYON
(&
OPL
->
P_CH
[6].
SLOT
[
SLOT1
]);

911 
	`OPL_KEYON
(&
OPL
->
P_CH
[6].
SLOT
[
SLOT2
]);

915 
	`OPL_KEYOFF
(&
OPL
->
P_CH
[6].
SLOT
[
SLOT1
]);

916 
	`OPL_KEYOFF
(&
OPL
->
P_CH
[6].
SLOT
[
SLOT2
]);

920 if(
rkey
&0x08)

922 if(
v
&0x08Ë
	`OPL_KEYON
(&
OPL
->
P_CH
[7].
SLOT
[
SLOT2
]);

923 
	`OPL_KEYOFF
(&
OPL
->
P_CH
[7].
SLOT
[
SLOT2
]);

925 if(
rkey
&0x04)

927 if(
v
&0x04Ë
	`OPL_KEYON
(&
OPL
->
P_CH
[8].
SLOT
[
SLOT1
]);

928 
	`OPL_KEYOFF
(&
OPL
->
P_CH
[8].
SLOT
[
SLOT1
]);

931 if(
rkey
&0x02)

933 if(
v
&0x02Ë
	`OPL_KEYON
(&
OPL
->
P_CH
[8].
SLOT
[
SLOT2
]);

934 
	`OPL_KEYOFF
(&
OPL
->
P_CH
[8].
SLOT
[
SLOT2
]);

937 if(
rkey
&0x01)

939 if(
v
&0x01Ë
	`OPL_KEYON
(&
OPL
->
P_CH
[7].
SLOT
[
SLOT1
]);

940 
	`OPL_KEYOFF
(&
OPL
->
P_CH
[7].
SLOT
[
SLOT1
]);

947 if–(
r
&0x0f) > 8) ;

948 
CH
 = &
OPL
->
P_CH
[
r
&0x0f];

949 if(!(
r
&0x10))

951 
block_‚um
 = (
CH
->block_‚um&0x1f00Ë| 
v
;

955 
key⁄
 = (
v
>>5)&1;

956 
block_‚um
 = ((
v
&0x1f)<<8Ë| (
CH
->block_fnum&0xff);

957 if(
CH
->
key⁄
 != keyon)

959 if–(
CH
->
key⁄
=keyon) )

961 
CH
->
›1_out
[0] = CH->op1_out[1] = 0;

962 
	`OPL_KEYON
(&
CH
->
SLOT
[
SLOT1
]);

963 
	`OPL_KEYON
(&
CH
->
SLOT
[
SLOT2
]);

967 
	`OPL_KEYOFF
(&
CH
->
SLOT
[
SLOT1
]);

968 
	`OPL_KEYOFF
(&
CH
->
SLOT
[
SLOT2
]);

973 if(
CH
->
block_‚um
 != block_fnum)

975 
blockRv
 = 7-(
block_‚um
>>10);

976 
‚um
 = 
block_‚um
&0x3ff;

977 
CH
->
block_‚um
 = block_fnum;

979 
CH
->
k¶_ba£
 = 
KSL_TABLE
[
block_‚um
>>6];

980 
CH
->
fc
 = 
OPL
->
FN_TABLE
[
‚um
]>>
blockRv
;

981 
CH
->
kcode
 = CH->
block_‚um
>>9;

982 if–(
OPL
->
mode
&0x40Ë&& 
CH
->
block_‚um
&0x100ËCH->
kcode
 |=1;

983 
	`CALC_FCSLOT
(
CH
,&CH->
SLOT
[
SLOT1
]);

984 
	`CALC_FCSLOT
(
CH
,&CH->
SLOT
[
SLOT2
]);

989 if–(
r
&0x0f) > 8) ;

990 
CH
 = &
OPL
->
P_CH
[
r
&0x0f];

992 
„edback
 = (
v
>>1)&7;

993 
CH
->
FB
 = 
„edback
 ? (8+1) - feedback : 0;

994 
CH
->
CON
 = 
v
&1;

995 
	`£t_Æg‹ythm
(
CH
);

999 
¶Ÿ
 = 
¶Ÿ_¨øy
[
r
&0x1f];

1000 if(
¶Ÿ
 == -1) ;

1001 
CH
 = &
OPL
->
P_CH
[
¶Ÿ
/2];

1002 if(
OPL
->
wave£l
)

1005 
CH
->
SLOT
[
¶Ÿ
&1].
wavëabÀ
 = &
SIN_TABLE
[(
v
&0x03)*
SIN_ENT
];

1009 
	}
}

1012 
	$OPL_LockTabÀ
()

1014 
num_lock
++;

1015 if(
num_lock
>1)  0;

1017 
cur_chù
 = 
NULL
;

1019 if–!
	`OPLO≥nTabÀ
() )

1021 
num_lock
--;

1025 
	}
}

1027 
	$OPL_UnLockTabÀ
()

1029 if(
num_lock
)Çum_lock--;

1030 if(
num_lock
) ;

1032 
cur_chù
 = 
NULL
;

1033 
	`OPLClo£TabÀ
();

1034 
	}
}

1036 #i‡(
BUILD_YM3812
 || 
BUILD_YM3526
)

1042 
	$YM3812Upd©eO√
(
FM_OPL
 *
OPL
, 
INT16
 *
buf„r
, 
Àngth
)

1044 
i
;

1045 
d©a
;

1046 
OPLSAMPLE
 *
buf
 = 
buf„r
;

1047 
UINT32
 
amsC¡
 = 
OPL
->amsCnt;

1048 
UINT32
 
vibC¡
 = 
OPL
->vibCnt;

1049 
UINT8
 
rythm
 = 
OPL
->rythm&0x20;

1050 
OPL_CH
 *
CH
,*
R_CH
;

1052 if–(*)
OPL
 !
cur_chù
 ){

1053 
cur_chù
 = (*)
OPL
;

1055 
S_CH
 = 
OPL
->
P_CH
;

1056 
E_CH
 = &
S_CH
[9];

1058 
SLOT7_1
 = &
S_CH
[7].
SLOT
[
SLOT1
];

1059 
SLOT7_2
 = &
S_CH
[7].
SLOT
[
SLOT2
];

1060 
SLOT8_1
 = &
S_CH
[8].
SLOT
[
SLOT1
];

1061 
SLOT8_2
 = &
S_CH
[8].
SLOT
[
SLOT2
];

1063 
amsIn¸
 = 
OPL
->amsIncr;

1064 
vibIn¸
 = 
OPL
->vibIncr;

1065 
ams_èbÀ
 = 
OPL
->ams_table;

1066 
vib_èbÀ
 = 
OPL
->vib_table;

1068 
R_CH
 = 
rythm
 ? &
S_CH
[6] : 
E_CH
;

1069  
i
=0; i < 
Àngth
 ; i++ )

1073 
ams
 = 
ams_èbÀ
[(
amsC¡
+=
amsIn¸
)>>
AMS_SHIFT
];

1074 
vib
 = 
vib_èbÀ
[(
vibC¡
+=
vibIn¸
)>>
VIB_SHIFT
];

1075 
outd
[0] = 0;

1077 
CH
=
S_CH
 ; CH < 
R_CH
 ; CH++)

1078 
	`OPL_CALC_CH
(
CH
);

1080 if(
rythm
)

1081 
	`OPL_CALC_RH
(
S_CH
);

1083 
d©a
 = 
	`Limô
–
outd
[0] , 
OPL_MAXOUT
, 
OPL_MINOUT
 );

1085 
buf
[
i
] = 
d©a
 >> 
OPL_OUTSB
;

1088 
OPL
->
amsC¡
 =ámsCnt;

1089 
OPL
->
vibC¡
 = vibCnt;

1090 #ifde‡
OPL_OUTPUT_LOG


1091 if(
›l_dbg_Â
)

1093 
›l_dbg_chù
=0;›l_dbg_chù<
›l_dbg_maxchù
;opl_dbg_chip++)

1094 if–
›l_dbg_›l
[
›l_dbg_chù
] =
OPL
) ;

1095 
	`Ârötf
(
›l_dbg_Â
,"%c%c%c",0x20+
›l_dbg_chù
,
Àngth
&0xff,length/256);

1098 
	}
}

1101 #i‡
BUILD_Y8950


1103 
	$Y8950Upd©eO√
(
FM_OPL
 *
OPL
, 
INT16
 *
buf„r
, 
Àngth
)

1105 
i
;

1106 
d©a
;

1107 
OPLSAMPLE
 *
buf
 = 
buf„r
;

1108 
UINT32
 
amsC¡
 = 
OPL
->amsCnt;

1109 
UINT32
 
vibC¡
 = 
OPL
->vibCnt;

1110 
UINT8
 
rythm
 = 
OPL
->rythm&0x20;

1111 
OPL_CH
 *
CH
,*
R_CH
;

1112 
YM_DELTAT
 *
DELTAT
 = 
OPL
->
dñèt
;

1115 
	`YM_DELTAT_DECODE_PRESET
(
DELTAT
);

1117 if–(*)
OPL
 !
cur_chù
 ){

1118 
cur_chù
 = (*)
OPL
;

1120 
S_CH
 = 
OPL
->
P_CH
;

1121 
E_CH
 = &
S_CH
[9];

1123 
SLOT7_1
 = &
S_CH
[7].
SLOT
[
SLOT1
];

1124 
SLOT7_2
 = &
S_CH
[7].
SLOT
[
SLOT2
];

1125 
SLOT8_1
 = &
S_CH
[8].
SLOT
[
SLOT1
];

1126 
SLOT8_2
 = &
S_CH
[8].
SLOT
[
SLOT2
];

1128 
amsIn¸
 = 
OPL
->amsIncr;

1129 
vibIn¸
 = 
OPL
->vibIncr;

1130 
ams_èbÀ
 = 
OPL
->ams_table;

1131 
vib_èbÀ
 = 
OPL
->vib_table;

1133 
R_CH
 = 
rythm
 ? &
S_CH
[6] : 
E_CH
;

1134  
i
=0; i < 
Àngth
 ; i++ )

1138 
ams
 = 
ams_èbÀ
[(
amsC¡
+=
amsIn¸
)>>
AMS_SHIFT
];

1139 
vib
 = 
vib_èbÀ
[(
vibC¡
+=
vibIn¸
)>>
VIB_SHIFT
];

1140 
outd
[0] = 0;

1142 if–
DELTAT
->
p‹t°©e
 )

1143 
	`YM_DELTAT_ADPCM_CALC
(
DELTAT
);

1145 
CH
=
S_CH
 ; CH < 
R_CH
 ; CH++)

1146 
	`OPL_CALC_CH
(
CH
);

1148 if(
rythm
)

1149 
	`OPL_CALC_RH
(
S_CH
);

1151 
d©a
 = 
	`Limô
–
outd
[0] , 
OPL_MAXOUT
, 
OPL_MINOUT
 );

1153 
buf
[
i
] = 
d©a
 >> 
OPL_OUTSB
;

1155 
OPL
->
amsC¡
 =ámsCnt;

1156 
OPL
->
vibC¡
 = vibCnt;

1158 if–!
DELTAT
->
p‹t°©e
 )

1159 
OPL
->
°©us
 &= 0xfe;

1160 
	}
}

1164 
	$OPLRe£tChù
(
FM_OPL
 *
OPL
)

1166 
c
,
s
;

1167 
i
;

1170 
OPL
->
mode
 = 0;

1171 
	`OPL_STATUS_RESET
(
OPL
,0x7f);

1173 
	`OPLWrôeReg
(
OPL
,0x01,0);

1174 
	`OPLWrôeReg
(
OPL
,0x02,0);

1175 
	`OPLWrôeReg
(
OPL
,0x03,0);

1176 
	`OPLWrôeReg
(
OPL
,0x04,0);

1177 
i
 = 0xf‡; i >0x20 ; i-- ) 
	`OPLWrôeReg
(
OPL
,i,0);

1179  
c
 = 0 ; c < 
OPL
->
max_ch
 ; c++ )

1181 
OPL_CH
 *
CH
 = &
OPL
->
P_CH
[
c
];

1183 
s
 = 0 ; s < 2 ; s++ )

1186 
CH
->
SLOT
[
s
].
wavëabÀ
 = &
SIN_TABLE
[0];

1188 
CH
->
SLOT
[
s
].
evc
 = 
EG_OFF
;

1189 
CH
->
SLOT
[
s
].
eve
 = 
EG_OFF
+1;

1190 
CH
->
SLOT
[
s
].
evs
 = 0;

1193 #i‡
BUILD_Y8950


1194 if(
OPL
->
ty≥
&
OPL_TYPE_ADPCM
)

1196 
YM_DELTAT
 *
DELTAT
 = 
OPL
->
dñèt
;

1198 
DELTAT
->
‰eqba£
 = 
OPL
->freqbase;

1199 
DELTAT
->
ouçut_poöãr
 = 
outd
;

1200 
DELTAT
->
p‹tshi·
 = 5;

1201 
DELTAT
->
ouçut_ønge
 = 
DELTAT_MIXING_LEVEL
<<
TL_BITS
;

1202 
	`YM_DELTAT_ADPCM_Re£t
(
DELTAT
,0);

1205 
	}
}

1209 
FM_OPL
 *
	$OPLCª©e
(
ty≥
, 
˛ock
, 
øã
)

1211 *
±r
;

1212 
FM_OPL
 *
OPL
;

1213 
°©e_size
;

1214 
max_ch
 = 9;

1216 if–
	`OPL_LockTabÀ
(Ë==-1Ë 
NULL
;

1218 
°©e_size
 = (
FM_OPL
);

1219 
°©e_size
 +(
OPL_CH
)*
max_ch
;

1220 #i‡
BUILD_Y8950


1221 if(
ty≥
&
OPL_TYPE_ADPCM
Ë
°©e_size
+(
YM_DELTAT
);

1224 
±r
 = 
	`mÆloc
(
°©e_size
);

1225 if(
±r
==
NULL
)  NULL;

1227 
	`mem£t
(
±r
,0,
°©e_size
);

1228 
OPL
 = (
FM_OPL
 *)
±r
;Ötr+=(FM_OPL);

1229 
OPL
->
P_CH
 = (
OPL_CH
 *)
±r
;Öå+=(OPL_CH)*
max_ch
;

1230 #i‡
BUILD_Y8950


1231 if(
ty≥
&
OPL_TYPE_ADPCM
Ë
OPL
->
dñèt
 = (
YM_DELTAT
 *)
±r
;Ötr+=(YM_DELTAT);

1234 
OPL
->
ty≥
 =Åype;

1235 
OPL
->
˛ock
 = clock;

1236 
OPL
->
øã
 =Ñate;

1237 
OPL
->
max_ch
 = max_ch;

1239 
	`OPL_öôÆize
(
OPL
);

1241 
	`OPLRe£tChù
(
OPL
);

1242 #ifde‡
OPL_OUTPUT_LOG


1243 if(!
›l_dbg_Â
)

1245 
›l_dbg_Â
 = 
	`f›í
("opllog.opl","wb");

1246 
›l_dbg_maxchù
 = 0;

1248 if(
›l_dbg_Â
)

1250 
›l_dbg_›l
[
›l_dbg_maxchù
] = 
OPL
;

1251 
	`Ârötf
(
›l_dbg_Â
,"%c%c%c%c%c%c",0x00+
›l_dbg_maxchù
,

1252 
ty≥
,

1253 
˛ock
&0xff,

1254 (
˛ock
/0x100)&0xff,

1255 (
˛ock
/0x10000)&0xff,

1256 (
˛ock
/0x1000000)&0xff);

1257 
›l_dbg_maxchù
++;

1260  
OPL
;

1261 
	}
}

1264 
	$OPLDe°roy
(
FM_OPL
 *
OPL
)

1266 #ifde‡
OPL_OUTPUT_LOG


1267 if(
›l_dbg_Â
)

1269 
	`f˛o£
(
›l_dbg_Â
);

1270 
›l_dbg_Â
 = 
NULL
;

1273 
	`OPL_UnLockTabÀ
();

1274 
	`‰ì
(
OPL
);

1275 
	}
}

1279 
	$OPLSëTimîH™dÀr
(
FM_OPL
 *
OPL
,
OPL_TIMERHANDLER
 
TimîH™dÀr
,
ch™√lOff£t
)

1281 
OPL
->
TimîH™dÀr
 = TimerHandler;

1282 
OPL
->
TimîP¨am
 = 
ch™√lOff£t
;

1283 
	}
}

1284 
	$OPLSëIRQH™dÀr
(
FM_OPL
 *
OPL
,
OPL_IRQHANDLER
 
IRQH™dÀr
,
∑øm
)

1286 
OPL
->
IRQH™dÀr
 = IRQHandler;

1287 
OPL
->
IRQP¨am
 = 
∑øm
;

1288 
	}
}

1289 
	$OPLSëUpd©eH™dÀr
(
FM_OPL
 *
OPL
,
OPL_UPDATEHANDLER
 
Upd©eH™dÀr
,
∑øm
)

1291 
OPL
->
Upd©eH™dÀr
 = UpdateHandler;

1292 
OPL
->
Upd©eP¨am
 = 
∑øm
;

1293 
	}
}

1294 #i‡
BUILD_Y8950


1295 
	$OPLSëP‹tH™dÀr
(
FM_OPL
 *
OPL
,
OPL_PORTHANDLER_W
 
P‹tH™dÀr_w
,
OPL_PORTHANDLER_R
 
P‹tH™dÀr_r
,
∑øm
)

1297 
OPL
->
p‹th™dÀr_w
 = 
P‹tH™dÀr_w
;

1298 
OPL
->
p‹th™dÀr_r
 = 
P‹tH™dÀr_r
;

1299 
OPL
->
p‹t_∑øm
 = 
∑øm
;

1300 
	}
}

1302 
	$OPLSëKeybﬂrdH™dÀr
(
FM_OPL
 *
OPL
,
OPL_PORTHANDLER_W
 
KeybﬂrdH™dÀr_w
,
OPL_PORTHANDLER_R
 
KeybﬂrdH™dÀr_r
,
∑øm
)

1304 
OPL
->
keybﬂrdh™dÀr_w
 = 
KeybﬂrdH™dÀr_w
;

1305 
OPL
->
keybﬂrdh™dÀr_r
 = 
KeybﬂrdH™dÀr_r
;

1306 
OPL
->
keybﬂrd_∑øm
 = 
∑øm
;

1307 
	}
}

1310 
	$OPLWrôe
(
FM_OPL
 *
OPL
,
a
,
v
)

1312 if–!(
a
&1) )

1314 
OPL
->
addªss
 = 
v
 & 0xff;

1318 if(
OPL
->
Upd©eH™dÀr
ËOPL->
	`Upd©eH™dÀr
(OPL->
Upd©eP¨am
,0);

1319 #ifde‡
OPL_OUTPUT_LOG


1320 if(
›l_dbg_Â
)

1322 
›l_dbg_chù
=0;›l_dbg_chù<
›l_dbg_maxchù
;opl_dbg_chip++)

1323 if–
›l_dbg_›l
[
›l_dbg_chù
] =
OPL
) ;

1324 
	`Ârötf
(
›l_dbg_Â
,"%c%c%c",0x10+
›l_dbg_chù
,
OPL
->
addªss
,
v
);

1327 
	`OPLWrôeReg
(
OPL
,OPL->
addªss
,
v
);

1329  
OPL
->
°©us
>>7;

1330 
	}
}

1332 
	$OPLRód
(
FM_OPL
 *
OPL
,
a
)

1334 if–!(
a
&1) )

1336  
OPL
->
°©us
 & (OPL->
°©usmask
|0x80);

1339 
OPL
->
addªss
)

1342 if(
OPL
->
ty≥
&
OPL_TYPE_KEYBOARD
)

1344 if(
OPL
->
keybﬂrdh™dÀr_r
)

1345  
OPL
->
	`keybﬂrdh™dÀr_r
(OPL->
keybﬂrd_∑øm
);

1347 
	`LOG
(
LOG_WAR
,("OPL:read unmapped KEYBOARDÖort\n"));

1355 if(
OPL
->
ty≥
&
OPL_TYPE_IO
)

1357 if(
OPL
->
p‹th™dÀr_r
)

1358  
OPL
->
	`p‹th™dÀr_r
(OPL->
p‹t_∑øm
);

1360 
	`LOG
(
LOG_WAR
,("OPL:read unmapped I/OÖort\n"));

1367 
	}
}

1369 
	$OPLTimîOvî
(
FM_OPL
 *
OPL
,
c
)

1371 if–
c
 )

1373 
	`OPL_STATUS_SET
(
OPL
,0x20);

1377 
	`OPL_STATUS_SET
(
OPL
,0x40);

1379 if–
OPL
->
mode
 & 0x80 )

1381 
ch
;

1382 if(
OPL
->
Upd©eH™dÀr
ËOPL->
	`Upd©eH™dÀr
(OPL->
Upd©eP¨am
,0);

1383 
ch
=0;ch<9;ch++)

1384 
	`CSMKeyC⁄åﬁl
–&
OPL
->
P_CH
[
ch
] );

1388 i‡(
OPL
->
TimîH™dÀr
Ë(OPL->TimîH™dÀr)(OPL->
TimîP¨am
+
c
,()OPL->
T
[c]*OPL->
TimîBa£
);

1389  
OPL
->
°©us
>>7;

1390 
	}
}

	@fmopl.h

1 #i‚de‡
__FMOPL_H_


2 
	#__FMOPL_H_


	)

5 
	#BUILD_YM3812
 (
HAS_YM3812
)

	)

11 
	#OPL_OUTPUT_BIT
 16

	)

14 #i‚de‡
OSD_CPU_H


15 
	#OSD_CPU_H


	)

16 
	tUINT8
;

17 
	tUINT16
;

18 
	tUINT32
;

19 sig√d 
	tINT8
;

20 sig√d 
	tINT16
;

21 sig√d 
	tINT32
;

24 #i‡(
OPL_OUTPUT_BIT
==16)

25 
INT16
 
	tOPLSAMPLE
;

27 #i‡(
OPL_OUTPUT_BIT
==8)

28 
	tOPLSAMPLE
;

32 #i‡
BUILD_Y8950


33 
	~"ymdñèt.h
"

36 (*
	tOPL_TIMERHANDLER
)(
	tch™√l
,
	töãrvÆ_Sec
);

37 (*
	tOPL_IRQHANDLER
)(
	t∑øm
,
	túq
);

38 (*
	tOPL_UPDATEHANDLER
)(
	t∑øm
,
	tmö_öãrvÆ_us
);

39 (*
	tOPL_PORTHANDLER_W
)(
	t∑øm
,
	td©a
);

40 (*
	tOPL_PORTHANDLER_R
)(
	t∑øm
);

44 
	#OPL_TYPE_WAVESEL
 0x01

	)

45 
	#OPL_TYPE_ADPCM
 0x02

	)

46 
	#OPL_TYPE_KEYBOARD
 0x04

	)

47 
	#OPL_TYPE_IO
 0x08

	)

51 
	sfm_›l_¶Ÿ
 {

52 
INT32
 
TL
;

53 
INT32
 
TLL
;

54 
UINT8
 
KSR
;

55 
INT32
 *
AR
;

56 
INT32
 *
DR
;

57 
INT32
 
SL
;

58 
INT32
 *
RR
;

59 
UINT8
 
k¶
;

60 
UINT8
 
k§
;

61 
UINT32
 
mul
;

62 
UINT32
 
C¡
;

63 
UINT32
 
In¸
;

65 
UINT8
 
eg_typ
;

66 
UINT8
 
evm
;

67 
INT32
 
evc
;

68 
INT32
 
eve
;

69 
INT32
 
evs
;

70 
INT32
 
evß
;

71 
INT32
 
evsd
;

72 
INT32
 
ev§
;

74 
UINT8
 
ams
;

75 
UINT8
 
vib
;

77 
INT32
 **
wavëabÀ
;

78 }
	tOPL_SLOT
;

81 
	sfm_›l_ch™√l
 {

82 
OPL_SLOT
 
SLOT
[2];

83 
UINT8
 
CON
;

84 
UINT8
 
FB
;

85 
INT32
 *
c⁄√˘1
;

86 
INT32
 *
c⁄√˘2
;

87 
INT32
 
›1_out
[2];

89 
UINT32
 
block_‚um
;

90 
UINT8
 
kcode
;

91 
UINT32
 
fc
;

92 
UINT32
 
k¶_ba£
;

93 
UINT8
 
key⁄
;

94 } 
	tOPL_CH
;

97 
	sfm_›l_f
 {

98 
UINT8
 
ty≥
;

99 
˛ock
;

100 
øã
;

101 
‰eqba£
;

102 
TimîBa£
;

103 
UINT8
 
addªss
;

104 
UINT8
 
°©us
;

105 
UINT8
 
°©usmask
;

106 
UINT32
 
mode
;

108 
T
[2];

109 
UINT8
 
°
[2];

111 
OPL_CH
 *
P_CH
;

112 
max_ch
;

114 
UINT8
 
rythm
;

115 #i‡
BUILD_Y8950


117 
YM_DELTAT
 *
dñèt
;

120 
UINT8
 
p‹tDúe˘i⁄
;

121 
UINT8
 
p‹tL©ch
;

122 
OPL_PORTHANDLER_R
 
p‹th™dÀr_r
;

123 
OPL_PORTHANDLER_W
 
p‹th™dÀr_w
;

124 
p‹t_∑øm
;

125 
OPL_PORTHANDLER_R
 
keybﬂrdh™dÀr_r
;

126 
OPL_PORTHANDLER_W
 
keybﬂrdh™dÀr_w
;

127 
keybﬂrd_∑øm
;

129 
INT32
 
AR_TABLE
[75];

130 
INT32
 
DR_TABLE
[75];

131 
UINT32
 
FN_TABLE
[1024];

133 
INT32
 *
ams_èbÀ
;

134 
INT32
 *
vib_èbÀ
;

135 
INT32
 
amsC¡
;

136 
INT32
 
amsIn¸
;

137 
INT32
 
vibC¡
;

138 
INT32
 
vibIn¸
;

140 
UINT8
 
wave£l
;

142 
OPL_TIMERHANDLER
 
TimîH™dÀr
;

143 
TimîP¨am
;

144 
OPL_IRQHANDLER
 
IRQH™dÀr
;

145 
IRQP¨am
;

146 
OPL_UPDATEHANDLER
 
Upd©eH™dÀr
;

147 
Upd©eP¨am
;

148 } 
	tFM_OPL
;

151 
	#OPL_TYPE_YM3526
 (0)

	)

152 
	#OPL_TYPE_YM3812
 (
OPL_TYPE_WAVESEL
)

	)

153 
	#OPL_TYPE_Y8950
 (
OPL_TYPE_ADPCM
|
OPL_TYPE_KEYBOARD
|
OPL_TYPE_IO
)

	)

155 
FM_OPL
 *
	`OPLCª©e
(
ty≥
, 
˛ock
, 
øã
);

156 
	`OPLDe°roy
(
FM_OPL
 *
OPL
);

157 
	`OPLSëTimîH™dÀr
(
FM_OPL
 *
OPL
,
OPL_TIMERHANDLER
 
TimîH™dÀr
,
ch™√lOff£t
);

158 
	`OPLSëIRQH™dÀr
(
FM_OPL
 *
OPL
,
OPL_IRQHANDLER
 
IRQH™dÀr
,
∑øm
);

159 
	`OPLSëUpd©eH™dÀr
(
FM_OPL
 *
OPL
,
OPL_UPDATEHANDLER
 
Upd©eH™dÀr
,
∑øm
);

161 
	`OPLSëP‹tH™dÀr
(
FM_OPL
 *
OPL
,
OPL_PORTHANDLER_W
 
P‹tH™dÀr_w
,
OPL_PORTHANDLER_R
 
P‹tH™dÀr_r
,
∑øm
);

162 
	`OPLSëKeybﬂrdH™dÀr
(
FM_OPL
 *
OPL
,
OPL_PORTHANDLER_W
 
KeybﬂrdH™dÀr_w
,
OPL_PORTHANDLER_R
 
KeybﬂrdH™dÀr_r
,
∑øm
);

164 
	`OPLRe£tChù
(
FM_OPL
 *
OPL
);

165 
	`OPLWrôe
(
FM_OPL
 *
OPL
,
a
,
v
);

166 
	`OPLRód
(
FM_OPL
 *
OPL
,
a
);

167 
	`OPLTimîOvî
(
FM_OPL
 *
OPL
,
c
);

170 
	`YM3812Upd©eO√
(
FM_OPL
 *
OPL
, 
INT16
 *
buf„r
, 
Àngth
);

172 
	`Y8950Upd©eO√
(
FM_OPL
 *
OPL
, 
INT16
 *
buf„r
, 
Àngth
);

	@grackle_pci.c

25 
	~"vl.h
"

26 
èrgë_phys_addr_t
 
	tpci_addr_t
;

27 
	~"pci_ho°.h
"

29 
PCIHo°Sèã
 
	tGøckÀSèã
;

31 
	$pci_gøckÀ_c⁄fig_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

32 
uöt32_t
 
vÆ
)

34 
GøckÀSèã
 *
s
 = 
›aque
;

35 #ifde‡
TARGET_WORDS_BIGENDIAN


36 
vÆ
 = 
	`bsw≠32
(val);

38 
s
->
c⁄fig_ªg
 = 
vÆ
;

39 
	}
}

41 
uöt32_t
 
	$pci_gøckÀ_c⁄fig_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

43 
GøckÀSèã
 *
s
 = 
›aque
;

44 
uöt32_t
 
vÆ
;

46 
vÆ
 = 
s
->
c⁄fig_ªg
;

47 #ifde‡
TARGET_WORDS_BIGENDIAN


48 
vÆ
 = 
	`bsw≠32
(val);

50  
vÆ
;

51 
	}
}

53 
CPUWrôeMem‹yFunc
 *
	gpci_gøckÀ_c⁄fig_wrôe
[] = {

54 &
pci_gøckÀ_c⁄fig_wrôñ
,

55 &
pci_gøckÀ_c⁄fig_wrôñ
,

56 &
pci_gøckÀ_c⁄fig_wrôñ
,

59 
CPURódMem‹yFunc
 *
	gpci_gøckÀ_c⁄fig_ªad
[] = {

60 &
pci_gøckÀ_c⁄fig_ªadl
,

61 &
pci_gøckÀ_c⁄fig_ªadl
,

62 &
pci_gøckÀ_c⁄fig_ªadl
,

65 
CPUWrôeMem‹yFunc
 *
	gpci_gøckÀ_wrôe
[] = {

66 &
pci_ho°_d©a_wrôeb
,

67 &
pci_ho°_d©a_wrôew
,

68 &
pci_ho°_d©a_wrôñ
,

71 
CPURódMem‹yFunc
 *
	gpci_gøckÀ_ªad
[] = {

72 &
pci_ho°_d©a_ªadb
,

73 &
pci_ho°_d©a_ªadw
,

74 &
pci_ho°_d©a_ªadl
,

78 
	$pci_gøckÀ_m≠_úq
(
PCIDevi˚
 *
pci_dev
, 
úq_num
)

80  (
úq_num
 + (
pci_dev
->
dev‚
 >> 3)) & 3;

81 
	}
}

83 
	$pci_gøckÀ_£t_úq
(*
pic
, 
úq_num
, 
Àvñ
)

85 
	`hóthrow_pic_£t_úq
(
pic
, 
úq_num
 + 8, 
Àvñ
);

86 
	}
}

88 
PCIBus
 *
	$pci_gøckÀ_öô
(
uöt32_t
 
ba£
, *
pic
)

90 
GøckÀSèã
 *
s
;

91 
PCIDevi˚
 *
d
;

92 
pci_mem_c⁄fig
, 
pci_mem_d©a
;

94 
s
 = 
	`qemu_mÆlocz
((
GøckÀSèã
));

95 
s
->
bus
 = 
	`pci_ªgi°î_bus
(
pci_gøckÀ_£t_úq
, 
pci_gøckÀ_m≠_úq
,

96 
pic
, 0, 0);

98 
pci_mem_c⁄fig
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_gøckÀ_c⁄fig_ªad
,

99 
pci_gøckÀ_c⁄fig_wrôe
, 
s
);

100 
pci_mem_d©a
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_gøckÀ_ªad
,

101 
pci_gøckÀ_wrôe
, 
s
);

102 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x1000, 
pci_mem_c⁄fig
);

103 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x00200000, 0x1000, 
pci_mem_d©a
);

104 
d
 = 
	`pci_ªgi°î_devi˚
(
s
->
bus
, "GøckÀ ho° bridge", (
PCIDevi˚
),

105 0, 
NULL
, NULL);

106 
d
->
c⁄fig
[0x00] = 0x57;

107 
d
->
c⁄fig
[0x01] = 0x10;

108 
d
->
c⁄fig
[0x02] = 0x02;

109 
d
->
c⁄fig
[0x03] = 0x00;

110 
d
->
c⁄fig
[0x08] = 0x00;

111 
d
->
c⁄fig
[0x09] = 0x01;

112 
d
->
c⁄fig
[0x0a] = 0x00;

113 
d
->
c⁄fig
[0x0b] = 0x06;

114 
d
->
c⁄fig
[0x0e] = 0x00;

116 
d
->
c⁄fig
[0x18] = 0x00;

117 
d
->
c⁄fig
[0x19] = 0x01;

118 
d
->
c⁄fig
[0x1a] = 0x00;

119 
d
->
c⁄fig
[0x1c] = 0x00;

120 
d
->
c⁄fig
[0x1d] = 0x00;

122 
d
->
c⁄fig
[0x20] = 0x00;

123 
d
->
c⁄fig
[0x21] = 0x00;

124 
d
->
c⁄fig
[0x22] = 0x01;

125 
d
->
c⁄fig
[0x23] = 0x00;

127 
d
->
c⁄fig
[0x24] = 0x00;

128 
d
->
c⁄fig
[0x25] = 0x00;

129 
d
->
c⁄fig
[0x26] = 0x00;

130 
d
->
c⁄fig
[0x27] = 0x00;

134 
d
->
c⁄fig
[0x00] = 0x11;

135 
d
->
c⁄fig
[0x01] = 0x10;

136 
d
->
c⁄fig
[0x02] = 0x26;

137 
d
->
c⁄fig
[0x03] = 0x00;

138 
d
->
c⁄fig
[0x08] = 0x02;

139 
d
->
c⁄fig
[0x0a] = 0x04;

140 
d
->
c⁄fig
[0x0b] = 0x06;

141 
d
->
c⁄fig
[0x0e] = 0x01;

143 
d
->
c⁄fig
[0x18] = 0x0;

144 
d
->
c⁄fig
[0x19] = 0x1;

145 
d
->
c⁄fig
[0x1a] = 0x1;

146 
d
->
c⁄fig
[0x1c] = 0x10;

147 
d
->
c⁄fig
[0x1d] = 0x20;

149 
d
->
c⁄fig
[0x20] = 0x80;

150 
d
->
c⁄fig
[0x21] = 0x80;

151 
d
->
c⁄fig
[0x22] = 0x90;

152 
d
->
c⁄fig
[0x23] = 0x80;

154 
d
->
c⁄fig
[0x24] = 0x00;

155 
d
->
c⁄fig
[0x25] = 0x84;

156 
d
->
c⁄fig
[0x26] = 0x00;

157 
d
->
c⁄fig
[0x27] = 0x85;

159  
s
->
bus
;

160 
	}
}

	@gt64xxx.c

25 
	~"vl.h
"

26 
èrgë_phys_addr_t
 
	tpci_addr_t
;

27 
	~"pci_ho°.h
"

29 
	#GT_REGS
 (0x1000 >> 2)

	)

32 
	#GT_CPU
 (0x000 >> 2)

	)

33 
	#GT_MULTI
 (0x120 >> 2)

	)

36 
	#GT_SCS10LD
 (0x008 >> 2)

	)

37 
	#GT_SCS10HD
 (0x010 >> 2)

	)

38 
	#GT_SCS32LD
 (0x018 >> 2)

	)

39 
	#GT_SCS32HD
 (0x020 >> 2)

	)

40 
	#GT_CS20LD
 (0x028 >> 2)

	)

41 
	#GT_CS20HD
 (0x030 >> 2)

	)

42 
	#GT_CS3BOOTLD
 (0x038 >> 2)

	)

43 
	#GT_CS3BOOTHD
 (0x040 >> 2)

	)

44 
	#GT_PCI0IOLD
 (0x048 >> 2)

	)

45 
	#GT_PCI0IOHD
 (0x050 >> 2)

	)

46 
	#GT_PCI0M0LD
 (0x058 >> 2)

	)

47 
	#GT_PCI0M0HD
 (0x060 >> 2)

	)

48 
	#GT_ISD
 (0x068 >> 2)

	)

50 
	#GT_PCI0M1LD
 (0x080 >> 2)

	)

51 
	#GT_PCI0M1HD
 (0x088 >> 2)

	)

52 
	#GT_PCI1IOLD
 (0x090 >> 2)

	)

53 
	#GT_PCI1IOHD
 (0x098 >> 2)

	)

54 
	#GT_PCI1M0LD
 (0x0a0 >> 2)

	)

55 
	#GT_PCI1M0HD
 (0x0a8 >> 2)

	)

56 
	#GT_PCI1M1LD
 (0x0b0 >> 2)

	)

57 
	#GT_PCI1M1HD
 (0x0b8 >> 2)

	)

58 
	#GT_PCI1M1LD
 (0x0b0 >> 2)

	)

59 
	#GT_PCI1M1HD
 (0x0b8 >> 2)

	)

61 
	#GT_SCS10AR
 (0x0d0 >> 2)

	)

62 
	#GT_SCS32AR
 (0x0d8 >> 2)

	)

63 
	#GT_CS20R
 (0x0e0 >> 2)

	)

64 
	#GT_CS3BOOTR
 (0x0e8 >> 2)

	)

66 
	#GT_PCI0IOREMAP
 (0x0f0 >> 2)

	)

67 
	#GT_PCI0M0REMAP
 (0x0f8 >> 2)

	)

68 
	#GT_PCI0M1REMAP
 (0x100 >> 2)

	)

69 
	#GT_PCI1IOREMAP
 (0x108 >> 2)

	)

70 
	#GT_PCI1M0REMAP
 (0x110 >> 2)

	)

71 
	#GT_PCI1M1REMAP
 (0x118 >> 2)

	)

74 
	#GT_CPUERR_ADDRLO
 (0x070 >> 2)

	)

75 
	#GT_CPUERR_ADDRHI
 (0x078 >> 2)

	)

76 
	#GT_CPUERR_DATALO
 (0x128 >> 2Ë

	)

77 
	#GT_CPUERR_DATAHI
 (0x130 >> 2Ë

	)

78 
	#GT_CPUERR_PARITY
 (0x138 >> 2Ë

	)

81 
	#GT_PCI0SYNC
 (0x0c0 >> 2)

	)

82 
	#GT_PCI1SYNC
 (0x0c8 >> 2)

	)

85 
	#GT_SCS0LD
 (0x400 >> 2)

	)

86 
	#GT_SCS0HD
 (0x404 >> 2)

	)

87 
	#GT_SCS1LD
 (0x408 >> 2)

	)

88 
	#GT_SCS1HD
 (0x40¯>> 2)

	)

89 
	#GT_SCS2LD
 (0x410 >> 2)

	)

90 
	#GT_SCS2HD
 (0x414 >> 2)

	)

91 
	#GT_SCS3LD
 (0x418 >> 2)

	)

92 
	#GT_SCS3HD
 (0x41¯>> 2)

	)

93 
	#GT_CS0LD
 (0x420 >> 2)

	)

94 
	#GT_CS0HD
 (0x424 >> 2)

	)

95 
	#GT_CS1LD
 (0x428 >> 2)

	)

96 
	#GT_CS1HD
 (0x42¯>> 2)

	)

97 
	#GT_CS2LD
 (0x430 >> 2)

	)

98 
	#GT_CS2HD
 (0x434 >> 2)

	)

99 
	#GT_CS3LD
 (0x438 >> 2)

	)

100 
	#GT_CS3HD
 (0x43¯>> 2)

	)

101 
	#GT_BOOTLD
 (0x440 >> 2)

	)

102 
	#GT_BOOTHD
 (0x444 >> 2)

	)

103 
	#GT_ADERR
 (0x470 >> 2)

	)

106 
	#GT_SDRAM_CFG
 (0x448 >> 2)

	)

107 
	#GT_SDRAM_OPMODE
 (0x474 >> 2)

	)

108 
	#GT_SDRAM_BM
 (0x478 >> 2)

	)

109 
	#GT_SDRAM_ADDRDECODE
 (0x47¯>> 2)

	)

112 
	#GT_SDRAM_B0
 (0x44¯>> 2)

	)

113 
	#GT_SDRAM_B1
 (0x450 >> 2)

	)

114 
	#GT_SDRAM_B2
 (0x454 >> 2)

	)

115 
	#GT_SDRAM_B3
 (0x458 >> 2)

	)

118 
	#GT_DEV_B0
 (0x45¯>> 2)

	)

119 
	#GT_DEV_B1
 (0x460 >> 2)

	)

120 
	#GT_DEV_B2
 (0x464 >> 2)

	)

121 
	#GT_DEV_B3
 (0x468 >> 2)

	)

122 
	#GT_DEV_BOOT
 (0x46¯>> 2)

	)

125 
	#GT_ECC_ERRDATALO
 (0x480 >> 2Ë

	)

126 
	#GT_ECC_ERRDATAHI
 (0x484 >> 2Ë

	)

127 
	#GT_ECC_MEM
 (0x488 >> 2Ë

	)

128 
	#GT_ECC_CALC
 (0x48¯>> 2Ë

	)

129 
	#GT_ECC_ERRADDR
 (0x490 >> 2Ë

	)

132 
	#GT_DMA0_CNT
 (0x800 >> 2)

	)

133 
	#GT_DMA1_CNT
 (0x804 >> 2)

	)

134 
	#GT_DMA2_CNT
 (0x808 >> 2)

	)

135 
	#GT_DMA3_CNT
 (0x80¯>> 2)

	)

136 
	#GT_DMA0_SA
 (0x810 >> 2)

	)

137 
	#GT_DMA1_SA
 (0x814 >> 2)

	)

138 
	#GT_DMA2_SA
 (0x818 >> 2)

	)

139 
	#GT_DMA3_SA
 (0x81¯>> 2)

	)

140 
	#GT_DMA0_DA
 (0x820 >> 2)

	)

141 
	#GT_DMA1_DA
 (0x824 >> 2)

	)

142 
	#GT_DMA2_DA
 (0x828 >> 2)

	)

143 
	#GT_DMA3_DA
 (0x82¯>> 2)

	)

144 
	#GT_DMA0_NEXT
 (0x830 >> 2)

	)

145 
	#GT_DMA1_NEXT
 (0x834 >> 2)

	)

146 
	#GT_DMA2_NEXT
 (0x838 >> 2)

	)

147 
	#GT_DMA3_NEXT
 (0x83¯>> 2)

	)

148 
	#GT_DMA0_CUR
 (0x870 >> 2)

	)

149 
	#GT_DMA1_CUR
 (0x874 >> 2)

	)

150 
	#GT_DMA2_CUR
 (0x878 >> 2)

	)

151 
	#GT_DMA3_CUR
 (0x87¯>> 2)

	)

154 
	#GT_DMA0_CTRL
 (0x840 >> 2)

	)

155 
	#GT_DMA1_CTRL
 (0x844 >> 2)

	)

156 
	#GT_DMA2_CTRL
 (0x848 >> 2)

	)

157 
	#GT_DMA3_CTRL
 (0x84¯>> 2)

	)

160 
	#GT_DMA_ARB
 (0x860 >> 2)

	)

163 
	#GT_TC0
 (0x850 >> 2)

	)

164 
	#GT_TC1
 (0x854 >> 2)

	)

165 
	#GT_TC2
 (0x858 >> 2)

	)

166 
	#GT_TC3
 (0x85¯>> 2)

	)

167 
	#GT_TC_CONTROL
 (0x864 >> 2)

	)

170 
	#GT_PCI0_CMD
 (0xc00 >> 2)

	)

171 
	#GT_PCI0_TOR
 (0xc04 >> 2)

	)

172 
	#GT_PCI0_BS_SCS10
 (0xc08 >> 2)

	)

173 
	#GT_PCI0_BS_SCS32
 (0xc0¯>> 2)

	)

174 
	#GT_PCI0_BS_CS20
 (0xc10 >> 2)

	)

175 
	#GT_PCI0_BS_CS3BT
 (0xc14 >> 2)

	)

176 
	#GT_PCI1_IACK
 (0xc30 >> 2)

	)

177 
	#GT_PCI0_IACK
 (0xc34 >> 2)

	)

178 
	#GT_PCI0_BARE
 (0xc3¯>> 2)

	)

179 
	#GT_PCI0_PREFMBR
 (0xc40 >> 2)

	)

180 
	#GT_PCI0_SCS10_BAR
 (0xc48 >> 2)

	)

181 
	#GT_PCI0_SCS32_BAR
 (0xc4¯>> 2)

	)

182 
	#GT_PCI0_CS20_BAR
 (0xc50 >> 2)

	)

183 
	#GT_PCI0_CS3BT_BAR
 (0xc54 >> 2)

	)

184 
	#GT_PCI0_SSCS10_BAR
 (0xc58 >> 2)

	)

185 
	#GT_PCI0_SSCS32_BAR
 (0xc5¯>> 2)

	)

186 
	#GT_PCI0_SCS3BT_BAR
 (0xc64 >> 2)

	)

187 
	#GT_PCI1_CMD
 (0xc80 >> 2)

	)

188 
	#GT_PCI1_TOR
 (0xc84 >> 2)

	)

189 
	#GT_PCI1_BS_SCS10
 (0xc88 >> 2)

	)

190 
	#GT_PCI1_BS_SCS32
 (0xc8¯>> 2)

	)

191 
	#GT_PCI1_BS_CS20
 (0xc90 >> 2)

	)

192 
	#GT_PCI1_BS_CS3BT
 (0xc94 >> 2)

	)

193 
	#GT_PCI1_BARE
 (0xcb¯>> 2)

	)

194 
	#GT_PCI1_PREFMBR
 (0xcc0 >> 2)

	)

195 
	#GT_PCI1_SCS10_BAR
 (0xcc8 >> 2)

	)

196 
	#GT_PCI1_SCS32_BAR
 (0xcc¯>> 2)

	)

197 
	#GT_PCI1_CS20_BAR
 (0xcd0 >> 2)

	)

198 
	#GT_PCI1_CS3BT_BAR
 (0xcd4 >> 2)

	)

199 
	#GT_PCI1_SSCS10_BAR
 (0xcd8 >> 2)

	)

200 
	#GT_PCI1_SSCS32_BAR
 (0xcd¯>> 2)

	)

201 
	#GT_PCI1_SCS3BT_BAR
 (0x˚4 >> 2)

	)

202 
	#GT_PCI1_CFGADDR
 (0xcf0 >> 2)

	)

203 
	#GT_PCI1_CFGDATA
 (0xcf4 >> 2)

	)

204 
	#GT_PCI0_CFGADDR
 (0xcf8 >> 2)

	)

205 
	#GT_PCI0_CFGDATA
 (0xcf¯>> 2)

	)

208 
	#GT_INTRCAUSE
 (0xc18 >> 2)

	)

209 
	#GT_INTRMASK
 (0xc1¯>> 2)

	)

210 
	#GT_PCI0_ICMASK
 (0xc24 >> 2)

	)

211 
	#GT_PCI0_SERR0MASK
 (0xc28 >> 2)

	)

212 
	#GT_CPU_INTSEL
 (0xc70 >> 2)

	)

213 
	#GT_PCI0_INTSEL
 (0xc74 >> 2)

	)

214 
	#GT_HINTRCAUSE
 (0xc98 >> 2)

	)

215 
	#GT_HINTRMASK
 (0xc9¯>> 2)

	)

216 
	#GT_PCI0_HICMASK
 (0xˇ4 >> 2)

	)

217 
	#GT_PCI1_SERR1MASK
 (0xˇ8 >> 2)

	)

220 
PCIHo°Sèã
 
	tGT64120PCISèã
;

222 
	sGT64120Sèã
 {

223 
GT64120PCISèã
 *
	mpci
;

224 
uöt32_t
 
	mªgs
[
GT_REGS
];

225 } 
	tGT64120Sèã
;

227 
	$gt64120_pci_m≠pög
(
GT64120Sèã
 *
s
)

229 
èrgë_phys_addr_t
 
°¨t
, 
Àngth
;

232 i‡((
s
->
ªgs
[
GT_PCI0IOLD
] & 0x7fË<s->ªgs[
GT_PCI0IOHD
])

234 
°¨t
 = 
s
->
ªgs
[
GT_PCI0IOLD
] << 21;

235 
Àngth
 = ((
s
->
ªgs
[
GT_PCI0IOHD
] + 1Ë- (s->ªgs[
GT_PCI0IOLD
] & 0x7f)) << 21;

236 
	`iß_mmio_öô
(
°¨t
, 
Àngth
);

238 
	}
}

240 
	$gt64120_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

241 
uöt32_t
 
vÆ
)

243 
GT64120Sèã
 *
s
 = 
›aque
;

244 
uöt32_t
 
ßddr
;

246 #ifde‡
TARGET_WORDS_BIGENDIAN


247 
vÆ
 = 
	`bsw≠32
(val);

250 
ßddr
 = (
addr
 & 0xfff) >> 2;

251 
ßddr
) {

254 
GT_CPU
:

255 
s
->
ªgs
[
GT_CPU
] = 
vÆ
;

257 
GT_MULTI
:

262 
GT_PCI0IOLD
:

263 
s
->
ªgs
[
GT_PCI0IOLD
] = 
vÆ
 & 0x00007fff;

264 
s
->
ªgs
[
GT_PCI0IOREMAP
] = 
vÆ
 & 0x000007ff;

265 
	`gt64120_pci_m≠pög
(
s
);

267 
GT_PCI0M0LD
:

268 
s
->
ªgs
[
GT_PCI0M0LD
] = 
vÆ
 & 0x00007fff;

269 
s
->
ªgs
[
GT_PCI0M0REMAP
] = 
vÆ
 & 0x000007ff;

270 
	`gt64120_pci_m≠pög
(
s
);

272 
GT_PCI0M1LD
:

273 
s
->
ªgs
[
GT_PCI0M1LD
] = 
vÆ
 & 0x00007fff;

274 
s
->
ªgs
[
GT_PCI0M1REMAP
] = 
vÆ
 & 0x000007ff;

275 
	`gt64120_pci_m≠pög
(
s
);

277 
GT_PCI1IOLD
:

278 
s
->
ªgs
[
GT_PCI1IOLD
] = 
vÆ
 & 0x00007fff;

279 
s
->
ªgs
[
GT_PCI1IOREMAP
] = 
vÆ
 & 0x000007ff;

280 
	`gt64120_pci_m≠pög
(
s
);

282 
GT_PCI1M0LD
:

283 
s
->
ªgs
[
GT_PCI1M0LD
] = 
vÆ
 & 0x00007fff;

284 
s
->
ªgs
[
GT_PCI1M0REMAP
] = 
vÆ
 & 0x000007ff;

285 
	`gt64120_pci_m≠pög
(
s
);

287 
GT_PCI1M1LD
:

288 
s
->
ªgs
[
GT_PCI1M1LD
] = 
vÆ
 & 0x00007fff;

289 
s
->
ªgs
[
GT_PCI1M1REMAP
] = 
vÆ
 & 0x000007ff;

290 
	`gt64120_pci_m≠pög
(
s
);

292 
GT_PCI0IOHD
:

293 
GT_PCI0M0HD
:

294 
GT_PCI0M1HD
:

295 
GT_PCI1IOHD
:

296 
GT_PCI1M0HD
:

297 
GT_PCI1M1HD
:

298 
s
->
ªgs
[
ßddr
] = 
vÆ
 & 0x0000007f;

299 
	`gt64120_pci_m≠pög
(
s
);

301 
GT_PCI0IOREMAP
:

302 
GT_PCI0M0REMAP
:

303 
GT_PCI0M1REMAP
:

304 
GT_PCI1IOREMAP
:

305 
GT_PCI1M0REMAP
:

306 
GT_PCI1M1REMAP
:

307 
s
->
ªgs
[
ßddr
] = 
vÆ
 & 0x000007ff;

308 
	`gt64120_pci_m≠pög
(
s
);

312 
GT_CPUERR_ADDRLO
:

313 
GT_CPUERR_ADDRHI
:

314 
GT_CPUERR_DATALO
:

315 
GT_CPUERR_DATAHI
:

316 
GT_CPUERR_PARITY
:

321 
GT_PCI0SYNC
:

322 
GT_PCI1SYNC
:

327 
GT_ECC_ERRDATALO
:

328 
GT_ECC_ERRDATAHI
:

329 
GT_ECC_MEM
:

330 
GT_ECC_CALC
:

331 
GT_ECC_ERRADDR
:

336 
GT_PCI0_CMD
:

337 
GT_PCI1_CMD
:

338 
s
->
ªgs
[
ßddr
] = 
vÆ
 & 0x0401fc0f;

340 
GT_PCI0_CFGADDR
:

341 
s
->
pci
->
c⁄fig_ªg
 = 
vÆ
 & 0x80fffffc;

343 
GT_PCI0_CFGDATA
:

344 
	`pci_ho°_d©a_wrôñ
(
s
->
pci
, 0, 
vÆ
);

348 
GT_SDRAM_B0
:

349 
GT_SDRAM_B1
:

350 
GT_SDRAM_B2
:

351 
GT_SDRAM_B3
:

354 
s
->
ªgs
[
ßddr
] = 
vÆ
;

359 
	`¥ötf
 ("gt64120_wrôñ: BadÑegi°î off£à0x%x\n", ()
addr
);

363 
	}
}

365 
uöt32_t
 
	$gt64120_ªadl
 (*
›aque
,

366 
èrgë_phys_addr_t
 
addr
)

368 
GT64120Sèã
 *
s
 = 
›aque
;

369 
uöt32_t
 
vÆ
;

370 
uöt32_t
 
ßddr
;

372 
vÆ
 = 0;

373 
ßddr
 = (
addr
 & 0xfff) >> 2;

375 
ßddr
) {

378 
GT_MULTI
:

381 
vÆ
 = 
s
->
ªgs
[
ßddr
];

385 
GT_CPUERR_ADDRLO
:

386 
GT_CPUERR_ADDRHI
:

387 
GT_CPUERR_DATALO
:

388 
GT_CPUERR_DATAHI
:

389 
GT_CPUERR_PARITY
:

392 
vÆ
 = 
s
->
ªgs
[
ßddr
];

396 
GT_PCI0SYNC
:

397 
GT_PCI1SYNC
:

401 
vÆ
 = 0xc000ffee;

405 
GT_ECC_ERRDATALO
:

406 
GT_ECC_ERRDATAHI
:

407 
GT_ECC_MEM
:

408 
GT_ECC_CALC
:

409 
GT_ECC_ERRADDR
:

412 
vÆ
 = 
s
->
ªgs
[
ßddr
];

415 
GT_CPU
:

416 
GT_PCI0IOLD
:

417 
GT_PCI0M0LD
:

418 
GT_PCI0M1LD
:

419 
GT_PCI1IOLD
:

420 
GT_PCI1M0LD
:

421 
GT_PCI1M1LD
:

422 
GT_PCI0IOHD
:

423 
GT_PCI0M0HD
:

424 
GT_PCI0M1HD
:

425 
GT_PCI1IOHD
:

426 
GT_PCI1M0HD
:

427 
GT_PCI1M1HD
:

428 
GT_PCI0_CMD
:

429 
GT_PCI1_CMD
:

430 
GT_PCI0IOREMAP
:

431 
GT_PCI0M0REMAP
:

432 
GT_PCI0M1REMAP
:

433 
GT_PCI1IOREMAP
:

434 
GT_PCI1M0REMAP
:

435 
GT_PCI1M1REMAP
:

436 
vÆ
 = 
s
->
ªgs
[
ßddr
];

438 
GT_PCI0_IACK
:

440 
vÆ
 = 
	`pic_ªad_úq
(
iß_pic
);

444 
GT_SDRAM_B0
:

445 
GT_SDRAM_B1
:

446 
GT_SDRAM_B2
:

447 
GT_SDRAM_B3
:

450 
vÆ
 = 
s
->
ªgs
[
ßddr
];

454 
GT_PCI0_CFGADDR
:

455 
vÆ
 = 
s
->
pci
->
c⁄fig_ªg
;

457 
GT_PCI0_CFGDATA
:

458 
vÆ
 = 
	`pci_ho°_d©a_ªadl
(
s
->
pci
, 0);

462 
vÆ
 = 
s
->
ªgs
[
ßddr
];

464 
	`¥ötf
 ("gt64120_ªadl: BadÑegi°î off£à0x%x\n", ()
addr
);

469 #ifde‡
TARGET_WORDS_BIGENDIAN


470  
	`bsw≠32
(
vÆ
);

472  
vÆ
;

474 
	}
}

476 
CPUWrôeMem‹yFunc
 *
	ggt64120_wrôe
[] = {

477 &
gt64120_wrôñ
,

478 &
gt64120_wrôñ
,

479 &
gt64120_wrôñ
,

482 
CPURódMem‹yFunc
 *
	ggt64120_ªad
[] = {

483 &
gt64120_ªadl
,

484 &
gt64120_ªadl
,

485 &
gt64120_ªadl
,

488 
	$pci_gt64120_m≠_úq
(
PCIDevi˚
 *
pci_dev
, 
úq_num
)

490 
¶Ÿ
;

492 
¶Ÿ
 = (
pci_dev
->
dev‚
 >> 3);

494 
¶Ÿ
) {

506  ((
¶Ÿ
 - 18Ë+ 
úq_num
) & 0x03;

509  
úq_num
;

511 
	}
}

513 
PCIDevi˚
 *
piix4_dev
;

514 
	gpci_úq_Àvñs
[4];

516 
	$pci_gt64120_£t_úq
(*
pic
, 
úq_num
, 
Àvñ
)

518 
i
, 
pic_úq
, 
pic_Àvñ
;

520 
pci_úq_Àvñs
[
úq_num
] = 
Àvñ
;

524 
pic_úq
 = 
piix4_dev
->
c⁄fig
[0x60 + 
úq_num
];

525 i‡(
pic_úq
 < 16) {

528 
pic_Àvñ
 = 0;

529 
i
 = 0; i < 4; i++) {

530 i‡(
pic_úq
 =
piix4_dev
->
c⁄fig
[0x60 + 
i
])

531 
pic_Àvñ
 |
pci_úq_Àvñs
[
i
];

533 
	`pic_£t_úq
(
pic_úq
, 
pic_Àvñ
);

535 
	}
}

538 
	$gt64120_ª£t
(*
›aque
)

540 
GT64120Sèã
 *
s
 = 
›aque
;

543 #ifde‡
TARGET_WORDS_BIGENDIAN


544 
s
->
ªgs
[
GT_CPU
] = 0x00000000;

546 
s
->
ªgs
[
GT_CPU
] = 0x00000800;

548 
s
->
ªgs
[
GT_MULTI
] = 0x00000000;

551 
s
->
ªgs
[
GT_PCI0IOLD
] = 0x00000080;

552 
s
->
ªgs
[
GT_PCI0IOHD
] = 0x0000000f;

553 
s
->
ªgs
[
GT_PCI0M0LD
] = 0x00000090;

554 
s
->
ªgs
[
GT_PCI0M0HD
] = 0x0000001f;

555 
s
->
ªgs
[
GT_PCI0M1LD
] = 0x00000790;

556 
s
->
ªgs
[
GT_PCI0M1HD
] = 0x0000001f;

557 
s
->
ªgs
[
GT_PCI1IOLD
] = 0x00000100;

558 
s
->
ªgs
[
GT_PCI1IOHD
] = 0x0000000f;

559 
s
->
ªgs
[
GT_PCI1M0LD
] = 0x00000110;

560 
s
->
ªgs
[
GT_PCI1M0HD
] = 0x0000001f;

561 
s
->
ªgs
[
GT_PCI1M1LD
] = 0x00000120;

562 
s
->
ªgs
[
GT_PCI1M1HD
] = 0x0000002f;

563 
s
->
ªgs
[
GT_PCI0IOREMAP
] = 0x00000080;

564 
s
->
ªgs
[
GT_PCI0M0REMAP
] = 0x00000090;

565 
s
->
ªgs
[
GT_PCI0M1REMAP
] = 0x00000790;

566 
s
->
ªgs
[
GT_PCI1IOREMAP
] = 0x00000100;

567 
s
->
ªgs
[
GT_PCI1M0REMAP
] = 0x00000110;

568 
s
->
ªgs
[
GT_PCI1M1REMAP
] = 0x00000120;

571 
s
->
ªgs
[
GT_CPUERR_ADDRLO
] = 0x00000000;

572 
s
->
ªgs
[
GT_CPUERR_ADDRHI
] = 0x00000000;

573 
s
->
ªgs
[
GT_CPUERR_DATALO
] = 0xffffffff;

574 
s
->
ªgs
[
GT_CPUERR_DATAHI
] = 0xffffffff;

575 
s
->
ªgs
[
GT_CPUERR_PARITY
] = 0x000000ff;

578 
s
->
ªgs
[
GT_ECC_ERRDATALO
] = 0x00000000;

579 
s
->
ªgs
[
GT_ECC_ERRDATAHI
] = 0x00000000;

580 
s
->
ªgs
[
GT_ECC_MEM
] = 0x00000000;

581 
s
->
ªgs
[
GT_ECC_CALC
] = 0x00000000;

582 
s
->
ªgs
[
GT_ECC_ERRADDR
] = 0x00000000;

585 
s
->
ªgs
[
GT_SDRAM_B0
] = 0x00000005;

586 
s
->
ªgs
[
GT_SDRAM_B1
] = 0x00000005;

587 
s
->
ªgs
[
GT_SDRAM_B2
] = 0x00000005;

588 
s
->
ªgs
[
GT_SDRAM_B3
] = 0x00000005;

591 #ifde‡
TARGET_WORDS_BIGENDIAN


592 
s
->
ªgs
[
GT_PCI0_CMD
] = 0x00000000;

593 
s
->
ªgs
[
GT_PCI1_CMD
] = 0x00000000;

595 
s
->
ªgs
[
GT_PCI0_CMD
] = 0x00010001;

596 
s
->
ªgs
[
GT_PCI1_CMD
] = 0x00010001;

598 
s
->
ªgs
[
GT_PCI0_IACK
] = 0x00000000;

599 
s
->
ªgs
[
GT_PCI1_IACK
] = 0x00000000;

601 
	`gt64120_pci_m≠pög
(
s
);

602 
	}
}

604 
PCIBus
 *
	$pci_gt64120_öô
(*
pic
)

606 
GT64120Sèã
 *
s
;

607 
PCIDevi˚
 *
d
;

608 
gt64120
;

610 
s
 = 
	`qemu_mÆlocz
((
GT64120Sèã
));

611 
s
->
pci
 = 
	`qemu_mÆlocz
((
GT64120PCISèã
));

612 
	`gt64120_ª£t
(
s
);

614 
s
->
pci
->
bus
 = 
	`pci_ªgi°î_bus
(
pci_gt64120_£t_úq
, 
pci_gt64120_m≠_úq
,

615 
pic
, 144, 4);

617 
gt64120
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
gt64120_ªad
,

618 
gt64120_wrôe
, 
s
);

619 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x1be00000LL, 0x1000, 
gt64120
);

621 
d
 = 
	`pci_ªgi°î_devi˚
(
s
->
pci
->
bus
, "GT64120 PCI Bus", (
PCIDevi˚
),

622 0, 
NULL
, NULL);

624 
d
->
c⁄fig
[0x00] = 0xab;

625 
d
->
c⁄fig
[0x01] = 0x11;

626 
d
->
c⁄fig
[0x02] = 0x46;

627 
d
->
c⁄fig
[0x03] = 0x20;

628 
d
->
c⁄fig
[0x04] = 0x06;

629 
d
->
c⁄fig
[0x05] = 0x00;

630 
d
->
c⁄fig
[0x06] = 0x80;

631 
d
->
c⁄fig
[0x07] = 0xa2;

632 
d
->
c⁄fig
[0x08] = 0x10;

633 
d
->
c⁄fig
[0x09] = 0x00;

634 
d
->
c⁄fig
[0x0A] = 0x80;

635 
d
->
c⁄fig
[0x0B] = 0x05;

636 
d
->
c⁄fig
[0x0C] = 0x08;

637 
d
->
c⁄fig
[0x0D] = 0x40;

638 
d
->
c⁄fig
[0x0E] = 0x00;

639 
d
->
c⁄fig
[0x0F] = 0x00;

640 
d
->
c⁄fig
[0x17] = 0x08;

641 
d
->
c⁄fig
[0x1B] = 0x1c;

642 
d
->
c⁄fig
[0x1F] = 0x1f;

643 
d
->
c⁄fig
[0x23] = 0x14;

644 
d
->
c⁄fig
[0x27] = 0x14;

645 
d
->
c⁄fig
[0x3D] = 0x01;

647  
s
->
pci
->
bus
;

648 
	}
}

	@heathrow_pic.c

24 
	~"vl.h
"

28 
	sHóthrowPIC
 {

29 
uöt32_t
 
	mevíts
;

30 
uöt32_t
 
	mmask
;

31 
uöt32_t
 
	mÀvñs
;

32 
uöt32_t
 
	mÀvñ_åiggîed
;

33 } 
	tHóthrowPIC
;

35 
	sHóthrowPICS
 {

36 
HóthrowPIC
 
	mpics
[2];

39 
ölöe
 
	$check_úq
(
HóthrowPIC
 *
pic
)

41  (
pic
->
evíts
 | (pic->
Àvñs
 &Öic->
Àvñ_åiggîed
)Ë&Öic->
mask
;

42 
	}
}

45 
	$hóthrow_pic_upd©e
(
HóthrowPICS
 *
s
)

47 i‡(
	`check_úq
(&
s
->
pics
[0]) || check_irq(&s->pics[1])) {

48 
	`˝u_öãºu±
(
fú°_˝u
, 
CPU_INTERRUPT_HARD
);

50 
	`˝u_ª£t_öãºu±
(
fú°_˝u
, 
CPU_INTERRUPT_HARD
);

52 
	}
}

54 
	$pic_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

56 
HóthrowPICS
 *
s
 = 
›aque
;

57 
HóthrowPIC
 *
pic
;

58 
n
;

60 
vÆue
 = 
	`bsw≠32
(value);

61 #ifde‡
DEBUG


62 
	`¥ötf
("pic_writel: %08x: %08x\n",

63 
addr
, 
vÆue
);

65 
n
 = ((
addr
 & 0xfff) - 0x10) >> 4;

66 i‡(
n
 >= 2)

68 
pic
 = &
s
->
pics
[
n
];

69 
addr
 & 0xf) {

71 
pic
->
mask
 = 
vÆue
;

72 
	`hóthrow_pic_upd©e
(
s
);

76 
vÆue
 &~
pic
->
Àvñ_åiggîed
;

77 
pic
->
evíts
 &~
vÆue
;

78 
	`hóthrow_pic_upd©e
(
s
);

83 
	}
}

85 
uöt32_t
 
	$pic_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

87 
HóthrowPICS
 *
s
 = 
›aque
;

88 
HóthrowPIC
 *
pic
;

89 
n
;

90 
uöt32_t
 
vÆue
;

92 
n
 = ((
addr
 & 0xfff) - 0x10) >> 4;

93 i‡(
n
 >= 2) {

94 
vÆue
 = 0;

96 
pic
 = &
s
->
pics
[
n
];

97 
addr
 & 0xf) {

99 
vÆue
 = 
pic
->
evíts
;

102 
vÆue
 = 
pic
->
mask
;

105 
vÆue
 = 
pic
->
Àvñs
;

108 
vÆue
 = 0;

112 #ifde‡
DEBUG


113 
	`¥ötf
("pic_readl: %08x: %08x\n",

114 
addr
, 
vÆue
);

116 
vÆue
 = 
	`bsw≠32
(value);

117  
vÆue
;

118 
	}
}

120 
CPUWrôeMem‹yFunc
 *
	gpic_wrôe
[] = {

121 &
pic_wrôñ
,

122 &
pic_wrôñ
,

123 &
pic_wrôñ
,

126 
CPURódMem‹yFunc
 *
	gpic_ªad
[] = {

127 &
pic_ªadl
,

128 &
pic_ªadl
,

129 &
pic_ªadl
,

133 
	$hóthrow_pic_£t_úq
(*
›aque
, 
num
, 
Àvñ
)

135 
HóthrowPICS
 *
s
 = 
›aque
;

136 
HóthrowPIC
 *
pic
;

137 
úq_bô
;

139 #i‡
	`deföed
(
DEBUG
)

141 
œ°_Àvñ
[64];

142 i‡(
œ°_Àvñ
[
num
] !
Àvñ
) {

143 
	`¥ötf
("£t_úq:Çum=0x%02xÜevñ=%d\n", 
num
, 
Àvñ
);

144 
œ°_Àvñ
[
num
] = 
Àvñ
;

148 
pic
 = &
s
->
pics
[1 - (
num
 >> 5)];

149 
úq_bô
 = 1 << (
num
 & 0x1f);

150 i‡(
Àvñ
) {

151 
pic
->
evíts
 |
úq_bô
 & ~pic->
Àvñ_åiggîed
;

152 
pic
->
Àvñs
 |
úq_bô
;

154 
pic
->
Àvñs
 &~
úq_bô
;

156 
	`hóthrow_pic_upd©e
(
s
);

157 
	}
}

159 
HóthrowPICS
 *
	$hóthrow_pic_öô
(*
pmem_ödex
)

161 
HóthrowPICS
 *
s
;

163 
s
 = 
	`qemu_mÆlocz
((
HóthrowPICS
));

164 
s
->
pics
[0].
Àvñ_åiggîed
 = 0;

165 
s
->
pics
[1].
Àvñ_åiggîed
 = 0x1ff00000;

166 *
pmem_ödex
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pic_ªad
, 
pic_wrôe
, 
s
);

167  
s
;

168 
	}
}

	@i8254.c

24 
	~"vl.h
"

28 
	#RW_STATE_LSB
 1

	)

29 
	#RW_STATE_MSB
 2

	)

30 
	#RW_STATE_WORD0
 3

	)

31 
	#RW_STATE_WORD1
 4

	)

33 
	sPITCh™√lSèã
 {

34 
	mcou¡
;

35 
uöt16_t
 
	mœtched_cou¡
;

36 
uöt8_t
 
	mcou¡_œtched
;

37 
uöt8_t
 
	m°©us_œtched
;

38 
uöt8_t
 
	m°©us
;

39 
uöt8_t
 
	mªad_°©e
;

40 
uöt8_t
 
	mwrôe_°©e
;

41 
uöt8_t
 
	mwrôe_œtch
;

42 
uöt8_t
 
	mrw_mode
;

43 
uöt8_t
 
	mmode
;

44 
uöt8_t
 
	mbcd
;

45 
uöt8_t
 
	mg©e
;

46 
öt64_t
 
	mcou¡_lﬂd_time
;

48 
öt64_t
 
	m√xt_å™sôi⁄_time
;

49 
QEMUTimî
 *
	múq_timî
;

50 
	múq
;

51 } 
	tPITCh™√lSèã
;

53 
	sPITSèã
 {

54 
PITCh™√lSèã
 
	mch™√ls
[3];

57 
PITSèã
 
	gpô_°©e
;

59 
pô_úq_timî_upd©e
(
PITCh™√lSèã
 *
s
, 
öt64_t
 
cuºít_time
);

61 
	$pô_gë_cou¡
(
PITCh™√lSèã
 *
s
)

63 
uöt64_t
 
d
;

64 
cou¡î
;

66 
d
 = 
	`muldiv64
(
	`qemu_gë_˛ock
(
vm_˛ock
Ë- 
s
->
cou¡_lﬂd_time
, 
PIT_FREQ
, 
ticks_≥r_£c
);

67 
s
->
mode
) {

72 
cou¡î
 = (
s
->
cou¡
 - 
d
) & 0xffff;

76 
cou¡î
 = 
s
->
cou¡
 - ((2 * 
d
) % s->count);

79 
cou¡î
 = 
s
->
cou¡
 - (
d
 % s->count);

82  
cou¡î
;

83 
	}
}

86 
	$pô_gë_out1
(
PITCh™√lSèã
 *
s
, 
öt64_t
 
cuºít_time
)

88 
uöt64_t
 
d
;

89 
out
;

91 
d
 = 
	`muldiv64
(
cuºít_time
 - 
s
->
cou¡_lﬂd_time
, 
PIT_FREQ
, 
ticks_≥r_£c
);

92 
s
->
mode
) {

95 
out
 = (
d
 >
s
->
cou¡
);

98 
out
 = (
d
 < 
s
->
cou¡
);

101 i‡((
d
 % 
s
->
cou¡
) == 0 && d != 0)

102 
out
 = 1;

104 
out
 = 0;

107 
out
 = (
d
 % 
s
->
cou¡
) < ((s->count + 1) >> 1);

111 
out
 = (
d
 =
s
->
cou¡
);

114  
out
;

115 
	}
}

117 
	$pô_gë_out
(
PITSèã
 *
pô
, 
ch™√l
, 
öt64_t
 
cuºít_time
)

119 
PITCh™√lSèã
 *
s
 = &
pô
->
ch™√ls
[
ch™√l
];

120  
	`pô_gë_out1
(
s
, 
cuºít_time
);

121 
	}
}

124 
öt64_t
 
	$pô_gë_√xt_å™sôi⁄_time
(
PITCh™√lSèã
 *
s
,

125 
öt64_t
 
cuºít_time
)

127 
uöt64_t
 
d
, 
√xt_time
, 
ba£
;

128 
≥riod2
;

130 
d
 = 
	`muldiv64
(
cuºít_time
 - 
s
->
cou¡_lﬂd_time
, 
PIT_FREQ
, 
ticks_≥r_£c
);

131 
s
->
mode
) {

135 i‡(
d
 < 
s
->
cou¡
)

136 
√xt_time
 = 
s
->
cou¡
;

141 
ba£
 = (
d
 / 
s
->
cou¡
) * s->count;

142 i‡((
d
 - 
ba£
) == 0 && d != 0)

143 
√xt_time
 = 
ba£
 + 
s
->
cou¡
;

145 
√xt_time
 = 
ba£
 + 
s
->
cou¡
 + 1;

148 
ba£
 = (
d
 / 
s
->
cou¡
) * s->count;

149 
≥riod2
 = ((
s
->
cou¡
 + 1) >> 1);

150 i‡((
d
 - 
ba£
Ë< 
≥riod2
)

151 
√xt_time
 = 
ba£
 + 
≥riod2
;

153 
√xt_time
 = 
ba£
 + 
s
->
cou¡
;

157 i‡(
d
 < 
s
->
cou¡
)

158 
√xt_time
 = 
s
->
cou¡
;

159 i‡(
d
 =
s
->
cou¡
)

160 
√xt_time
 = 
s
->
cou¡
 + 1;

166 
√xt_time
 = 
s
->
cou¡_lﬂd_time
 + 
	`muldiv64
“ext_time, 
ticks_≥r_£c
, 
PIT_FREQ
);

169 i‡(
√xt_time
 <
cuºít_time
)

170 
√xt_time
 = 
cuºít_time
 + 1;

171  
√xt_time
;

172 
	}
}

175 
	$pô_£t_g©e
(
PITSèã
 *
pô
, 
ch™√l
, 
vÆ
)

177 
PITCh™√lSèã
 *
s
 = &
pô
->
ch™√ls
[
ch™√l
];

179 
s
->
mode
) {

187 i‡(
s
->
g©e
 < 
vÆ
) {

189 
s
->
cou¡_lﬂd_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

190 
	`pô_úq_timî_upd©e
(
s
, s->
cou¡_lﬂd_time
);

195 i‡(
s
->
g©e
 < 
vÆ
) {

197 
s
->
cou¡_lﬂd_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

198 
	`pô_úq_timî_upd©e
(
s
, s->
cou¡_lﬂd_time
);

203 
s
->
g©e
 = 
vÆ
;

204 
	}
}

206 
	$pô_gë_g©e
(
PITSèã
 *
pô
, 
ch™√l
)

208 
PITCh™√lSèã
 *
s
 = &
pô
->
ch™√ls
[
ch™√l
];

209  
s
->
g©e
;

210 
	}
}

212 
	$pô_gë_öôül_cou¡
(
PITSèã
 *
pô
, 
ch™√l
)

214 
PITCh™√lSèã
 *
s
 = &
pô
->
ch™√ls
[
ch™√l
];

215  
s
->
cou¡
;

216 
	}
}

218 
	$pô_gë_mode
(
PITSèã
 *
pô
, 
ch™√l
)

220 
PITCh™√lSèã
 *
s
 = &
pô
->
ch™√ls
[
ch™√l
];

221  
s
->
mode
;

222 
	}
}

224 
ölöe
 
	$pô_lﬂd_cou¡
(
PITCh™√lSèã
 *
s
, 
vÆ
)

226 i‡(
vÆ
 == 0)

227 
vÆ
 = 0x10000;

228 
s
->
cou¡_lﬂd_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

229 
s
->
cou¡
 = 
vÆ
;

230 
	`pô_úq_timî_upd©e
(
s
, s->
cou¡_lﬂd_time
);

231 
	}
}

234 
	$pô_œtch_cou¡
(
PITCh™√lSèã
 *
s
)

236 i‡(!
s
->
cou¡_œtched
) {

237 
s
->
œtched_cou¡
 = 
	`pô_gë_cou¡
(s);

238 
s
->
cou¡_œtched
 = s->
rw_mode
;

240 
	}
}

242 
	$pô_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

244 
PITSèã
 *
pô
 = 
›aque
;

245 
ch™√l
, 
ac˚ss
;

246 
PITCh™√lSèã
 *
s
;

248 
addr
 &= 3;

249 i‡(
addr
 == 3) {

250 
ch™√l
 = 
vÆ
 >> 6;

251 i‡(
ch™√l
 == 3) {

253 
ch™√l
 = 0; channel < 3; channel++) {

254 
s
 = &
pô
->
ch™√ls
[
ch™√l
];

255 i‡(
vÆ
 & (2 << 
ch™√l
)) {

256 i‡(!(
vÆ
 & 0x20)) {

257 
	`pô_œtch_cou¡
(
s
);

259 i‡(!(
vÆ
 & 0x10Ë&& !
s
->
°©us_œtched
) {

262 
s
->
°©us
 = (
	`pô_gë_out1
(s, 
	`qemu_gë_˛ock
(
vm_˛ock
)) << 7) |

263 (
s
->
rw_mode
 << 4) |

264 (
s
->
mode
 << 1) |

265 
s
->
bcd
;

266 
s
->
°©us_œtched
 = 1;

271 
s
 = &
pô
->
ch™√ls
[
ch™√l
];

272 
ac˚ss
 = (
vÆ
 >> 4) & 3;

273 i‡(
ac˚ss
 == 0) {

274 
	`pô_œtch_cou¡
(
s
);

276 
s
->
rw_mode
 = 
ac˚ss
;

277 
s
->
ªad_°©e
 = 
ac˚ss
;

278 
s
->
wrôe_°©e
 = 
ac˚ss
;

280 
s
->
mode
 = (
vÆ
 >> 1) & 7;

281 
s
->
bcd
 = 
vÆ
 & 1;

286 
s
 = &
pô
->
ch™√ls
[
addr
];

287 
s
->
wrôe_°©e
) {

289 
RW_STATE_LSB
:

290 
	`pô_lﬂd_cou¡
(
s
, 
vÆ
);

292 
RW_STATE_MSB
:

293 
	`pô_lﬂd_cou¡
(
s
, 
vÆ
 << 8);

295 
RW_STATE_WORD0
:

296 
s
->
wrôe_œtch
 = 
vÆ
;

297 
s
->
wrôe_°©e
 = 
RW_STATE_WORD1
;

299 
RW_STATE_WORD1
:

300 
	`pô_lﬂd_cou¡
(
s
, s->
wrôe_œtch
 | (
vÆ
 << 8));

301 
s
->
wrôe_°©e
 = 
RW_STATE_WORD0
;

305 
	}
}

307 
uöt32_t
 
	$pô_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

309 
PITSèã
 *
pô
 = 
›aque
;

310 
ªt
, 
cou¡
;

311 
PITCh™√lSèã
 *
s
;

313 
addr
 &= 3;

314 
s
 = &
pô
->
ch™√ls
[
addr
];

315 i‡(
s
->
°©us_œtched
) {

316 
s
->
°©us_œtched
 = 0;

317 
ªt
 = 
s
->
°©us
;

318 } i‡(
s
->
cou¡_œtched
) {

319 
s
->
cou¡_œtched
) {

321 
RW_STATE_LSB
:

322 
ªt
 = 
s
->
œtched_cou¡
 & 0xff;

323 
s
->
cou¡_œtched
 = 0;

325 
RW_STATE_MSB
:

326 
ªt
 = 
s
->
œtched_cou¡
 >> 8;

327 
s
->
cou¡_œtched
 = 0;

329 
RW_STATE_WORD0
:

330 
ªt
 = 
s
->
œtched_cou¡
 & 0xff;

331 
s
->
cou¡_œtched
 = 
RW_STATE_MSB
;

335 
s
->
ªad_°©e
) {

337 
RW_STATE_LSB
:

338 
cou¡
 = 
	`pô_gë_cou¡
(
s
);

339 
ªt
 = 
cou¡
 & 0xff;

341 
RW_STATE_MSB
:

342 
cou¡
 = 
	`pô_gë_cou¡
(
s
);

343 
ªt
 = (
cou¡
 >> 8) & 0xff;

345 
RW_STATE_WORD0
:

346 
cou¡
 = 
	`pô_gë_cou¡
(
s
);

347 
ªt
 = 
cou¡
 & 0xff;

348 
s
->
ªad_°©e
 = 
RW_STATE_WORD1
;

350 
RW_STATE_WORD1
:

351 
cou¡
 = 
	`pô_gë_cou¡
(
s
);

352 
ªt
 = (
cou¡
 >> 8) & 0xff;

353 
s
->
ªad_°©e
 = 
RW_STATE_WORD0
;

357  
ªt
;

358 
	}
}

360 
	$pô_úq_timî_upd©e
(
PITCh™√lSèã
 *
s
, 
öt64_t
 
cuºít_time
)

362 
öt64_t
 
expúe_time
;

363 
úq_Àvñ
;

365 i‡(!
s
->
úq_timî
)

367 
expúe_time
 = 
	`pô_gë_√xt_å™sôi⁄_time
(
s
, 
cuºít_time
);

368 
úq_Àvñ
 = 
	`pô_gë_out1
(
s
, 
cuºít_time
);

369 
	`pic_£t_úq
(
s
->
úq
, 
úq_Àvñ
);

370 #ifde‡
DEBUG_PIT


371 
	`¥ötf
("irq_level=%dÇext_delay=%f\n",

372 
úq_Àvñ
,

373 ()(
expúe_time
 - 
cuºít_time
Ë/ 
ticks_≥r_£c
);

375 
s
->
√xt_å™sôi⁄_time
 = 
expúe_time
;

376 i‡(
expúe_time
 != -1)

377 
	`qemu_mod_timî
(
s
->
úq_timî
, 
expúe_time
);

379 
	`qemu_dñ_timî
(
s
->
úq_timî
);

380 
	}
}

382 
	$pô_úq_timî
(*
›aque
)

384 
PITCh™√lSèã
 *
s
 = 
›aque
;

386 
	`pô_úq_timî_upd©e
(
s
, s->
√xt_å™sôi⁄_time
);

387 
	}
}

389 
	$pô_ßve
(
QEMUFûe
 *
f
, *
›aque
)

391 
PITSèã
 *
pô
 = 
›aque
;

392 
PITCh™√lSèã
 *
s
;

393 
i
;

395 
i
 = 0; i < 3; i++) {

396 
s
 = &
pô
->
ch™√ls
[
i
];

397 
	`qemu_put_be32s
(
f
, &
s
->
cou¡
);

398 
	`qemu_put_be16s
(
f
, &
s
->
œtched_cou¡
);

399 
	`qemu_put_8s
(
f
, &
s
->
cou¡_œtched
);

400 
	`qemu_put_8s
(
f
, &
s
->
°©us_œtched
);

401 
	`qemu_put_8s
(
f
, &
s
->
°©us
);

402 
	`qemu_put_8s
(
f
, &
s
->
ªad_°©e
);

403 
	`qemu_put_8s
(
f
, &
s
->
wrôe_°©e
);

404 
	`qemu_put_8s
(
f
, &
s
->
wrôe_œtch
);

405 
	`qemu_put_8s
(
f
, &
s
->
rw_mode
);

406 
	`qemu_put_8s
(
f
, &
s
->
mode
);

407 
	`qemu_put_8s
(
f
, &
s
->
bcd
);

408 
	`qemu_put_8s
(
f
, &
s
->
g©e
);

409 
	`qemu_put_be64s
(
f
, &
s
->
cou¡_lﬂd_time
);

410 i‡(
s
->
úq_timî
) {

411 
	`qemu_put_be64s
(
f
, &
s
->
√xt_å™sôi⁄_time
);

412 
	`qemu_put_timî
(
f
, 
s
->
úq_timî
);

415 
	}
}

417 
	$pô_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

419 
PITSèã
 *
pô
 = 
›aque
;

420 
PITCh™√lSèã
 *
s
;

421 
i
;

423 i‡(
vîsi⁄_id
 != 1)

424  -
EINVAL
;

426 
i
 = 0; i < 3; i++) {

427 
s
 = &
pô
->
ch™√ls
[
i
];

428 
	`qemu_gë_be32s
(
f
, &
s
->
cou¡
);

429 
	`qemu_gë_be16s
(
f
, &
s
->
œtched_cou¡
);

430 
	`qemu_gë_8s
(
f
, &
s
->
cou¡_œtched
);

431 
	`qemu_gë_8s
(
f
, &
s
->
°©us_œtched
);

432 
	`qemu_gë_8s
(
f
, &
s
->
°©us
);

433 
	`qemu_gë_8s
(
f
, &
s
->
ªad_°©e
);

434 
	`qemu_gë_8s
(
f
, &
s
->
wrôe_°©e
);

435 
	`qemu_gë_8s
(
f
, &
s
->
wrôe_œtch
);

436 
	`qemu_gë_8s
(
f
, &
s
->
rw_mode
);

437 
	`qemu_gë_8s
(
f
, &
s
->
mode
);

438 
	`qemu_gë_8s
(
f
, &
s
->
bcd
);

439 
	`qemu_gë_8s
(
f
, &
s
->
g©e
);

440 
	`qemu_gë_be64s
(
f
, &
s
->
cou¡_lﬂd_time
);

441 i‡(
s
->
úq_timî
) {

442 
	`qemu_gë_be64s
(
f
, &
s
->
√xt_å™sôi⁄_time
);

443 
	`qemu_gë_timî
(
f
, 
s
->
úq_timî
);

447 
	}
}

449 
	$pô_ª£t
(*
›aque
)

451 
PITSèã
 *
pô
 = 
›aque
;

452 
PITCh™√lSèã
 *
s
;

453 
i
;

455 
i
 = 0;i < 3; i++) {

456 
s
 = &
pô
->
ch™√ls
[
i
];

457 
s
->
mode
 = 3;

458 
s
->
g©e
 = (
i
 != 2);

459 
	`pô_lﬂd_cou¡
(
s
, 0);

461 
	}
}

463 
PITSèã
 *
	$pô_öô
(
ba£
, 
úq
)

465 
PITSèã
 *
pô
 = &
pô_°©e
;

466 
PITCh™√lSèã
 *
s
;

468 
s
 = &
pô
->
ch™√ls
[0];

470 
s
->
úq_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
pô_úq_timî
, s);

471 
s
->
úq
 = irq;

473 
	`ªgi°î_ßvevm
("i8254", 
ba£
, 1, 
pô_ßve
, 
pô_lﬂd
, 
pô
);

475 
	`qemu_ªgi°î_ª£t
(
pô_ª£t
, 
pô
);

476 
	`ªgi°î_i›‹t_wrôe
(
ba£
, 4, 1, 
pô_i›‹t_wrôe
, 
pô
);

477 
	`ªgi°î_i›‹t_ªad
(
ba£
, 3, 1, 
pô_i›‹t_ªad
, 
pô
);

479 
	`pô_ª£t
(
pô
);

481  
pô
;

482 
	}
}

	@i8259.c

24 
	~"vl.h
"

32 
	sPicSèã
 {

33 
uöt8_t
 
	mœ°_úr
;

34 
uöt8_t
 
	múr
;

35 
uöt8_t
 
	mimr
;

36 
uöt8_t
 
	mi§
;

37 
uöt8_t
 
	m¥i‹ôy_add
;

38 
uöt8_t
 
	múq_ba£
;

39 
uöt8_t
 
	mªad_ªg_£À˘
;

40 
uöt8_t
 
	mpﬁl
;

41 
uöt8_t
 
	m•ecül_mask
;

42 
uöt8_t
 
	möô_°©e
;

43 
uöt8_t
 
	mauto_eoi
;

44 
uöt8_t
 
	mrŸ©e_⁄_auto_eoi
;

45 
uöt8_t
 
	m•ecül_fuŒy_√°ed_mode
;

46 
uöt8_t
 
	möô4
;

47 
uöt8_t
 
	mñ¸
;

48 
uöt8_t
 
	mñ¸_mask
;

49 
PicSèã2
 *
	mpics_°©e
;

50 } 
	tPicSèã
;

52 
	sPicSèã2
 {

55 
PicSèã
 
	mpics
[2];

56 
IRQReque°Func
 *
	múq_ªque°
;

57 *
	múq_ªque°_›aque
;

59 
SëIRQFunc
 *
	mÆt_úq_func
;

60 *
	mÆt_úq_›aque
;

63 #i‡
deföed
(
DEBUG_PIC
Ë|| deföed (
DEBUG_IRQ_COUNT
)

64 
	gúq_Àvñ
[16];

66 #ifde‡
DEBUG_IRQ_COUNT


67 
uöt64_t
 
	gúq_cou¡
[16];

71 
ölöe
 
	$pic_£t_úq1
(
PicSèã
 *
s
, 
úq
, 
Àvñ
)

73 
mask
;

74 
mask
 = 1 << 
úq
;

75 i‡(
s
->
ñ¸
 & 
mask
) {

77 i‡(
Àvñ
) {

78 
s
->
úr
 |
mask
;

79 
s
->
œ°_úr
 |
mask
;

81 
s
->
úr
 &~
mask
;

82 
s
->
œ°_úr
 &~
mask
;

86 i‡(
Àvñ
) {

87 i‡((
s
->
œ°_úr
 & 
mask
) == 0)

88 
s
->
úr
 |
mask
;

89 
s
->
œ°_úr
 |
mask
;

91 
s
->
œ°_úr
 &~
mask
;

94 
	}
}

98 
ölöe
 
	$gë_¥i‹ôy
(
PicSèã
 *
s
, 
mask
)

100 
¥i‹ôy
;

101 i‡(
mask
 == 0)

103 
¥i‹ôy
 = 0;

104 (
mask
 & (1 << ((
¥i‹ôy
 + 
s
->
¥i‹ôy_add
) & 7))) == 0)

105 
¥i‹ôy
++;

106  
¥i‹ôy
;

107 
	}
}

110 
	$pic_gë_úq
(
PicSèã
 *
s
)

112 
mask
, 
cur_¥i‹ôy
, 
¥i‹ôy
;

114 
mask
 = 
s
->
úr
 & ~s->
imr
;

115 
¥i‹ôy
 = 
	`gë_¥i‹ôy
(
s
, 
mask
);

116 i‡(
¥i‹ôy
 == 8)

121 
mask
 = 
s
->
i§
;

122 i‡(
s
->
•ecül_fuŒy_√°ed_mode
 && s =&s->
pics_°©e
->
pics
[0])

123 
mask
 &= ~(1 << 2);

124 
cur_¥i‹ôy
 = 
	`gë_¥i‹ôy
(
s
, 
mask
);

125 i‡(
¥i‹ôy
 < 
cur_¥i‹ôy
) {

127  (
¥i‹ôy
 + 
s
->
¥i‹ôy_add
) & 7;

131 
	}
}

136 
	$pic_upd©e_úq
(
PicSèã2
 *
s
)

138 
úq2
, 
úq
;

141 
úq2
 = 
	`pic_gë_úq
(&
s
->
pics
[1]);

142 i‡(
úq2
 >= 0) {

144 
	`pic_£t_úq1
(&
s
->
pics
[0], 2, 1);

145 
	`pic_£t_úq1
(&
s
->
pics
[0], 2, 0);

148 
úq
 = 
	`pic_gë_úq
(&
s
->
pics
[0]);

149 i‡(
úq
 >= 0) {

150 #i‡
	`deföed
(
DEBUG_PIC
)

152 
i
;

153 
i
 = 0; i < 2; i++) {

154 
	`¥ötf
("pic%d: imr=%x irr=%xÖadd=%d\n",

155 
i
, 
s
->
pics
[i].
imr
, s->pics[i].
úr
,

156 
s
->
pics
[
i
].
¥i‹ôy_add
);

160 
	`¥ötf
("pic: cpu_interrupt\n");

162 
s
->
	`úq_ªque°
(s->
úq_ªque°_›aque
, 1);

166 #i‡
	`deföed
(
TARGET_MIPS
)

168 
s
->
	`úq_ªque°
(s->
úq_ªque°_›aque
, 0);

171 
	}
}

173 #ifde‡
DEBUG_IRQ_LATENCY


174 
öt64_t
 
	gúq_time
[16];

177 
	$pic_£t_úq_√w
(*
›aque
, 
úq
, 
Àvñ
)

179 
PicSèã2
 *
s
 = 
›aque
;

181 #i‡
	`deföed
(
DEBUG_PIC
Ë|| deföed(
DEBUG_IRQ_COUNT
)

182 i‡(
Àvñ
 !
úq_Àvñ
[
úq
]) {

183 #i‡
	`deföed
(
DEBUG_PIC
)

184 
	`¥ötf
("pic_£t_úq: irq=%dÜevñ=%d\n", 
úq
, 
Àvñ
);

186 
úq_Àvñ
[
úq
] = 
Àvñ
;

187 #ifde‡
DEBUG_IRQ_COUNT


188 i‡(
Àvñ
 == 1)

189 
úq_cou¡
[
úq
]++;

193 #ifde‡
DEBUG_IRQ_LATENCY


194 i‡(
Àvñ
) {

195 
úq_time
[
úq
] = 
	`qemu_gë_˛ock
(
vm_˛ock
);

198 
	`pic_£t_úq1
(&
s
->
pics
[
úq
 >> 3], irq & 7, 
Àvñ
);

200 i‡(
s
->
Æt_úq_func
)

201 
s
->
	`Æt_úq_func
(s->
Æt_úq_›aque
, 
úq
, 
Àvñ
);

202 
	`pic_upd©e_úq
(
s
);

203 
	}
}

206 
	$pic_£t_úq
(
úq
, 
Àvñ
)

208 
	`pic_£t_úq_√w
(
iß_pic
, 
úq
, 
Àvñ
);

209 
	}
}

212 
ölöe
 
	$pic_öèck
(
PicSèã
 *
s
, 
úq
)

214 i‡(
s
->
auto_eoi
) {

215 i‡(
s
->
rŸ©e_⁄_auto_eoi
)

216 
s
->
¥i‹ôy_add
 = (
úq
 + 1) & 7;

218 
s
->
i§
 |(1 << 
úq
);

221 i‡(!(
s
->
ñ¸
 & (1 << 
úq
)))

222 
s
->
úr
 &~(1 << 
úq
);

223 
	}
}

225 
	$pic_ªad_úq
(
PicSèã2
 *
s
)

227 
úq
, 
úq2
, 
öäo
;

229 
úq
 = 
	`pic_gë_úq
(&
s
->
pics
[0]);

230 i‡(
úq
 >= 0) {

231 
	`pic_öèck
(&
s
->
pics
[0], 
úq
);

232 i‡(
úq
 == 2) {

233 
úq2
 = 
	`pic_gë_úq
(&
s
->
pics
[1]);

234 i‡(
úq2
 >= 0) {

235 
	`pic_öèck
(&
s
->
pics
[1], 
úq2
);

238 
úq2
 = 7;

240 
öäo
 = 
s
->
pics
[1].
úq_ba£
 + 
úq2
;

241 
úq
 = 
úq2
 + 8;

243 
öäo
 = 
s
->
pics
[0].
úq_ba£
 + 
úq
;

247 
úq
 = 7;

248 
öäo
 = 
s
->
pics
[0].
úq_ba£
 + 
úq
;

250 
	`pic_upd©e_úq
(
s
);

252 #ifde‡
DEBUG_IRQ_LATENCY


253 
	`¥ötf
("IRQ%dÜatency=%0.3fus\n",

254 
úq
,

255 ()(
	`qemu_gë_˛ock
(
vm_˛ock
Ë- 
úq_time
[
úq
]Ë* 1000000.0 / 
ticks_≥r_£c
);

257 #i‡
	`deföed
(
DEBUG_PIC
)

258 
	`¥ötf
("pic_öãºu±: irq=%d\n", 
úq
);

260  
öäo
;

261 
	}
}

263 
	$pic_ª£t
(*
›aque
)

265 
PicSèã
 *
s
 = 
›aque
;

267 
s
->
œ°_úr
 = 0;

268 
s
->
úr
 = 0;

269 
s
->
imr
 = 0;

270 
s
->
i§
 = 0;

271 
s
->
¥i‹ôy_add
 = 0;

272 
s
->
úq_ba£
 = 0;

273 
s
->
ªad_ªg_£À˘
 = 0;

274 
s
->
pﬁl
 = 0;

275 
s
->
•ecül_mask
 = 0;

276 
s
->
öô_°©e
 = 0;

277 
s
->
auto_eoi
 = 0;

278 
s
->
rŸ©e_⁄_auto_eoi
 = 0;

279 
s
->
•ecül_fuŒy_√°ed_mode
 = 0;

280 
s
->
öô4
 = 0;

282 
	}
}

284 
	$pic_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

286 
PicSèã
 *
s
 = 
›aque
;

287 
¥i‹ôy
, 
cmd
, 
úq
;

289 #ifde‡
DEBUG_PIC


290 
	`¥ötf
("pic_wrôe:áddr=0x%02x vÆ=0x%02x\n", 
addr
, 
vÆ
);

292 
addr
 &= 1;

293 i‡(
addr
 == 0) {

294 i‡(
vÆ
 & 0x10) {

296 
	`pic_ª£t
(
s
);

298 
s
->
pics_°©e
->
	`úq_ªque°
(s->pics_°©e->
úq_ªque°_›aque
, 0);

299 
s
->
öô_°©e
 = 1;

300 
s
->
öô4
 = 
vÆ
 & 1;

301 i‡(
vÆ
 & 0x02)

302 
	`hw_îr‹
("single modeÇot supported");

303 i‡(
vÆ
 & 0x08)

304 
	`hw_îr‹
("level sensitive irqÇot supported");

305 } i‡(
vÆ
 & 0x08) {

306 i‡(
vÆ
 & 0x04)

307 
s
->
pﬁl
 = 1;

308 i‡(
vÆ
 & 0x02)

309 
s
->
ªad_ªg_£À˘
 = 
vÆ
 & 1;

310 i‡(
vÆ
 & 0x40)

311 
s
->
•ecül_mask
 = (
vÆ
 >> 5) & 1;

313 
cmd
 = 
vÆ
 >> 5;

314 
cmd
) {

317 
s
->
rŸ©e_⁄_auto_eoi
 = 
cmd
 >> 2;

321 
¥i‹ôy
 = 
	`gë_¥i‹ôy
(
s
, s->
i§
);

322 i‡(
¥i‹ôy
 != 8) {

323 
úq
 = (
¥i‹ôy
 + 
s
->
¥i‹ôy_add
) & 7;

324 
s
->
i§
 &~(1 << 
úq
);

325 i‡(
cmd
 == 5)

326 
s
->
¥i‹ôy_add
 = (
úq
 + 1) & 7;

327 
	`pic_upd©e_úq
(
s
->
pics_°©e
);

331 
úq
 = 
vÆ
 & 7;

332 
s
->
i§
 &~(1 << 
úq
);

333 
	`pic_upd©e_úq
(
s
->
pics_°©e
);

336 
s
->
¥i‹ôy_add
 = (
vÆ
 + 1) & 7;

337 
	`pic_upd©e_úq
(
s
->
pics_°©e
);

340 
úq
 = 
vÆ
 & 7;

341 
s
->
i§
 &~(1 << 
úq
);

342 
s
->
¥i‹ôy_add
 = (
úq
 + 1) & 7;

343 
	`pic_upd©e_úq
(
s
->
pics_°©e
);

351 
s
->
öô_°©e
) {

354 
s
->
imr
 = 
vÆ
;

355 
	`pic_upd©e_úq
(
s
->
pics_°©e
);

358 
s
->
úq_ba£
 = 
vÆ
 & 0xf8;

359 
s
->
öô_°©e
 = 2;

362 i‡(
s
->
öô4
) {

363 
s
->
öô_°©e
 = 3;

365 
s
->
öô_°©e
 = 0;

369 
s
->
•ecül_fuŒy_√°ed_mode
 = (
vÆ
 >> 4) & 1;

370 
s
->
auto_eoi
 = (
vÆ
 >> 1) & 1;

371 
s
->
öô_°©e
 = 0;

375 
	}
}

377 
uöt32_t
 
	$pic_pﬁl_ªad
 (
PicSèã
 *
s
, 
uöt32_t
 
addr1
)

379 
ªt
;

381 
ªt
 = 
	`pic_gë_úq
(
s
);

382 i‡(
ªt
 >= 0) {

383 i‡(
addr1
 >> 7) {

384 
s
->
pics_°©e
->
pics
[0].
i§
 &= ~(1 << 2);

385 
s
->
pics_°©e
->
pics
[0].
úr
 &= ~(1 << 2);

387 
s
->
úr
 &~(1 << 
ªt
);

388 
s
->
i§
 &~(1 << 
ªt
);

389 i‡(
addr1
 >> 7 || 
ªt
 != 2)

390 
	`pic_upd©e_úq
(
s
->
pics_°©e
);

392 
ªt
 = 0x07;

393 
	`pic_upd©e_úq
(
s
->
pics_°©e
);

396  
ªt
;

397 
	}
}

399 
uöt32_t
 
	$pic_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr1
)

401 
PicSèã
 *
s
 = 
›aque
;

402 
addr
;

403 
ªt
;

405 
addr
 = 
addr1
;

406 
addr
 &= 1;

407 i‡(
s
->
pﬁl
) {

408 
ªt
 = 
	`pic_pﬁl_ªad
(
s
, 
addr1
);

409 
s
->
pﬁl
 = 0;

411 i‡(
addr
 == 0) {

412 i‡(
s
->
ªad_ªg_£À˘
)

413 
ªt
 = 
s
->
i§
;

415 
ªt
 = 
s
->
úr
;

417 
ªt
 = 
s
->
imr
;

420 #ifde‡
DEBUG_PIC


421 
	`¥ötf
("pic_ªad:áddr=0x%02x vÆ=0x%02x\n", 
addr1
, 
ªt
);

423  
ªt
;

424 
	}
}

428 
uöt32_t
 
	$pic_öèck_ªad
(
PicSèã2
 *
s
)

430 
ªt
;

432 
ªt
 = 
	`pic_pﬁl_ªad
(&
s
->
pics
[0], 0x00);

433 i‡(
ªt
 == 2)

434 
ªt
 = 
	`pic_pﬁl_ªad
(&
s
->
pics
[1], 0x80) + 8;

436 
s
->
pics
[0].
ªad_ªg_£À˘
 = 1;

438  
ªt
;

439 
	}
}

441 
	$ñ¸_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

443 
PicSèã
 *
s
 = 
›aque
;

444 
s
->
ñ¸
 = 
vÆ
 & s->
ñ¸_mask
;

445 
	}
}

447 
uöt32_t
 
	$ñ¸_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr1
)

449 
PicSèã
 *
s
 = 
›aque
;

450  
s
->
ñ¸
;

451 
	}
}

453 
	$pic_ßve
(
QEMUFûe
 *
f
, *
›aque
)

455 
PicSèã
 *
s
 = 
›aque
;

457 
	`qemu_put_8s
(
f
, &
s
->
œ°_úr
);

458 
	`qemu_put_8s
(
f
, &
s
->
úr
);

459 
	`qemu_put_8s
(
f
, &
s
->
imr
);

460 
	`qemu_put_8s
(
f
, &
s
->
i§
);

461 
	`qemu_put_8s
(
f
, &
s
->
¥i‹ôy_add
);

462 
	`qemu_put_8s
(
f
, &
s
->
úq_ba£
);

463 
	`qemu_put_8s
(
f
, &
s
->
ªad_ªg_£À˘
);

464 
	`qemu_put_8s
(
f
, &
s
->
pﬁl
);

465 
	`qemu_put_8s
(
f
, &
s
->
•ecül_mask
);

466 
	`qemu_put_8s
(
f
, &
s
->
öô_°©e
);

467 
	`qemu_put_8s
(
f
, &
s
->
auto_eoi
);

468 
	`qemu_put_8s
(
f
, &
s
->
rŸ©e_⁄_auto_eoi
);

469 
	`qemu_put_8s
(
f
, &
s
->
•ecül_fuŒy_√°ed_mode
);

470 
	`qemu_put_8s
(
f
, &
s
->
öô4
);

471 
	`qemu_put_8s
(
f
, &
s
->
ñ¸
);

472 
	}
}

474 
	$pic_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

476 
PicSèã
 *
s
 = 
›aque
;

478 i‡(
vîsi⁄_id
 != 1)

479  -
EINVAL
;

481 
	`qemu_gë_8s
(
f
, &
s
->
œ°_úr
);

482 
	`qemu_gë_8s
(
f
, &
s
->
úr
);

483 
	`qemu_gë_8s
(
f
, &
s
->
imr
);

484 
	`qemu_gë_8s
(
f
, &
s
->
i§
);

485 
	`qemu_gë_8s
(
f
, &
s
->
¥i‹ôy_add
);

486 
	`qemu_gë_8s
(
f
, &
s
->
úq_ba£
);

487 
	`qemu_gë_8s
(
f
, &
s
->
ªad_ªg_£À˘
);

488 
	`qemu_gë_8s
(
f
, &
s
->
pﬁl
);

489 
	`qemu_gë_8s
(
f
, &
s
->
•ecül_mask
);

490 
	`qemu_gë_8s
(
f
, &
s
->
öô_°©e
);

491 
	`qemu_gë_8s
(
f
, &
s
->
auto_eoi
);

492 
	`qemu_gë_8s
(
f
, &
s
->
rŸ©e_⁄_auto_eoi
);

493 
	`qemu_gë_8s
(
f
, &
s
->
•ecül_fuŒy_√°ed_mode
);

494 
	`qemu_gë_8s
(
f
, &
s
->
öô4
);

495 
	`qemu_gë_8s
(
f
, &
s
->
ñ¸
);

497 
	}
}

500 
	$pic_öô1
(
io_addr
, 
ñ¸_addr
, 
PicSèã
 *
s
)

502 
	`ªgi°î_i›‹t_wrôe
(
io_addr
, 2, 1, 
pic_i›‹t_wrôe
, 
s
);

503 
	`ªgi°î_i›‹t_ªad
(
io_addr
, 2, 1, 
pic_i›‹t_ªad
, 
s
);

504 i‡(
ñ¸_addr
 >= 0) {

505 
	`ªgi°î_i›‹t_wrôe
(
ñ¸_addr
, 1, 1, 
ñ¸_i›‹t_wrôe
, 
s
);

506 
	`ªgi°î_i›‹t_ªad
(
ñ¸_addr
, 1, 1, 
ñ¸_i›‹t_ªad
, 
s
);

508 
	`ªgi°î_ßvevm
("i8259", 
io_addr
, 1, 
pic_ßve
, 
pic_lﬂd
, 
s
);

509 
	`qemu_ªgi°î_ª£t
(
pic_ª£t
, 
s
);

510 
	}
}

512 
	$pic_öfo
()

514 
i
;

515 
PicSèã
 *
s
;

517 i‡(!
iß_pic
)

520 
i
=0;i<2;i++) {

521 
s
 = &
iß_pic
->
pics
[
i
];

522 
	`ãrm_¥ötf
("pic%d: irr=%02x imr=%02x isr=%02x hprio=%d irq_base=%02xÑr_sel=%dÉlcr=%02x fnm=%d\n",

523 
i
, 
s
->
úr
, s->
imr
, s->
i§
, s->
¥i‹ôy_add
,

524 
s
->
úq_ba£
, s->
ªad_ªg_£À˘
, s->
ñ¸
,

525 
s
->
•ecül_fuŒy_√°ed_mode
);

527 
	}
}

529 
	$úq_öfo
()

531 #i‚de‡
DEBUG_IRQ_COUNT


532 
	`ãrm_¥ötf
("irq statistic codeÇot compiled.\n");

534 
i
;

535 
öt64_t
 
cou¡
;

537 
	`ãrm_¥ötf
("IRQ statistics:\n");

538 
i
 = 0; i < 16; i++) {

539 
cou¡
 = 
úq_cou¡
[
i
];

540 i‡(
cou¡
 > 0)

541 
	`ãrm_¥ötf
("%2d: %" 
PRId64
 "\n", 
i
, 
cou¡
);

544 
	}
}

546 
PicSèã2
 *
	$pic_öô
(
IRQReque°Func
 *
úq_ªque°
, *
úq_ªque°_›aque
)

548 
PicSèã2
 *
s
;

549 
s
 = 
	`qemu_mÆlocz
((
PicSèã2
));

550 i‡(!
s
)

551  
NULL
;

552 
	`pic_öô1
(0x20, 0x4d0, &
s
->
pics
[0]);

553 
	`pic_öô1
(0xa0, 0x4d1, &
s
->
pics
[1]);

554 
s
->
pics
[0].
ñ¸_mask
 = 0xf8;

555 
s
->
pics
[1].
ñ¸_mask
 = 0xde;

556 
s
->
úq_ªque°
 = irq_request;

557 
s
->
úq_ªque°_›aque
 = irq_request_opaque;

558 
s
->
pics
[0].
pics_°©e
 = s;

559 
s
->
pics
[1].
pics_°©e
 = s;

560  
s
;

561 
	}
}

563 
	$pic_£t_Æt_úq_func
(
PicSèã2
 *
s
, 
SëIRQFunc
 *
Æt_úq_func
,

564 *
Æt_úq_›aque
)

566 
s
->
Æt_úq_func
 =ált_irq_func;

567 
s
->
Æt_úq_›aque
 =ált_irq_opaque;

568 
	}
}

	@ide.c

24 
	~"vl.h
"

30 
	#USE_DMA_CDROM


	)

33 
	#ERR_STAT
 0x01

	)

34 
	#INDEX_STAT
 0x02

	)

35 
	#ECC_STAT
 0x04

	)

36 
	#DRQ_STAT
 0x08

	)

37 
	#SEEK_STAT
 0x10

	)

38 
	#SRV_STAT
 0x10

	)

39 
	#WRERR_STAT
 0x20

	)

40 
	#READY_STAT
 0x40

	)

41 
	#BUSY_STAT
 0x80

	)

44 
	#MARK_ERR
 0x01

	)

45 
	#TRK0_ERR
 0x02

	)

46 
	#ABRT_ERR
 0x04

	)

47 
	#MCR_ERR
 0x08

	)

48 
	#ID_ERR
 0x10

	)

49 
	#MC_ERR
 0x20

	)

50 
	#ECC_ERR
 0x40

	)

51 
	#BBD_ERR
 0x80

	)

52 
	#ICRC_ERR
 0x80

	)

55 
	#CD
 0x01

	)

56 
	#IO
 0x02

	)

57 
	#REL
 0x04

	)

58 
	#TAG_MASK
 0xf8

	)

60 
	#IDE_CMD_RESET
 0x04

	)

61 
	#IDE_CMD_DISABLE_IRQ
 0x02

	)

64 
	#WIN_NOP
 0x00

	)

68 
	#CFA_REQ_EXT_ERROR_CODE
 0x03

	)

72 
	#WIN_SRST
 0x08

	)

73 
	#WIN_DEVICE_RESET
 0x08

	)

77 
	#WIN_RECAL
 0x10

	)

78 
	#WIN_RESTORE
 
WIN_RECAL


	)

82 
	#WIN_READ
 0x20

	)

83 
	#WIN_READ_ONCE
 0x21

	)

84 
	#WIN_READ_LONG
 0x22

	)

85 
	#WIN_READ_LONG_ONCE
 0x23

	)

86 
	#WIN_READ_EXT
 0x24

	)

87 
	#WIN_READDMA_EXT
 0x25

	)

88 
	#WIN_READDMA_QUEUED_EXT
 0x26

	)

89 
	#WIN_READ_NATIVE_MAX_EXT
 0x27

	)

93 
	#WIN_MULTREAD_EXT
 0x29

	)

97 
	#WIN_WRITE
 0x30

	)

98 
	#WIN_WRITE_ONCE
 0x31

	)

99 
	#WIN_WRITE_LONG
 0x32

	)

100 
	#WIN_WRITE_LONG_ONCE
 0x33

	)

101 
	#WIN_WRITE_EXT
 0x34

	)

102 
	#WIN_WRITEDMA_EXT
 0x35

	)

103 
	#WIN_WRITEDMA_QUEUED_EXT
 0x36

	)

104 
	#WIN_SET_MAX_EXT
 0x37

	)

105 
	#CFA_WRITE_SECT_WO_ERASE
 0x38

	)

106 
	#WIN_MULTWRITE_EXT
 0x39

	)

110 
	#WIN_WRITE_VERIFY
 0x3C

	)

114 
	#WIN_VERIFY
 0x40

	)

115 
	#WIN_VERIFY_ONCE
 0x41

	)

116 
	#WIN_VERIFY_EXT
 0x42

	)

120 
	#WIN_FORMAT
 0x50

	)

124 
	#WIN_INIT
 0x60

	)

128 
	#WIN_SEEK
 0x70

	)

129 
	#CFA_TRANSLATE_SECTOR
 0x87

	)

130 
	#WIN_DIAGNOSE
 0x90

	)

131 
	#WIN_SPECIFY
 0x91

	)

132 
	#WIN_DOWNLOAD_MICROCODE
 0x92

	)

133 
	#WIN_STANDBYNOW2
 0x94

	)

134 
	#WIN_STANDBY2
 0x96

	)

135 
	#WIN_SETIDLE2
 0x97

	)

136 
	#WIN_CHECKPOWERMODE2
 0x98

	)

137 
	#WIN_SLEEPNOW2
 0x99

	)

141 
	#WIN_PACKETCMD
 0xA0

	)

142 
	#WIN_PIDENTIFY
 0xA1

	)

143 
	#WIN_QUEUED_SERVICE
 0xA2

	)

144 
	#WIN_SMART
 0xB0

	)

145 
	#CFA_ERASE_SECTORS
 0xC0

	)

146 
	#WIN_MULTREAD
 0xC4

	)

147 
	#WIN_MULTWRITE
 0xC5

	)

148 
	#WIN_SETMULT
 0xC6

	)

149 
	#WIN_READDMA_QUEUED
 0xC7

	)

150 
	#WIN_READDMA
 0xC8

	)

151 
	#WIN_READDMA_ONCE
 0xC9

	)

152 
	#WIN_WRITEDMA
 0xCA

	)

153 
	#WIN_WRITEDMA_ONCE
 0xCB

	)

154 
	#WIN_WRITEDMA_QUEUED
 0xCC

	)

155 
	#CFA_WRITE_MULTI_WO_ERASE
 0xCD

	)

156 
	#WIN_GETMEDIASTATUS
 0xDA

	)

157 
	#WIN_ACKMEDIACHANGE
 0xDB

	)

158 
	#WIN_POSTBOOT
 0xDC

	)

159 
	#WIN_PREBOOT
 0xDD

	)

160 
	#WIN_DOORLOCK
 0xDE

	)

161 
	#WIN_DOORUNLOCK
 0xDF

	)

162 
	#WIN_STANDBYNOW1
 0xE0

	)

163 
	#WIN_IDLEIMMEDIATE
 0xE1

	)

164 
	#WIN_STANDBY
 0xE2

	)

165 
	#WIN_SETIDLE1
 0xE3

	)

166 
	#WIN_READ_BUFFER
 0xE4

	)

167 
	#WIN_CHECKPOWERMODE1
 0xE5

	)

168 
	#WIN_SLEEPNOW1
 0xE6

	)

169 
	#WIN_FLUSH_CACHE
 0xE7

	)

170 
	#WIN_WRITE_BUFFER
 0xE8

	)

171 
	#WIN_WRITE_SAME
 0xE9

	)

173 
	#WIN_FLUSH_CACHE_EXT
 0xEA

	)

174 
	#WIN_IDENTIFY
 0xEC

	)

175 
	#WIN_MEDIAEJECT
 0xED

	)

176 
	#WIN_IDENTIFY_DMA
 0xEE

	)

177 
	#WIN_SETFEATURES
 0xEF

	)

178 
	#EXABYTE_ENABLE_NEST
 0xF0

	)

179 
	#WIN_SECURITY_SET_PASS
 0xF1

	)

180 
	#WIN_SECURITY_UNLOCK
 0xF2

	)

181 
	#WIN_SECURITY_ERASE_PREPARE
 0xF3

	)

182 
	#WIN_SECURITY_ERASE_UNIT
 0xF4

	)

183 
	#WIN_SECURITY_FREEZE_LOCK
 0xF5

	)

184 
	#WIN_SECURITY_DISABLE
 0xF6

	)

185 
	#WIN_READ_NATIVE_MAX
 0xF8

	)

186 
	#WIN_SET_MAX
 0xF9

	)

187 
	#DISABLE_SEAGATE
 0xFB

	)

190 
	#MAX_MULT_SECTORS
 16

	)

194 
	#ATAPI_PACKET_SIZE
 12

	)

198 
	#GPCMD_BLANK
 0xa1

	)

199 
	#GPCMD_CLOSE_TRACK
 0x5b

	)

200 
	#GPCMD_FLUSH_CACHE
 0x35

	)

201 
	#GPCMD_FORMAT_UNIT
 0x04

	)

202 
	#GPCMD_GET_CONFIGURATION
 0x46

	)

203 
	#GPCMD_GET_EVENT_STATUS_NOTIFICATION
 0x4a

	)

204 
	#GPCMD_GET_PERFORMANCE
 0xac

	)

205 
	#GPCMD_INQUIRY
 0x12

	)

206 
	#GPCMD_LOAD_UNLOAD
 0xa6

	)

207 
	#GPCMD_MECHANISM_STATUS
 0xbd

	)

208 
	#GPCMD_MODE_SELECT_10
 0x55

	)

209 
	#GPCMD_MODE_SENSE_10
 0x5a

	)

210 
	#GPCMD_PAUSE_RESUME
 0x4b

	)

211 
	#GPCMD_PLAY_AUDIO_10
 0x45

	)

212 
	#GPCMD_PLAY_AUDIO_MSF
 0x47

	)

213 
	#GPCMD_PLAY_AUDIO_TI
 0x48

	)

214 
	#GPCMD_PLAY_CD
 0xbc

	)

215 
	#GPCMD_PREVENT_ALLOW_MEDIUM_REMOVAL
 0x1e

	)

216 
	#GPCMD_READ_10
 0x28

	)

217 
	#GPCMD_READ_12
 0xa8

	)

218 
	#GPCMD_READ_CDVD_CAPACITY
 0x25

	)

219 
	#GPCMD_READ_CD
 0xbe

	)

220 
	#GPCMD_READ_CD_MSF
 0xb9

	)

221 
	#GPCMD_READ_DISC_INFO
 0x51

	)

222 
	#GPCMD_READ_DVD_STRUCTURE
 0xad

	)

223 
	#GPCMD_READ_FORMAT_CAPACITIES
 0x23

	)

224 
	#GPCMD_READ_HEADER
 0x44

	)

225 
	#GPCMD_READ_TRACK_RZONE_INFO
 0x52

	)

226 
	#GPCMD_READ_SUBCHANNEL
 0x42

	)

227 
	#GPCMD_READ_TOC_PMA_ATIP
 0x43

	)

228 
	#GPCMD_REPAIR_RZONE_TRACK
 0x58

	)

229 
	#GPCMD_REPORT_KEY
 0xa4

	)

230 
	#GPCMD_REQUEST_SENSE
 0x03

	)

231 
	#GPCMD_RESERVE_RZONE_TRACK
 0x53

	)

232 
	#GPCMD_SCAN
 0xba

	)

233 
	#GPCMD_SEEK
 0x2b

	)

234 
	#GPCMD_SEND_DVD_STRUCTURE
 0xad

	)

235 
	#GPCMD_SEND_EVENT
 0xa2

	)

236 
	#GPCMD_SEND_KEY
 0xa3

	)

237 
	#GPCMD_SEND_OPC
 0x54

	)

238 
	#GPCMD_SET_READ_AHEAD
 0xa7

	)

239 
	#GPCMD_SET_STREAMING
 0xb6

	)

240 
	#GPCMD_START_STOP_UNIT
 0x1b

	)

241 
	#GPCMD_STOP_PLAY_SCAN
 0x4e

	)

242 
	#GPCMD_TEST_UNIT_READY
 0x00

	)

243 
	#GPCMD_VERIFY_10
 0x2f

	)

244 
	#GPCMD_WRITE_10
 0x2a

	)

245 
	#GPCMD_WRITE_AND_VERIFY_10
 0x2e

	)

250 
	#GPCMD_SET_SPEED
 0xbb

	)

253 
	#GPCMD_PLAYAUDIO_TI
 0x48

	)

258 
	#GPCMD_GET_MEDIA_STATUS
 0xda

	)

261 
	#GPMODE_R_W_ERROR_PAGE
 0x01

	)

262 
	#GPMODE_WRITE_PARMS_PAGE
 0x05

	)

263 
	#GPMODE_AUDIO_CTL_PAGE
 0x0e

	)

264 
	#GPMODE_POWER_PAGE
 0x1a

	)

265 
	#GPMODE_FAULT_FAIL_PAGE
 0x1c

	)

266 
	#GPMODE_TO_PROTECT_PAGE
 0x1d

	)

267 
	#GPMODE_CAPABILITIES_PAGE
 0x2a

	)

268 
	#GPMODE_ALL_PAGES
 0x3f

	)

271 
	#GPMODE_CDROM_PAGE
 0x0d

	)

273 
	#ATAPI_INT_REASON_CD
 0x01

	)

274 
	#ATAPI_INT_REASON_IO
 0x02

	)

275 
	#ATAPI_INT_REASON_REL
 0x04

	)

276 
	#ATAPI_INT_REASON_TAG
 0xf8

	)

279 
	#ASC_ILLEGAL_OPCODE
 0x20

	)

280 
	#ASC_LOGICAL_BLOCK_OOR
 0x21

	)

281 
	#ASC_INV_FIELD_IN_CMD_PACKET
 0x24

	)

282 
	#ASC_MEDIUM_NOT_PRESENT
 0x3a

	)

283 
	#ASC_SAVING_PARAMETERS_NOT_SUPPORTED
 0x39

	)

285 
	#SENSE_NONE
 0

	)

286 
	#SENSE_NOT_READY
 2

	)

287 
	#SENSE_ILLEGAL_REQUEST
 5

	)

288 
	#SENSE_UNIT_ATTENTION
 6

	)

290 
	gIDESèã
;

292 
	tEndTøns„rFunc
(
	tIDESèã
 *);

295 
	sIDESèã
 {

297 
	mis_cdrom
;

298 
	mcylödîs
, 
	mhóds
, 
	m£˘‹s
;

299 
öt64_t
 
	mnb_£˘‹s
;

300 
	mmu…_£˘‹s
;

301 
	midítify_£t
;

302 
uöt16_t
 
	midítify_d©a
[256];

303 
SëIRQFunc
 *
	m£t_úq
;

304 *
	múq_›aque
;

305 
	múq
;

306 
PCIDevi˚
 *
	mpci_dev
;

307 
BMDMASèã
 *
	mbmdma
;

308 
	mdrive_£rül
;

309 
	mwrôe_ˇche
;

311 
uöt8_t
 
	m„©uª
;

312 
uöt8_t
 
	mîr‹
;

313 
uöt32_t
 
	mn£˘‹
;

314 
uöt8_t
 
	m£˘‹
;

315 
uöt8_t
 
	mlcyl
;

316 
uöt8_t
 
	mhcyl
;

318 
uöt8_t
 
	mhob_„©uª
;

319 
uöt8_t
 
	mhob_n£˘‹
;

320 
uöt8_t
 
	mhob_£˘‹
;

321 
uöt8_t
 
	mhob_lcyl
;

322 
uöt8_t
 
	mhob_hcyl
;

324 
uöt8_t
 
	m£À˘
;

325 
uöt8_t
 
	m°©us
;

328 
uöt8_t
 
	mcmd
;

330 
uöt8_t
 
	mlba48
;

332 
IDESèã
 *
	mcur_drive
;

333 
BlockDrivîSèã
 *
	mbs
;

335 
uöt8_t
 
	m£n£_key
;

336 
uöt8_t
 
	masc
;

337 
	m∑ckë_å™s„r_size
;

338 
	mñemíèry_å™s„r_size
;

339 
	mio_buf„r_ödex
;

340 
	mlba
;

341 
	mcd_£˘‹_size
;

342 
	m©≠i_dma
;

344 
	mio_buf„r_size
;

346 
	mªq_nb_£˘‹s
;

347 
EndTøns„rFunc
 *
	míd_å™s„r_func
;

348 
uöt8_t
 *
	md©a_±r
;

349 
uöt8_t
 *
	md©a_íd
;

350 
uöt8_t
 
	mio_buf„r
[
MAX_MULT_SECTORS
*512 + 4];

351 
QEMUTimî
 *
	m£˘‹_wrôe_timî
;

352 
uöt32_t
 
	múq_cou¡
;

353 } 
	tIDESèã
;

355 
	#BM_STATUS_DMAING
 0x01

	)

356 
	#BM_STATUS_ERROR
 0x02

	)

357 
	#BM_STATUS_INT
 0x04

	)

359 
	#BM_CMD_START
 0x01

	)

360 
	#BM_CMD_READ
 0x08

	)

362 
	#IDE_TYPE_PIIX3
 0

	)

363 
	#IDE_TYPE_CMD646
 1

	)

366 
	#MRDMODE
 0x71

	)

367 
	#MRDMODE_INTR_CH0
 0x04

	)

368 
	#MRDMODE_INTR_CH1
 0x08

	)

369 
	#MRDMODE_BLK_CH0
 0x10

	)

370 
	#MRDMODE_BLK_CH1
 0x20

	)

371 
	#UDIDETCR0
 0x73

	)

372 
	#UDIDETCR1
 0x7B

	)

374 
	sBMDMASèã
 {

375 
uöt8_t
 
	mcmd
;

376 
uöt8_t
 
	m°©us
;

377 
uöt32_t
 
	maddr
;

379 
PCIIDESèã
 *
	mpci_dev
;

381 
uöt32_t
 
	mcur_addr
;

382 
uöt32_t
 
	mcur_¥d_œ°
;

383 
uöt32_t
 
	mcur_¥d_addr
;

384 
uöt32_t
 
	mcur_¥d_Àn
;

385 
IDESèã
 *
	mide_if
;

386 
BlockDrivîCom∂ëi⁄Func
 *
	mdma_cb
;

387 
BlockDrivîAIOCB
 *
	maiocb
;

388 } 
	tBMDMASèã
;

390 
	sPCIIDESèã
 {

391 
PCIDevi˚
 
	mdev
;

392 
IDESèã
 
	mide_if
[4];

393 
BMDMASèã
 
	mbmdma
[2];

394 
	mty≥
;

395 } 
	tPCIIDESèã
;

397 #i‡
deföed
(
__ü64__
)

398 
	~<xí/hvm/i‹eq.h
>

400 
buf„ªd_pi›age
 *
	gbuf„ªd_pio_∑ge
;

402 
ölöe
 
pio_buf„r
 *

403 
	$piobuf_by_addr
(
uöt32_t
 
addr
)

405 i‡(
addr
 == 0x1F0)

406  &
buf„ªd_pio_∑ge
->
pio
[
PIO_BUFFER_IDE_PRIMARY
];

407 i‡(
addr
 == 0x170)

408  &
buf„ªd_pio_∑ge
->
pio
[
PIO_BUFFER_IDE_SECONDARY
];

409  
NULL
;

410 
	}
}

413 
	$buf„ªd_pio_öô
()

415 
pio_buf„r
 *
p1
, *
p2
;

416 
uöt32_t
 
off1
, 
off2
;

418 i‡(!
buf„ªd_pio_∑ge
)

421 
p1
 = &
buf„ªd_pio_∑ge
->
pio
[
PIO_BUFFER_IDE_PRIMARY
];

422 
p2
 = &
buf„ªd_pio_∑ge
->
pio
[
PIO_BUFFER_IDE_SECONDARY
];

423 
off1
 = 
	`off£tof
(
buf„ªd_pi›age
, 
buf„r
);

424 
off2
 = (
off1
 + 
TARGET_PAGE_SIZE
)/2;

426 
p1
->
buf_size
 = 
off2
 - 
off1
;

427 
p1
->
∑ge_off£t
 = 
off1
;

429 
p2
->
buf_size
 = 
TARGET_PAGE_SIZE
 - 
off2
;

430 
p2
->
∑ge_off£t
 = 
off2
;

431 
	}
}

433 
ölöe
 

434 
	$__buf„ªd_pio_Êush
(
pio_buf„r
 *
piobuf
, 
IDESèã
 *
s
, 
uöt32_t
 
poöãr
)

436 
uöt8_t
 *
buf
 = (uöt8_à*)
buf„ªd_pio_∑ge
 + 
piobuf
->
∑ge_off£t
;

437 
	`mem˝y
(
s
->
d©a_±r
, 
buf
, 
poöãr
);

438 
s
->
d©a_±r
 +
poöãr
;

439 
	}
}

441 
ölöe
 

442 
	$buf„ªd_pio_Êush
(
pio_buf„r
 *
piobuf
)

444 
IDESèã
 *
s
 = 
piobuf
->
›aque
;

445 
uöt32_t
 
poöãr
 = 
piobuf
->pointer;

447 i‡(
s
 !
NULL
 && 
poöãr
 > 0)

448 
	`__buf„ªd_pio_Êush
(
piobuf
, 
s
, 
poöãr
);

449 
	}
}

451 
ölöe
 

452 
	$buf„ªd_pio_ª£t
(
IDESèã
 *
s
)

454 
pio_buf„r
 *
piobuf
;

456 i‡(()
s
->
drive_£rül
 - 1 < 2)

457 
piobuf
 = &
buf„ªd_pio_∑ge
->
pio
[
PIO_BUFFER_IDE_PRIMARY
];

458 i‡(()
s
->
drive_£rül
 - 3 < 2)

459 
piobuf
 = &
buf„ªd_pio_∑ge
->
pio
[
PIO_BUFFER_IDE_SECONDARY
];

462 
	`buf„ªd_pio_Êush
(
piobuf
);

463 
piobuf
->
poöãr
 = 0;

464 
piobuf
->
d©a_íd
 = 0;

465 
piobuf
->
›aque
 = 
NULL
;

466 
	}
}

468 
ölöe
 

469 
	$buf„ªd_pio_wrôe
(
IDESèã
 *
s
, 
uöt32_t
 
addr
, 
size
)

471 
pio_buf„r
 *
piobuf
 = 
	`piobuf_by_addr
(
addr
);

472 
d©a_íd
;

474 i‡(!
piobuf
)

476 
	`buf„ªd_pio_Êush
(
piobuf
);

477 
d©a_íd
 = 
s
->d©a_íd - s->
d©a_±r
 - 
size
;

478 i‡(
d©a_íd
 <= 0)

479 
d©a_íd
 = 0;

480 i‡(
d©a_íd
 > 
piobuf
->
buf_size
)

481 
d©a_íd
 = 
piobuf
->
buf_size
;

482 
piobuf
->
poöãr
 = 0;

483 
piobuf
->
d©a_íd
 = data_end;

484 
piobuf
->
›aque
 = 
s
;

485 
	}
}

487 
ölöe
 

488 
	$buf„ªd_pio_ªad
(
IDESèã
 *
s
, 
uöt32_t
 
addr
, 
size
)

490 
pio_buf„r
 *
piobuf
 = 
	`piobuf_by_addr
(
addr
);

491 
d©a_íd
;

493 i‡(!
piobuf
)

495 
s
->
d©a_±r
 +
piobuf
->
poöãr
;

496 
d©a_íd
 = 
s
->d©a_íd - s->
d©a_±r
 - 
size
;

497 i‡(
d©a_íd
 <= 0) {

498 
d©a_íd
 = 0;

500 
uöt8_t
 *
buf
 = (uöt8_à*)
buf„ªd_pio_∑ge
 + 
piobuf
->
∑ge_off£t
;

501 i‡(
d©a_íd
 > 
piobuf
->
buf_size
)

502 
d©a_íd
 = 
piobuf
->
buf_size
;

503 
	`mem˝y
(
buf
, 
s
->
d©a_±r
 + 
size
, 
d©a_íd
);

505 
piobuf
->
poöãr
 = 0;

506 
piobuf
->
d©a_íd
 = data_end;

507 
piobuf
->
›aque
 = 
NULL
;

508 
	}
}

517 
	$__h™dÀ_buf„ªd_pio
(
pio_buf„r
 *
piobuf
)

519 
IDESèã
 *
s
 = 
piobuf
->
›aque
;

520 
uöt32_t
 
poöãr
 = 
piobuf
->pointer;

523 i‡(
poöãr
 == 0)

526 i‡(
s
 !
NULL
) {

528 
	`__buf„ªd_pio_Êush
(
piobuf
, 
s
, 
poöãr
);

533 i‡(
poöãr
 > 
s
->
d©a_±r
 - s->
io_buf„r
)

534 
poöãr
 = 
s
->
d©a_±r
 - s->
io_buf„r
;

535 
s
->
d©a_±r
 -
poöãr
;

538 
piobuf
->
poöãr
 = 0;

539 
piobuf
->
d©a_íd
 = 0;

540 
piobuf
->
›aque
 = 
NULL
;

541 
	}
}

544 
	$h™dÀ_buf„ªd_pio
()

546 
pio_buf„r
 *
p1
, *
p2
;

548 i‡(!
buf„ªd_pio_∑ge
)

551 
p1
 = &
buf„ªd_pio_∑ge
->
pio
[
PIO_BUFFER_IDE_PRIMARY
];

552 
p2
 = &
buf„ªd_pio_∑ge
->
pio
[
PIO_BUFFER_IDE_SECONDARY
];

554 
	`__h™dÀ_buf„ªd_pio
(
p1
);

555 
	`__h™dÀ_buf„ªd_pio
(
p2
);

556 
	}
}

559 
	#buf„ªd_pio_öô
(Ëdÿ{} 0)

	)

560 
	#buf„ªd_pio_ª£t
(
I
Ëdÿ{} 0)

	)

561 
	#buf„ªd_pio_wrôe
(
I
,
A
,
S
Ëdÿ{} 0)

	)

562 
	#buf„ªd_pio_ªad
(
I
,
A
,
S
Ëdÿ{} 0)

	)

565 
ide_dma_°¨t
(
IDESèã
 *
s
, 
BlockDrivîCom∂ëi⁄Func
 *
dma_cb
);

566 
ide_©≠i_cmd_ªad_dma_cb
(*
›aque
, 
ªt
);

568 
	$∑d°r
(*
°r
, c⁄° *
§c
, 
Àn
)

570 
i
, 
v
;

571 
i
 = 0; i < 
Àn
; i++) {

572 i‡(*
§c
)

573 
v
 = *
§c
++;

575 
v
 = ' ';

576 *(*)(()
°r
 ^ 1Ë
v
;

577 
°r
++;

579 
	}
}

581 
	$∑d°r8
(
uöt8_t
 *
buf
, 
buf_size
, c⁄° *
§c
)

583 
i
;

584 
i
 = 0; i < 
buf_size
; i++) {

585 i‡(*
§c
)

586 
buf
[
i
] = *
§c
++;

588 
buf
[
i
] = ' ';

590 
	}
}

592 
	$put_À16
(
uöt16_t
 *
p
, 
v
)

594 *
p
 = 
	`˝u_to_À16
(
v
);

595 
	}
}

597 
	$ide_idítify
(
IDESèã
 *
s
)

599 
uöt16_t
 *
p
;

600 
ﬁdsize
;

601 
buf
[20];

603 i‡(
s
->
idítify_£t
) {

604 
	`mem˝y
(
s
->
io_buf„r
, s->
idítify_d©a
, (s->identify_data));

608 
	`mem£t
(
s
->
io_buf„r
, 0, 512);

609 
p
 = (
uöt16_t
 *)
s
->
io_buf„r
;

610 
	`put_À16
(
p
 + 0, 0x0040);

611 
	`put_À16
(
p
 + 1, 
s
->
cylödîs
);

612 
	`put_À16
(
p
 + 3, 
s
->
hóds
);

613 
	`put_À16
(
p
 + 4, 512 * 
s
->
£˘‹s
);

614 
	`put_À16
(
p
 + 5, 512);

615 
	`put_À16
(
p
 + 6, 
s
->
£˘‹s
);

616 
	`¢¥ötf
(
buf
, (buf), "QM%05d", 
s
->
drive_£rül
);

617 
	`∑d°r
((
uöt8_t
 *)(
p
 + 10), 
buf
, 20);

618 
	`put_À16
(
p
 + 20, 3);

619 
	`put_À16
(
p
 + 21, 512);

620 
	`put_À16
(
p
 + 22, 4);

621 
	`∑d°r
((
uöt8_t
 *)(
p
 + 23), 
QEMU_VERSION
, 8);

622 
	`∑d°r
((
uöt8_t
 *)(
p
 + 27), "QEMU HARDDISK", 40);

623 #i‡
MAX_MULT_SECTORS
 > 1

624 
	`put_À16
(
p
 + 47, 0x8000 | 
MAX_MULT_SECTORS
);

626 
	`put_À16
(
p
 + 48, 1);

627 
	`put_À16
(
p
 + 49, (1 << 11) | (1 << 9) | (1 << 8));

628 
	`put_À16
(
p
 + 51, 0x200);

629 
	`put_À16
(
p
 + 52, 0x200);

630 
	`put_À16
(
p
 + 53, 1 | (1 << 1) | (1 << 2));

631 
	`put_À16
(
p
 + 54, 
s
->
cylödîs
);

632 
	`put_À16
(
p
 + 55, 
s
->
hóds
);

633 
	`put_À16
(
p
 + 56, 
s
->
£˘‹s
);

634 
ﬁdsize
 = 
s
->
cylödîs
 * s->
hóds
 * s->
£˘‹s
;

635 
	`put_À16
(
p
 + 57, 
ﬁdsize
);

636 
	`put_À16
(
p
 + 58, 
ﬁdsize
 >> 16);

637 i‡(
s
->
mu…_£˘‹s
)

638 
	`put_À16
(
p
 + 59, 0x100 | 
s
->
mu…_£˘‹s
);

639 
	`put_À16
(
p
 + 60, 
s
->
nb_£˘‹s
);

640 
	`put_À16
(
p
 + 61, 
s
->
nb_£˘‹s
 >> 16);

641 
	`put_À16
(
p
 + 63, 0x07);

642 
	`put_À16
(
p
 + 65, 120);

643 
	`put_À16
(
p
 + 66, 120);

644 
	`put_À16
(
p
 + 67, 120);

645 
	`put_À16
(
p
 + 68, 120);

646 
	`put_À16
(
p
 + 80, 0xf0);

647 
	`put_À16
(
p
 + 81, 0x16);

649 
	`put_À16
(
p
 + 82, (1 << 14) | (1 << 5));

651 
	`put_À16
(
p
 + 83, (1 << 14) | (1 << 13) | (1 <<12) | (1 << 10));

652 
	`put_À16
(
p
 + 84, (1 << 14));

654 
	`put_À16
(
p
 + 85, (1 << 14Ë| (
s
->
wrôe_ˇche
 << 5));

656 
	`put_À16
(
p
 + 86, (1 << 14) | (1 << 13) | (1 <<12) | (1 << 10));

657 
	`put_À16
(
p
 + 87, (1 << 14));

658 
	`put_À16
(
p
 + 88, 0x3f | (1 << 13));

659 
	`put_À16
(
p
 + 93, 1 | (1 << 14) | 0x2000);

660 
	`put_À16
(
p
 + 100, 
s
->
nb_£˘‹s
);

661 
	`put_À16
(
p
 + 101, 
s
->
nb_£˘‹s
 >> 16);

662 
	`put_À16
(
p
 + 102, 
s
->
nb_£˘‹s
 >> 32);

663 
	`put_À16
(
p
 + 103, 
s
->
nb_£˘‹s
 >> 48);

665 
	`mem˝y
(
s
->
idítify_d©a
, 
p
, (s->identify_data));

666 
s
->
idítify_£t
 = 1;

667 
	}
}

669 
	$ide_©≠i_idítify
(
IDESèã
 *
s
)

671 
uöt16_t
 *
p
;

672 
buf
[20];

674 i‡(
s
->
idítify_£t
) {

675 
	`mem˝y
(
s
->
io_buf„r
, s->
idítify_d©a
, (s->identify_data));

679 
	`mem£t
(
s
->
io_buf„r
, 0, 512);

680 
p
 = (
uöt16_t
 *)
s
->
io_buf„r
;

682 
	`put_À16
(
p
 + 0, (2 << 14) | (5 << 8) | (1 << 7) | (2 << 5) | (0 << 0));

683 
	`¢¥ötf
(
buf
, (buf), "QM%05d", 
s
->
drive_£rül
);

684 
	`∑d°r
((
uöt8_t
 *)(
p
 + 10), 
buf
, 20);

685 
	`put_À16
(
p
 + 20, 3);

686 
	`put_À16
(
p
 + 21, 512);

687 
	`put_À16
(
p
 + 22, 4);

688 
	`∑d°r
((
uöt8_t
 *)(
p
 + 23), 
QEMU_VERSION
, 8);

689 
	`∑d°r
((
uöt8_t
 *)(
p
 + 27), "QEMU CD-ROM", 40);

690 
	`put_À16
(
p
 + 48, 1);

691 #ifde‡
USE_DMA_CDROM


692 
	`put_À16
(
p
 + 49, 1 << 9 | 1 << 8);

693 
	`put_À16
(
p
 + 53, 7);

694 
	`put_À16
(
p
 + 63, 7);

695 
	`put_À16
(
p
 + 64, 0x3f);

697 
	`put_À16
(
p
 + 49, 1 << 9);

698 
	`put_À16
(
p
 + 53, 3);

699 
	`put_À16
(
p
 + 63, 0x103);

700 
	`put_À16
(
p
 + 64, 1);

702 
	`put_À16
(
p
 + 65, 0xb4);

703 
	`put_À16
(
p
 + 66, 0xb4);

704 
	`put_À16
(
p
 + 67, 0x12c);

705 
	`put_À16
(
p
 + 68, 0xb4);

707 
	`put_À16
(
p
 + 71, 30);

708 
	`put_À16
(
p
 + 72, 30);

710 
	`put_À16
(
p
 + 80, 0x1e);

711 #ifde‡
USE_DMA_CDROM


712 
	`put_À16
(
p
 + 88, 0x3f | (1 << 13));

714 
	`mem˝y
(
s
->
idítify_d©a
, 
p
, (s->identify_data));

715 
s
->
idítify_£t
 = 1;

716 
	}
}

718 
	$ide_£t_sig«tuª
(
IDESèã
 *
s
)

720 
s
->
£À˘
 &= 0xf0;

722 
s
->
n£˘‹
 = 1;

723 
s
->
£˘‹
 = 1;

724 i‡(
s
->
is_cdrom
) {

725 
s
->
lcyl
 = 0x14;

726 
s
->
hcyl
 = 0xeb;

727 } i‡(
s
->
bs
) {

728 
s
->
lcyl
 = 0;

729 
s
->
hcyl
 = 0;

731 
s
->
lcyl
 = 0xff;

732 
s
->
hcyl
 = 0xff;

734 
	}
}

736 
ölöe
 
	$ide_ab‹t_comm™d
(
IDESèã
 *
s
)

738 
s
->
°©us
 = 
READY_STAT
 | 
ERR_STAT
;

739 
s
->
îr‹
 = 
ABRT_ERR
;

740 
	}
}

742 
ölöe
 
	$ide_£t_úq
(
IDESèã
 *
s
)

744 
BMDMASèã
 *
bm
 = 
s
->
bmdma
;

745 i‡(!(
s
->
cmd
 & 
IDE_CMD_DISABLE_IRQ
)) {

746 i‡(
bm
) {

747 
bm
->
°©us
 |
BM_STATUS_INT
;

749 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 1);

751 
	}
}

754 
	$ide_å™s„r_°¨t
(
IDESèã
 *
s
, 
uöt8_t
 *
buf
, 
size
,

755 
EndTøns„rFunc
 *
íd_å™s„r_func
)

757 
s
->
íd_å™s„r_func
 =Énd_transfer_func;

758 
s
->
d©a_±r
 = 
buf
;

759 
s
->
d©a_íd
 = 
buf
 + 
size
;

761 i‡(!(
s
->
°©us
 & 
ERR_STAT
))

762 
s
->
°©us
 |
DRQ_STAT
;

763 
	`buf„ªd_pio_ª£t
(
s
);

764 
	}
}

766 
	$ide_å™s„r_°›
(
IDESèã
 *
s
)

768 
s
->
íd_å™s„r_func
 = 
ide_å™s„r_°›
;

769 
s
->
d©a_±r
 = s->
io_buf„r
;

770 
s
->
d©a_íd
 = s->
io_buf„r
;

771 
s
->
°©us
 &~
DRQ_STAT
;

772 
	`buf„ªd_pio_ª£t
(
s
);

773 
	}
}

775 
öt64_t
 
	$ide_gë_£˘‹
(
IDESèã
 *
s
)

777 
öt64_t
 
£˘‹_num
;

778 i‡(
s
->
£À˘
 & 0x40) {

780 i‡(!
s
->
lba48
) {

781 
£˘‹_num
 = ((
s
->
£À˘
 & 0x0fË<< 24Ë| (s->
hcyl
 << 16) |

782 (
s
->
lcyl
 << 8Ë| s->
£˘‹
;

784 
£˘‹_num
 = ((
öt64_t
)
s
->
hob_hcyl
 << 40) |

785 ((
öt64_t
Ë
s
->
hob_lcyl
 << 32) |

786 ((
öt64_t
Ë
s
->
hob_£˘‹
 << 24) |

787 ((
öt64_t
Ë
s
->
hcyl
 << 16) |

788 ((
öt64_t
Ë
s
->
lcyl
 << 8Ë| s->
£˘‹
;

791 
£˘‹_num
 = ((
s
->
hcyl
 << 8Ë| s->
lcyl
Ë* s->
hóds
 * s->
£˘‹s
 +

792 (
s
->
£À˘
 & 0x0fË* s->
£˘‹s
 + (s->
£˘‹
 - 1);

794  
£˘‹_num
;

795 
	}
}

797 
	$ide_£t_£˘‹
(
IDESèã
 *
s
, 
öt64_t
 
£˘‹_num
)

799 
cyl
, 
r
;

800 i‡(
s
->
£À˘
 & 0x40) {

801 i‡(!
s
->
lba48
) {

802 
s
->
£À˘
 = (s->£À˘ & 0xf0Ë| (
£˘‹_num
 >> 24);

803 
s
->
hcyl
 = (
£˘‹_num
 >> 16);

804 
s
->
lcyl
 = (
£˘‹_num
 >> 8);

805 
s
->
£˘‹
 = (
£˘‹_num
);

807 
s
->
£˘‹
 = 
£˘‹_num
;

808 
s
->
lcyl
 = 
£˘‹_num
 >> 8;

809 
s
->
hcyl
 = 
£˘‹_num
 >> 16;

810 
s
->
hob_£˘‹
 = 
£˘‹_num
 >> 24;

811 
s
->
hob_lcyl
 = 
£˘‹_num
 >> 32;

812 
s
->
hob_hcyl
 = 
£˘‹_num
 >> 40;

815 
cyl
 = 
£˘‹_num
 / (
s
->
hóds
 * s->
£˘‹s
);

816 
r
 = 
£˘‹_num
 % (
s
->
hóds
 * s->
£˘‹s
);

817 
s
->
hcyl
 = 
cyl
 >> 8;

818 
s
->
lcyl
 = 
cyl
;

819 
s
->
£À˘
 = (s->£À˘ & 0xf0Ë| ((
r
 / s->
£˘‹s
) & 0x0f);

820 
s
->
£˘‹
 = (
r
 % s->
£˘‹s
) + 1;

822 
	}
}

824 
	$ide_£˘‹_ªad
(
IDESèã
 *
s
)

826 
öt64_t
 
£˘‹_num
;

827 
n
;

829 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

830 
s
->
îr‹
 = 0;

831 
£˘‹_num
 = 
	`ide_gë_£˘‹
(
s
);

832 
n
 = 
s
->
n£˘‹
;

833 i‡(
n
 == 0) {

835 
	`ide_å™s„r_°›
(
s
);

837 #i‡
	`deföed
(
DEBUG_IDE
)

838 
	`¥ötf
("ªad se˘‹=%Ld\n", 
£˘‹_num
);

840 i‡(
n
 > 
s
->
ªq_nb_£˘‹s
)

841 
n
 = 
s
->
ªq_nb_£˘‹s
;

842 i‡(
	`bdrv_ªad
(
s
->
bs
, 
£˘‹_num
, s->
io_buf„r
, 
n
) != 0) {

843 
	`ide_ab‹t_comm™d
(
s
);

844 
	`ide_£t_úq
(
s
);

847 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
, 512 * 
n
, 
ide_£˘‹_ªad
);

848 
	`ide_£t_úq
(
s
);

849 
	`ide_£t_£˘‹
(
s
, 
£˘‹_num
 + 
n
);

850 
s
->
n£˘‹
 -
n
;

852 
	}
}

855 
	$dma_buf_rw
(
BMDMASèã
 *
bm
, 
is_wrôe
)

857 
IDESèã
 *
s
 = 
bm
->
ide_if
;

859 
uöt32_t
 
addr
;

860 
uöt32_t
 
size
;

861 } 
¥d
;

862 
l
, 
Àn
;

865 
l
 = 
s
->
io_buf„r_size
 - s->
io_buf„r_ödex
;

866 i‡(
l
 <= 0)

868 i‡(
bm
->
cur_¥d_Àn
 == 0) {

870 i‡(
bm
->
cur_¥d_œ°
 ||

871 (
bm
->
cur_addr
 - bm->
addr
) >= 4096)

873 
	`˝u_physiˇl_mem‹y_ªad
(
bm
->
cur_addr
, (
uöt8_t
 *)&
¥d
, 8);

874 
bm
->
cur_addr
 += 8;

875 
¥d
.
addr
 = 
	`À32_to_˝u
(prd.addr);

876 
¥d
.
size
 = 
	`À32_to_˝u
(prd.size);

877 
Àn
 = 
¥d
.
size
 & 0xfffe;

878 i‡(
Àn
 == 0)

879 
Àn
 = 0x10000;

880 
bm
->
cur_¥d_Àn
 = 
Àn
;

881 
bm
->
cur_¥d_addr
 = 
¥d
.
addr
;

882 
bm
->
cur_¥d_œ°
 = (
¥d
.
size
 & 0x80000000);

884 i‡(
l
 > 
bm
->
cur_¥d_Àn
)

885 
l
 = 
bm
->
cur_¥d_Àn
;

886 i‡(
l
 > 0) {

887 i‡(
is_wrôe
) {

888 
	`˝u_physiˇl_mem‹y_wrôe
(
bm
->
cur_¥d_addr
,

889 
s
->
io_buf„r
 + s->
io_buf„r_ödex
, 
l
);

891 
	`˝u_physiˇl_mem‹y_ªad
(
bm
->
cur_¥d_addr
,

892 
s
->
io_buf„r
 + s->
io_buf„r_ödex
, 
l
);

894 
bm
->
cur_¥d_addr
 +
l
;

895 
bm
->
cur_¥d_Àn
 -
l
;

896 
s
->
io_buf„r_ödex
 +
l
;

900 
	}
}

903 
	$ide_ªad_dma_cb
(*
›aque
, 
ªt
)

905 
BMDMASèã
 *
bm
 = 
›aque
;

906 
IDESèã
 *
s
 = 
bm
->
ide_if
;

907 
n
;

908 
öt64_t
 
£˘‹_num
;

910 
n
 = 
s
->
io_buf„r_size
 >> 9;

911 
£˘‹_num
 = 
	`ide_gë_£˘‹
(
s
);

912 i‡(
n
 > 0) {

913 
£˘‹_num
 +
n
;

914 
	`ide_£t_£˘‹
(
s
, 
£˘‹_num
);

915 
s
->
n£˘‹
 -
n
;

916 i‡(
	`dma_buf_rw
(
bm
, 1) == 0)

917 
eŸ
;

921 i‡(
s
->
n£˘‹
 == 0) {

922 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

923 
	`ide_£t_úq
(
s
);

924 
eŸ
:

925 
bm
->
°©us
 &~
BM_STATUS_DMAING
;

926 
bm
->
°©us
 |
BM_STATUS_INT
;

927 
bm
->
dma_cb
 = 
NULL
;

928 
bm
->
ide_if
 = 
NULL
;

929 
bm
->
aiocb
 = 
NULL
;

934 
n
 = 
s
->
n£˘‹
;

935 i‡(
n
 > 
MAX_MULT_SECTORS
)

936 
n
 = 
MAX_MULT_SECTORS
;

937 
s
->
io_buf„r_ödex
 = 0;

938 
s
->
io_buf„r_size
 = 
n
 * 512;

939 #ifde‡
DEBUG_AIO


940 
	`¥ötf
("aio_ªad: se˘‹_num=%ŒdÇ=%d\n", 
£˘‹_num
, 
n
);

942 
bm
->
aiocb
 = 
	`bdrv_aio_ªad
(
s
->
bs
, 
£˘‹_num
, s->
io_buf„r
, 
n
,

943 
ide_ªad_dma_cb
, 
bm
);

944 
	}
}

946 
	$ide_£˘‹_ªad_dma
(
IDESèã
 *
s
)

948 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
 | 
DRQ_STAT
 | 
BUSY_STAT
;

949 
s
->
io_buf„r_ödex
 = 0;

950 
s
->
io_buf„r_size
 = 0;

951 
	`ide_dma_°¨t
(
s
, 
ide_ªad_dma_cb
);

952 
	}
}

954 
	$ide_£˘‹_wrôe_timî_cb
(*
›aque
)

956 
IDESèã
 *
s
 = 
›aque
;

957 
	`ide_£t_úq
(
s
);

958 
	}
}

960 
	$ide_£˘‹_wrôe
(
IDESèã
 *
s
)

962 
öt64_t
 
£˘‹_num
;

963 
n
, 
n1
;

965 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

966 
£˘‹_num
 = 
	`ide_gë_£˘‹
(
s
);

967 #i‡
	`deföed
(
DEBUG_IDE
)

968 
	`¥ötf
("wrôê£˘‹=%Ld\n", 
£˘‹_num
);

970 
n
 = 
s
->
n£˘‹
;

971 i‡(
n
 > 
s
->
ªq_nb_£˘‹s
)

972 
n
 = 
s
->
ªq_nb_£˘‹s
;

973 i‡(
	`bdrv_wrôe
(
s
->
bs
, 
£˘‹_num
, s->
io_buf„r
, 
n
) != 0) {

974 
	`ide_ab‹t_comm™d
(
s
);

975 
	`ide_£t_úq
(
s
);

978 
s
->
n£˘‹
 -
n
;

979 i‡(
s
->
n£˘‹
 == 0) {

981 
	`ide_å™s„r_°›
(
s
);

983 
n1
 = 
s
->
n£˘‹
;

984 i‡(
n1
 > 
s
->
ªq_nb_£˘‹s
)

985 
n1
 = 
s
->
ªq_nb_£˘‹s
;

986 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
, 512 * 
n1
, 
ide_£˘‹_wrôe
);

988 
	`ide_£t_£˘‹
(
s
, 
£˘‹_num
 + 
n
);

990 i‡(!
s
->
wrôe_ˇche
)

991 
	`bdrv_Êush
(
s
->
bs
);

993 #ifde‡
TARGET_I386


994 i‡(
wö2k_ö°Æl_hack
 && ((++
s
->
úq_cou¡
 % 16) == 0)) {

1001 
	`qemu_mod_timî
(
s
->
£˘‹_wrôe_timî
,

1002 
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ (
ticks_≥r_£c
 / 1000));

1006 
	`ide_£t_úq
(
s
);

1008 
	}
}

1011 
	$ide_wrôe_dma_cb
(*
›aque
, 
ªt
)

1013 
BMDMASèã
 *
bm
 = 
›aque
;

1014 
IDESèã
 *
s
 = 
bm
->
ide_if
;

1015 
n
;

1016 
öt64_t
 
£˘‹_num
;

1018 
n
 = 
s
->
io_buf„r_size
 >> 9;

1019 
£˘‹_num
 = 
	`ide_gë_£˘‹
(
s
);

1020 i‡(
n
 > 0) {

1021 
£˘‹_num
 +
n
;

1022 
	`ide_£t_£˘‹
(
s
, 
£˘‹_num
);

1023 
s
->
n£˘‹
 -
n
;

1027 i‡(
s
->
n£˘‹
 == 0) {

1029 i‡(!
s
->
wrôe_ˇche
)

1030 
	`bdrv_Êush
(
s
->
bs
);

1031 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

1032 
	`ide_£t_úq
(
s
);

1033 
eŸ
:

1034 
bm
->
°©us
 &~
BM_STATUS_DMAING
;

1035 
bm
->
°©us
 |
BM_STATUS_INT
;

1036 
bm
->
dma_cb
 = 
NULL
;

1037 
bm
->
ide_if
 = 
NULL
;

1038 
bm
->
aiocb
 = 
NULL
;

1043 
n
 = 
s
->
n£˘‹
;

1044 i‡(
n
 > 
MAX_MULT_SECTORS
)

1045 
n
 = 
MAX_MULT_SECTORS
;

1046 
s
->
io_buf„r_ödex
 = 0;

1047 
s
->
io_buf„r_size
 = 
n
 * 512;

1049 i‡(
	`dma_buf_rw
(
bm
, 0) == 0)

1050 
eŸ
;

1051 #ifde‡
DEBUG_AIO


1052 
	`¥ötf
("aio_wrôe: se˘‹_num=%ŒdÇ=%d\n", 
£˘‹_num
, 
n
);

1054 
bm
->
aiocb
 = 
	`bdrv_aio_wrôe
(
s
->
bs
, 
£˘‹_num
, s->
io_buf„r
, 
n
,

1055 
ide_wrôe_dma_cb
, 
bm
);

1056 
	}
}

1058 
	$ide_£˘‹_wrôe_dma
(
IDESèã
 *
s
)

1060 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
 | 
DRQ_STAT
 | 
BUSY_STAT
;

1061 
s
->
io_buf„r_ödex
 = 0;

1062 
s
->
io_buf„r_size
 = 0;

1063 
	`ide_dma_°¨t
(
s
, 
ide_wrôe_dma_cb
);

1064 
	}
}

1066 
	$ide_©≠i_cmd_ok
(
IDESèã
 *
s
)

1068 
s
->
îr‹
 = 0;

1069 
s
->
°©us
 = 
READY_STAT
;

1070 
s
->
n£˘‹
 = (s->n£˘‹ & ~7Ë| 
ATAPI_INT_REASON_IO
 | 
ATAPI_INT_REASON_CD
;

1071 
	`ide_£t_úq
(
s
);

1072 
	}
}

1074 
	$ide_©≠i_cmd_îr‹
(
IDESèã
 *
s
, 
£n£_key
, 
asc
)

1076 #ifde‡
DEBUG_IDE_ATAPI


1077 
	`¥ötf
("©≠i_cmd_îr‹: sí£=0x%xásc=0x%x\n", 
£n£_key
, 
asc
);

1079 
s
->
îr‹
 = 
£n£_key
 << 4;

1080 
s
->
°©us
 = 
READY_STAT
 | 
ERR_STAT
;

1081 
s
->
n£˘‹
 = (s->n£˘‹ & ~7Ë| 
ATAPI_INT_REASON_IO
 | 
ATAPI_INT_REASON_CD
;

1082 
s
->
£n£_key
 = sense_key;

1083 
s
->
asc
 =ásc;

1084 
	`ide_£t_úq
(
s
);

1085 
	}
}

1087 
ölöe
 
	$˝u_to_ube16
(
uöt8_t
 *
buf
, 
vÆ
)

1089 
buf
[0] = 
vÆ
 >> 8;

1090 
buf
[1] = 
vÆ
;

1091 
	}
}

1093 
ölöe
 
	$˝u_to_ube32
(
uöt8_t
 *
buf
, 
vÆ
)

1095 
buf
[0] = 
vÆ
 >> 24;

1096 
buf
[1] = 
vÆ
 >> 16;

1097 
buf
[2] = 
vÆ
 >> 8;

1098 
buf
[3] = 
vÆ
;

1099 
	}
}

1101 
ölöe
 
	$ube16_to_˝u
(c⁄° 
uöt8_t
 *
buf
)

1103  (
buf
[0] << 8) | buf[1];

1104 
	}
}

1106 
ölöe
 
	$ube32_to_˝u
(c⁄° 
uöt8_t
 *
buf
)

1108  (
buf
[0] << 24) | (buf[1] << 16) | (buf[2] << 8) | buf[3];

1109 
	}
}

1111 
	$lba_to_msf
(
uöt8_t
 *
buf
, 
lba
)

1113 
lba
 += 150;

1114 
buf
[0] = (
lba
 / 75) / 60;

1115 
buf
[1] = (
lba
 / 75) % 60;

1116 
buf
[2] = 
lba
 % 75;

1117 
	}
}

1119 
	$cd_d©a_to_øw
(
uöt8_t
 *
buf
, 
lba
)

1122 
buf
[0] = 0x00;

1123 
	`mem£t
(
buf
 + 1, 0xff, 10);

1124 
buf
[11] = 0x00;

1125 
buf
 += 12;

1127 
	`lba_to_msf
(
buf
, 
lba
);

1128 
buf
[3] = 0x01;

1129 
buf
 += 4;

1131 
buf
 += 2048;

1133 
	`mem£t
(
buf
, 0, 288);

1134 
	}
}

1136 
	$cd_ªad_£˘‹
(
BlockDrivîSèã
 *
bs
, 
lba
, 
uöt8_t
 *
buf
,

1137 
£˘‹_size
)

1139 
ªt
;

1141 
£˘‹_size
) {

1143 
ªt
 = 
	`bdrv_ªad
(
bs
, (
öt64_t
)
lba
 << 2, 
buf
, 4);

1146 
ªt
 = 
	`bdrv_ªad
(
bs
, (
öt64_t
)
lba
 << 2, 
buf
 + 16, 4);

1147 i‡(
ªt
 < 0)

1148  
ªt
;

1149 
	`cd_d©a_to_øw
(
buf
, 
lba
);

1152 
ªt
 = -
EIO
;

1155  
ªt
;

1156 
	}
}

1158 
	$ide_©≠i_io_îr‹
(
IDESèã
 *
s
, 
ªt
)

1161 i‡(
ªt
 =-
ENOMEDIUM
) {

1162 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_NOT_READY
,

1163 
ASC_MEDIUM_NOT_PRESENT
);

1165 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_ILLEGAL_REQUEST
,

1166 
ASC_LOGICAL_BLOCK_OOR
);

1168 
	}
}

1171 
	$ide_©≠i_cmd_ª∂y_íd
(
IDESèã
 *
s
)

1173 
byã_cou¡_limô
, 
size
, 
ªt
;

1174 #ifde‡
DEBUG_IDE_ATAPI


1175 
	`¥ötf
("reply:Åx_size=%dÉlem_tx_size=%d index=%d\n",

1176 
s
->
∑ckë_å™s„r_size
,

1177 
s
->
ñemíèry_å™s„r_size
,

1178 
s
->
io_buf„r_ödex
);

1180 i‡(
s
->
∑ckë_å™s„r_size
 <= 0) {

1182 
	`ide_å™s„r_°›
(
s
);

1183 
s
->
°©us
 = 
READY_STAT
;

1184 
s
->
n£˘‹
 = (s->n£˘‹ & ~7Ë| 
ATAPI_INT_REASON_IO
 | 
ATAPI_INT_REASON_CD
;

1185 
	`ide_£t_úq
(
s
);

1186 #ifde‡
DEBUG_IDE_ATAPI


1187 
	`¥ötf
("°©us=0x%x\n", 
s
->
°©us
);

1191 i‡(
s
->
lba
 !-1 && s->
io_buf„r_ödex
 >s->
cd_£˘‹_size
) {

1192 
ªt
 = 
	`cd_ªad_£˘‹
(
s
->
bs
, s->
lba
, s->
io_buf„r
, s->
cd_£˘‹_size
);

1193 i‡(
ªt
 < 0) {

1194 
	`ide_å™s„r_°›
(
s
);

1195 
	`ide_©≠i_io_îr‹
(
s
, 
ªt
);

1198 
s
->
lba
++;

1199 
s
->
io_buf„r_ödex
 = 0;

1201 i‡(
s
->
ñemíèry_å™s„r_size
 > 0) {

1204 
size
 = 
s
->
cd_£˘‹_size
 - s->
io_buf„r_ödex
;

1205 i‡(
size
 > 
s
->
ñemíèry_å™s„r_size
)

1206 
size
 = 
s
->
ñemíèry_å™s„r_size
;

1207 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
 + s->
io_buf„r_ödex
,

1208 
size
, 
ide_©≠i_cmd_ª∂y_íd
);

1209 
s
->
∑ckë_å™s„r_size
 -
size
;

1210 
s
->
ñemíèry_å™s„r_size
 -
size
;

1211 
s
->
io_buf„r_ödex
 +
size
;

1214 
s
->
n£˘‹
 = (s->n£˘‹ & ~7Ë| 
ATAPI_INT_REASON_IO
;

1215 
byã_cou¡_limô
 = 
s
->
lcyl
 | (s->
hcyl
 << 8);

1216 #ifde‡
DEBUG_IDE_ATAPI


1217 
	`¥ötf
("byã_cou¡_limô=%d\n", 
byã_cou¡_limô
);

1219 i‡(
byã_cou¡_limô
 == 0xffff)

1220 
byã_cou¡_limô
--;

1221 
size
 = 
s
->
∑ckë_å™s„r_size
;

1222 i‡(
size
 > 
byã_cou¡_limô
) {

1224 i‡(
byã_cou¡_limô
 & 1)

1225 
byã_cou¡_limô
--;

1226 
size
 = 
byã_cou¡_limô
;

1228 
s
->
lcyl
 = 
size
;

1229 
s
->
hcyl
 = 
size
 >> 8;

1230 
s
->
ñemíèry_å™s„r_size
 = 
size
;

1232 i‡(
s
->
lba
 != -1) {

1233 i‡(
size
 > (
s
->
cd_£˘‹_size
 - s->
io_buf„r_ödex
))

1234 
size
 = (
s
->
cd_£˘‹_size
 - s->
io_buf„r_ödex
);

1236 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
 + s->
io_buf„r_ödex
,

1237 
size
, 
ide_©≠i_cmd_ª∂y_íd
);

1238 
s
->
∑ckë_å™s„r_size
 -
size
;

1239 
s
->
ñemíèry_å™s„r_size
 -
size
;

1240 
s
->
io_buf„r_ödex
 +
size
;

1241 
	`ide_£t_úq
(
s
);

1242 #ifde‡
DEBUG_IDE_ATAPI


1243 
	`¥ötf
("°©us=0x%x\n", 
s
->
°©us
);

1247 
	}
}

1250 
	$ide_©≠i_cmd_ª∂y
(
IDESèã
 *
s
, 
size
, 
max_size
)

1252 i‡(
size
 > 
max_size
)

1253 
size
 = 
max_size
;

1254 
s
->
lba
 = -1;

1255 
s
->
∑ckë_å™s„r_size
 = 
size
;

1256 
s
->
io_buf„r_size
 = 
size
;

1257 
s
->
ñemíèry_å™s„r_size
 = 0;

1258 
s
->
io_buf„r_ödex
 = 0;

1260 i‡(
s
->
©≠i_dma
) {

1261 
s
->
°©us
 = 
READY_STAT
 | 
DRQ_STAT
;

1262 
	`ide_dma_°¨t
(
s
, 
ide_©≠i_cmd_ªad_dma_cb
);

1264 
s
->
°©us
 = 
READY_STAT
;

1265 
	`ide_©≠i_cmd_ª∂y_íd
(
s
);

1267 
	}
}

1270 
	$ide_©≠i_cmd_ªad_pio
(
IDESèã
 *
s
, 
lba
, 
nb_£˘‹s
,

1271 
£˘‹_size
)

1273 
s
->
lba
 =Üba;

1274 
s
->
∑ckë_å™s„r_size
 = 
nb_£˘‹s
 * 
£˘‹_size
;

1275 
s
->
ñemíèry_å™s„r_size
 = 0;

1276 
s
->
io_buf„r_ödex
 = 
£˘‹_size
;

1277 
s
->
cd_£˘‹_size
 = 
£˘‹_size
;

1279 
s
->
°©us
 = 
READY_STAT
;

1280 
	`ide_©≠i_cmd_ª∂y_íd
(
s
);

1281 
	}
}

1286 
	$ide_©≠i_cmd_ªad_dma_cb
(*
›aque
, 
ªt
)

1288 
BMDMASèã
 *
bm
 = 
›aque
;

1289 
IDESèã
 *
s
 = 
bm
->
ide_if
;

1290 
d©a_off£t
, 
n
;

1292 i‡(
ªt
 < 0) {

1293 
	`ide_©≠i_io_îr‹
(
s
, 
ªt
);

1294 
eŸ
;

1297 i‡(
s
->
io_buf„r_size
 > 0) {

1305 i‡(
s
->
lba
 != -1) {

1306 i‡(
s
->
cd_£˘‹_size
 == 2352) {

1307 
n
 = 1;

1308 
	`cd_d©a_to_øw
(
s
->
io_buf„r
, s->
lba
);

1310 
n
 = 
s
->
io_buf„r_size
 >> 11;

1312 
s
->
lba
 +
n
;

1314 
s
->
∑ckë_å™s„r_size
 -s->
io_buf„r_size
;

1315 i‡(
	`dma_buf_rw
(
bm
, 1) == 0)

1316 
eŸ
;

1319 i‡(
s
->
∑ckë_å™s„r_size
 <= 0) {

1320 
s
->
°©us
 = 
READY_STAT
;

1321 
s
->
n£˘‹
 = (s->n£˘‹ & ~7Ë| 
ATAPI_INT_REASON_IO
 | 
ATAPI_INT_REASON_CD
;

1322 
	`ide_£t_úq
(
s
);

1323 
eŸ
:

1324 
bm
->
°©us
 &~
BM_STATUS_DMAING
;

1325 
bm
->
°©us
 |
BM_STATUS_INT
;

1326 
bm
->
dma_cb
 = 
NULL
;

1327 
bm
->
ide_if
 = 
NULL
;

1328 
bm
->
aiocb
 = 
NULL
;

1332 
s
->
io_buf„r_ödex
 = 0;

1333 i‡(
s
->
cd_£˘‹_size
 == 2352) {

1334 
n
 = 1;

1335 
s
->
io_buf„r_size
 = s->
cd_£˘‹_size
;

1336 
d©a_off£t
 = 16;

1338 
n
 = 
s
->
∑ckë_å™s„r_size
 >> 11;

1339 i‡(
n
 > (
MAX_MULT_SECTORS
 / 4))

1340 
n
 = (
MAX_MULT_SECTORS
 / 4);

1341 
s
->
io_buf„r_size
 = 
n
 * 2048;

1342 
d©a_off£t
 = 0;

1344 #ifde‡
DEBUG_AIO


1345 
	`¥ötf
("aio_ªad_cd:Üba=%uÇ=%d\n", 
s
->
lba
, 
n
);

1347 
bm
->
aiocb
 = 
	`bdrv_aio_ªad
(
s
->
bs
, (
öt64_t
)s->
lba
 << 2,

1348 
s
->
io_buf„r
 + 
d©a_off£t
, 
n
 * 4,

1349 
ide_©≠i_cmd_ªad_dma_cb
, 
bm
);

1350 i‡(!
bm
->
aiocb
) {

1352 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_NOT_READY
,

1353 
ASC_MEDIUM_NOT_PRESENT
);

1354 
eŸ
;

1356 
	}
}

1360 
	$ide_©≠i_cmd_ªad_dma
(
IDESèã
 *
s
, 
lba
, 
nb_£˘‹s
,

1361 
£˘‹_size
)

1363 
s
->
lba
 =Üba;

1364 
s
->
∑ckë_å™s„r_size
 = 
nb_£˘‹s
 * 
£˘‹_size
;

1365 
s
->
io_buf„r_ödex
 = 0;

1366 
s
->
io_buf„r_size
 = 0;

1367 
s
->
cd_£˘‹_size
 = 
£˘‹_size
;

1370 
s
->
°©us
 = 
READY_STAT
 | 
DRQ_STAT
 | 
BUSY_STAT
;

1371 
	`ide_dma_°¨t
(
s
, 
ide_©≠i_cmd_ªad_dma_cb
);

1372 
	}
}

1374 
	$ide_©≠i_cmd_ªad
(
IDESèã
 *
s
, 
lba
, 
nb_£˘‹s
,

1375 
£˘‹_size
)

1377 #ifde‡
DEBUG_IDE_ATAPI


1378 
	`¥ötf
("ªad %s: LBA=%dÇb_£˘‹s=%d\n", 
s
->
©≠i_dma
 ? "dma" : "pio",

1379 
lba
, 
nb_£˘‹s
);

1381 i‡(
s
->
©≠i_dma
) {

1382 
	`ide_©≠i_cmd_ªad_dma
(
s
, 
lba
, 
nb_£˘‹s
, 
£˘‹_size
);

1384 
	`ide_©≠i_cmd_ªad_pio
(
s
, 
lba
, 
nb_£˘‹s
, 
£˘‹_size
);

1386 
	}
}

1388 
	$ide_©≠i_cmd
(
IDESèã
 *
s
)

1390 c⁄° 
uöt8_t
 *
∑ckë
;

1391 
uöt8_t
 *
buf
;

1392 
max_Àn
;

1394 
∑ckë
 = 
s
->
io_buf„r
;

1395 
buf
 = 
s
->
io_buf„r
;

1396 #ifde‡
DEBUG_IDE_ATAPI


1398 
i
;

1399 
	`¥ötf
("ATAPIÜimô=0x%xÖackë:", 
s
->
lcyl
 | (s->
hcyl
 << 8));

1400 
i
 = 0; i < 
ATAPI_PACKET_SIZE
; i++) {

1401 
	`¥ötf
(" %02x", 
∑ckë
[
i
]);

1403 
	`¥ötf
("\n");

1406 
s
->
io_buf„r
[0]) {

1407 
GPCMD_TEST_UNIT_READY
:

1408 i‡(
	`bdrv_is_ö£πed
(
s
->
bs
)) {

1409 
	`ide_©≠i_cmd_ok
(
s
);

1411 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_NOT_READY
,

1412 
ASC_MEDIUM_NOT_PRESENT
);

1413 
	`xí°‹e_check_√w_medü_¥e£¡
(1000);

1416 
GPCMD_MODE_SENSE_10
:

1418 
a˘i⁄
, 
code
;

1419 
max_Àn
 = 
	`ube16_to_˝u
(
∑ckë
 + 7);

1420 
a˘i⁄
 = 
∑ckë
[2] >> 6;

1421 
code
 = 
∑ckë
[2] & 0x3f;

1422 
a˘i⁄
) {

1424 
code
) {

1426 
	`˝u_to_ube16
(&
buf
[0], 16 + 6);

1427 
buf
[2] = 0x70;

1428 
buf
[3] = 0;

1429 
buf
[4] = 0;

1430 
buf
[5] = 0;

1431 
buf
[6] = 0;

1432 
buf
[7] = 0;

1434 
buf
[8] = 0x01;

1435 
buf
[9] = 0x06;

1436 
buf
[10] = 0x00;

1437 
buf
[11] = 0x05;

1438 
buf
[12] = 0x00;

1439 
buf
[13] = 0x00;

1440 
buf
[14] = 0x00;

1441 
buf
[15] = 0x00;

1442 
	`ide_©≠i_cmd_ª∂y
(
s
, 16, 
max_Àn
);

1445 
	`˝u_to_ube16
(&
buf
[0], 28 + 6);

1446 
buf
[2] = 0x70;

1447 
buf
[3] = 0;

1448 
buf
[4] = 0;

1449 
buf
[5] = 0;

1450 
buf
[6] = 0;

1451 
buf
[7] = 0;

1453 
buf
[8] = 0x2a;

1454 
buf
[9] = 0x12;

1455 
buf
[10] = 0x00;

1456 
buf
[11] = 0x00;

1458 
buf
[12] = 0x70;

1459 
buf
[13] = 3 << 5;

1460 
buf
[14] = (1 << 0) | (1 << 3) | (1 << 5);

1461 i‡(
	`bdrv_is_locked
(
s
->
bs
))

1462 
buf
[6] |= 1 << 1;

1463 
buf
[15] = 0x00;

1464 
	`˝u_to_ube16
(&
buf
[16], 706);

1465 
buf
[18] = 0;

1466 
buf
[19] = 2;

1467 
	`˝u_to_ube16
(&
buf
[20], 512);

1468 
	`˝u_to_ube16
(&
buf
[22], 706);

1469 
buf
[24] = 0;

1470 
buf
[25] = 0;

1471 
buf
[26] = 0;

1472 
buf
[27] = 0;

1473 
	`ide_©≠i_cmd_ª∂y
(
s
, 28, 
max_Àn
);

1476 
îr‹_cmd
;

1480 
îr‹_cmd
;

1482 
îr‹_cmd
;

1485 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_ILLEGAL_REQUEST
,

1486 
ASC_SAVING_PARAMETERS_NOT_SUPPORTED
);

1491 
GPCMD_REQUEST_SENSE
:

1492 
max_Àn
 = 
∑ckë
[4];

1493 
	`mem£t
(
buf
, 0, 18);

1494 
buf
[0] = 0x70 | (1 << 7);

1495 
buf
[2] = 
s
->
£n£_key
;

1496 
buf
[7] = 10;

1497 
buf
[12] = 
s
->
asc
;

1498 
	`ide_©≠i_cmd_ª∂y
(
s
, 18, 
max_Àn
);

1500 
GPCMD_PREVENT_ALLOW_MEDIUM_REMOVAL
:

1501 i‡(
	`bdrv_is_ö£πed
(
s
->
bs
)) {

1502 
	`bdrv_£t_locked
(
s
->
bs
, 
∑ckë
[4] & 1);

1503 
	`ide_©≠i_cmd_ok
(
s
);

1505 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_NOT_READY
,

1506 
ASC_MEDIUM_NOT_PRESENT
);

1509 
GPCMD_READ_10
:

1510 
GPCMD_READ_12
:

1512 
nb_£˘‹s
, 
lba
;

1514 i‡(
∑ckë
[0] =
GPCMD_READ_10
)

1515 
nb_£˘‹s
 = 
	`ube16_to_˝u
(
∑ckë
 + 7);

1517 
nb_£˘‹s
 = 
	`ube32_to_˝u
(
∑ckë
 + 6);

1518 
lba
 = 
	`ube32_to_˝u
(
∑ckë
 + 2);

1519 i‡(
nb_£˘‹s
 == 0) {

1520 
	`ide_©≠i_cmd_ok
(
s
);

1523 
	`ide_©≠i_cmd_ªad
(
s
, 
lba
, 
nb_£˘‹s
, 2048);

1526 
GPCMD_READ_CD
:

1528 
nb_£˘‹s
, 
lba
, 
å™s„r_ªque°
;

1530 
nb_£˘‹s
 = (
∑ckë
[6] << 16) | (packet[7] << 8) |Öacket[8];

1531 
lba
 = 
	`ube32_to_˝u
(
∑ckë
 + 2);

1532 i‡(
nb_£˘‹s
 == 0) {

1533 
	`ide_©≠i_cmd_ok
(
s
);

1536 
å™s„r_ªque°
 = 
∑ckë
[9];

1537 
å™s„r_ªque°
 & 0xf8) {

1540 
	`ide_©≠i_cmd_ok
(
s
);

1544 
	`ide_©≠i_cmd_ªad
(
s
, 
lba
, 
nb_£˘‹s
, 2048);

1548 
	`ide_©≠i_cmd_ªad
(
s
, 
lba
, 
nb_£˘‹s
, 2352);

1551 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_ILLEGAL_REQUEST
,

1552 
ASC_INV_FIELD_IN_CMD_PACKET
);

1557 
GPCMD_SEEK
:

1559 
lba
;

1560 
öt64_t
 
tŸÆ_£˘‹s
;

1562 
	`bdrv_gë_geomëry
(
s
->
bs
, &
tŸÆ_£˘‹s
);

1563 
tŸÆ_£˘‹s
 >>= 2;

1564 i‡(
tŸÆ_£˘‹s
 <= 0) {

1565 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_NOT_READY
,

1566 
ASC_MEDIUM_NOT_PRESENT
);

1569 
lba
 = 
	`ube32_to_˝u
(
∑ckë
 + 2);

1570 i‡(
lba
 >
tŸÆ_£˘‹s
) {

1571 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_ILLEGAL_REQUEST
,

1572 
ASC_LOGICAL_BLOCK_OOR
);

1575 
	`ide_©≠i_cmd_ok
(
s
);

1578 
GPCMD_START_STOP_UNIT
:

1580 
°¨t
, 
eje˘
;

1581 
°¨t
 = 
∑ckë
[4] & 1;

1582 
eje˘
 = (
∑ckë
[4] >> 1) & 1;

1584 i‡(
eje˘
 && !
°¨t
) {

1586 
	`bdrv_eje˘
(
s
->
bs
, 1);

1587 } i‡(
eje˘
 && 
°¨t
) {

1589 
	`bdrv_eje˘
(
s
->
bs
, 0);

1591 
	`ide_©≠i_cmd_ok
(
s
);

1594 
GPCMD_MECHANISM_STATUS
:

1596 
max_Àn
 = 
	`ube16_to_˝u
(
∑ckë
 + 8);

1597 
	`˝u_to_ube16
(
buf
, 0);

1599 
buf
[2] = 0;

1600 
buf
[3] = 0;

1601 
buf
[4] = 0;

1602 
buf
[5] = 1;

1603 
	`˝u_to_ube16
(
buf
 + 6, 0);

1604 
	`ide_©≠i_cmd_ª∂y
(
s
, 8, 
max_Àn
);

1607 
GPCMD_READ_TOC_PMA_ATIP
:

1609 
f‹m©
, 
msf
, 
°¨t_åack
, 
Àn
;

1610 
öt64_t
 
tŸÆ_£˘‹s
;

1612 
	`bdrv_gë_geomëry
(
s
->
bs
, &
tŸÆ_£˘‹s
);

1613 
tŸÆ_£˘‹s
 >>= 2;

1614 i‡(
tŸÆ_£˘‹s
 <= 0) {

1615 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_NOT_READY
,

1616 
ASC_MEDIUM_NOT_PRESENT
);

1619 
max_Àn
 = 
	`ube16_to_˝u
(
∑ckë
 + 7);

1620 
f‹m©
 = 
∑ckë
[9] >> 6;

1621 
msf
 = (
∑ckë
[1] >> 1) & 1;

1622 
°¨t_åack
 = 
∑ckë
[6];

1623 
f‹m©
) {

1625 
Àn
 = 
	`cdrom_ªad_toc
(
tŸÆ_£˘‹s
, 
buf
, 
msf
, 
°¨t_åack
);

1626 i‡(
Àn
 < 0)

1627 
îr‹_cmd
;

1628 
	`ide_©≠i_cmd_ª∂y
(
s
, 
Àn
, 
max_Àn
);

1632 
	`mem£t
(
buf
, 0, 12);

1633 
buf
[1] = 0x0a;

1634 
buf
[2] = 0x01;

1635 
buf
[3] = 0x01;

1636 
	`ide_©≠i_cmd_ª∂y
(
s
, 12, 
max_Àn
);

1639 
Àn
 = 
	`cdrom_ªad_toc_øw
(
tŸÆ_£˘‹s
, 
buf
, 
msf
, 
°¨t_åack
);

1640 i‡(
Àn
 < 0)

1641 
îr‹_cmd
;

1642 
	`ide_©≠i_cmd_ª∂y
(
s
, 
Àn
, 
max_Àn
);

1645 
îr‹_cmd
:

1646 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_ILLEGAL_REQUEST
,

1647 
ASC_INV_FIELD_IN_CMD_PACKET
);

1652 
GPCMD_READ_CDVD_CAPACITY
:

1654 
öt64_t
 
tŸÆ_£˘‹s
;

1656 
	`bdrv_gë_geomëry
(
s
->
bs
, &
tŸÆ_£˘‹s
);

1657 
tŸÆ_£˘‹s
 >>= 2;

1658 i‡(
tŸÆ_£˘‹s
 <= 0) {

1659 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_NOT_READY
,

1660 
ASC_MEDIUM_NOT_PRESENT
);

1664 
	`˝u_to_ube32
(
buf
, 
tŸÆ_£˘‹s
 - 1);

1665 
	`˝u_to_ube32
(
buf
 + 4, 2048);

1666 
	`ide_©≠i_cmd_ª∂y
(
s
, 8, 8);

1669 
GPCMD_INQUIRY
:

1670 
max_Àn
 = 
∑ckë
[4];

1671 
buf
[0] = 0x05;

1672 
buf
[1] = 0x80;

1673 
buf
[2] = 0x00;

1674 
buf
[3] = 0x21;

1675 
buf
[4] = 31;

1676 
buf
[5] = 0;

1677 
buf
[6] = 0;

1678 
buf
[7] = 0;

1679 
	`∑d°r8
(
buf
 + 8, 8, "QEMU");

1680 
	`∑d°r8
(
buf
 + 16, 16, "QEMU CD-ROM");

1681 
	`∑d°r8
(
buf
 + 32, 4, 
QEMU_VERSION
);

1682 
	`ide_©≠i_cmd_ª∂y
(
s
, 36, 
max_Àn
);

1685 
	`ide_©≠i_cmd_îr‹
(
s
, 
SENSE_ILLEGAL_REQUEST
,

1686 
ASC_ILLEGAL_OPCODE
);

1689 
	}
}

1692 
	$cdrom_ch™ge_cb
(*
›aque
)

1694 
IDESèã
 *
s
 = 
›aque
;

1695 
öt64_t
 
nb_£˘‹s
;

1698 
	`bdrv_gë_geomëry
(
s
->
bs
, &
nb_£˘‹s
);

1699 
s
->
nb_£˘‹s
 =Çb_sectors;

1700 
	}
}

1702 
	$ide_cmd_lba48_å™sf‹m
(
IDESèã
 *
s
, 
lba48
)

1704 
s
->
lba48
 =Üba48;

1710 i‡(!
s
->
lba48
) {

1711 i‡(!
s
->
n£˘‹
)

1712 
s
->
n£˘‹
 = 256;

1714 i‡(!
s
->
n£˘‹
 && !s->
hob_n£˘‹
)

1715 
s
->
n£˘‹
 = 65536;

1717 
lo
 = 
s
->
n£˘‹
;

1718 
hi
 = 
s
->
hob_n£˘‹
;

1720 
s
->
n£˘‹
 = (
hi
 << 8Ë| 
lo
;

1723 
	}
}

1725 
	$ide_˛ór_hob
(
IDESèã
 *
ide_if
)

1728 
ide_if
[0].
£À˘
 &= ~(1 << 7);

1729 
ide_if
[1].
£À˘
 &= ~(1 << 7);

1730 
	}
}

1732 
	$ide_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

1734 
IDESèã
 *
ide_if
 = 
›aque
;

1735 
IDESèã
 *
s
;

1736 
unô
, 
n
;

1737 
lba48
 = 0;

1739 #ifde‡
DEBUG_IDE


1740 
	`¥ötf
("IDE: wrôêaddr=0x%x vÆ=0x%02x\n", 
addr
, 
vÆ
);

1743 
addr
 &= 7;

1744 
addr
) {

1748 
	`ide_˛ór_hob
(
ide_if
);

1750 
ide_if
[0].
hob_„©uª
 = ide_if[0].
„©uª
;

1751 
ide_if
[1].
hob_„©uª
 = ide_if[1].
„©uª
;

1752 
ide_if
[0].
„©uª
 = 
vÆ
;

1753 
ide_if
[1].
„©uª
 = 
vÆ
;

1756 
	`ide_˛ór_hob
(
ide_if
);

1757 
ide_if
[0].
hob_n£˘‹
 = ide_if[0].
n£˘‹
;

1758 
ide_if
[1].
hob_n£˘‹
 = ide_if[1].
n£˘‹
;

1759 
ide_if
[0].
n£˘‹
 = 
vÆ
;

1760 
ide_if
[1].
n£˘‹
 = 
vÆ
;

1763 
	`ide_˛ór_hob
(
ide_if
);

1764 
ide_if
[0].
hob_£˘‹
 = ide_if[0].
£˘‹
;

1765 
ide_if
[1].
hob_£˘‹
 = ide_if[1].
£˘‹
;

1766 
ide_if
[0].
£˘‹
 = 
vÆ
;

1767 
ide_if
[1].
£˘‹
 = 
vÆ
;

1770 
	`ide_˛ór_hob
(
ide_if
);

1771 
ide_if
[0].
hob_lcyl
 = ide_if[0].
lcyl
;

1772 
ide_if
[1].
hob_lcyl
 = ide_if[1].
lcyl
;

1773 
ide_if
[0].
lcyl
 = 
vÆ
;

1774 
ide_if
[1].
lcyl
 = 
vÆ
;

1777 
	`ide_˛ór_hob
(
ide_if
);

1778 
ide_if
[0].
hob_hcyl
 = ide_if[0].
hcyl
;

1779 
ide_if
[1].
hob_hcyl
 = ide_if[1].
hcyl
;

1780 
ide_if
[0].
hcyl
 = 
vÆ
;

1781 
ide_if
[1].
hcyl
 = 
vÆ
;

1785 
ide_if
[0].
£À˘
 = (
vÆ
 & ~0x10) | 0xa0;

1786 
ide_if
[1].
£À˘
 = (
vÆ
 | 0x10) | 0xa0;

1788 
	`buf„ªd_pio_ª£t
(
ide_if
->
cur_drive
);

1789 
unô
 = (
vÆ
 >> 4) & 1;

1790 
s
 = 
ide_if
 + 
unô
;

1791 
ide_if
->
cur_drive
 = 
s
;

1796 #i‡
	`deföed
(
DEBUG_IDE
)

1797 
	`¥ötf
("ide: CMD=%02x\n", 
vÆ
);

1799 
s
 = 
ide_if
->
cur_drive
;

1801 i‡(
s
 !
ide_if
 && !s->
bs
)

1804 
vÆ
) {

1805 
WIN_IDENTIFY
:

1806 i‡(
s
->
bs
 && !s->
is_cdrom
) {

1807 
	`ide_idítify
(
s
);

1808 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

1809 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
, 512, 
ide_å™s„r_°›
);

1811 i‡(
s
->
is_cdrom
) {

1812 
	`ide_£t_sig«tuª
(
s
);

1814 
	`ide_ab‹t_comm™d
(
s
);

1816 
	`ide_£t_úq
(
s
);

1818 
WIN_SPECIFY
:

1819 
WIN_RECAL
:

1820 
s
->
îr‹
 = 0;

1821 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

1822 
	`ide_£t_úq
(
s
);

1824 
WIN_SETMULT
:

1825 i‡(
s
->
n£˘‹
 > 
MAX_MULT_SECTORS
 ||

1826 (
s
->
n£˘‹
 & (s->nsector - 1)) != 0) {

1827 
	`ide_ab‹t_comm™d
(
s
);

1829 
s
->
mu…_£˘‹s
 = s->
n£˘‹
;

1830 
s
->
°©us
 = 
READY_STAT
;

1832 
	`ide_£t_úq
(
s
);

1834 
WIN_VERIFY_EXT
:

1835 
lba48
 = 1;

1836 
WIN_VERIFY
:

1837 
WIN_VERIFY_ONCE
:

1839 
	`ide_cmd_lba48_å™sf‹m
(
s
, 
lba48
);

1840 
s
->
°©us
 = 
READY_STAT
;

1841 
	`ide_£t_úq
(
s
);

1843 
WIN_READ_EXT
:

1844 
lba48
 = 1;

1845 
WIN_READ
:

1846 
WIN_READ_ONCE
:

1847 i‡(!
s
->
bs
)

1848 
ab‹t_cmd
;

1849 
	`ide_cmd_lba48_å™sf‹m
(
s
, 
lba48
);

1850 
s
->
ªq_nb_£˘‹s
 = 1;

1851 
	`ide_£˘‹_ªad
(
s
);

1853 
WIN_WRITE_EXT
:

1854 
lba48
 = 1;

1855 
WIN_WRITE
:

1856 
WIN_WRITE_ONCE
:

1857 
	`ide_cmd_lba48_å™sf‹m
(
s
, 
lba48
);

1858 
s
->
îr‹
 = 0;

1859 
s
->
°©us
 = 
SEEK_STAT
 | 
READY_STAT
;

1860 
s
->
ªq_nb_£˘‹s
 = 1;

1861 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
, 512, 
ide_£˘‹_wrôe
);

1863 
WIN_MULTREAD_EXT
:

1864 
lba48
 = 1;

1865 
WIN_MULTREAD
:

1866 i‡(!
s
->
mu…_£˘‹s
)

1867 
ab‹t_cmd
;

1868 
	`ide_cmd_lba48_å™sf‹m
(
s
, 
lba48
);

1869 
s
->
ªq_nb_£˘‹s
 = s->
mu…_£˘‹s
;

1870 
	`ide_£˘‹_ªad
(
s
);

1872 
WIN_MULTWRITE_EXT
:

1873 
lba48
 = 1;

1874 
WIN_MULTWRITE
:

1875 i‡(!
s
->
mu…_£˘‹s
)

1876 
ab‹t_cmd
;

1877 
	`ide_cmd_lba48_å™sf‹m
(
s
, 
lba48
);

1878 
s
->
îr‹
 = 0;

1879 
s
->
°©us
 = 
SEEK_STAT
 | 
READY_STAT
;

1880 
s
->
ªq_nb_£˘‹s
 = s->
mu…_£˘‹s
;

1881 
n
 = 
s
->
n£˘‹
;

1882 i‡(
n
 > 
s
->
ªq_nb_£˘‹s
)

1883 
n
 = 
s
->
ªq_nb_£˘‹s
;

1884 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
, 512 * 
n
, 
ide_£˘‹_wrôe
);

1886 
WIN_READDMA_EXT
:

1887 
lba48
 = 1;

1888 
WIN_READDMA
:

1889 
WIN_READDMA_ONCE
:

1890 i‡(!
s
->
bs
)

1891 
ab‹t_cmd
;

1892 
	`ide_cmd_lba48_å™sf‹m
(
s
, 
lba48
);

1893 
	`ide_£˘‹_ªad_dma
(
s
);

1895 
WIN_WRITEDMA_EXT
:

1896 
lba48
 = 1;

1897 
WIN_WRITEDMA
:

1898 
WIN_WRITEDMA_ONCE
:

1899 i‡(!
s
->
bs
)

1900 
ab‹t_cmd
;

1901 
	`ide_cmd_lba48_å™sf‹m
(
s
, 
lba48
);

1902 
	`ide_£˘‹_wrôe_dma
(
s
);

1904 
WIN_READ_NATIVE_MAX_EXT
:

1905 
lba48
 = 1;

1906 
WIN_READ_NATIVE_MAX
:

1907 
	`ide_cmd_lba48_å™sf‹m
(
s
, 
lba48
);

1908 
	`ide_£t_£˘‹
(
s
, s->
nb_£˘‹s
 - 1);

1909 
s
->
°©us
 = 
READY_STAT
;

1910 
	`ide_£t_úq
(
s
);

1912 
WIN_CHECKPOWERMODE1
:

1913 
s
->
n£˘‹
 = 0xff;

1914 
s
->
°©us
 = 
READY_STAT
;

1915 
	`ide_£t_úq
(
s
);

1917 
WIN_SETFEATURES
:

1918 i‡(!
s
->
bs
)

1919 
ab‹t_cmd
;

1921 
s
->
„©uª
) {

1923 
s
->
wrôe_ˇche
 = 1;

1924 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

1925 
	`ide_£t_úq
(
s
);

1928 
s
->
wrôe_ˇche
 = 0;

1929 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

1930 
	`ide_£t_úq
(
s
);

1937 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

1938 
	`ide_£t_úq
(
s
);

1941 
uöt8_t
 
vÆ
 = 
s
->
n£˘‹
 & 0x07;

1943 
s
->
n£˘‹
 >> 3) {

1946 
	`put_À16
(
s
->
idítify_d©a
 + 63,0x07);

1947 
	`put_À16
(
s
->
idítify_d©a
 + 88,0x3f);

1950 
	`put_À16
(
s
->
idítify_d©a
 + 63,0x07 | (1 << (
vÆ
 + 8)));

1951 
	`put_À16
(
s
->
idítify_d©a
 + 88,0x3f);

1954 
	`put_À16
(
s
->
idítify_d©a
 + 63,0x07);

1955 
	`put_À16
(
s
->
idítify_d©a
 + 88,0x3‡| (1 << (
vÆ
 + 8)));

1958 
ab‹t_cmd
;

1960 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

1961 
	`ide_£t_úq
(
s
);

1965 
ab‹t_cmd
;

1968 
WIN_FLUSH_CACHE
:

1969 
WIN_FLUSH_CACHE_EXT
:

1970 i‡(
s
->
bs
)

1971 
	`bdrv_Êush
(
s
->
bs
);

1972 
s
->
°©us
 = 
READY_STAT
;

1973 
	`ide_£t_úq
(
s
);

1975 
WIN_IDLEIMMEDIATE
:

1976 
WIN_STANDBY
:

1977 
WIN_SETIDLE1
:

1978 
WIN_STANDBYNOW1
:

1979 
WIN_SLEEPNOW1
:

1980 
WIN_STANDBY2
:

1981 
WIN_SETIDLE2
:

1982 
WIN_STANDBYNOW2
:

1983 
WIN_SLEEPNOW2
:

1984 
s
->
°©us
 = 
READY_STAT
;

1985 
	`ide_£t_úq
(
s
);

1988 
WIN_PIDENTIFY
:

1989 i‡(
s
->
is_cdrom
) {

1990 
	`ide_©≠i_idítify
(
s
);

1991 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

1992 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
, 512, 
ide_å™s„r_°›
);

1994 
	`ide_ab‹t_comm™d
(
s
);

1996 
	`ide_£t_úq
(
s
);

1998 
WIN_DIAGNOSE
:

1999 
	`ide_£t_sig«tuª
(
s
);

2000 
s
->
°©us
 = 0x00;

2001 
s
->
îr‹
 = 0x01;

2003 
WIN_SRST
:

2004 i‡(!
s
->
is_cdrom
)

2005 
ab‹t_cmd
;

2006 
	`ide_£t_sig«tuª
(
s
);

2007 
s
->
°©us
 = 0x00;

2008 
s
->
îr‹
 = 0x01;

2010 
WIN_PACKETCMD
:

2011 i‡(!
s
->
is_cdrom
)

2012 
ab‹t_cmd
;

2014 i‡(
s
->
„©uª
 & 0x02)

2015 
ab‹t_cmd
;

2016 
s
->
°©us
 = 
READY_STAT
;

2017 
s
->
©≠i_dma
 = s->
„©uª
 & 1;

2018 
s
->
n£˘‹
 = 1;

2019 
	`ide_å™s„r_°¨t
(
s
, s->
io_buf„r
, 
ATAPI_PACKET_SIZE
,

2020 
ide_©≠i_cmd
);

2023 
ab‹t_cmd
:

2024 
	`ide_ab‹t_comm™d
(
s
);

2025 
	`ide_£t_úq
(
s
);

2029 
	}
}

2031 
uöt32_t
 
	$ide_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr1
)

2033 
IDESèã
 *
ide_if
 = 
›aque
;

2034 
IDESèã
 *
s
 = 
ide_if
->
cur_drive
;

2035 
uöt32_t
 
addr
;

2036 
ªt
, 
hob
;

2038 
addr
 = 
addr1
 & 7;

2041 
hob
 = 0;

2042 
addr
) {

2044 
ªt
 = 0xff;

2047 i‡(!
ide_if
[0].
bs
 && !ide_if[1].bs)

2048 
ªt
 = 0;

2049 i‡(!
hob
)

2050 
ªt
 = 
s
->
îr‹
;

2052 
ªt
 = 
s
->
hob_„©uª
;

2055 i‡(!
ide_if
[0].
bs
 && !ide_if[1].bs)

2056 
ªt
 = 0;

2057 i‡(!
hob
)

2058 
ªt
 = 
s
->
n£˘‹
 & 0xff;

2060 
ªt
 = 
s
->
hob_n£˘‹
;

2063 i‡(!
ide_if
[0].
bs
 && !ide_if[1].bs)

2064 
ªt
 = 0;

2065 i‡(!
hob
)

2066 
ªt
 = 
s
->
£˘‹
;

2068 
ªt
 = 
s
->
hob_£˘‹
;

2071 i‡(!
ide_if
[0].
bs
 && !ide_if[1].bs)

2072 
ªt
 = 0;

2073 i‡(!
hob
)

2074 
ªt
 = 
s
->
lcyl
;

2076 
ªt
 = 
s
->
hob_lcyl
;

2079 i‡(!
ide_if
[0].
bs
 && !ide_if[1].bs)

2080 
ªt
 = 0;

2081 i‡(!
hob
)

2082 
ªt
 = 
s
->
hcyl
;

2084 
ªt
 = 
s
->
hob_hcyl
;

2087 i‡(!
ide_if
[0].
bs
 && !ide_if[1].bs)

2088 
ªt
 = 0;

2090 
ªt
 = 
s
->
£À˘
;

2094 i‡((!
ide_if
[0].
bs
 && !ide_if[1].bs) ||

2095 (
s
 !
ide_if
 && !s->
bs
))

2096 
ªt
 = 0;

2098 
ªt
 = 
s
->
°©us
;

2099 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 0);

2102 #ifde‡
DEBUG_IDE


2103 
	`¥ötf
("ide:Ñódáddr=0x%x vÆ=%02x\n", 
addr1
, 
ªt
);

2105  
ªt
;

2106 
	}
}

2108 
uöt32_t
 
	$ide_°©us_ªad
(*
›aque
, 
uöt32_t
 
addr
)

2110 
IDESèã
 *
ide_if
 = 
›aque
;

2111 
IDESèã
 *
s
 = 
ide_if
->
cur_drive
;

2112 
ªt
;

2114 i‡((!
ide_if
[0].
bs
 && !ide_if[1].bs) ||

2115 (
s
 !
ide_if
 && !s->
bs
))

2116 
ªt
 = 0;

2118 
ªt
 = 
s
->
°©us
;

2119 #ifde‡
DEBUG_IDE


2120 
	`¥ötf
("ide:Ñód sètu†addr=0x%x vÆ=%02x\n", 
addr
, 
ªt
);

2122  
ªt
;

2123 
	}
}

2125 
	$ide_cmd_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2127 
IDESèã
 *
ide_if
 = 
›aque
;

2128 
IDESèã
 *
s
;

2129 
i
;

2131 #ifde‡
DEBUG_IDE


2132 
	`¥ötf
("ide: wrôêc⁄åﬁáddr=0x%x vÆ=%02x\n", 
addr
, 
vÆ
);

2135 i‡(!(
ide_if
[0].
cmd
 & 
IDE_CMD_RESET
) &&

2136 (
vÆ
 & 
IDE_CMD_RESET
)) {

2138 
i
 = 0;i < 2; i++) {

2139 
s
 = &
ide_if
[
i
];

2140 
s
->
°©us
 = 
BUSY_STAT
 | 
SEEK_STAT
;

2141 
s
->
îr‹
 = 0x01;

2143 } i‡((
ide_if
[0].
cmd
 & 
IDE_CMD_RESET
) &&

2144 !(
vÆ
 & 
IDE_CMD_RESET
)) {

2146 
i
 = 0;i < 2; i++) {

2147 
s
 = &
ide_if
[
i
];

2148 i‡(
s
->
is_cdrom
)

2149 
s
->
°©us
 = 0x00;

2151 
s
->
°©us
 = 
READY_STAT
 | 
SEEK_STAT
;

2152 
	`ide_£t_sig«tuª
(
s
);

2156 
ide_if
[0].
cmd
 = 
vÆ
;

2157 
ide_if
[1].
cmd
 = 
vÆ
;

2158 
	}
}

2160 
	$ide_d©a_wrôew
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2162 
IDESèã
 *
s
 = ((IDESèã *)
›aque
)->
cur_drive
;

2163 
uöt8_t
 *
p
;

2165 
	`buf„ªd_pio_wrôe
(
s
, 
addr
, 2);

2166 
p
 = 
s
->
d©a_±r
;

2167 *(
uöt16_t
 *)
p
 = 
	`À16_to_˝u
(
vÆ
);

2168 
p
 += 2;

2169 
s
->
d©a_±r
 = 
p
;

2170 i‡(
p
 >
s
->
d©a_íd
)

2171 
s
->
	`íd_å™s„r_func
(s);

2172 
	}
}

2174 
uöt32_t
 
	$ide_d©a_ªadw
(*
›aque
, 
uöt32_t
 
addr
)

2176 
IDESèã
 *
s
 = ((IDESèã *)
›aque
)->
cur_drive
;

2177 
uöt8_t
 *
p
;

2178 
ªt
;

2180 
	`buf„ªd_pio_ªad
(
s
, 
addr
, 2);

2181 
p
 = 
s
->
d©a_±r
;

2182 
ªt
 = 
	`˝u_to_À16
(*(
uöt16_t
 *)
p
);

2183 
p
 += 2;

2184 
s
->
d©a_±r
 = 
p
;

2185 i‡(
p
 >
s
->
d©a_íd
)

2186 
s
->
	`íd_å™s„r_func
(s);

2187  
ªt
;

2188 
	}
}

2190 
	$ide_d©a_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2192 
IDESèã
 *
s
 = ((IDESèã *)
›aque
)->
cur_drive
;

2193 
uöt8_t
 *
p
;

2195 
	`buf„ªd_pio_wrôe
(
s
, 
addr
, 4);

2196 
p
 = 
s
->
d©a_±r
;

2197 *(
uöt32_t
 *)
p
 = 
	`À32_to_˝u
(
vÆ
);

2198 
p
 += 4;

2199 
s
->
d©a_±r
 = 
p
;

2200 i‡(
p
 >
s
->
d©a_íd
)

2201 
s
->
	`íd_å™s„r_func
(s);

2202 
	}
}

2204 
uöt32_t
 
	$ide_d©a_ªadl
(*
›aque
, 
uöt32_t
 
addr
)

2206 
IDESèã
 *
s
 = ((IDESèã *)
›aque
)->
cur_drive
;

2207 
uöt8_t
 *
p
;

2208 
ªt
;

2210 
	`buf„ªd_pio_ªad
(
s
, 
addr
, 4);

2211 
p
 = 
s
->
d©a_±r
;

2212 
ªt
 = 
	`˝u_to_À32
(*(
uöt32_t
 *)
p
);

2213 
p
 += 4;

2214 
s
->
d©a_±r
 = 
p
;

2215 i‡(
p
 >
s
->
d©a_íd
)

2216 
s
->
	`íd_å™s„r_func
(s);

2217  
ªt
;

2218 
	}
}

2220 
	$ide_dummy_å™s„r_°›
(
IDESèã
 *
s
)

2222 
s
->
d©a_±r
 = s->
io_buf„r
;

2223 
s
->
d©a_íd
 = s->
io_buf„r
;

2224 
s
->
io_buf„r
[0] = 0xff;

2225 
s
->
io_buf„r
[1] = 0xff;

2226 
s
->
io_buf„r
[2] = 0xff;

2227 
s
->
io_buf„r
[3] = 0xff;

2228 
	}
}

2230 
	$ide_ª£t
(
IDESèã
 *
s
)

2232 
s
->
mu…_£˘‹s
 = 
MAX_MULT_SECTORS
;

2233 
s
->
cur_drive
 = s;

2234 
s
->
£À˘
 = 0xa0;

2235 
s
->
°©us
 = 
READY_STAT
;

2236 
	`ide_£t_sig«tuª
(
s
);

2239 
s
->
íd_å™s„r_func
 = 
ide_dummy_å™s„r_°›
;

2240 
	`ide_dummy_å™s„r_°›
(
s
);

2241 
	}
}

2243 
	s∑πôi⁄
 {

2244 
uöt8_t
 
	mboŸ_öd
;

2245 
uöt8_t
 
	mhód
;

2246 
uöt8_t
 
	m£˘‹
;

2247 
uöt8_t
 
	mcyl
;

2248 
uöt8_t
 
	msys_öd
;

2249 
uöt8_t
 
	míd_hód
;

2250 
uöt8_t
 
	míd_£˘‹
;

2251 
uöt8_t
 
	míd_cyl
;

2252 
uöt32_t
 
	m°¨t_£˘
;

2253 
uöt32_t
 
	mƒ_£˘s
;

2254 } 
__©åibuã__
((
∑cked
));

2257 
	$guess_disk_lchs
(
IDESèã
 *
s
,

2258 *
pcylödîs
, *
phóds
, *
p£˘‹s
)

2260 
uöt8_t
 
buf
[512];

2261 
ªt
, 
i
, 
hóds
, 
£˘‹s
, 
cylödîs
;

2262 
∑πôi⁄
 *
p
;

2263 
uöt32_t
 
ƒ_£˘s
;

2265 
ªt
 = 
	`bdrv_ªad
(
s
->
bs
, 0, 
buf
, 1);

2266 i‡(
ªt
 < 0)

2269 i‡(
buf
[510] != 0x55 || buf[511] != 0xaa)

2271 
i
 = 0; i < 4; i++) {

2272 
p
 = ((
∑πôi⁄
 *)(
buf
 + 0x1be)Ë+ 
i
;

2273 
ƒ_£˘s
 = 
	`À32_to_˝u
(
p
->nr_sects);

2274 i‡(
ƒ_£˘s
 && 
p
->
íd_hód
) {

2277 
hóds
 = 
p
->
íd_hód
 + 1;

2278 
£˘‹s
 = 
p
->
íd_£˘‹
 & 63;

2279 i‡(
£˘‹s
 == 0)

2281 
cylödîs
 = 
s
->
nb_£˘‹s
 / (
hóds
 * 
£˘‹s
);

2282 i‡(
cylödîs
 < 1 || cylinders > 16383)

2284 *
phóds
 = 
hóds
;

2285 *
p£˘‹s
 = 
£˘‹s
;

2286 *
pcylödîs
 = 
cylödîs
;

2288 
	`¥ötf
("guessed geometry: LCHS=%d %d %d\n",

2289 
cylödîs
, 
hóds
, 
£˘‹s
);

2295 
	}
}

2297 
	$ide_öô2
(
IDESèã
 *
ide_°©e
,

2298 
BlockDrivîSèã
 *
hd0
, BlockDrivîSèã *
hd1
,

2299 
SëIRQFunc
 *
£t_úq
, *
úq_›aque
, 
úq
)

2301 
IDESèã
 *
s
;

2302 
drive_£rül
 = 1;

2303 
i
, 
cylödîs
, 
hóds
, 
£cs
, 
å™¶©i⁄
, 
lba_dëe˘ed
 = 0;

2304 
öt64_t
 
nb_£˘‹s
;

2306 
i
 = 0; i < 2; i++) {

2307 
s
 = 
ide_°©e
 + 
i
;

2308 i‡(
i
 == 0)

2309 
s
->
bs
 = 
hd0
;

2311 
s
->
bs
 = 
hd1
;

2312 i‡(
s
->
bs
) {

2313 
	`bdrv_gë_geomëry
(
s
->
bs
, &
nb_£˘‹s
);

2314 
s
->
nb_£˘‹s
 =Çb_sectors;

2316 
	`bdrv_gë_geomëry_höt
(
s
->
bs
, &
cylödîs
, &
hóds
, &
£cs
);

2317 
å™¶©i⁄
 = 
	`bdrv_gë_å™¶©i⁄_höt
(
s
->
bs
);

2318 i‡(
cylödîs
 != 0) {

2319 
s
->
cylödîs
 = cylinders;

2320 
s
->
hóds
 = heads;

2321 
s
->
£˘‹s
 = 
£cs
;

2323 i‡(
	`guess_disk_lchs
(
s
, &
cylödîs
, &
hóds
, &
£cs
) == 0) {

2324 i‡(
hóds
 > 16) {

2328 
lba_dëe˘ed
 = 1;

2329 
deÁu…_geomëry
;

2331 
s
->
cylödîs
 = cylinders;

2332 
s
->
hóds
 = heads;

2333 
s
->
£˘‹s
 = 
£cs
;

2336 i‡(
å™¶©i⁄
 =
BIOS_ATA_TRANSLATION_AUTO
) {

2337 
	`bdrv_£t_å™¶©i⁄_höt
(
s
->
bs
,

2338 
BIOS_ATA_TRANSLATION_NONE
);

2342 
deÁu…_geomëry
:

2344 
cylödîs
 = 
nb_£˘‹s
 / (16 * 63);

2345 i‡(
cylödîs
 > 16383)

2346 
cylödîs
 = 16383;

2347 i‡(
cylödîs
 < 2)

2348 
cylödîs
 = 2;

2349 
s
->
cylödîs
 = cylinders;

2350 
s
->
hóds
 = 16;

2351 
s
->
£˘‹s
 = 63;

2352 i‡((
lba_dëe˘ed
 =1Ë&& (
å™¶©i⁄
 =
BIOS_ATA_TRANSLATION_AUTO
)) {

2353 i‡((
s
->
cylödîs
 * s->
hóds
) <= 131072) {

2354 
	`bdrv_£t_å™¶©i⁄_höt
(
s
->
bs
,

2355 
BIOS_ATA_TRANSLATION_LARGE
);

2357 
	`bdrv_£t_å™¶©i⁄_höt
(
s
->
bs
,

2358 
BIOS_ATA_TRANSLATION_LBA
);

2362 
	`bdrv_£t_geomëry_höt
(
s
->
bs
, s->
cylödîs
, s->
hóds
, s->
£˘‹s
);

2364 i‡(
	`bdrv_gë_ty≥_höt
(
s
->
bs
Ë=
BDRV_TYPE_CDROM
) {

2365 
s
->
is_cdrom
 = 1;

2366 
	`bdrv_£t_ch™ge_cb
(
s
->
bs
, 
cdrom_ch™ge_cb
, s);

2369 
s
->
drive_£rül
 = drive_serial++;

2370 
s
->
£t_úq
 = set_irq;

2371 
s
->
úq_›aque
 = irq_opaque;

2372 
s
->
úq
 = irq;

2373 
s
->
£˘‹_wrôe_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
,

2374 
ide_£˘‹_wrôe_timî_cb
, 
s
);

2375 
s
->
wrôe_ˇche
 = 0;

2376 
	`ide_ª£t
(
s
);

2378 
	}
}

2380 
	$ide_öô_i›‹t
(
IDESèã
 *
ide_°©e
, 
ioba£
, 
ioba£2
)

2382 
	`ªgi°î_i›‹t_wrôe
(
ioba£
, 8, 1, 
ide_i›‹t_wrôe
, 
ide_°©e
);

2383 
	`ªgi°î_i›‹t_ªad
(
ioba£
, 8, 1, 
ide_i›‹t_ªad
, 
ide_°©e
);

2384 i‡(
ioba£2
) {

2385 
	`ªgi°î_i›‹t_ªad
(
ioba£2
, 1, 1, 
ide_°©us_ªad
, 
ide_°©e
);

2386 
	`ªgi°î_i›‹t_wrôe
(
ioba£2
, 1, 1, 
ide_cmd_wrôe
, 
ide_°©e
);

2390 
	`ªgi°î_i›‹t_wrôe
(
ioba£
, 2, 2, 
ide_d©a_wrôew
, 
ide_°©e
);

2391 
	`ªgi°î_i›‹t_ªad
(
ioba£
, 2, 2, 
ide_d©a_ªadw
, 
ide_°©e
);

2392 
	`ªgi°î_i›‹t_wrôe
(
ioba£
, 4, 4, 
ide_d©a_wrôñ
, 
ide_°©e
);

2393 
	`ªgi°î_i›‹t_ªad
(
ioba£
, 4, 4, 
ide_d©a_ªadl
, 
ide_°©e
);

2394 
	}
}

2399 
	$iß_ide_öô
(
ioba£
, 
ioba£2
, 
úq
,

2400 
BlockDrivîSèã
 *
hd0
, BlockDrivîSèã *
hd1
)

2402 
IDESèã
 *
ide_°©e
;

2404 
ide_°©e
 = 
	`qemu_mÆlocz
((
IDESèã
) * 2);

2405 i‡(!
ide_°©e
)

2408 
	`ide_öô2
(
ide_°©e
, 
hd0
, 
hd1
, 
pic_£t_úq_√w
, 
iß_pic
, 
úq
);

2409 
	`ide_öô_i›‹t
(
ide_°©e
, 
ioba£
, 
ioba£2
);

2410 
	}
}

2415 
cmd646_upd©e_úq
(
PCIIDESèã
 *
d
);

2417 
	$ide_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

2418 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

2420 
PCIIDESèã
 *
d
 = (PCIIDESèã *)
pci_dev
;

2421 
IDESèã
 *
ide_°©e
;

2423 i‡(
ªgi⁄_num
 <= 3) {

2424 
ide_°©e
 = &
d
->
ide_if
[(
ªgi⁄_num
 >> 1) * 2];

2425 i‡(
ªgi⁄_num
 & 1) {

2426 
	`ªgi°î_i›‹t_ªad
(
addr
 + 2, 1, 1, 
ide_°©us_ªad
, 
ide_°©e
);

2427 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 2, 1, 1, 
ide_cmd_wrôe
, 
ide_°©e
);

2429 
	`ªgi°î_i›‹t_wrôe
(
addr
, 8, 1, 
ide_i›‹t_wrôe
, 
ide_°©e
);

2430 
	`ªgi°î_i›‹t_ªad
(
addr
, 8, 1, 
ide_i›‹t_ªad
, 
ide_°©e
);

2433 
	`ªgi°î_i›‹t_wrôe
(
addr
, 2, 2, 
ide_d©a_wrôew
, 
ide_°©e
);

2434 
	`ªgi°î_i›‹t_ªad
(
addr
, 2, 2, 
ide_d©a_ªadw
, 
ide_°©e
);

2435 
	`ªgi°î_i›‹t_wrôe
(
addr
, 4, 4, 
ide_d©a_wrôñ
, 
ide_°©e
);

2436 
	`ªgi°î_i›‹t_ªad
(
addr
, 4, 4, 
ide_d©a_ªadl
, 
ide_°©e
);

2439 
	}
}

2441 
	$ide_dma_°¨t
(
IDESèã
 *
s
, 
BlockDrivîCom∂ëi⁄Func
 *
dma_cb
)

2443 
BMDMASèã
 *
bm
 = 
s
->
bmdma
;

2444 if(!
bm
)

2446 
bm
->
ide_if
 = 
s
;

2447 
bm
->
dma_cb
 = dma_cb;

2448 
bm
->
cur_¥d_œ°
 = 0;

2449 
bm
->
cur_¥d_addr
 = 0;

2450 
bm
->
cur_¥d_Àn
 = 0;

2451 i‡(
bm
->
°©us
 & 
BM_STATUS_DMAING
) {

2452 
bm
->
	`dma_cb
(bm, 0);

2454 
	}
}

2456 
	$bmdma_cmd_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2458 
BMDMASèã
 *
bm
 = 
›aque
;

2459 #ifde‡
DEBUG_IDE


2460 
	`¥ötf
("%s: 0x%08x\n", 
__func__
, 
vÆ
);

2462 i‡(!(
vÆ
 & 
BM_CMD_START
)) {

2464 i‡(
bm
->
°©us
 & 
BM_STATUS_DMAING
) {

2465 
bm
->
°©us
 &~
BM_STATUS_DMAING
;

2467 
bm
->
ide_if
 = 
NULL
;

2468 
bm
->
dma_cb
 = 
NULL
;

2469 i‡(
bm
->
aiocb
) {

2470 #ifde‡
DEBUG_AIO


2471 
	`¥ötf
("aio_cancel\n");

2473 
	`bdrv_aio_ˇn˚l
(
bm
->
aiocb
);

2474 
bm
->
aiocb
 = 
NULL
;

2477 
bm
->
cmd
 = 
vÆ
 & 0x09;

2479 i‡(!(
bm
->
°©us
 & 
BM_STATUS_DMAING
)) {

2480 
bm
->
°©us
 |
BM_STATUS_DMAING
;

2482 i‡(
bm
->
dma_cb
)

2483 
bm
->
	`dma_cb
(bm, 0);

2485 
bm
->
cmd
 = 
vÆ
 & 0x09;

2487 
	}
}

2489 
uöt32_t
 
	$bmdma_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

2491 
BMDMASèã
 *
bm
 = 
›aque
;

2492 
PCIIDESèã
 *
pci_dev
;

2493 
uöt32_t
 
vÆ
;

2495 
addr
 & 3) {

2497 
vÆ
 = 
bm
->
cmd
;

2500 
pci_dev
 = 
bm
->pci_dev;

2501 i‡(
pci_dev
->
ty≥
 =
IDE_TYPE_CMD646
) {

2502 
vÆ
 = 
pci_dev
->
dev
.
c⁄fig
[
MRDMODE
];

2504 
vÆ
 = 0xff;

2508 
vÆ
 = 
bm
->
°©us
;

2511 
pci_dev
 = 
bm
->pci_dev;

2512 i‡(
pci_dev
->
ty≥
 =
IDE_TYPE_CMD646
) {

2513 i‡(
bm
 =&
pci_dev
->
bmdma
[0])

2514 
vÆ
 = 
pci_dev
->
dev
.
c⁄fig
[
UDIDETCR0
];

2516 
vÆ
 = 
pci_dev
->
dev
.
c⁄fig
[
UDIDETCR1
];

2518 
vÆ
 = 0xff;

2522 
vÆ
 = 0xff;

2525 #ifde‡
DEBUG_IDE


2526 
	`¥ötf
("bmdma:Ñódb 0x%02x : 0x%02x\n", 
addr
, 
vÆ
);

2528  
vÆ
;

2529 
	}
}

2531 
	$bmdma_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2533 
BMDMASèã
 *
bm
 = 
›aque
;

2534 
PCIIDESèã
 *
pci_dev
;

2535 #ifde‡
DEBUG_IDE


2536 
	`¥ötf
("bmdma: wrôeb 0x%02x : 0x%02x\n", 
addr
, 
vÆ
);

2538 
addr
 & 3) {

2540 
pci_dev
 = 
bm
->pci_dev;

2541 i‡(
pci_dev
->
ty≥
 =
IDE_TYPE_CMD646
) {

2542 
pci_dev
->
dev
.
c⁄fig
[
MRDMODE
] =

2543 (
pci_dev
->
dev
.
c⁄fig
[
MRDMODE
] & ~0x30Ë| (
vÆ
 & 0x30);

2544 
	`cmd646_upd©e_úq
(
pci_dev
);

2548 
bm
->
°©us
 = (
vÆ
 & 0x60) | (bm->status & 1) | (bm->status & ~val & 0x06);

2551 
pci_dev
 = 
bm
->pci_dev;

2552 i‡(
pci_dev
->
ty≥
 =
IDE_TYPE_CMD646
) {

2553 i‡(
bm
 =&
pci_dev
->
bmdma
[0])

2554 
pci_dev
->
dev
.
c⁄fig
[
UDIDETCR0
] = 
vÆ
;

2556 
pci_dev
->
dev
.
c⁄fig
[
UDIDETCR1
] = 
vÆ
;

2560 
	}
}

2562 
uöt32_t
 
	$bmdma_addr_ªadl
(*
›aque
, 
uöt32_t
 
addr
)

2564 
BMDMASèã
 *
bm
 = 
›aque
;

2565 
uöt32_t
 
vÆ
;

2566 
vÆ
 = 
bm
->
addr
;

2567 #ifde‡
DEBUG_IDE


2568 
	`¥ötf
("%s: 0x%08x\n", 
__func__
, 
vÆ
);

2570  
vÆ
;

2571 
	}
}

2573 
	$bmdma_addr_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

2575 
BMDMASèã
 *
bm
 = 
›aque
;

2576 #ifde‡
DEBUG_IDE


2577 
	`¥ötf
("%s: 0x%08x\n", 
__func__
, 
vÆ
);

2579 
bm
->
addr
 = 
vÆ
 & ~3;

2580 
bm
->
cur_addr
 = bm->
addr
;

2581 
	}
}

2583 
	$bmdma_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

2584 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

2586 
PCIIDESèã
 *
d
 = (PCIIDESèã *)
pci_dev
;

2587 
i
;

2589 
i
 = 0;i < 2; i++) {

2590 
BMDMASèã
 *
bm
 = &
d
->
bmdma
[
i
];

2591 
d
->
ide_if
[2 * 
i
].
bmdma
 = 
bm
;

2592 
d
->
ide_if
[2 * 
i
 + 1].
bmdma
 = 
bm
;

2593 
bm
->
pci_dev
 = (
PCIIDESèã
 *)pci_dev;

2595 
	`ªgi°î_i›‹t_wrôe
(
addr
, 1, 1, 
bmdma_cmd_wrôeb
, 
bm
);

2597 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 1, 3, 1, 
bmdma_wrôeb
, 
bm
);

2598 
	`ªgi°î_i›‹t_ªad
(
addr
, 4, 1, 
bmdma_ªadb
, 
bm
);

2600 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 4, 4, 4, 
bmdma_addr_wrôñ
, 
bm
);

2601 
	`ªgi°î_i›‹t_ªad
(
addr
 + 4, 4, 4, 
bmdma_addr_ªadl
, 
bm
);

2602 
addr
 += 8;

2604 
	}
}

2608 
	$cmd646_upd©e_úq
(
PCIIDESèã
 *
d
)

2610 
pci_Àvñ
;

2611 
pci_Àvñ
 = ((
d
->
dev
.
c⁄fig
[
MRDMODE
] & 
MRDMODE_INTR_CH0
) &&

2612 !(
d
->
dev
.
c⁄fig
[
MRDMODE
] & 
MRDMODE_BLK_CH0
)) ||

2613 ((
d
->
dev
.
c⁄fig
[
MRDMODE
] & 
MRDMODE_INTR_CH1
) &&

2614 !(
d
->
dev
.
c⁄fig
[
MRDMODE
] & 
MRDMODE_BLK_CH1
));

2615 
	`pci_£t_úq
((
PCIDevi˚
 *)
d
, 0, 
pci_Àvñ
);

2616 
	}
}

2619 
	$cmd646_£t_úq
(*
›aque
, 
ch™√l
, 
Àvñ
)

2621 
PCIIDESèã
 *
d
 = 
›aque
;

2622 
úq_mask
;

2624 
úq_mask
 = 
MRDMODE_INTR_CH0
 << 
ch™√l
;

2625 i‡(
Àvñ
)

2626 
d
->
dev
.
c⁄fig
[
MRDMODE
] |
úq_mask
;

2628 
d
->
dev
.
c⁄fig
[
MRDMODE
] &~
úq_mask
;

2629 
	`cmd646_upd©e_úq
(
d
);

2630 
	}
}

2633 
	$pci_cmd646_ide_öô
(
PCIBus
 *
bus
, 
BlockDrivîSèã
 **
hd_èbÀ
,

2634 
£c⁄d¨y_ide_íabÀd
)

2636 
PCIIDESèã
 *
d
;

2637 
uöt8_t
 *
pci_c⁄f
;

2638 
i
;

2640 
d
 = (
PCIIDESèã
 *)
	`pci_ªgi°î_devi˚
(
bus
, "CMD646 IDE",

2641 (
PCIIDESèã
),

2643 
NULL
, NULL);

2644 
d
->
ty≥
 = 
IDE_TYPE_CMD646
;

2645 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

2646 
pci_c⁄f
[0x00] = 0x95;

2647 
pci_c⁄f
[0x01] = 0x10;

2648 
pci_c⁄f
[0x02] = 0x46;

2649 
pci_c⁄f
[0x03] = 0x06;

2651 
pci_c⁄f
[0x08] = 0x07;

2652 
pci_c⁄f
[0x09] = 0x8f;

2654 
pci_c⁄f
[0x0a] = 0x01;

2655 
pci_c⁄f
[0x0b] = 0x01;

2656 
pci_c⁄f
[0x0e] = 0x00;

2658 i‡(
£c⁄d¨y_ide_íabÀd
) {

2660 
pci_c⁄f
[0x51] = 0x80;

2663 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 0, 0x8,

2664 
PCI_ADDRESS_SPACE_IO
, 
ide_m≠
);

2665 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 1, 0x4,

2666 
PCI_ADDRESS_SPACE_IO
, 
ide_m≠
);

2667 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 2, 0x8,

2668 
PCI_ADDRESS_SPACE_IO
, 
ide_m≠
);

2669 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 3, 0x4,

2670 
PCI_ADDRESS_SPACE_IO
, 
ide_m≠
);

2671 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 4, 0x10,

2672 
PCI_ADDRESS_SPACE_IO
, 
bmdma_m≠
);

2674 
pci_c⁄f
[0x3d] = 0x01;

2676 
i
 = 0; i < 4; i++)

2677 
d
->
ide_if
[
i
].
pci_dev
 = (
PCIDevi˚
 *)d;

2678 
	`ide_öô2
(&
d
->
ide_if
[0], 
hd_èbÀ
[0], hd_table[1],

2679 
cmd646_£t_úq
, 
d
, 0);

2680 
	`ide_öô2
(&
d
->
ide_if
[2], 
hd_èbÀ
[2], hd_table[3],

2681 
cmd646_£t_úq
, 
d
, 1);

2682 
	}
}

2684 
	$pci_ide_ßve
(
QEMUFûe
* 
f
, *
›aque
)

2686 
PCIIDESèã
 *
d
 = 
›aque
;

2687 
i
;

2689 
	`pci_devi˚_ßve
(&
d
->
dev
, 
f
);

2691 
i
 = 0; i < 2; i++) {

2692 
BMDMASèã
 *
bm
 = &
d
->
bmdma
[
i
];

2693 
	`qemu_put_8s
(
f
, &
bm
->
cmd
);

2694 
	`qemu_put_8s
(
f
, &
bm
->
°©us
);

2695 
	`qemu_put_be32s
(
f
, &
bm
->
addr
);

2700 
i
 = 0; i < 2; i++) {

2701 
IDESèã
 *
s
 = &
d
->
ide_if
[
i
 * 2];

2702 
uöt8_t
 
drive1_£À˘ed
;

2703 
	`qemu_put_8s
(
f
, &
s
->
cmd
);

2704 
drive1_£À˘ed
 = (
s
->
cur_drive
 != s);

2705 
	`qemu_put_8s
(
f
, &
drive1_£À˘ed
);

2709 
i
 = 0; i < 4; i++) {

2710 
IDESèã
 *
s
 = &
d
->
ide_if
[
i
];

2711 
	`qemu_put_be32s
(
f
, &
s
->
mu…_£˘‹s
);

2712 
	`qemu_put_be32s
(
f
, &
s
->
idítify_£t
);

2713 i‡(
s
->
idítify_£t
) {

2714 
	`qemu_put_buf„r
(
f
, (c⁄° 
uöt8_t
 *)
s
->
idítify_d©a
, 512);

2716 
	`qemu_put_8s
(
f
, &
s
->
„©uª
);

2717 
	`qemu_put_8s
(
f
, &
s
->
îr‹
);

2718 
	`qemu_put_be32s
(
f
, &
s
->
n£˘‹
);

2719 
	`qemu_put_8s
(
f
, &
s
->
£˘‹
);

2720 
	`qemu_put_8s
(
f
, &
s
->
lcyl
);

2721 
	`qemu_put_8s
(
f
, &
s
->
hcyl
);

2722 
	`qemu_put_8s
(
f
, &
s
->
hob_„©uª
);

2723 
	`qemu_put_8s
(
f
, &
s
->
hob_n£˘‹
);

2724 
	`qemu_put_8s
(
f
, &
s
->
hob_£˘‹
);

2725 
	`qemu_put_8s
(
f
, &
s
->
hob_lcyl
);

2726 
	`qemu_put_8s
(
f
, &
s
->
hob_hcyl
);

2727 
	`qemu_put_8s
(
f
, &
s
->
£À˘
);

2728 
	`qemu_put_8s
(
f
, &
s
->
°©us
);

2729 
	`qemu_put_8s
(
f
, &
s
->
lba48
);

2731 
	`qemu_put_8s
(
f
, &
s
->
£n£_key
);

2732 
	`qemu_put_8s
(
f
, &
s
->
asc
);

2735 
	}
}

2737 
	$pci_ide_lﬂd
(
QEMUFûe
* 
f
, *
›aque
, 
vîsi⁄_id
)

2739 
PCIIDESèã
 *
d
 = 
›aque
;

2740 
ªt
, 
i
;

2742 i‡(
vîsi⁄_id
 != 1)

2743  -
EINVAL
;

2744 
ªt
 = 
	`pci_devi˚_lﬂd
(&
d
->
dev
, 
f
);

2745 i‡(
ªt
 < 0)

2746  
ªt
;

2748 
i
 = 0; i < 2; i++) {

2749 
BMDMASèã
 *
bm
 = &
d
->
bmdma
[
i
];

2750 
	`qemu_gë_8s
(
f
, &
bm
->
cmd
);

2751 
	`qemu_gë_8s
(
f
, &
bm
->
°©us
);

2752 
	`qemu_gë_be32s
(
f
, &
bm
->
addr
);

2757 
i
 = 0; i < 2; i++) {

2758 
IDESèã
 *
s
 = &
d
->
ide_if
[
i
 * 2];

2759 
uöt8_t
 
drive1_£À˘ed
;

2760 
	`qemu_gë_8s
(
f
, &
s
->
cmd
);

2761 
	`qemu_gë_8s
(
f
, &
drive1_£À˘ed
);

2762 
s
->
cur_drive
 = &
d
->
ide_if
[
i
 * 2 + (
drive1_£À˘ed
 != 0)];

2766 
i
 = 0; i < 4; i++) {

2767 
IDESèã
 *
s
 = &
d
->
ide_if
[
i
];

2768 
	`qemu_gë_be32s
(
f
, &
s
->
mu…_£˘‹s
);

2769 
	`qemu_gë_be32s
(
f
, &
s
->
idítify_£t
);

2770 i‡(
s
->
idítify_£t
) {

2771 
	`qemu_gë_buf„r
(
f
, (
uöt8_t
 *)
s
->
idítify_d©a
, 512);

2773 
	`qemu_gë_8s
(
f
, &
s
->
„©uª
);

2774 
	`qemu_gë_8s
(
f
, &
s
->
îr‹
);

2775 
	`qemu_gë_be32s
(
f
, &
s
->
n£˘‹
);

2776 
	`qemu_gë_8s
(
f
, &
s
->
£˘‹
);

2777 
	`qemu_gë_8s
(
f
, &
s
->
lcyl
);

2778 
	`qemu_gë_8s
(
f
, &
s
->
hcyl
);

2779 
	`qemu_gë_8s
(
f
, &
s
->
hob_„©uª
);

2780 
	`qemu_gë_8s
(
f
, &
s
->
hob_n£˘‹
);

2781 
	`qemu_gë_8s
(
f
, &
s
->
hob_£˘‹
);

2782 
	`qemu_gë_8s
(
f
, &
s
->
hob_lcyl
);

2783 
	`qemu_gë_8s
(
f
, &
s
->
hob_hcyl
);

2784 
	`qemu_gë_8s
(
f
, &
s
->
£À˘
);

2785 
	`qemu_gë_8s
(
f
, &
s
->
°©us
);

2786 
	`qemu_gë_8s
(
f
, &
s
->
lba48
);

2788 
	`qemu_gë_8s
(
f
, &
s
->
£n£_key
);

2789 
	`qemu_gë_8s
(
f
, &
s
->
asc
);

2793 
	}
}

2795 
	$piix3_ª£t
(
PCIIDESèã
 *
d
)

2797 
uöt8_t
 *
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

2799 
pci_c⁄f
[0x04] = 0x00;

2800 
pci_c⁄f
[0x05] = 0x00;

2801 
pci_c⁄f
[0x06] = 0x80;

2802 
pci_c⁄f
[0x07] = 0x02;

2803 
pci_c⁄f
[0x20] = 0x01;

2804 
	}
}

2806 
	$pci_piix_ide_öô
(
PCIBus
 *
bus
, 
BlockDrivîSèã
 **
hd_èbÀ
, 
dev‚
)

2808 
PCIIDESèã
 *
d
;

2809 
uöt8_t
 *
pci_c⁄f
;

2812 
d
 = (
PCIIDESèã
 *)
	`pci_ªgi°î_devi˚
(
bus
, "PIIX IDE",

2813 (
PCIIDESèã
),

2814 
dev‚
,

2815 
NULL
, NULL);

2816 
d
->
ty≥
 = 
IDE_TYPE_PIIX3
;

2818 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

2819 
pci_c⁄f
[0x00] = 0x86;

2820 
pci_c⁄f
[0x01] = 0x80;

2821 
pci_c⁄f
[0x02] = 0x30;

2822 
pci_c⁄f
[0x03] = 0x12;

2823 
pci_c⁄f
[0x08] = 0x02;

2824 
pci_c⁄f
[0x09] = 0x80;

2825 
pci_c⁄f
[0x0a] = 0x01;

2826 
pci_c⁄f
[0x0b] = 0x01;

2827 
pci_c⁄f
[0x0e] = 0x00;

2828 
pci_c⁄f
[0x2c] = 0x53;

2829 
pci_c⁄f
[0x2d] = 0x58;

2830 
pci_c⁄f
[0x2e] = 0x01;

2831 
pci_c⁄f
[0x2f] = 0x00;

2833 
	`piix3_ª£t
(
d
);

2835 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 4, 0x10,

2836 
PCI_ADDRESS_SPACE_IO
, 
bmdma_m≠
);

2838 
	`ide_öô2
(&
d
->
ide_if
[0], 
hd_èbÀ
[0], hd_table[1],

2839 
pic_£t_úq_√w
, 
iß_pic
, 14);

2840 
	`ide_öô2
(&
d
->
ide_if
[2], 
hd_èbÀ
[2], hd_table[3],

2841 
pic_£t_úq_√w
, 
iß_pic
, 15);

2842 
	`ide_öô_i›‹t
(&
d
->
ide_if
[0], 0x1f0, 0x3f6);

2843 
	`ide_öô_i›‹t
(&
d
->
ide_if
[2], 0x170, 0x376);

2845 
	`buf„ªd_pio_öô
();

2847 
	`ªgi°î_ßvevm
("ide", 0, 1, 
pci_ide_ßve
, 
pci_ide_lﬂd
, 
d
);

2848 
	}
}

2852 
	$pci_piix3_ide_öô
(
PCIBus
 *
bus
, 
BlockDrivîSèã
 **
hd_èbÀ
, 
dev‚
)

2854 
PCIIDESèã
 *
d
;

2855 
uöt8_t
 *
pci_c⁄f
;

2858 
d
 = (
PCIIDESèã
 *)
	`pci_ªgi°î_devi˚
(
bus
, "PIIX3 IDE",

2859 (
PCIIDESèã
),

2860 
dev‚
,

2861 
NULL
, NULL);

2862 
d
->
ty≥
 = 
IDE_TYPE_PIIX3
;

2864 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

2865 
pci_c⁄f
[0x00] = 0x86;

2866 
pci_c⁄f
[0x01] = 0x80;

2867 
pci_c⁄f
[0x02] = 0x10;

2868 
pci_c⁄f
[0x03] = 0x70;

2869 
pci_c⁄f
[0x09] = 0x80;

2870 
pci_c⁄f
[0x0a] = 0x01;

2871 
pci_c⁄f
[0x0b] = 0x01;

2872 
pci_c⁄f
[0x0e] = 0x00;

2874 
	`piix3_ª£t
(
d
);

2876 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 4, 0x10,

2877 
PCI_ADDRESS_SPACE_IO
, 
bmdma_m≠
);

2879 
	`ide_öô2
(&
d
->
ide_if
[0], 
hd_èbÀ
[0], hd_table[1],

2880 
pic_£t_úq_√w
, 
iß_pic
, 14);

2881 
	`ide_öô2
(&
d
->
ide_if
[2], 
hd_èbÀ
[2], hd_table[3],

2882 
pic_£t_úq_√w
, 
iß_pic
, 15);

2883 
	`ide_öô_i›‹t
(&
d
->
ide_if
[0], 0x1f0, 0x3f6);

2884 
	`ide_öô_i›‹t
(&
d
->
ide_if
[2], 0x170, 0x376);

2886 
	`buf„ªd_pio_öô
();

2888 
	`ªgi°î_ßvevm
("ide", 0, 1, 
pci_ide_ßve
, 
pci_ide_lﬂd
, 
d
);

2889 
	}
}

2895 
	$pmac_ide_wrôeb
 (*
›aque
,

2896 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

2898 
addr
 = (addr & 0xFFF) >> 4;

2899 
addr
) {

2901 
	`ide_i›‹t_wrôe
(
›aque
, 
addr
, 
vÆ
);

2905 
	`ide_cmd_wrôe
(
›aque
, 0, 
vÆ
);

2910 
	}
}

2912 
uöt32_t
 
	$pmac_ide_ªadb
 (*
›aque
,
èrgë_phys_addr_t
 
addr
)

2914 
uöt8_t
 
ªtvÆ
;

2916 
addr
 = (addr & 0xFFF) >> 4;

2917 
addr
) {

2919 
ªtvÆ
 = 
	`ide_i›‹t_ªad
(
›aque
, 
addr
);

2923 
ªtvÆ
 = 
	`ide_°©us_ªad
(
›aque
, 0);

2926 
ªtvÆ
 = 0xFF;

2929  
ªtvÆ
;

2930 
	}
}

2932 
	$pmac_ide_wrôew
 (*
›aque
,

2933 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

2935 
addr
 = (addr & 0xFFF) >> 4;

2936 #ifde‡
TARGET_WORDS_BIGENDIAN


2937 
vÆ
 = 
	`bsw≠16
(val);

2939 i‡(
addr
 == 0) {

2940 
	`ide_d©a_wrôew
(
›aque
, 0, 
vÆ
);

2942 
	}
}

2944 
uöt32_t
 
	$pmac_ide_ªadw
 (*
›aque
,
èrgë_phys_addr_t
 
addr
)

2946 
uöt16_t
 
ªtvÆ
;

2948 
addr
 = (addr & 0xFFF) >> 4;

2949 i‡(
addr
 == 0) {

2950 
ªtvÆ
 = 
	`ide_d©a_ªadw
(
›aque
, 0);

2952 
ªtvÆ
 = 0xFFFF;

2954 #ifde‡
TARGET_WORDS_BIGENDIAN


2955 
ªtvÆ
 = 
	`bsw≠16
(retval);

2957  
ªtvÆ
;

2958 
	}
}

2960 
	$pmac_ide_wrôñ
 (*
›aque
,

2961 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

2963 
addr
 = (addr & 0xFFF) >> 4;

2964 #ifde‡
TARGET_WORDS_BIGENDIAN


2965 
vÆ
 = 
	`bsw≠32
(val);

2967 i‡(
addr
 == 0) {

2968 
	`ide_d©a_wrôñ
(
›aque
, 0, 
vÆ
);

2970 
	}
}

2972 
uöt32_t
 
	$pmac_ide_ªadl
 (*
›aque
,
èrgë_phys_addr_t
 
addr
)

2974 
uöt32_t
 
ªtvÆ
;

2976 
addr
 = (addr & 0xFFF) >> 4;

2977 i‡(
addr
 == 0) {

2978 
ªtvÆ
 = 
	`ide_d©a_ªadl
(
›aque
, 0);

2980 
ªtvÆ
 = 0xFFFFFFFF;

2982 #ifde‡
TARGET_WORDS_BIGENDIAN


2983 
ªtvÆ
 = 
	`bsw≠32
(retval);

2985  
ªtvÆ
;

2986 
	}
}

2988 
CPUWrôeMem‹yFunc
 *
	gpmac_ide_wrôe
[] = {

2989 
pmac_ide_wrôeb
,

2990 
pmac_ide_wrôew
,

2991 
pmac_ide_wrôñ
,

2994 
CPURódMem‹yFunc
 *
	gpmac_ide_ªad
[] = {

2995 
pmac_ide_ªadb
,

2996 
pmac_ide_ªadw
,

2997 
pmac_ide_ªadl
,

3003 
	$pmac_ide_öô
 (
BlockDrivîSèã
 **
hd_èbÀ
,

3004 
SëIRQFunc
 *
£t_úq
, *
úq_›aque
, 
úq
)

3006 
IDESèã
 *
ide_if
;

3007 
pmac_ide_mem‹y
;

3009 
ide_if
 = 
	`qemu_mÆlocz
((
IDESèã
) * 2);

3010 
	`ide_öô2
(&
ide_if
[0], 
hd_èbÀ
[0], hd_table[1],

3011 
£t_úq
, 
úq_›aque
, 
úq
);

3013 
pmac_ide_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pmac_ide_ªad
,

3014 
pmac_ide_wrôe
, &
ide_if
[0]);

3015  
pmac_ide_mem‹y
;

3016 
	}
}

	@integratorcp.c

10 
	~"vl.h
"

11 
	~"¨m_pic.h
"

13 
	$DMA_run
 ()

15 
	}
}

18 
uöt32_t
 
	mÊash_off£t
;

19 
uöt32_t
 
	mcm_osc
;

20 
uöt32_t
 
	mcm_˘æ
;

21 
uöt32_t
 
	mcm_lock
;

22 
uöt32_t
 
	mcm_auxosc
;

23 
uöt32_t
 
	mcm_sdøm
;

24 
uöt32_t
 
	mcm_öô
;

25 
uöt32_t
 
	mcm_Êags
;

26 
uöt32_t
 
	mcm_nvÊags
;

27 
uöt32_t
 
	möt_Àvñ
;

28 
uöt32_t
 
	múq_íabÀd
;

29 
uöt32_t
 
	mfiq_íabÀd
;

30 } 
	töãgøt‹cm_°©e
;

32 
uöt8_t
 
	göãgøt‹_•d
[128] = {

37 
uöt32_t
 
	$öãgøt‹cm_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

39 
öãgøt‹cm_°©e
 *
s
 = (öãgøt‹cm_°©ê*)
›aque
;

40 
off£t
 -= 0x10000000;

41 i‡(
off£t
 >= 0x100 && offset < 0x200) {

43 i‡(
off£t
 >= 0x180)

45  
öãgøt‹_•d
[
off£t
 >> 2];

47 
off£t
 >> 2) {

53  
s
->
cm_osc
;

55  
s
->
cm_˘æ
;

59 i‡(
s
->
cm_lock
 == 0xa05f) {

62  
s
->
cm_lock
;

66 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "integratorcm_read: CM_LMBUSCNT");

68  
s
->
cm_auxosc
;

70  
s
->
cm_sdøm
;

72  
s
->
cm_öô
;

75 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "integratorcm_read: CM_REFCT");

77  
s
->
cm_Êags
;

79  
s
->
cm_nvÊags
;

81  
s
->
öt_Àvñ
 & s->
úq_íabÀd
;

83  
s
->
öt_Àvñ
;

85  
s
->
úq_íabÀd
;

87  
s
->
öt_Àvñ
 & 1;

89  
s
->
öt_Àvñ
 & s->
fiq_íabÀd
;

91  
s
->
öt_Àvñ
;

93  
s
->
fiq_íabÀd
;

101 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
,

102 "öãgøt‹cm_ªad: Unim∂emíãd off£à0x%x\n", 
off£t
);

105 
	}
}

107 
	$öãgøt‹cm_do_ªm≠
(
öãgøt‹cm_°©e
 *
s
, 
Êash
)

109 i‡(
Êash
) {

110 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 0x100000, 
IO_MEM_RAM
);

112 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 0x100000, 
s
->
Êash_off£t
 | 
IO_MEM_RAM
);

115 
	}
}

117 
	$öãgøt‹cm_£t_˘æ
(
öãgøt‹cm_°©e
 *
s
, 
uöt32_t
 
vÆue
)

119 i‡(
vÆue
 & 8) {

120 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "BoardÑeset\n");

122 i‡((
s
->
cm_öô
 ^ 
vÆue
) & 4) {

123 
	`öãgøt‹cm_do_ªm≠
(
s
, (
vÆue
 & 4) == 0);

125 i‡((
s
->
cm_öô
 ^ 
vÆue
) & 1) {

126 
	`¥ötf
("Gªí LED %s\n", (
vÆue
 & 1) ? "on" : "off");

128 
s
->
cm_öô
 = (s->cm_öô & ~ 5Ë| (
vÆue
 ^ 5);

129 
	}
}

131 
	$öãgøt‹cm_upd©e
(
öãgøt‹cm_°©e
 *
s
)

135 i‡(
s
->
öt_Àvñ
 & (s->
úq_íabÀd
 | s->
fiq_íabÀd
))

136 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "Core module interrupt\n");

137 
	}
}

139 
	$öãgøt‹cm_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

140 
uöt32_t
 
vÆue
)

142 
öãgøt‹cm_°©e
 *
s
 = (öãgøt‹cm_°©ê*)
›aque
;

143 
off£t
 -= 0x10000000;

144 
off£t
 >> 2) {

146 i‡(
s
->
cm_lock
 == 0xa05f)

147 
s
->
cm_osc
 = 
vÆue
;

150 
	`öãgøt‹cm_£t_˘æ
(
s
, 
vÆue
);

153 
s
->
cm_lock
 = 
vÆue
 & 0xffff;

156 i‡(
s
->
cm_lock
 == 0xa05f)

157 
s
->
cm_auxosc
 = 
vÆue
;

160 
s
->
cm_sdøm
 = 
vÆue
;

164 
s
->
cm_öô
 = 
vÆue
;

167 
s
->
cm_Êags
 |
vÆue
;

170 
s
->
cm_Êags
 &~
vÆue
;

173 
s
->
cm_nvÊags
 |
vÆue
;

176 
s
->
cm_nvÊags
 &~
vÆue
;

179 
s
->
úq_íabÀd
 |
vÆue
;

180 
	`öãgøt‹cm_upd©e
(
s
);

183 
s
->
úq_íabÀd
 &~
vÆue
;

184 
	`öãgøt‹cm_upd©e
(
s
);

187 
s
->
öt_Àvñ
 |(
vÆue
 & 1);

188 
	`öãgøt‹cm_upd©e
(
s
);

191 
s
->
öt_Àvñ
 &~(
vÆue
 & 1);

192 
	`öãgøt‹cm_upd©e
(
s
);

195 
s
->
fiq_íabÀd
 |
vÆue
;

196 
	`öãgøt‹cm_upd©e
(
s
);

199 
s
->
fiq_íabÀd
 &~
vÆue
;

200 
	`öãgøt‹cm_upd©e
(
s
);

209 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
,

210 "öãgøt‹cm_wrôe: Unim∂emíãd off£à0x%x\n", 
off£t
);

213 
	}
}

217 
CPURódMem‹yFunc
 *
	göãgøt‹cm_ªad‚
[] = {

218 
öãgøt‹cm_ªad
,

219 
öãgøt‹cm_ªad
,

220 
öãgøt‹cm_ªad


223 
CPUWrôeMem‹yFunc
 *
	göãgøt‹cm_wrôe‚
[] = {

224 
öãgøt‹cm_wrôe
,

225 
öãgøt‹cm_wrôe
,

226 
öãgøt‹cm_wrôe


229 
	$öãgøt‹cm_öô
(
memsz
, 
uöt32_t
 
Êash_off£t
)

231 
iomemty≥
;

232 
öãgøt‹cm_°©e
 *
s
;

234 
s
 = (
öãgøt‹cm_°©e
 *)
	`qemu_mÆlocz
((integratorcm_state));

235 
s
->
cm_osc
 = 0x01000048;

237 
s
->
cm_auxosc
 = 0x0007feff;

238 
s
->
cm_sdøm
 = 0x00011122;

239 i‡(
memsz
 >= 256) {

240 
öãgøt‹_•d
[31] = 64;

241 
s
->
cm_sdøm
 |= 0x10;

242 } i‡(
memsz
 >= 128) {

243 
öãgøt‹_•d
[31] = 32;

244 
s
->
cm_sdøm
 |= 0x0c;

245 } i‡(
memsz
 >= 64) {

246 
öãgøt‹_•d
[31] = 16;

247 
s
->
cm_sdøm
 |= 0x08;

248 } i‡(
memsz
 >= 32) {

249 
öãgøt‹_•d
[31] = 4;

250 
s
->
cm_sdøm
 |= 0x04;

252 
öãgøt‹_•d
[31] = 2;

254 
	`mem˝y
(
öãgøt‹_•d
 + 73, "QEMU-MEMORY", 11);

255 
s
->
cm_öô
 = 0x00000112;

256 
s
->
Êash_off£t
 = flash_offset;

258 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
öãgøt‹cm_ªad‚
,

259 
öãgøt‹cm_wrôe‚
, 
s
);

260 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x10000000, 0x007fffff, 
iomemty≥
);

261 
	`öãgøt‹cm_do_ªm≠
(
s
, 1);

263 
	}
}

268 
	si˝_pic_°©e


270 
¨m_pic_h™dÀr
 
	mh™dÀr
;

271 
uöt32_t
 
	mba£
;

272 
uöt32_t
 
	mÀvñ
;

273 
uöt32_t
 
	múq_íabÀd
;

274 
uöt32_t
 
	mfiq_íabÀd
;

275 *
	m∑ª¡
;

276 
	m∑ª¡_úq
;

277 
	m∑ª¡_fiq
;

278 } 
	ti˝_pic_°©e
;

280 
	$i˝_pic_upd©e
(
i˝_pic_°©e
 *
s
)

282 
uöt32_t
 
Êags
;

284 i‡(
s
->
∑ª¡_úq
 != -1) {

285 
Êags
 = (
s
->
Àvñ
 & s->
úq_íabÀd
);

286 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
∑ª¡_úq
, 
Êags
 != 0);

288 i‡(
s
->
∑ª¡_fiq
 != -1) {

289 
Êags
 = (
s
->
Àvñ
 & s->
fiq_íabÀd
);

290 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
∑ª¡_fiq
, 
Êags
 != 0);

292 
	}
}

294 
	$i˝_pic_£t_úq
(*
›aque
, 
úq
, 
Àvñ
)

296 
i˝_pic_°©e
 *
s
 = (i˝_pic_°©ê*)
›aque
;

297 i‡(
Àvñ
)

298 
s
->
Àvñ
 |1 << 
úq
;

300 
s
->
Àvñ
 &~(1 << 
úq
);

301 
	`i˝_pic_upd©e
(
s
);

302 
	}
}

304 
uöt32_t
 
	$i˝_pic_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

306 
i˝_pic_°©e
 *
s
 = (i˝_pic_°©ê*)
›aque
;

308 
off£t
 -
s
->
ba£
;

309 
off£t
 >> 2) {

311  
s
->
Àvñ
 & s->
úq_íabÀd
;

313  
s
->
Àvñ
;

315  
s
->
úq_íabÀd
;

317  
s
->
Àvñ
 & 1;

319  
s
->
Àvñ
 & s->
fiq_íabÀd
;

321  
s
->
Àvñ
;

323  
s
->
fiq_íabÀd
;

328 
	`¥ötf
 ("i˝_pic_ªad: BadÑegi°î off£à0x%x\n", ()
off£t
);

331 
	}
}

333 
	$i˝_pic_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

334 
uöt32_t
 
vÆue
)

336 
i˝_pic_°©e
 *
s
 = (i˝_pic_°©ê*)
›aque
;

337 
off£t
 -
s
->
ba£
;

339 
off£t
 >> 2) {

341 
s
->
úq_íabÀd
 |
vÆue
;

344 
s
->
úq_íabÀd
 &~
vÆue
;

347 i‡(
vÆue
 & 1)

348 
	`pic_£t_úq_√w
(
s
, 0, 1);

351 i‡(
vÆue
 & 1)

352 
	`pic_£t_úq_√w
(
s
, 0, 0);

355 
s
->
fiq_íabÀd
 |
vÆue
;

358 
s
->
fiq_íabÀd
 &~
vÆue
;

365 
	`¥ötf
 ("i˝_pic_wrôe: BadÑegi°î off£à0x%x\n", ()
off£t
);

368 
	`i˝_pic_upd©e
(
s
);

369 
	}
}

371 
CPURódMem‹yFunc
 *
	gi˝_pic_ªad‚
[] = {

372 
i˝_pic_ªad
,

373 
i˝_pic_ªad
,

374 
i˝_pic_ªad


377 
CPUWrôeMem‹yFunc
 *
	gi˝_pic_wrôe‚
[] = {

378 
i˝_pic_wrôe
,

379 
i˝_pic_wrôe
,

380 
i˝_pic_wrôe


383 
i˝_pic_°©e
 *
	$i˝_pic_öô
(
uöt32_t
 
ba£
, *
∑ª¡
,

384 
∑ª¡_úq
, 
∑ª¡_fiq
)

386 
i˝_pic_°©e
 *
s
;

387 
iomemty≥
;

389 
s
 = (
i˝_pic_°©e
 *)
	`qemu_mÆlocz
((icp_pic_state));

390 i‡(!
s
)

391  
NULL
;

392 
s
->
h™dÀr
 = 
i˝_pic_£t_úq
;

393 
s
->
ba£
 = base;

394 
s
->
∑ª¡
 =Öarent;

395 
s
->
∑ª¡_úq
 =Öarent_irq;

396 
s
->
∑ª¡_fiq
 =Öarent_fiq;

397 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
i˝_pic_ªad‚
,

398 
i˝_pic_wrôe‚
, 
s
);

399 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x007fffff, 
iomemty≥
);

401  
s
;

402 
	}
}

406 
uöt32_t
 
	mba£
;

407 } 
	ti˝_c⁄åﬁ_°©e
;

409 
uöt32_t
 
	$i˝_c⁄åﬁ_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

411 
i˝_c⁄åﬁ_°©e
 *
s
 = (i˝_c⁄åﬁ_°©ê*)
›aque
;

412 
off£t
 -
s
->
ba£
;

413 
off£t
 >> 2) {

423 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "i˝_c⁄åﬁ_ªad: Bad off£à%x\n", 
off£t
);

426 
	}
}

428 
	$i˝_c⁄åﬁ_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

429 
uöt32_t
 
vÆue
)

431 
i˝_c⁄åﬁ_°©e
 *
s
 = (i˝_c⁄åﬁ_°©ê*)
›aque
;

432 
off£t
 -
s
->
ba£
;

433 
off£t
 >> 2) {

440 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "i˝_c⁄åﬁ_wrôe: Bad off£à%x\n", 
off£t
);

442 
	}
}

443 
CPURódMem‹yFunc
 *
	gi˝_c⁄åﬁ_ªad‚
[] = {

444 
i˝_c⁄åﬁ_ªad
,

445 
i˝_c⁄åﬁ_ªad
,

446 
i˝_c⁄åﬁ_ªad


449 
CPUWrôeMem‹yFunc
 *
	gi˝_c⁄åﬁ_wrôe‚
[] = {

450 
i˝_c⁄åﬁ_wrôe
,

451 
i˝_c⁄åﬁ_wrôe
,

452 
i˝_c⁄åﬁ_wrôe


455 
	$i˝_c⁄åﬁ_öô
(
uöt32_t
 
ba£
)

457 
iomemty≥
;

458 
i˝_c⁄åﬁ_°©e
 *
s
;

460 
s
 = (
i˝_c⁄åﬁ_°©e
 *)
	`qemu_mÆlocz
((icp_control_state));

461 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
i˝_c⁄åﬁ_ªad‚
,

462 
i˝_c⁄åﬁ_wrôe‚
, 
s
);

463 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x007fffff, 
iomemty≥
);

464 
s
->
ba£
 = base;

466 
	}
}

471 
	$öãgøt‹˝_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

472 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

473 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

474 c⁄° *
öôrd_fûíame
, 
uöt32_t
 
˝uid
)

476 
CPUSèã
 *
ív
;

477 
uöt32_t
 
bios_off£t
;

478 
i˝_pic_°©e
 *
pic
;

479 *
˝u_pic
;

481 
ív
 = 
	`˝u_öô
();

482 
	`˝u_¨m_£t_modñ
(
ív
, 
˝uid
);

483 
bios_off£t
 = 
øm_size
 + 
vga_øm_size
;

487 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 
IO_MEM_RAM
);

489 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x80000000, 
øm_size
, 
IO_MEM_RAM
);

491 
	`öãgøt‹cm_öô
(
øm_size
 >> 20, 
bios_off£t
);

492 
˝u_pic
 = 
	`¨m_pic_öô_˝u
(
ív
);

493 
pic
 = 
	`i˝_pic_öô
(0x14000000, 
˝u_pic
, 
ARM_PIC_CPU_IRQ
, 
ARM_PIC_CPU_FIQ
);

494 
	`i˝_pic_öô
(0xˇ000000, 
pic
, 26, -1);

495 
	`i˝_pô_öô
(0x13000000, 
pic
, 5);

496 
	`∂011_öô
(0x16000000, 
pic
, 1, 
£rül_hds
[0]);

497 
	`∂011_öô
(0x17000000, 
pic
, 2, 
£rül_hds
[1]);

498 
	`i˝_c⁄åﬁ_öô
(0xcb000000);

499 
	`∂050_öô
(0x18000000, 
pic
, 3, 0);

500 
	`∂050_öô
(0x19000000, 
pic
, 4, 1);

501 i‡(
nd_èbÀ
[0].
vœn
) {

502 i‡(
nd_èbÀ
[0].
modñ
 =
NULL


503 || 
	`°rcmp
(
nd_èbÀ
[0].
modñ
, "smc91c111") == 0) {

504 
	`smc91c111_öô
(&
nd_èbÀ
[0], 0xc8000000, 
pic
, 27);

506 
	`Ârötf
(
°dîr
, "qemu: Unsuµ‹ãd NIC: %s\n", 
nd_èbÀ
[0].
modñ
);

507 
	`exô
 (1);

510 
	`∂110_öô
(
ds
, 0xc0000000, 
pic
, 22, 0);

512 
	`¨m_lﬂd_kî√l
(
ív
, 
øm_size
, 
kî√l_fûíame
, 
kî√l_cmdlöe
,

513 
öôrd_fûíame
, 0x113);

514 
	}
}

516 
	$öãgøt‹˝926_öô
(
øm_size
, 
vga_øm_size
,

517 
boŸ_devi˚
, 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

518 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

519 c⁄° *
öôrd_fûíame
)

521 
	`öãgøt‹˝_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
, 
ds
, 
fd_fûíame
,

522 
¢≠shŸ
, 
kî√l_fûíame
, 
kî√l_cmdlöe
,

523 
öôrd_fûíame
, 
ARM_CPUID_ARM926
);

524 
	}
}

526 
	$öãgøt‹˝1026_öô
(
øm_size
, 
vga_øm_size
,

527 
boŸ_devi˚
, 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

528 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

529 c⁄° *
öôrd_fûíame
)

531 
	`öãgøt‹˝_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
, 
ds
, 
fd_fûíame
,

532 
¢≠shŸ
, 
kî√l_fûíame
, 
kî√l_cmdlöe
,

533 
öôrd_fûíame
, 
ARM_CPUID_ARM1026
);

534 
	}
}

536 
QEMUMachöe
 
	göãgøt‹˝926_machöe
 = {

539 
öãgøt‹˝926_öô
,

542 
QEMUMachöe
 
	göãgøt‹˝1026_machöe
 = {

545 
öãgøt‹˝1026_öô
,

	@iommu.c

24 
	~"vl.h
"

29 #ifde‡
DEBUG_IOMMU


30 
	#DPRINTF
(
fmt
, 
¨gs
...) \

31 dÿ{ 
	`¥ötf
("IOMMU: " 
fmt
 , ##
¨gs
); } 0)

	)

33 
	#DPRINTF
(
fmt
, 
¨gs
...)

	)

36 
	#IOMMU_NREGS
 (3*4096/4)

	)

37 
	#IOMMU_CTRL
 (0x0000 >> 2)

	)

38 
	#IOMMU_CTRL_IMPL
 0xf0000000

	)

39 
	#IOMMU_CTRL_VERS
 0x0f000000

	)

40 
	#IOMMU_VERSION
 0x04000000

	)

41 
	#IOMMU_CTRL_RNGE
 0x0000001¯

	)

42 
	#IOMMU_RNGE_16MB
 0x00000000

	)

43 
	#IOMMU_RNGE_32MB
 0x00000004

	)

44 
	#IOMMU_RNGE_64MB
 0x00000008

	)

45 
	#IOMMU_RNGE_128MB
 0x0000000¯

	)

46 
	#IOMMU_RNGE_256MB
 0x00000010

	)

47 
	#IOMMU_RNGE_512MB
 0x00000014

	)

48 
	#IOMMU_RNGE_1GB
 0x00000018

	)

49 
	#IOMMU_RNGE_2GB
 0x0000001¯

	)

50 
	#IOMMU_CTRL_ENAB
 0x00000001

	)

51 
	#IOMMU_CTRL_MASK
 0x0000001d

	)

53 
	#IOMMU_BASE
 (0x0004 >> 2)

	)

54 
	#IOMMU_BASE_MASK
 0x07fffc00

	)

56 
	#IOMMU_TLBFLUSH
 (0x0014 >> 2)

	)

57 
	#IOMMU_TLBFLUSH_MASK
 0xffffffff

	)

59 
	#IOMMU_PGFLUSH
 (0x0018 >> 2)

	)

60 
	#IOMMU_PGFLUSH_MASK
 0xffffffff

	)

62 
	#IOMMU_SBCFG0
 (0x1010 >> 2Ë

	)

63 
	#IOMMU_SBCFG1
 (0x1014 >> 2Ë

	)

64 
	#IOMMU_SBCFG2
 (0x1018 >> 2Ë

	)

65 
	#IOMMU_SBCFG3
 (0x101¯>> 2Ë

	)

66 
	#IOMMU_SBCFG_SAB30
 0x00010000

	)

67 
	#IOMMU_SBCFG_BA16
 0x00000004

	)

68 
	#IOMMU_SBCFG_BA8
 0x00000002

	)

69 
	#IOMMU_SBCFG_BYPASS
 0x00000001

	)

72 
	#IOMMU_SBCFG_MASK
 0x00010003

	)

74 
	#IOMMU_ARBEN
 (0x2000 >> 2Ë

	)

75 
	#IOMMU_ARBEN_MASK
 0x001f0000

	)

76 
	#IOMMU_MID
 0x00000008

	)

79 
	#IOPTE_PAGE
 0x07ffff00

	)

80 
	#IOPTE_CACHE
 0x00000080

	)

81 
	#IOPTE_WRITE
 0x00000004

	)

82 
	#IOPTE_VALID
 0x00000002

	)

83 
	#IOPTE_WAZ
 0x00000001

	)

85 #i‡
deföed
(
__i386__
Ë|| deföed(
__x86_64__
)

86 
	#PAGE_SHIFT
 12

	)

87 #ñi‡
deföed
(
__ü64__
)

88 
	#PAGE_SHIFT
 14

	)

90 
	#PAGE_SIZE
 (1 << 
PAGE_SHIFT
)

	)

91 
	#PAGE_MASK
 (
PAGE_SIZE
 - 1)

	)

93 
	sIOMMUSèã
 {

94 
uöt32_t
 
	maddr
;

95 
uöt32_t
 
	mªgs
[
IOMMU_NREGS
];

96 
uöt32_t
 
	mio°¨t
;

97 } 
	tIOMMUSèã
;

99 
uöt32_t
 
	$iommu_mem_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

101 
IOMMUSèã
 *
s
 = 
›aque
;

102 
uöt32_t
 
ßddr
;

104 
ßddr
 = (
addr
 - 
s
->addr) >> 2;

105 
ßddr
) {

107 
	`DPRINTF
("ªadÑeg[%d] = %x\n", 
ßddr
, 
s
->
ªgs
[saddr]);

108  
s
->
ªgs
[
ßddr
];

112 
	}
}

114 
	$iommu_mem_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

116 
IOMMUSèã
 *
s
 = 
›aque
;

117 
uöt32_t
 
ßddr
;

119 
ßddr
 = (
addr
 - 
s
->addr) >> 2;

120 
	`DPRINTF
("wrôêªg[%d] = %x\n", 
ßddr
, 
vÆ
);

121 
ßddr
) {

122 
IOMMU_CTRL
:

123 
vÆ
 & 
IOMMU_CTRL_RNGE
) {

124 
IOMMU_RNGE_16MB
:

125 
s
->
io°¨t
 = 0xff000000;

127 
IOMMU_RNGE_32MB
:

128 
s
->
io°¨t
 = 0xfe000000;

130 
IOMMU_RNGE_64MB
:

131 
s
->
io°¨t
 = 0xfc000000;

133 
IOMMU_RNGE_128MB
:

134 
s
->
io°¨t
 = 0xf8000000;

136 
IOMMU_RNGE_256MB
:

137 
s
->
io°¨t
 = 0xf0000000;

139 
IOMMU_RNGE_512MB
:

140 
s
->
io°¨t
 = 0xe0000000;

142 
IOMMU_RNGE_1GB
:

143 
s
->
io°¨t
 = 0xc0000000;

146 
IOMMU_RNGE_2GB
:

147 
s
->
io°¨t
 = 0x80000000;

150 
	`DPRINTF
("io°¨à%x\n", 
s
->
io°¨t
);

151 
s
->
ªgs
[
ßddr
] = ((
vÆ
 & 
IOMMU_CTRL_MASK
Ë| 
IOMMU_VERSION
);

153 
IOMMU_BASE
:

154 
s
->
ªgs
[
ßddr
] = 
vÆ
 & 
IOMMU_BASE_MASK
;

156 
IOMMU_TLBFLUSH
:

157 
	`DPRINTF
("éb flush %x\n", 
vÆ
);

158 
s
->
ªgs
[
ßddr
] = 
vÆ
 & 
IOMMU_TLBFLUSH_MASK
;

160 
IOMMU_PGFLUSH
:

161 
	`DPRINTF
("∑gêÊush %x\n", 
vÆ
);

162 
s
->
ªgs
[
ßddr
] = 
vÆ
 & 
IOMMU_PGFLUSH_MASK
;

164 
IOMMU_SBCFG0
:

165 
IOMMU_SBCFG1
:

166 
IOMMU_SBCFG2
:

167 
IOMMU_SBCFG3
:

168 
s
->
ªgs
[
ßddr
] = 
vÆ
 & 
IOMMU_SBCFG_MASK
;

170 
IOMMU_ARBEN
:

173 
s
->
ªgs
[
ßddr
] = (
vÆ
 & 
IOMMU_ARBEN_MASK
Ë| 
IOMMU_MID
;

176 
s
->
ªgs
[
ßddr
] = 
vÆ
;

179 
	}
}

181 
CPURódMem‹yFunc
 *
	giommu_mem_ªad
[3] = {

182 
iommu_mem_ªadw
,

183 
iommu_mem_ªadw
,

184 
iommu_mem_ªadw
,

187 
CPUWrôeMem‹yFunc
 *
	giommu_mem_wrôe
[3] = {

188 
iommu_mem_wrôew
,

189 
iommu_mem_wrôew
,

190 
iommu_mem_wrôew
,

193 
uöt32_t
 
	$iommu_∑ge_gë_Êags
(
IOMMUSèã
 *
s
, 
uöt32_t
 
addr
)

195 
uöt32_t
 
i›ã
;

197 
i›ã
 = 
s
->
ªgs
[1] << 4;

198 
addr
 &~
s
->
io°¨t
;

199 
i›ã
 +(
addr
 >> (
PAGE_SHIFT
 - 2)) & ~3;

200  
	`ldl_phys
(
i›ã
);

201 
	}
}

203 
uöt32_t
 
	$iommu_å™¶©e_∑
(
IOMMUSèã
 *
s
, 
uöt32_t
 
addr
, uöt32_à
∑
)

205 
uöt32_t
 
tmµã
;

207 
tmµã
 = 
∑
;

208 
∑
 = (’®& 
IOPTE_PAGE
Ë<< 4Ë+ (
addr
 & 
PAGE_MASK
);

209 
	`DPRINTF
("xœã dv®%x =>Ö®%x (i›ã = %x)\n", 
addr
, 
∑
, 
tmµã
);

210  
∑
;

211 
	}
}

213 
	$•¨c_iommu_mem‹y_rw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

214 
uöt8_t
 *
buf
, 
Àn
, 
is_wrôe
)

216 
l
, 
Êags
;

217 
èrgë_ul⁄g
 
∑ge
, 
phys_addr
;

219 
Àn
 > 0) {

220 
∑ge
 = 
addr
 & 
TARGET_PAGE_MASK
;

221 
l
 = (
∑ge
 + 
TARGET_PAGE_SIZE
Ë- 
addr
;

222 i‡(
l
 > 
Àn
)

223 
l
 = 
Àn
;

224 
Êags
 = 
	`iommu_∑ge_gë_Êags
(
›aque
, 
∑ge
);

225 i‡(!(
Êags
 & 
IOPTE_VALID
))

227 
phys_addr
 = 
	`iommu_å™¶©e_∑
(
›aque
, 
addr
, 
Êags
);

228 i‡(
is_wrôe
) {

229 i‡(!(
Êags
 & 
IOPTE_WRITE
))

231 
	`˝u_physiˇl_mem‹y_wrôe
(
phys_addr
, 
buf
, 
Àn
);

233 
	`˝u_physiˇl_mem‹y_ªad
(
phys_addr
, 
buf
, 
Àn
);

235 
Àn
 -
l
;

236 
buf
 +
l
;

237 
addr
 +
l
;

239 
	}
}

241 
	$iommu_ßve
(
QEMUFûe
 *
f
, *
›aque
)

243 
IOMMUSèã
 *
s
 = 
›aque
;

244 
i
;

246 
	`qemu_put_be32s
(
f
, &
s
->
addr
);

247 
i
 = 0; i < 
IOMMU_NREGS
; i++)

248 
	`qemu_put_be32s
(
f
, &
s
->
ªgs
[
i
]);

249 
	`qemu_put_be32s
(
f
, &
s
->
io°¨t
);

250 
	}
}

252 
	$iommu_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

254 
IOMMUSèã
 *
s
 = 
›aque
;

255 
i
;

257 i‡(
vîsi⁄_id
 != 1)

258  -
EINVAL
;

260 
	`qemu_gë_be32s
(
f
, &
s
->
addr
);

261 
i
 = 0; i < 
IOMMU_NREGS
; i++)

262 
	`qemu_put_be32s
(
f
, &
s
->
ªgs
[
i
]);

263 
	`qemu_gë_be32s
(
f
, &
s
->
io°¨t
);

266 
	}
}

268 
	$iommu_ª£t
(*
›aque
)

270 
IOMMUSèã
 *
s
 = 
›aque
;

272 
	`mem£t
(
s
->
ªgs
, 0, 
IOMMU_NREGS
 * 4);

273 
s
->
io°¨t
 = 0;

274 
s
->
ªgs
[0] = 
IOMMU_VERSION
;

275 
	}
}

277 *
	$iommu_öô
(
uöt32_t
 
addr
)

279 
IOMMUSèã
 *
s
;

280 
iommu_io_mem‹y
;

282 
s
 = 
	`qemu_mÆlocz
((
IOMMUSèã
));

283 i‡(!
s
)

284  
NULL
;

286 
s
->
addr
 =áddr;

288 
iommu_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
iommu_mem_ªad
, 
iommu_mem_wrôe
, 
s
);

289 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
IOMMU_NREGS
 * 4, 
iommu_io_mem‹y
);

291 
	`ªgi°î_ßvevm
("iommu", 
addr
, 1, 
iommu_ßve
, 
iommu_lﬂd
, 
s
);

292 
	`qemu_ªgi°î_ª£t
(
iommu_ª£t
, 
s
);

293  
s
;

294 
	}
}

	@isa_mmio.c

25 
	~"vl.h
"

27 
	$iß_mmio_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

28 
uöt32_t
 
vÆ
)

30 
	`˝u_outb
(
NULL
, 
addr
 & 0xffff, 
vÆ
);

31 
	}
}

33 
	$iß_mmio_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

34 
uöt32_t
 
vÆ
)

36 #ifde‡
TARGET_WORDS_BIGENDIAN


37 
vÆ
 = 
	`bsw≠16
(val);

39 
	`˝u_outw
(
NULL
, 
addr
 & 0xffff, 
vÆ
);

40 
	}
}

42 
	$iß_mmio_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

43 
uöt32_t
 
vÆ
)

45 #ifde‡
TARGET_WORDS_BIGENDIAN


46 
vÆ
 = 
	`bsw≠32
(val);

48 
	`˝u_oué
(
NULL
, 
addr
 & 0xffff, 
vÆ
);

49 
	}
}

51 
uöt32_t
 
	$iß_mmio_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

53 
uöt32_t
 
vÆ
;

55 
vÆ
 = 
	`˝u_öb
(
NULL
, 
addr
 & 0xffff);

56  
vÆ
;

57 
	}
}

59 
uöt32_t
 
	$iß_mmio_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

61 
uöt32_t
 
vÆ
;

63 
vÆ
 = 
	`˝u_öw
(
NULL
, 
addr
 & 0xffff);

64 #ifde‡
TARGET_WORDS_BIGENDIAN


65 
vÆ
 = 
	`bsw≠16
(val);

67  
vÆ
;

68 
	}
}

70 
uöt32_t
 
	$iß_mmio_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

72 
uöt32_t
 
vÆ
;

74 
vÆ
 = 
	`˝u_öl
(
NULL
, 
addr
 & 0xffff);

75 #ifde‡
TARGET_WORDS_BIGENDIAN


76 
vÆ
 = 
	`bsw≠32
(val);

78  
vÆ
;

79 
	}
}

81 
CPUWrôeMem‹yFunc
 *
	giß_mmio_wrôe
[] = {

82 &
iß_mmio_wrôeb
,

83 &
iß_mmio_wrôew
,

84 &
iß_mmio_wrôñ
,

87 
CPURódMem‹yFunc
 *
	giß_mmio_ªad
[] = {

88 &
iß_mmio_ªadb
,

89 &
iß_mmio_ªadw
,

90 &
iß_mmio_ªadl
,

93 
	giß_mmio_iomemty≥
 = 0;

95 
	$iß_mmio_öô
(
èrgë_phys_addr_t
 
ba£
,Å¨gë_phys_addr_à
size
)

97 i‡(!
iß_mmio_iomemty≥
) {

98 
iß_mmio_iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
iß_mmio_ªad
,

99 
iß_mmio_wrôe
, 
NULL
);

101 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 
size
, 
iß_mmio_iomemty≥
);

102 
	}
}

	@lsi53c895a.c

13 
	~"vl.h
"

18 #ifde‡
DEBUG_LSI


19 
	#DPRINTF
(
fmt
, 
¨gs
...) \

20 dÿ{ 
	`¥ötf
("lsi_scsi: " 
fmt
 , ##
¨gs
); } 0)

	)

21 
	#BADF
(
fmt
, 
¨gs
...) \

22 dÿ{ 
	`Ârötf
(
°dîr
, "lsi_scsi:Éº‹: " 
fmt
 , ##
¨gs
); 
	`exô
(1);} 0)

	)

24 
	#DPRINTF
(
fmt
, 
¨gs
...Ëdÿ{} 0)

	)

25 
	#BADF
(
fmt
, 
¨gs
...) \

26 dÿ{ 
	`Ârötf
(
°dîr
, "lsi_scsi:Éº‹: " 
fmt
 , ##
¨gs
);} 0)

	)

29 
	#LSI_SCNTL0_TRG
 0x01

	)

30 
	#LSI_SCNTL0_AAP
 0x02

	)

31 
	#LSI_SCNTL0_EPC
 0x08

	)

32 
	#LSI_SCNTL0_WATN
 0x10

	)

33 
	#LSI_SCNTL0_START
 0x20

	)

35 
	#LSI_SCNTL1_SST
 0x01

	)

36 
	#LSI_SCNTL1_IARB
 0x02

	)

37 
	#LSI_SCNTL1_AESP
 0x04

	)

38 
	#LSI_SCNTL1_RST
 0x08

	)

39 
	#LSI_SCNTL1_CON
 0x10

	)

40 
	#LSI_SCNTL1_DHP
 0x20

	)

41 
	#LSI_SCNTL1_ADB
 0x40

	)

42 
	#LSI_SCNTL1_EXC
 0x80

	)

44 
	#LSI_SCNTL2_WSR
 0x01

	)

45 
	#LSI_SCNTL2_VUE0
 0x02

	)

46 
	#LSI_SCNTL2_VUE1
 0x04

	)

47 
	#LSI_SCNTL2_WSS
 0x08

	)

48 
	#LSI_SCNTL2_SLPHBEN
 0x10

	)

49 
	#LSI_SCNTL2_SLPMD
 0x20

	)

50 
	#LSI_SCNTL2_CHM
 0x40

	)

51 
	#LSI_SCNTL2_SDU
 0x80

	)

53 
	#LSI_ISTAT0_DIP
 0x01

	)

54 
	#LSI_ISTAT0_SIP
 0x02

	)

55 
	#LSI_ISTAT0_INTF
 0x04

	)

56 
	#LSI_ISTAT0_CON
 0x08

	)

57 
	#LSI_ISTAT0_SEM
 0x10

	)

58 
	#LSI_ISTAT0_SIGP
 0x20

	)

59 
	#LSI_ISTAT0_SRST
 0x40

	)

60 
	#LSI_ISTAT0_ABRT
 0x80

	)

62 
	#LSI_ISTAT1_SI
 0x01

	)

63 
	#LSI_ISTAT1_SRUN
 0x02

	)

64 
	#LSI_ISTAT1_FLSH
 0x04

	)

66 
	#LSI_SSTAT0_SDP0
 0x01

	)

67 
	#LSI_SSTAT0_RST
 0x02

	)

68 
	#LSI_SSTAT0_WOA
 0x04

	)

69 
	#LSI_SSTAT0_LOA
 0x08

	)

70 
	#LSI_SSTAT0_AIP
 0x10

	)

71 
	#LSI_SSTAT0_OLF
 0x20

	)

72 
	#LSI_SSTAT0_ORF
 0x40

	)

73 
	#LSI_SSTAT0_ILF
 0x80

	)

75 
	#LSI_SIST0_PAR
 0x01

	)

76 
	#LSI_SIST0_RST
 0x02

	)

77 
	#LSI_SIST0_UDC
 0x04

	)

78 
	#LSI_SIST0_SGE
 0x08

	)

79 
	#LSI_SIST0_RSL
 0x10

	)

80 
	#LSI_SIST0_SEL
 0x20

	)

81 
	#LSI_SIST0_CMP
 0x40

	)

82 
	#LSI_SIST0_MA
 0x80

	)

84 
	#LSI_SIST1_HTH
 0x01

	)

85 
	#LSI_SIST1_GEN
 0x02

	)

86 
	#LSI_SIST1_STO
 0x04

	)

87 
	#LSI_SIST1_SBMC
 0x10

	)

89 
	#LSI_SOCL_IO
 0x01

	)

90 
	#LSI_SOCL_CD
 0x02

	)

91 
	#LSI_SOCL_MSG
 0x04

	)

92 
	#LSI_SOCL_ATN
 0x08

	)

93 
	#LSI_SOCL_SEL
 0x10

	)

94 
	#LSI_SOCL_BSY
 0x20

	)

95 
	#LSI_SOCL_ACK
 0x40

	)

96 
	#LSI_SOCL_REQ
 0x80

	)

98 
	#LSI_DSTAT_IID
 0x01

	)

99 
	#LSI_DSTAT_SIR
 0x04

	)

100 
	#LSI_DSTAT_SSI
 0x08

	)

101 
	#LSI_DSTAT_ABRT
 0x10

	)

102 
	#LSI_DSTAT_BF
 0x20

	)

103 
	#LSI_DSTAT_MDPE
 0x40

	)

104 
	#LSI_DSTAT_DFE
 0x80

	)

106 
	#LSI_DCNTL_COM
 0x01

	)

107 
	#LSI_DCNTL_IRQD
 0x02

	)

108 
	#LSI_DCNTL_STD
 0x04

	)

109 
	#LSI_DCNTL_IRQM
 0x08

	)

110 
	#LSI_DCNTL_SSM
 0x10

	)

111 
	#LSI_DCNTL_PFEN
 0x20

	)

112 
	#LSI_DCNTL_PFF
 0x40

	)

113 
	#LSI_DCNTL_CLSE
 0x80

	)

115 
	#LSI_DMODE_MAN
 0x01

	)

116 
	#LSI_DMODE_BOF
 0x02

	)

117 
	#LSI_DMODE_ERMP
 0x04

	)

118 
	#LSI_DMODE_ERL
 0x08

	)

119 
	#LSI_DMODE_DIOM
 0x10

	)

120 
	#LSI_DMODE_SIOM
 0x20

	)

122 
	#LSI_CTEST2_DACK
 0x01

	)

123 
	#LSI_CTEST2_DREQ
 0x02

	)

124 
	#LSI_CTEST2_TEOP
 0x04

	)

125 
	#LSI_CTEST2_PCICIE
 0x08

	)

126 
	#LSI_CTEST2_CM
 0x10

	)

127 
	#LSI_CTEST2_CIO
 0x20

	)

128 
	#LSI_CTEST2_SIGP
 0x40

	)

129 
	#LSI_CTEST2_DDIR
 0x80

	)

131 
	#LSI_CTEST5_BL2
 0x04

	)

132 
	#LSI_CTEST5_DDIR
 0x08

	)

133 
	#LSI_CTEST5_MASR
 0x10

	)

134 
	#LSI_CTEST5_DFSN
 0x20

	)

135 
	#LSI_CTEST5_BBCK
 0x40

	)

136 
	#LSI_CTEST5_ADCK
 0x80

	)

138 
	#LSI_CCNTL0_DILS
 0x01

	)

139 
	#LSI_CCNTL0_DISFC
 0x10

	)

140 
	#LSI_CCNTL0_ENNDJ
 0x20

	)

141 
	#LSI_CCNTL0_PMJCTL
 0x40

	)

142 
	#LSI_CCNTL0_ENPMJ
 0x80

	)

144 
	#PHASE_DO
 0

	)

145 
	#PHASE_DI
 1

	)

146 
	#PHASE_CMD
 2

	)

147 
	#PHASE_ST
 3

	)

148 
	#PHASE_MO
 6

	)

149 
	#PHASE_MI
 7

	)

150 
	#PHASE_MASK
 7

	)

153 
	#LSI_MAX_DEVS
 7

	)

156 
	#LSI_MAX_MSGIN_LEN
 8

	)

159 
	#LSI_TAG_VALID
 (1 << 16)

	)

162 
uöt32_t
 
	mèg
;

163 
uöt32_t
 
	m≥ndög
;

164 
	mout
;

165 } 
	tlsi_queue
;

168 
PCIDevi˚
 
	mpci_dev
;

169 
	mmmio_io_addr
;

170 
	møm_io_addr
;

171 
uöt32_t
 
	ms¸ùt_øm_ba£
;

173 
	mˇºy
;

174 
	m£n£
;

177 
	mmsg_a˘i⁄
;

178 
	mmsg_Àn
;

179 
uöt8_t
 
	mmsg
[
LSI_MAX_MSGIN_LEN
];

184 
	mwaôög
;

185 
SCSIDevi˚
 *
	mscsi_dev
[
LSI_MAX_DEVS
];

186 
SCSIDevi˚
 *
	mcuºít_dev
;

187 
	mcuºít_lun
;

189 
uöt32_t
 
	mcuºít_èg
;

190 
uöt32_t
 
	mcuºít_dma_Àn
;

191 
uöt8_t
 *
	mdma_buf
;

192 
lsi_queue
 *
	mqueue
;

193 
	mqueue_Àn
;

194 
	ma˘ive_comm™ds
;

196 
uöt32_t
 
	mdß
;

197 
uöt32_t
 
	mãmp
;

198 
uöt32_t
 
	md«d
;

199 
uöt32_t
 
	mdbc
;

200 
uöt8_t
 
	mi°©0
;

201 
uöt8_t
 
	mi°©1
;

202 
uöt8_t
 
	mdcmd
;

203 
uöt8_t
 
	md°©
;

204 
uöt8_t
 
	mdõn
;

205 
uöt8_t
 
	msi°0
;

206 
uöt8_t
 
	msi°1
;

207 
uöt8_t
 
	msõn0
;

208 
uöt8_t
 
	msõn1
;

209 
uöt8_t
 
	mmbox0
;

210 
uöt8_t
 
	mmbox1
;

211 
uöt8_t
 
	mdfifo
;

212 
uöt8_t
 
	m˘e°3
;

213 
uöt8_t
 
	m˘e°4
;

214 
uöt8_t
 
	m˘e°5
;

215 
uöt8_t
 
	mc˙é0
;

216 
uöt8_t
 
	mc˙é1
;

217 
uöt32_t
 
	md•
;

218 
uöt32_t
 
	md•s
;

219 
uöt8_t
 
	mdmode
;

220 
uöt8_t
 
	md˙é
;

221 
uöt8_t
 
	ms˙é0
;

222 
uöt8_t
 
	ms˙é1
;

223 
uöt8_t
 
	ms˙é2
;

224 
uöt8_t
 
	ms˙é3
;

225 
uöt8_t
 
	ms°©0
;

226 
uöt8_t
 
	ms°©1
;

227 
uöt8_t
 
	mscid
;

228 
uöt8_t
 
	msx„r
;

229 
uöt8_t
 
	mso˛
;

230 
uöt8_t
 
	msdid
;

231 
uöt8_t
 
	mssid
;

232 
uöt8_t
 
	msfbr
;

233 
uöt8_t
 
	m°e°1
;

234 
uöt8_t
 
	m°e°2
;

235 
uöt8_t
 
	m°e°3
;

236 
uöt8_t
 
	msidl
;

237 
uöt8_t
 
	m°ime0
;

238 
uöt8_t
 
	mª•id0
;

239 
uöt8_t
 
	mª•id1
;

240 
uöt32_t
 
	mmmrs
;

241 
uöt32_t
 
	mmmws
;

242 
uöt32_t
 
	msfs
;

243 
uöt32_t
 
	mdrs
;

244 
uöt32_t
 
	msbms
;

245 
uöt32_t
 
	mdmbs
;

246 
uöt32_t
 
	md«d64
;

247 
uöt32_t
 
	mpmjad1
;

248 
uöt32_t
 
	mpmjad2
;

249 
uöt32_t
 
	mrbc
;

250 
uöt32_t
 
	mua
;

251 
uöt32_t
 
	mü
;

252 
uöt32_t
 
	msbc
;

253 
uöt32_t
 
	mcsbc
;

254 
uöt32_t
 
	ms¸©ch
[13];

257 
uöt32_t
 
	ms¸ùt_øm
[2048];

258 } 
	tLSISèã
;

260 
	$lsi_so·_ª£t
(
LSISèã
 *
s
)

262 
	`DPRINTF
("Reset\n");

263 
s
->
ˇºy
 = 0;

265 
s
->
waôög
 = 0;

266 
s
->
dß
 = 0;

267 
s
->
d«d
 = 0;

268 
s
->
dbc
 = 0;

269 
s
->
ãmp
 = 0;

270 
	`mem£t
(
s
->
s¸©ch
, 0, (s->scratch));

271 
s
->
i°©0
 = 0;

272 
s
->
i°©1
 = 0;

273 
s
->
dcmd
 = 0;

274 
s
->
d°©
 = 0;

275 
s
->
dõn
 = 0;

276 
s
->
si°0
 = 0;

277 
s
->
si°1
 = 0;

278 
s
->
sõn0
 = 0;

279 
s
->
sõn1
 = 0;

280 
s
->
mbox0
 = 0;

281 
s
->
mbox1
 = 0;

282 
s
->
dfifo
 = 0;

283 
s
->
˘e°3
 = 0;

284 
s
->
˘e°4
 = 0;

285 
s
->
˘e°5
 = 0;

286 
s
->
c˙é0
 = 0;

287 
s
->
c˙é1
 = 0;

288 
s
->
d•
 = 0;

289 
s
->
d•s
 = 0;

290 
s
->
dmode
 = 0;

291 
s
->
d˙é
 = 0;

292 
s
->
s˙é0
 = 0xc0;

293 
s
->
s˙é1
 = 0;

294 
s
->
s˙é2
 = 0;

295 
s
->
s˙é3
 = 0;

296 
s
->
s°©0
 = 0;

297 
s
->
s°©1
 = 0;

298 
s
->
scid
 = 7;

299 
s
->
sx„r
 = 0;

300 
s
->
so˛
 = 0;

301 
s
->
°e°1
 = 0;

302 
s
->
°e°2
 = 0;

303 
s
->
°e°3
 = 0;

304 
s
->
sidl
 = 0;

305 
s
->
°ime0
 = 0;

306 
s
->
ª•id0
 = 0x80;

307 
s
->
ª•id1
 = 0;

308 
s
->
mmrs
 = 0;

309 
s
->
mmws
 = 0;

310 
s
->
sfs
 = 0;

311 
s
->
drs
 = 0;

312 
s
->
sbms
 = 0;

313 
s
->
dmbs
 = 0;

314 
s
->
d«d64
 = 0;

315 
s
->
pmjad1
 = 0;

316 
s
->
pmjad2
 = 0;

317 
s
->
rbc
 = 0;

318 
s
->
ua
 = 0;

319 
s
->
ü
 = 0;

320 
s
->
sbc
 = 0;

321 
s
->
csbc
 = 0;

322 
	}
}

324 
uöt8_t
 
lsi_ªg_ªadb
(
LSISèã
 *
s
, 
off£t
);

325 
lsi_ªg_wrôeb
(
LSISèã
 *
s
, 
off£t
, 
uöt8_t
 
vÆ
);

326 
lsi_execuã_s¸ùt
(
LSISèã
 *
s
);

328 
ölöe
 
uöt32_t
 
	$ªad_dw‹d
(
LSISèã
 *
s
, 
uöt32_t
 
addr
)

330 
uöt32_t
 
buf
;

333 i‡((
addr
 & 0xfff„000Ë=
s
->
s¸ùt_øm_ba£
) {

334  
s
->
s¸ùt_øm
[(
addr
 & 0x1fff) >> 2];

336 
	`˝u_physiˇl_mem‹y_ªad
(
addr
, (
uöt8_t
 *)&
buf
, 4);

337  
	`˝u_to_À32
(
buf
);

338 
	}
}

340 
	$lsi_°›_s¸ùt
(
LSISèã
 *
s
)

342 
s
->
i°©1
 &~
LSI_ISTAT1_SRUN
;

343 
	}
}

345 
	$lsi_upd©e_úq
(
LSISèã
 *
s
)

347 
Àvñ
;

348 
œ°_Àvñ
;

353 
Àvñ
 = 0;

354 i‡(
s
->
d°©
) {

355 i‡(
s
->
d°©
 & s->
dõn
)

356 
Àvñ
 = 1;

357 
s
->
i°©0
 |
LSI_ISTAT0_DIP
;

359 
s
->
i°©0
 &~
LSI_ISTAT0_DIP
;

362 i‡(
s
->
si°0
 || s->
si°1
) {

363 i‡((
s
->
si°0
 & s->
sõn0
Ë|| (s->
si°1
 & s->
sõn1
))

364 
Àvñ
 = 1;

365 
s
->
i°©0
 |
LSI_ISTAT0_SIP
;

367 
s
->
i°©0
 &~
LSI_ISTAT0_SIP
;

369 i‡(
s
->
i°©0
 & 
LSI_ISTAT0_INTF
)

370 
Àvñ
 = 1;

372 i‡(
Àvñ
 !
œ°_Àvñ
) {

373 
	`DPRINTF
("Update IRQÜevel %d dstat %02x sist %02x%02x\n",

374 
Àvñ
, 
s
->
d°©
, s->
si°1
, s->
si°0
);

375 
œ°_Àvñ
 = 
Àvñ
;

377 
	`pci_£t_úq
(&
s
->
pci_dev
, 0, 
Àvñ
);

378 
	}
}

381 
	$lsi_s¸ùt_scsi_öãºu±
(
LSISèã
 *
s
, 
°©0
, 
°©1
)

383 
uöt32_t
 
mask0
;

384 
uöt32_t
 
mask1
;

386 
	`DPRINTF
("SCSI Interrupt 0x%02x%02xÖrev 0x%02x%02x\n",

387 
°©1
, 
°©0
, 
s
->
si°1
, s->
si°0
);

388 
s
->
si°0
 |
°©0
;

389 
s
->
si°1
 |
°©1
;

393 
mask0
 = 
s
->
sõn0
 | ~(
LSI_SIST0_CMP
 | 
LSI_SIST0_SEL
 | 
LSI_SIST0_RSL
);

394 
mask1
 = 
s
->
sõn1
 | ~(
LSI_SIST1_GEN
 | 
LSI_SIST1_HTH
);

395 
mask1
 &~
LSI_SIST1_STO
;

396 i‡(
s
->
si°0
 & 
mask0
 || s->
si°1
 & 
mask1
) {

397 
	`lsi_°›_s¸ùt
(
s
);

399 
	`lsi_upd©e_úq
(
s
);

400 
	}
}

403 
	$lsi_s¸ùt_dma_öãºu±
(
LSISèã
 *
s
, 
°©
)

405 
	`DPRINTF
("DMA I¡îru± 0x%xÖªv 0x%x\n", 
°©
, 
s
->
d°©
);

406 
s
->
d°©
 |
°©
;

407 
	`lsi_upd©e_úq
(
s
);

408 
	`lsi_°›_s¸ùt
(
s
);

409 
	}
}

411 
ölöe
 
	$lsi_£t_pha£
(
LSISèã
 *
s
, 
pha£
)

413 
s
->
s°©1
 = (s->s°©1 & ~
PHASE_MASK
Ë| 
pha£
;

414 
	}
}

416 
	$lsi_bad_pha£
(
LSISèã
 *
s
, 
out
, 
√w_pha£
)

419 i‡(
s
->
c˙é0
 & 
LSI_CCNTL0_ENPMJ
) {

420 i‡((
s
->
c˙é0
 & 
LSI_CCNTL0_PMJCTL
Ë|| 
out
) {

421 
s
->
d•
 = s->
pmjad1
;

423 
s
->
d•
 = s->
pmjad2
;

425 
	`DPRINTF
("D©®pha£ mism©ch jum∞tÿ%08x\n", 
s
->
d•
);

427 
	`DPRINTF
("Phase mismatch interrupt\n");

428 
	`lsi_s¸ùt_scsi_öãºu±
(
s
, 
LSI_SIST0_MA
, 0);

429 
	`lsi_°›_s¸ùt
(
s
);

431 
	`lsi_£t_pha£
(
s
, 
√w_pha£
);

432 
	}
}

436 
	$lsi_ªsume_s¸ùt
(
LSISèã
 *
s
)

438 i‡(
s
->
waôög
 != 2) {

439 
s
->
waôög
 = 0;

440 
	`lsi_execuã_s¸ùt
(
s
);

442 
s
->
waôög
 = 0;

444 
	}
}

447 
	$lsi_do_dma
(
LSISèã
 *
s
, 
out
)

449 
uöt32_t
 
cou¡
;

450 
uöt32_t
 
addr
;

452 i‡(!
s
->
cuºít_dma_Àn
) {

454 
	`DPRINTF
("DMAÇo dataávailable\n");

458 
cou¡
 = 
s
->
dbc
;

459 i‡(
cou¡
 > 
s
->
cuºít_dma_Àn
)

460 
cou¡
 = 
s
->
cuºít_dma_Àn
;

461 
	`DPRINTF
("DMAáddr=0x%08xÜí=%d\n", 
s
->
d«d
, 
cou¡
);

463 
addr
 = 
s
->
d«d
;

464 
s
->
csbc
 +
cou¡
;

465 
s
->
d«d
 +
cou¡
;

466 
s
->
dbc
 -
cou¡
;

468 i‡(
s
->
dma_buf
 =
NULL
) {

469 
s
->
dma_buf
 = 
	`scsi_gë_buf
(s->
cuºít_dev
, s->
cuºít_èg
);

473 i‡(
out
) {

474 
	`˝u_physiˇl_mem‹y_ªad
(
addr
, 
s
->
dma_buf
, 
cou¡
);

476 
	`˝u_physiˇl_mem‹y_wrôe
(
addr
, 
s
->
dma_buf
, 
cou¡
);

478 
s
->
cuºít_dma_Àn
 -
cou¡
;

479 i‡(
s
->
cuºít_dma_Àn
 == 0) {

480 
s
->
dma_buf
 = 
NULL
;

481 i‡(
out
) {

483 
	`scsi_wrôe_d©a
(
s
->
cuºít_dev
, s->
cuºít_èg
);

486 
	`scsi_ªad_d©a
(
s
->
cuºít_dev
, s->
cuºít_èg
);

489 
s
->
dma_buf
 +
cou¡
;

490 
	`lsi_ªsume_s¸ùt
(
s
);

492 
	}
}

496 
	$lsi_queue_comm™d
(
LSISèã
 *
s
)

498 
lsi_queue
 *
p
;

500 
	`DPRINTF
("QueueögÅag=0x%x\n", 
s
->
cuºít_èg
);

501 i‡(
s
->
queue_Àn
 =s->
a˘ive_comm™ds
) {

502 
s
->
queue_Àn
++;

503 
s
->
queue
 = 
	`ªÆloc
(s->queue, s->
queue_Àn
 * (
lsi_queue
));

505 
p
 = &
s
->
queue
[s->
a˘ive_comm™ds
++];

506 
p
->
èg
 = 
s
->
cuºít_èg
;

507 
p
->
≥ndög
 = 0;

508 
p
->
out
 = (
s
->
s°©1
 & 
PHASE_MASK
Ë=
PHASE_DO
;

509 
	}
}

512 
	$lsi_add_msg_byã
(
LSISèã
 *
s
, 
uöt8_t
 
d©a
)

514 i‡(
s
->
msg_Àn
 >
LSI_MAX_MSGIN_LEN
) {

515 
	`BADF
("MSG IN dataÅooÜong\n");

517 
	`DPRINTF
("MSG IN 0x%02x\n", 
d©a
);

518 
s
->
msg
[s->
msg_Àn
++] = 
d©a
;

520 
	}
}

523 
	$lsi_ª£À˘
(
LSISèã
 *
s
, 
uöt32_t
 
èg
)

525 
lsi_queue
 *
p
;

526 
n
;

527 
id
;

529 
p
 = 
NULL
;

530 
n
 = 0;Ç < 
s
->
a˘ive_comm™ds
;Ç++) {

531 
p
 = &
s
->
queue
[
n
];

532 i‡(
p
->
èg
 ==Åag)

535 i‡(
n
 =
s
->
a˘ive_comm™ds
) {

536 
	`BADF
("Re£À˘edÇ⁄-exi°™àcomm™dÅag=0x%x\n", 
èg
);

539 
id
 = (
èg
 >> 8) & 0xf;

540 
s
->
ssid
 = 
id
 | 0x80;

541 
	`DPRINTF
("Re£À˘edÅ¨gë %d\n", 
id
);

542 
s
->
cuºít_dev
 = s->
scsi_dev
[
id
];

543 
s
->
cuºít_èg
 = 
èg
;

544 
s
->
s˙é1
 |
LSI_SCNTL1_CON
;

545 
	`lsi_£t_pha£
(
s
, 
PHASE_MI
);

546 
s
->
msg_a˘i⁄
 = 
p
->
out
 ? 2 : 3;

547 
s
->
cuºít_dma_Àn
 = 
p
->
≥ndög
;

548 
s
->
dma_buf
 = 
NULL
;

549 
	`lsi_add_msg_byã
(
s
, 0x80);

550 i‡(
s
->
cuºít_èg
 & 
LSI_TAG_VALID
) {

551 
	`lsi_add_msg_byã
(
s
, 0x20);

552 
	`lsi_add_msg_byã
(
s
, 
èg
 & 0xff);

555 
s
->
a˘ive_comm™ds
--;

556 i‡(
n
 !
s
->
a˘ive_comm™ds
) {

557 
s
->
queue
[
n
] = s->queue[s->
a˘ive_comm™ds
];

559 
	}
}

563 
	$lsi_queue_èg
(
LSISèã
 *
s
, 
uöt32_t
 
èg
, uöt32_à
¨g
)

565 
lsi_queue
 *
p
;

566 
i
;

567 
i
 = 0; i < 
s
->
a˘ive_comm™ds
; i++) {

568 
p
 = &
s
->
queue
[
i
];

569 i‡(
p
->
èg
 ==Åag) {

570 i‡(
p
->
≥ndög
) {

571 
	`BADF
("Mu…ùÀ IOÖídög f‹Åag %d\n", 
èg
);

573 
p
->
≥ndög
 = 
¨g
;

574 i‡(
s
->
waôög
 == 1) {

576 
	`lsi_ª£À˘
(
s
, 
èg
);

579 
	`DPRINTF
("Queueög IOÅag=0x%x\n", 
èg
);

580 
p
->
≥ndög
 = 
¨g
;

585 
	`BADF
("IO wôh unknow¿èg %d\n", 
èg
);

587 
	}
}

590 
	$lsi_comm™d_com∂ëe
(*
›aque
, 
ªas⁄
, 
uöt32_t
 
èg
,

591 
uöt32_t
 
¨g
)

593 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

594 
out
;

596 
out
 = (
s
->
s°©1
 & 
PHASE_MASK
Ë=
PHASE_DO
;

597 i‡(
ªas⁄
 =
SCSI_REASON_DONE
) {

598 
	`DPRINTF
("Comm™d com∂ëê£n£=%d\n", ()
¨g
);

599 
s
->
£n£
 = 
¨g
;

600 i‡(
s
->
waôög
 && s->
dbc
 != 0) {

602 
	`lsi_bad_pha£
(
s
, 
out
, 
PHASE_ST
);

604 
	`lsi_£t_pha£
(
s
, 
PHASE_ST
);

606 
	`lsi_ªsume_s¸ùt
(
s
);

610 i‡(
s
->
waôög
 =1 || 
èg
 !s->
cuºít_èg
) {

611 i‡(
	`lsi_queue_èg
(
s
, 
èg
, 
¨g
))

614 
	`DPRINTF
("D©®ªadyÅag=0x%xÜí=%d\n", 
èg
, 
¨g
);

615 
s
->
cuºít_dma_Àn
 = 
¨g
;

616 i‡(!
s
->
waôög
)

618 i‡(
s
->
waôög
 =1 || s->
dbc
 == 0) {

619 
	`lsi_ªsume_s¸ùt
(
s
);

621 
	`lsi_do_dma
(
s
, 
out
);

623 
	}
}

625 
	$lsi_do_comm™d
(
LSISèã
 *
s
)

627 
uöt8_t
 
buf
[16];

628 
n
;

630 
	`DPRINTF
("Síd comm™dÜí=%d\n", 
s
->
dbc
);

631 i‡(
s
->
dbc
 > 16)

632 
s
->
dbc
 = 16;

633 
	`˝u_physiˇl_mem‹y_ªad
(
s
->
d«d
, 
buf
, s->
dbc
);

634 
s
->
sfbr
 = 
buf
[0];

635 
n
 = 
	`scsi_£nd_comm™d
(
s
->
cuºít_dev
, s->
cuºít_èg
, 
buf
, s->
cuºít_lun
);

636 i‡(
n
 > 0) {

637 
	`lsi_£t_pha£
(
s
, 
PHASE_DI
);

638 
	`scsi_ªad_d©a
(
s
->
cuºít_dev
, s->
cuºít_èg
);

639 } i‡(
n
 < 0) {

640 
	`lsi_£t_pha£
(
s
, 
PHASE_DO
);

641 
	`scsi_wrôe_d©a
(
s
->
cuºít_dev
, s->
cuºít_èg
);

643 i‡(
n
 && 
s
->
cuºít_dma_Àn
 == 0) {

645 
	`lsi_add_msg_byã
(
s
, 2);

646 
	`lsi_add_msg_byã
(
s
, 4);

647 
	`lsi_£t_pha£
(
s
, 
PHASE_MI
);

648 
s
->
msg_a˘i⁄
 = 1;

649 
	`lsi_queue_comm™d
(
s
);

651 
	}
}

653 
	$lsi_do_°©us
(
LSISèã
 *
s
)

655 
uöt8_t
 
£n£
;

656 
	`DPRINTF
("Gë sètu†Àn=%d sí£=%d\n", 
s
->
dbc
, s->
£n£
);

657 i‡(
s
->
dbc
 != 1)

658 
	`BADF
("Bad Status move\n");

659 
s
->
dbc
 = 1;

660 
£n£
 = 
s
->sense;

661 
s
->
sfbr
 = 
£n£
;

662 
	`˝u_physiˇl_mem‹y_wrôe
(
s
->
d«d
, &
£n£
, 1);

663 
	`lsi_£t_pha£
(
s
, 
PHASE_MI
);

664 
s
->
msg_a˘i⁄
 = 1;

665 
	`lsi_add_msg_byã
(
s
, 0);

666 
	}
}

668 
	$lsi_disc⁄√˘
(
LSISèã
 *
s
)

670 
s
->
s˙é1
 &~
LSI_SCNTL1_CON
;

671 
s
->
s°©1
 &~
PHASE_MASK
;

672 
	}
}

674 
	$lsi_do_msgö
(
LSISèã
 *
s
)

676 
Àn
;

677 
	`DPRINTF
("MesßgêöÜí=%d/%d\n", 
s
->
dbc
, s->
msg_Àn
);

678 
s
->
sfbr
 = s->
msg
[0];

679 
Àn
 = 
s
->
msg_Àn
;

680 i‡(
Àn
 > 
s
->
dbc
)

681 
Àn
 = 
s
->
dbc
;

682 
	`˝u_physiˇl_mem‹y_wrôe
(
s
->
d«d
, s->
msg
, 
Àn
);

684 
s
->
sidl
 = s->
msg
[
Àn
 - 1];

685 
s
->
msg_Àn
 -
Àn
;

686 i‡(
s
->
msg_Àn
) {

687 
	`memmove
(
s
->
msg
, s->msg + 
Àn
, s->
msg_Àn
);

691 
s
->
msg_a˘i⁄
) {

693 
	`lsi_£t_pha£
(
s
, 
PHASE_CMD
);

696 
	`lsi_disc⁄√˘
(
s
);

699 
	`lsi_£t_pha£
(
s
, 
PHASE_DO
);

702 
	`lsi_£t_pha£
(
s
, 
PHASE_DI
);

705 
	`ab‹t
();

708 
	}
}

711 
uöt8_t
 
	$lsi_gë_msgbyã
(
LSISèã
 *
s
)

713 
uöt8_t
 
d©a
;

714 
	`˝u_physiˇl_mem‹y_ªad
(
s
->
d«d
, &
d©a
, 1);

715 
s
->
d«d
++;

716 
s
->
dbc
--;

717  
d©a
;

718 
	}
}

720 
	$lsi_do_msgout
(
LSISèã
 *
s
)

722 
uöt8_t
 
msg
;

723 
Àn
;

725 
	`DPRINTF
("MSG ouàÀn=%d\n", 
s
->
dbc
);

726 
s
->
dbc
) {

727 
msg
 = 
	`lsi_gë_msgbyã
(
s
);

728 
s
->
sfbr
 = 
msg
;

730 
msg
) {

732 
	`DPRINTF
("MSG: Disconnect\n");

733 
	`lsi_disc⁄√˘
(
s
);

736 
	`DPRINTF
("MSG: No Operation\n");

737 
	`lsi_£t_pha£
(
s
, 
PHASE_CMD
);

740 
Àn
 = 
	`lsi_gë_msgbyã
(
s
);

741 
msg
 = 
	`lsi_gë_msgbyã
(
s
);

742 
	`DPRINTF
("Exãnded mesßgê0x%x (À¿%d)\n", 
msg
, 
Àn
);

743 
msg
) {

745 
	`DPRINTF
("SDTR (ignored)\n");

746 
s
->
dbc
 -= 2;

749 
	`DPRINTF
("WDTR (ignored)\n");

750 
s
->
dbc
 -= 1;

753 
bad
;

757 
s
->
cuºít_èg
 |
	`lsi_gë_msgbyã
(sË| 
LSI_TAG_VALID
;

758 
	`DPRINTF
("SIMPLE queuêèg=0x%x\n", 
s
->
cuºít_èg
 & 0xff);

761 
	`BADF
("HEAD queueÇot implemented\n");

762 
s
->
cuºít_èg
 |
	`lsi_gë_msgbyã
(sË| 
LSI_TAG_VALID
;

765 
	`BADF
("ORDERED queueÇot implemented\n");

766 
s
->
cuºít_èg
 |
	`lsi_gë_msgbyã
(sË| 
LSI_TAG_VALID
;

769 i‡((
msg
 & 0x80) == 0) {

770 
bad
;

772 
s
->
cuºít_lun
 = 
msg
 & 7;

773 
	`DPRINTF
("Sñe˘ LUN %d\n", 
s
->
cuºít_lun
);

774 
	`lsi_£t_pha£
(
s
, 
PHASE_CMD
);

779 
bad
:

780 
	`BADF
("Unim∂emíãd mesßgê0x%02x\n", 
msg
);

781 
	`lsi_£t_pha£
(
s
, 
PHASE_MI
);

782 
	`lsi_add_msg_byã
(
s
, 7);

783 
s
->
msg_a˘i⁄
 = 0;

784 
	}
}

787 
ölöe
 
öt32_t
 
	$sxt24
(
öt32_t
 
n
)

789  (
n
 << 8) >> 8;

790 
	}
}

792 
	$lsi_mem˝y
(
LSISèã
 *
s
, 
uöt32_t
 
de°
, uöt32_à
§c
, 
cou¡
)

794 
n
;

795 
uöt8_t
 
buf
[
TARGET_PAGE_SIZE
];

797 
	`DPRINTF
("mem˝y de° 0x%08x sr¯0x%08x cou¡ %d\n", 
de°
, 
§c
, 
cou¡
);

798 
cou¡
) {

799 
n
 = (
cou¡
 > 
TARGET_PAGE_SIZE
) ? TARGET_PAGE_SIZE : count;

800 
	`˝u_physiˇl_mem‹y_ªad
(
§c
, 
buf
, 
n
);

801 
	`˝u_physiˇl_mem‹y_wrôe
(
de°
, 
buf
, 
n
);

802 
§c
 +
n
;

803 
de°
 +
n
;

804 
cou¡
 -
n
;

806 
	}
}

808 
	$lsi_waô_ª£À˘
(
LSISèã
 *
s
)

810 
i
;

811 
	`DPRINTF
("Wait Reselect\n");

812 i‡(
s
->
cuºít_dma_Àn
)

813 
	`BADF
("Reselect withÖending DMA\n");

814 
i
 = 0; i < 
s
->
a˘ive_comm™ds
; i++) {

815 i‡(
s
->
queue
[
i
].
≥ndög
) {

816 
	`lsi_ª£À˘
(
s
, s->
queue
[
i
].
èg
);

820 i‡(
s
->
cuºít_dma_Àn
 == 0) {

821 
s
->
waôög
 = 1;

823 
	}
}

825 
	$lsi_execuã_s¸ùt
(
LSISèã
 *
s
)

827 
uöt32_t
 
ö¢
;

828 
uöt32_t
 
addr
;

829 
›code
;

831 
s
->
i°©1
 |
LSI_ISTAT1_SRUN
;

832 
agaö
:

833 
ö¢
 = 
	`ªad_dw‹d
(
s
, s->
d•
);

834 
addr
 = 
	`ªad_dw‹d
(
s
, s->
d•
 + 4);

835 
	`DPRINTF
("SCRIPTS d•=%08x opcodê%08xárg %08x\n", 
s
->
d•
, 
ö¢
, 
addr
);

836 
s
->
d•s
 = 
addr
;

837 
s
->
dcmd
 = 
ö¢
 >> 24;

838 
s
->
d•
 += 8;

839 
ö¢
 >> 30) {

841 i‡(
s
->
si°1
 & 
LSI_SIST1_STO
) {

842 
	`DPRINTF
("Delayed selectÅimeout\n");

843 
	`lsi_°›_s¸ùt
(
s
);

846 
s
->
dbc
 = 
ö¢
 & 0xffffff;

847 
s
->
rbc
 = s->
dbc
;

848 i‡(
ö¢
 & (1 << 29)) {

850 
addr
 = 
	`ªad_dw‹d
(
s
,áddr);

851 } i‡(
ö¢
 & (1 << 28)) {

852 
uöt32_t
 
buf
[2];

853 
öt32_t
 
off£t
;

855 
off£t
 = 
	`sxt24
(
addr
);

856 
	`˝u_physiˇl_mem‹y_ªad
(
s
->
dß
 + 
off£t
, (
uöt8_t
 *)
buf
, 8);

857 
s
->
dbc
 = 
	`˝u_to_À32
(
buf
[0]);

858 
addr
 = 
	`˝u_to_À32
(
buf
[1]);

860 i‡((
s
->
s°©1
 & 
PHASE_MASK
Ë!((
ö¢
 >> 24) & 7)) {

861 
	`DPRINTF
("WrongÖhase got %dÉxpected %d\n",

862 
s
->
s°©1
 & 
PHASE_MASK
, (
ö¢
 >> 24) & 7);

863 
	`lsi_s¸ùt_scsi_öãºu±
(
s
, 
LSI_SIST0_MA
, 0);

866 
s
->
d«d
 = 
addr
;

867 
s
->
s°©1
 & 0x7) {

868 
PHASE_DO
:

869 
s
->
waôög
 = 2;

870 
	`lsi_do_dma
(
s
, 1);

871 i‡(
s
->
waôög
)

872 
s
->
waôög
 = 3;

874 
PHASE_DI
:

875 
s
->
waôög
 = 2;

876 
	`lsi_do_dma
(
s
, 0);

877 i‡(
s
->
waôög
)

878 
s
->
waôög
 = 3;

880 
PHASE_CMD
:

881 
	`lsi_do_comm™d
(
s
);

883 
PHASE_ST
:

884 
	`lsi_do_°©us
(
s
);

886 
PHASE_MO
:

887 
	`lsi_do_msgout
(
s
);

889 
PHASE_MI
:

890 
	`lsi_do_msgö
(
s
);

893 
	`BADF
("Unim∂emíãdÖha£ %d\n", 
s
->
s°©1
 & 
PHASE_MASK
);

894 
	`exô
(1);

896 
s
->
dfifo
 = s->
dbc
 & 0xff;

897 
s
->
˘e°5
 = (s->˘e°5 & 0xfcË| ((s->
dbc
 >> 8) & 3);

898 
s
->
sbc
 = s->
dbc
;

899 
s
->
rbc
 -s->
dbc
;

900 
s
->
ua
 = 
addr
 + s->
dbc
;

902 
s
->
ü
 = s->
d•
 - 8;

906 
›code
 = (
ö¢
 >> 27) & 7;

907 i‡(
›code
 < 5) {

908 
uöt32_t
 
id
;

910 i‡(
ö¢
 & (1 << 25)) {

911 
id
 = 
	`ªad_dw‹d
(
s
, s->
dß
 + 
	`sxt24
(
ö¢
));

913 
id
 = 
addr
;

915 
id
 = (id >> 16) & 0xf;

916 i‡(
ö¢
 & (1 << 26)) {

917 
addr
 = 
s
->
d•
 + 
	`sxt24
(addr);

919 
s
->
d«d
 = 
addr
;

920 
›code
) {

922 
s
->
sdid
 = 
id
;

923 i‡(
s
->
cuºít_dma_Àn
 && (s->
ssid
 & 0xfË=
id
) {

924 
	`DPRINTF
("AÃódyÑe£À˘ed byÅ¨gë %d\n", 
id
);

927 
s
->
s°©0
 |
LSI_SSTAT0_WOA
;

928 
s
->
s˙é1
 &~
LSI_SCNTL1_IARB
;

929 i‡(
id
 >
LSI_MAX_DEVS
 || !
s
->
scsi_dev
[id]) {

930 
	`DPRINTF
("Sñe˘edáb£¡Å¨gë %d\n", 
id
);

931 
	`lsi_s¸ùt_scsi_öãºu±
(
s
, 0, 
LSI_SIST1_STO
);

932 
	`lsi_disc⁄√˘
(
s
);

935 
	`DPRINTF
("SelectedÅarget %d%s\n",

936 
id
, 
ö¢
 & (1 << 3) ? " ATN" : "");

940 
s
->
cuºít_dev
 = s->
scsi_dev
[
id
];

941 
s
->
cuºít_èg
 = 
id
 << 8;

942 
s
->
s˙é1
 |
LSI_SCNTL1_CON
;

943 i‡(
ö¢
 & (1 << 3)) {

944 
s
->
so˛
 |
LSI_SOCL_ATN
;

946 
	`lsi_£t_pha£
(
s
, 
PHASE_MO
);

949 
	`DPRINTF
("Wait Disconect\n");

950 
s
->
s˙é1
 &~
LSI_SCNTL1_CON
;

953 
	`lsi_waô_ª£À˘
(
s
);

956 
	`DPRINTF
("Set%s%s%s%s\n",

957 
ö¢
 & (1 << 3) ? " ATN" : "",

958 
ö¢
 & (1 << 6) ? " ACK" : "",

959 
ö¢
 & (1 << 9) ? " TM" : "",

960 
ö¢
 & (1 << 10) ? " CC" : "");

961 i‡(
ö¢
 & (1 << 3)) {

962 
s
->
so˛
 |
LSI_SOCL_ATN
;

963 
	`lsi_£t_pha£
(
s
, 
PHASE_MO
);

965 i‡(
ö¢
 & (1 << 9)) {

966 
	`BADF
("Target modeÇot implemented\n");

967 
	`exô
(1);

969 i‡(
ö¢
 & (1 << 10))

970 
s
->
ˇºy
 = 1;

973 
	`DPRINTF
("Clear%s%s%s%s\n",

974 
ö¢
 & (1 << 3) ? " ATN" : "",

975 
ö¢
 & (1 << 6) ? " ACK" : "",

976 
ö¢
 & (1 << 9) ? " TM" : "",

977 
ö¢
 & (1 << 10) ? " CC" : "");

978 i‡(
ö¢
 & (1 << 3)) {

979 
s
->
so˛
 &~
LSI_SOCL_ATN
;

981 i‡(
ö¢
 & (1 << 10))

982 
s
->
ˇºy
 = 0;

986 
uöt8_t
 
›0
;

987 
uöt8_t
 
›1
;

988 
uöt8_t
 
d©a8
;

989 
ªg
;

990 
›î©‹
;

991 #ifde‡
DEBUG_LSI


992 c⁄° *
›code_«mes
[3] =

994 c⁄° *
›î©‹_«mes
[8] =

998 
ªg
 = ((
ö¢
 >> 16) & 0x7f) | (insn & 0x80);

999 
d©a8
 = (
ö¢
 >> 8) & 0xff;

1000 
›code
 = (
ö¢
 >> 27) & 7;

1001 
›î©‹
 = (
ö¢
 >> 24) & 7;

1002 
	`DPRINTF
("%sÑeg 0x%x %s data8=0x%02x sfbr=0x%02x%s\n",

1003 
›code_«mes
[
›code
 - 5], 
ªg
,

1004 
›î©‹_«mes
[
›î©‹
], 
d©a8
, 
s
->
sfbr
,

1005 (
ö¢
 & (1 << 23)) ? " SFBR" : "");

1006 
›0
 = 
›1
 = 0;

1007 
›code
) {

1009 
›0
 = 
s
->
sfbr
;

1010 
›1
 = 
d©a8
;

1013 i‡(
›î©‹
)

1014 
›0
 = 
	`lsi_ªg_ªadb
(
s
, 
ªg
);

1015 
›1
 = 
d©a8
;

1018 i‡(
›î©‹
)

1019 
›0
 = 
	`lsi_ªg_ªadb
(
s
, 
ªg
);

1020 i‡(
ö¢
 & (1 << 23)) {

1021 
›1
 = 
s
->
sfbr
;

1023 
›1
 = 
d©a8
;

1028 
›î©‹
) {

1030 
›0
 = 
›1
;

1033 
›1
 = 
›0
 >> 7;

1034 
›0
 = (›0 << 1Ë| 
s
->
ˇºy
;

1035 
s
->
ˇºy
 = 
›1
;

1038 
›0
 |
›1
;

1041 
›0
 |
›1
;

1044 
›0
 &
›1
;

1047 
›1
 = 
›0
 & 1;

1048 
›0
 = (›0 >> 1Ë| (
s
->
ˇºy
 << 7);

1051 
›0
 +
›1
;

1052 
s
->
ˇºy
 = 
›0
 < 
›1
;

1055 
›0
 +
›1
 + 
s
->
ˇºy
;

1056 i‡(
s
->
ˇºy
)

1057 
s
->
ˇºy
 = 
›0
 <
›1
;

1059 
s
->
ˇºy
 = 
›0
 < 
›1
;

1063 
›code
) {

1066 
	`lsi_ªg_wrôeb
(
s
, 
ªg
, 
›0
);

1069 
s
->
sfbr
 = 
›0
;

1077 
c⁄d
;

1078 
jmp
;

1080 i‡((
ö¢
 & 0x002e0000) == 0) {

1081 
	`DPRINTF
("NOP\n");

1084 i‡(
s
->
si°1
 & 
LSI_SIST1_STO
) {

1085 
	`DPRINTF
("Delayed selectÅimeout\n");

1086 
	`lsi_°›_s¸ùt
(
s
);

1089 
c⁄d
 = 
jmp
 = (
ö¢
 & (1 << 19)) != 0;

1090 i‡(
c⁄d
 =
jmp
 && (
ö¢
 & (1 << 21))) {

1091 
	`DPRINTF
("Com∑ª c¨ry %d\n", 
s
->
ˇºy
 =
jmp
);

1092 
c⁄d
 = 
s
->
ˇºy
 != 0;

1094 i‡(
c⁄d
 =
jmp
 && (
ö¢
 & (1 << 17))) {

1095 
	`DPRINTF
("CompareÖhase %d %c= %d\n",

1096 (
s
->
s°©1
 & 
PHASE_MASK
),

1097 
jmp
 ? '=' : '!',

1098 ((
ö¢
 >> 24) & 7));

1099 
c⁄d
 = (
s
->
s°©1
 & 
PHASE_MASK
Ë=((
ö¢
 >> 24) & 7);

1101 i‡(
c⁄d
 =
jmp
 && (
ö¢
 & (1 << 18))) {

1102 
uöt8_t
 
mask
;

1104 
mask
 = (~
ö¢
 >> 8) & 0xff;

1105 
	`DPRINTF
("Compare data 0x%x & 0x%x %c= 0x%x\n",

1106 
s
->
sfbr
, 
mask
, 
jmp
 ? '=' : '!', 
ö¢
 & mask);

1107 
c⁄d
 = (
s
->
sfbr
 & 
mask
Ë=(
ö¢
 & mask);

1109 i‡(
c⁄d
 =
jmp
) {

1110 i‡(
ö¢
 & (1 << 23)) {

1112 
addr
 = 
s
->
d•
 + 
	`sxt24
(addr);

1114 (
ö¢
 >> 27) & 7) {

1116 
	`DPRINTF
("Jum∞tÿ0x%08x\n", 
addr
);

1117 
s
->
d•
 = 
addr
;

1120 
	`DPRINTF
("CÆ»0x%08x\n", 
addr
);

1121 
s
->
ãmp
 = s->
d•
;

1122 
s
->
d•
 = 
addr
;

1125 
	`DPRINTF
("Rëu∫Åÿ0x%08x\n", 
s
->
ãmp
);

1126 
s
->
d•
 = s->
ãmp
;

1129 
	`DPRINTF
("I¡îru± 0x%08x\n", 
s
->
d•s
);

1130 i‡((
ö¢
 & (1 << 20)) != 0) {

1131 
s
->
i°©0
 |
LSI_ISTAT0_INTF
;

1132 
	`lsi_upd©e_úq
(
s
);

1134 
	`lsi_s¸ùt_dma_öãºu±
(
s
, 
LSI_DSTAT_SIR
);

1138 
	`DPRINTF
("IllegalÅransfer control\n");

1139 
	`lsi_s¸ùt_dma_öãºu±
(
s
, 
LSI_DSTAT_IID
);

1143 
	`DPRINTF
("Control condition failed\n");

1149 i‡((
ö¢
 & (1 << 29)) == 0) {

1151 
uöt32_t
 
de°
;

1155 
de°
 = 
	`ªad_dw‹d
(
s
, s->
d•
);

1156 
s
->
d•
 += 4;

1157 
	`lsi_mem˝y
(
s
, 
de°
, 
addr
, 
ö¢
 & 0xffffff);

1159 
uöt8_t
 
d©a
[7];

1160 
ªg
;

1161 
n
;

1162 
i
;

1164 i‡(
ö¢
 & (1 << 28)) {

1165 
addr
 = 
s
->
dß
 + 
	`sxt24
(addr);

1167 
n
 = (
ö¢
 & 7);

1168 
ªg
 = (
ö¢
 >> 16) & 0xff;

1169 i‡(
ö¢
 & (1 << 24)) {

1170 
	`˝u_physiˇl_mem‹y_ªad
(
addr
, 
d©a
, 
n
);

1171 
	`DPRINTF
("LﬂdÑeg 0x%x sizê%dádd∏0x%08x = %08x\n", 
ªg
, 
n
,

1172 
addr
, *(*)
d©a
);

1173 
i
 = 0; i < 
n
; i++) {

1174 
	`lsi_ªg_wrôeb
(
s
, 
ªg
 + 
i
, 
d©a
[i]);

1177 
	`DPRINTF
("St‹êªg 0x%x sizê%dádd∏0x%08x\n", 
ªg
, 
n
, 
addr
);

1178 
i
 = 0; i < 
n
; i++) {

1179 
d©a
[
i
] = 
	`lsi_ªg_ªadb
(
s
, 
ªg
 + i);

1181 
	`˝u_physiˇl_mem‹y_wrôe
(
addr
, 
d©a
, 
n
);

1186 i‡(
s
->
i°©1
 & 
LSI_ISTAT1_SRUN
 && !s->
waôög
) {

1187 i‡(
s
->
d˙é
 & 
LSI_DCNTL_SSM
) {

1188 
	`lsi_s¸ùt_dma_öãºu±
(
s
, 
LSI_DSTAT_SSI
);

1190 
agaö
;

1193 
	`DPRINTF
("SCRIPTSÉxecution stopped\n");

1194 
	}
}

1196 
uöt8_t
 
	$lsi_ªg_ªadb
(
LSISèã
 *
s
, 
off£t
)

1198 
uöt8_t
 
tmp
;

1199 
	#CASE_GET_REG32
(
«me
, 
addr
) \

1200 
addr
:  
s
->
«me
 & 0xff; \

1201 
addr
 + 1:  (
s
->
«me
 >> 8) & 0xff; \

1202 
addr
 + 2:  (
s
->
«me
 >> 16) & 0xff; \

1203 
addr
 + 3:  (
s
->
«me
 >> 24Ë& 0xff;

	)

1205 #ifde‡
DEBUG_LSI_REG


1206 
	`DPRINTF
("RódÑeg %x\n", 
off£t
);

1208 
off£t
) {

1210  
s
->
s˙é0
;

1212  
s
->
s˙é1
;

1214  
s
->
s˙é2
;

1216  
s
->
s˙é3
;

1218  
s
->
scid
;

1220  
s
->
sx„r
;

1222  
s
->
sdid
;

1226  
s
->
ssid
;

1232 
tmp
 = 
s
->
d°©
 | 0x80;

1233 i‡((
s
->
i°©0
 & 
LSI_ISTAT0_INTF
) == 0)

1234 
s
->
d°©
 = 0;

1235 
	`lsi_upd©e_úq
(
s
);

1236  
tmp
;

1238  
s
->
s°©0
;

1240  
s
->
s°©1
;

1242  
s
->
s˙é1
 & 
LSI_SCNTL1_CON
 ? 0 : 2;

1243 
	`CASE_GET_REG32
(
dß
, 0x10)

1245  
s
->
i°©0
;

1247  
s
->
mbox0
;

1249  
s
->
mbox1
;

1255 
tmp
 = 
LSI_CTEST2_DACK
 | 
LSI_CTEST2_CM
;

1256 i‡(
s
->
i°©0
 & 
LSI_ISTAT0_SIGP
) {

1257 
s
->
i°©0
 &~
LSI_ISTAT0_SIGP
;

1258 
tmp
 |
LSI_CTEST2_SIGP
;

1260  
tmp
;

1262  
s
->
˘e°3
;

1263 
	`CASE_GET_REG32
(
ãmp
, 0x1c)

1267  
s
->
˘e°4
;

1269  
s
->
˘e°5
;

1271  
s
->
dbc
 & 0xff;

1273  (
s
->
dbc
 >> 8) & 0xff;

1275  (
s
->
dbc
 >> 16) & 0xff;

1277  
s
->
dcmd
;

1278 
	`CASE_GET_REG32
(
d•
, 0x2c)

1279 
	`CASE_GET_REG32
(
d•s
, 0x30)

1280 
	`CASE_GET_REG32
(
s¸©ch
[0], 0x34)

1282  
s
->
dmode
;

1284  
s
->
dõn
;

1286  
s
->
d˙é
;

1288  
s
->
sõn0
;

1290  
s
->
sõn1
;

1292 
tmp
 = 
s
->
si°0
;

1293 
s
->
si°0
 = 0;

1294 
	`lsi_upd©e_úq
(
s
);

1295  
tmp
;

1297 
tmp
 = 
s
->
si°1
;

1298 
s
->
si°1
 = 0;

1299 
	`lsi_upd©e_úq
(
s
);

1300  
tmp
;

1304  
s
->
°ime0
;

1306  
s
->
ª•id0
;

1308  
s
->
ª•id1
;

1310  
s
->
°e°1
;

1312  
s
->
°e°2
;

1314  
s
->
°e°3
;

1318  
s
->
sidl
;

1322  
s
->
c˙é0
;

1324  
s
->
c˙é1
;

1327 i‡((
s
->
s°©1
 & 
PHASE_MASK
Ë=
PHASE_MI
)

1328  
s
->
msg
[0];

1332 
	`CASE_GET_REG32
(
mmrs
, 0xa0)

1333 
	`CASE_GET_REG32
(
mmws
, 0xa4)

1334 
	`CASE_GET_REG32
(
sfs
, 0xa8)

1335 
	`CASE_GET_REG32
(
drs
, 0xac)

1336 
	`CASE_GET_REG32
(
sbms
, 0xb0)

1337 
	`CASE_GET_REG32
(
dmbs
, 0xb4)

1338 
	`CASE_GET_REG32
(
d«d64
, 0xb8)

1339 
	`CASE_GET_REG32
(
pmjad1
, 0xc0)

1340 
	`CASE_GET_REG32
(
pmjad2
, 0xc4)

1341 
	`CASE_GET_REG32
(
rbc
, 0xc8)

1342 
	`CASE_GET_REG32
(
ua
, 0xcc)

1343 
	`CASE_GET_REG32
(
ü
, 0xd4)

1344 
	`CASE_GET_REG32
(
sbc
, 0xd8)

1345 
	`CASE_GET_REG32
(
csbc
, 0xdc)

1347 i‡(
off£t
 >= 0x5c && offset < 0xa0) {

1348 
n
;

1349 
shi·
;

1350 
n
 = (
off£t
 - 0x58) >> 2;

1351 
shi·
 = (
off£t
 & 3) * 8;

1352  (
s
->
s¸©ch
[
n
] >> 
shi·
) & 0xff;

1354 #i‚de‡
CONFIG_DM


1355 
	`BADF
("ªadb 0x%x\n", 
off£t
);

1356 
	`exô
(1);

1361 #unde‡
CASE_GET_REG32


1362 
	}
}

1364 
	$lsi_ªg_wrôeb
(
LSISèã
 *
s
, 
off£t
, 
uöt8_t
 
vÆ
)

1366 
	#CASE_SET_REG32
(
«me
, 
addr
) \

1367 
addr
 : 
s
->
«me
 &0xffffff00; s->«mê|
vÆ
; ; \

1368 
addr
 + 1: 
s
->
«me
 &0xffff00ff; s->«mê|
vÆ
 << 8; ; \

1369 
addr
 + 2: 
s
->
«me
 &0xff00ffff; s->«mê|
vÆ
 << 16; ; \

1370 
addr
 + 3: 
s
->
«me
 &0x00ffffff; s->«mê|
vÆ
 << 24; ;

	)

1372 #ifde‡
DEBUG_LSI_REG


1373 
	`DPRINTF
("Wrôêªg %x = %02x\n", 
off£t
, 
vÆ
);

1375 
off£t
) {

1377 
s
->
s˙é0
 = 
vÆ
;

1378 i‡(
vÆ
 & 
LSI_SCNTL0_START
) {

1379 
	`BADF
("Start sequenceÇot implemented\n");

1383 
s
->
s˙é1
 = 
vÆ
 & ~
LSI_SCNTL1_SST
;

1384 i‡(
vÆ
 & 
LSI_SCNTL1_IARB
) {

1385 
	`BADF
("Immediate ArbritrationÇot implemented\n");

1387 i‡(
vÆ
 & 
LSI_SCNTL1_RST
) {

1388 
s
->
s°©0
 |
LSI_SSTAT0_RST
;

1389 
	`lsi_s¸ùt_scsi_öãºu±
(
s
, 
LSI_SIST0_RST
, 0);

1391 
s
->
s°©0
 &~
LSI_SSTAT0_RST
;

1395 
vÆ
 &~(
LSI_SCNTL2_WSR
 | 
LSI_SCNTL2_WSS
);

1396 
s
->
s˙é3
 = 
vÆ
;

1399 
s
->
s˙é3
 = 
vÆ
;

1402 
s
->
scid
 = 
vÆ
;

1405 
s
->
sx„r
 = 
vÆ
;

1408 i‡((
vÆ
 & 0xfË!(
s
->
ssid
 & 0xf))

1409 
	`BADF
("Destination ID doesÇot match SSID\n");

1410 
s
->
sdid
 = 
vÆ
 & 0xf;

1417 
s
->
sfbr
 = 
vÆ
;

1422 
	`CASE_SET_REG32
(
dß
, 0x10)

1424 
s
->
i°©0
 = (s->i°©0 & 0x0fË| (
vÆ
 & 0xf0);

1425 i‡(
vÆ
 & 
LSI_ISTAT0_ABRT
) {

1426 
	`lsi_s¸ùt_dma_öãºu±
(
s
, 
LSI_DSTAT_ABRT
);

1428 i‡(
vÆ
 & 
LSI_ISTAT0_INTF
) {

1429 
s
->
i°©0
 &~
LSI_ISTAT0_INTF
;

1430 
	`lsi_upd©e_úq
(
s
);

1432 i‡(
s
->
waôög
 =1 && 
vÆ
 & 
LSI_ISTAT0_SIGP
) {

1433 
	`DPRINTF
("Woken by SIGP\n");

1434 
s
->
waôög
 = 0;

1435 
s
->
d•
 = s->
d«d
;

1436 
	`lsi_execuã_s¸ùt
(
s
);

1438 i‡(
vÆ
 & 
LSI_ISTAT0_SRST
) {

1439 
	`lsi_so·_ª£t
(
s
);

1442 
s
->
mbox0
 = 
vÆ
;

1444 
s
->
mbox1
 = 
vÆ
;

1446 
s
->
˘e°3
 = 
vÆ
 & 0x0f;

1448 
	`CASE_SET_REG32
(
ãmp
, 0x1c)

1450 i‡(
vÆ
 & 7) {

1451 
	`BADF
("Unim∂emíãd CTEST4-FBL 0x%x\n", 
vÆ
);

1453 
s
->
˘e°4
 = 
vÆ
;

1456 i‡(
vÆ
 & (
LSI_CTEST5_ADCK
 | 
LSI_CTEST5_BBCK
)) {

1457 
	`BADF
("CTEST5 DMA incrementÇot implemented\n");

1459 
s
->
˘e°5
 = 
vÆ
;

1462 
s
->
d•
 &= 0xffffff00;

1463 
s
->
d•
 |
vÆ
;

1466 
s
->
d•
 &= 0xffff00ff;

1467 
s
->
d•
 |
vÆ
 << 8;

1470 
s
->
d•
 &= 0xff00ffff;

1471 
s
->
d•
 |
vÆ
 << 16;

1474 
s
->
d•
 &= 0x00ffffff;

1475 
s
->
d•
 |
vÆ
 << 24;

1476 i‡((
s
->
dmode
 & 
LSI_DMODE_MAN
) == 0

1477 && (
s
->
i°©1
 & 
LSI_ISTAT1_SRUN
) == 0)

1478 
	`lsi_execuã_s¸ùt
(
s
);

1480 
	`CASE_SET_REG32
(
d•s
, 0x30)

1481 
	`CASE_SET_REG32
(
s¸©ch
[0], 0x34)

1483 i‡(
vÆ
 & (
LSI_DMODE_SIOM
 | 
LSI_DMODE_DIOM
)) {

1484 
	`BADF
("IO mappingsÇot implemented\n");

1486 
s
->
dmode
 = 
vÆ
;

1489 
s
->
dõn
 = 
vÆ
;

1490 
	`lsi_upd©e_úq
(
s
);

1493 
s
->
d˙é
 = 
vÆ
 & ~(
LSI_DCNTL_PFF
 | 
LSI_DCNTL_STD
);

1494 i‡((
vÆ
 & 
LSI_DCNTL_STD
Ë&& (
s
->
i°©1
 & 
LSI_ISTAT1_SRUN
) == 0)

1495 
	`lsi_execuã_s¸ùt
(
s
);

1498 
s
->
sõn0
 = 
vÆ
;

1499 
	`lsi_upd©e_úq
(
s
);

1502 
s
->
sõn1
 = 
vÆ
;

1503 
	`lsi_upd©e_úq
(
s
);

1508 
s
->
°ime0
 = 
vÆ
;

1511 i‡(
vÆ
 & 0xf) {

1512 
	`DPRINTF
("GeneralÖurposeÅimerÇot implemented\n");

1515 
	`lsi_s¸ùt_scsi_öãºu±
(
s
, 0, 
LSI_SIST1_GEN
);

1519 
s
->
ª•id0
 = 
vÆ
;

1522 
s
->
ª•id1
 = 
vÆ
;

1525 
s
->
°e°1
 = 
vÆ
;

1528 i‡(
vÆ
 & 1) {

1529 
	`BADF
("LowÜevel modeÇot implemented\n");

1531 
s
->
°e°2
 = 
vÆ
;

1534 i‡(
vÆ
 & 0x41) {

1535 
	`BADF
("SCSI FIFOÅest modeÇot implemented\n");

1537 
s
->
°e°3
 = 
vÆ
;

1540 
s
->
c˙é0
 = 
vÆ
;

1543 
s
->
c˙é1
 = 
vÆ
;

1545 
	`CASE_SET_REG32
(
mmrs
, 0xa0)

1546 
	`CASE_SET_REG32
(
mmws
, 0xa4)

1547 
	`CASE_SET_REG32
(
sfs
, 0xa8)

1548 
	`CASE_SET_REG32
(
drs
, 0xac)

1549 
	`CASE_SET_REG32
(
sbms
, 0xb0)

1550 
	`CASE_SET_REG32
(
dmbs
, 0xb4)

1551 
	`CASE_SET_REG32
(
d«d64
, 0xb8)

1552 
	`CASE_SET_REG32
(
pmjad1
, 0xc0)

1553 
	`CASE_SET_REG32
(
pmjad2
, 0xc4)

1554 
	`CASE_SET_REG32
(
rbc
, 0xc8)

1555 
	`CASE_SET_REG32
(
ua
, 0xcc)

1556 
	`CASE_SET_REG32
(
ü
, 0xd4)

1557 
	`CASE_SET_REG32
(
sbc
, 0xd8)

1558 
	`CASE_SET_REG32
(
csbc
, 0xdc)

1560 i‡(
off£t
 >= 0x5c && offset < 0xa0) {

1561 
n
;

1562 
shi·
;

1563 
n
 = (
off£t
 - 0x58) >> 2;

1564 
shi·
 = (
off£t
 & 3) * 8;

1565 
s
->
s¸©ch
[
n
] &~(0xf‡<< 
shi·
);

1566 
s
->
s¸©ch
[
n
] |(
vÆ
 & 0xffË<< 
shi·
;

1568 
	`BADF
("Unh™dÀd wrôeb 0x%x = 0x%x\n", 
off£t
, 
vÆ
);

1571 #unde‡
CASE_SET_REG32


1572 
	}
}

1574 
	$lsi_mmio_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1576 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1578 
	`lsi_ªg_wrôeb
(
s
, 
addr
 & 0xff, 
vÆ
);

1579 
	}
}

1581 
	$lsi_mmio_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1583 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1585 
addr
 &= 0xff;

1586 
	`lsi_ªg_wrôeb
(
s
, 
addr
, 
vÆ
 & 0xff);

1587 
	`lsi_ªg_wrôeb
(
s
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

1588 
	}
}

1590 
	$lsi_mmio_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1592 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1594 
addr
 &= 0xff;

1595 
	`lsi_ªg_wrôeb
(
s
, 
addr
, 
vÆ
 & 0xff);

1596 
	`lsi_ªg_wrôeb
(
s
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

1597 
	`lsi_ªg_wrôeb
(
s
, 
addr
 + 2, (
vÆ
 >> 16) & 0xff);

1598 
	`lsi_ªg_wrôeb
(
s
, 
addr
 + 3, (
vÆ
 >> 24) & 0xff);

1599 
	}
}

1601 
uöt32_t
 
	$lsi_mmio_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1603 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1605  
	`lsi_ªg_ªadb
(
s
, 
addr
 & 0xff);

1606 
	}
}

1608 
uöt32_t
 
	$lsi_mmio_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1610 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1611 
uöt32_t
 
vÆ
;

1613 
addr
 &= 0xff;

1614 
vÆ
 = 
	`lsi_ªg_ªadb
(
s
, 
addr
);

1615 
vÆ
 |
	`lsi_ªg_ªadb
(
s
, 
addr
 + 1) << 8;

1616  
vÆ
;

1617 
	}
}

1619 
uöt32_t
 
	$lsi_mmio_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1621 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1622 
uöt32_t
 
vÆ
;

1623 
addr
 &= 0xff;

1624 
vÆ
 = 
	`lsi_ªg_ªadb
(
s
, 
addr
);

1625 
vÆ
 |
	`lsi_ªg_ªadb
(
s
, 
addr
 + 1) << 8;

1626 
vÆ
 |
	`lsi_ªg_ªadb
(
s
, 
addr
 + 2) << 16;

1627 
vÆ
 |
	`lsi_ªg_ªadb
(
s
, 
addr
 + 3) << 24;

1628  
vÆ
;

1629 
	}
}

1631 
CPURódMem‹yFunc
 *
	glsi_mmio_ªad‚
[3] = {

1632 
lsi_mmio_ªadb
,

1633 
lsi_mmio_ªadw
,

1634 
lsi_mmio_ªadl
,

1637 
CPUWrôeMem‹yFunc
 *
	glsi_mmio_wrôe‚
[3] = {

1638 
lsi_mmio_wrôeb
,

1639 
lsi_mmio_wrôew
,

1640 
lsi_mmio_wrôñ
,

1643 
	$lsi_øm_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1645 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1646 
uöt32_t
 
√wvÆ
;

1647 
shi·
;

1649 
addr
 &= 0x1fff;

1650 
√wvÆ
 = 
s
->
s¸ùt_øm
[
addr
 >> 2];

1651 
shi·
 = (
addr
 & 3) * 8;

1652 
√wvÆ
 &~(0xf‡<< 
shi·
);

1653 
√wvÆ
 |
vÆ
 << 
shi·
;

1654 
s
->
s¸ùt_øm
[
addr
 >> 2] = 
√wvÆ
;

1655 
	}
}

1657 
	$lsi_øm_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1659 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1660 
uöt32_t
 
√wvÆ
;

1662 
addr
 &= 0x1fff;

1663 
√wvÆ
 = 
s
->
s¸ùt_øm
[
addr
 >> 2];

1664 i‡(
addr
 & 2) {

1665 
√wvÆ
 = (√wvÆ & 0xffffË| (
vÆ
 << 16);

1667 
√wvÆ
 = (√wvÆ & 0xffff0000Ë| 
vÆ
;

1669 
s
->
s¸ùt_øm
[
addr
 >> 2] = 
√wvÆ
;

1670 
	}
}

1673 
	$lsi_øm_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1675 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1677 
addr
 &= 0x1fff;

1678 
s
->
s¸ùt_øm
[
addr
 >> 2] = 
vÆ
;

1679 
	}
}

1681 
uöt32_t
 
	$lsi_øm_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1683 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1684 
uöt32_t
 
vÆ
;

1686 
addr
 &= 0x1fff;

1687 
vÆ
 = 
s
->
s¸ùt_øm
[
addr
 >> 2];

1688 
vÆ
 >>(
addr
 & 3) * 8;

1689  
vÆ
 & 0xff;

1690 
	}
}

1692 
uöt32_t
 
	$lsi_øm_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1694 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1695 
uöt32_t
 
vÆ
;

1697 
addr
 &= 0x1fff;

1698 
vÆ
 = 
s
->
s¸ùt_øm
[
addr
 >> 2];

1699 i‡(
addr
 & 2)

1700 
vÆ
 >>= 16;

1701  
	`À16_to_˝u
(
vÆ
);

1702 
	}
}

1704 
uöt32_t
 
	$lsi_øm_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1706 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1708 
addr
 &= 0x1fff;

1709  
	`À32_to_˝u
(
s
->
s¸ùt_øm
[
addr
 >> 2]);

1710 
	}
}

1712 
CPURódMem‹yFunc
 *
	glsi_øm_ªad‚
[3] = {

1713 
lsi_øm_ªadb
,

1714 
lsi_øm_ªadw
,

1715 
lsi_øm_ªadl
,

1718 
CPUWrôeMem‹yFunc
 *
	glsi_øm_wrôe‚
[3] = {

1719 
lsi_øm_wrôeb
,

1720 
lsi_øm_wrôew
,

1721 
lsi_øm_wrôñ
,

1724 
uöt32_t
 
	$lsi_io_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

1726 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1727  
	`lsi_ªg_ªadb
(
s
, 
addr
 & 0xff);

1728 
	}
}

1730 
uöt32_t
 
	$lsi_io_ªadw
(*
›aque
, 
uöt32_t
 
addr
)

1732 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1733 
uöt32_t
 
vÆ
;

1734 
addr
 &= 0xff;

1735 
vÆ
 = 
	`lsi_ªg_ªadb
(
s
, 
addr
);

1736 
vÆ
 |
	`lsi_ªg_ªadb
(
s
, 
addr
 + 1) << 8;

1737  
vÆ
;

1738 
	}
}

1740 
uöt32_t
 
	$lsi_io_ªadl
(*
›aque
, 
uöt32_t
 
addr
)

1742 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1743 
uöt32_t
 
vÆ
;

1744 
addr
 &= 0xff;

1745 
vÆ
 = 
	`lsi_ªg_ªadb
(
s
, 
addr
);

1746 
vÆ
 |
	`lsi_ªg_ªadb
(
s
, 
addr
 + 1) << 8;

1747 
vÆ
 |
	`lsi_ªg_ªadb
(
s
, 
addr
 + 2) << 16;

1748 
vÆ
 |
	`lsi_ªg_ªadb
(
s
, 
addr
 + 3) << 24;

1749  
vÆ
;

1750 
	}
}

1752 
	$lsi_io_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

1754 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1755 
	`lsi_ªg_wrôeb
(
s
, 
addr
 & 0xff, 
vÆ
);

1756 
	}
}

1758 
	$lsi_io_wrôew
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

1760 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1761 
addr
 &= 0xff;

1762 
	`lsi_ªg_wrôeb
(
s
, 
addr
, 
vÆ
 & 0xff);

1763 
	`lsi_ªg_wrôeb
(
s
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

1764 
	}
}

1766 
	$lsi_io_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

1768 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1769 
addr
 &= 0xff;

1770 
	`lsi_ªg_wrôeb
(
s
, 
addr
, 
vÆ
 & 0xff);

1771 
	`lsi_ªg_wrôeb
(
s
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

1772 
	`lsi_ªg_wrôeb
(
s
, 
addr
 + 2, (
vÆ
 >> 16) & 0xff);

1773 
	`lsi_ªg_wrôeb
(
s
, 
addr
 + 2, (
vÆ
 >> 24) & 0xff);

1774 
	}
}

1776 
	$lsi_io_m≠func
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

1777 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

1779 
LSISèã
 *
s
 = (LSISèã *)
pci_dev
;

1781 
	`DPRINTF
("M≠pög IOáà%08x\n", 
addr
);

1783 
	`ªgi°î_i›‹t_wrôe
(
addr
, 256, 1, 
lsi_io_wrôeb
, 
s
);

1784 
	`ªgi°î_i›‹t_ªad
(
addr
, 256, 1, 
lsi_io_ªadb
, 
s
);

1785 
	`ªgi°î_i›‹t_wrôe
(
addr
, 256, 2, 
lsi_io_wrôew
, 
s
);

1786 
	`ªgi°î_i›‹t_ªad
(
addr
, 256, 2, 
lsi_io_ªadw
, 
s
);

1787 
	`ªgi°î_i›‹t_wrôe
(
addr
, 256, 4, 
lsi_io_wrôñ
, 
s
);

1788 
	`ªgi°î_i›‹t_ªad
(
addr
, 256, 4, 
lsi_io_ªadl
, 
s
);

1789 
	}
}

1791 
	$lsi_øm_m≠func
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

1792 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

1794 
LSISèã
 *
s
 = (LSISèã *)
pci_dev
;

1796 
	`DPRINTF
("M≠pögÑamáà%08x\n", 
addr
);

1797 
s
->
s¸ùt_øm_ba£
 = 
addr
;

1798 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0, 0x2000, 
s
->
øm_io_addr
);

1799 
	}
}

1801 
	$lsi_mmio_m≠func
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

1802 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

1804 
LSISèã
 *
s
 = (LSISèã *)
pci_dev
;

1806 
	`DPRINTF
("M≠pögÑegi°î†© %08x\n", 
addr
);

1807 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0, 0x400, 
s
->
mmio_io_addr
);

1808 
	}
}

1810 
	$lsi_scsi_©èch
(*
›aque
, 
BlockDrivîSèã
 *
bd
, 
id
)

1812 
LSISèã
 *
s
 = (LSISèã *)
›aque
;

1814 i‡(
id
 < 0) {

1815 
id
 = 0; id < 
LSI_MAX_DEVS
; id++) {

1816 i‡(
s
->
scsi_dev
[
id
] =
NULL
)

1820 i‡(
id
 >
LSI_MAX_DEVS
) {

1821 
	`BADF
("Bad Devi˚ ID %d\n", 
id
);

1824 i‡(
s
->
scsi_dev
[
id
]) {

1825 
	`DPRINTF
("De°royög devi˚ %d\n", 
id
);

1826 
	`scsi_disk_de°roy
(
s
->
scsi_dev
[
id
]);

1828 
	`DPRINTF
("Aâachög block devi˚ %d\n", 
id
);

1829 
s
->
scsi_dev
[
id
] = 
	`scsi_disk_öô
(
bd
, 1, 
lsi_comm™d_com∂ëe
, s);

1830 
	}
}

1832 *
	$lsi_scsi_öô
(
PCIBus
 *
bus
, 
dev‚
)

1834 
LSISèã
 *
s
;

1836 
s
 = (
LSISèã
 *)
	`pci_ªgi°î_devi˚
(
bus
, "LSI53C895A SCSI HBA",

1837 (*
s
), 
dev‚
, 
NULL
, NULL);

1838 i‡(
s
 =
NULL
) {

1839 
	`Ârötf
(
°dîr
, "lsi-scsi: FailedÅoÑegister PCI device\n");

1840  
NULL
;

1843 
s
->
pci_dev
.
c⁄fig
[0x00] = 0x00;

1844 
s
->
pci_dev
.
c⁄fig
[0x01] = 0x10;

1845 
s
->
pci_dev
.
c⁄fig
[0x02] = 0x12;

1846 
s
->
pci_dev
.
c⁄fig
[0x03] = 0x00;

1847 
s
->
pci_dev
.
c⁄fig
[0x0b] = 0x01;

1848 
s
->
pci_dev
.
c⁄fig
[0x3d] = 0x01;

1850 
s
->
mmio_io_addr
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
lsi_mmio_ªad‚
,

1851 
lsi_mmio_wrôe‚
, 
s
);

1852 
s
->
øm_io_addr
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
lsi_øm_ªad‚
,

1853 
lsi_øm_wrôe‚
, 
s
);

1855 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
s
, 0, 256,

1856 
PCI_ADDRESS_SPACE_IO
, 
lsi_io_m≠func
);

1857 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
s
, 1, 0x400,

1858 
PCI_ADDRESS_SPACE_MEM
, 
lsi_mmio_m≠func
);

1859 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
s
, 2, 0x2000,

1860 
PCI_ADDRESS_SPACE_MEM
, 
lsi_øm_m≠func
);

1861 
s
->
queue
 = 
	`qemu_mÆloc
((
lsi_queue
));

1862 
s
->
queue_Àn
 = 1;

1863 
s
->
a˘ive_comm™ds
 = 0;

1865 
	`lsi_so·_ª£t
(
s
);

1867  
s
;

1868 
	}
}

	@m48t59.c

24 
	~"vl.h
"

25 
	~"m48t59.h
"

29 #i‡
deföed
(
DEBUG_NVRAM
)

30 
	#NVRAM_PRINTF
(
fmt
, 
¨gs
...Ëdÿ{ 
	`¥ötf
(fmà, ##¨gs); } 0)

	)

32 
	#NVRAM_PRINTF
(
fmt
, 
¨gs
...Ëdÿ{ } 0)

	)

40 
	sm48t59_t
 {

42 
	mty≥
;

44 
	mIRQ
;

45 
	mmem_ödex
;

46 
uöt32_t
 
	mmem_ba£
;

47 
uöt32_t
 
	mio_ba£
;

48 
uöt16_t
 
	msize
;

50 
time_t
 
	mtime_off£t
;

51 
time_t
 
	m°›_time
;

53 
time_t
 
	mÆ¨m
;

54 
QEMUTimî
 *
	mÆrm_timî
;

55 
QEMUTimî
 *
	mwd_timî
;

57 
uöt8_t
 
	mlock
;

58 
uöt16_t
 
	maddr
;

59 
uöt8_t
 *
	mbuf„r
;

64 
ölöe
 
uöt8_t
 
	$toBCD
 (
uöt8_t
 
vÆue
)

66  (((
vÆue
 / 10) % 10) << 4) | (value % 10);

67 
	}
}

69 
ölöe
 
uöt8_t
 
	$‰omBCD
 (
uöt8_t
 
BCD
)

71  ((
BCD
 >> 4) * 10) + (BCD & 0x0F);

72 
	}
}

75 
	$gë_time
 (
m48t59_t
 *
NVRAM
, 
tm
 *tm)

77 
time_t
 
t
;

79 
t
 = 
	`time
(
NULL
Ë+ 
NVRAM
->
time_off£t
;

80 #ifde‡
_WIN32


81 
	`mem˝y
(
tm
,
	`loˇ…ime
(&
t
),(*tm));

83 
	`loˇ…ime_r
 (&
t
, 
tm
) ;

85 
	}
}

87 
	$£t_time
 (
m48t59_t
 *
NVRAM
, 
tm
 *tm)

89 
time_t
 
now
, 
√w_time
;

91 
√w_time
 = 
	`mktime
(
tm
);

92 
now
 = 
	`time
(
NULL
);

93 
NVRAM
->
time_off£t
 = 
√w_time
 - 
now
;

94 
	}
}

97 
	$Æ¨m_cb
 (*
›aque
)

99 
tm
Åm, 
tm_now
;

100 
uöt64_t
 
√xt_time
;

101 
m48t59_t
 *
NVRAM
 = 
›aque
;

103 
	`pic_£t_úq
(
NVRAM
->
IRQ
, 1);

104 i‡((
NVRAM
->
buf„r
[0x1FF5] & 0x80) == 0 &&

105 (
NVRAM
->
buf„r
[0x1FF4] & 0x80) == 0 &&

106 (
NVRAM
->
buf„r
[0x1FF3] & 0x80) == 0 &&

107 (
NVRAM
->
buf„r
[0x1FF2] & 0x80) == 0) {

109 
	`gë_time
(
NVRAM
, &
tm_now
);

110 
	`mem˝y
(&
tm
, &
tm_now
, (tm));

111 
tm
.
tm_m⁄
++;

112 i‡(
tm
.
tm_m⁄
 == 13) {

113 
tm
.
tm_m⁄
 = 1;

114 
tm
.
tm_yór
++;

116 
√xt_time
 = 
	`mktime
(&
tm
);

117 } i‡((
NVRAM
->
buf„r
[0x1FF5] & 0x80) != 0 &&

118 (
NVRAM
->
buf„r
[0x1FF4] & 0x80) == 0 &&

119 (
NVRAM
->
buf„r
[0x1FF3] & 0x80) == 0 &&

120 (
NVRAM
->
buf„r
[0x1FF2] & 0x80) == 0) {

122 
√xt_time
 = 24 * 60 * 60 + 
	`mktime
(&
tm_now
);

123 } i‡((
NVRAM
->
buf„r
[0x1FF5] & 0x80) != 0 &&

124 (
NVRAM
->
buf„r
[0x1FF4] & 0x80) != 0 &&

125 (
NVRAM
->
buf„r
[0x1FF3] & 0x80) == 0 &&

126 (
NVRAM
->
buf„r
[0x1FF2] & 0x80) == 0) {

128 
√xt_time
 = 60 * 60 + 
	`mktime
(&
tm_now
);

129 } i‡((
NVRAM
->
buf„r
[0x1FF5] & 0x80) != 0 &&

130 (
NVRAM
->
buf„r
[0x1FF4] & 0x80) != 0 &&

131 (
NVRAM
->
buf„r
[0x1FF3] & 0x80) != 0 &&

132 (
NVRAM
->
buf„r
[0x1FF2] & 0x80) == 0) {

134 
√xt_time
 = 60 + 
	`mktime
(&
tm_now
);

137 
√xt_time
 = 1 + 
	`mktime
(&
tm_now
);

139 
	`qemu_mod_timî
(
NVRAM
->
Ærm_timî
, 
√xt_time
 * 1000);

140 
	`pic_£t_úq
(
NVRAM
->
IRQ
, 0);

141 
	}
}

144 
	$gë_Æ¨m
 (
m48t59_t
 *
NVRAM
, 
tm
 *tm)

146 #ifde‡
_WIN32


147 
	`mem˝y
(
tm
,
	`loˇ…ime
(&
NVRAM
->
Æ¨m
),(*tm));

149 
	`loˇ…ime_r
 (&
NVRAM
->
Æ¨m
, 
tm
);

151 
	}
}

153 
	$£t_Æ¨m
 (
m48t59_t
 *
NVRAM
, 
tm
 *tm)

155 
NVRAM
->
Æ¨m
 = 
	`mktime
(
tm
);

156 i‡(
NVRAM
->
Ærm_timî
 !
NULL
) {

157 
	`qemu_dñ_timî
(
NVRAM
->
Ærm_timî
);

158 
NVRAM
->
Ærm_timî
 = 
NULL
;

160 i‡(
NVRAM
->
Æ¨m
 - 
	`time
(
NULL
) > 0)

161 
	`qemu_mod_timî
(
NVRAM
->
Ærm_timî
, NVRAM->
Æ¨m
 * 1000);

162 
	}
}

165 
	$w©chdog_cb
 (*
›aque
)

167 
m48t59_t
 *
NVRAM
 = 
›aque
;

169 
NVRAM
->
buf„r
[0x1FF0] |= 0x80;

170 i‡(
NVRAM
->
buf„r
[0x1FF7] & 0x80) {

171 
NVRAM
->
buf„r
[0x1FF7] = 0x00;

172 
NVRAM
->
buf„r
[0x1FFC] &= ~0x40;

174 
	`qemu_sy°em_ª£t_ªque°
();

176 
	`pic_£t_úq
(
NVRAM
->
IRQ
, 1);

177 
	`pic_£t_úq
(
NVRAM
->
IRQ
, 0);

179 
	}
}

181 
	$£t_up_w©chdog
 (
m48t59_t
 *
NVRAM
, 
uöt8_t
 
vÆue
)

183 
uöt64_t
 
öãrvÆ
;

185 i‡(
NVRAM
->
wd_timî
 !
NULL
) {

186 
	`qemu_dñ_timî
(
NVRAM
->
wd_timî
);

187 
NVRAM
->
wd_timî
 = 
NULL
;

189 
NVRAM
->
buf„r
[0x1FF0] &= ~0x80;

190 i‡(
vÆue
 != 0) {

191 
öãrvÆ
 = (1 << (2 * (
vÆue
 & 0x03))) * ((value >> 2) & 0x1F);

192 
	`qemu_mod_timî
(
NVRAM
->
wd_timî
, ((
uöt64_t
)
	`time
(
NULL
) * 1000) +

193 ((
öãrvÆ
 * 1000) >> 4));

195 
	}
}

198 
	$m48t59_wrôe
 (
m48t59_t
 *
NVRAM
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

200 
tm
Åm;

201 
tmp
;

203 i‡(
addr
 > 0x1FF8 &&áddr < 0x2000)

204 
	`NVRAM_PRINTF
("%s: 0x%08x => 0x%08x\n", 
__func__
, 
addr
, 
vÆ
);

205 i‡(
NVRAM
->
ty≥
 == 8 &&

206 (
addr
 >= 0x1ff0 &&áddr <= 0x1ff7))

207 
do_wrôe
;

208 
addr
) {

217 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x7F);

218 i‡(
tmp
 >= 0 &&Åmp <= 59) {

219 
	`gë_Æ¨m
(
NVRAM
, &
tm
);

220 
tm
.
tm_£c
 = 
tmp
;

221 
NVRAM
->
buf„r
[0x1FF2] = 
vÆ
;

222 
	`£t_Æ¨m
(
NVRAM
, &
tm
);

227 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x7F);

228 i‡(
tmp
 >= 0 &&Åmp <= 59) {

229 
	`gë_Æ¨m
(
NVRAM
, &
tm
);

230 
tm
.
tm_mö
 = 
tmp
;

231 
NVRAM
->
buf„r
[0x1FF3] = 
vÆ
;

232 
	`£t_Æ¨m
(
NVRAM
, &
tm
);

237 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x3F);

238 i‡(
tmp
 >= 0 &&Åmp <= 23) {

239 
	`gë_Æ¨m
(
NVRAM
, &
tm
);

240 
tm
.
tm_hour
 = 
tmp
;

241 
NVRAM
->
buf„r
[0x1FF4] = 
vÆ
;

242 
	`£t_Æ¨m
(
NVRAM
, &
tm
);

247 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x1F);

248 i‡(
tmp
 != 0) {

249 
	`gë_Æ¨m
(
NVRAM
, &
tm
);

250 
tm
.
tm_mday
 = 
tmp
;

251 
NVRAM
->
buf„r
[0x1FF5] = 
vÆ
;

252 
	`£t_Æ¨m
(
NVRAM
, &
tm
);

257 
NVRAM
->
buf„r
[0x1FF6] = 
vÆ
;

261 
NVRAM
->
buf„r
[0x1FF7] = 
vÆ
;

262 
	`£t_up_w©chdog
(
NVRAM
, 
vÆ
);

266 
NVRAM
->
buf„r
[0x1FF8] = (
vÆ
 & ~0xA0) | 0x90;

270 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x7F);

271 i‡(
tmp
 >= 0 &&Åmp <= 59) {

272 
	`gë_time
(
NVRAM
, &
tm
);

273 
tm
.
tm_£c
 = 
tmp
;

274 
	`£t_time
(
NVRAM
, &
tm
);

276 i‡((
vÆ
 & 0x80Ë^ (
NVRAM
->
buf„r
[0x1FF9] & 0x80)) {

277 i‡(
vÆ
 & 0x80) {

278 
NVRAM
->
°›_time
 = 
	`time
(
NULL
);

280 
NVRAM
->
time_off£t
 +NVRAM->
°›_time
 - 
	`time
(
NULL
);

281 
NVRAM
->
°›_time
 = 0;

284 
NVRAM
->
buf„r
[0x1FF9] = 
vÆ
 & 0x80;

288 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x7F);

289 i‡(
tmp
 >= 0 &&Åmp <= 59) {

290 
	`gë_time
(
NVRAM
, &
tm
);

291 
tm
.
tm_mö
 = 
tmp
;

292 
	`£t_time
(
NVRAM
, &
tm
);

297 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x3F);

298 i‡(
tmp
 >= 0 &&Åmp <= 23) {

299 
	`gë_time
(
NVRAM
, &
tm
);

300 
tm
.
tm_hour
 = 
tmp
;

301 
	`£t_time
(
NVRAM
, &
tm
);

306 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x07);

307 
	`gë_time
(
NVRAM
, &
tm
);

308 
tm
.
tm_wday
 = 
tmp
;

309 
	`£t_time
(
NVRAM
, &
tm
);

310 
NVRAM
->
buf„r
[0x1FFC] = 
vÆ
 & 0x40;

314 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x1F);

315 i‡(
tmp
 != 0) {

316 
	`gë_time
(
NVRAM
, &
tm
);

317 
tm
.
tm_mday
 = 
tmp
;

318 
	`£t_time
(
NVRAM
, &
tm
);

323 
tmp
 = 
	`‰omBCD
(
vÆ
 & 0x1F);

324 i‡(
tmp
 >= 1 &&Åmp <= 12) {

325 
	`gë_time
(
NVRAM
, &
tm
);

326 
tm
.
tm_m⁄
 = 
tmp
 - 1;

327 
	`£t_time
(
NVRAM
, &
tm
);

332 
tmp
 = 
	`‰omBCD
(
vÆ
);

333 i‡(
tmp
 >= 0 &&Åmp <= 99) {

334 
	`gë_time
(
NVRAM
, &
tm
);

335 i‡(
NVRAM
->
ty≥
 == 8)

336 
tm
.
tm_yór
 = 
	`‰omBCD
(
vÆ
) + 68;

338 
tm
.
tm_yór
 = 
	`‰omBCD
(
vÆ
);

339 
	`£t_time
(
NVRAM
, &
tm
);

344 i‡(
addr
 >0x20 &&ádd∏<0x2F && (
NVRAM
->
lock
 & 1))

346 i‡(
addr
 >0x30 &&ádd∏<0x3F && (
NVRAM
->
lock
 & 2))

348 
do_wrôe
:

349 i‡(
addr
 < 
NVRAM
->
size
) {

350 
NVRAM
->
buf„r
[
addr
] = 
vÆ
 & 0xFF;

354 
	}
}

356 
uöt32_t
 
	$m48t59_ªad
 (
m48t59_t
 *
NVRAM
, 
uöt32_t
 
addr
)

358 
tm
Åm;

359 
uöt32_t
 
ªtvÆ
 = 0xFF;

361 i‡(
NVRAM
->
ty≥
 == 8 &&

362 (
addr
 >= 0x1ff0 &&áddr <= 0x1ff7))

363 
do_ªad
;

364 
addr
) {

367 
do_ªad
;

370 
ªtvÆ
 = 0;

374 
do_ªad
;

377 
do_ªad
;

380 
do_ªad
;

383 
do_ªad
;

386 
do_ªad
;

389 
	`£t_up_w©chdog
(
NVRAM
, NVRAM->
buf„r
[0x1FF7]);

390 
do_ªad
;

393 
do_ªad
;

396 
	`gë_time
(
NVRAM
, &
tm
);

397 
ªtvÆ
 = (
NVRAM
->
buf„r
[0x1FF9] & 0x80Ë| 
	`toBCD
(
tm
.
tm_£c
);

401 
	`gë_time
(
NVRAM
, &
tm
);

402 
ªtvÆ
 = 
	`toBCD
(
tm
.
tm_mö
);

406 
	`gë_time
(
NVRAM
, &
tm
);

407 
ªtvÆ
 = 
	`toBCD
(
tm
.
tm_hour
);

411 
	`gë_time
(
NVRAM
, &
tm
);

412 
ªtvÆ
 = 
NVRAM
->
buf„r
[0x1FFC] | 
tm
.
tm_wday
;

416 
	`gë_time
(
NVRAM
, &
tm
);

417 
ªtvÆ
 = 
	`toBCD
(
tm
.
tm_mday
);

421 
	`gë_time
(
NVRAM
, &
tm
);

422 
ªtvÆ
 = 
	`toBCD
(
tm
.
tm_m⁄
 + 1);

426 
	`gë_time
(
NVRAM
, &
tm
);

427 i‡(
NVRAM
->
ty≥
 == 8)

428 
ªtvÆ
 = 
	`toBCD
(
tm
.
tm_yór
 - 68);

430 
ªtvÆ
 = 
	`toBCD
(
tm
.
tm_yór
);

434 i‡(
addr
 >0x20 &&ádd∏<0x2F && (
NVRAM
->
lock
 & 1))

436 i‡(
addr
 >0x30 &&ádd∏<0x3F && (
NVRAM
->
lock
 & 2))

438 
do_ªad
:

439 i‡(
addr
 < 
NVRAM
->
size
) {

440 
ªtvÆ
 = 
NVRAM
->
buf„r
[
addr
];

444 i‡(
addr
 > 0x1FF9 &&áddr < 0x2000)

445 
	`NVRAM_PRINTF
("0x%08x <0x%08x\n", 
addr
, 
ªtvÆ
);

447  
ªtvÆ
;

448 
	}
}

450 
	$m48t59_£t_addr
 (
m48t59_t
 *
NVRAM
, 
uöt32_t
 
addr
)

452 
NVRAM
->
addr
 =áddr;

453 
	}
}

455 
	$m48t59_toggÀ_lock
 (
m48t59_t
 *
NVRAM
, 
lock
)

457 
NVRAM
->
lock
 ^= 1 <<Üock;

458 
	}
}

461 
	$NVRAM_wrôeb
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

463 
m48t59_t
 *
NVRAM
 = 
›aque
;

465 
addr
 -
NVRAM
->
io_ba£
;

466 
	`NVRAM_PRINTF
("0x%08x => 0x%08x\n", 
addr
, 
vÆ
);

467 
addr
) {

469 
NVRAM
->
addr
 &= ~0x00FF;

470 
NVRAM
->
addr
 |
vÆ
;

473 
NVRAM
->
addr
 &= ~0xFF00;

474 
NVRAM
->
addr
 |
vÆ
 << 8;

477 
	`m48t59_wrôe
(
NVRAM
, 
vÆ
, NVRAM->
addr
);

478 
NVRAM
->
addr
 = 0x0000;

483 
	}
}

485 
uöt32_t
 
	$NVRAM_ªadb
 (*
›aque
, 
uöt32_t
 
addr
)

487 
m48t59_t
 *
NVRAM
 = 
›aque
;

488 
uöt32_t
 
ªtvÆ
;

490 
addr
 -
NVRAM
->
io_ba£
;

491 
addr
) {

493 
ªtvÆ
 = 
	`m48t59_ªad
(
NVRAM
, NVRAM->
addr
);

496 
ªtvÆ
 = -1;

499 
	`NVRAM_PRINTF
("0x%08x <0x%08x\n", 
addr
, 
ªtvÆ
);

501  
ªtvÆ
;

502 
	}
}

504 
	$nvøm_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

506 
m48t59_t
 *
NVRAM
 = 
›aque
;

508 
addr
 -
NVRAM
->
mem_ba£
;

509 
	`m48t59_wrôe
(
NVRAM
, 
addr
, 
vÆue
 & 0xff);

510 
	}
}

512 
	$nvøm_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

514 
m48t59_t
 *
NVRAM
 = 
›aque
;

516 
addr
 -
NVRAM
->
mem_ba£
;

517 
	`m48t59_wrôe
(
NVRAM
, 
addr
, (
vÆue
 >> 8) & 0xff);

518 
	`m48t59_wrôe
(
NVRAM
, 
addr
 + 1, 
vÆue
 & 0xff);

519 
	}
}

521 
	$nvøm_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

523 
m48t59_t
 *
NVRAM
 = 
›aque
;

525 
addr
 -
NVRAM
->
mem_ba£
;

526 
	`m48t59_wrôe
(
NVRAM
, 
addr
, (
vÆue
 >> 24) & 0xff);

527 
	`m48t59_wrôe
(
NVRAM
, 
addr
 + 1, (
vÆue
 >> 16) & 0xff);

528 
	`m48t59_wrôe
(
NVRAM
, 
addr
 + 2, (
vÆue
 >> 8) & 0xff);

529 
	`m48t59_wrôe
(
NVRAM
, 
addr
 + 3, 
vÆue
 & 0xff);

530 
	}
}

532 
uöt32_t
 
	$nvøm_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

534 
m48t59_t
 *
NVRAM
 = 
›aque
;

535 
uöt32_t
 
ªtvÆ
;

537 
addr
 -
NVRAM
->
mem_ba£
;

538 
ªtvÆ
 = 
	`m48t59_ªad
(
NVRAM
, 
addr
);

539  
ªtvÆ
;

540 
	}
}

542 
uöt32_t
 
	$nvøm_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

544 
m48t59_t
 *
NVRAM
 = 
›aque
;

545 
uöt32_t
 
ªtvÆ
;

547 
addr
 -
NVRAM
->
mem_ba£
;

548 
ªtvÆ
 = 
	`m48t59_ªad
(
NVRAM
, 
addr
) << 8;

549 
ªtvÆ
 |
	`m48t59_ªad
(
NVRAM
, 
addr
 + 1);

550  
ªtvÆ
;

551 
	}
}

553 
uöt32_t
 
	$nvøm_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

555 
m48t59_t
 *
NVRAM
 = 
›aque
;

556 
uöt32_t
 
ªtvÆ
;

558 
addr
 -
NVRAM
->
mem_ba£
;

559 
ªtvÆ
 = 
	`m48t59_ªad
(
NVRAM
, 
addr
) << 24;

560 
ªtvÆ
 |
	`m48t59_ªad
(
NVRAM
, 
addr
 + 1) << 16;

561 
ªtvÆ
 |
	`m48t59_ªad
(
NVRAM
, 
addr
 + 2) << 8;

562 
ªtvÆ
 |
	`m48t59_ªad
(
NVRAM
, 
addr
 + 3);

563  
ªtvÆ
;

564 
	}
}

566 
CPUWrôeMem‹yFunc
 *
	gnvøm_wrôe
[] = {

567 &
nvøm_wrôeb
,

568 &
nvøm_wrôew
,

569 &
nvøm_wrôñ
,

572 
CPURódMem‹yFunc
 *
	gnvøm_ªad
[] = {

573 &
nvøm_ªadb
,

574 &
nvøm_ªadw
,

575 &
nvøm_ªadl
,

579 
m48t59_t
 *
	$m48t59_öô
 (
IRQ
, 
èrgë_ul⁄g
 
mem_ba£
,

580 
uöt32_t
 
io_ba£
, 
uöt16_t
 
size
,

581 
ty≥
)

583 
m48t59_t
 *
s
;

585 
s
 = 
	`qemu_mÆlocz
((
m48t59_t
));

586 i‡(!
s
)

587  
NULL
;

588 
s
->
buf„r
 = 
	`qemu_mÆlocz
(
size
);

589 i‡(!
s
->
buf„r
) {

590 
	`qemu_‰ì
(
s
);

591  
NULL
;

593 
s
->
IRQ
 = IRQ;

594 
s
->
size
 = size;

595 
s
->
mem_ba£
 = mem_base;

596 
s
->
io_ba£
 = io_base;

597 
s
->
addr
 = 0;

598 
s
->
ty≥
 =Åype;

599 i‡(
io_ba£
 != 0) {

600 
	`ªgi°î_i›‹t_ªad
(
io_ba£
, 0x04, 1, 
NVRAM_ªadb
, 
s
);

601 
	`ªgi°î_i›‹t_wrôe
(
io_ba£
, 0x04, 1, 
NVRAM_wrôeb
, 
s
);

603 i‡(
mem_ba£
 != 0) {

604 
s
->
mem_ödex
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
nvøm_ªad
, 
nvøm_wrôe
, s);

605 
	`˝u_ªgi°î_physiˇl_mem‹y
(
mem_ba£
, 0x4000, 
s
->
mem_ödex
);

607 i‡(
ty≥
 == 59) {

608 
s
->
Ærm_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, &
Æ¨m_cb
, s);

609 
s
->
wd_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, &
w©chdog_cb
, s);

611 
s
->
lock
 = 0;

613  
s
;

614 
	}
}

	@m48t59.h

1 #i‡!
deföed
 (
__M48T59_H__
)

2 
	#__M48T59_H__


	)

4 
m48t59_t
 
	tm48t59_t
;

6 
m48t59_wrôe
 (
m48t59_t
 *
NVRAM
, 
uöt32_t
 
addr
, uöt32_à
vÆ
);

7 
uöt32_t
 
m48t59_ªad
 (
m48t59_t
 *
NVRAM
, uöt32_à
addr
);

8 
m48t59_toggÀ_lock
 (
m48t59_t
 *
NVRAM
, 
lock
);

9 
m48t59_t
 *
m48t59_öô
 (
IRQ
, 
èrgë_ul⁄g
 
mem_ba£
,

10 
uöt32_t
 
io_ba£
, 
uöt16_t
 
size
,

11 
ty≥
);

	@mc146818rtc.c

24 
	~"vl.h
"

28 
	#RTC_SECONDS
 0

	)

29 
	#RTC_SECONDS_ALARM
 1

	)

30 
	#RTC_MINUTES
 2

	)

31 
	#RTC_MINUTES_ALARM
 3

	)

32 
	#RTC_HOURS
 4

	)

33 
	#RTC_HOURS_ALARM
 5

	)

34 
	#RTC_ALARM_DONT_CARE
 0xC0

	)

36 
	#RTC_DAY_OF_WEEK
 6

	)

37 
	#RTC_DAY_OF_MONTH
 7

	)

38 
	#RTC_MONTH
 8

	)

39 
	#RTC_YEAR
 9

	)

41 
	#RTC_REG_A
 10

	)

42 
	#RTC_REG_B
 11

	)

43 
	#RTC_REG_C
 12

	)

44 
	#RTC_REG_D
 13

	)

46 
	#REG_A_UIP
 0x80

	)

48 
	#REG_B_SET
 0x80

	)

49 
	#REG_B_PIE
 0x40

	)

50 
	#REG_B_AIE
 0x20

	)

51 
	#REG_B_UIE
 0x10

	)

53 
	sRTCSèã
 {

54 
uöt8_t
 
	mcmos_d©a
[128];

55 
uöt8_t
 
	mcmos_ödex
;

56 
tm
 
	mcuºít_tm
;

57 
	múq
;

59 
QEMUTimî
 *
	m≥riodic_timî
;

60 
öt64_t
 
	m√xt_≥riodic_time
;

62 
öt64_t
 
	m√xt_£c⁄d_time
;

63 
QEMUTimî
 *
	m£c⁄d_timî
;

64 
QEMUTimî
 *
	m£c⁄d_timî2
;

67 
πc_£t_time
(
RTCSèã
 *
s
);

68 
πc_c›y_d©e
(
RTCSèã
 *
s
);

70 
	$πc_timî_upd©e
(
RTCSèã
 *
s
, 
öt64_t
 
cuºít_time
)

72 
≥riod_code
, 
≥riod
;

73 
öt64_t
 
cur_˛ock
, 
√xt_úq_˛ock
;

75 
≥riod_code
 = 
s
->
cmos_d©a
[
RTC_REG_A
] & 0x0f;

76 i‡(
≥riod_code
 != 0 &&

77 (
s
->
cmos_d©a
[
RTC_REG_B
] & 
REG_B_PIE
)) {

78 i‡(
≥riod_code
 <= 2)

79 
≥riod_code
 += 7;

81 
≥riod
 = 1 << (
≥riod_code
 - 1);

83 
cur_˛ock
 = 
	`muldiv64
(
cuºít_time
, 32768, 
ticks_≥r_£c
);

84 
√xt_úq_˛ock
 = (
cur_˛ock
 & ~(
≥riod
 - 1)) +Öeriod;

85 
s
->
√xt_≥riodic_time
 = 
	`muldiv64
(
√xt_úq_˛ock
, 
ticks_≥r_£c
, 32768) + 1;

86 
	`qemu_mod_timî
(
s
->
≥riodic_timî
, s->
√xt_≥riodic_time
);

88 
	`qemu_dñ_timî
(
s
->
≥riodic_timî
);

90 
	}
}

92 
	$πc_≥riodic_timî
(*
›aque
)

94 
RTCSèã
 *
s
 = 
›aque
;

96 
	`πc_timî_upd©e
(
s
, s->
√xt_≥riodic_time
);

97 
s
->
cmos_d©a
[
RTC_REG_C
] |= 0xc0;

98 
	`pic_£t_úq
(
s
->
úq
, 1);

99 
	}
}

101 
	$cmos_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
d©a
)

103 
RTCSèã
 *
s
 = 
›aque
;

105 i‡((
addr
 & 1) == 0) {

106 
s
->
cmos_ödex
 = 
d©a
 & 0x7f;

108 #ifde‡
DEBUG_CMOS


109 
	`¥ötf
("cmos: write index=0x%02x val=0x%02x\n",

110 
s
->
cmos_ödex
, 
d©a
);

112 
s
->
cmos_ödex
) {

113 
RTC_SECONDS_ALARM
:

114 
RTC_MINUTES_ALARM
:

115 
RTC_HOURS_ALARM
:

117 
s
->
cmos_d©a
[s->
cmos_ödex
] = 
d©a
;

119 
RTC_SECONDS
:

120 
RTC_MINUTES
:

121 
RTC_HOURS
:

122 
RTC_DAY_OF_WEEK
:

123 
RTC_DAY_OF_MONTH
:

124 
RTC_MONTH
:

125 
RTC_YEAR
:

126 
s
->
cmos_d©a
[s->
cmos_ödex
] = 
d©a
;

128 i‡(!(
s
->
cmos_d©a
[
RTC_REG_B
] & 
REG_B_SET
)) {

129 
	`πc_£t_time
(
s
);

132 
RTC_REG_A
:

134 
s
->
cmos_d©a
[
RTC_REG_A
] = (
d©a
 & ~
REG_A_UIP
) |

135 (
s
->
cmos_d©a
[
RTC_REG_A
] & 
REG_A_UIP
);

136 
	`πc_timî_upd©e
(
s
, 
	`qemu_gë_˛ock
(
vm_˛ock
));

138 
RTC_REG_B
:

139 i‡(
d©a
 & 
REG_B_SET
) {

141 
s
->
cmos_d©a
[
RTC_REG_A
] &~
REG_A_UIP
;

142 
d©a
 &~
REG_B_UIE
;

145 i‡(
s
->
cmos_d©a
[
RTC_REG_B
] & 
REG_B_SET
) {

146 
	`πc_£t_time
(
s
);

149 
s
->
cmos_d©a
[
RTC_REG_B
] = 
d©a
;

150 
	`πc_timî_upd©e
(
s
, 
	`qemu_gë_˛ock
(
vm_˛ock
));

152 
RTC_REG_C
:

153 
RTC_REG_D
:

157 
s
->
cmos_d©a
[s->
cmos_ödex
] = 
d©a
;

161 
	}
}

163 
ölöe
 
	$to_bcd
(
RTCSèã
 *
s
, 
a
)

165 i‡(
s
->
cmos_d©a
[
RTC_REG_B
] & 0x04) {

166  
a
;

168  ((
a
 / 10) << 4) | (a % 10);

170 
	}
}

172 
ölöe
 
	$‰om_bcd
(
RTCSèã
 *
s
, 
a
)

174 i‡(
s
->
cmos_d©a
[
RTC_REG_B
] & 0x04) {

175  
a
;

177  ((
a
 >> 4) * 10) + (a & 0x0f);

179 
	}
}

181 
	$πc_£t_time
(
RTCSèã
 *
s
)

183 
tm
 *tm = &
s
->
cuºít_tm
;

185 
tm
->
tm_£c
 = 
	`‰om_bcd
(
s
, s->
cmos_d©a
[
RTC_SECONDS
]);

186 
tm
->
tm_mö
 = 
	`‰om_bcd
(
s
, s->
cmos_d©a
[
RTC_MINUTES
]);

187 
tm
->
tm_hour
 = 
	`‰om_bcd
(
s
, s->
cmos_d©a
[
RTC_HOURS
] & 0x7f);

188 i‡(!(
s
->
cmos_d©a
[
RTC_REG_B
] & 0x02) &&

189 (
s
->
cmos_d©a
[
RTC_HOURS
] & 0x80)) {

190 
tm
->
tm_hour
 += 12;

192 
tm
->
tm_wday
 = 
	`‰om_bcd
(
s
, s->
cmos_d©a
[
RTC_DAY_OF_WEEK
]);

193 
tm
->
tm_mday
 = 
	`‰om_bcd
(
s
, s->
cmos_d©a
[
RTC_DAY_OF_MONTH
]);

194 
tm
->
tm_m⁄
 = 
	`‰om_bcd
(
s
, s->
cmos_d©a
[
RTC_MONTH
]) - 1;

195 
tm
->
tm_yór
 = 
	`‰om_bcd
(
s
, s->
cmos_d©a
[
RTC_YEAR
]) + 100;

196 
	}
}

198 
	$πc_c›y_d©e
(
RTCSèã
 *
s
)

200 c⁄° 
tm
 *tm = &
s
->
cuºít_tm
;

202 
s
->
cmos_d©a
[
RTC_SECONDS
] = 
	`to_bcd
(s, 
tm
->
tm_£c
);

203 
s
->
cmos_d©a
[
RTC_MINUTES
] = 
	`to_bcd
(s, 
tm
->
tm_mö
);

204 i‡(
s
->
cmos_d©a
[
RTC_REG_B
] & 0x02) {

206 
s
->
cmos_d©a
[
RTC_HOURS
] = 
	`to_bcd
(s, 
tm
->
tm_hour
);

209 
s
->
cmos_d©a
[
RTC_HOURS
] = 
	`to_bcd
(s, 
tm
->
tm_hour
 % 12);

210 i‡(
tm
->
tm_hour
 >= 12)

211 
s
->
cmos_d©a
[
RTC_HOURS
] |= 0x80;

213 
s
->
cmos_d©a
[
RTC_DAY_OF_WEEK
] = 
	`to_bcd
(s, 
tm
->
tm_wday
);

214 
s
->
cmos_d©a
[
RTC_DAY_OF_MONTH
] = 
	`to_bcd
(s, 
tm
->
tm_mday
);

215 
s
->
cmos_d©a
[
RTC_MONTH
] = 
	`to_bcd
(s, 
tm
->
tm_m⁄
 + 1);

216 
s
->
cmos_d©a
[
RTC_YEAR
] = 
	`to_bcd
(s, 
tm
->
tm_yór
 % 100);

217 
	}
}

220 
	$gë_days_ö_m⁄th
(
m⁄th
, 
yór
)

222 c⁄° 
days_èb
[12] = {

225 
d
;

226 i‡(()
m⁄th
 >= 12)

228 
d
 = 
days_èb
[
m⁄th
];

229 i‡(
m⁄th
 == 1) {

230 i‡((
yór
 % 4) == 0 && ((year % 100) != 0 || (year % 400) == 0))

231 
d
++;

233  
d
;

234 
	}
}

237 
	$πc_√xt_£c⁄d
(
tm
 *tm)

239 
days_ö_m⁄th
;

241 
tm
->
tm_£c
++;

242 i‡(()
tm
->
tm_£c
 >= 60) {

243 
tm
->
tm_£c
 = 0;

244 
tm
->
tm_mö
++;

245 i‡(()
tm
->
tm_mö
 >= 60) {

246 
tm
->
tm_mö
 = 0;

247 
tm
->
tm_hour
++;

248 i‡(()
tm
->
tm_hour
 >= 24) {

249 
tm
->
tm_hour
 = 0;

251 
tm
->
tm_wday
++;

252 i‡(()
tm
->
tm_wday
 >= 7)

253 
tm
->
tm_wday
 = 0;

254 
days_ö_m⁄th
 = 
	`gë_days_ö_m⁄th
(
tm
->
tm_m⁄
,

255 
tm
->
tm_yór
 + 1900);

256 
tm
->
tm_mday
++;

257 i‡(
tm
->
tm_mday
 < 1) {

258 
tm
->
tm_mday
 = 1;

259 } i‡(
tm
->
tm_mday
 > 
days_ö_m⁄th
) {

260 
tm
->
tm_mday
 = 1;

261 
tm
->
tm_m⁄
++;

262 i‡(
tm
->
tm_m⁄
 >= 12) {

263 
tm
->
tm_m⁄
 = 0;

264 
tm
->
tm_yór
++;

270 
	}
}

273 
	$πc_upd©e_£c⁄d
(*
›aque
)

275 
RTCSèã
 *
s
 = 
›aque
;

276 
öt64_t
 
dñay
;

279 i‡((
s
->
cmos_d©a
[
RTC_REG_A
] & 0x70) != 0x20) {

280 
s
->
√xt_£c⁄d_time
 +
ticks_≥r_£c
;

281 
	`qemu_mod_timî
(
s
->
£c⁄d_timî
, s->
√xt_£c⁄d_time
);

283 
	`πc_√xt_£c⁄d
(&
s
->
cuºít_tm
);

285 i‡(!(
s
->
cmos_d©a
[
RTC_REG_B
] & 
REG_B_SET
)) {

287 
s
->
cmos_d©a
[
RTC_REG_A
] |
REG_A_UIP
;

291 
dñay
 = (
ticks_≥r_£c
 * 1) / 100;

292 i‡(
dñay
 < 1)

293 
dñay
 = 1;

294 
	`qemu_mod_timî
(
s
->
£c⁄d_timî2
,

295 
s
->
√xt_£c⁄d_time
 + 
dñay
);

297 
	}
}

299 
	$πc_upd©e_£c⁄d2
(*
›aque
)

301 
RTCSèã
 *
s
 = 
›aque
;

303 i‡(!(
s
->
cmos_d©a
[
RTC_REG_B
] & 
REG_B_SET
)) {

304 
	`πc_c›y_d©e
(
s
);

308 i‡(
s
->
cmos_d©a
[
RTC_REG_B
] & 
REG_B_AIE
) {

309 i‡(((
s
->
cmos_d©a
[
RTC_SECONDS_ALARM
] & 0xc0) == 0xc0 ||

310 
s
->
cmos_d©a
[
RTC_SECONDS_ALARM
] =s->
cuºít_tm
.
tm_£c
) &&

311 ((
s
->
cmos_d©a
[
RTC_MINUTES_ALARM
] & 0xc0) == 0xc0 ||

312 
s
->
cmos_d©a
[
RTC_MINUTES_ALARM
] =s->
cuºít_tm
.
tm_m⁄
) &&

313 ((
s
->
cmos_d©a
[
RTC_HOURS_ALARM
] & 0xc0) == 0xc0 ||

314 
s
->
cmos_d©a
[
RTC_HOURS_ALARM
] =s->
cuºít_tm
.
tm_hour
)) {

316 
s
->
cmos_d©a
[
RTC_REG_C
] |= 0xa0;

317 
	`pic_£t_úq
(
s
->
úq
, 1);

322 i‡(
s
->
cmos_d©a
[
RTC_REG_B
] & 
REG_B_UIE
) {

323 
s
->
cmos_d©a
[
RTC_REG_C
] |= 0x90;

324 
	`pic_£t_úq
(
s
->
úq
, 1);

328 
s
->
cmos_d©a
[
RTC_REG_A
] &~
REG_A_UIP
;

330 
s
->
√xt_£c⁄d_time
 +
ticks_≥r_£c
;

331 
	`qemu_mod_timî
(
s
->
£c⁄d_timî
, s->
√xt_£c⁄d_time
);

332 
	}
}

334 
uöt32_t
 
	$cmos_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

336 
RTCSèã
 *
s
 = 
›aque
;

337 
ªt
;

338 i‡((
addr
 & 1) == 0) {

341 
s
->
cmos_ödex
) {

342 
RTC_SECONDS
:

343 
RTC_MINUTES
:

344 
RTC_HOURS
:

345 
RTC_DAY_OF_WEEK
:

346 
RTC_DAY_OF_MONTH
:

347 
RTC_MONTH
:

348 
RTC_YEAR
:

349 
ªt
 = 
s
->
cmos_d©a
[s->
cmos_ödex
];

351 
RTC_REG_A
:

352 
ªt
 = 
s
->
cmos_d©a
[s->
cmos_ödex
];

354 
RTC_REG_C
:

355 
ªt
 = 
s
->
cmos_d©a
[s->
cmos_ödex
];

356 
	`pic_£t_úq
(
s
->
úq
, 0);

357 
s
->
cmos_d©a
[
RTC_REG_C
] = 0x00;

360 
ªt
 = 
s
->
cmos_d©a
[s->
cmos_ödex
];

363 #ifde‡
DEBUG_CMOS


364 
	`¥ötf
("cmos:Ñead index=0x%02x val=0x%02x\n",

365 
s
->
cmos_ödex
, 
ªt
);

367  
ªt
;

369 
	}
}

371 
	$πc_£t_mem‹y
(
RTCSèã
 *
s
, 
addr
, 
vÆ
)

373 i‡(
addr
 >= 0 &&áddr <= 127)

374 
s
->
cmos_d©a
[
addr
] = 
vÆ
;

375 
	}
}

377 
	$πc_£t_d©e
(
RTCSèã
 *
s
, c⁄° 
tm
 *tm)

379 
s
->
cuºít_tm
 = *
tm
;

380 
	`πc_c›y_d©e
(
s
);

381 
	}
}

384 
	#REG_IBM_CENTURY_BYTE
 0x32

	)

385 
	#REG_IBM_PS2_CENTURY_BYTE
 0x37

	)

387 
	$πc_£t_d©e_‰om_ho°
(
RTCSèã
 *
s
)

389 
time_t
 
ti
;

390 
tm
 *tm;

391 
vÆ
;

394 
	`time
(&
ti
);

395 i‡(
πc_utc
)

396 
tm
 = 
	`gmtime
(&
ti
);

398 
tm
 = 
	`loˇ…ime
(&
ti
);

399 
	`πc_£t_d©e
(
s
, 
tm
);

401 
vÆ
 = 
	`to_bcd
(
s
, (
tm
->
tm_yór
 / 100) + 19);

402 
	`πc_£t_mem‹y
(
s
, 
REG_IBM_CENTURY_BYTE
, 
vÆ
);

403 
	`πc_£t_mem‹y
(
s
, 
REG_IBM_PS2_CENTURY_BYTE
, 
vÆ
);

404 
	}
}

406 
	$πc_ßve
(
QEMUFûe
 *
f
, *
›aque
)

408 
RTCSèã
 *
s
 = 
›aque
;

410 
	`qemu_put_buf„r
(
f
, 
s
->
cmos_d©a
, 128);

411 
	`qemu_put_8s
(
f
, &
s
->
cmos_ödex
);

413 
	`qemu_put_be32s
(
f
, &
s
->
cuºít_tm
.
tm_£c
);

414 
	`qemu_put_be32s
(
f
, &
s
->
cuºít_tm
.
tm_mö
);

415 
	`qemu_put_be32s
(
f
, &
s
->
cuºít_tm
.
tm_hour
);

416 
	`qemu_put_be32s
(
f
, &
s
->
cuºít_tm
.
tm_wday
);

417 
	`qemu_put_be32s
(
f
, &
s
->
cuºít_tm
.
tm_mday
);

418 
	`qemu_put_be32s
(
f
, &
s
->
cuºít_tm
.
tm_m⁄
);

419 
	`qemu_put_be32s
(
f
, &
s
->
cuºít_tm
.
tm_yór
);

421 
	`qemu_put_timî
(
f
, 
s
->
≥riodic_timî
);

422 
	`qemu_put_be64s
(
f
, &
s
->
√xt_≥riodic_time
);

424 
	`qemu_put_be64s
(
f
, &
s
->
√xt_£c⁄d_time
);

425 
	`qemu_put_timî
(
f
, 
s
->
£c⁄d_timî
);

426 
	`qemu_put_timî
(
f
, 
s
->
£c⁄d_timî2
);

427 
	}
}

429 
	$πc_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

431 
RTCSèã
 *
s
 = 
›aque
;

433 i‡(
vîsi⁄_id
 != 1)

434  -
EINVAL
;

436 
	`qemu_gë_buf„r
(
f
, 
s
->
cmos_d©a
, 128);

437 
	`qemu_gë_8s
(
f
, &
s
->
cmos_ödex
);

439 
	`qemu_gë_be32s
(
f
, &
s
->
cuºít_tm
.
tm_£c
);

440 
	`qemu_gë_be32s
(
f
, &
s
->
cuºít_tm
.
tm_mö
);

441 
	`qemu_gë_be32s
(
f
, &
s
->
cuºít_tm
.
tm_hour
);

442 
	`qemu_gë_be32s
(
f
, &
s
->
cuºít_tm
.
tm_wday
);

443 
	`qemu_gë_be32s
(
f
, &
s
->
cuºít_tm
.
tm_mday
);

444 
	`qemu_gë_be32s
(
f
, &
s
->
cuºít_tm
.
tm_m⁄
);

445 
	`qemu_gë_be32s
(
f
, &
s
->
cuºít_tm
.
tm_yór
);

447 
	`qemu_gë_timî
(
f
, 
s
->
≥riodic_timî
);

448 
	`qemu_gë_be64s
(
f
, &
s
->
√xt_≥riodic_time
);

450 
	`qemu_gë_be64s
(
f
, &
s
->
√xt_£c⁄d_time
);

451 
	`qemu_gë_timî
(
f
, 
s
->
£c⁄d_timî
);

452 
	`qemu_gë_timî
(
f
, 
s
->
£c⁄d_timî2
);

454 
	}
}

456 
RTCSèã
 *
	$πc_öô
(
ba£
, 
úq
)

458 
RTCSèã
 *
s
;

460 
s
 = 
	`qemu_mÆlocz
((
RTCSèã
));

461 i‡(!
s
)

462  
NULL
;

464 
s
->
úq
 = irq;

465 
s
->
cmos_d©a
[
RTC_REG_A
] = 0x26;

466 
s
->
cmos_d©a
[
RTC_REG_B
] = 0x02;

467 
s
->
cmos_d©a
[
RTC_REG_C
] = 0x00;

468 
s
->
cmos_d©a
[
RTC_REG_D
] = 0x80;

470 
	`πc_£t_d©e_‰om_ho°
(
s
);

472 
s
->
≥riodic_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
,

473 
πc_≥riodic_timî
, 
s
);

474 
s
->
£c⁄d_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
,

475 
πc_upd©e_£c⁄d
, 
s
);

476 
s
->
£c⁄d_timî2
 = 
	`qemu_√w_timî
(
vm_˛ock
,

477 
πc_upd©e_£c⁄d2
, 
s
);

479 
s
->
√xt_£c⁄d_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ (
ticks_≥r_£c
 * 99) / 100;

480 
	`qemu_mod_timî
(
s
->
£c⁄d_timî2
, s->
√xt_£c⁄d_time
);

482 
	`ªgi°î_i›‹t_wrôe
(
ba£
, 2, 1, 
cmos_i›‹t_wrôe
, 
s
);

483 
	`ªgi°î_i›‹t_ªad
(
ba£
, 2, 1, 
cmos_i›‹t_ªad
, 
s
);

485 
	`ªgi°î_ßvevm
("mc146818πc", 
ba£
, 1, 
πc_ßve
, 
πc_lﬂd
, 
s
);

486  
s
;

487 
	}
}

	@mips_int.c

1 
	~"vl.h
"

2 
	~"˝u.h
"

6 
	$˝u_mùs_upd©e_úq
(
CPUSèã
 *
ív
)

8 i‡((
ív
->
CP0_Sètus
 &Énv->
CP0_Cau£
 & 
CP0Ca_IP_mask
) &&

9 (
ív
->
CP0_Sètus
 & (1 << 
CP0St_IE
)) &&

10 !(
ív
->
hÊags
 & 
MIPS_HFLAG_EXL
) &&

11 !(
ív
->
hÊags
 & 
MIPS_HFLAG_ERL
) &&

12 !(
ív
->
hÊags
 & 
MIPS_HFLAG_DM
)) {

13 i‡(! (
ív
->
öãºu±_ªque°
 & 
CPU_INTERRUPT_HARD
)) {

14 
	`˝u_öãºu±
(
ív
, 
CPU_INTERRUPT_HARD
);

17 
	`˝u_ª£t_öãºu±
(
ív
, 
CPU_INTERRUPT_HARD
);

19 
	}
}

21 
	$˝u_mùs_úq_ªque°
(*
›aque
, 
úq
, 
Àvñ
)

23 
CPUSèã
 *
ív
 = 
fú°_˝u
;

25 
uöt32_t
 
mask
;

27 i‡(
úq
 >= 16)

30 
mask
 = 1 << (
úq
 + 
CP0Ca_IP
);

32 i‡(
Àvñ
) {

33 
ív
->
CP0_Cau£
 |
mask
;

35 
ív
->
CP0_Cau£
 &~
mask
;

37 
	`˝u_mùs_upd©e_úq
(
ív
);

38 
	}
}

	@mips_malta.c

25 
	~"vl.h
"

27 #ifde‡
TARGET_WORDS_BIGENDIAN


28 
	#BIOS_FILENAME
 "mùs_bios.bö"

	)

30 
	#BIOS_FILENAME
 "mù£l_bios.bö"

	)

33 #ifde‡
MIPS_HAS_MIPS64


34 
	#INITRD_LOAD_ADDR
 (
öt64_t
)0x80800000

	)

36 
	#INITRD_LOAD_ADDR
 (
öt32_t
)0x80800000

	)

39 
	#ENVP_ADDR
 (
öt32_t
)0x80002000

	)

40 
	#VIRT_TO_PHYS_ADDEND
 (-((
öt64_t
)(
öt32_t
)0x80000000))

	)

42 
	#ENVP_NB_ENTRIES
 16

	)

43 
	#ENVP_ENTRY_SIZE
 256

	)

46 
FILE
 *
logfûe
;

49 
uöt32_t
 
	mÀds
;

50 
uöt32_t
 
	mbrk
;

51 
uöt32_t
 
	mgpout
;

52 
uöt32_t
 
	mi2c€
;

53 
uöt32_t
 
	mi2cout
;

54 
uöt32_t
 
	mi2c£l
;

55 
Ch¨DrivîSèã
 *
	mdi•œy
;

56 
	mdi•œy_ãxt
[9];

57 } 
	tMÆèFPGASèã
;

59 
PITSèã
 *
	gpô
;

62 
	$pic_úq_ªque°
(*
›aque
, 
Àvñ
)

64 
	`˝u_mùs_úq_ªque°
(
›aque
, 2, 
Àvñ
);

65 
	}
}

68 
	$mÆè_Âga_upd©e_di•œy
(*
›aque
)

70 
Àds_ãxt
[9];

71 
i
;

72 
MÆèFPGASèã
 *
s
 = 
›aque
;

74 
i
 = 7 ; i >= 0 ; i--) {

75 i‡(
s
->
Àds
 & (1 << 
i
))

76 
Àds_ãxt
[
i
] = '#';

78 
Àds_ãxt
[
i
] = ' ';

80 
Àds_ãxt
[8] = '\0';

82 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "\e[H\n\n|\e[32m%-8.8s\e[00m|\r\n", 
Àds_ãxt
);

83 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "\n\n\n\n|\e[31m%-8.8s\e[00m|", s->
di•œy_ãxt
);

84 
	}
}

86 
uöt32_t
 
	$mÆè_Âga_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

88 
MÆèFPGASèã
 *
s
 = 
›aque
;

89 
uöt32_t
 
vÆ
 = 0;

90 
uöt32_t
 
ßddr
;

92 
ßddr
 = (
addr
 & 0xfffff);

94 
ßddr
) {

98 
vÆ
 = 0x00000000;

103 #ifde‡
TARGET_WORDS_BIGENDIAN


104 
vÆ
 = 0x00000012;

106 
vÆ
 = 0x00000010;

112 
vÆ
 = 0x00;

117 
vÆ
 = 
s
->
Àds
;

122 
vÆ
 = 
s
->
brk
;

127 
vÆ
 = 
s
->
gpout
;

135 i‡(
s
->
i2c£l
)

136 
vÆ
 = 
s
->
i2cout
;

138 
vÆ
 = 0x00;

143 
vÆ
 = 0x00000003;

148 
vÆ
 = 
s
->
i2c€
;

153 
vÆ
 = 
s
->
i2cout
;

158 
vÆ
 = 
s
->
i2cout
;

163 
	`¥ötf
 ("mÆè_Âga_ªad: BadÑegi°î off£à0x" 
TLSZ
 "\n",

164 
addr
);

168  
vÆ
;

169 
	}
}

171 
	$mÆè_Âga_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

172 
uöt32_t
 
vÆ
)

174 
MÆèFPGASèã
 *
s
 = 
›aque
;

175 
uöt32_t
 
ßddr
;

177 
ßddr
 = (
addr
 & 0xfffff);

179 
ßddr
) {

192 
s
->
Àds
 = 
vÆ
 & 0xff;

197 
	`¢¥ötf
(
s
->
di•œy_ãxt
, 9, "%08X", 
vÆ
);

198 
	`mÆè_Âga_upd©e_di•œy
(
s
);

210 
s
->
di•œy_ãxt
[(
ßddr
 - 0x00418Ë>> 3] = (Ë
vÆ
;

211 
	`mÆè_Âga_upd©e_di•œy
(
s
);

216 i‡(
vÆ
 == 0x42)

217 
	`qemu_sy°em_ª£t_ªque°
 ();

222 
s
->
brk
 = 
vÆ
 & 0xff;

227 
s
->
gpout
 = 
vÆ
 & 0xff;

232 
s
->
i2c€
 = 
vÆ
 & 0x03;

237 
s
->
i2cout
 = 
vÆ
 & 0x03;

242 
s
->
i2cout
 = 
vÆ
 & 0x01;

247 
	`¥ötf
 ("mÆè_Âga_wrôe: BadÑegi°î off£à0x" 
TLSZ
 "\n",

248 
addr
);

252 
	}
}

254 
CPURódMem‹yFunc
 *
	gmÆè_Âga_ªad
[] = {

255 
mÆè_Âga_ªadl
,

256 
mÆè_Âga_ªadl
,

257 
mÆè_Âga_ªadl


260 
CPUWrôeMem‹yFunc
 *
	gmÆè_Âga_wrôe
[] = {

261 
mÆè_Âga_wrôñ
,

262 
mÆè_Âga_wrôñ
,

263 
mÆè_Âga_wrôñ


266 
	$mÆè_Âga_ª£t
(*
›aque
)

268 
MÆèFPGASèã
 *
s
 = 
›aque
;

270 
s
->
Àds
 = 0x00;

271 
s
->
brk
 = 0x0a;

272 
s
->
gpout
 = 0x00;

273 
s
->
i2c€
 = 0x0;

274 
s
->
i2cout
 = 0x3;

275 
s
->
i2c£l
 = 0x1;

277 
s
->
di•œy_ãxt
[8] = '\0';

278 
	`¢¥ötf
(
s
->
di•œy_ãxt
, 9, " ");

279 
	`mÆè_Âga_upd©e_di•œy
(
s
);

280 
	}
}

282 
MÆèFPGASèã
 *
	$mÆè_Âga_öô
(
èrgë_phys_addr_t
 
ba£
)

284 
MÆèFPGASèã
 *
s
;

285 
mÆè
;

287 
s
 = (
MÆèFPGASèã
 *)
	`qemu_mÆlocz
((MaltaFPGAState));

289 
mÆè
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
mÆè_Âga_ªad
,

290 
mÆè_Âga_wrôe
, 
s
);

291 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x100000, 
mÆè
);

293 
s
->
di•œy
 = 
	`qemu_chr_›í
("vc");

294 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "\e[HMalta LEDBAR\r\n");

295 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "+--------+\r\n");

296 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "+ +\r\n");

297 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "+--------+\r\n");

298 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "\n");

299 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "Malta ASCII\r\n");

300 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "+--------+\r\n");

301 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "+ +\r\n");

302 
	`qemu_chr_¥ötf
(
s
->
di•œy
, "+--------+\r\n");

304 
	`mÆè_Âga_ª£t
(
s
);

305 
	`qemu_ªgi°î_ª£t
(
mÆè_Âga_ª£t
, 
s
);

307  
s
;

308 
	}
}

311 #ifde‡
HAS_AUDIO


312 
	$audio_öô
 (
PCIBus
 *
pci_bus
)

314 
soundhw
 *
c
;

315 
audio_íabÀd
 = 0;

317 
c
 = 
soundhw
; !
audio_íabÀd
 && c->
«me
; ++c) {

318 
audio_íabÀd
 = 
c
->
íabÀd
;

321 i‡(
audio_íabÀd
) {

322 
AudioSèã
 *
s
;

324 
s
 = 
	`AUD_öô
 ();

325 i‡(
s
) {

326 
c
 = 
soundhw
; c->
«me
; ++c) {

327 i‡(
c
->
íabÀd
) {

328 i‡(
c
->
iß
) {

329 
	`Ârötf
(
°dîr
, "qemu: Unsuµ‹ãd Sound C¨d: %s\n", 
c
->
«me
);

330 
	`exô
(1);

333 i‡(
pci_bus
) {

334 
c
->
öô
.
	`öô_pci
 (
pci_bus
, 
s
);

341 
	}
}

345 
	$√tw‹k_öô
 (
PCIBus
 *
pci_bus
)

347 
i
;

348 
NICInfo
 *
nd
;

350 
i
 = 0; i < 
nb_nics
; i++) {

351 
nd
 = &
nd_èbÀ
[
i
];

352 i‡(!
nd
->
modñ
) {

353 
nd
->
modñ
 = "pcnet";

355 i‡(
i
 =0 && 
	`°rcmp
(
nd
->
modñ
, "pcnet") == 0) {

357 
	`pci_nic_öô
(
pci_bus
, 
nd
, 88);

359 
	`pci_nic_öô
(
pci_bus
, 
nd
, -1);

362 
	}
}

386 
	$wrôe_boŸlﬂdî
 (
CPUSèã
 *
ív
, 
bios_off£t
, 
öt64_t
 
kî√l_addr
)

388 
uöt32_t
 *
p
;

391 
p
 = (
uöt32_t
 *Ë(
phys_øm_ba£
 + 
bios_off£t
);

392 
	`°l_øw
(
p
++, 0x0bf00010);

393 
	`°l_øw
(
p
++, 0x00000000);

396 
p
 = (
uöt32_t
 *Ë(
phys_øm_ba£
 + 
bios_off£t
 + 0x040);

397 
	`°l_øw
(
p
++, 0x3c040000);

398 
	`°l_øw
(
p
++, 0x34840002);

399 
	`°l_øw
(
p
++, 0x3c050000 | ((
ENVP_ADDR
 >> 16) & 0xffff));

400 
	`°l_øw
(
p
++, 0x34a50000 | (
ENVP_ADDR
 & 0xffff));

401 
	`°l_øw
(
p
++, 0x3c060000 | (((
ENVP_ADDR
 + 8) >> 16) & 0xffff));

402 
	`°l_øw
(
p
++, 0x34c60000 | ((
ENVP_ADDR
 + 8) & 0xffff));

403 
	`°l_øw
(
p
++, 0x3c070000 | (
ív
->
øm_size
 >> 16));

404 
	`°l_øw
(
p
++, 0x34e70000 | (
ív
->
øm_size
 & 0xffff));

405 
	`°l_øw
(
p
++, 0x3c1f0000 | ((
kî√l_addr
 >> 16) & 0xffff)); ;

406 
	`°l_øw
(
p
++, 0x37ff0000 | (
kî√l_addr
 & 0xffff));

407 
	`°l_øw
(
p
++, 0x03e00008);

408 
	`°l_øw
(
p
++, 0x00000000);

409 
	}
}

411 
	$¥om_£t
(
ödex
, c⁄° *
°rög
, ...)

413 
va_li°
 
≠
;

414 
öt32_t
 *
p
;

415 
öt32_t
 
èbÀ_addr
;

416 *
s
;

418 i‡(
ödex
 >
ENVP_NB_ENTRIES
)

421 
p
 = (
öt32_t
 *Ë(
phys_øm_ba£
 + 
ENVP_ADDR
 + 
VIRT_TO_PHYS_ADDEND
);

422 
p
 +
ödex
;

424 i‡(
°rög
 =
NULL
) {

425 
	`°l_øw
(
p
, 0);

429 
èbÀ_addr
 = 
ENVP_ADDR
 + (
öt32_t
Ë* 
ENVP_NB_ENTRIES
 + 
ödex
 * 
ENVP_ENTRY_SIZE
;

430 
s
 = (*Ë(
phys_øm_ba£
 + 
VIRT_TO_PHYS_ADDEND
 + 
èbÀ_addr
);

432 
	`°l_øw
(
p
, 
èbÀ_addr
);

434 
	`va_°¨t
(
≠
, 
°rög
);

435 
	`v¢¥ötf
 (
s
, 
ENVP_ENTRY_SIZE
, 
°rög
, 
≠
);

436 
	`va_íd
(
≠
);

437 
	}
}

440 
öt64_t
 
	$lﬂd_kî√l
 (
CPUSèã
 *
ív
)

442 
öt64_t
 
kî√l_addr
 = 0;

443 
ödex
 = 0;

444 
öôrd_size
;

446 i‡(
	`lﬂd_ñf
(
ív
->
kî√l_fûíame
, 
VIRT_TO_PHYS_ADDEND
, &
kî√l_addr
) < 0) {

447 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad kernel '%s'\n",

448 
ív
->
kî√l_fûíame
);

449 
	`exô
(1);

453 
öôrd_size
 = 0;

454 i‡(
ív
->
öôrd_fûíame
) {

455 
öôrd_size
 = 
	`lﬂd_image
(
ív
->
öôrd_fûíame
,

456 
phys_øm_ba£
 + 
INITRD_LOAD_ADDR
 + 
VIRT_TO_PHYS_ADDEND
);

457 i‡(
öôrd_size
 =(
èrgë_ul⁄g
) -1) {

458 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad initialÑam disk '%s'\n",

459 
ív
->
öôrd_fûíame
);

460 
	`exô
(1);

465 
	`¥om_£t
(
ödex
++, 
ív
->
kî√l_fûíame
);

466 i‡(
öôrd_size
 > 0)

467 
	`¥om_£t
(
ödex
++, "rd_°¨t=0x" 
TLSZ
 "Ñd_size=%lò%s", 
INITRD_LOAD_ADDR
, 
öôrd_size
, 
ív
->
kî√l_cmdlöe
);

469 
	`¥om_£t
(
ödex
++, 
ív
->
kî√l_cmdlöe
);

472 
	`¥om_£t
(
ödex
++, "memsize");

473 
	`¥om_£t
(
ödex
++, "%i", 
ív
->
øm_size
);

474 
	`¥om_£t
(
ödex
++, "modetty0");

475 
	`¥om_£t
(
ödex
++, "38400n8r");

476 
	`¥om_£t
(
ödex
++, 
NULL
);

478  
kî√l_addr
;

479 
	}
}

481 
	$maö_˝u_ª£t
(*
›aque
)

483 
CPUSèã
 *
ív
 = 
›aque
;

484 
	`˝u_ª£t
(
ív
);

489 i‡(
ív
->
kî√l_fûíame
)

490 
	`lﬂd_kî√l
 (
ív
);

491 
	}
}

493 
	$mùs_mÆè_öô
 (
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

494 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

495 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

496 c⁄° *
öôrd_fûíame
)

498 
buf
[1024];

499 
bios_off£t
;

500 
öt64_t
 
kî√l_addr
;

501 
PCIBus
 *
pci_bus
;

502 
CPUSèã
 *
ív
;

503 
RTCSèã
 *
πc_°©e
;

505 
MÆèFPGASèã
 *
mÆè_Âga
;

506 
ªt
;

508 
ív
 = 
	`˝u_öô
();

509 
	`ªgi°î_ßvevm
("˝u", 0, 3, 
˝u_ßve
, 
˝u_lﬂd
, 
ív
);

510 
	`qemu_ªgi°î_ª£t
(
maö_˝u_ª£t
, 
ív
);

513 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 
IO_MEM_RAM
);

516 
bios_off£t
 = 
øm_size
 + 
vga_øm_size
;

517 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x1e000000LL,

518 
BIOS_SIZE
, 
bios_off£t
 | 
IO_MEM_ROM
);

519 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x1fc00000LL,

520 
BIOS_SIZE
, 
bios_off£t
 | 
IO_MEM_ROM
);

525 i‡(
kî√l_fûíame
) {

526 
ív
->
øm_size
 =Ñam_size;

527 
ív
->
kî√l_fûíame
 = kernel_filename;

528 
ív
->
kî√l_cmdlöe
 = kernel_cmdline;

529 
ív
->
öôrd_fûíame
 = initrd_filename;

530 
kî√l_addr
 = 
	`lﬂd_kî√l
(
ív
);

531 
	`wrôe_boŸlﬂdî
(
ív
, 
bios_off£t
, 
kî√l_addr
);

533 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
BIOS_FILENAME
);

534 
ªt
 = 
	`lﬂd_image
(
buf
, 
phys_øm_ba£
 + 
bios_off£t
);

535 i‡(
ªt
 !
BIOS_SIZE
) {

536 
	`Ârötf
(
°dîr
, "qemu: Warning, couldÇotÜoad MIPS bios '%s'\n",

537 
buf
);

538 
	`exô
(1);

545 
	`°l_øw
(
phys_øm_ba£
 + 
bios_off£t
 + 0x10, 0x00000420);

548 
	`˝u_mùs_˛ock_öô
(
ív
);

549 
	`˝u_mùs_úq˘æ_öô
();

552 
mÆè_Âga
 = 
	`mÆè_Âga_öô
(0x1f000000LL);

555 
iß_pic
 = 
	`pic_öô
(
pic_úq_ªque°
, 
ív
);

558 
pci_bus
 = 
	`pci_gt64120_öô
(
iß_pic
);

561 
	`piix4_öô
(
pci_bus
, 80);

562 
	`pci_piix3_ide_öô
(
pci_bus
, 
bs_èbÀ
, 81);

563 
	`usb_uhci_öô
(
pci_bus
, 82);

564 
	`piix4_pm_öô
(
pci_bus
, 83);

565 
pô
 = 
	`pô_öô
(0x40, 0);

566 
	`DMA_öô
(0);

569 
	`kbd_öô
();

570 
πc_°©e
 = 
	`πc_öô
(0x70, 8);

571 
	`£rül_öô
(&
pic_£t_úq_√w
, 
iß_pic
, 0x3f8, 4, 
£rül_hds
[0]);

572 
	`∑øŒñ_öô
(0x378, 7, 
∑øŒñ_hds
[0]);

578 #ifde‡
HAS_AUDIO


579 
	`audio_öô
(
pci_bus
);

583 
	`√tw‹k_öô
(
pci_bus
);

584 
	}
}

586 
QEMUMachöe
 
	gmùs_mÆè_machöe
 = {

589 
mùs_mÆè_öô
,

	@mips_r4k.c

10 
	~"vl.h
"

12 #ifde‡
TARGET_WORDS_BIGENDIAN


13 
	#BIOS_FILENAME
 "mùs_bios.bö"

	)

15 
	#BIOS_FILENAME
 "mù£l_bios.bö"

	)

18 #ifde‡
MIPS_HAS_MIPS64


19 
	#INITRD_LOAD_ADDR
 (
öt64_t
)(
öt32_t
)0x80800000

	)

21 
	#INITRD_LOAD_ADDR
 (
öt32_t
)0x80800000

	)

24 
	#VIRT_TO_PHYS_ADDEND
 (-((
öt64_t
)(
öt32_t
)0x80000000))

	)

26 c⁄° 
	gide_ioba£
[2] = { 0x1f0, 0x170 };

27 c⁄° 
	gide_ioba£2
[2] = { 0x3f6, 0x376 };

28 c⁄° 
	gide_úq
[2] = { 14, 15 };

30 
	g£rül_io
[
MAX_SERIAL_PORTS
] = { 0x3f8, 0x2f8, 0x3e8, 0x2e8 };

31 
	g£rül_úq
[
MAX_SERIAL_PORTS
] = { 4, 3, 4, 3 };

33 
FILE
 *
logfûe
;

35 
PITSèã
 *
	gpô
;

39 
	$pic_úq_ªque°
(*
›aque
, 
Àvñ
)

41 
	`˝u_mùs_úq_ªque°
(
›aque
, 2, 
Àvñ
);

42 
	}
}

44 
	$mùs_qemu_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

45 
uöt32_t
 
vÆ
)

47 i‡((
addr
 & 0xffffË=0 && 
vÆ
 == 42)

48 
	`qemu_sy°em_ª£t_ªque°
 ();

49 i‡((
addr
 & 0xffffË=4 && 
vÆ
 == 42)

50 
	`qemu_sy°em_shutdown_ªque°
 ();

51 
	}
}

53 
uöt32_t
 
	$mùs_qemu_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

56 
	}
}

58 
CPUWrôeMem‹yFunc
 *
	gmùs_qemu_wrôe
[] = {

59 &
mùs_qemu_wrôñ
,

60 &
mùs_qemu_wrôñ
,

61 &
mùs_qemu_wrôñ
,

64 
CPURódMem‹yFunc
 *
	gmùs_qemu_ªad
[] = {

65 &
mùs_qemu_ªadl
,

66 &
mùs_qemu_ªadl
,

67 &
mùs_qemu_ªadl
,

70 
	gmùs_qemu_iomemty≥
 = 0;

72 
	$lﬂd_kî√l
 (
CPUSèã
 *
ív
, 
øm_size
, c⁄° *
kî√l_fûíame
,

73 c⁄° *
kî√l_cmdlöe
,

74 c⁄° *
öôrd_fûíame
)

76 
öt64_t
 
íåy
 = 0;

77 
kî√l_size
, 
öôrd_size
;

79 
kî√l_size
 = 
	`lﬂd_ñf
(
kî√l_fûíame
, 
VIRT_TO_PHYS_ADDEND
, &
íåy
);

80 i‡(
kî√l_size
 >= 0) {

81 i‡((
íåy
 & ~0x7fffffffULL) == 0x80000000)

82 
íåy
 = (
öt32_t
)entry;

83 
ív
->
PC
 = 
íåy
;

85 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad kernel '%s'\n",

86 
kî√l_fûíame
);

87 
	`exô
(1);

91 
öôrd_size
 = 0;

92 i‡(
öôrd_fûíame
) {

93 
öôrd_size
 = 
	`lﬂd_image
(
öôrd_fûíame
,

94 
phys_øm_ba£
 + 
INITRD_LOAD_ADDR
 + 
VIRT_TO_PHYS_ADDEND
);

95 i‡(
öôrd_size
 =(
èrgë_ul⁄g
) -1) {

96 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad initialÑam disk '%s'\n",

97 
öôrd_fûíame
);

98 
	`exô
(1);

103 i‡(
öôrd_size
 > 0) {

104 
ªt
;

105 
ªt
 = 
	`•rötf
(
phys_øm_ba£
 + (16 << 20) - 256,

106 "rd_°¨t=0x" 
TLSZ
 "Ñd_size=%li ",

107 
INITRD_LOAD_ADDR
,

108 
öôrd_size
);

109 
	`°r˝y
 (
phys_øm_ba£
 + (16 << 20Ë- 256 + 
ªt
, 
kî√l_cmdlöe
);

112 
	`°r˝y
 (
phys_øm_ba£
 + (16 << 20Ë- 256, 
kî√l_cmdlöe
);

115 *(
öt32_t
 *)(
phys_øm_ba£
 + (16 << 20Ë- 260Ë
	`tsw≠32
 (0x12345678);

116 *(
öt32_t
 *)(
phys_øm_ba£
 + (16 << 20Ë- 264Ë
	`tsw≠32
 (
øm_size
);

117 
	}
}

119 
	$maö_˝u_ª£t
(*
›aque
)

121 
CPUSèã
 *
ív
 = 
›aque
;

122 
	`˝u_ª£t
(
ív
);

124 i‡(
ív
->
kî√l_fûíame
)

125 
	`lﬂd_kî√l
 (
ív
,Énv->
øm_size
,Énv->
kî√l_fûíame
,

126 
ív
->
kî√l_cmdlöe
,Énv->
öôrd_fûíame
);

127 
	}
}

129 
	$mùs_r4k_öô
 (
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

130 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

131 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

132 c⁄° *
öôrd_fûíame
)

134 
buf
[1024];

135 
bios_off£t
;

136 
bios_size
;

137 
CPUSèã
 *
ív
;

138 
RTCSèã
 *
πc_°©e
;

139 
i
;

141 
ív
 = 
	`˝u_öô
();

142 
	`ªgi°î_ßvevm
("˝u", 0, 3, 
˝u_ßve
, 
˝u_lﬂd
, 
ív
);

143 
	`qemu_ªgi°î_ª£t
(
maö_˝u_ª£t
, 
ív
);

146 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 
IO_MEM_RAM
);

148 i‡(!
mùs_qemu_iomemty≥
) {

149 
mùs_qemu_iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
mùs_qemu_ªad
,

150 
mùs_qemu_wrôe
, 
NULL
);

152 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x1fbf0000, 0x10000, 
mùs_qemu_iomemty≥
);

158 
bios_off£t
 = 
øm_size
 + 
vga_øm_size
;

159 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
BIOS_FILENAME
);

160 
bios_size
 = 
	`lﬂd_image
(
buf
, 
phys_øm_ba£
 + 
bios_off£t
);

161 i‡((
bios_size
 > 0Ë&& (bios_sizê<
BIOS_SIZE
)) {

162 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x1fc00000,

163 
BIOS_SIZE
, 
bios_off£t
 | 
IO_MEM_ROM
);

166 
	`Ârötf
(
°dîr
, "qemu: Warning, couldÇotÜoad MIPS bios '%s'\n",

167 
buf
);

170 i‡(
kî√l_fûíame
) {

171 
	`lﬂd_kî√l
 (
ív
, 
øm_size
, 
kî√l_fûíame
, 
kî√l_cmdlöe
,

172 
öôrd_fûíame
);

173 
ív
->
øm_size
 =Ñam_size;

174 
ív
->
kî√l_fûíame
 = kernel_filename;

175 
ív
->
kî√l_cmdlöe
 = kernel_cmdline;

176 
ív
->
öôrd_fûíame
 = initrd_filename;

180 
	`˝u_mùs_˛ock_öô
(
ív
);

181 
	`˝u_mùs_úq˘æ_öô
();

183 
πc_°©e
 = 
	`πc_öô
(0x70, 8);

186 
	`iß_mmio_öô
(0x14000000, 0x00010000);

187 
iß_mem_ba£
 = 0x10000000;

189 
iß_pic
 = 
	`pic_öô
(
pic_úq_ªque°
, 
ív
);

190 
pô
 = 
	`pô_öô
(0x40, 0);

192 
i
 = 0; i < 
MAX_SERIAL_PORTS
; i++) {

193 i‡(
£rül_hds
[
i
]) {

194 
	`£rül_öô
(&
pic_£t_úq_√w
, 
iß_pic
,

195 
£rül_io
[
i
], 
£rül_úq
[i], 
£rül_hds
[i]);

199 
	`iß_vga_öô
(
ds
, 
phys_øm_ba£
 + 
øm_size
,Ñam_size,

200 
vga_øm_size
);

202 i‡(
nd_èbÀ
[0].
vœn
) {

203 i‡(
nd_èbÀ
[0].
modñ
 =
NULL


204 || 
	`°rcmp
(
nd_èbÀ
[0].
modñ
, "ne2k_isa") == 0) {

205 
	`iß_√2000_öô
(0x300, 9, &
nd_èbÀ
[0]);

207 
	`Ârötf
(
°dîr
, "qemu: Unsuµ‹ãd NIC: %s\n", 
nd_èbÀ
[0].
modñ
);

208 
	`exô
 (1);

212 
i
 = 0; i < 2; i++)

213 
	`iß_ide_öô
(
ide_ioba£
[
i
], 
ide_ioba£2
[i], 
ide_úq
[i],

214 
bs_èbÀ
[2 * 
i
], bs_table[2 * i + 1]);

215 
	}
}

217 
QEMUMachöe
 
	gmùs_machöe
 = {

220 
mùs_r4k_öô
,

	@mips_timer.c

1 
	~"vl.h
"

3 
	$˝u_mùs_úq˘æ_öô
 ()

5 
	}
}

8 
uöt32_t
 
	$˝u_mùs_gë_øndom
 (
CPUSèã
 *
ív
)

10 
uöt32_t
 
£ed
 = 0;

11 
uöt32_t
 
idx
;

12 
£ed
 = seed * 314159 + 1;

13 
idx
 = (
£ed
 >> 16Ë% (
MIPS_TLB_NB
 - 
ív
->
CP0_Wúed
) +Énv->CP0_Wired;

14  
idx
;

15 
	}
}

18 
uöt32_t
 
	$˝u_mùs_gë_cou¡
 (
CPUSèã
 *
ív
)

20  
ív
->
CP0_Cou¡
 +

21 (
uöt32_t
)
	`muldiv64
(
	`qemu_gë_˛ock
(
vm_˛ock
),

22 100 * 1000 * 1000, 
ticks_≥r_£c
);

23 
	}
}

25 
	$˝u_mùs_upd©e_cou¡
 (
CPUSèã
 *
ív
, 
uöt32_t
 
cou¡
,

26 
uöt32_t
 
com∑ª
)

28 
uöt64_t
 
now
, 
√xt
;

29 
uöt32_t
 
tmp
;

31 
tmp
 = 
cou¡
;

32 i‡(
cou¡
 =
com∑ª
)

33 
tmp
++;

34 
now
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

35 
√xt
 = 
now
 + 
	`muldiv64
(
com∑ª
 - 
tmp
, 
ticks_≥r_£c
, 100 * 1000 * 1000);

36 i‡(
√xt
 =
now
)

37 
√xt
++;

39 i‡(
logfûe
) {

40 
	`Ârötf
(
logfûe
, "%s: 0x%08" 
PRIx64
 " %08x %08x => 0x%08" PRIx64 "\n",

41 
__func__
, 
now
, 
cou¡
, 
com∑ª
, 
√xt
 -Çow);

45 
ív
->
CP0_Com∑ª
 = 
com∑ª
;

46 
ív
->
CP0_Cou¡
 =

47 
cou¡
 - (
uöt32_t
)
	`muldiv64
(
now
, 100 * 1000 * 1000, 
ticks_≥r_£c
);

49 
	`qemu_mod_timî
(
ív
->
timî
, 
√xt
);

50 
	}
}

52 
	$˝u_mùs_°‹e_cou¡
 (
CPUSèã
 *
ív
, 
uöt32_t
 
vÆue
)

54 
	`˝u_mùs_upd©e_cou¡
(
ív
, 
vÆue
,Énv->
CP0_Com∑ª
);

55 
	}
}

57 
	$˝u_mùs_°‹e_com∑ª
 (
CPUSèã
 *
ív
, 
uöt32_t
 
vÆue
)

59 
	`˝u_mùs_upd©e_cou¡
(
ív
, 
	`˝u_mùs_gë_cou¡
”nv), 
vÆue
);

60 
	`˝u_mùs_úq_ªque°
(
ív
, 7, 0);

61 
	}
}

63 
	$mùs_timî_cb
 (*
›aque
)

65 
CPUSèã
 *
ív
;

67 
ív
 = 
›aque
;

69 i‡(
logfûe
) {

70 
	`Ârötf
(
logfûe
, "%s\n", 
__func__
);

73 
	`˝u_mùs_upd©e_cou¡
(
ív
, 
	`˝u_mùs_gë_cou¡
”nv),Énv->
CP0_Com∑ª
);

74 
	`˝u_mùs_úq_ªque°
(
ív
, 7, 1);

75 
	}
}

77 
	$˝u_mùs_˛ock_öô
 (
CPUSèã
 *
ív
)

79 
ív
->
timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, &
mùs_timî_cb
,Énv);

80 
ív
->
CP0_Com∑ª
 = 0;

81 
	`˝u_mùs_upd©e_cou¡
(
ív
, 1, 0);

82 
	}
}

	@ne2000.c

24 
	~"vl.h
"

29 
	#MAX_ETH_FRAME_SIZE
 1514

	)

31 
	#E8390_CMD
 0x00

	)

33 
	#EN0_CLDALO
 0x01

	)

34 
	#EN0_STARTPG
 0x01

	)

35 
	#EN0_CLDAHI
 0x02

	)

36 
	#EN0_STOPPG
 0x02

	)

37 
	#EN0_BOUNDARY
 0x03

	)

38 
	#EN0_TSR
 0x04

	)

39 
	#EN0_TPSR
 0x04

	)

40 
	#EN0_NCR
 0x05

	)

41 
	#EN0_TCNTLO
 0x05

	)

42 
	#EN0_FIFO
 0x06

	)

43 
	#EN0_TCNTHI
 0x06

	)

44 
	#EN0_ISR
 0x07

	)

45 
	#EN0_CRDALO
 0x08

	)

46 
	#EN0_RSARLO
 0x08

	)

47 
	#EN0_CRDAHI
 0x09

	)

48 
	#EN0_RSARHI
 0x09

	)

49 
	#EN0_RCNTLO
 0x0®

	)

50 
	#EN0_RTL8029ID0
 0x0®

	)

51 
	#EN0_RCNTHI
 0x0b

	)

52 
	#EN0_RTL8029ID1
 0x0b

	)

53 
	#EN0_RSR
 0x0¯

	)

54 
	#EN0_RXCR
 0x0¯

	)

55 
	#EN0_TXCR
 0x0d

	)

56 
	#EN0_COUNTER0
 0x0d

	)

57 
	#EN0_DCFG
 0x0ê

	)

58 
	#EN0_COUNTER1
 0x0ê

	)

59 
	#EN0_IMR
 0x0‡

	)

60 
	#EN0_COUNTER2
 0x0‡

	)

62 
	#EN1_PHYS
 0x11

	)

63 
	#EN1_CURPAG
 0x17

	)

64 
	#EN1_MULT
 0x18

	)

66 
	#EN2_STARTPG
 0x21

	)

67 
	#EN2_STOPPG
 0x22

	)

69 
	#EN3_CONFIG0
 0x33

	)

70 
	#EN3_CONFIG1
 0x34

	)

71 
	#EN3_CONFIG2
 0x35

	)

72 
	#EN3_CONFIG3
 0x36

	)

75 
	#E8390_STOP
 0x01

	)

76 
	#E8390_START
 0x02

	)

77 
	#E8390_TRANS
 0x04

	)

78 
	#E8390_RREAD
 0x08

	)

79 
	#E8390_RWRITE
 0x10

	)

80 
	#E8390_NODMA
 0x20

	)

81 
	#E8390_PAGE0
 0x00

	)

82 
	#E8390_PAGE1
 0x40

	)

83 
	#E8390_PAGE2
 0x80

	)

86 
	#ENISR_RX
 0x01

	)

87 
	#ENISR_TX
 0x02

	)

88 
	#ENISR_RX_ERR
 0x04

	)

89 
	#ENISR_TX_ERR
 0x08

	)

90 
	#ENISR_OVER
 0x10

	)

91 
	#ENISR_COUNTERS
 0x20

	)

92 
	#ENISR_RDC
 0x40

	)

93 
	#ENISR_RESET
 0x80

	)

94 
	#ENISR_ALL
 0x3‡

	)

97 
	#ENRSR_RXOK
 0x01

	)

98 
	#ENRSR_CRC
 0x02

	)

99 
	#ENRSR_FAE
 0x04

	)

100 
	#ENRSR_FO
 0x08

	)

101 
	#ENRSR_MPA
 0x10

	)

102 
	#ENRSR_PHY
 0x20

	)

103 
	#ENRSR_DIS
 0x40

	)

104 
	#ENRSR_DEF
 0x80

	)

107 
	#ENTSR_PTX
 0x01

	)

108 
	#ENTSR_ND
 0x02

	)

109 
	#ENTSR_COL
 0x04

	)

110 
	#ENTSR_ABT
 0x08

	)

111 
	#ENTSR_CRS
 0x10

	)

112 
	#ENTSR_FU
 0x20

	)

113 
	#ENTSR_CDH
 0x40

	)

114 
	#ENTSR_OWC
 0x80

	)

116 
	#NE2000_PMEM_SIZE
 (32*1024)

	)

117 
	#NE2000_PMEM_START
 (16*1024)

	)

118 
	#NE2000_PMEM_END
 (
NE2000_PMEM_SIZE
+
NE2000_PMEM_START
)

	)

119 
	#NE2000_MEM_SIZE
 
NE2000_PMEM_END


	)

121 
	sNE2000Sèã
 {

122 
uöt8_t
 
	mcmd
;

123 
uöt32_t
 
	m°¨t
;

124 
uöt32_t
 
	m°›
;

125 
uöt8_t
 
	mbound¨y
;

126 
uöt8_t
 
	mt§
;

127 
uöt8_t
 
	mç§
;

128 
uöt16_t
 
	mt˙t
;

129 
uöt16_t
 
	mr˙t
;

130 
uöt32_t
 
	mrßr
;

131 
uöt8_t
 
	mr§
;

132 
uöt8_t
 
	mrx¸
;

133 
uöt8_t
 
	mi§
;

134 
uöt8_t
 
	mdcfg
;

135 
uöt8_t
 
	mimr
;

136 
uöt8_t
 
	mphys
[6];

137 
uöt8_t
 
	mcuΩag
;

138 
uöt8_t
 
	mmu…
[8];

139 
	múq
;

140 
	mèöãd
;

141 
PCIDevi˚
 *
	mpci_dev
;

142 
VLANClõ¡Sèã
 *
	mvc
;

143 
uöt8_t
 
	mmaˇddr
[6];

144 
uöt8_t
 
	mmem
[
NE2000_MEM_SIZE
];

145 } 
	tNE2000Sèã
;

147 
	$√2000_ª£t
(
NE2000Sèã
 *
s
)

149 
i
;

151 
s
->
i§
 = 
ENISR_RESET
;

152 
	`mem˝y
(
s
->
mem
, s->
maˇddr
, 6);

153 
s
->
mem
[14] = 0x57;

154 
s
->
mem
[15] = 0x57;

157 
i
 = 15;i >= 0; i--) {

158 
s
->
mem
[2 * 
i
] = s->mem[i];

159 
s
->
mem
[2 * 
i
 + 1] = s->mem[i];

161 
	}
}

163 
	$√2000_upd©e_úq
(
NE2000Sèã
 *
s
)

165 
i§
;

166 
i§
 = (
s
->i§ & s->
imr
) & 0x7f;

167 #i‡
	`deföed
(
DEBUG_NE2000
)

168 
	`¥ötf
("NE2000: Set IRQÜine %dÅo %d (%02x %02x)\n",

169 
s
->
úq
, 
i§
 ? 1 : 0, s->i§, s->
imr
);

171 i‡(
s
->
úq
 == 16) {

173 
	`pci_£t_úq
(
s
->
pci_dev
, 0, (
i§
 != 0));

176 
	`pic_£t_úq
(
s
->
úq
, (
i§
 != 0));

178 
	}
}

180 
	#POLYNOMIAL
 0x04c11db6

	)

184 
	$compuã_mˇ°_idx
(c⁄° 
uöt8_t
 *
ï
)

186 
uöt32_t
 
¸c
;

187 
ˇºy
, 
i
, 
j
;

188 
uöt8_t
 
b
;

190 
¸c
 = 0xffffffff;

191 
i
 = 0; i < 6; i++) {

192 
b
 = *
ï
++;

193 
j
 = 0; j < 8; j++) {

194 
ˇºy
 = ((
¸c
 & 0x80000000LË? 1 : 0Ë^ (
b
 & 0x01);

195 
¸c
 <<= 1;

196 
b
 >>= 1;

197 i‡(
ˇºy
)

198 
¸c
 = ((¸¯^ 
POLYNOMIAL
Ë| 
ˇºy
);

201  (
¸c
 >> 26);

202 
	}
}

204 
	$√2000_buf„r_fuŒ
(
NE2000Sèã
 *
s
)

206 
avaû
, 
ödex
, 
bound¨y
;

208 
ödex
 = 
s
->
cuΩag
 << 8;

209 
bound¨y
 = 
s
->boundary << 8;

210 i‡(
ödex
 < 
bound¨y
)

211 
avaû
 = 
bound¨y
 - 
ödex
;

213 
avaû
 = (
s
->
°›
 - s->
°¨t
Ë- (
ödex
 - 
bound¨y
);

214 i‡(
avaû
 < (
MAX_ETH_FRAME_SIZE
 + 4))

217 
	}
}

219 
	$√2000_ˇn_ª˚ive
(*
›aque
)

221 
NE2000Sèã
 *
s
 = 
›aque
;

223 i‡(
s
->
cmd
 & 
E8390_STOP
)

225  !
	`√2000_buf„r_fuŒ
(
s
);

226 
	}
}

228 
	#MIN_BUF_SIZE
 60

	)

230 
ölöe
 
	$√2000_vÆid_rög_addr
(
NE2000Sèã
 *
s
, 
addr
)

232 
addr
 <<= 8;

233  
addr
 < 
s
->
°›
 &&ádd∏>s->
°¨t
;

234 
	}
}

236 
ölöe
 
	$√2000_check_°©e
(
NE2000Sèã
 *
s
)

238 i‡(!
s
->
èöãd
)

241 i‡(
s
->
°¨t
 >s->
°›
 || s->°› > 
NE2000_MEM_SIZE
)

242  -
EINVAL
;

244 i‡(!
	`√2000_vÆid_rög_addr
(
s
, s->
cuΩag
))

245  -
EINVAL
;

247 
s
->
èöãd
 = 0;

249 
	}
}

251 
	$√2000_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
size
)

253 
NE2000Sèã
 *
s
 = 
›aque
;

254 
uöt8_t
 *
p
;

255 
tŸÆ_Àn
, 
√xt
, 
avaû
, 
Àn
, 
ödex
, 
mˇ°_idx
;

256 
uöt8_t
 
buf1
[60];

257 c⁄° 
uöt8_t
 
brﬂdˇ°_maˇddr
[6] =

260 #i‡
	`deföed
(
DEBUG_NE2000
)

261 
	`¥ötf
("NE2000:Ñe˚ivedÜí=%d\n", 
size
);

264 i‡(
	`√2000_check_°©e
(
s
))

267 i‡(!
	`√2000_vÆid_rög_addr
(
s
, s->
bound¨y
))

270 i‡(
s
->
cmd
 & 
E8390_STOP
 || 
	`√2000_buf„r_fuŒ
(s))

274 i‡(
s
->
rx¸
 & 0x10) {

277 i‡(!
	`memcmp
(
buf
, 
brﬂdˇ°_maˇddr
, 6)) {

279 i‡(!(
s
->
rx¸
 & 0x04))

281 } i‡(
buf
[0] & 0x01) {

283 i‡(!(
s
->
rx¸
 & 0x08))

285 
mˇ°_idx
 = 
	`compuã_mˇ°_idx
(
buf
);

286 i‡(!(
s
->
mu…
[
mˇ°_idx
 >> 3] & (1 << (mcast_idx & 7))))

288 } i‡(
s
->
mem
[0] =
buf
[0] &&

289 
s
->
mem
[2] =
buf
[1] &&

290 
s
->
mem
[4] =
buf
[2] &&

291 
s
->
mem
[6] =
buf
[3] &&

292 
s
->
mem
[8] =
buf
[4] &&

293 
s
->
mem
[10] =
buf
[5]) {

302 i‡(
size
 < 
MIN_BUF_SIZE
) {

303 
	`mem˝y
(
buf1
, 
buf
, 
size
);

304 
	`mem£t
(
buf1
 + 
size
, 0, 
MIN_BUF_SIZE
 - size);

305 
buf
 = 
buf1
;

306 
size
 = 
MIN_BUF_SIZE
;

309 
ödex
 = 
s
->
cuΩag
 << 8;

311 
tŸÆ_Àn
 = 
size
 + 4;

313 
√xt
 = 
ödex
 + ((
tŸÆ_Àn
 + 4 + 255) & ~0xff);

314 i‡(
√xt
 >
s
->
°›
)

315 
√xt
 -(
s
->
°›
 - s->
°¨t
);

317 
p
 = 
s
->
mem
 + 
ödex
;

318 
s
->
r§
 = 
ENRSR_RXOK
;

320 i‡(
buf
[0] & 0x01)

321 
s
->
r§
 |
ENRSR_PHY
;

322 
p
[0] = 
s
->
r§
;

323 
p
[1] = 
√xt
 >> 8;

324 
p
[2] = 
tŸÆ_Àn
;

325 
p
[3] = 
tŸÆ_Àn
 >> 8;

326 
ödex
 += 4;

329 
size
 > 0) {

331 i‡(
ödex
 <
s
->
°›
)

332 
avaû
 = 
s
->
°›
 - 
ödex
;

334 
avaû
 = 0;

335 
Àn
 = 
size
;

336 i‡(
Àn
 > 
avaû
)

337 
Àn
 = 
avaû
;

338 
	`mem˝y
(
s
->
mem
 + 
ödex
, 
buf
, 
Àn
);

339 
buf
 +
Àn
;

340 
ödex
 +
Àn
;

341 i‡(
ödex
 =
s
->
°›
)

342 
ödex
 = 
s
->
°¨t
;

343 
size
 -
Àn
;

345 
s
->
cuΩag
 = 
√xt
 >> 8;

348 
s
->
i§
 |
ENISR_RX
;

349 
	`√2000_upd©e_úq
(
s
);

350 
	}
}

352 
	$√2000_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

354 
NE2000Sèã
 *
s
 = 
›aque
;

355 
off£t
, 
∑ge
, 
ödex
;

357 
addr
 &= 0xf;

358 #ifde‡
DEBUG_NE2000


359 
	`¥ötf
("NE2000: wrôêaddr=0x%x vÆ=0x%02x\n", 
addr
, 
vÆ
);

361 i‡(
addr
 =
E8390_CMD
) {

363 
s
->
cmd
 = 
vÆ
;

364 i‡(!(
vÆ
 & 
E8390_STOP
)) {

365 
s
->
i§
 &~
ENISR_RESET
;

367 i‡((
vÆ
 & (
E8390_RREAD
 | 
E8390_RWRITE
)) &&

368 
s
->
r˙t
 == 0) {

369 
s
->
i§
 |
ENISR_RDC
;

370 
	`√2000_upd©e_úq
(
s
);

372 i‡(
vÆ
 & 
E8390_TRANS
) {

373 
ödex
 = (
s
->
ç§
 << 8);

375 i‡(
ödex
 >
NE2000_PMEM_END
)

376 
ödex
 -
NE2000_PMEM_SIZE
;

378 i‡(
ödex
 + 
s
->
t˙t
 <
NE2000_PMEM_END
) {

379 
	`qemu_£nd_∑ckë
(
s
->
vc
, s->
mem
 + 
ödex
, s->
t˙t
);

382 
s
->
t§
 = 
ENTSR_PTX
;

383 
s
->
i§
 |
ENISR_TX
;

384 
s
->
cmd
 &~
E8390_TRANS
;

385 
	`√2000_upd©e_úq
(
s
);

389 
∑ge
 = 
s
->
cmd
 >> 6;

390 
off£t
 = 
addr
 | (
∑ge
 << 4);

391 
off£t
) {

392 
EN0_STARTPG
:

393 
s
->
°¨t
 = 
vÆ
 << 8;

394 
s
->
èöãd
 = 1;

396 
EN0_STOPPG
:

397 
s
->
°›
 = 
vÆ
 << 8;

398 
s
->
èöãd
 = 1;

400 
EN0_BOUNDARY
:

401 
s
->
bound¨y
 = 
vÆ
;

403 
EN0_IMR
:

404 
s
->
imr
 = 
vÆ
;

405 
	`√2000_upd©e_úq
(
s
);

407 
EN0_TPSR
:

408 
s
->
ç§
 = 
vÆ
;

410 
EN0_TCNTLO
:

411 
s
->
t˙t
 = (s->t˙à& 0xff00Ë| 
vÆ
;

413 
EN0_TCNTHI
:

414 
s
->
t˙t
 = (s->t˙à& 0x00ffË| (
vÆ
 << 8);

416 
EN0_RSARLO
:

417 
s
->
rßr
 = (s->rß∏& 0xff00Ë| 
vÆ
;

419 
EN0_RSARHI
:

420 
s
->
rßr
 = (s->rß∏& 0x00ffË| (
vÆ
 << 8);

422 
EN0_RCNTLO
:

423 
s
->
r˙t
 = (s->r˙à& 0xff00Ë| 
vÆ
;

425 
EN0_RCNTHI
:

426 
s
->
r˙t
 = (s->r˙à& 0x00ffË| (
vÆ
 << 8);

428 
EN0_RXCR
:

429 
s
->
rx¸
 = 
vÆ
;

431 
EN0_DCFG
:

432 
s
->
dcfg
 = 
vÆ
;

434 
EN0_ISR
:

435 
s
->
i§
 &~(
vÆ
 & 0x7f);

436 
	`√2000_upd©e_úq
(
s
);

438 
EN1_PHYS
 ... EN1_PHYS + 5:

439 
s
->
phys
[
off£t
 - 
EN1_PHYS
] = 
vÆ
;

441 
EN1_CURPAG
:

442 
s
->
cuΩag
 = 
vÆ
;

443 
s
->
èöãd
 = 1;

445 
EN1_MULT
 ... EN1_MULT + 7:

446 
s
->
mu…
[
off£t
 - 
EN1_MULT
] = 
vÆ
;

450 
	}
}

452 
uöt32_t
 
	$√2000_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

454 
NE2000Sèã
 *
s
 = 
›aque
;

455 
off£t
, 
∑ge
, 
ªt
;

457 
addr
 &= 0xf;

458 i‡(
addr
 =
E8390_CMD
) {

459 
ªt
 = 
s
->
cmd
;

461 
∑ge
 = 
s
->
cmd
 >> 6;

462 
off£t
 = 
addr
 | (
∑ge
 << 4);

463 
off£t
) {

464 
EN0_TSR
:

465 
ªt
 = 
s
->
t§
;

467 
EN0_BOUNDARY
:

468 
ªt
 = 
s
->
bound¨y
;

470 
EN0_ISR
:

471 
ªt
 = 
s
->
i§
;

473 
EN0_RSARLO
:

474 
ªt
 = 
s
->
rßr
 & 0x00ff;

476 
EN0_RSARHI
:

477 
ªt
 = 
s
->
rßr
 >> 8;

479 
EN1_PHYS
 ... EN1_PHYS + 5:

480 
ªt
 = 
s
->
phys
[
off£t
 - 
EN1_PHYS
];

482 
EN1_CURPAG
:

483 
ªt
 = 
s
->
cuΩag
;

485 
EN1_MULT
 ... EN1_MULT + 7:

486 
ªt
 = 
s
->
mu…
[
off£t
 - 
EN1_MULT
];

488 
EN0_RSR
:

489 
ªt
 = 
s
->
r§
;

491 
EN2_STARTPG
:

492 
ªt
 = 
s
->
°¨t
 >> 8;

494 
EN2_STOPPG
:

495 
ªt
 = 
s
->
°›
 >> 8;

497 
EN0_RTL8029ID0
:

498 
ªt
 = 0x50;

500 
EN0_RTL8029ID1
:

501 
ªt
 = 0x43;

503 
EN3_CONFIG0
:

504 
ªt
 = 0;

506 
EN3_CONFIG2
:

507 
ªt
 = 0x40;

509 
EN3_CONFIG3
:

510 
ªt
 = 0x40;

513 
ªt
 = 0x00;

517 #ifde‡
DEBUG_NE2000


518 
	`¥ötf
("NE2000:Ñódáddr=0x%x vÆ=%02x\n", 
addr
, 
ªt
);

520  
ªt
;

521 
	}
}

523 
ölöe
 
	$√2000_mem_wrôeb
(
NE2000Sèã
 *
s
, 
uöt32_t
 
addr
,

524 
uöt32_t
 
vÆ
)

526 i‡(
addr
 < 32 ||

527 (
addr
 >
NE2000_PMEM_START
 &&ádd∏< 
NE2000_MEM_SIZE
)) {

528 
s
->
mem
[
addr
] = 
vÆ
;

530 
	}
}

532 
ölöe
 
	$√2000_mem_wrôew
(
NE2000Sèã
 *
s
, 
uöt32_t
 
addr
,

533 
uöt32_t
 
vÆ
)

535 
addr
 &= ~1;

536 i‡(
addr
 < 32 ||

537 (
addr
 >
NE2000_PMEM_START
 &&ádd∏< 
NE2000_MEM_SIZE
)) {

538 *(
uöt16_t
 *)(
s
->
mem
 + 
addr
Ë
	`˝u_to_À16
(
vÆ
);

540 
	}
}

542 
ölöe
 
	$√2000_mem_wrôñ
(
NE2000Sèã
 *
s
, 
uöt32_t
 
addr
,

543 
uöt32_t
 
vÆ
)

545 
addr
 &= ~1;

546 i‡(
addr
 < 32 ||

547 (
addr
 >
NE2000_PMEM_START
 &&ádd∏< 
NE2000_MEM_SIZE
 - 2)) {

548 
	`˝u_to_À32wu
((
uöt32_t
 *)(
s
->
mem
 + 
addr
), 
vÆ
);

550 
	}
}

552 
ölöe
 
uöt32_t
 
	$√2000_mem_ªadb
(
NE2000Sèã
 *
s
, 
uöt32_t
 
addr
)

554 i‡(
addr
 < 32 ||

555 (
addr
 >
NE2000_PMEM_START
 &&ádd∏< 
NE2000_MEM_SIZE
)) {

556  
s
->
mem
[
addr
];

560 
	}
}

562 
ölöe
 
uöt32_t
 
	$√2000_mem_ªadw
(
NE2000Sèã
 *
s
, 
uöt32_t
 
addr
)

564 
addr
 &= ~1;

565 i‡(
addr
 < 32 ||

566 (
addr
 >
NE2000_PMEM_START
 &&ádd∏< 
NE2000_MEM_SIZE
)) {

567  
	`À16_to_˝u
(*(
uöt16_t
 *)(
s
->
mem
 + 
addr
));

571 
	}
}

573 
ölöe
 
uöt32_t
 
	$√2000_mem_ªadl
(
NE2000Sèã
 *
s
, 
uöt32_t
 
addr
)

575 
addr
 &= ~1;

576 i‡(
addr
 < 32 ||

577 (
addr
 >
NE2000_PMEM_START
 &&ádd∏< 
NE2000_MEM_SIZE
 - 2)) {

578  
	`À32_to_˝upu
((
uöt32_t
 *)(
s
->
mem
 + 
addr
));

582 
	}
}

584 
ölöe
 
	$√2000_dma_upd©e
(
NE2000Sèã
 *
s
, 
Àn
)

586 
s
->
rßr
 +
Àn
;

589 i‡(
s
->
rßr
 =s->
°›
)

590 
s
->
rßr
 = s->
°¨t
;

592 i‡(
s
->
r˙t
 <
Àn
) {

593 
s
->
r˙t
 = 0;

595 
s
->
i§
 |
ENISR_RDC
;

596 
	`√2000_upd©e_úq
(
s
);

598 
s
->
r˙t
 -
Àn
;

600 
	}
}

602 
	$√2000_asic_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

604 
NE2000Sèã
 *
s
 = 
›aque
;

606 #ifde‡
DEBUG_NE2000


607 
	`¥ötf
("NE2000:ási¯wrôêvÆ=0x%04x\n", 
vÆ
);

609 i‡(
s
->
r˙t
 == 0)

611 i‡(
s
->
dcfg
 & 0x01) {

613 
	`√2000_mem_wrôew
(
s
, s->
rßr
, 
vÆ
);

614 
	`√2000_dma_upd©e
(
s
, 2);

617 
	`√2000_mem_wrôeb
(
s
, s->
rßr
, 
vÆ
);

618 
	`√2000_dma_upd©e
(
s
, 1);

620 
	}
}

622 
uöt32_t
 
	$√2000_asic_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

624 
NE2000Sèã
 *
s
 = 
›aque
;

625 
ªt
;

627 i‡(
s
->
dcfg
 & 0x01) {

629 
ªt
 = 
	`√2000_mem_ªadw
(
s
, s->
rßr
);

630 
	`√2000_dma_upd©e
(
s
, 2);

633 
ªt
 = 
	`√2000_mem_ªadb
(
s
, s->
rßr
);

634 
	`√2000_dma_upd©e
(
s
, 1);

636 #ifde‡
DEBUG_NE2000


637 
	`¥ötf
("NE2000:ási¯ªad vÆ=0x%04x\n", 
ªt
);

639  
ªt
;

640 
	}
}

642 
	$√2000_asic_i›‹t_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

644 
NE2000Sèã
 *
s
 = 
›aque
;

646 #ifde‡
DEBUG_NE2000


647 
	`¥ötf
("NE2000:ási¯wrôñ vÆ=0x%04x\n", 
vÆ
);

649 i‡(
s
->
r˙t
 == 0)

652 
	`√2000_mem_wrôñ
(
s
, s->
rßr
, 
vÆ
);

653 
	`√2000_dma_upd©e
(
s
, 4);

654 
	}
}

656 
uöt32_t
 
	$√2000_asic_i›‹t_ªadl
(*
›aque
, 
uöt32_t
 
addr
)

658 
NE2000Sèã
 *
s
 = 
›aque
;

659 
ªt
;

662 
ªt
 = 
	`√2000_mem_ªadl
(
s
, s->
rßr
);

663 
	`√2000_dma_upd©e
(
s
, 4);

664 #ifde‡
DEBUG_NE2000


665 
	`¥ötf
("NE2000:ási¯ªad»vÆ=0x%04x\n", 
ªt
);

667  
ªt
;

668 
	}
}

670 
	$√2000_ª£t_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

673 
	}
}

675 
uöt32_t
 
	$√2000_ª£t_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

677 
NE2000Sèã
 *
s
 = 
›aque
;

678 
	`√2000_ª£t
(
s
);

680 
	}
}

682 
	$√2000_ßve
(
QEMUFûe
* 
f
,* 
›aque
)

684 
NE2000Sèã
* 
s
=(NE2000Sèã*)
›aque
;

686 i‡(
s
->
pci_dev
)

687 
	`pci_devi˚_ßve
(
s
->
pci_dev
, 
f
);

689 
	`qemu_put_8s
(
f
, &
s
->
rx¸
);

691 
	`qemu_put_8s
(
f
, &
s
->
cmd
);

692 
	`qemu_put_be32s
(
f
, &
s
->
°¨t
);

693 
	`qemu_put_be32s
(
f
, &
s
->
°›
);

694 
	`qemu_put_8s
(
f
, &
s
->
bound¨y
);

695 
	`qemu_put_8s
(
f
, &
s
->
t§
);

696 
	`qemu_put_8s
(
f
, &
s
->
ç§
);

697 
	`qemu_put_be16s
(
f
, &
s
->
t˙t
);

698 
	`qemu_put_be16s
(
f
, &
s
->
r˙t
);

699 
	`qemu_put_be32s
(
f
, &
s
->
rßr
);

700 
	`qemu_put_8s
(
f
, &
s
->
r§
);

701 
	`qemu_put_8s
(
f
, &
s
->
i§
);

702 
	`qemu_put_8s
(
f
, &
s
->
dcfg
);

703 
	`qemu_put_8s
(
f
, &
s
->
imr
);

704 
	`qemu_put_buf„r
(
f
, 
s
->
phys
, 6);

705 
	`qemu_put_8s
(
f
, &
s
->
cuΩag
);

706 
	`qemu_put_buf„r
(
f
, 
s
->
mu…
, 8);

707 
	`qemu_put_be32s
(
f
, &
s
->
úq
);

708 
	`qemu_put_buf„r
(
f
, 
s
->
mem
, 
NE2000_MEM_SIZE
);

709 
	}
}

711 
	$√2000_lﬂd
(
QEMUFûe
* 
f
,* 
›aque
,
vîsi⁄_id
)

713 
NE2000Sèã
* 
s
=(NE2000Sèã*)
›aque
;

714 
ªt
;

716 i‡(
vîsi⁄_id
 > 3)

717  -
EINVAL
;

719 i‡(
s
->
pci_dev
 && 
vîsi⁄_id
 >= 3) {

720 
ªt
 = 
	`pci_devi˚_lﬂd
(
s
->
pci_dev
, 
f
);

721 i‡(
ªt
 < 0)

722  
ªt
;

725 i‡(
vîsi⁄_id
 >= 2) {

726 
	`qemu_gë_8s
(
f
, &
s
->
rx¸
);

728 
s
->
rx¸
 = 0x0c;

731 
	`qemu_gë_8s
(
f
, &
s
->
cmd
);

732 
	`qemu_gë_be32s
(
f
, &
s
->
°¨t
);

733 
	`qemu_gë_be32s
(
f
, &
s
->
°›
);

734 
	`qemu_gë_8s
(
f
, &
s
->
bound¨y
);

735 
	`qemu_gë_8s
(
f
, &
s
->
t§
);

736 
	`qemu_gë_8s
(
f
, &
s
->
ç§
);

737 
	`qemu_gë_be16s
(
f
, &
s
->
t˙t
);

738 
	`qemu_gë_be16s
(
f
, &
s
->
r˙t
);

739 
	`qemu_gë_be32s
(
f
, &
s
->
rßr
);

740 
	`qemu_gë_8s
(
f
, &
s
->
r§
);

741 
	`qemu_gë_8s
(
f
, &
s
->
i§
);

742 
	`qemu_gë_8s
(
f
, &
s
->
dcfg
);

743 
	`qemu_gë_8s
(
f
, &
s
->
imr
);

744 
	`qemu_gë_buf„r
(
f
, 
s
->
phys
, 6);

745 
	`qemu_gë_8s
(
f
, &
s
->
cuΩag
);

746 
	`qemu_gë_buf„r
(
f
, 
s
->
mu…
, 8);

747 
	`qemu_gë_be32s
(
f
, &
s
->
úq
);

748 
	`qemu_gë_buf„r
(
f
, 
s
->
mem
, 
NE2000_MEM_SIZE
);

751 
	}
}

753 
	$iß_√2000_öô
(
ba£
, 
úq
, 
NICInfo
 *
nd
)

755 
NE2000Sèã
 *
s
;

757 
s
 = 
	`qemu_mÆlocz
((
NE2000Sèã
));

758 i‡(!
s
)

761 
	`ªgi°î_i›‹t_wrôe
(
ba£
, 16, 1, 
√2000_i›‹t_wrôe
, 
s
);

762 
	`ªgi°î_i›‹t_ªad
(
ba£
, 16, 1, 
√2000_i›‹t_ªad
, 
s
);

764 
	`ªgi°î_i›‹t_wrôe
(
ba£
 + 0x10, 1, 1, 
√2000_asic_i›‹t_wrôe
, 
s
);

765 
	`ªgi°î_i›‹t_ªad
(
ba£
 + 0x10, 1, 1, 
√2000_asic_i›‹t_ªad
, 
s
);

766 
	`ªgi°î_i›‹t_wrôe
(
ba£
 + 0x10, 2, 2, 
√2000_asic_i›‹t_wrôe
, 
s
);

767 
	`ªgi°î_i›‹t_ªad
(
ba£
 + 0x10, 2, 2, 
√2000_asic_i›‹t_ªad
, 
s
);

769 
	`ªgi°î_i›‹t_wrôe
(
ba£
 + 0x1f, 1, 1, 
√2000_ª£t_i›‹t_wrôe
, 
s
);

770 
	`ªgi°î_i›‹t_ªad
(
ba£
 + 0x1f, 1, 1, 
√2000_ª£t_i›‹t_ªad
, 
s
);

771 
s
->
úq
 = irq;

772 
	`mem˝y
(
s
->
maˇddr
, 
nd
->macaddr, 6);

774 
	`√2000_ª£t
(
s
);

776 
s
->
vc
 = 
	`qemu_√w_vœn_˛õ¡
(
nd
->
vœn
, 
√2000_ª˚ive
,

777 
√2000_ˇn_ª˚ive
, 
s
);

779 
	`¢¥ötf
(
s
->
vc
->
öfo_°r
, (s->vc->info_str),

781 
s
->
maˇddr
[0],

782 
s
->
maˇddr
[1],

783 
s
->
maˇddr
[2],

784 
s
->
maˇddr
[3],

785 
s
->
maˇddr
[4],

786 
s
->
maˇddr
[5]);

788 
	`ªgi°î_ßvevm
("√2000", 
ba£
, 2, 
√2000_ßve
, 
√2000_lﬂd
, 
s
);

789 
	}
}

794 
	sPCINE2000Sèã
 {

795 
PCIDevi˚
 
	mdev
;

796 
NE2000Sèã
 
	m√2000
;

797 } 
	tPCINE2000Sèã
;

799 
	$√2000_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

800 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

802 
PCINE2000Sèã
 *
d
 = (PCINE2000Sèã *)
pci_dev
;

803 
NE2000Sèã
 *
s
 = &
d
->
√2000
;

805 
	`ªgi°î_i›‹t_wrôe
(
addr
, 16, 1, 
√2000_i›‹t_wrôe
, 
s
);

806 
	`ªgi°î_i›‹t_ªad
(
addr
, 16, 1, 
√2000_i›‹t_ªad
, 
s
);

808 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 0x10, 1, 1, 
√2000_asic_i›‹t_wrôe
, 
s
);

809 
	`ªgi°î_i›‹t_ªad
(
addr
 + 0x10, 1, 1, 
√2000_asic_i›‹t_ªad
, 
s
);

810 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 0x10, 2, 2, 
√2000_asic_i›‹t_wrôe
, 
s
);

811 
	`ªgi°î_i›‹t_ªad
(
addr
 + 0x10, 2, 2, 
√2000_asic_i›‹t_ªad
, 
s
);

812 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 0x10, 4, 4, 
√2000_asic_i›‹t_wrôñ
, 
s
);

813 
	`ªgi°î_i›‹t_ªad
(
addr
 + 0x10, 4, 4, 
√2000_asic_i›‹t_ªadl
, 
s
);

815 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 0x1f, 1, 1, 
√2000_ª£t_i›‹t_wrôe
, 
s
);

816 
	`ªgi°î_i›‹t_ªad
(
addr
 + 0x1f, 1, 1, 
√2000_ª£t_i›‹t_ªad
, 
s
);

817 
	}
}

819 
	$pci_√2000_öô
(
PCIBus
 *
bus
, 
NICInfo
 *
nd
, 
dev‚
)

821 
PCINE2000Sèã
 *
d
;

822 
NE2000Sèã
 *
s
;

823 
uöt8_t
 *
pci_c⁄f
;

825 
d
 = (
PCINE2000Sèã
 *)
	`pci_ªgi°î_devi˚
(
bus
,

826 "NE2000", (
PCINE2000Sèã
),

827 
dev‚
,

828 
NULL
, NULL);

829 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

830 
pci_c⁄f
[0x00] = 0xec;

831 
pci_c⁄f
[0x01] = 0x10;

832 
pci_c⁄f
[0x02] = 0x29;

833 
pci_c⁄f
[0x03] = 0x80;

834 
pci_c⁄f
[0x0a] = 0x00;

835 
pci_c⁄f
[0x0b] = 0x02;

836 
pci_c⁄f
[0x0e] = 0x00;

837 
pci_c⁄f
[0x2c] = 0x53;

838 
pci_c⁄f
[0x2d] = 0x58;

839 
pci_c⁄f
[0x2e] = 0x01;

840 
pci_c⁄f
[0x2f] = 0x00;

841 
pci_c⁄f
[0x3d] = 1;

843 
	`pci_ªgi°î_io_ªgi⁄
(&
d
->
dev
, 0, 0x100,

844 
PCI_ADDRESS_SPACE_IO
, 
√2000_m≠
);

845 
s
 = &
d
->
√2000
;

846 
s
->
úq
 = 16;

847 
s
->
pci_dev
 = (
PCIDevi˚
 *)
d
;

848 
	`mem˝y
(
s
->
maˇddr
, 
nd
->macaddr, 6);

849 
	`√2000_ª£t
(
s
);

850 
s
->
vc
 = 
	`qemu_√w_vœn_˛õ¡
(
nd
->
vœn
, 
√2000_ª˚ive
,

851 
√2000_ˇn_ª˚ive
, 
s
);

853 
	`¢¥ötf
(
s
->
vc
->
öfo_°r
, (s->vc->info_str),

855 
s
->
maˇddr
[0],

856 
s
->
maˇddr
[1],

857 
s
->
maˇddr
[2],

858 
s
->
maˇddr
[3],

859 
s
->
maˇddr
[4],

860 
s
->
maˇddr
[5]);

863 
	`ªgi°î_ßvevm
("√2000", 0, 3, 
√2000_ßve
, 
√2000_lﬂd
, 
s
);

864 
	}
}

	@openpic.c

35 
	~"vl.h
"

39 #ifde‡
DEBUG_OPENPIC


40 
	#DPRINTF
(
fmt
, 
¨gs
...Ëdÿ{ 
	`¥ötf
(fmà, ##¨gs); } 0)

	)

42 
	#DPRINTF
(
fmt
, 
¨gs
...Ëdÿ{ } 0)

	)

44 
	#ERROR
(
fmr
, 
¨gs
...Ëdÿ{ 
	`¥ötf
("ERROR: " fm∏, ##¨gs); } 0)

	)

46 
	#USE_MPCxxx


	)

48 #i‡
deföed
 (
USE_INTEL_GW80314
)

51 
	#MAX_CPU
 4

	)

52 
	#MAX_IRQ
 32

	)

53 
	#MAX_DBL
 4

	)

54 
	#MAX_MBX
 4

	)

55 
	#MAX_TMR
 4

	)

56 
	#VECTOR_BITS
 8

	)

57 
	#MAX_IPI
 0

	)

59 
	#VID
 (0x00000000)

	)

61 
	#OPENPIC_LITTLE_ENDIAN
 1

	)

62 
	#OPENPIC_BIG_ENDIAN
 0

	)

64 #ñi‡
deföed
(
USE_MPCxxx
)

66 
	#MAX_CPU
 2

	)

67 
	#MAX_IRQ
 64

	)

68 
	#EXT_IRQ
 48

	)

69 
	#MAX_DBL
 0

	)

70 
	#MAX_MBX
 0

	)

71 
	#MAX_TMR
 4

	)

72 
	#VECTOR_BITS
 8

	)

73 
	#MAX_IPI
 4

	)

74 
	#VID
 0x03

	)

75 
	#VENI
 0x00000000

	)

78 
	mIRQ_IPVP
 = 0,

79 
	mIRQ_IDE
,

82 
	#OPENPIC_LITTLE_ENDIAN
 1

	)

83 
	#OPENPIC_BIG_ENDIAN
 0

	)

89 #i‡(
OPENPIC_BIG_ENDIAN
 && !
TARGET_WORDS_BIGENDIAN
) || \

90 (
	gOPENPIC_LITTLE_ENDIAN
 && 
	gTARGET_WORDS_BIGENDIAN
)

91 
	#OPENPIC_SWAP


	)

95 
	#IRQ_FE
 (
EXT_IRQ
Ë

	)

96 
	#IRQ_ERR
 (
EXT_IRQ
 + 1Ë

	)

97 
	#IRQ_TIM0
 (
EXT_IRQ
 + 2Ë

	)

98 #i‡
MAX_IPI
 > 0

99 
	#IRQ_IPI0
 (
IRQ_TIM0
 + 
MAX_TMR
Ë

	)

100 
	#IRQ_DBL0
 (
IRQ_IPI0
 + (
MAX_CPU
 * 
MAX_IPI
)Ë

	)

102 
	#IRQ_DBL0
 (
IRQ_TIM0
 + 
MAX_TMR
Ë

	)

103 
	#IRQ_MBX0
 (
IRQ_DBL0
 + 
MAX_DBL
Ë

	)

106 
	#BF_WIDTH
(
_bôs_
) \

107 (((
_bôs_
Ë+ ((
uöt32_t
Ë* 8Ë- 1Ë/ ((uöt32_tË* 8))

	)

109 
ölöe
 
	$£t_bô
 (
uöt32_t
 *
fõld
, 
bô
)

111 
fõld
[
bô
 >> 5] |= 1 << (bit & 0x1F);

112 
	}
}

114 
ölöe
 
	$ª£t_bô
 (
uöt32_t
 *
fõld
, 
bô
)

116 
fõld
[
bô
 >> 5] &= ~(1 << (bit & 0x1F));

117 
	}
}

119 
ölöe
 
	$ã°_bô
 (
uöt32_t
 *
fõld
, 
bô
)

121  (
fõld
[
bô
 >> 5] & 1 << (bit & 0x1F)) != 0;

122 
	}
}

125 
	mIRQ_EXTERNAL
 = 0x01,

126 
	mIRQ_INTERNAL
 = 0x02,

127 
	mIRQ_TIMER
 = 0x04,

128 
	mIRQ_SPECIAL
 = 0x08,

129 } 
	gIRQ_§c_ty≥
;

131 
	sIRQ_queue_t
 {

132 
uöt32_t
 
	mqueue
[
BF_WIDTH
(
MAX_IRQ
)];

133 
	m√xt
;

134 
	m¥i‹ôy
;

135 } 
	tIRQ_queue_t
;

137 
	sIRQ_§c_t
 {

138 
uöt32_t
 
	mùvp
;

139 
uöt32_t
 
	mide
;

140 
	mty≥
;

141 
	mœ°_˝u
;

142 
	m≥ndög
;

143 } 
	tIRQ_§c_t
;

145 
	eIPVP_bôs
 {

146 
	mIPVP_MASK
 = 31,

147 
	mIPVP_ACTIVITY
 = 30,

148 
	mIPVP_MODE
 = 29,

149 
	mIPVP_POLARITY
 = 23,

150 
	mIPVP_SENSE
 = 22,

152 
	#IPVP_PRIORITY_MASK
 (0x1F << 16)

	)

153 
	#IPVP_PRIORITY
(
_ùv¥_
Ë(()(((_ùv¥_Ë& 
IPVP_PRIORITY_MASK
Ë>> 16))

	)

154 
	#IPVP_VECTOR_MASK
 ((1 << 
VECTOR_BITS
Ë- 1)

	)

155 
	#IPVP_VECTOR
(
_ùv¥_
Ë((_ùv¥_Ë& 
IPVP_VECTOR_MASK
)

	)

157 
	sIRQ_d°_t
 {

158 
uöt32_t
 
	mp˘p
;

159 
uöt32_t
 
	mpc§
;

160 
IRQ_queue_t
 
	møi£d
;

161 
IRQ_queue_t
 
	m£rvicög
;

162 
CPUSèã
 *
	mív
;

163 } 
	tIRQ_d°_t
;

165 
	s›ípic_t
 {

166 
PCIDevi˚
 
	mpci_dev
;

167 
	mmem_ödex
;

169 
uöt32_t
 
	m‰ï
;

170 
uöt32_t
 
	mglbc
;

171 
uöt32_t
 
	mmi¸
;

172 
uöt32_t
 
	mvíi
;

173 
uöt32_t
 
	m•ve
;

174 
uöt32_t
 
	mti‰
;

176 
IRQ_§c_t
 
	m§c
[
MAX_IRQ
];

178 
IRQ_d°_t
 
	md°
[
MAX_CPU
];

179 
	mnb_˝us
;

182 
uöt32_t
 
	mticc
;

183 
uöt32_t
 
	mtibc
;

184 } 
	mtimîs
[
MAX_TMR
];

185 #i‡
MAX_DBL
 > 0

187 
uöt32_t
 
	md¨
;

189 
uöt32_t
 
	mdmr
;

190 } 
	mdo‹bñls
[
MAX_DBL
];

192 #i‡
MAX_MBX
 > 0

195 
uöt32_t
 
	mmbr
;

196 } 
	mmaûboxes
[
MAX_MAILBOXES
];

200 
ölöe
 
	$IRQ_£tbô
 (
IRQ_queue_t
 *
q
, 
n_IRQ
)

202 
	`£t_bô
(
q
->
queue
, 
n_IRQ
);

203 
	}
}

205 
ölöe
 
	$IRQ_ª£tbô
 (
IRQ_queue_t
 *
q
, 
n_IRQ
)

207 
	`ª£t_bô
(
q
->
queue
, 
n_IRQ
);

208 
	}
}

210 
ölöe
 
	$IRQ_ã°bô
 (
IRQ_queue_t
 *
q
, 
n_IRQ
)

212  
	`ã°_bô
(
q
->
queue
, 
n_IRQ
);

213 
	}
}

215 
	$IRQ_check
 (
›ípic_t
 *
›p
, 
IRQ_queue_t
 *
q
)

217 
√xt
, 
i
;

218 
¥i‹ôy
;

220 
√xt
 = -1;

221 
¥i‹ôy
 = -1;

222 
i
 = 0; i < 
MAX_IRQ
; i++) {

223 i‡(
	`IRQ_ã°bô
(
q
, 
i
)) {

224 
	`DPRINTF
("IRQ_check: irq %d set ipvp_pr=%dÖr=%d\n",

225 
i
, 
	`IPVP_PRIORITY
(
›p
->
§c
[i].
ùvp
), 
¥i‹ôy
);

226 i‡(
	`IPVP_PRIORITY
(
›p
->
§c
[
i
].
ùvp
Ë> 
¥i‹ôy
) {

227 
√xt
 = 
i
;

228 
¥i‹ôy
 = 
	`IPVP_PRIORITY
(
›p
->
§c
[
i
].
ùvp
);

232 
q
->
√xt
 =Çext;

233 
q
->
¥i‹ôy
 =Öriority;

234 
	}
}

236 
	$IRQ_gë_√xt
 (
›ípic_t
 *
›p
, 
IRQ_queue_t
 *
q
)

238 i‡(
q
->
√xt
 == -1) {

240 
	`IRQ_check
(
›p
, 
q
);

243  
q
->
√xt
;

244 
	}
}

246 
	$IRQ_loˇl_pùe
 (
›ípic_t
 *
›p
, 
n_CPU
, 
n_IRQ
)

248 
IRQ_d°_t
 *
d°
;

249 
IRQ_§c_t
 *
§c
;

250 
¥i‹ôy
;

252 
d°
 = &
›p
->d°[
n_CPU
];

253 
§c
 = &
›p
->§c[
n_IRQ
];

254 
¥i‹ôy
 = 
	`IPVP_PRIORITY
(
§c
->
ùvp
);

255 i‡(
¥i‹ôy
 <
d°
->
p˘p
) {

259 i‡(
	`IRQ_ã°bô
(&
d°
->
øi£d
, 
n_IRQ
)) {

263 
	`£t_bô
(&
§c
->
ùvp
, 
IPVP_ACTIVITY
);

264 
	`IRQ_£tbô
(&
d°
->
øi£d
, 
n_IRQ
);

265 i‡(
¥i‹ôy
 > 
d°
->
øi£d
.priority) {

266 
	`IRQ_gë_√xt
(
›p
, &
d°
->
øi£d
);

267 
	`DPRINTF
("Raise CPU IRQ\n");

268 
	`˝u_öãºu±
(
d°
->
ív
, 
CPU_INTERRUPT_HARD
);

270 
	}
}

273 
	$›ípic_upd©e_úq
(
›ípic_t
 *
›p
, 
n_IRQ
)

275 
IRQ_§c_t
 *
§c
;

276 
i
;

278 
§c
 = &
›p
->§c[
n_IRQ
];

280 i‡(!
§c
->
≥ndög
) {

284 i‡(
	`ã°_bô
(&
§c
->
ùvp
, 
IPVP_MASK
)) {

288 i‡(
	`IPVP_PRIORITY
(
§c
->
ùvp
) == 0) {

292 i‡(
	`ã°_bô
(&
§c
->
ùvp
, 
IPVP_ACTIVITY
)) {

296 i‡(
§c
->
ide
 == 0x00000000) {

301 i‡(!
	`ã°_bô
(&
§c
->
ùvp
, 
IPVP_MODE
) ||

302 
§c
->
ide
 =(1 << src->
œ°_˝u
)) {

304 
i
 = 0; i < 
›p
->
nb_˝us
; i++) {

305 i‡(
	`ã°_bô
(&
§c
->
ide
, 
i
))

306 
	`IRQ_loˇl_pùe
(
›p
, 
i
, 
n_IRQ
);

311 
i
 = 
§c
->
œ°_˝u
; i < src->last_cpu; i++) {

312 i‡(
i
 =
MAX_IRQ
)

313 
i
 = 0;

314 i‡(
	`ã°_bô
(&
§c
->
ide
, 
i
)) {

315 
	`IRQ_loˇl_pùe
(
›p
, 
i
, 
n_IRQ
);

316 
§c
->
œ°_˝u
 = 
i
;

321 
	}
}

323 
	$›ípic_£t_úq
(*
›aque
, 
n_IRQ
, 
Àvñ
)

325 
›ípic_t
 *
›p
 = 
›aque
;

326 
IRQ_§c_t
 *
§c
;

328 
§c
 = &
›p
->§c[
n_IRQ
];

329 
	`DPRINTF
("openpic: set irq %d = %d ipvp=%08x\n",

330 
n_IRQ
, 
Àvñ
, 
§c
->
ùvp
);

331 i‡(
	`ã°_bô
(&
§c
->
ùvp
, 
IPVP_SENSE
)) {

333 
§c
->
≥ndög
 = 
Àvñ
;

334 i‡(!
Àvñ
)

335 
	`ª£t_bô
(&
§c
->
ùvp
, 
IPVP_ACTIVITY
);

338 i‡(
Àvñ
)

339 
§c
->
≥ndög
 = 1;

341 
	`›ípic_upd©e_úq
(
›p
, 
n_IRQ
);

342 
	}
}

344 
	$›ípic_ª£t
 (
›ípic_t
 *
›p
)

346 
i
;

348 
›p
->
glbc
 = 0x80000000;

350 
›p
->
‰ï
 = ((
EXT_IRQ
 - 1Ë<< 16Ë| ((
MAX_CPU
 - 1Ë<< 8Ë| 
VID
;

351 
›p
->
víi
 = 
VENI
;

352 
›p
->
•ve
 = 0x000000FF;

353 
›p
->
ti‰
 = 0x003F7A00;

355 
›p
->
mi¸
 = 0x00000000;

357 
i
 = 0; i < 
MAX_IRQ
; i++) {

358 
›p
->
§c
[
i
].
ùvp
 = 0xA0000000;

359 
›p
->
§c
[
i
].
ide
 = 0x00000000;

362 
i
 = 0; i < 
›p
->
nb_˝us
; i++) {

363 
›p
->
d°
[
i
].
p˘p
 = 0x0000000F;

364 
›p
->
d°
[
i
].
pc§
 = 0x00000000;

365 
	`mem£t
(&
›p
->
d°
[
i
].
øi£d
, 0, (
IRQ_queue_t
));

366 
	`mem£t
(&
›p
->
d°
[
i
].
£rvicög
, 0, (
IRQ_queue_t
));

369 
i
 = 0; i < 
MAX_TMR
; i++) {

370 
›p
->
timîs
[
i
].
ticc
 = 0x00000000;

371 
›p
->
timîs
[
i
].
tibc
 = 0x80000000;

374 #i‡
MAX_DBL
 > 0

375 
›p
->
d¨
 = 0x00000000;

376 
i
 = 0; i < 
MAX_DBL
; i++) {

377 
›p
->
do‹bñls
[
i
].
dmr
 = 0x00000000;

381 #i‡
MAX_MBX
 > 0

382 
i
 = 0; i < 
MAX_MBX
; i++) {

383 
›p
->
maûboxes
[
i
].
mbr
 = 0x00000000;

387 
›p
->
glbc
 = 0x00000000;

388 
	}
}

390 
ölöe
 
uöt32_t
 
	$ªad_IRQªg
 (
›ípic_t
 *
›p
, 
n_IRQ
, 
uöt32_t
 
ªg
)

392 
uöt32_t
 
ªtvÆ
;

394 
ªg
) {

395 
IRQ_IPVP
:

396 
ªtvÆ
 = 
›p
->
§c
[
n_IRQ
].
ùvp
;

398 
IRQ_IDE
:

399 
ªtvÆ
 = 
›p
->
§c
[
n_IRQ
].
ide
;

403  
ªtvÆ
;

404 
	}
}

406 
ölöe
 
	$wrôe_IRQªg
 (
›ípic_t
 *
›p
, 
n_IRQ
,

407 
uöt32_t
 
ªg
, uöt32_à
vÆ
)

409 
uöt32_t
 
tmp
;

411 
ªg
) {

412 
IRQ_IPVP
:

416 
›p
->
§c
[
n_IRQ
].
ùvp
 =

417 (
›p
->
§c
[
n_IRQ
].
ùvp
 & 0x40000000) |

418 (
vÆ
 & 0x800F00FF);

419 
	`›ípic_upd©e_úq
(
›p
, 
n_IRQ
);

420 
	`DPRINTF
("Set IPVP %dÅo 0x%08x -> 0x%08x\n",

421 
n_IRQ
, 
vÆ
, 
›p
->
§c
[n_IRQ].
ùvp
);

423 
IRQ_IDE
:

424 
tmp
 = 
vÆ
 & 0xC0000000;

425 
tmp
 |
vÆ
 & ((1 << 
MAX_CPU
) - 1);

426 
›p
->
§c
[
n_IRQ
].
ide
 = 
tmp
;

427 
	`DPRINTF
("Së IDE %dÅÿ0x%08x\n", 
n_IRQ
, 
›p
->
§c
[n_IRQ].
ide
);

430 
	}
}

433 #i‡
MAX_DBL
 > 0

434 
uöt32_t
 
	$ªad_do‹bñl_ªgi°î
 (
›ípic_t
 *
›p
,

435 
n_dbl
, 
uöt32_t
 
off£t
)

437 
uöt32_t
 
ªtvÆ
;

439 
off£t
) {

440 
DBL_IPVP_OFFSET
:

441 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
IRQ_DBL0
 + 
n_dbl
, 
IRQ_IPVP
);

443 
DBL_IDE_OFFSET
:

444 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
IRQ_DBL0
 + 
n_dbl
, 
IRQ_IDE
);

446 
DBL_DMR_OFFSET
:

447 
ªtvÆ
 = 
›p
->
do‹bñls
[
n_dbl
].
dmr
;

451  
ªtvÆ
;

452 
	}
}

454 
	$wrôe_do‹bñl_ªgi°î
 (
≥≈ic_t
 *
›p
, 
n_dbl
,

455 
uöt32_t
 
off£t
, uöt32_à
vÆue
)

457 
off£t
) {

458 
DBL_IVPR_OFFSET
:

459 
	`wrôe_IRQªg
(
›p
, 
IRQ_DBL0
 + 
n_dbl
, 
IRQ_IPVP
, 
vÆue
);

461 
DBL_IDE_OFFSET
:

462 
	`wrôe_IRQªg
(
›p
, 
IRQ_DBL0
 + 
n_dbl
, 
IRQ_IDE
, 
vÆue
);

464 
DBL_DMR_OFFSET
:

465 
›p
->
do‹bñls
[
n_dbl
].
dmr
 = 
vÆue
;

468 
	}
}

471 #i‡
MAX_MBX
 > 0

472 
uöt32_t
 
	$ªad_maûbox_ªgi°î
 (
›ípic_t
 *
›p
,

473 
n_mbx
, 
uöt32_t
 
off£t
)

475 
uöt32_t
 
ªtvÆ
;

477 
off£t
) {

478 
MBX_MBR_OFFSET
:

479 
ªtvÆ
 = 
›p
->
maûboxes
[
n_mbx
].
mbr
;

481 
MBX_IVPR_OFFSET
:

482 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
IRQ_MBX0
 + 
n_mbx
, 
IRQ_IPVP
);

484 
MBX_DMR_OFFSET
:

485 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
IRQ_MBX0
 + 
n_mbx
, 
IRQ_IDE
);

489  
ªtvÆ
;

490 
	}
}

492 
	$wrôe_maûbox_ªgi°î
 (
›ípic_t
 *
›p
, 
n_mbx
,

493 
uöt32_t
 
addªss
, uöt32_à
vÆue
)

495 
off£t
) {

496 
MBX_MBR_OFFSET
:

497 
›p
->
maûboxes
[
n_mbx
].
mbr
 = 
vÆue
;

499 
MBX_IVPR_OFFSET
:

500 
	`wrôe_IRQªg
(
›p
, 
IRQ_MBX0
 + 
n_mbx
, 
IRQ_IPVP
, 
vÆue
);

502 
MBX_DMR_OFFSET
:

503 
	`wrôe_IRQªg
(
›p
, 
IRQ_MBX0
 + 
n_mbx
, 
IRQ_IDE
, 
vÆue
);

506 
	}
}

510 
	$›ípic_gbl_wrôe
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

512 
›ípic_t
 *
›p
 = 
›aque
;

514 
	`DPRINTF
("%s:ádd∏%08x <%08x\n", 
__func__
, 
addr
, 
vÆ
);

515 i‡(
addr
 & 0xF)

517 #i‡
deföed
 
OPENPIC_SWAP


518 
vÆ
 = 
	`bsw≠32
(val);

520 
addr
 &= 0xFF;

521 
addr
) {

525 i‡(
vÆ
 & 0x80000000)

526 
	`›ípic_ª£t
(
›p
);

527 
›p
->
glbc
 = 
vÆ
 & ~0x80000000;

533 i‡(
vÆ
 & 1) {

534 
	`DPRINTF
("Reset CPU IRQ\n");

538 #i‡
MAX_IPI
 > 0

544 
idx
;

545 
idx
 = (
addr
 - 0xA0) >> 4;

546 
	`wrôe_IRQªg
(
›p
, 
IRQ_IPI0
 + 
idx
, 
IRQ_IPVP
, 
vÆ
);

551 
›p
->
•ve
 = 
vÆ
 & 0x000000FF;

554 
›p
->
ti‰
 = 
vÆ
;

559 
	}
}

561 
uöt32_t
 
	$›ípic_gbl_ªad
 (*
›aque
, 
uöt32_t
 
addr
)

563 
›ípic_t
 *
›p
 = 
›aque
;

564 
uöt32_t
 
ªtvÆ
;

566 
	`DPRINTF
("%s:ádd∏%08x\n", 
__func__
, 
addr
);

567 
ªtvÆ
 = 0xFFFFFFFF;

568 i‡(
addr
 & 0xF)

569  
ªtvÆ
;

570 
addr
 &= 0xFF;

571 
addr
) {

573 
ªtvÆ
 = 
›p
->
‰ï
;

576 
ªtvÆ
 = 
›p
->
glbc
;

579 
ªtvÆ
 = 
›p
->
víi
;

582 
ªtvÆ
 = 0x00000000;

584 #i‡
MAX_IPI
 > 0

590 
idx
;

591 
idx
 = (
addr
 - 0xA0) >> 4;

592 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
IRQ_IPI0
 + 
idx
, 
IRQ_IPVP
);

597 
ªtvÆ
 = 
›p
->
•ve
;

600 
ªtvÆ
 = 
›p
->
ti‰
;

605 
	`DPRINTF
("%s: => %08x\n", 
__func__
, 
ªtvÆ
);

606 #i‡
deföed
 
OPENPIC_SWAP


607 
ªtvÆ
 = 
	`bsw≠32
(retval);

610  
ªtvÆ
;

611 
	}
}

613 
	$›ípic_timî_wrôe
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

615 
›ípic_t
 *
›p
 = 
›aque
;

616 
idx
;

618 
	`DPRINTF
("%s:ádd∏%08x <%08x\n", 
__func__
, 
addr
, 
vÆ
);

619 i‡(
addr
 & 0xF)

621 #i‡
deföed
 
OPENPIC_SWAP


622 
vÆ
 = 
	`bsw≠32
(val);

624 
addr
 -= 0x1100;

625 
addr
 &= 0xFFFF;

626 
idx
 = (
addr
 & 0xFFF0) >> 6;

627 
addr
 =áddr & 0x30;

628 
addr
) {

632 i‡((
›p
->
timîs
[
idx
].
ticc
 & 0x80000000) != 0 &&

633 (
vÆ
 & 0x80000000) == 0 &&

634 (
›p
->
timîs
[
idx
].
tibc
 & 0x80000000) != 0)

635 
›p
->
timîs
[
idx
].
ticc
 &= ~0x80000000;

636 
›p
->
timîs
[
idx
].
tibc
 = 
vÆ
;

639 
	`wrôe_IRQªg
(
›p
, 
IRQ_TIM0
 + 
idx
, 
IRQ_IPVP
, 
vÆ
);

642 
	`wrôe_IRQªg
(
›p
, 
IRQ_TIM0
 + 
idx
, 
IRQ_IDE
, 
vÆ
);

645 
	}
}

647 
uöt32_t
 
	$›ípic_timî_ªad
 (*
›aque
, 
uöt32_t
 
addr
)

649 
›ípic_t
 *
›p
 = 
›aque
;

650 
uöt32_t
 
ªtvÆ
;

651 
idx
;

653 
	`DPRINTF
("%s:ádd∏%08x\n", 
__func__
, 
addr
);

654 
ªtvÆ
 = 0xFFFFFFFF;

655 i‡(
addr
 & 0xF)

656  
ªtvÆ
;

657 
addr
 -= 0x1100;

658 
addr
 &= 0xFFFF;

659 
idx
 = (
addr
 & 0xFFF0) >> 6;

660 
addr
 =áddr & 0x30;

661 
addr
) {

663 
ªtvÆ
 = 
›p
->
timîs
[
idx
].
ticc
;

666 
ªtvÆ
 = 
›p
->
timîs
[
idx
].
tibc
;

669 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
IRQ_TIM0
 + 
idx
, 
IRQ_IPVP
);

672 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
IRQ_TIM0
 + 
idx
, 
IRQ_IDE
);

675 
	`DPRINTF
("%s: => %08x\n", 
__func__
, 
ªtvÆ
);

676 #i‡
deföed
 
OPENPIC_SWAP


677 
ªtvÆ
 = 
	`bsw≠32
(retval);

680  
ªtvÆ
;

681 
	}
}

683 
	$›ípic_§c_wrôe
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

685 
›ípic_t
 *
›p
 = 
›aque
;

686 
idx
;

688 
	`DPRINTF
("%s:ádd∏%08x <%08x\n", 
__func__
, 
addr
, 
vÆ
);

689 i‡(
addr
 & 0xF)

691 #i‡
deföed
 
OPENPIC_SWAP


692 
vÆ
 = 
	`tsw≠32
(val);

694 
addr
 =áddr & 0xFFF0;

695 
idx
 = 
addr
 >> 5;

696 i‡(
addr
 & 0x10) {

698 
	`wrôe_IRQªg
(
›p
, 
idx
, 
IRQ_IDE
, 
vÆ
);

701 
	`wrôe_IRQªg
(
›p
, 
idx
, 
IRQ_IPVP
, 
vÆ
);

703 
	}
}

705 
uöt32_t
 
	$›ípic_§c_ªad
 (*
›aque
, 
uöt32_t
 
addr
)

707 
›ípic_t
 *
›p
 = 
›aque
;

708 
uöt32_t
 
ªtvÆ
;

709 
idx
;

711 
	`DPRINTF
("%s:ádd∏%08x\n", 
__func__
, 
addr
);

712 
ªtvÆ
 = 0xFFFFFFFF;

713 i‡(
addr
 & 0xF)

714  
ªtvÆ
;

715 
addr
 =áddr & 0xFFF0;

716 
idx
 = 
addr
 >> 5;

717 i‡(
addr
 & 0x10) {

719 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
idx
, 
IRQ_IDE
);

722 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
idx
, 
IRQ_IPVP
);

724 
	`DPRINTF
("%s: => %08x\n", 
__func__
, 
ªtvÆ
);

725 #i‡
deföed
 
OPENPIC_SWAP


726 
ªtvÆ
 = 
	`tsw≠32
(retval);

729  
ªtvÆ
;

730 
	}
}

732 
	$›ípic_˝u_wrôe
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

734 
›ípic_t
 *
›p
 = 
›aque
;

735 
IRQ_§c_t
 *
§c
;

736 
IRQ_d°_t
 *
d°
;

737 
idx
, 
n_IRQ
;

739 
	`DPRINTF
("%s:ádd∏%08x <%08x\n", 
__func__
, 
addr
, 
vÆ
);

740 i‡(
addr
 & 0xF)

742 #i‡
deföed
 
OPENPIC_SWAP


743 
vÆ
 = 
	`bsw≠32
(val);

745 
addr
 &= 0x1FFF0;

746 
idx
 = 
addr
 / 0x1000;

747 
d°
 = &
›p
->d°[
idx
];

748 
addr
 &= 0xFF0;

749 
addr
) {

750 #i‡
MAX_IPI
 > 0

755 
idx
 = (
addr
 - 0x40) >> 4;

756 
	`wrôe_IRQªg
(
›p
, 
IRQ_IPI0
 + 
idx
, 
IRQ_IDE
, 
vÆ
);

757 
	`›ípic_£t_úq
(
›p
, 
IRQ_IPI0
 + 
idx
, 1);

758 
	`›ípic_£t_úq
(
›p
, 
IRQ_IPI0
 + 
idx
, 0);

762 
d°
->
p˘p
 = 
vÆ
 & 0x0000000F;

771 
	`DPRINTF
("PEOI\n");

772 
n_IRQ
 = 
	`IRQ_gë_√xt
(
›p
, &
d°
->
£rvicög
);

773 
	`IRQ_ª£tbô
(&
d°
->
£rvicög
, 
n_IRQ
);

774 
d°
->
£rvicög
.
√xt
 = -1;

775 
§c
 = &
›p
->§c[
n_IRQ
];

777 
	`IRQ_gë_√xt
(
›p
, &
d°
->
£rvicög
);

779 
n_IRQ
 = 
	`IRQ_gë_√xt
(
›p
, &
d°
->
øi£d
);

780 i‡(
n_IRQ
 != -1) {

781 
§c
 = &
›p
->§c[
n_IRQ
];

782 i‡(
	`IPVP_PRIORITY
(
§c
->
ùvp
Ë> 
d°
->
£rvicög
.
¥i‹ôy
) {

783 
	`DPRINTF
("Raise CPU IRQ\n");

784 
	`˝u_öãºu±
(
d°
->
ív
, 
CPU_INTERRUPT_HARD
);

791 
	}
}

793 
uöt32_t
 
	$›ípic_˝u_ªad
 (*
›aque
, 
uöt32_t
 
addr
)

795 
›ípic_t
 *
›p
 = 
›aque
;

796 
IRQ_§c_t
 *
§c
;

797 
IRQ_d°_t
 *
d°
;

798 
uöt32_t
 
ªtvÆ
;

799 
idx
, 
n_IRQ
;

801 
	`DPRINTF
("%s:ádd∏%08x\n", 
__func__
, 
addr
);

802 
ªtvÆ
 = 0xFFFFFFFF;

803 i‡(
addr
 & 0xF)

804  
ªtvÆ
;

805 
addr
 &= 0x1FFF0;

806 
idx
 = 
addr
 / 0x1000;

807 
d°
 = &
›p
->d°[
idx
];

808 
addr
 &= 0xFF0;

809 
addr
) {

811 
ªtvÆ
 = 
d°
->
p˘p
;

814 
ªtvÆ
 = 
idx
;

817 
n_IRQ
 = 
	`IRQ_gë_√xt
(
›p
, &
d°
->
øi£d
);

818 
	`DPRINTF
("PIAC: irq=%d\n", 
n_IRQ
);

819 i‡(
n_IRQ
 == -1) {

821 
ªtvÆ
 = 
›p
->
•ve
;

823 
§c
 = &
›p
->§c[
n_IRQ
];

824 i‡(!
	`ã°_bô
(&
§c
->
ùvp
, 
IPVP_ACTIVITY
) ||

825 !(
	`IPVP_PRIORITY
(
§c
->
ùvp
Ë> 
d°
->
p˘p
)) {

830 
	`ª£t_bô
(&
§c
->
ùvp
, 
IPVP_ACTIVITY
);

831 
ªtvÆ
 = 
	`IPVP_VECTOR
(
›p
->
•ve
);

834 
	`IRQ_£tbô
(&
d°
->
£rvicög
, 
n_IRQ
);

835 
ªtvÆ
 = 
	`IPVP_VECTOR
(
§c
->
ùvp
);

837 
	`IRQ_ª£tbô
(&
d°
->
øi£d
, 
n_IRQ
);

838 
d°
->
øi£d
.
√xt
 = -1;

839 i‡(!
	`ã°_bô
(&
§c
->
ùvp
, 
IPVP_SENSE
)) {

841 
	`ª£t_bô
(&
§c
->
ùvp
, 
IPVP_ACTIVITY
);

842 
§c
->
≥ndög
 = 0;

847 
ªtvÆ
 = 0;

849 #i‡
MAX_IPI
 > 0

852 
idx
 = (
addr
 - 0x40) >> 4;

853 
ªtvÆ
 = 
	`ªad_IRQªg
(
›p
, 
IRQ_IPI0
 + 
idx
, 
IRQ_IDE
);

859 
	`DPRINTF
("%s: => %08x\n", 
__func__
, 
ªtvÆ
);

860 #i‡
deföed
 
OPENPIC_SWAP


861 
ªtvÆ

	`bsw≠32
(retval);

864  
ªtvÆ
;

865 
	}
}

867 
	$›ípic_buggy_wrôe
 (*
›aque
,

868 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

870 
	`¥ötf
("Invalid OPENPIC writeáccess !\n");

871 
	}
}

873 
uöt32_t
 
	$›ípic_buggy_ªad
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

875 
	`¥ötf
("Invalid OPENPICÑeadáccess !\n");

878 
	}
}

880 
	$›ípic_wrôñ
 (*
›aque
,

881 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

883 
›ípic_t
 *
›p
 = 
›aque
;

885 
addr
 &= 0x3FFFF;

886 
	`DPRINTF
("%s: off£à%08x vÆ: %08x\n", 
__func__
, ()
addr
, 
vÆ
);

887 i‡(
addr
 < 0x1100) {

889 
	`›ípic_gbl_wrôe
(
›p
, 
addr
, 
vÆ
);

890 } i‡(
addr
 < 0x10000) {

892 
	`›ípic_timî_wrôe
(
›p
, 
addr
, 
vÆ
);

893 } i‡(
addr
 < 0x20000) {

895 
	`›ípic_§c_wrôe
(
›p
, 
addr
, 
vÆ
);

898 
	`›ípic_˝u_wrôe
(
›p
, 
addr
, 
vÆ
);

900 
	}
}

902 
uöt32_t
 
	$›ípic_ªadl
 (*
›aque
,
èrgë_phys_addr_t
 
addr
)

904 
›ípic_t
 *
›p
 = 
›aque
;

905 
uöt32_t
 
ªtvÆ
;

907 
addr
 &= 0x3FFFF;

908 
	`DPRINTF
("%s: off£à%08x\n", 
__func__
, ()
addr
);

909 i‡(
addr
 < 0x1100) {

911 
ªtvÆ
 = 
	`›ípic_gbl_ªad
(
›p
, 
addr
);

912 } i‡(
addr
 < 0x10000) {

914 
ªtvÆ
 = 
	`›ípic_timî_ªad
(
›p
, 
addr
);

915 } i‡(
addr
 < 0x20000) {

917 
ªtvÆ
 = 
	`›ípic_§c_ªad
(
›p
, 
addr
);

920 
ªtvÆ
 = 
	`›ípic_˝u_ªad
(
›p
, 
addr
);

923  
ªtvÆ
;

924 
	}
}

926 
CPUWrôeMem‹yFunc
 *
	g›ípic_wrôe
[] = {

927 &
›ípic_buggy_wrôe
,

928 &
›ípic_buggy_wrôe
,

929 &
›ípic_wrôñ
,

932 
CPURódMem‹yFunc
 *
	g›ípic_ªad
[] = {

933 &
›ípic_buggy_ªad
,

934 &
›ípic_buggy_ªad
,

935 &
›ípic_ªadl
,

938 
	$›ípic_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

939 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

941 
›ípic_t
 *
›p
;

943 
	`DPRINTF
("Map OpenPIC\n");

944 
›p
 = (
›ípic_t
 *)
pci_dev
;

946 
	`DPRINTF
("Register OPENPIC gbl %08x => %08x\n",

947 
addr
 + 0x1000,áddr + 0x1000 + 0x100);

949 
	`DPRINTF
("Register OPENPICÅimer %08x => %08x\n",

950 
addr
 + 0x1100,ádd∏+ 0x1100 + 0x40 * 
MAX_TMR
);

952 
	`DPRINTF
("Register OPENPIC src %08x => %08x\n",

953 
addr
 + 0x10000,ádd∏+ 0x10000 + 0x20 * (
EXT_IRQ
 + 2));

955 
	`DPRINTF
("Register OPENPIC dst %08x => %08x\n",

956 
addr
 + 0x20000,ádd∏+ 0x20000 + 0x1000 * 
MAX_CPU
);

957 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 0x40000, 
›p
->
mem_ödex
);

959 
›p_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
›ípic_§c_ªad
,

960 
›ípic_§c_wrôe
);

961 
	`˝u_ªgi°î_physiˇl_mem‹y
(
isu_ba£
, 0x20 * (
EXT_IRQ
 + 2),

962 
›p_io_mem‹y
);

964 
	}
}

966 
›ípic_t
 *
	$›ípic_öô
 (
PCIBus
 *
bus
, *
pmem_ödex
, 
nb_˝us
,

967 
CPUPPCSèã
 **
ívp
)

969 
›ípic_t
 *
›p
;

970 
uöt8_t
 *
pci_c⁄f
;

971 
i
, 
m
;

974 i‡(
nb_˝us
 != 1)

975  
NULL
;

976 i‡(
bus
) {

977 
›p
 = (
›ípic_t
 *)
	`pci_ªgi°î_devi˚
(
bus
, "OpenPIC", (openpic_t),

978 -1, 
NULL
, NULL);

979 i‡(
›p
 =
NULL
)

980  
NULL
;

981 
pci_c⁄f
 = 
›p
->
pci_dev
.
c⁄fig
;

982 
pci_c⁄f
[0x00] = 0x14;

983 
pci_c⁄f
[0x01] = 0x10;

984 
pci_c⁄f
[0x02] = 0xFF;

985 
pci_c⁄f
[0x03] = 0xFF;

986 
pci_c⁄f
[0x0a] = 0x80;

987 
pci_c⁄f
[0x0b] = 0x08;

988 
pci_c⁄f
[0x0e] = 0x00;

989 
pci_c⁄f
[0x3d] = 0x00;

992 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
›p
, 0, 0x40000,

993 
PCI_ADDRESS_SPACE_MEM
, &
›ípic_m≠
);

995 
›p
 = 
	`qemu_mÆlocz
((
›ípic_t
));

998 
›p
->
mem_ödex
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
›ípic_ªad
,

999 
›ípic_wrôe
, 
›p
);

1002 
›p
->
nb_˝us
 =Çb_cpus;

1004 
i
 = 0; i < 
EXT_IRQ
; i++) {

1005 
›p
->
§c
[
i
].
ty≥
 = 
IRQ_EXTERNAL
;

1007 ; 
i
 < 
IRQ_TIM0
; i++) {

1008 
›p
->
§c
[
i
].
ty≥
 = 
IRQ_SPECIAL
;

1010 #i‡
MAX_IPI
 > 0

1011 
m
 = 
IRQ_IPI0
;

1013 
m
 = 
IRQ_DBL0
;

1015 ; 
i
 < 
m
; i++) {

1016 
›p
->
§c
[
i
].
ty≥
 = 
IRQ_TIMER
;

1018 ; 
i
 < 
MAX_IRQ
; i++) {

1019 
›p
->
§c
[
i
].
ty≥
 = 
IRQ_INTERNAL
;

1021 
i
 = 0; i < 
nb_˝us
; i++)

1022 
›p
->
d°
[
i
].
ív
 = 
ívp
[i];

1023 
	`›ípic_ª£t
(
›p
);

1024 i‡(
pmem_ödex
)

1025 *
pmem_ödex
 = 
›p
->
mem_ödex
;

1026  
›p
;

1027 
	}
}

	@parallel.c

24 
	~"vl.h
"

31 
	#PARA_STS_BUSY
 0x80

	)

32 
	#PARA_STS_ACK
 0x40

	)

33 
	#PARA_STS_PAPER
 0x20

	)

34 
	#PARA_STS_ONLINE
 0x10

	)

35 
	#PARA_STS_ERROR
 0x08

	)

40 
	#PARA_CTR_INTEN
 0x10

	)

41 
	#PARA_CTR_SELECT
 0x08

	)

42 
	#PARA_CTR_INIT
 0x04

	)

43 
	#PARA_CTR_AUTOLF
 0x02

	)

44 
	#PARA_CTR_STROBE
 0x01

	)

46 
	sP¨ÆÀlSèã
 {

47 
uöt8_t
 
	md©a
;

48 
uöt8_t
 
	m°©us
;

49 
uöt8_t
 
	mc⁄åﬁ
;

50 
	múq
;

51 
	múq_≥ndög
;

52 
Ch¨DrivîSèã
 *
	mchr
;

53 
	mhw_drivî
;

56 
	$∑øŒñ_upd©e_úq
(
P¨ÆÀlSèã
 *
s
)

58 i‡(
s
->
úq_≥ndög
)

59 
	`pic_£t_úq
(
s
->
úq
, 1);

61 
	`pic_£t_úq
(
s
->
úq
, 0);

62 
	}
}

64 
	$∑øŒñ_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

66 
P¨ÆÀlSèã
 *
s
 = 
›aque
;

68 
addr
 &= 7;

69 #ifde‡
DEBUG_PARALLEL


70 
	`¥ötf
("∑øŒñ: wrôêaddr=0x%02x vÆ=0x%02x\n", 
addr
, 
vÆ
);

72 
addr
) {

74 i‡(
s
->
hw_drivî
) {

75 
s
->
d©a
 = 
vÆ
;

76 
	`qemu_chr_io˘l
(
s
->
chr
, 
CHR_IOCTL_PP_WRITE_DATA
, &s->
d©a
);

78 
s
->
d©a
 = 
vÆ
;

79 
	`∑øŒñ_upd©e_úq
(
s
);

83 i‡(
s
->
hw_drivî
) {

84 
s
->
c⁄åﬁ
 = 
vÆ
;

85 
	`qemu_chr_io˘l
(
s
->
chr
, 
CHR_IOCTL_PP_WRITE_CONTROL
, &s->
c⁄åﬁ
);

87 i‡((
vÆ
 & 
PARA_CTR_INIT
) == 0 ) {

88 
s
->
°©us
 = 
PARA_STS_BUSY
;

89 
s
->
°©us
 |
PARA_STS_ACK
;

90 
s
->
°©us
 |
PARA_STS_ONLINE
;

91 
s
->
°©us
 |
PARA_STS_ERROR
;

93 i‡(
vÆ
 & 
PARA_CTR_SELECT
) {

94 i‡(
vÆ
 & 
PARA_CTR_STROBE
) {

95 
s
->
°©us
 &~
PARA_STS_BUSY
;

96 i‡((
s
->
c⁄åﬁ
 & 
PARA_CTR_STROBE
) == 0)

97 
	`qemu_chr_wrôe
(
s
->
chr
, &s->
d©a
, 1);

99 i‡(
s
->
c⁄åﬁ
 & 
PARA_CTR_INTEN
) {

100 
s
->
úq_≥ndög
 = 1;

104 
	`∑øŒñ_upd©e_úq
(
s
);

105 
s
->
c⁄åﬁ
 = 
vÆ
;

109 
	}
}

111 
uöt32_t
 
	$∑øŒñ_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

113 
P¨ÆÀlSèã
 *
s
 = 
›aque
;

114 
uöt32_t
 
ªt
 = 0xff;

116 
addr
 &= 7;

117 
addr
) {

119 i‡(
s
->
hw_drivî
) {

120 
	`qemu_chr_io˘l
(
s
->
chr
, 
CHR_IOCTL_PP_READ_DATA
, &s->
d©a
);

122 
ªt
 = 
s
->
d©a
;

125 i‡(
s
->
hw_drivî
) {

126 
	`qemu_chr_io˘l
(
s
->
chr
, 
CHR_IOCTL_PP_READ_STATUS
, &s->
°©us
);

127 
ªt
 = 
s
->
°©us
;

129 
ªt
 = 
s
->
°©us
;

130 
s
->
úq_≥ndög
 = 0;

131 i‡((
s
->
°©us
 & 
PARA_STS_BUSY
Ë=0 && (s->
c⁄åﬁ
 & 
PARA_CTR_STROBE
) == 0) {

133 i‡(
s
->
°©us
 & 
PARA_STS_ACK
)

134 
s
->
°©us
 &~
PARA_STS_ACK
;

137 
s
->
°©us
 |
PARA_STS_ACK
;

138 
s
->
°©us
 |
PARA_STS_BUSY
;

141 
	`∑øŒñ_upd©e_úq
(
s
);

145 i‡(
s
->
hw_drivî
) {

146 
	`qemu_chr_io˘l
(
s
->
chr
, 
CHR_IOCTL_PP_READ_CONTROL
, &s->
c⁄åﬁ
);

148 
ªt
 = 
s
->
c⁄åﬁ
;

151 #ifde‡
DEBUG_PARALLEL


152 
	`¥ötf
("∑øŒñ:Ñódáddr=0x%02x vÆ=0x%02x\n", 
addr
, 
ªt
);

154  
ªt
;

155 
	}
}

158 
P¨ÆÀlSèã
 *
	$∑øŒñ_öô
(
ba£
, 
úq
, 
Ch¨DrivîSèã
 *
chr
)

160 
P¨ÆÀlSèã
 *
s
;

161 
uöt8_t
 
dummy
;

163 
s
 = 
	`qemu_mÆlocz
((
P¨ÆÀlSèã
));

164 i‡(!
s
)

165  
NULL
;

166 
s
->
chr
 = chr;

167 
s
->
hw_drivî
 = 0;

168 i‡(
	`qemu_chr_io˘l
(
chr
, 
CHR_IOCTL_PP_READ_STATUS
, &
dummy
) == 0)

169 
s
->
hw_drivî
 = 1;

171 
s
->
úq
 = irq;

172 
s
->
d©a
 = 0;

173 
s
->
°©us
 = 
PARA_STS_BUSY
;

174 
s
->
°©us
 |
PARA_STS_ACK
;

175 
s
->
°©us
 |
PARA_STS_ONLINE
;

176 
s
->
°©us
 |
PARA_STS_ERROR
;

177 
s
->
c⁄åﬁ
 = 
PARA_CTR_SELECT
;

178 
s
->
c⁄åﬁ
 |
PARA_CTR_INIT
;

180 
	`ªgi°î_i›‹t_wrôe
(
ba£
, 8, 1, 
∑øŒñ_i›‹t_wrôe
, 
s
);

181 
	`ªgi°î_i›‹t_ªad
(
ba£
, 8, 1, 
∑øŒñ_i›‹t_ªad
, 
s
);

182  
s
;

183 
	}
}

	@pass-through.c

25 
	~"vl.h
"

26 
	~"∑ss-through.h
"

27 
	~"pci/hódî.h
"

28 
	~"pci/pci.h
"

30 
FILE
 *
logfûe
;

32 
	$tokí_vÆue
(*
tokí
)

34 
tokí
 = 
	`°rchr
(token, 'x') + 1;

35  
	`°πﬁ
(
tokí
, 
NULL
, 16);

36 
	}
}

38 
	$√xt_bdf
(**
°r
, *
£g
, *
bus
, *
dev
, *
func
)

40 *
tokí
;

42 i‡–!(*
°r
Ë|| !
	`°rchr
(*str, ',') )

45 
tokí
 = *
°r
;

46 *
£g
 = 
	`tokí_vÆue
(
tokí
);

47 
tokí
 = 
	`°rchr
(token, ',') + 1;

48 *
bus
 = 
	`tokí_vÆue
(
tokí
);

49 
tokí
 = 
	`°rchr
(token, ',') + 1;

50 *
dev
 = 
	`tokí_vÆue
(
tokí
);

51 
tokí
 = 
	`°rchr
(token, ',') + 1;

52 *
func
 = 
	`tokí_vÆue
(
tokí
);

53 
tokí
 = 
	`°rchr
(token, ',');

54 *
°r
 = 
tokí
 ?Åokí + 1 : 
NULL
;

57 
	}
}

59 
uöt8_t
 
	$föd_ˇp_off£t
(
pci_dev
 *pci_dev, 
uöt8_t
 
ˇp
)

61 
id
;

62 
max_ˇp
 = 48;

63 
pos
 = 
PCI_CAPABILITY_LIST
;

64 
°©us
;

66 
°©us
 = 
	`pci_ªad_byã
(
pci_dev
, 
PCI_STATUS
);

67 i‡–(
°©us
 & 
PCI_STATUS_CAP_LIST
) == 0 )

70  
max_ˇp
-- )

72 
pos
 = 
	`pci_ªad_byã
(
pci_dev
,Öos);

73 i‡–
pos
 < 0x40 )

76 
pos
 &= ~3;

77 
id
 = 
	`pci_ªad_byã
(
pci_dev
, 
pos
 + 
PCI_CAP_LIST_ID
);

79 i‡–
id
 == 0xff )

81 i‡–
id
 =
ˇp
 )

82  
pos
;

84 
pos
 +
PCI_CAP_LIST_NEXT
;

87 
	}
}

89 
	$pdev_Êr
(
pci_dev
 *pci_dev)

91 
pos
;

92 
dev_ˇp
;

93 
dev_°©us
;

95 
pos
 = 
	`föd_ˇp_off£t
(
pci_dev
, 
PCI_CAP_ID_EXP
);

96 i‡–
pos
 )

98 
dev_ˇp
 = 
	`pci_ªad_l⁄g
(
pci_dev
, 
pos
 + 
PCI_EXP_DEVCAP
);

99 i‡–
dev_ˇp
 & 
PCI_EXP_DEVCAP_FLR
 )

101 
	`pci_wrôe_w‹d
(
pci_dev
, 
pos
 + 
PCI_EXP_DEVCTL
, 
PCI_EXP_DEVCTL_FLR
);

103 
dev_°©us
 = 
	`pci_ªad_l⁄g
(
pci_dev
, 
pos
 + 
PCI_EXP_DEVSTA
);

104 } 
dev_°©us
 & 
PCI_EXP_DEVSTA_TRPND
);

107 
	}
}

110 
	$±_iomem_m≠
(
PCIDevi˚
 *
d
, 
i
, 
uöt32_t
 
e_phys
, uöt32_à
e_size
,

111 
ty≥
)

113 
±_dev
 *
assig√d_devi˚
 = (±_dev *)
d
;

114 
uöt32_t
 
ﬁd_eba£
 = 
assig√d_devi˚
->
ba£s
[
i
].
e_physba£
;

115 
fú°_m≠
 = ( 
assig√d_devi˚
->
ba£s
[
i
].
e_size
 == 0 );

116 
ªt
 = 0;

118 
assig√d_devi˚
->
ba£s
[
i
].
e_physba£
 = 
e_phys
;

119 
assig√d_devi˚
->
ba£s
[
i
].
e_size
=É_size;

121 
	`PT_LOG
("e_phys=%08x maddr=%08xÅype=%dÜen=%08x index=%d\n",

122 
e_phys
, 
assig√d_devi˚
->
ba£s
[
i
].
ac˚ss
.
maddr
, 
ty≥
, 
e_size
, i);

124 i‡–
e_size
 == 0 )

127 i‡–!
fú°_m≠
 )

130 
ªt
 = 
	`xc_domaö_mem‹y_m≠pög
(
xc_h™dÀ
, 
domid
,

131 
ﬁd_eba£
 >> 
XC_PAGE_SHIFT
,

132 
assig√d_devi˚
->
ba£s
[
i
].
ac˚ss
.
maddr
 >> 
XC_PAGE_SHIFT
,

133 (
e_size
+
XC_PAGE_SIZE
-1Ë>> 
XC_PAGE_SHIFT
,

134 
DPCI_REMOVE_MAPPING
);

135 i‡–
ªt
 != 0 )

137 
	`PT_LOG
("Error:Ñemove old mapping failed!\n");

143 
ªt
 = 
	`xc_domaö_mem‹y_m≠pög
(
xc_h™dÀ
, 
domid
,

144 
assig√d_devi˚
->
ba£s
[
i
].
e_physba£
 >> 
XC_PAGE_SHIFT
,

145 
assig√d_devi˚
->
ba£s
[
i
].
ac˚ss
.
maddr
 >> 
XC_PAGE_SHIFT
,

146 (
e_size
+
XC_PAGE_SIZE
-1Ë>> 
XC_PAGE_SHIFT
,

147 
DPCI_ADD_MAPPING
);

148 i‡–
ªt
 != 0 )

149 
	`PT_LOG
("Error: createÇew mapping failed!\n");

151 
	}
}

154 
	$±_i›‹t_m≠
(
PCIDevi˚
 *
d
, 
i
,

155 
uöt32_t
 
e_phys
, uöt32_à
e_size
, 
ty≥
)

157 
±_dev
 *
assig√d_devi˚
 = (±_dev *)
d
;

158 
uöt32_t
 
ﬁd_eba£
 = 
assig√d_devi˚
->
ba£s
[
i
].
e_physba£
;

159 
fú°_m≠
 = ( 
assig√d_devi˚
->
ba£s
[
i
].
e_size
 == 0 );

160 
ªt
 = 0;

162 
assig√d_devi˚
->
ba£s
[
i
].
e_physba£
 = 
e_phys
;

163 
assig√d_devi˚
->
ba£s
[
i
].
e_size
=É_size;

165 
	`PT_LOG
("e_phys=%04xÖio_base=%04xÜen=%04x index=%d\n",

166 (
uöt16_t
)
e_phys
, (uöt16_t)
assig√d_devi˚
->
ba£s
[
i
].
ac˚ss
.
pio_ba£
,

167 (
uöt16_t
)
e_size
, 
i
);

169 i‡–
e_size
 == 0 )

172 i‡–!
fú°_m≠
 )

175 
ªt
 = 
	`xc_domaö_i›‹t_m≠pög
(
xc_h™dÀ
, 
domid
, 
ﬁd_eba£
,

176 
assig√d_devi˚
->
ba£s
[
i
].
ac˚ss
.
pio_ba£
, 
e_size
,

177 
DPCI_REMOVE_MAPPING
);

178 i‡–
ªt
 != 0 )

180 
	`PT_LOG
("Error:Ñemove old mapping failed!\n");

186 
ªt
 = 
	`xc_domaö_i›‹t_m≠pög
(
xc_h™dÀ
, 
domid
, 
e_phys
,

187 
assig√d_devi˚
->
ba£s
[
i
].
ac˚ss
.
pio_ba£
, 
e_size
,

188 
DPCI_ADD_MAPPING
);

189 i‡–
ªt
 != 0 )

190 
	`PT_LOG
("Error: createÇew mapping failed!\n");

192 
	}
}

194 
	$±_pci_wrôe_c⁄fig
(
PCIDevi˚
 *
d
, 
uöt32_t
 
addªss
, uöt32_à
vÆ
,

195 
Àn
)

197 
±_dev
 *
assig√d_devi˚
 = (±_dev *)
d
;

198 
pci_dev
 *pci_dev = 
assig√d_devi˚
->pci_dev;

200 #ifde‡
PT_DEBUG_PCI_CONFIG_ACCESS


201 
	`PT_LOG
("(%x.%x):áddress=%04x val=0x%08xÜen=%d\n",

202 (
d
->
dev‚
 >> 3Ë& 0x1F, (d->dev‚ & 0x7), 
addªss
, 
vÆ
, 
Àn
);

206  
addªss
 ) {

208 
	`pci_deÁu…_wrôe_c⁄fig
(
d
, 
addªss
, 
vÆ
, 
Àn
);

213 i‡(
addªss
 == 0x4) {

214 
Àn
){

216 
	`pci_wrôe_byã
(
pci_dev
, 
addªss
, 
vÆ
);

219 
	`pci_wrôe_w‹d
(
pci_dev
, 
addªss
, 
vÆ
);

222 
	`pci_wrôe_l⁄g
(
pci_dev
, 
addªss
, 
vÆ
);

227 i‡(
addªss
 == 0x4) {

229 
	`pci_deÁu…_wrôe_c⁄fig
(
d
, 
addªss
, 
vÆ
, 
Àn
);

231 
	}
}

233 
uöt32_t
 
	$±_pci_ªad_c⁄fig
(
PCIDevi˚
 *
d
, 
uöt32_t
 
addªss
, 
Àn
)

235 
±_dev
 *
assig√d_devi˚
 = (±_dev *)
d
;

236 
pci_dev
 *pci_dev = 
assig√d_devi˚
->pci_dev;

237 
uöt32_t
 
vÆ
 = 0xFF;

240  
addªss
 ) {

242 
vÆ
 = 
	`pci_deÁu…_ªad_c⁄fig
(
d
, 
addªss
, 
Àn
);

243 
exô
;

246  
Àn
 ) {

248 
vÆ
 = 
	`pci_ªad_byã
(
pci_dev
, 
addªss
);

251 
vÆ
 = 
	`pci_ªad_w‹d
(
pci_dev
, 
addªss
);

254 
vÆ
 = 
	`pci_ªad_l⁄g
(
pci_dev
, 
addªss
);

258 
exô
:

260 #ifde‡
PT_DEBUG_PCI_CONFIG_ACCESS


261 
	`PT_LOG
("(%x.%x):áddress=%04x val=0x%08xÜen=%d\n",

262 (
d
->
dev‚
 >> 3Ë& 0x1F, (d->dev‚ & 0x7), 
addªss
, 
vÆ
, 
Àn
);

265  
vÆ
;

266 
	}
}

268 
	$±_ªgi°î_ªgi⁄s
(
±_dev
 *
assig√d_devi˚
)

270 
i
 = 0;

271 
uöt32_t
 
b¨_d©a
 = 0;

272 
pci_dev
 *pci_dev = 
assig√d_devi˚
->pci_dev;

273 
PCIDevi˚
 *
d
 = &
assig√d_devi˚
->
dev
;

276  
i
=0; i < 
PCI_BAR_ENTRIES
; i++ )

278 i‡–
pci_dev
->
ba£_addr
[
i
] )

280 
assig√d_devi˚
->
ba£s
[
i
].
e_physba£
 = 
pci_dev
->
ba£_addr
[i];

281 
assig√d_devi˚
->
ba£s
[
i
].
ac˚ss
.
u
 = 
pci_dev
->
ba£_addr
[i];

284 
b¨_d©a
 = *((
uöt32_t
*)(
d
->
c⁄fig
 + 
PCI_BASE_ADDRESS_0
Ë+ 
i
);

285 i‡–
b¨_d©a
 & 
PCI_ADDRESS_SPACE_IO
 )

286 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
assig√d_devi˚
, 
i
,

287 (
uöt32_t
)
pci_dev
->
size
[
i
], 
PCI_ADDRESS_SPACE_IO
,

288 
±_i›‹t_m≠
);

289 i‡–
b¨_d©a
 & 
PCI_ADDRESS_SPACE_MEM_PREFETCH
 )

290 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
assig√d_devi˚
, 
i
,

291 (
uöt32_t
)
pci_dev
->
size
[
i
], 
PCI_ADDRESS_SPACE_MEM_PREFETCH
,

292 
±_iomem_m≠
);

294 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
assig√d_devi˚
, 
i
,

295 (
uöt32_t
)
pci_dev
->
size
[
i
], 
PCI_ADDRESS_SPACE_MEM
,

296 
±_iomem_m≠
);

298 
	`PT_LOG
("IOÑegionÑegistered (size=0x%08x base_addr=0x%08x)\n",

299 (
uöt32_t
)(
pci_dev
->
size
[
i
]),

300 (
uöt32_t
)(
pci_dev
->
ba£_addr
[
i
]));

305 i‡–
pci_dev
->
rom_ba£_addr
 &&Öci_dev->
rom_size
 )

307 
assig√d_devi˚
->
ba£s
[
PCI_ROM_SLOT
].
e_physba£
 =

308 
pci_dev
->
rom_ba£_addr
;

309 
assig√d_devi˚
->
ba£s
[
PCI_ROM_SLOT
].
ac˚ss
.
maddr
 =

310 
pci_dev
->
rom_ba£_addr
;

311 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
assig√d_devi˚
, 
PCI_ROM_SLOT
,

312 
pci_dev
->
rom_size
, 
PCI_ADDRESS_SPACE_MEM_PREFETCH
,

313 
±_iomem_m≠
);

315 
	`PT_LOG
("Expansion ROMÑegistered (size=0x%08x base_addr=0x%08x)\n",

316 (
uöt32_t
)(
pci_dev
->
rom_size
), (uöt32_t)’ci_dev->
rom_ba£_addr
));

320 
	}
}

322 
±_dev
 * 
	$ªgi°î_ªÆ_devi˚
(
PCIBus
 *
e_bus
,

323 c⁄° *
e_dev_«me
, 
e_dev‚
, 
uöt8_t
 
r_bus
, uöt8_à
r_dev
,

324 
uöt8_t
 
r_func
, 
uöt32_t
 
machöe_úq
, 
pci_ac˚ss
 *pci_access)

326 
rc
, 
i
;

327 
±_dev
 *
assig√d_devi˚
 = 
NULL
;

328 
pci_dev
 *pci_dev;

329 
uöt8_t
 
e_devi˚
, 
e_ötx
;

330 
pci_c⁄fig_cf8
 
machöe_bdf
;

332 
	`PT_LOG
("AssigningÑealÖhysical device %02x:%02x.%x ...\n",

333 
r_bus
, 
r_dev
, 
r_func
);

336 
pci_dev
 = 
pci_ac˚ss
->
devi˚s
;Öci_dev !
NULL
;

337 
pci_dev
 =Öci_dev->
√xt
)

339 i‡((
r_bus
 =
pci_dev
->
bus
Ë&& (
r_dev
 =pci_dev->
dev
)

340 && (
r_func
 =
pci_dev
->
func
))

343 i‡–
pci_dev
 =
NULL
 )

345 
	`PT_LOG
("Error: couldn'tÜocate device inÜibpci structures\n");

346  
NULL
;

350 
assig√d_devi˚
 = (
±_dev
 *Ë
	`pci_ªgi°î_devi˚
(
e_bus
, 
e_dev_«me
,

351 (
±_dev
), 
e_dev‚
,

352 
±_pci_ªad_c⁄fig
, 
±_pci_wrôe_c⁄fig
);

353 i‡–
assig√d_devi˚
 =
NULL
 )

355 
	`PT_LOG
("Error: couldn'tÑegisterÑeal device\n");

356  
NULL
;

359 
assig√d_devi˚
->
pci_dev
 =Öci_dev;

362 
	`pdev_Êr
(
pci_dev
);

365 
machöe_bdf
.
ªg
 = 0;

366 
machöe_bdf
.
bus
 = 
r_bus
;

367 
machöe_bdf
.
dev
 = 
r_dev
;

368 
machöe_bdf
.
func
 = 
r_func
;

369 
rc
 = 
	`xc_assign_devi˚
(
xc_h™dÀ
, 
domid
, 
machöe_bdf
.
vÆue
);

370 i‡–
rc
 < 0 )

371 
	`PT_LOG
("Eº‹: xc_assign_devi˚Éº‹ %d\n", 
rc
);

374  
i
 = 0; i < 
PCI_CONFIG_SIZE
; i++ )

375 
assig√d_devi˚
->
dev
.
c⁄fig
[
i
] = 
	`pci_ªad_byã
(
pci_dev
, i);

378 
	`±_ªgi°î_ªgi⁄s
(
assig√d_devi˚
);

381 
e_devi˚
 = (
assig√d_devi˚
->
dev
.
dev‚
 >> 3) & 0x1f;

382 
e_ötx
 = 
assig√d_devi˚
->
dev
.
c⁄fig
[0x3d]-1;

384 i‡–
PT_MACHINE_IRQ_AUTO
 =
machöe_úq
 )

385 
machöe_úq
 = 
pci_dev
->
úq
;

388 i‡–0 !
machöe_úq
 )

390 
rc
 = 
	`xc_domaö_böd_±_pci_úq
(
xc_h™dÀ
, 
domid
, 
machöe_úq
, 0,

391 
e_devi˚
, 
e_ötx
);

392 i‡–
rc
 < 0 )

395 
	`PT_LOG
("Eº‹: Bödög o‡öãºu± faûed!Ñc=%d\n", 
rc
);

400 
assig√d_devi˚
->
dev
.
c⁄fig
[0x05] |= 0x04;

401 
	`pci_wrôe_w‹d
(
pci_dev
, 0x04,

402 *(
uöt16_t
 *)(&
assig√d_devi˚
->
dev
.
c⁄fig
[0x04]));

405 
	`PT_LOG
("RealÖhysical device %02x:%02x.%xÑegistered successfuly!\n",

406 
r_bus
, 
r_dev
, 
r_func
);

408  
assig√d_devi˚
;

409 
	}
}

411 
	$±_öô
(
PCIBus
 *
e_bus
, *
dúe˘_pci
)

413 
£g
, 
b
, 
d
, 
f
;

414 
±_dev
 *pt_dev;

415 
pci_ac˚ss
 *pci_access;

418 
pci_ac˚ss
 = 
	`pci_Æloc
();

419 i‡–
pci_ac˚ss
 =
NULL
 )

421 
	`PT_LOG
("pci_access is NULL\n");

424 
	`pci_öô
(
pci_ac˚ss
);

425 
	`pci_sˇn_bus
(
pci_ac˚ss
);

428  
	`√xt_bdf
(&
dúe˘_pci
, &
£g
, &
b
, &
d
, &
f
) )

431 
±_dev
 = 
	`ªgi°î_ªÆ_devi˚
(
e_bus
, "DIRECT PCI", 
PT_VIRT_DEVFN_AUTO
,

432 
b
, 
d
, 
f
, 
PT_MACHINE_IRQ_AUTO
, 
pci_ac˚ss
);

433 i‡–
±_dev
 =
NULL
 )

435 
	`PT_LOG
("Eº‹: Regi°øti⁄ faûed (%02x:%02x.%x)\n", 
b
, 
d
, 
f
);

442 
	}
}

	@pass-through.h

18 #i‚de‡
__PASSTHROUGH_H__


19 
	#__PASSTHROUGH_H__


	)

21 
	~"vl.h
"

22 
	~"pci/hódî.h
"

23 
	~"pci/pci.h
"

26 
	#PT_LOGGING_ENABLED


	)

28 #ifde‡
PT_LOGGING_ENABLED


29 
	#PT_LOG
(
_f
, 
_a
...Ë
	`Ârötf
(
logfûe
, "%s: " _f, 
__func__
, ##_a)

	)

31 
	#PT_LOG
(
_f
, 
_a
...)

	)

37 
	#PT_MACHINE_IRQ_AUTO
 (0xFFFFFFFF)

	)

38 
	#PT_VIRT_DEVFN_AUTO
 (-1)

	)

41 
	#PCI_CONFIG_SIZE
 (256)

	)

42 
	#PCI_EXP_DEVCAP_FLR
 (1 << 28)

	)

43 
	#PCI_EXP_DEVCTL_FLR
 (1 << 15)

	)

44 
	#PCI_BAR_ENTRIES
 (6)

	)

47 #i‚de‡
PCI_CAP_ID_EXP


48 
	#PCI_CAP_ID_EXP
 0x10

	)

49 
	#PCI_EXP_DEVCAP
 4

	)

50 
	#PCI_EXP_DEVCTL
 8

	)

51 
	#PCI_EXP_DEVSTA
 10

	)

52 
	#PCI_EXP_DEVSTA_TRPND
 0x20

	)

55 
	s±_ªgi⁄
 {

57 
uöt32_t
 
	me_physba£
;

58 
uöt32_t
 
	me_size
;

60 
uöt32_t
 
	mmem‹y_ödex
;

63 
uöt32_t
 
	mmaddr
;

64 
uöt32_t
 
	mpio_ba£
;

65 
uöt32_t
 
	mu
;

66 } 
	mac˚ss
;

73 
	s±_dev
 {

74 
PCIDevi˚
 
	mdev
;

75 
pci_dev
 *
	mpci_dev
;

76 
±_ªgi⁄
 
	mba£s
[
PCI_NUM_REGIONS
];

80 
	spci_c⁄fig_cf8
 {

82 
	mvÆue
;

84 
	mª£rved1
:2;

85 
	mªg
:6;

86 
	mfunc
:3;

87 
	mdev
:5;

88 
	mbus
:8;

89 
	mª£rved2
:7;

90 
	míabÀ
:1;

95 
±_öô
(
PCIBus
 * 
e_bus
, * 
dúe˘_pci
);

	@pc.c

24 
	~"vl.h
"

29 
	#BIOS_FILENAME
 "bios.bö"

	)

30 
	#VGABIOS_FILENAME
 "vgabios.bö"

	)

31 
	#VGABIOS_CIRRUS_FILENAME
 "vgabios-cúrus.bö"

	)

32 
	#LINUX_BOOT_FILENAME
 "löux_boŸ.bö"

	)

34 
	#KERNEL_LOAD_ADDR
 0x00100000

	)

35 
	#INITRD_LOAD_ADDR
 0x00600000

	)

36 
	#KERNEL_PARAMS_ADDR
 0x00090000

	)

37 
	#KERNEL_CMDLINE_ADDR
 0x00099000

	)

39 
fd˘æ_t
 *
	gÊ›py_c⁄åﬁÀr
;

40 
RTCSèã
 *
	gπc_°©e
;

41 #i‚de‡
CONFIG_DM


42 
PITSèã
 *
	gpô
;

44 #i‚de‡
CONFIG_DM


45 
IOAPICSèã
 *
	giﬂpic
;

47 
PCIDevi˚
 *
	gi440fx_°©e
;

49 
	$i›‹t80_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
d©a
)

51 
	}
}

55 
	$˝u_£t_„º
(
CPUX86Sèã
 *
s
)

57 
	`pic_£t_úq
(13, 1);

58 
	}
}

60 
	$i›‹tF0_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
d©a
)

62 
	`pic_£t_úq
(13, 0);

63 
	}
}

66 
uöt64_t
 
	$˝u_gë_tsc
(
CPUX86Sèã
 *
ív
)

71 #i‡
USE_KQEMU


72 i‡(
ív
->
kqemu_íabÀd
) {

73  
	`˝u_gë_ªÆ_ticks
();

77  
	`˝u_gë_ticks
();

79 
	}
}

81 #i‚de‡
CONFIG_DM


83 
	$˝u_smm_upd©e
(
CPUSèã
 *
ív
)

85 i‡(
i440fx_°©e
 && 
ív
 =
fú°_˝u
)

86 
	`i440fx_£t_smm
(
i440fx_°©e
, (
ív
->
hÊags
 >> 
HF_SMM_SHIFT
) & 1);

87 
	}
}

91 
	$˝u_gë_pic_öãºu±
(
CPUSèã
 *
ív
)

93 
öäo
;

95 
öäo
 = 
	`≠ic_gë_öãºu±
(
ív
);

96 i‡(
öäo
 >= 0) {

99 
	`pic_upd©e_úq
(
iß_pic
);

100  
öäo
;

103 
öäo
 = 
	`pic_ªad_úq
(
iß_pic
);

104  
öäo
;

105 
	}
}

108 
	$pic_úq_ªque°
(*
›aque
, 
Àvñ
)

110 
CPUSèã
 *
ív
 = 
›aque
;

111 i‡(
Àvñ
)

112 
	`˝u_öãºu±
(
ív
, 
CPU_INTERRUPT_HARD
);

114 
	`˝u_ª£t_öãºu±
(
ív
, 
CPU_INTERRUPT_HARD
);

115 
	}
}

119 
	#REG_EQUIPMENT_BYTE
 0x14

	)

121 
	$cmos_gë_fd_drive_ty≥
(
fd0
)

123 
vÆ
;

125 
fd0
) {

128 
vÆ
 = 4;

132 
vÆ
 = 5;

136 
vÆ
 = 2;

139 
vÆ
 = 0;

142  
vÆ
;

143 
	}
}

145 
	$cmos_öô_hd
(
ty≥_ofs
, 
öfo_ofs
, 
BlockDrivîSèã
 *
hd
)

147 
RTCSèã
 *
s
 = 
πc_°©e
;

148 
cylödîs
, 
hóds
, 
£˘‹s
;

149 
	`bdrv_gë_geomëry_höt
(
hd
, &
cylödîs
, &
hóds
, &
£˘‹s
);

150 
	`πc_£t_mem‹y
(
s
, 
ty≥_ofs
, 47);

151 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
, 
cylödîs
);

152 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
 + 1, 
cylödîs
 >> 8);

153 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
 + 2, 
hóds
);

154 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
 + 3, 0xff);

155 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
 + 4, 0xff);

156 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
 + 5, 0xc0 | ((
hóds
 > 8) << 3));

157 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
 + 6, 
cylödîs
);

158 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
 + 7, 
cylödîs
 >> 8);

159 
	`πc_£t_mem‹y
(
s
, 
öfo_ofs
 + 8, 
£˘‹s
);

160 
	}
}

162 
	$gë_bios_disk
(*
boŸ_devi˚
, 
ödex
) {

164 i‡(
ödex
 < 
	`°æí
(
boŸ_devi˚
)) {

165 
boŸ_devi˚
[
ödex
]) {

177 
	}
}

180 
	$cmos_öô
(
uöt64_t
 
øm_size
, *
boŸ_devi˚
, 
BlockDrivîSèã
 **
hd_èbÀ
)

182 
RTCSèã
 *
s
 = 
πc_°©e
;

183 
vÆ
;

184 
fd0
, 
fd1
, 
nb
;

185 
i
;

190 
vÆ
 = 640;

191 
	`πc_£t_mem‹y
(
s
, 0x15, 
vÆ
);

192 
	`πc_£t_mem‹y
(
s
, 0x16, 
vÆ
 >> 8);

194 
vÆ
 = (
øm_size
 / 1024) - 1024;

195 i‡(
vÆ
 > 65535)

196 
vÆ
 = 65535;

197 
	`πc_£t_mem‹y
(
s
, 0x17, 
vÆ
);

198 
	`πc_£t_mem‹y
(
s
, 0x18, 
vÆ
 >> 8);

199 
	`πc_£t_mem‹y
(
s
, 0x30, 
vÆ
);

200 
	`πc_£t_mem‹y
(
s
, 0x31, 
vÆ
 >> 8);

202 i‡(
øm_size
 > (16 * 1024 * 1024))

203 
vÆ
 = (
øm_size
 / 65536) - ((16 * 1024 * 1024) / 65536);

205 
vÆ
 = 0;

206 i‡(
vÆ
 > 65535)

207 
vÆ
 = 65535;

208 
	`πc_£t_mem‹y
(
s
, 0x34, 
vÆ
);

209 
	`πc_£t_mem‹y
(
s
, 0x35, 
vÆ
 >> 8);

211 i‡(
boŸ_devi˚
 =
NULL
) {

213 
boŸ_devi˚
 = "cda";

215 
	`πc_£t_mem‹y
(
s
, 0x3d, 
	`gë_bios_disk
(
boŸ_devi˚
, 0) |

216 (
	`gë_bios_disk
(
boŸ_devi˚
, 1) << 4));

217 
	`πc_£t_mem‹y
(
s
, 0x38, (
	`gë_bios_disk
(
boŸ_devi˚
, 2) << 4) |

218 (!
fd_boŸchk
 ? 0x01 : 0x00));

222 
fd0
 = 
	`fd˘æ_gë_drive_ty≥
(
Ê›py_c⁄åﬁÀr
, 0);

223 
fd1
 = 
	`fd˘æ_gë_drive_ty≥
(
Ê›py_c⁄åﬁÀr
, 1);

225 
vÆ
 = (
	`cmos_gë_fd_drive_ty≥
(
fd0
Ë<< 4Ë| cmos_gë_fd_drive_ty≥(
fd1
);

226 
	`πc_£t_mem‹y
(
s
, 0x10, 
vÆ
);

228 
vÆ
 = 0;

229 
nb
 = 0;

230 i‡(
fd0
 < 3)

231 
nb
++;

232 i‡(
fd1
 < 3)

233 
nb
++;

234 
nb
) {

238 
vÆ
 |= 0x01;

241 
vÆ
 |= 0x41;

244 
vÆ
 |= 0x02;

245 
vÆ
 |= 0x04;

246 
	`πc_£t_mem‹y
(
s
, 
REG_EQUIPMENT_BYTE
, 
vÆ
);

250 
	`πc_£t_mem‹y
(
s
, 0x12, (
hd_èbÀ
[0] ? 0xf0 : 0) | (hd_table[1] ? 0x0f : 0));

251 i‡(
hd_èbÀ
[0])

252 
	`cmos_öô_hd
(0x19, 0x1b, 
hd_èbÀ
[0]);

253 i‡(
hd_èbÀ
[1])

254 
	`cmos_öô_hd
(0x1a, 0x24, 
hd_èbÀ
[1]);

256 
vÆ
 = 0;

257 
i
 = 0; i < 4; i++) {

258 i‡(
hd_èbÀ
[
i
]) {

259 
cylödîs
, 
hóds
, 
£˘‹s
, 
å™¶©i⁄
;

264 
å™¶©i⁄
 = 
	`bdrv_gë_å™¶©i⁄_höt
(
hd_èbÀ
[
i
]);

265 i‡(
å™¶©i⁄
 =
BIOS_ATA_TRANSLATION_AUTO
) {

266 
	`bdrv_gë_geomëry_höt
(
hd_èbÀ
[
i
], &
cylödîs
, &
hóds
, &
£˘‹s
);

267 i‡(
cylödîs
 <1024 && 
hóds
 <16 && 
£˘‹s
 <= 63) {

269 
å™¶©i⁄
 = 0;

272 
å™¶©i⁄
 = 1;

275 
å™¶©i⁄
--;

277 
vÆ
 |
å™¶©i⁄
 << (
i
 * 2);

280 
	`πc_£t_mem‹y
(
s
, 0x39, 
vÆ
);

281 
	}
}

283 
	$i›‹t_£t_a20
(
íabÀ
)

286 
	`˝u_x86_£t_a20
(
fú°_˝u
, 
íabÀ
);

287 
	}
}

289 
	$i›‹t_gë_a20
()

291  ((
fú°_˝u
->
a20_mask
 >> 20) & 1);

292 
	}
}

294 
	$i›‹t92_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

296 
	`i›‹t_£t_a20
((
vÆ
 >> 1) & 1);

298 
	}
}

300 
uöt32_t
 
	$i›‹t92_ªad
(*
›aque
, 
uöt32_t
 
addr
)

302  
	`i›‹t_gë_a20
() << 1;

303 
	}
}

308 
	$bochs_bios_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

310 c⁄° 
shutdown_°r
[8] = "Shutdown";

311 
shutdown_ödex
 = 0;

313 
addr
) {

317 
	`Ârötf
(
°dîr
, "BIOSÖ™i¯©Ñombios.c,Üöê%d\n", 
vÆ
);

318 
	`exô
(1);

321 #ifde‡
DEBUG_BIOS


322 
	`Ârötf
(
°dîr
, "%c", 
vÆ
);

327 i‡(
vÆ
 =
shutdown_°r
[
shutdown_ödex
]) {

328 
shutdown_ödex
++;

329 i‡(
shutdown_ödex
 == 8) {

330 
shutdown_ödex
 = 0;

331 
	`qemu_sy°em_shutdown_ªque°
();

334 
shutdown_ödex
 = 0;

341 
	`Ârötf
(
°dîr
, "VGA BIOSÖ™ic,Üöê%d\n", 
vÆ
);

342 
	`exô
(1);

345 #ifde‡
DEBUG_BIOS


346 
	`Ârötf
(
°dîr
, "%c", 
vÆ
);

350 
	}
}

352 
	$bochs_bios_öô
()

354 
	`ªgi°î_i›‹t_wrôe
(0x400, 1, 2, 
bochs_bios_wrôe
, 
NULL
);

355 
	`ªgi°î_i›‹t_wrôe
(0x401, 1, 2, 
bochs_bios_wrôe
, 
NULL
);

356 
	`ªgi°î_i›‹t_wrôe
(0x402, 1, 1, 
bochs_bios_wrôe
, 
NULL
);

357 
	`ªgi°î_i›‹t_wrôe
(0x403, 1, 1, 
bochs_bios_wrôe
, 
NULL
);

358 
	`ªgi°î_i›‹t_wrôe
(0x8900, 1, 1, 
bochs_bios_wrôe
, 
NULL
);

360 
	`ªgi°î_i›‹t_wrôe
(0x501, 1, 2, 
bochs_bios_wrôe
, 
NULL
);

361 
	`ªgi°î_i›‹t_wrôe
(0x502, 1, 2, 
bochs_bios_wrôe
, 
NULL
);

362 
	`ªgi°î_i›‹t_wrôe
(0x500, 1, 1, 
bochs_bios_wrôe
, 
NULL
);

363 
	`ªgi°î_i›‹t_wrôe
(0x503, 1, 1, 
bochs_bios_wrôe
, 
NULL
);

364 
	}
}

367 
	$lﬂd_kî√l
(c⁄° *
fûíame
, 
uöt8_t
 *
addr
,

368 
uöt8_t
 *
ªÆ_addr
)

370 
fd
, 
size
;

371 
£tup_£˘s
;

373 
fd
 = 
	`›í
(
fûíame
, 
O_RDONLY
 | 
O_BINARY
);

374 i‡(
fd
 < 0)

378 i‡(
	`ªad
(
fd
, 
ªÆ_addr
, 512) != 512)

379 
Áû
;

380 
£tup_£˘s
 = 
ªÆ_addr
[0x1F1];

381 i‡(!
£tup_£˘s
)

382 
£tup_£˘s
 = 4;

383 i‡(
	`ªad
(
fd
, 
ªÆ_addr
 + 512, 
£tup_£˘s
 * 512) !=

384 
£tup_£˘s
 * 512)

385 
Áû
;

388 
size
 = 
	`ªad
(
fd
, 
addr
, 16 * 1024 * 1024);

389 i‡(
size
 < 0)

390 
Áû
;

391 
	`˛o£
(
fd
);

392  
size
;

393 
Áû
:

394 
	`˛o£
(
fd
);

396 
	}
}

398 
	$maö_˝u_ª£t
(*
›aque
)

400 
CPUSèã
 *
ív
 = 
›aque
;

401 
	`˝u_ª£t
(
ív
);

402 
	}
}

404 c⁄° 
	gide_ioba£
[2] = { 0x1f0, 0x170 };

405 c⁄° 
	gide_ioba£2
[2] = { 0x3f6, 0x376 };

406 c⁄° 
	gide_úq
[2] = { 14, 15 };

408 
	#NE2000_NB_MAX
 6

	)

410 
	g√2000_io
[
NE2000_NB_MAX
] = { 0x300, 0x320, 0x340, 0x360, 0x280, 0x380 };

411 
	g√2000_úq
[
NE2000_NB_MAX
] = { 9, 10, 11, 3, 4, 5 };

413 
	g£rül_io
[
MAX_SERIAL_PORTS
] = { 0x3f8, 0x2f8, 0x3e8, 0x2e8 };

414 
	g£rül_úq
[
MAX_SERIAL_PORTS
] = { 4, 3, 4, 3 };

416 
	g∑øŒñ_io
[
MAX_PARALLEL_PORTS
] = { 0x378, 0x278, 0x3bc };

417 
	g∑øŒñ_úq
[
MAX_PARALLEL_PORTS
] = { 7, 7, 7 };

419 #ifde‡
HAS_AUDIO


420 
	$audio_öô
 (
PCIBus
 *
pci_bus
)

422 
soundhw
 *
c
;

423 
audio_íabÀd
 = 0;

425 
c
 = 
soundhw
; !
audio_íabÀd
 && c->
«me
; ++c) {

426 
audio_íabÀd
 = 
c
->
íabÀd
;

429 i‡(
audio_íabÀd
) {

430 
AudioSèã
 *
s
;

432 
s
 = 
	`AUD_öô
 ();

433 i‡(
s
) {

434 
c
 = 
soundhw
; c->
«me
; ++c) {

435 i‡(
c
->
íabÀd
) {

436 i‡(
c
->
iß
) {

437 
c
->
öô
.
	`öô_iß
 (
s
);

440 i‡(
pci_bus
) {

441 
c
->
öô
.
	`öô_pci
 (
pci_bus
, 
s
);

448 
	}
}

451 
	$pc_öô_√2k_iß
(
NICInfo
 *
nd
)

453 
nb_√2k
 = 0;

455 i‡(
nb_√2k
 =
NE2000_NB_MAX
)

457 
	`iß_√2000_öô
(
√2000_io
[
nb_√2k
], 
√2000_úq
[nb_√2k], 
nd
);

458 
nb_√2k
++;

459 
	}
}

461 
	#NOBIOS
 1

	)

464 
	$pc_öô1
(
uöt64_t
 
øm_size
, 
vga_øm_size
, *
boŸ_devi˚
,

465 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

466 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

467 c⁄° *
öôrd_fûíame
,

468 
pci_íabÀd
, c⁄° *
dúe˘_pci
)

470 #i‚de‡
NOBIOS


471 
buf
[1024];

472 
ªt
, 
öôrd_size
;

474 
löux_boŸ
, 
i
;

475 #i‚de‡
NOBIOS


476 
bios_off£t
, 
vga_bios_off£t
, 
›ti⁄_rom_off£t
;

477 
bios_size
, 
iß_bios_size
;

479 
PCIBus
 *
pci_bus
;

480 
piix3_dev‚
 = -1;

481 
CPUSèã
 *
ív
;

482 
NICInfo
 *
nd
;

483 
rc
;

485 
löux_boŸ
 = (
kî√l_fûíame
 !
NULL
);

488 
i
 = 0; i < 
smp_˝us
; i++) {

489 
ív
 = 
	`˝u_öô
();

490 #i‚de‡
CONFIG_DM


491 i‡(
i
 != 0)

492 
ív
->
hÊags
 |
HF_HALTED_MASK
;

493 i‡(
smp_˝us
 > 1) {

495 
ív
->
˝uid_„©uªs
 |
CPUID_APIC
;

498 
	`ªgi°î_ßvevm
("˝u", 
i
, 4, 
˝u_ßve
, 
˝u_lﬂd
, 
ív
);

499 
	`qemu_ªgi°î_ª£t
(
maö_˝u_ª£t
, 
ív
);

500 #i‚de‡
CONFIG_DM


501 i‡(
pci_íabÀd
) {

502 
	`≠ic_öô
(
ív
);

508 #i‚de‡
CONFIG_DM


509 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 0);

512 #i‚de‡
NOBIOS


514 
bios_off£t
 = 
øm_size
 + 
vga_øm_size
;

515 
vga_bios_off£t
 = 
bios_off£t
 + 256 * 1024;

517 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
BIOS_FILENAME
);

518 
bios_size
 = 
	`gë_image_size
(
buf
);

519 i‡(
bios_size
 <= 0 ||

520 (
bios_size
 % 65536) != 0 ||

521 
bios_size
 > (256 * 1024)) {

522 
bios_îr‹
;

524 
ªt
 = 
	`lﬂd_image
(
buf
, 
phys_øm_ba£
 + 
bios_off£t
);

525 i‡(
ªt
 !
bios_size
) {

526 
bios_îr‹
:

527 
	`Ârötf
(
°dîr
, "qemu: couldÇŸÜﬂd PC bio†'%s'\n", 
buf
);

528 
	`exô
(1);

532 i‡(
cúrus_vga_íabÀd
) {

533 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
VGABIOS_CIRRUS_FILENAME
);

535 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
VGABIOS_FILENAME
);

537 
ªt
 = 
	`lﬂd_image
(
buf
, 
phys_øm_ba£
 + 
vga_bios_off£t
);

541 #i‚de‡
CONFIG_DM


542 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xc0000, 0x10000,

543 
vga_bios_off£t
 | 
IO_MEM_ROM
);

546 #i‚de‡
NOBIOS


548 
iß_bios_size
 = 
bios_size
;

549 i‡(
iß_bios_size
 > (128 * 1024))

550 
iß_bios_size
 = 128 * 1024;

551 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xd0000, (192 * 1024Ë- 
iß_bios_size
,

552 
IO_MEM_UNASSIGNED
);

553 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x100000 - 
iß_bios_size
,

554 
iß_bios_size
,

555 (
bios_off£t
 + 
bios_size
 - 
iß_bios_size
Ë| 
IO_MEM_ROM
);

557 
›ti⁄_rom_off£t
 = 0;

558 
i
 = 0; i < 
nb_›ti⁄_roms
; i++) {

559 
off£t
 = 
bios_off£t
 + 
bios_size
 + 
›ti⁄_rom_off£t
;

560 
size
;

562 
size
 = 
	`lﬂd_image
(
›ti⁄_rom
[
i
], 
phys_øm_ba£
 + 
off£t
);

563 i‡((
size
 + 
›ti⁄_rom_off£t
) > 0x10000) {

564 
	`Ârötf
(
°dîr
, "Too many option ROMS\n");

565 
	`exô
(1);

567 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xd0000 + 
›ti⁄_rom_off£t
,

568 
size
, 
off£t
 | 
IO_MEM_ROM
);

569 
›ti⁄_rom_off£t
 +
size
 + 2047;

570 
›ti⁄_rom_off£t
 -= (option_rom_offset % 2048);

574 
	`˝u_ªgi°î_physiˇl_mem‹y
((
uöt32_t
)(-
bios_size
),

575 
bios_size
, 
bios_off£t
 | 
IO_MEM_ROM
);

578 
	`bochs_bios_öô
();

580 #i‚de‡
CONFIG_DM


581 i‡(
löux_boŸ
) {

582 
uöt8_t
 
boŸ£˘
[512];

583 
uöt8_t
 
ﬁd_boŸ£˘
[512];

585 i‡(
bs_èbÀ
[0] =
NULL
) {

586 
	`Ârötf
(
°dîr
, "A disk image must be given for 'hda' when bootingá Linux kernel\n");

587 
	`exô
(1);

589 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
LINUX_BOOT_FILENAME
);

590 
ªt
 = 
	`lﬂd_image
(
buf
, 
boŸ£˘
);

591 i‡(
ªt
 !(
boŸ£˘
)) {

592 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoadÜinux boot sector '%s'\n",

593 
buf
);

594 
	`exô
(1);

597 i‡(
	`bdrv_ªad
(
bs_èbÀ
[0], 0, 
ﬁd_boŸ£˘
, 1) >= 0) {

599 
	`mem˝y
(
boŸ£˘
 + 0x1be, 
ﬁd_boŸ£˘
 + 0x1be, 0x40);

602 
	`bdrv_£t_boŸ_£˘‹
(
bs_èbÀ
[0], 
boŸ£˘
, (bootsect));

605 
ªt
 = 
	`lﬂd_kî√l
(
kî√l_fûíame
,

606 
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
,

607 
phys_øm_ba£
 + 
KERNEL_PARAMS_ADDR
);

608 i‡(
ªt
 < 0) {

609 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad kernel '%s'\n",

610 
kî√l_fûíame
);

611 
	`exô
(1);

615 
öôrd_size
 = 0;

616 i‡(
öôrd_fûíame
) {

617 
öôrd_size
 = 
	`lﬂd_image
(
öôrd_fûíame
, 
phys_øm_ba£
 + 
INITRD_LOAD_ADDR
);

618 i‡(
öôrd_size
 < 0) {

619 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad initialÑam disk '%s'\n",

620 
öôrd_fûíame
);

621 
	`exô
(1);

624 i‡(
öôrd_size
 > 0) {

625 
	`°l_øw
(
phys_øm_ba£
 + 
KERNEL_PARAMS_ADDR
 + 0x218, 
INITRD_LOAD_ADDR
);

626 
	`°l_øw
(
phys_øm_ba£
 + 
KERNEL_PARAMS_ADDR
 + 0x21c, 
öôrd_size
);

628 
	`p°r˝y
(
phys_øm_ba£
 + 
KERNEL_CMDLINE_ADDR
, 4096,

629 
kî√l_cmdlöe
);

630 
	`°w_øw
(
phys_øm_ba£
 + 
KERNEL_PARAMS_ADDR
 + 0x20, 0xA33F);

631 
	`°w_øw
(
phys_øm_ba£
 + 
KERNEL_PARAMS_ADDR
 + 0x22,

632 
KERNEL_CMDLINE_ADDR
 - 
KERNEL_PARAMS_ADDR
);

634 
	`°w_øw
(
phys_øm_ba£
 + 
KERNEL_PARAMS_ADDR
 + 0x210, 0x01);

638 i‡(
pci_íabÀd
) {

639 
pci_bus
 = 
	`i440fx_öô
(&
i440fx_°©e
);

640 
piix3_dev‚
 = 
	`piix3_öô
(
pci_bus
, -1);

642 
pci_bus
 = 
NULL
;

646 
	`ªgi°î_i›‹t_wrôe
(0x80, 1, 1, 
i›‹t80_wrôe
, 
NULL
);

648 
	`ªgi°î_i›‹t_wrôe
(0xf0, 1, 1, 
i›‹tF0_wrôe
, 
NULL
);

650 i‡(
cúrus_vga_íabÀd
) {

651 i‡(
pci_íabÀd
) {

652 
	`pci_cúrus_vga_öô
(
pci_bus
,

653 
ds
, 
NULL
, 
øm_size
,

654 
vga_øm_size
);

656 
	`iß_cúrus_vga_öô
(
ds
, 
NULL
, 
øm_size
,

657 
vga_øm_size
);

660 i‡(
pci_íabÀd
) {

661 
	`pci_vga_öô
(
pci_bus
, 
ds
, 
NULL
, 
øm_size
,

662 
vga_øm_size
, 0, 0);

664 
	`iß_vga_öô
(
ds
, 
NULL
, 
øm_size
,

665 
vga_øm_size
);

669 #ifde‡
CONFIG_PASSTHROUGH


671 i‡–
pci_íabÀd
 && 
dúe˘_pci
 )

673 
rc
 = 
	`±_öô
(
pci_bus
, 
dúe˘_pci
);

674 i‡–
rc
 < 0 )

676 
	`Ârötf
(
logfûe
, "Error: Initialization failed forÖass-through devices\n");

677 
	`exô
(1);

682 
πc_°©e
 = 
	`πc_öô
(0x70, 8);

684 
	`ªgi°î_i›‹t_ªad
(0x92, 1, 1, 
i›‹t92_ªad
, 
NULL
);

685 
	`ªgi°î_i›‹t_wrôe
(0x92, 1, 1, 
i›‹t92_wrôe
, 
NULL
);

687 #i‚de‡
CONFIG_DM


688 i‡(
pci_íabÀd
) {

689 
iﬂpic
 = 
	`iﬂpic_öô
();

692 
iß_pic
 = 
	`pic_öô
(
pic_úq_ªque°
, 
fú°_˝u
);

693 #i‚de‡
CONFIG_DM


694 
pô
 = 
	`pô_öô
(0x40, 0);

695 
	`pc•k_öô
(
pô
);

697 #i‚de‡
CONFIG_DM


698 i‡(
pci_íabÀd
) {

699 
	`pic_£t_Æt_úq_func
(
iß_pic
, 
iﬂpic_£t_úq
, 
iﬂpic
);

703 i‡(
pci_íabÀd
)

704 
	`pci_xí_∂©f‹m_öô
(
pci_bus
);

706 
i
 = 0; i < 
MAX_SERIAL_PORTS
; i++) {

707 i‡(
£rül_hds
[
i
]) {

708 
	`£rül_öô
(&
pic_£t_úq_√w
, 
iß_pic
,

709 
£rül_io
[
i
], 
£rül_úq
[i], 
£rül_hds
[i]);

713 
i
 = 0; i < 
MAX_PARALLEL_PORTS
; i++) {

714 i‡(
∑øŒñ_hds
[
i
]) {

715 
	`∑øŒñ_öô
(
∑øŒñ_io
[
i
], 
∑øŒñ_úq
[i], 
∑øŒñ_hds
[i]);

719 
i
 = 0; i < 
nb_nics
; i++) {

720 
nd
 = &
nd_èbÀ
[
i
];

721 i‡(!
nd
->
modñ
) {

722 i‡(
pci_íabÀd
) {

723 
nd
->
modñ
 = "ne2k_pci";

725 
nd
->
modñ
 = "ne2k_isa";

728 i‡(
	`°rcmp
(
nd
->
modñ
, "ne2k_isa") == 0) {

729 
	`pc_öô_√2k_iß
(
nd
);

730 } i‡(
pci_íabÀd
) {

731 
	`pci_nic_öô
(
pci_bus
, 
nd
, -1);

733 
	`Ârötf
(
°dîr
, "qemu: Unsuµ‹ãd NIC: %s\n", 
nd
->
modñ
);

734 
	`exô
(1);

738 i‡(
pci_íabÀd
) {

739 
	`pci_piix3_ide_öô
(
pci_bus
, 
bs_èbÀ
, 
piix3_dev‚
 + 1);

741 
i
 = 0; i < 2; i++) {

742 
	`iß_ide_öô
(
ide_ioba£
[
i
], 
ide_ioba£2
[i], 
ide_úq
[i],

743 
bs_èbÀ
[2 * 
i
], bs_table[2 * i + 1]);

747 i‡(
	`has_çm_devi˚
())

748 
	`çm_tis_öô
(&
pic_£t_úq_√w
, 
iß_pic
, 11);

750 
	`kbd_öô
();

751 
	`DMA_öô
(0);

752 #ifde‡
HAS_AUDIO


753 
	`audio_öô
(
pci_íabÀd
 ? 
pci_bus
 : 
NULL
);

756 
Ê›py_c⁄åﬁÀr
 = 
	`fd˘æ_öô
(6, 2, 0, 0x3f0, 
fd_èbÀ
);

758 
	`cmos_öô
(
øm_size
, 
boŸ_devi˚
, 
bs_èbÀ
);

761 i‡(
pci_íabÀd
 && 
a˝i_íabÀd
)

762 
	`pci_piix4_a˝i_öô
(
pci_bus
, 
piix3_dev‚
 + 2);

764 i‡(
pci_íabÀd
 && 
usb_íabÀd
) {

765 
	`usb_uhci_öô
(
pci_bus
, 
piix3_dev‚
 + (
a˝i_íabÀd
 ? 3 : 2));

768 #i‚de‡
CONFIG_DM


769 i‡(
pci_íabÀd
 && 
a˝i_íabÀd
) {

770 
uöt8_t
 *
ì¥om_buf
 = 
	`qemu_mÆlocz
(8 * 256);

771 
	`piix4_pm_öô
(
pci_bus
, 
piix3_dev‚
 + 3);

772 
i
 = 0; i < 8; i++) {

773 
SMBusDevi˚
 *
ì¥om
 = 
	`smbus_ì¥om_devi˚_öô
(0x50 + 
i
,

774 
ì¥om_buf
 + (
i
 * 256));

775 
	`piix4_smbus_ªgi°î_devi˚
(
ì¥om
, 0x50 + 
i
);

779 i‡(
i440fx_°©e
) {

780 
	`i440fx_öô_mem‹y_m≠pögs
(
i440fx_°©e
);

785 i‡(
pci_íabÀd
) {

786 *
scsi
;

787 
BlockDrivîSèã
 *
bdrv
;

789 
scsi
 = 
	`lsi_scsi_öô
(
pci_bus
, -1);

790 
bdrv
 = 
	`bdrv_√w
("scsidisk");

791 
	`bdrv_›í
(
bdrv
, "scsi_disk.img", 0);

792 
	`lsi_scsi_©èch
(
scsi
, 
bdrv
, -1);

793 
bdrv
 = 
	`bdrv_√w
("scsicd");

794 
	`bdrv_›í
(
bdrv
, "scsi_cd.iso", 0);

795 
	`bdrv_£t_ty≥_höt
(
bdrv
, 
BDRV_TYPE_CDROM
);

796 
	`lsi_scsi_©èch
(
scsi
, 
bdrv
, -1);

800 i‡(
pci_íabÀd
) {

801 *
scsi
 = 
NULL
;

802 
i
 = 0; i < 
MAX_SCSI_DISKS
 ; i++) {

803 i‡(!
bs_èbÀ
[
i
 + 
MAX_DISKS
])

805 i‡(!
scsi
)

806 
scsi
 = 
	`lsi_scsi_öô
(
pci_bus
, -1);

807 
	`lsi_scsi_©èch
(
scsi
, 
bs_èbÀ
[
i
 + 
MAX_DISKS
], -1);

811 
	}
}

813 
	$pc_öô_pci
(
uöt64_t
 
øm_size
, 
vga_øm_size
, *
boŸ_devi˚
,

814 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
,

815 
¢≠shŸ
,

816 c⁄° *
kî√l_fûíame
,

817 c⁄° *
kî√l_cmdlöe
,

818 c⁄° *
öôrd_fûíame
,

819 c⁄° *
dúe˘_pci
)

821 
	`pc_öô1
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

822 
ds
, 
fd_fûíame
, 
¢≠shŸ
,

823 
kî√l_fûíame
, 
kî√l_cmdlöe
,

824 
öôrd_fûíame
, 1,

825 
dúe˘_pci
);

826 
	}
}

828 
	$pc_öô_iß
(
uöt64_t
 
øm_size
, 
vga_øm_size
, *
boŸ_devi˚
,

829 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
,

830 
¢≠shŸ
,

831 c⁄° *
kî√l_fûíame
,

832 c⁄° *
kî√l_cmdlöe
,

833 c⁄° *
öôrd_fûíame
,

834 c⁄° *
unu£d
)

836 
	`pc_öô1
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

837 
ds
, 
fd_fûíame
, 
¢≠shŸ
,

838 
kî√l_fûíame
, 
kî√l_cmdlöe
,

839 
öôrd_fûíame
, 0, 
NULL
);

840 
	}
}

842 
QEMUMachöe
 
	gpc_machöe
 = {

845 
pc_öô_pci
,

848 
QEMUMachöe
 
	gißpc_machöe
 = {

851 
pc_öô_iß
,

	@pci.c

24 
	~"vl.h
"

28 
	sPCIBus
 {

29 
	mbus_num
;

30 
	mdev‚_mö
;

31 
pci_£t_úq_‚
 
	m£t_úq
;

32 
pci_m≠_úq_‚
 
	mm≠_úq
;

33 
uöt32_t
 
	mc⁄fig_ªg
;

35 
SëIRQFunc
 *
	mlow_£t_úq
;

36 *
	múq_›aque
;

37 
PCIDevi˚
 *
	mdevi˚s
[256];

38 
PCIDevi˚
 *
	m∑ª¡_dev
;

39 
PCIBus
 *
	m√xt
;

42 
	múq_cou¡
[];

45 
pci_upd©e_m≠pögs
(
PCIDevi˚
 *
d
);

47 
èrgë_phys_addr_t
 
	gpci_mem_ba£
;

48 
	gpci_úq_ödex
;

49 
PCIBus
 *
	gfú°_bus
;

51 
PCIBus
 *
	$pci_ªgi°î_bus
(
pci_£t_úq_‚
 
£t_úq
, 
pci_m≠_úq_‚
 
m≠_úq
,

52 *
pic
, 
dev‚_mö
, 
núq
)

54 
PCIBus
 *
bus
;

55 
bus
 = 
	`qemu_mÆlocz
((
PCIBus
Ë+ (
núq
 * ()));

56 
bus
->
£t_úq
 = set_irq;

57 
bus
->
m≠_úq
 = map_irq;

58 
bus
->
úq_›aque
 = 
pic
;

59 
bus
->
dev‚_mö
 = devfn_min;

60 
fú°_bus
 = 
bus
;

61  
bus
;

62 
	}
}

64 
PCIBus
 *
	$pci_ªgi°î_£c⁄d¨y_bus
(
PCIDevi˚
 *
dev
, 
pci_m≠_úq_‚
 
m≠_úq
)

66 
PCIBus
 *
bus
;

67 
bus
 = 
	`qemu_mÆlocz
((
PCIBus
));

68 
bus
->
m≠_úq
 = map_irq;

69 
bus
->
∑ª¡_dev
 = 
dev
;

70 
bus
->
√xt
 = 
dev
->bus->next;

71 
dev
->
bus
->
√xt
 = bus;

72  
bus
;

73 
	}
}

75 
	$pci_bus_num
(
PCIBus
 *
s
)

77  
s
->
bus_num
;

78 
	}
}

80 
	$pci_devi˚_ßve
(
PCIDevi˚
 *
s
, 
QEMUFûe
 *
f
)

82 
	`qemu_put_be32
(
f
, 1);

83 
	`qemu_put_buf„r
(
f
, 
s
->
c⁄fig
, 256);

84 
	}
}

86 
	$pci_devi˚_lﬂd
(
PCIDevi˚
 *
s
, 
QEMUFûe
 *
f
)

88 
uöt32_t
 
vîsi⁄_id
;

89 
vîsi⁄_id
 = 
	`qemu_gë_be32
(
f
);

90 i‡(
vîsi⁄_id
 != 1)

91  -
EINVAL
;

92 
	`qemu_gë_buf„r
(
f
, 
s
->
c⁄fig
, 256);

93 
	`pci_upd©e_m≠pögs
(
s
);

95 
	}
}

98 
PCIDevi˚
 *
	$pci_ªgi°î_devi˚
(
PCIBus
 *
bus
, c⁄° *
«me
,

99 
ö°™˚_size
, 
dev‚
,

100 
PCIC⁄figRódFunc
 *
c⁄fig_ªad
,

101 
PCIC⁄figWrôeFunc
 *
c⁄fig_wrôe
)

103 
PCIDevi˚
 *
pci_dev
;

105 i‡(
pci_úq_ödex
 >
PCI_DEVICES_MAX
)

106  
NULL
;

108 i‡(
dev‚
 < 0) {

109 
dev‚
 = 
bus
->
dev‚_mö
 ; devfn < 256; devfn += 8) {

110 i‡(!
bus
->
devi˚s
[
dev‚
])

111 
found
;

113  
NULL
;

114 
found
: ;

116 
pci_dev
 = 
	`qemu_mÆlocz
(
ö°™˚_size
);

117 i‡(!
pci_dev
)

118  
NULL
;

119 
pci_dev
->
bus
 = bus;

120 
pci_dev
->
dev‚
 = devfn;

121 
	`p°r˝y
(
pci_dev
->
«me
, (pci_dev->name),Çame);

122 
	`mem£t
(
pci_dev
->
úq_°©e
, 0, (pci_dev->irq_state));

124 i‡(!
c⁄fig_ªad
)

125 
c⁄fig_ªad
 = 
pci_deÁu…_ªad_c⁄fig
;

126 i‡(!
c⁄fig_wrôe
)

127 
c⁄fig_wrôe
 = 
pci_deÁu…_wrôe_c⁄fig
;

128 
pci_dev
->
c⁄fig_ªad
 = config_read;

129 
pci_dev
->
c⁄fig_wrôe
 = config_write;

130 
pci_dev
->
úq_ödex
 = 
pci_úq_ödex
++;

131 
bus
->
devi˚s
[
dev‚
] = 
pci_dev
;

132  
pci_dev
;

133 
	}
}

135 
	$pci_ªgi°î_io_ªgi⁄
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

136 
uöt32_t
 
size
, 
ty≥
,

137 
PCIM≠IORegi⁄Func
 *
m≠_func
)

139 
PCIIORegi⁄
 *
r
;

140 
uöt32_t
 
addr
;

142 i‡(()
ªgi⁄_num
 >
PCI_NUM_REGIONS
)

144 
r
 = &
pci_dev
->
io_ªgi⁄s
[
ªgi⁄_num
];

145 
r
->
addr
 = -1;

146 
r
->
size
 = size;

147 
r
->
ty≥
 =Åype;

148 
r
->
m≠_func
 = map_func;

149 i‡(
ªgi⁄_num
 =
PCI_ROM_SLOT
) {

150 
addr
 = 0x30;

152 
addr
 = 0x10 + 
ªgi⁄_num
 * 4;

154 *(
uöt32_t
 *)(
pci_dev
->
c⁄fig
 + 
addr
Ë
	`˝u_to_À32
(
ty≥
);

155 
	}
}

157 
èrgë_phys_addr_t
 
	$pci_to_˝u_addr
(
èrgë_phys_addr_t
 
addr
)

159  
addr
 + 
pci_mem_ba£
;

160 
	}
}

162 
	$pci_upd©e_m≠pögs
(
PCIDevi˚
 *
d
)

164 
PCIIORegi⁄
 *
r
;

165 
cmd
, 
i
;

166 
uöt32_t
 
œ°_addr
, 
√w_addr
, 
c⁄fig_ofs
;

168 
cmd
 = 
	`À16_to_˝u
(*(
uöt16_t
 *)(
d
->
c⁄fig
 + 
PCI_COMMAND
));

169 
i
 = 0; i < 
PCI_NUM_REGIONS
; i++) {

170 
r
 = &
d
->
io_ªgi⁄s
[
i
];

171 i‡(
i
 =
PCI_ROM_SLOT
) {

172 
c⁄fig_ofs
 = 0x30;

174 
c⁄fig_ofs
 = 0x10 + 
i
 * 4;

176 i‡(
r
->
size
 != 0) {

177 i‡(
r
->
ty≥
 & 
PCI_ADDRESS_SPACE_IO
) {

178 i‡(
cmd
 & 
PCI_COMMAND_IO
) {

179 
√w_addr
 = 
	`À32_to_˝u
(*(
uöt32_t
 *)(
d
->
c⁄fig
 +

180 
c⁄fig_ofs
));

181 
√w_addr
 =Çew_add∏& ~(
r
->
size
 - 1);

182 
œ°_addr
 = 
√w_addr
 + 
r
->
size
 - 1;

184 i‡(
œ°_addr
 <
√w_addr
 ||Çew_addr == 0 ||

185 
œ°_addr
 >= 0x10000) {

186 
√w_addr
 = -1;

189 
√w_addr
 = -1;

192 i‡(
cmd
 & 
PCI_COMMAND_MEMORY
) {

193 
√w_addr
 = 
	`À32_to_˝u
(*(
uöt32_t
 *)(
d
->
c⁄fig
 +

194 
c⁄fig_ofs
));

196 i‡(
i
 =
PCI_ROM_SLOT
 && !(
√w_addr
 & 1))

197 
no_mem_m≠
;

198 
√w_addr
 =Çew_add∏& ~(
r
->
size
 - 1);

199 
œ°_addr
 = 
√w_addr
 + 
r
->
size
 - 1;

204 i‡(
œ°_addr
 <
√w_addr
 ||Çew_addr == 0 ||

205 
œ°_addr
 == -1) {

206 
√w_addr
 = -1;

209 
no_mem_m≠
:

210 
√w_addr
 = -1;

214 i‡(
√w_addr
 !
r
->
addr
) {

215 i‡(
r
->
addr
 != -1) {

216 i‡(
r
->
ty≥
 & 
PCI_ADDRESS_SPACE_IO
) {

217 
˛ass
;

220 
˛ass
 = 
d
->
c⁄fig
[0x0a] | (d->config[0x0b] << 8);

221 i‡(
˛ass
 =0x0101 && 
r
->
size
 == 4) {

222 
	`iß_u«ssign_i›‹t
(
r
->
addr
 + 2, 1);

224 
	`iß_u«ssign_i›‹t
(
r
->
addr
,Ñ->
size
);

227 
	`˝u_ªgi°î_physiˇl_mem‹y
(
	`pci_to_˝u_addr
(
r
->
addr
),

228 
r
->
size
,

229 
IO_MEM_UNASSIGNED
);

232 
r
->
addr
 = 
√w_addr
;

233 i‡(
r
->
addr
 != -1) {

234 
r
->
	`m≠_func
(
d
, 
i
,Ñ->
addr
,Ñ->
size
,Ñ->
ty≥
);

239 
	}
}

241 
uöt32_t
 
	$pci_deÁu…_ªad_c⁄fig
(
PCIDevi˚
 *
d
,

242 
uöt32_t
 
addªss
, 
Àn
)

244 
uöt32_t
 
vÆ
;

246 
Àn
) {

249 i‡(
addªss
 <= 0xfc) {

250 
vÆ
 = 
	`À32_to_˝u
(*(
uöt32_t
 *)(
d
->
c⁄fig
 + 
addªss
));

255 i‡(
addªss
 <= 0xfe) {

256 
vÆ
 = 
	`À16_to_˝u
(*(
uöt16_t
 *)(
d
->
c⁄fig
 + 
addªss
));

261 
vÆ
 = 
d
->
c⁄fig
[
addªss
];

264  
vÆ
;

265 
	}
}

267 
	$pci_deÁu…_wrôe_c⁄fig
(
PCIDevi˚
 *
d
,

268 
uöt32_t
 
addªss
, uöt32_à
vÆ
, 
Àn
)

270 
ˇn_wrôe
, 
i
;

271 
uöt32_t
 
íd
, 
addr
;

273 i‡(
Àn
 =4 && ((
addªss
 >= 0x10 &&áddress < 0x10 + 4 * 6) ||

274 (
addªss
 >= 0x30 &&áddress < 0x34))) {

275 
PCIIORegi⁄
 *
r
;

276 
ªg
;

278 i‡–
addªss
 >= 0x30 ) {

279 
ªg
 = 
PCI_ROM_SLOT
;

281 
ªg
 = (
addªss
 - 0x10) >> 2;

283 
r
 = &
d
->
io_ªgi⁄s
[
ªg
];

284 i‡(
r
->
size
 == 0)

285 
deÁu…_c⁄fig
;

287 i‡(
ªg
 =
PCI_ROM_SLOT
) {

289 
vÆ
 &(~(
r
->
size
 - 1)) | 1;

291 
vÆ
 &~(
r
->
size
 - 1);

292 
vÆ
 |
r
->
ty≥
;

294 *(
uöt32_t
 *)(
d
->
c⁄fig
 + 
addªss
Ë
	`˝u_to_À32
(
vÆ
);

295 
	`pci_upd©e_m≠pögs
(
d
);

298 
deÁu…_c⁄fig
:

300 
addr
 = 
addªss
;

301 
i
 = 0; i < 
Àn
; i++) {

303 
d
->
c⁄fig
[0x0e]) {

306 
addr
) {

320 
ˇn_wrôe
 = 0;

323 
ˇn_wrôe
 = 1;

329 
addr
) {

341 
ˇn_wrôe
 = 0;

344 
ˇn_wrôe
 = 1;

349 i‡(
ˇn_wrôe
) {

350 if–
addr
 == 0x05 ) {

352 
vÆ
 &= 0x07;

353 } i‡–
addr
 == 0x06 ) {

356 
vÆ
 = 
d
->
c⁄fig
[
addr
];

357 } i‡–
addr
 == 0x07 ) {

359 
vÆ
 = (vÆ & ~0x06Ë| (
d
->
c⁄fig
[
addr
] & 0x06);

362 
d
->
c⁄fig
[
addr
] = 
vÆ
;

364 i‡(++
addr
 > 0xff)

366 
vÆ
 >>= 8;

369 
íd
 = 
addªss
 + 
Àn
;

370 i‡(
íd
 > 
PCI_COMMAND
 && 
addªss
 < (PCI_COMMAND + 2)) {

372 
	`pci_upd©e_m≠pögs
(
d
);

374 
	}
}

376 
	$pci_d©a_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
, 
Àn
)

378 
PCIBus
 *
s
 = 
›aque
;

379 
PCIDevi˚
 *
pci_dev
;

380 
c⁄fig_addr
, 
bus_num
;

382 #i‡
	`deföed
(
DEBUG_PCI
) && 0

383 
	`¥ötf
("pci_data_write:áddr=%08x val=%08xÜen=%d\n",

384 
addr
, 
vÆ
, 
Àn
);

386 
bus_num
 = (
addr
 >> 16) & 0xff;

387 
s
 && s->
bus_num
 != bus_num)

388 
s
 = s->
√xt
;

389 i‡(!
s
)

391 
pci_dev
 = 
s
->
devi˚s
[(
addr
 >> 8) & 0xff];

392 i‡(!
pci_dev
)

394 
c⁄fig_addr
 = 
addr
 & 0xff;

395 #i‡
	`deföed
(
DEBUG_PCI
)

396 
	`¥ötf
("pci_config_write: %s:áddr=%02x val=%08xÜen=%d\n",

397 
pci_dev
->
«me
, 
c⁄fig_addr
, 
vÆ
, 
Àn
);

399 
pci_dev
->
	`c⁄fig_wrôe
’ci_dev, 
c⁄fig_addr
, 
vÆ
, 
Àn
);

400 
	}
}

402 
uöt32_t
 
	$pci_d©a_ªad
(*
›aque
, 
uöt32_t
 
addr
, 
Àn
)

404 
PCIBus
 *
s
 = 
›aque
;

405 
PCIDevi˚
 *
pci_dev
;

406 
c⁄fig_addr
, 
bus_num
;

407 
uöt32_t
 
vÆ
;

409 
bus_num
 = (
addr
 >> 16) & 0xff;

410 
s
 && s->
bus_num
 != bus_num)

411 
s
s->
√xt
;

412 i‡(!
s
)

413 
Áû
;

414 
pci_dev
 = 
s
->
devi˚s
[(
addr
 >> 8) & 0xff];

415 i‡(!
pci_dev
) {

416 
Áû
:

417 
Àn
) {

419 
vÆ
 = 0xff;

422 
vÆ
 = 0xffff;

426 
vÆ
 = 0xffffffff;

429 
the_íd
;

431 
c⁄fig_addr
 = 
addr
 & 0xff;

432 
vÆ
 = 
pci_dev
->
	`c⁄fig_ªad
’ci_dev, 
c⁄fig_addr
, 
Àn
);

433 #i‡
	`deföed
(
DEBUG_PCI
)

434 
	`¥ötf
("pci_config_read: %s:áddr=%02x val=%08xÜen=%d\n",

435 
pci_dev
->
«me
, 
c⁄fig_addr
, 
vÆ
, 
Àn
);

437 
the_íd
:

438 #i‡
	`deföed
(
DEBUG_PCI
) && 0

439 
	`¥ötf
("pci_data_read:áddr=%08x val=%08xÜen=%d\n",

440 
addr
, 
vÆ
, 
Àn
);

442  
vÆ
;

443 
	}
}

449 
	$pci_£t_úq
(
PCIDevi˚
 *
pci_dev
, 
úq_num
, 
Àvñ
)

451 
PCIBus
 *
bus
;

452 
ch™ge
;

454 
ch™ge
 = 
Àvñ
 - 
pci_dev
->
úq_°©e
[
úq_num
];

455 i‡(!
ch™ge
)

458 
pci_dev
->
úq_°©e
[
úq_num
] = 
Àvñ
;

460 
bus
 = 
pci_dev
->bus;

461 
úq_num
 = 
bus
->
	`m≠_úq
(
pci_dev
, irq_num);

462 i‡(
bus
->
£t_úq
)

464 
pci_dev
 = 
bus
->
∑ª¡_dev
;

466 
bus
->
úq_cou¡
[
úq_num
] +
ch™ge
;

467 
bus
->
	`£t_úq
(bus->
úq_›aque
, 
úq_num
, bus->
úq_cou¡
[irq_num] != 0);

468 
	}
}

474 
uöt16_t
 
	m˛ass
;

475 c⁄° *
	mdesc
;

476 } 
	tpci_˛ass_desc
;

478 
pci_˛ass_desc
 
	gpci_˛ass_des¸ùti⁄s
[] =

488 { 0, 
NULL
}

491 
	$pci_öfo_devi˚
(
PCIDevi˚
 *
d
)

493 
i
, 
˛ass
;

494 
PCIIORegi⁄
 *
r
;

495 
pci_˛ass_desc
 *
desc
;

497 
	`ãrm_¥ötf
(" Bus %2d, device %3d, function %d:\n",

498 
d
->
bus
->
bus_num
, d->
dev‚
 >> 3, d->devfn & 7);

499 
˛ass
 = 
	`À16_to_˝u
(*((
uöt16_t
 *)(
d
->
c⁄fig
 + 
PCI_CLASS_DEVICE
)));

500 
	`ãrm_¥ötf
(" ");

501 
desc
 = 
pci_˛ass_des¸ùti⁄s
;

502 
desc
->des¯&& 
˛ass
 != desc->class)

503 
desc
++;

504 i‡(
desc
->desc) {

505 
	`ãrm_¥ötf
("%s", 
desc
->desc);

507 
	`ãrm_¥ötf
("Cœs†%04x", 
˛ass
);

509 
	`ãrm_¥ötf
(": PCI device %04x:%04x\n",

510 
	`À16_to_˝u
(*((
uöt16_t
 *)(
d
->
c⁄fig
 + 
PCI_VENDOR_ID
))),

511 
	`À16_to_˝u
(*((
uöt16_t
 *)(
d
->
c⁄fig
 + 
PCI_DEVICE_ID
))));

513 i‡(
d
->
c⁄fig
[
PCI_INTERRUPT_PIN
] != 0) {

514 
	`ãrm_¥ötf
(" IRQ %d.\n", 
d
->
c⁄fig
[
PCI_INTERRUPT_LINE
]);

516 i‡(
˛ass
 == 0x0604) {

517 
	`ãrm_¥ötf
(" BUS %d.\n", 
d
->
c⁄fig
[0x19]);

519 
i
 = 0;ò< 
PCI_NUM_REGIONS
; i++) {

520 
r
 = &
d
->
io_ªgi⁄s
[
i
];

521 i‡(
r
->
size
 != 0) {

522 
	`ãrm_¥ötf
(" BAR%d: ", 
i
);

523 i‡(
r
->
ty≥
 & 
PCI_ADDRESS_SPACE_IO
) {

524 
	`ãrm_¥ötf
("I/Oát 0x%04x [0x%04x].\n",

525 
r
->
addr
,Ñ->add∏+Ñ->
size
 - 1);

527 
	`ãrm_¥ötf
("32 bit memoryát 0x%08x [0x%08x].\n",

528 
r
->
addr
,Ñ->add∏+Ñ->
size
 - 1);

532 i‡(
˛ass
 =0x0604 && 
d
->
c⁄fig
[0x19] != 0) {

533 
	`pci_f‹_óch_devi˚
(
d
->
c⁄fig
[0x19], 
pci_öfo_devi˚
);

535 
	}
}

537 
pci_f‹_óch_devi˚
(
bus_num
, (*
‚
)(
PCIDevi˚
 *
d
))

539 
PCIBus
 *
bus
 = 
fú°_bus
;

540 
PCIDevi˚
 *
d
;

541 
dev‚
;

543 
bus
 && bus->
bus_num
 != bus_num)

544 
bus
 = bus->
√xt
;

545 i‡(
bus
) {

546 
dev‚
 = 0; devfn < 256; devfn++) {

547 
d
 = 
bus
->
devi˚s
[
dev‚
];

548 i‡(
d
)

549 
	`‚
(
d
);

552 
	}
}

554 
	$pci_öfo
()

556 
	`pci_f‹_óch_devi˚
(0, 
pci_öfo_devi˚
);

557 
	}
}

560 
	$pci_nic_öô
(
PCIBus
 *
bus
, 
NICInfo
 *
nd
, 
dev‚
)

562 i‡(
	`°rcmp
(
nd
->
modñ
, "ne2k_pci") == 0) {

563 
	`pci_√2000_öô
(
bus
, 
nd
, 
dev‚
);

564 } i‡(
	`°rcmp
(
nd
->
modñ
, "rtl8139") == 0) {

565 
	`pci_πl8139_öô
(
bus
, 
nd
, 
dev‚
);

566 } i‡(
	`°rcmp
(
nd
->
modñ
, "pcnet") == 0) {

567 
	`pci_p˙ë_öô
(
bus
, 
nd
, 
dev‚
);

568 } i‡(
	`°rcmp
(
nd
->
modñ
, "e100") == 0) {

569 
	`pci_e100_öô
(
bus
, 
nd
);

571 
	`Ârötf
(
°dîr
, "qemu: Unsuµ‹ãd NIC: %s\n", 
nd
->
modñ
);

572 
	`exô
 (1);

574 
	}
}

577 
PCIDevi˚
 
	mdev
;

578 
PCIBus
 *
	mbus
;

579 } 
	tPCIBridge
;

581 
	$pci_bridge_wrôe_c⁄fig
(
PCIDevi˚
 *
d
,

582 
uöt32_t
 
addªss
, uöt32_à
vÆ
, 
Àn
)

584 
PCIBridge
 *
s
 = (PCIBridgê*)
d
;

586 i‡(
addªss
 =0x19 || (addªs†=0x18 && 
Àn
 > 1)) {

587 i‡(
addªss
 == 0x19)

588 
s
->
bus
->
bus_num
 = 
vÆ
 & 0xff;

590 
s
->
bus
->
bus_num
 = (
vÆ
 >> 8) & 0xff;

591 #i‡
	`deföed
(
DEBUG_PCI
)

592 
	`¥ötf
 ("pci-bridge: %s: Assig√d bu†%d\n", 
d
->
«me
, 
s
->
bus
->
bus_num
);

595 
	`pci_deÁu…_wrôe_c⁄fig
(
d
, 
addªss
, 
vÆ
, 
Àn
);

596 
	}
}

598 
PCIBus
 *
	$pci_bridge_öô
(
PCIBus
 *
bus
, 
dev‚
, 
uöt32_t
 
id
,

599 
pci_m≠_úq_‚
 
m≠_úq
, c⁄° *
«me
)

601 
PCIBridge
 *
s
;

602 
s
 = (
PCIBridge
 *)
	`pci_ªgi°î_devi˚
(
bus
, 
«me
, (PCIBridge),

603 
dev‚
, 
NULL
, 
pci_bridge_wrôe_c⁄fig
);

604 
s
->
dev
.
c⁄fig
[0x00] = 
id
 >> 16;

605 
s
->
dev
.
c⁄fig
[0x01] = 
id
 > 24;

606 
s
->
dev
.
c⁄fig
[0x02] = 
id
;

607 
s
->
dev
.
c⁄fig
[0x03] = 
id
 >> 8;

608 
s
->
dev
.
c⁄fig
[0x04] = 0x06;

609 
s
->
dev
.
c⁄fig
[0x05] = 0x00;

610 
s
->
dev
.
c⁄fig
[0x06] = 0xa0;

611 
s
->
dev
.
c⁄fig
[0x07] = 0x00;

612 
s
->
dev
.
c⁄fig
[0x08] = 0x00;

613 
s
->
dev
.
c⁄fig
[0x09] = 0x00;

614 
s
->
dev
.
c⁄fig
[0x0A] = 0x04;

615 
s
->
dev
.
c⁄fig
[0x0B] = 0x06;

616 
s
->
dev
.
c⁄fig
[0x0D] = 0x10;

617 
s
->
dev
.
c⁄fig
[0x0E] = 0x81;

618 
s
->
dev
.
c⁄fig
[0x1E] = 0xa0;

620 
s
->
bus
 = 
	`pci_ªgi°î_£c⁄d¨y_bus
(&s->
dev
, 
m≠_úq
);

621  
s
->
bus
;

622 
	}
}

	@pci_host.h

29 
uöt32_t
 
	mc⁄fig_ªg
;

30 
PCIBus
 *
	mbus
;

31 } 
	tPCIHo°Sèã
;

33 
	$pci_ho°_d©a_wrôeb
(* 
›aque
, 
pci_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

35 
PCIHo°Sèã
 *
s
 = 
›aque
;

36 i‡(
s
->
c⁄fig_ªg
 & (1u << 31))

37 
	`pci_d©a_wrôe
(
s
->
bus
, s->
c⁄fig_ªg
 | (
addr
 & 3), 
vÆ
, 1);

38 
	}
}

40 
	$pci_ho°_d©a_wrôew
(* 
›aque
, 
pci_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

42 
PCIHo°Sèã
 *
s
 = 
›aque
;

43 #ifde‡
TARGET_WORDS_BIGENDIAN


44 
vÆ
 = 
	`bsw≠16
(val);

46 i‡(
s
->
c⁄fig_ªg
 & (1u << 31))

47 
	`pci_d©a_wrôe
(
s
->
bus
, s->
c⁄fig_ªg
 | (
addr
 & 3), 
vÆ
, 2);

48 
	}
}

50 
	$pci_ho°_d©a_wrôñ
(* 
›aque
, 
pci_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

52 
PCIHo°Sèã
 *
s
 = 
›aque
;

53 #ifde‡
TARGET_WORDS_BIGENDIAN


54 
vÆ
 = 
	`bsw≠32
(val);

56 i‡(
s
->
c⁄fig_ªg
 & (1u << 31))

57 
	`pci_d©a_wrôe
(
s
->
bus
, s->
c⁄fig_ªg
, 
vÆ
, 4);

58 
	}
}

60 
uöt32_t
 
	$pci_ho°_d©a_ªadb
(* 
›aque
, 
pci_addr_t
 
addr
)

62 
PCIHo°Sèã
 *
s
 = 
›aque
;

63 i‡(!(
s
->
c⁄fig_ªg
 & (1 << 31)))

65  
	`pci_d©a_ªad
(
s
->
bus
, s->
c⁄fig_ªg
 | (
addr
 & 3), 1);

66 
	}
}

68 
uöt32_t
 
	$pci_ho°_d©a_ªadw
(* 
›aque
, 
pci_addr_t
 
addr
)

70 
PCIHo°Sèã
 *
s
 = 
›aque
;

71 
uöt32_t
 
vÆ
;

72 i‡(!(
s
->
c⁄fig_ªg
 & (1 << 31)))

74 
vÆ
 = 
	`pci_d©a_ªad
(
s
->
bus
, s->
c⁄fig_ªg
 | (
addr
 & 3), 2);

75 #ifde‡
TARGET_WORDS_BIGENDIAN


76 
vÆ
 = 
	`bsw≠16
(val);

78  
vÆ
;

79 
	}
}

81 
uöt32_t
 
	$pci_ho°_d©a_ªadl
(* 
›aque
, 
pci_addr_t
 
addr
)

83 
PCIHo°Sèã
 *
s
 = 
›aque
;

84 
uöt32_t
 
vÆ
;

85 i‡(!(
s
->
c⁄fig_ªg
 & (1 << 31)))

87 
vÆ
 = 
	`pci_d©a_ªad
(
s
->
bus
, s->
c⁄fig_ªg
 | (
addr
 & 3), 4);

88 #ifde‡
TARGET_WORDS_BIGENDIAN


89 
vÆ
 = 
	`bsw≠32
(val);

91  
vÆ
;

92 
	}
}

	@pckbd.c

24 
	~"vl.h
"

33 
	#KBD_CCMD_READ_MODE
 0x20

	)

34 
	#KBD_CCMD_WRITE_MODE
 0x60

	)

35 
	#KBD_CCMD_GET_VERSION
 0xA1

	)

36 
	#KBD_CCMD_MOUSE_DISABLE
 0xA7

	)

37 
	#KBD_CCMD_MOUSE_ENABLE
 0xA8

	)

38 
	#KBD_CCMD_TEST_MOUSE
 0xA9

	)

39 
	#KBD_CCMD_SELF_TEST
 0xAA

	)

40 
	#KBD_CCMD_KBD_TEST
 0xAB

	)

41 
	#KBD_CCMD_KBD_DISABLE
 0xAD

	)

42 
	#KBD_CCMD_KBD_ENABLE
 0xAE

	)

43 
	#KBD_CCMD_READ_INPORT
 0xC0

	)

44 
	#KBD_CCMD_READ_OUTPORT
 0xD0

	)

45 
	#KBD_CCMD_WRITE_OUTPORT
 0xD1

	)

46 
	#KBD_CCMD_WRITE_OBUF
 0xD2

	)

47 
	#KBD_CCMD_WRITE_AUX_OBUF
 0xD3

	)

49 
	#KBD_CCMD_WRITE_MOUSE
 0xD4

	)

50 
	#KBD_CCMD_DISABLE_A20
 0xDD

	)

51 
	#KBD_CCMD_ENABLE_A20
 0xDF

	)

52 
	#KBD_CCMD_RESET
 0xFE

	)

55 
	#KBD_CMD_SET_LEDS
 0xED

	)

56 
	#KBD_CMD_ECHO
 0xEE

	)

57 
	#KBD_CMD_GET_ID
 0xF2

	)

58 
	#KBD_CMD_SET_RATE
 0xF3

	)

59 
	#KBD_CMD_ENABLE
 0xF4

	)

60 
	#KBD_CMD_RESET_DISABLE
 0xF5

	)

61 
	#KBD_CMD_RESET_ENABLE
 0xF6

	)

62 
	#KBD_CMD_RESET
 0xFF

	)

65 
	#KBD_REPLY_POR
 0xAA

	)

66 
	#KBD_REPLY_ACK
 0xFA

	)

67 
	#KBD_REPLY_RESEND
 0xFE

	)

70 
	#KBD_STAT_OBF
 0x01

	)

71 
	#KBD_STAT_IBF
 0x02

	)

72 
	#KBD_STAT_SELFTEST
 0x04

	)

73 
	#KBD_STAT_CMD
 0x08

	)

74 
	#KBD_STAT_UNLOCKED
 0x10

	)

75 
	#KBD_STAT_MOUSE_OBF
 0x20

	)

76 
	#KBD_STAT_GTO
 0x40

	)

77 
	#KBD_STAT_PERR
 0x80

	)

80 
	#KBD_MODE_KBD_INT
 0x01

	)

81 
	#KBD_MODE_MOUSE_INT
 0x02

	)

82 
	#KBD_MODE_SYS
 0x04

	)

83 
	#KBD_MODE_NO_KEYLOCK
 0x08

	)

84 
	#KBD_MODE_DISABLE_KBD
 0x10

	)

85 
	#KBD_MODE_DISABLE_MOUSE
 0x20

	)

86 
	#KBD_MODE_KCC
 0x40

	)

87 
	#KBD_MODE_RFU
 0x80

	)

90 
	#AUX_SET_SCALE11
 0xE6

	)

91 
	#AUX_SET_SCALE21
 0xE7

	)

92 
	#AUX_SET_RES
 0xE8

	)

93 
	#AUX_GET_SCALE
 0xE9

	)

94 
	#AUX_SET_STREAM
 0xEA

	)

95 
	#AUX_POLL
 0xEB

	)

96 
	#AUX_RESET_WRAP
 0xEC

	)

97 
	#AUX_SET_WRAP
 0xEE

	)

98 
	#AUX_SET_REMOTE
 0xF0

	)

99 
	#AUX_GET_TYPE
 0xF2

	)

100 
	#AUX_SET_SAMPLE
 0xF3

	)

101 
	#AUX_ENABLE_DEV
 0xF4

	)

102 
	#AUX_DISABLE_DEV
 0xF5

	)

103 
	#AUX_SET_DEFAULT
 0xF6

	)

104 
	#AUX_RESET
 0xFF

	)

105 
	#AUX_ACK
 0xFA

	)

107 
	#MOUSE_STATUS_REMOTE
 0x40

	)

108 
	#MOUSE_STATUS_ENABLED
 0x20

	)

109 
	#MOUSE_STATUS_SCALE21
 0x10

	)

111 
	#KBD_QUEUE_SIZE
 256

	)

113 
	#KBD_PENDING_KBD
 1

	)

114 
	#KBD_PENDING_AUX
 2

	)

116 
	sKBDSèã
 {

117 
uöt8_t
 
	mwrôe_cmd
;

118 
uöt8_t
 
	m°©us
;

119 
uöt8_t
 
	mmode
;

121 
uöt8_t
 
	m≥ndög
;

122 *
	mkbd
;

123 *
	mmou£
;

124 } 
	tKBDSèã
;

126 
KBDSèã
 
	gkbd_°©e
;

131 
	$kbd_upd©e_úq
(
KBDSèã
 *
s
)

133 
úq12_Àvñ
, 
úq1_Àvñ
;

135 
úq1_Àvñ
 = 0;

136 
úq12_Àvñ
 = 0;

137 
s
->
°©us
 &~(
KBD_STAT_OBF
 | 
KBD_STAT_MOUSE_OBF
);

138 i‡(
s
->
≥ndög
) {

139 
s
->
°©us
 |
KBD_STAT_OBF
;

141 i‡(
s
->
≥ndög
 =
KBD_PENDING_AUX
) {

142 
s
->
°©us
 |
KBD_STAT_MOUSE_OBF
;

143 i‡(
s
->
mode
 & 
KBD_MODE_MOUSE_INT
)

144 
úq12_Àvñ
 = 1;

146 i‡((
s
->
mode
 & 
KBD_MODE_KBD_INT
) &&

147 !(
s
->
mode
 & 
KBD_MODE_DISABLE_KBD
))

148 
úq1_Àvñ
 = 1;

151 
	`pic_£t_úq
(1, 
úq1_Àvñ
);

152 
	`pic_£t_úq
(12, 
úq12_Àvñ
);

153 
	}
}

155 
	$kbd_upd©e_kbd_úq
(*
›aque
, 
Àvñ
)

157 
KBDSèã
 *
s
 = (KBDSèã *)
›aque
;

159 i‡(
Àvñ
)

160 
s
->
≥ndög
 |
KBD_PENDING_KBD
;

162 
s
->
≥ndög
 &~
KBD_PENDING_KBD
;

163 
	`kbd_upd©e_úq
(
s
);

164 
	}
}

166 
	$kbd_upd©e_aux_úq
(*
›aque
, 
Àvñ
)

168 
KBDSèã
 *
s
 = (KBDSèã *)
›aque
;

170 i‡(
Àvñ
)

171 
s
->
≥ndög
 |
KBD_PENDING_AUX
;

173 
s
->
≥ndög
 &~
KBD_PENDING_AUX
;

174 
	`kbd_upd©e_úq
(
s
);

175 
	}
}

177 
uöt32_t
 
	$kbd_ªad_°©us
(*
›aque
, 
uöt32_t
 
addr
)

179 
KBDSèã
 *
s
 = 
›aque
;

180 
vÆ
;

181 
vÆ
 = 
s
->
°©us
;

182 #i‡
	`deföed
(
DEBUG_KBD
)

183 
	`¥ötf
("kbd:Ñód sètus=0x%02x\n", 
vÆ
);

185  
vÆ
;

186 
	}
}

188 
	$kbd_queue
(
KBDSèã
 *
s
, 
b
, 
aux
)

190 i‡(
aux
)

191 
	`ps2_queue
(
s
->
mou£
, 
b
);

193 
	`ps2_queue
(
s
->
kbd
, 
b
);

194 
	}
}

196 
	$kbd_wrôe_comm™d
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

198 
KBDSèã
 *
s
 = 
›aque
;

200 #ifde‡
DEBUG_KBD


201 
	`¥ötf
("kbd: wrôêcmd=0x%02x\n", 
vÆ
);

203 
vÆ
) {

204 
KBD_CCMD_READ_MODE
:

205 
	`kbd_queue
(
s
, s->
mode
, 0);

207 
KBD_CCMD_WRITE_MODE
:

208 
KBD_CCMD_WRITE_OBUF
:

209 
KBD_CCMD_WRITE_AUX_OBUF
:

210 
KBD_CCMD_WRITE_MOUSE
:

211 
KBD_CCMD_WRITE_OUTPORT
:

212 
s
->
wrôe_cmd
 = 
vÆ
;

214 
KBD_CCMD_MOUSE_DISABLE
:

215 
s
->
mode
 |
KBD_MODE_DISABLE_MOUSE
;

217 
KBD_CCMD_MOUSE_ENABLE
:

218 
s
->
mode
 &~
KBD_MODE_DISABLE_MOUSE
;

220 
KBD_CCMD_TEST_MOUSE
:

221 
	`kbd_queue
(
s
, 0x00, 0);

223 
KBD_CCMD_SELF_TEST
:

224 
s
->
°©us
 |
KBD_STAT_SELFTEST
;

225 
	`kbd_queue
(
s
, 0x55, 0);

227 
KBD_CCMD_KBD_TEST
:

228 
	`kbd_queue
(
s
, 0x00, 0);

230 
KBD_CCMD_KBD_DISABLE
:

231 
s
->
mode
 |
KBD_MODE_DISABLE_KBD
;

232 
	`kbd_upd©e_úq
(
s
);

234 
KBD_CCMD_KBD_ENABLE
:

235 
s
->
mode
 &~
KBD_MODE_DISABLE_KBD
;

236 
	`kbd_upd©e_úq
(
s
);

238 
KBD_CCMD_READ_INPORT
:

239 
	`kbd_queue
(
s
, 0x00, 0);

241 
KBD_CCMD_READ_OUTPORT
:

243 #ifde‡
TARGET_I386


244 
vÆ
 = 0x01 | (
	`i›‹t_gë_a20
() << 1);

246 
vÆ
 = 0x01;

248 i‡(
s
->
°©us
 & 
KBD_STAT_OBF
)

249 
vÆ
 |= 0x10;

250 i‡(
s
->
°©us
 & 
KBD_STAT_MOUSE_OBF
)

251 
vÆ
 |= 0x20;

252 
	`kbd_queue
(
s
, 
vÆ
, 0);

254 #ifde‡
TARGET_I386


255 
KBD_CCMD_ENABLE_A20
:

256 
	`i›‹t_£t_a20
(1);

258 
KBD_CCMD_DISABLE_A20
:

259 
	`i›‹t_£t_a20
(0);

262 
KBD_CCMD_RESET
:

263 
	`qemu_sy°em_ª£t_ªque°
();

269 
	`Ârötf
(
°dîr
, "qemu: unsuµ‹ãd keybﬂrd cmd=0x%02x\n", 
vÆ
);

272 
	}
}

274 
uöt32_t
 
	$kbd_ªad_d©a
(*
›aque
, 
uöt32_t
 
addr
)

276 
KBDSèã
 *
s
 = 
›aque
;

278 i‡(
s
->
≥ndög
 =
KBD_PENDING_AUX
)

279  
	`ps2_ªad_d©a
(
s
->
mou£
);

281  
	`ps2_ªad_d©a
(
s
->
kbd
);

282 
	}
}

284 
	$kbd_wrôe_d©a
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

286 
KBDSèã
 *
s
 = 
›aque
;

288 #ifde‡
DEBUG_KBD


289 
	`¥ötf
("kbd: wrôêd©a=0x%02x\n", 
vÆ
);

292 
s
->
wrôe_cmd
) {

294 
	`ps2_wrôe_keybﬂrd
(
s
->
kbd
, 
vÆ
);

296 
KBD_CCMD_WRITE_MODE
:

297 
s
->
mode
 = 
vÆ
;

298 
	`ps2_keybﬂrd_£t_å™¶©i⁄
(
s
->
kbd
, (s->
mode
 & 
KBD_MODE_KCC
) != 0);

300 
	`kbd_upd©e_úq
(
s
);

302 
KBD_CCMD_WRITE_OBUF
:

303 
	`kbd_queue
(
s
, 
vÆ
, 0);

305 
KBD_CCMD_WRITE_AUX_OBUF
:

306 
	`kbd_queue
(
s
, 
vÆ
, 1);

308 
KBD_CCMD_WRITE_OUTPORT
:

309 #ifde‡
TARGET_I386


310 
	`i›‹t_£t_a20
((
vÆ
 >> 1) & 1);

312 i‡(!(
vÆ
 & 1)) {

313 
	`qemu_sy°em_ª£t_ªque°
();

316 
KBD_CCMD_WRITE_MOUSE
:

317 
	`ps2_wrôe_mou£
(
s
->
mou£
, 
vÆ
);

322 
s
->
wrôe_cmd
 = 0;

323 
	}
}

325 
	$kbd_ª£t
(*
›aque
)

327 
KBDSèã
 *
s
 = 
›aque
;

329 
s
->
mode
 = 
KBD_MODE_KBD_INT
 | 
KBD_MODE_MOUSE_INT
;

330 
s
->
°©us
 = 
KBD_STAT_CMD
 | 
KBD_STAT_UNLOCKED
;

331 
	}
}

333 
	$kbd_ßve
(
QEMUFûe
* 
f
, * 
›aque
)

335 
KBDSèã
 *
s
 = (KBDSèã*)
›aque
;

337 
	`qemu_put_8s
(
f
, &
s
->
wrôe_cmd
);

338 
	`qemu_put_8s
(
f
, &
s
->
°©us
);

339 
	`qemu_put_8s
(
f
, &
s
->
mode
);

340 
	`qemu_put_8s
(
f
, &
s
->
≥ndög
);

341 
	}
}

343 
	$kbd_lﬂd
(
QEMUFûe
* 
f
, * 
›aque
, 
vîsi⁄_id
)

345 
KBDSèã
 *
s
 = (KBDSèã*)
›aque
;

347 i‡(
vîsi⁄_id
 != 3)

348  -
EINVAL
;

349 
	`qemu_gë_8s
(
f
, &
s
->
wrôe_cmd
);

350 
	`qemu_gë_8s
(
f
, &
s
->
°©us
);

351 
	`qemu_gë_8s
(
f
, &
s
->
mode
);

352 
	`qemu_gë_8s
(
f
, &
s
->
≥ndög
);

354 
	}
}

356 
	$kbd_öô
()

358 
KBDSèã
 *
s
 = &
kbd_°©e
;

360 
	`kbd_ª£t
(
s
);

361 
	`ªgi°î_ßvevm
("pckbd", 0, 3, 
kbd_ßve
, 
kbd_lﬂd
, 
s
);

362 
	`ªgi°î_i›‹t_ªad
(0x60, 1, 1, 
kbd_ªad_d©a
, 
s
);

363 
	`ªgi°î_i›‹t_wrôe
(0x60, 1, 1, 
kbd_wrôe_d©a
, 
s
);

364 
	`ªgi°î_i›‹t_ªad
(0x64, 1, 1, 
kbd_ªad_°©us
, 
s
);

365 
	`ªgi°î_i›‹t_wrôe
(0x64, 1, 1, 
kbd_wrôe_comm™d
, 
s
);

367 
s
->
kbd
 = 
	`ps2_kbd_öô
(
kbd_upd©e_kbd_úq
, s);

368 
s
->
mou£
 = 
	`ps2_mou£_öô
(
kbd_upd©e_aux_úq
, s);

369 
	`qemu_ªgi°î_ª£t
(
kbd_ª£t
, 
s
);

370 
	}
}

	@pcnet.c

40 
	~"vl.h
"

51 
	#PCNET_IOPORT_SIZE
 0x20

	)

52 
	#PCNET_PNPMMIO_SIZE
 0x20

	)

55 
PCNëSèã_°
 
	tPCNëSèã
;

57 
	sPCNëSèã_°
 {

58 
PCIDevi˚
 
	mdev
;

59 
PCIDevi˚
 *
	mpci_dev
;

60 
VLANClõ¡Sèã
 *
	mvc
;

61 
NICInfo
 *
	mnd
;

62 
QEMUTimî
 *
	mpﬁl_timî
;

63 
	mmmio_ödex
, 
	møp
, 
	mi§
, 
	m k°
;

64 
uöt32_t
 
	mrdø
, 
	mtdø
;

65 
uöt8_t
 
	m¥om
[16];

66 
uöt16_t
 
	mc§
[128];

67 
uöt16_t
 
	mb¸
[32];

68 
uöt64_t
 
	mtimî
;

69 
	mxmô_pos
, 
	mªcv_pos
;

70 
uöt8_t
 
	mbuf„r
[4096];

71 
	mtx_busy
;

72 (*
	m£t_úq_cb
)(*
	ms
, 
	mi§
);

73 (*
	mphys_mem_ªad
)(*
	mdma_›aque
, 
èrgë_phys_addr_t
 
	maddr
,

74 
uöt8_t
 *
	mbuf
, 
	mÀn
, 
	mdo_bsw≠
);

75 (*
	mphys_mem_wrôe
)(*
	mdma_›aque
, 
èrgë_phys_addr_t
 
	maddr
,

76 
uöt8_t
 *
	mbuf
, 
	mÀn
, 
	mdo_bsw≠
);

77 *
	mdma_›aque
;

82 #ifde‡
__GNUC__


83 
	#PACKED_FIELD
(
A
ËA 
	`__©åibuã__
 ((
∑cked
))

	)

85 #îr‹ 
FixMe


88 
	sqemu_ëhî_hódî
 {

89 
uöt8_t
 
	mëhî_dho°
[6];

90 
uöt8_t
 
	mëhî_sho°
[6];

91 
uöt16_t
 
	mëhî_ty≥
;

95 
	#BCR_MSRDA
 0

	)

96 
	#BCR_MSWRA
 1

	)

97 
	#BCR_MC
 2

	)

98 
	#BCR_LNKST
 4

	)

99 
	#BCR_LED1
 5

	)

100 
	#BCR_LED2
 6

	)

101 
	#BCR_LED3
 7

	)

102 
	#BCR_FDC
 9

	)

103 
	#BCR_BSBC
 18

	)

104 
	#BCR_EECAS
 19

	)

105 
	#BCR_SWS
 20

	)

106 
	#BCR_PLAT
 22

	)

108 
	#BCR_DWIO
(
S
Ë!!((S)->
b¸
[
BCR_BSBC
] & 0x0080)

	)

109 
	#BCR_SSIZE32
(
S
Ë!!((S)->
b¸
[
BCR_SWS
 ] & 0x0100)

	)

110 
	#BCR_SWSTYLE
(
S
Ë((S)->
b¸
[
BCR_SWS
 ] & 0x00FF)

	)

112 
	#CSR_INIT
(
S
Ë!!(((S)->
c§
[0])&0x0001)

	)

113 
	#CSR_STRT
(
S
Ë!!(((S)->
c§
[0])&0x0002)

	)

114 
	#CSR_STOP
(
S
Ë!!(((S)->
c§
[0])&0x0004)

	)

115 
	#CSR_TDMD
(
S
Ë!!(((S)->
c§
[0])&0x0008)

	)

116 
	#CSR_TXON
(
S
Ë!!(((S)->
c§
[0])&0x0010)

	)

117 
	#CSR_RXON
(
S
Ë!!(((S)->
c§
[0])&0x0020)

	)

118 
	#CSR_INEA
(
S
Ë!!(((S)->
c§
[0])&0x0040)

	)

119 
	#CSR_BSWP
(
S
Ë!!(((S)->
c§
[3])&0x0004)

	)

120 
	#CSR_LAPPEN
(
S
Ë!!(((S)->
c§
[3])&0x0020)

	)

121 
	#CSR_DXSUFLO
(
S
Ë!!(((S)->
c§
[3])&0x0040)

	)

122 
	#CSR_ASTRP_RCV
(
S
Ë!!(((S)->
c§
[4])&0x0800)

	)

123 
	#CSR_DPOLL
(
S
Ë!!(((S)->
c§
[4])&0x1000)

	)

124 
	#CSR_SPND
(
S
Ë!!(((S)->
c§
[5])&0x0001)

	)

125 
	#CSR_LTINTEN
(
S
Ë!!(((S)->
c§
[5])&0x4000)

	)

126 
	#CSR_TOKINTD
(
S
Ë!!(((S)->
c§
[5])&0x8000)

	)

127 
	#CSR_DRX
(
S
Ë!!(((S)->
c§
[15])&0x0001)

	)

128 
	#CSR_DTX
(
S
Ë!!(((S)->
c§
[15])&0x0002)

	)

129 
	#CSR_LOOP
(
S
Ë!!(((S)->
c§
[15])&0x0004)

	)

130 
	#CSR_DRCVPA
(
S
Ë!!(((S)->
c§
[15])&0x2000)

	)

131 
	#CSR_DRCVBC
(
S
Ë!!(((S)->
c§
[15])&0x4000)

	)

132 
	#CSR_PROM
(
S
Ë!!(((S)->
c§
[15])&0x8000)

	)

134 
	#CSR_CRBC
(
S
Ë((S)->
c§
[40])

	)

135 
	#CSR_CRST
(
S
Ë((S)->
c§
[41])

	)

136 
	#CSR_CXBC
(
S
Ë((S)->
c§
[42])

	)

137 
	#CSR_CXST
(
S
Ë((S)->
c§
[43])

	)

138 
	#CSR_NRBC
(
S
Ë((S)->
c§
[44])

	)

139 
	#CSR_NRST
(
S
Ë((S)->
c§
[45])

	)

140 
	#CSR_POLL
(
S
Ë((S)->
c§
[46])

	)

141 
	#CSR_PINT
(
S
Ë((S)->
c§
[47])

	)

142 
	#CSR_RCVRC
(
S
Ë((S)->
c§
[72])

	)

143 
	#CSR_XMTRC
(
S
Ë((S)->
c§
[74])

	)

144 
	#CSR_RCVRL
(
S
Ë((S)->
c§
[76])

	)

145 
	#CSR_XMTRL
(
S
Ë((S)->
c§
[78])

	)

146 
	#CSR_MISSC
(
S
Ë((S)->
c§
[112])

	)

148 
	#CSR_IADR
(
S
Ë((S)->
c§
[ 1] | ((S)->c§[ 2] << 16))

	)

149 
	#CSR_CRBA
(
S
Ë((S)->
c§
[18] | ((S)->c§[19] << 16))

	)

150 
	#CSR_CXBA
(
S
Ë((S)->
c§
[20] | ((S)->c§[21] << 16))

	)

151 
	#CSR_NRBA
(
S
Ë((S)->
c§
[22] | ((S)->c§[23] << 16))

	)

152 
	#CSR_BADR
(
S
Ë((S)->
c§
[24] | ((S)->c§[25] << 16))

	)

153 
	#CSR_NRDA
(
S
Ë((S)->
c§
[26] | ((S)->c§[27] << 16))

	)

154 
	#CSR_CRDA
(
S
Ë((S)->
c§
[28] | ((S)->c§[29] << 16))

	)

155 
	#CSR_BADX
(
S
Ë((S)->
c§
[30] | ((S)->c§[31] << 16))

	)

156 
	#CSR_NXDA
(
S
Ë((S)->
c§
[32] | ((S)->c§[33] << 16))

	)

157 
	#CSR_CXDA
(
S
Ë((S)->
c§
[34] | ((S)->c§[35] << 16))

	)

158 
	#CSR_NNRD
(
S
Ë((S)->
c§
[36] | ((S)->c§[37] << 16))

	)

159 
	#CSR_NNXD
(
S
Ë((S)->
c§
[38] | ((S)->c§[39] << 16))

	)

160 
	#CSR_PXDA
(
S
Ë((S)->
c§
[60] | ((S)->c§[61] << 16))

	)

161 
	#CSR_NXBA
(
S
Ë((S)->
c§
[64] | ((S)->c§[65] << 16))

	)

163 
	#PHYSADDR
(
S
,
A
) \

164 (
	`BCR_SSIZE32
(
S
Ë? (
A
Ë: (AË| ((0xff00 & (
uöt32_t
)(
s
)->
c§
[2])<<16))

	)

166 
	sp˙ë_öôblk16
 {

167 
uöt16_t
 
	mmode
;

168 
uöt16_t
 
	m∑dr
[3];

169 
uöt16_t
 
	mœdrf
[4];

170 
uöt32_t
 
	mrdø
;

171 
uöt32_t
 
	mtdø
;

174 
	sp˙ë_öôblk32
 {

175 
uöt16_t
 
	mmode
;

176 
uöt8_t
 
	mæí
;

177 
uöt8_t
 
	méí
;

178 
uöt16_t
 
	m∑dr
[3];

179 
uöt16_t
 
	m_ªs
;

180 
uöt16_t
 
	mœdrf
[4];

181 
uöt32_t
 
	mrdø
;

182 
uöt32_t
 
	mtdø
;

185 
	sp˙ë_TMD
 {

187 
	mtbadr
:32;

188 } 
	mtmd0
;

190 
PACKED_FIELD
(
b˙t
:12), PACKED_FIELD(
⁄es
:4), PACKED_FIELD(
ªs
:7), PACKED_FIELD(
b≥
:1);

191 
PACKED_FIELD
(
íp
:1), PACKED_FIELD(
°p
:1), PACKED_FIELD(
def
:1), PACKED_FIELD(
⁄e
:1);

192 
PACKED_FIELD
(
…öt
:1), PACKED_FIELD(
nofcs
:1), PACKED_FIELD(
îr
:1), PACKED_FIELD(
own
:1);

193 } 
	mtmd1
;

195 
PACKED_FIELD
(
åc
:4), PACKED_FIELD(
ªs
:12);

196 
PACKED_FIELD
(
tdr
:10), PACKED_FIELD(
πry
:1), PACKED_FIELD(
lˇr
:1);

197 
PACKED_FIELD
(
lcﬁ
:1), PACKED_FIELD(
exdef
:1), PACKED_FIELD(
uÊo
:1), PACKED_FIELD(
buff
:1);

198 } 
	mtmd2
;

200 
	mªs
:32;

201 } 
	mtmd3
;

204 
	sp˙ë_RMD
 {

206 
	mrbadr
:32;

207 } 
	mrmd0
;

209 
PACKED_FIELD
(
b˙t
:12), PACKED_FIELD(
⁄es
:4), PACKED_FIELD(
ªs
:4);

210 
PACKED_FIELD
(
bam
:1), PACKED_FIELD(
œfm
:1), PACKED_FIELD(
∑m
:1), PACKED_FIELD(
b≥
:1);

211 
PACKED_FIELD
(
íp
:1), PACKED_FIELD(
°p
:1), PACKED_FIELD(
buff
:1), PACKED_FIELD(
¸c
:1);

212 
PACKED_FIELD
(
oÊo
:1), PACKED_FIELD(
‰am
:1), PACKED_FIELD(
îr
:1), PACKED_FIELD(
own
:1);

213 } 
	mrmd1
;

215 
PACKED_FIELD
(
m˙t
:12), PACKED_FIELD(
zîos
:4);

216 
PACKED_FIELD
(
Ωc
:8), PACKED_FIELD(
rcc
:8);

217 } 
	mrmd2
;

219 
	mªs
:32;

220 } 
	mrmd3
;

224 
	#PRINT_TMD
(
T
Ë
	`¥ötf
( \

232 (
T
)->
tmd0
.
tbadr
, \

233 (
T
)->
tmd1
.
own
, (T)->tmd1.
îr
, (T)->tmd1.
nofcs
, \

234 (
T
)->
tmd1
.
…öt
, (T)->tmd1.
⁄e
, (T)->tmd1.
def
, \

235 (
T
)->
tmd1
.
°p
, (T)->tmd1.
íp
, (T)->tmd1.
b≥
, \

236 4096-(
T
)->
tmd1
.
b˙t
, \

237 (
T
)->
tmd2
.
buff
, (T)->tmd2.
uÊo
, (T)->tmd2.
exdef
,\

238 (
T
)->
tmd2
.
lcﬁ
, (T)->tmd2.
lˇr
, (T)->tmd2.
πry
, \

239 (
T
)->
tmd2
.
tdr
, (T)->tmd2.
åc
)

	)

241 
	#PRINT_RMD
(
R
Ë
	`¥ötf
( \

247 (
R
)->
rmd0
.
rbadr
, \

248 (
R
)->
rmd1
.
own
, (R)->rmd1.
îr
, (R)->rmd1.
‰am
, \

249 (
R
)->
rmd1
.
oÊo
, (R)->rmd1.
¸c
, (R)->rmd1.
buff
, \

250 (
R
)->
rmd1
.
°p
, (R)->rmd1.
íp
, (R)->rmd1.
b≥
, \

251 (
R
)->
rmd1
.
∑m
, (R)->rmd1.
œfm
, (R)->rmd1.
bam
, \

252 (
R
)->
rmd1
.
⁄es
, 4096-(R)->rmd1.
b˙t
, \

253 (
R
)->
rmd2
.
rcc
, (R)->rmd2.
Ωc
, (R)->rmd2.
m˙t
, \

254 (
R
)->
rmd2
.
zîos
)

	)

256 
ölöe
 
	$p˙ë_tmd_lﬂd
(
PCNëSèã
 *
s
, 
p˙ë_TMD
 *
tmd1
,

257 
èrgë_phys_addr_t
 
addr
)

259 
uöt32_t
 *
tmd
 = (uöt32_à*)
tmd1
;

261 i‡(!
	`BCR_SWSTYLE
(
s
)) {

262 
uöt16_t
 
xda
[4];

263 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, 
addr
,

264 (*)&
xda
[0], (xda), 0);

265 
	`À16_to_˝us
(&
xda
[0]);

266 
	`À16_to_˝us
(&
xda
[1]);

267 
	`À16_to_˝us
(&
xda
[2]);

268 
	`À16_to_˝us
(&
xda
[3]);

269 
tmd
[0] = (
xda
[0]&0xffff) |

270 ((
xda
[1]&0x00ff) << 16);

271 
tmd
[1] = (
xda
[2]&0xffff)|

272 ((
xda
[1] & 0xff00) << 16);

273 
tmd
[2] =

274 (
xda
[3] & 0xffff) << 16;

275 
tmd
[3] = 0;

277 
uöt32_t
 
xda
[4];

278 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, 
addr
,

279 (*)&
xda
[0], (xda), 0);

280 
	`À32_to_˝us
(&
xda
[0]);

281 
	`À32_to_˝us
(&
xda
[1]);

282 
	`À32_to_˝us
(&
xda
[2]);

283 
	`À32_to_˝us
(&
xda
[3]);

284 i‡(
	`BCR_SWSTYLE
(
s
) != 3) {

285 
	`mem˝y
(
tmd
, 
xda
, (xda));

287 
tmd
[0] = 
xda
[2];

288 
tmd
[1] = 
xda
[1];

289 
tmd
[2] = 
xda
[0];

290 
tmd
[3] = 
xda
[3];

293 
	}
}

295 
ölöe
 
	$p˙ë_tmd_°‹e
(
PCNëSèã
 *
s
, c⁄° 
p˙ë_TMD
 *
tmd1
,

296 
èrgë_phys_addr_t
 
addr
)

298 c⁄° 
uöt32_t
 *
tmd
 = (c⁄° uöt32_à*)
tmd1
;

299 i‡(!
	`BCR_SWSTYLE
(
s
)) {

300 
uöt16_t
 
xda
[4];

301 
xda
[0] = 
tmd
[0] & 0xffff;

302 
xda
[1] = ((
tmd
[0]>>16)&0x00ff) |

303 ((
tmd
[1]>>16)&0xff00);

304 
xda
[2] = 
tmd
[1] & 0xffff;

305 
xda
[3] = 
tmd
[2] >> 16;

306 
	`˝u_to_À16s
(&
xda
[0]);

307 
	`˝u_to_À16s
(&
xda
[1]);

308 
	`˝u_to_À16s
(&
xda
[2]);

309 
	`˝u_to_À16s
(&
xda
[3]);

310 
s
->
	`phys_mem_wrôe
(s->
dma_›aque
, 
addr
,

311 (*)&
xda
[0], (xda), 0);

313 
uöt32_t
 
xda
[4];

314 i‡(
	`BCR_SWSTYLE
(
s
) != 3) {

315 
	`mem˝y
(
xda
, 
tmd
, (xda));

317 
xda
[0] = 
tmd
[2];

318 
xda
[1] = 
tmd
[1];

319 
xda
[2] = 
tmd
[0];

320 
xda
[3] = 
tmd
[3];

322 
	`˝u_to_À32s
(&
xda
[0]);

323 
	`˝u_to_À32s
(&
xda
[1]);

324 
	`˝u_to_À32s
(&
xda
[2]);

325 
	`˝u_to_À32s
(&
xda
[3]);

326 
s
->
	`phys_mem_wrôe
(s->
dma_›aque
, 
addr
,

327 (*)&
xda
[0], (xda), 0);

329 
	}
}

331 
ölöe
 
	$p˙ë_rmd_lﬂd
(
PCNëSèã
 *
s
, 
p˙ë_RMD
 *
rmd1
,

332 
èrgë_phys_addr_t
 
addr
)

334 
uöt32_t
 *
rmd
 = (uöt32_à*)
rmd1
;

336 i‡(!
	`BCR_SWSTYLE
(
s
)) {

337 
uöt16_t
 
rda
[4];

338 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, 
addr
,

339 (*)&
rda
[0], (rda), 0);

340 
	`À16_to_˝us
(&
rda
[0]);

341 
	`À16_to_˝us
(&
rda
[1]);

342 
	`À16_to_˝us
(&
rda
[2]);

343 
	`À16_to_˝us
(&
rda
[3]);

344 
rmd
[0] = (
rda
[0]&0xffff)|

345 ((
rda
[1] & 0x00ff) << 16);

346 
rmd
[1] = (
rda
[2]&0xffff)|

347 ((
rda
[1] & 0xff00) << 16);

348 
rmd
[2] = 
rda
[3] & 0xffff;

349 
rmd
[3] = 0;

351 
uöt32_t
 
rda
[4];

352 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, 
addr
,

353 (*)&
rda
[0], (rda), 0);

354 
	`À32_to_˝us
(&
rda
[0]);

355 
	`À32_to_˝us
(&
rda
[1]);

356 
	`À32_to_˝us
(&
rda
[2]);

357 
	`À32_to_˝us
(&
rda
[3]);

358 i‡(
	`BCR_SWSTYLE
(
s
) != 3) {

359 
	`mem˝y
(
rmd
, 
rda
, (rda));

361 
rmd
[0] = 
rda
[2];

362 
rmd
[1] = 
rda
[1];

363 
rmd
[2] = 
rda
[0];

364 
rmd
[3] = 
rda
[3];

367 
	}
}

369 
ölöe
 
	$p˙ë_rmd_°‹e
(
PCNëSèã
 *
s
, 
p˙ë_RMD
 *
rmd1
,

370 
èrgë_phys_addr_t
 
addr
)

372 c⁄° 
uöt32_t
 *
rmd
 = (c⁄° uöt32_à*)
rmd1
;

374 i‡(!
	`BCR_SWSTYLE
(
s
)) {

375 
uöt16_t
 
rda
[4];

376 
rda
[0] = 
rmd
[0] & 0xffff;

377 
rda
[1] = ((
rmd
[0]>>16)&0xff)|

378 ((
rmd
[1]>>16)&0xff00);

379 
rda
[2] = 
rmd
[1] & 0xffff;

380 
rda
[3] = 
rmd
[2] & 0xffff;

381 
	`˝u_to_À16s
(&
rda
[0]);

382 
	`˝u_to_À16s
(&
rda
[1]);

383 
	`˝u_to_À16s
(&
rda
[2]);

384 
	`˝u_to_À16s
(&
rda
[3]);

385 
s
->
	`phys_mem_wrôe
(s->
dma_›aque
, 
addr
,

386 (*)&
rda
[0], (rda), 0);

388 
uöt32_t
 
rda
[4];

389 i‡(
	`BCR_SWSTYLE
(
s
) != 3) {

390 
	`mem˝y
(
rda
, 
rmd
, (rda));

392 
rda
[0] = 
rmd
[2];

393 
rda
[1] = 
rmd
[1];

394 
rda
[2] = 
rmd
[0];

395 
rda
[3] = 
rmd
[3];

397 
	`˝u_to_À32s
(&
rda
[0]);

398 
	`˝u_to_À32s
(&
rda
[1]);

399 
	`˝u_to_À32s
(&
rda
[2]);

400 
	`˝u_to_À32s
(&
rda
[3]);

401 
s
->
	`phys_mem_wrôe
(s->
dma_›aque
, 
addr
,

402 (*)&
rda
[0], (rda), 0);

404 
	}
}

407 
	#TMDLOAD
(
TMD
,
ADDR
Ë
	`p˙ë_tmd_lﬂd
(
s
,TMD,ADDR)

	)

409 
	#TMDSTORE
(
TMD
,
ADDR
Ë
	`p˙ë_tmd_°‹e
(
s
,TMD,ADDR)

	)

411 
	#RMDLOAD
(
RMD
,
ADDR
Ë
	`p˙ë_rmd_lﬂd
(
s
,RMD,ADDR)

	)

413 
	#RMDSTORE
(
RMD
,
ADDR
Ë
	`p˙ë_rmd_°‹e
(
s
,RMD,ADDR)

	)

417 
	#CHECK_RMD
(
ADDR
,
RES
) do { \

418 
p˙ë_RMD
 
rmd
; \

419 
	`RMDLOAD
(&
rmd
,(
ADDR
)); \

420 (
RES
Ë|(
rmd
.
rmd1
.
⁄es
 != 15) \

421 || (
rmd
.
rmd2
.
zîos
 != 0); \

422 } 0)

	)

424 
	#CHECK_TMD
(
ADDR
,
RES
) do { \

425 
p˙ë_TMD
 
tmd
; \

426 
	`TMDLOAD
(&
tmd
,(
ADDR
)); \

427 (
RES
Ë|(
tmd
.
tmd1
.
⁄es
 != 15); \

428 } 0)

	)

432 
	#CHECK_RMD
(
ADDR
,
RES
) do { \

433 
	`BCR_SWSTYLE
(
s
)) { \

436 
uöt16_t
 
rda
[4]; \

437 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, (
ADDR
), \

438 (*)&
rda
[0], (rda), 0); \

439 (
RES
Ë|(
rda
[2] & 0xf000)!=0xf000; \

440 (
RES
Ë|(
rda
[3] & 0xf000)!=0x0000; \

446 
uöt32_t
 
rda
[4]; \

447 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, (
ADDR
), \

448 (*)&
rda
[0], (rda), 0); \

449 (
RES
Ë|(
rda
[1] & 0x0000f000L)!=0x0000f000L; \

450 (
RES
Ë|(
rda
[2] & 0x0000f000L)!=0x00000000L; \

455 
uöt32_t
 
rda
[4]; \

456 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, (
ADDR
), \

457 (*)&
rda
[0], (rda), 0); \

458 (
RES
Ë|(
rda
[0] & 0x0000f000L)!=0x00000000L; \

459 (
RES
Ë|(
rda
[1] & 0x0000f000L)!=0x0000f000L; \

463 } 0)

	)

465 
	#CHECK_TMD
(
ADDR
,
RES
) do { \

466 
	`BCR_SWSTYLE
(
s
)) { \

469 
uöt16_t
 
xda
[4]; \

470 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, (
ADDR
), \

471 (*)&
xda
[0], (xda), 0); \

472 (
RES
Ë|(
xda
[2] & 0xf000)!=0xf000;\

479 
uöt32_t
 
xda
[4]; \

480 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, (
ADDR
), \

481 (*)&
xda
[0], (xda), 0); \

482 (
RES
Ë|(
xda
[1] & 0x0000f000L)!=0x0000f000L; \

486 } 0)

	)

490 
	#PRINT_PKTHDR
(
BUF
) do { \

491 
qemu_ëhî_hódî
 *
hdr
 = (*)(
BUF
); \

492 
	`¥ötf
("packet dhost=%02x:%02x:%02x:%02x:%02x:%02x, " \

495 
hdr
->
ëhî_dho°
[0],hdr->ether_dhost[1],hdr->ether_dhost[2], \

496 
hdr
->
ëhî_dho°
[3],hdr->ether_dhost[4],hdr->ether_dhost[5], \

497 
hdr
->
ëhî_sho°
[0],hdr->ether_shost[1],hdr->ether_shost[2], \

498 
hdr
->
ëhî_sho°
[3],hdr->ether_shost[4],hdr->ether_shost[5], \

499 
	`be16_to_˝u
(
hdr
->
ëhî_ty≥
)); \

500 } 0)

	)

502 
	#MULTICAST_FILTER_LEN
 8

	)

504 
ölöe
 
uöt32_t
 
	$ c_mchash
(c⁄° 
uöt8_t
 *
ëhî_addr
)

506 
	#LNC_POLYNOMIAL
 0xEDB88320UL

	)

507 
uöt32_t
 
¸c
 = 0xFFFFFFFF;

508 
idx
, 
bô
;

509 
uöt8_t
 
d©a
;

511 
idx
 = 0; idx < 6; idx++) {

512 
d©a
 = *
ëhî_addr
++, 
bô
 = 0; bô < 
MULTICAST_FILTER_LEN
; bit++) {

513 
¸c
 = (¸¯>> 1Ë^ (((¸¯^ 
d©a
Ë& 1Ë? 
LNC_POLYNOMIAL
 : 0);

514 
d©a
 >>= 1;

517  
¸c
;

518 #unde‡
LNC_POLYNOMIAL


519 
	}
}

521 
	#CRC
(
¸c
, 
ch
Ë(¸¯(¸¯>> 8Ë^ 
¸˘ab
[(¸¯^ (ch)Ë& 0xff])

	)

527 c⁄° 
uöt32_t
 
	g¸˘ab
[256] = {

594 
ölöe
 
	$∑dr_m©ch
(
PCNëSèã
 *
s
, c⁄° 
uöt8_t
 *
buf
, 
size
)

596 
qemu_ëhî_hódî
 *
hdr
 = (*)
buf
;

597 
uöt8_t
 
∑dr
[6] = {

598 
s
->
c§
[12] & 0xff, s->csr[12] >> 8,

599 
s
->
c§
[13] & 0xff, s->csr[13] >> 8,

600 
s
->
c§
[14] & 0xff, s->csr[14] >> 8

602 
ªsu…
 = (!
	`CSR_DRCVPA
(
s
)Ë&& !
	`memcmp
(
hdr
->
ëhî_dho°
, 
∑dr
, 6);

603 #ifde‡
PCNET_DEBUG_MATCH


604 
	`¥ötf
("packet dhost=%02x:%02x:%02x:%02x:%02x:%02x, "

606 
hdr
->
ëhî_dho°
[0],hdr->ether_dhost[1],hdr->ether_dhost[2],

607 
hdr
->
ëhî_dho°
[3],hdr->ether_dhost[4],hdr->ether_dhost[5],

608 
∑dr
[0],padr[1],padr[2],padr[3],padr[4],padr[5]);

609 
	`¥ötf
("∑dr_m©chÑesu…=%d\n", 
ªsu…
);

611  
ªsu…
;

612 
	}
}

614 
ölöe
 
	$∑dr_bˇ°
(
PCNëSèã
 *
s
, c⁄° 
uöt8_t
 *
buf
, 
size
)

616 c⁄° 
uöt8_t
 
BCAST
[6] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

617 
qemu_ëhî_hódî
 *
hdr
 = (*)
buf
;

618 
ªsu…
 = !
	`CSR_DRCVBC
(
s
Ë&& !
	`memcmp
(
hdr
->
ëhî_dho°
, 
BCAST
, 6);

619 #ifde‡
PCNET_DEBUG_MATCH


620 
	`¥ötf
("∑dr_bˇ°Ñesu…=%d\n", 
ªsu…
);

622  
ªsu…
;

623 
	}
}

625 
ölöe
 
	$œdr_m©ch
(
PCNëSèã
 *
s
, c⁄° 
uöt8_t
 *
buf
, 
size
)

627 
qemu_ëhî_hódî
 *
hdr
 = (*)
buf
;

628 i‡((*(
hdr
->
ëhî_dho°
)&0x01) &&

629 ((
uöt64_t
 *)&
s
->
c§
[8])[0] != 0LL) {

630 
uöt8_t
 
œdr
[8] = {

631 
s
->
c§
[8] & 0xff, s->csr[8] >> 8,

632 
s
->
c§
[9] & 0xff, s->csr[9] >> 8,

633 
s
->
c§
[10] & 0xff, s->csr[10] >> 8,

634 
s
->
c§
[11] & 0xff, s->csr[11] >> 8

636 
ödex
 = 
	` c_mchash
(
hdr
->
ëhî_dho°
) >> 26;

637  !!(
œdr
[
ödex
 >> 3] & (1 << (index & 7)));

640 
	}
}

642 
ölöe
 
èrgë_phys_addr_t
 
	$p˙ë_rdø_addr
(
PCNëSèã
 *
s
, 
idx
)

644 
idx
 < 1Ëidx +
	`CSR_RCVRL
(
s
);

645  
s
->
rdø
 + ((
	`CSR_RCVRL
(sË- 
idx
Ë* (
	`BCR_SWSTYLE
(s) ? 16 : 8));

646 
	}
}

648 
ölöe
 
öt64_t
 
	$p˙ë_gë_√xt_pﬁl_time
(
PCNëSèã
 *
s
, 
öt64_t
 
cuºít_time
)

650 
öt64_t
 
√xt_time
 = 
cuºít_time
 +

651 
	`muldiv64
(65536 - (
	`CSR_SPND
(
s
Ë? 0 : 
	`CSR_POLL
(s)),

652 
ticks_≥r_£c
, 33000000L);

653 i‡(
√xt_time
 <
cuºít_time
)

654 
√xt_time
 = 
cuºít_time
 + 1;

655  
√xt_time
;

656 
	}
}

658 
p˙ë_pﬁl
(
PCNëSèã
 *
s
);

659 
p˙ë_pﬁl_timî
(*
›aque
);

661 
uöt32_t
 
p˙ë_c§_ªadw
(
PCNëSèã
 *
s
, uöt32_à
øp
);

662 
p˙ë_c§_wrôew
(
PCNëSèã
 *
s
, 
uöt32_t
 
øp
, uöt32_à
√w_vÆue
);

663 
p˙ë_b¸_wrôew
(
PCNëSèã
 *
s
, 
uöt32_t
 
øp
, uöt32_à
vÆ
);

664 
uöt32_t
 
p˙ë_b¸_ªadw
(
PCNëSèã
 *
s
, uöt32_à
øp
);

666 
	$p˙ë_s_ª£t
(
PCNëSèã
 *
s
)

668 #ifde‡
PCNET_DEBUG


669 
	`¥ötf
("pcnet_s_reset\n");

672 
s
->
 k°
 = 0x40;

673 
s
->
rdø
 = 0;

674 
s
->
tdø
 = 0;

675 
s
->
øp
 = 0;

677 
s
->
b¸
[
BCR_BSBC
] &= ~0x0080;

679 
s
->
c§
[0] = 0x0004;

680 
s
->
c§
[3] = 0x0000;

681 
s
->
c§
[4] = 0x0115;

682 
s
->
c§
[5] = 0x0000;

683 
s
->
c§
[6] = 0x0000;

684 
s
->
c§
[8] = 0;

685 
s
->
c§
[9] = 0;

686 
s
->
c§
[10] = 0;

687 
s
->
c§
[11] = 0;

688 
s
->
c§
[12] = 
	`À16_to_˝u
(((
uöt16_t
 *)&s->
¥om
[0])[0]);

689 
s
->
c§
[13] = 
	`À16_to_˝u
(((
uöt16_t
 *)&s->
¥om
[0])[1]);

690 
s
->
c§
[14] = 
	`À16_to_˝u
(((
uöt16_t
 *)&s->
¥om
[0])[2]);

691 
s
->
c§
[15] &= 0x21c4;

692 
s
->
c§
[72] = 1;

693 
s
->
c§
[74] = 1;

694 
s
->
c§
[76] = 1;

695 
s
->
c§
[78] = 1;

696 
s
->
c§
[80] = 0x1410;

697 
s
->
c§
[88] = 0x1003;

698 
s
->
c§
[89] = 0x0262;

699 
s
->
c§
[94] = 0x0000;

700 
s
->
c§
[100] = 0x0200;

701 
s
->
c§
[103] = 0x0105;

702 
s
->
c§
[103] = 0x0105;

703 
s
->
c§
[112] = 0x0000;

704 
s
->
c§
[114] = 0x0000;

705 
s
->
c§
[122] = 0x0000;

706 
s
->
c§
[124] = 0x0000;

708 
s
->
tx_busy
 = 0;

709 
	}
}

711 
	$p˙ë_upd©e_úq
(
PCNëSèã
 *
s
)

713 
i§
 = 0;

714 
s
->
c§
[0] &= ~0x0080;

717 i‡(((
s
->
c§
[0] & ~s->csr[3]) & 0x5f00) ||

718 (((
s
->
c§
[4]>>1) & ~s->csr[4]) & 0x0115) ||

719 (((
s
->
c§
[5]>>1) & s->csr[5]) & 0x0048))

721 i‡((!(
s
->
c§
[3] & 0x4000) && !!(s->csr[0] & 0x4000)) ||

722 (!(
s
->
c§
[3] & 0x1000) && !!(s->csr[0] & 0x1000)) ||

723 (!(
s
->
c§
[3] & 0x0100) && !!(s->csr[0] & 0x0100)) ||

724 (!(
s
->
c§
[3] & 0x0200) && !!(s->csr[0] & 0x0200)) ||

725 (!(
s
->
c§
[3] & 0x0400) && !!(s->csr[0] & 0x0400)) ||

726 (!(
s
->
c§
[3] & 0x0800) && !!(s->csr[0] & 0x0800)) ||

727 (!(
s
->
c§
[4] & 0x0001) && !!(s->csr[4] & 0x0002)) ||

728 (!(
s
->
c§
[4] & 0x0004) && !!(s->csr[4] & 0x0008)) ||

729 (!(
s
->
c§
[4] & 0x0010) && !!(s->csr[4] & 0x0020)) ||

730 (!(
s
->
c§
[4] & 0x0100) && !!(s->csr[4] & 0x0200)) ||

731 (!!(
s
->
c§
[5] & 0x0040) && !!(s->csr[5] & 0x0080)) ||

732 (!!(
s
->
c§
[5] & 0x0008) && !!(s->csr[5] & 0x0010)) )

736 
i§
 = 
	`CSR_INEA
(
s
);

737 
s
->
c§
[0] |= 0x0080;

740 i‡(!!(
s
->
c§
[4] & 0x0080Ë&& 
	`CSR_INEA
(s)) {

741 
s
->
c§
[4] &= ~0x0080;

742 
s
->
c§
[4] |= 0x0040;

743 
s
->
c§
[0] |= 0x0080;

744 
i§
 = 1;

745 #ifde‡
PCNET_DEBUG


746 
	`¥ötf
("pcnet user int\n");

751 i‡(((
s
->
c§
[5]>>1) & s->csr[5]) & 0x0500)

753 i‡((!!(
s
->
c§
[5] & 0x0400) && !!(s->csr[5] & 0x0800)) ||

754 (!!(
s
->
c§
[5] & 0x0100) && !!(s->csr[5] & 0x0200)) )

757 
i§
 = 1;

758 
s
->
c§
[0] |= 0x0080;

761 i‡(
i§
 !
s
->isr) {

762 #ifde‡
PCNET_DEBUG


763 
	`¥ötf
("p˙ë: INTA=%d\n", 
i§
);

766 
s
->
	`£t_úq_cb
(s, 
i§
);

767 
s
->
i§
 = isr;

768 
	}
}

770 
	$p˙ë_öô
(
PCNëSèã
 *
s
)

772 
æí
, 
éí
;

773 
uöt16_t
 *
∑dr
, *
œdrf
, 
mode
;

774 
uöt32_t
 
rdø
, 
tdø
;

776 #ifde‡
PCNET_DEBUG


777 
	`¥ötf
("p˙ë_öô inô_addr=0x%08x\n", 
	`PHYSADDR
(
s
,
	`CSR_IADR
(s)));

780 i‡(
	`BCR_SSIZE32
(
s
)) {

781 
p˙ë_öôblk32
 
öôblk
;

782 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, 
	`PHYSADDR
(s,
	`CSR_IADR
(s)),

783 (
uöt8_t
 *)&
öôblk
, (initblk), 0);

784 
mode
 = 
öôblk
.mode;

785 
æí
 = 
öôblk
.rlen >> 4;

786 
éí
 = 
öôblk
.tlen >> 4;

787 
œdrf
 = 
öôblk
.ladrf;

788 
∑dr
 = 
öôblk
.padr;

789 
rdø
 = 
	`À32_to_˝u
(
öôblk
.rdra);

790 
tdø
 = 
	`À32_to_˝u
(
öôblk
.tdra);

791 
s
->
rdø
 = 
	`PHYSADDR
(s,
öôblk
.rdra);

792 
s
->
tdø
 = 
	`PHYSADDR
(s,
öôblk
.tdra);

794 
p˙ë_öôblk16
 
öôblk
;

795 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, 
	`PHYSADDR
(s,
	`CSR_IADR
(s)),

796 (
uöt8_t
 *)&
öôblk
, (initblk), 0);

797 
mode
 = 
öôblk
.mode;

798 
œdrf
 = 
öôblk
.ladrf;

799 
∑dr
 = 
öôblk
.padr;

800 
rdø
 = 
	`À32_to_˝u
(
öôblk
.rdra);

801 
tdø
 = 
	`À32_to_˝u
(
öôblk
.tdra);

802 
æí
 = 
rdø
 >> 29;

803 
éí
 = 
tdø
 >> 29;

804 
rdø
 &= 0x00ffffff;

805 
tdø
 &= 0x00ffffff;

808 #i‡
	`deföed
(
PCNET_DEBUG
)

809 
	`¥ötf
("rlen=%dÅlen=%d\n",

810 
æí
, 
éí
);

812 
	`CSR_RCVRL
(
s
Ë(
æí
 < 9) ? (1 <<Ñlen) : 512;

813 
	`CSR_XMTRL
(
s
Ë(
éí
 < 9) ? (1 <<Ålen) : 512;

814 
s
->
c§
[ 6] = (
éí
 << 12Ë| (
æí
 << 8);

815 
s
->
c§
[15] = 
	`À16_to_˝u
(
mode
);

816 
s
->
c§
[ 8] = 
	`À16_to_˝u
(
œdrf
[0]);

817 
s
->
c§
[ 9] = 
	`À16_to_˝u
(
œdrf
[1]);

818 
s
->
c§
[10] = 
	`À16_to_˝u
(
œdrf
[2]);

819 
s
->
c§
[11] = 
	`À16_to_˝u
(
œdrf
[3]);

820 
s
->
c§
[12] = 
	`À16_to_˝u
(
∑dr
[0]);

821 
s
->
c§
[13] = 
	`À16_to_˝u
(
∑dr
[1]);

822 
s
->
c§
[14] = 
	`À16_to_˝u
(
∑dr
[2]);

823 
s
->
rdø
 = 
	`PHYSADDR
(s,Ñdra);

824 
s
->
tdø
 = 
	`PHYSADDR
(s,Ådra);

826 
	`CSR_RCVRC
(
s
Ë
	`CSR_RCVRL
(s);

827 
	`CSR_XMTRC
(
s
Ë
	`CSR_XMTRL
(s);

829 #ifde‡
PCNET_DEBUG


830 
	`¥ötf
("pcnet ss32=%dÑdra=0x%08x[%d]Ådra=0x%08x[%d]\n",

831 
	`BCR_SSIZE32
(
s
),

832 
s
->
rdø
, 
	`CSR_RCVRL
(s), s->
tdø
, 
	`CSR_XMTRL
(s));

835 
s
->
c§
[0] |= 0x0101;

836 
s
->
c§
[0] &= ~0x0004;

837 
	}
}

839 
	$p˙ë_°¨t
(
PCNëSèã
 *
s
)

841 #ifde‡
PCNET_DEBUG


842 
	`¥ötf
("pcnet_start\n");

845 i‡(!
	`CSR_DTX
(
s
))

846 
s
->
c§
[0] |= 0x0010;

848 i‡(!
	`CSR_DRX
(
s
))

849 
s
->
c§
[0] |= 0x0020;

851 
s
->
c§
[0] &= ~0x0004;

852 
s
->
c§
[0] |= 0x0002;

853 
	}
}

855 
	$p˙ë_°›
(
PCNëSèã
 *
s
)

857 #ifde‡
PCNET_DEBUG


858 
	`¥ötf
("pcnet_stop\n");

860 
s
->
c§
[0] &= ~0x7feb;

861 
s
->
c§
[0] |= 0x0014;

862 
s
->
c§
[4] &= ~0x02c2;

863 
s
->
c§
[5] &= ~0x0011;

864 
	`p˙ë_pﬁl_timî
(
s
);

865 
	}
}

867 
	$p˙ë_rdã_pﬁl
(
PCNëSèã
 *
s
)

869 
s
->
c§
[28] = s->csr[29] = 0;

870 i‡(
s
->
rdø
) {

871 
bad
 = 0;

873 
èrgë_phys_addr_t
 
¸da
 = 
	`p˙ë_rdø_addr
(
s
, 
	`CSR_RCVRC
(s));

874 
èrgë_phys_addr_t
 
ƒda
 = 
	`p˙ë_rdø_addr
(
s
, -1 + 
	`CSR_RCVRC
(s));

875 
èrgë_phys_addr_t
 
¬rd
 = 
	`p˙ë_rdø_addr
(
s
, -2 + 
	`CSR_RCVRC
(s));

877 
èrgë_phys_addr_t
 
¸da
 = 
s
->
rdø
 +

878 (
	`CSR_RCVRL
(
s
Ë- 
	`CSR_RCVRC
(s)) *

879 (
	`BCR_SWSTYLE
(
s
) ? 16 : 8 );

880 
ƒdc
 = 
	`CSR_RCVRC
(
s
)<=1 ? 
	`CSR_RCVRL
(s) : CSR_RCVRC(s)-1;

881 
èrgë_phys_addr_t
 
ƒda
 = 
s
->
rdø
 +

882 (
	`CSR_RCVRL
(
s
Ë- 
ƒdc
) *

883 (
	`BCR_SWSTYLE
(
s
) ? 16 : 8 );

884 
¬rc
 = 
ƒdc
<=1 ? 
	`CSR_RCVRL
(
s
) :Çrdc-1;

885 
èrgë_phys_addr_t
 
¬rd
 = 
s
->
rdø
 +

886 (
	`CSR_RCVRL
(
s
Ë- 
¬rc
) *

887 (
	`BCR_SWSTYLE
(
s
) ? 16 : 8 );

890 
	`CHECK_RMD
(
	`PHYSADDR
(
s
,
¸da
), 
bad
);

891 i‡(!
bad
) {

892 
	`CHECK_RMD
(
	`PHYSADDR
(
s
,
ƒda
), 
bad
);

893 i‡(
bad
 || (
ƒda
 =
¸da
))Çrda = 0;

894 
	`CHECK_RMD
(
	`PHYSADDR
(
s
,
¬rd
), 
bad
);

895 i‡(
bad
 || (
¬rd
 =
¸da
))Çnrd = 0;

897 
s
->
c§
[28] = 
¸da
 & 0xffff;

898 
s
->
c§
[29] = 
¸da
 >> 16;

899 
s
->
c§
[26] = 
ƒda
 & 0xffff;

900 
s
->
c§
[27] = 
ƒda
 >> 16;

901 
s
->
c§
[36] = 
¬rd
 & 0xffff;

902 
s
->
c§
[37] = 
¬rd
 >> 16;

903 #ifde‡
PCNET_DEBUG


904 i‡(
bad
) {

905 
	`¥ötf
("pcnet: BAD RMD RECORDS AFTER 0x%08x\n",

906 
	`PHYSADDR
(
s
,
¸da
));

909 
	`¥ötf
("p˙ë: BAD RMD RDA=0x%08x\n", 
	`PHYSADDR
(
s
,
¸da
));

914 i‡(
	`CSR_CRDA
(
s
)) {

915 
p˙ë_RMD
 
rmd
;

916 
	`RMDLOAD
(&
rmd
, 
	`PHYSADDR
(
s
,
	`CSR_CRDA
(s)));

917 
	`CSR_CRBC
(
s
Ë
rmd
.
rmd1
.
b˙t
;

918 
	`CSR_CRST
(
s
Ë((
uöt32_t
 *)&
rmd
)[1] >> 16;

919 #ifde‡
PCNET_DEBUG_RMD_X


920 
	`¥ötf
("CRDA=0x%08x CRST=0x%04x RCVRC=%d RMD1=0x%08x RMD2=0x%08x\n",

921 
	`PHYSADDR
(
s
,
	`CSR_CRDA
(s)), 
	`CSR_CRST
(s), 
	`CSR_RCVRC
(s),

922 ((
uöt32_t
 *)&
rmd
)[1], ((uint32_t *)&rmd)[2]);

923 
	`PRINT_RMD
(&
rmd
);

926 
	`CSR_CRBC
(
s
Ë
	`CSR_CRST
(s) = 0;

929 i‡(
	`CSR_NRDA
(
s
)) {

930 
p˙ë_RMD
 
rmd
;

931 
	`RMDLOAD
(&
rmd
, 
	`PHYSADDR
(
s
,
	`CSR_NRDA
(s)));

932 
	`CSR_NRBC
(
s
Ë
rmd
.
rmd1
.
b˙t
;

933 
	`CSR_NRST
(
s
Ë((
uöt32_t
 *)&
rmd
)[1] >> 16;

935 
	`CSR_NRBC
(
s
Ë
	`CSR_NRST
(s) = 0;

938 
	}
}

940 
	$p˙ë_tdã_pﬁl
(
PCNëSèã
 *
s
)

942 
s
->
c§
[34] = s->csr[35] = 0;

943 i‡(
s
->
tdø
) {

944 
èrgë_phys_addr_t
 
cxda
 = 
s
->
tdø
 +

945 (
	`CSR_XMTRL
(
s
Ë- 
	`CSR_XMTRC
(s)) *

946 (
	`BCR_SWSTYLE
(
s
) ? 16 : 8 );

947 
bad
 = 0;

948 
	`CHECK_TMD
(
	`PHYSADDR
(
s
, 
cxda
),
bad
);

949 i‡(!
bad
) {

950 i‡(
	`CSR_CXDA
(
s
Ë!
cxda
) {

951 
s
->
c§
[60] = s->csr[34];

952 
s
->
c§
[61] = s->csr[35];

953 
s
->
c§
[62] = 
	`CSR_CXBC
(s);

954 
s
->
c§
[63] = 
	`CSR_CXST
(s);

956 
s
->
c§
[34] = 
cxda
 & 0xffff;

957 
s
->
c§
[35] = 
cxda
 >> 16;

958 #ifde‡
PCNET_DEBUG


960 
	`¥ötf
("p˙ë: BAD TMD XDA=0x%08x\n", 
	`PHYSADDR
(
s
,
cxda
));

965 i‡(
	`CSR_CXDA
(
s
)) {

966 
p˙ë_TMD
 
tmd
;

968 
	`TMDLOAD
(&
tmd
, 
	`PHYSADDR
(
s
,
	`CSR_CXDA
(s)));

970 
	`CSR_CXBC
(
s
Ë
tmd
.
tmd1
.
b˙t
;

971 
	`CSR_CXST
(
s
Ë((
uöt32_t
 *)&
tmd
)[1] >> 16;

973 
	`CSR_CXBC
(
s
Ë
	`CSR_CXST
(s) = 0;

976  !!(
	`CSR_CXST
(
s
) & 0x8000);

977 
	}
}

979 
	$p˙ë_ˇn_ª˚ive
(*
›aque
)

981 
PCNëSèã
 *
s
 = 
›aque
;

982 i‡(
	`CSR_STOP
(
s
Ë|| 
	`CSR_SPND
(s))

985 i‡(
s
->
ªcv_pos
 > 0)

988  (
s
->
buf„r
)-16;

989 
	}
}

991 
	#MIN_BUF_SIZE
 60

	)

993 
	$p˙ë_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
size
)

995 
PCNëSèã
 *
s
 = 
›aque
;

996 
is_∑dr
 = 0, 
is_bˇ°
 = 0, 
is_œdr
 = 0;

997 
uöt8_t
 
buf1
[60];

999 i‡(
	`CSR_DRX
(
s
Ë|| 
	`CSR_STOP
(sË|| 
	`CSR_SPND
(sË|| !
size
)

1002 #ifde‡
PCNET_DEBUG


1003 
	`¥ötf
("p˙ë_ª˚ivêsize=%d\n", 
size
);

1007 i‡(
size
 < 
MIN_BUF_SIZE
) {

1008 
	`mem˝y
(
buf1
, 
buf
, 
size
);

1009 
	`mem£t
(
buf1
 + 
size
, 0, 
MIN_BUF_SIZE
 - size);

1010 
buf
 = 
buf1
;

1011 
size
 = 
MIN_BUF_SIZE
;

1014 i‡(
	`CSR_PROM
(
s
)

1015 || (
is_∑dr
=
	`∑dr_m©ch
(
s
, 
buf
, 
size
))

1016 || (
is_bˇ°
=
	`∑dr_bˇ°
(
s
, 
buf
, 
size
))

1017 || (
is_œdr
=
	`œdr_m©ch
(
s
, 
buf
, 
size
))) {

1019 
	`p˙ë_rdã_pﬁl
(
s
);

1021 i‡(!(
	`CSR_CRST
(
s
Ë& 0x8000Ë&& s->
rdø
) {

1022 
p˙ë_RMD
 
rmd
;

1023 
rcvrc
 = 
	`CSR_RCVRC
(
s
)-1,
i
;

1024 
èrgë_phys_addr_t
 
ƒda
;

1025 
i
 = 
	`CSR_RCVRL
(
s
)-1; i > 0; i--, 
rcvrc
--) {

1026 i‡(
rcvrc
 <= 1)

1027 
rcvrc
 = 
	`CSR_RCVRL
(
s
);

1028 
ƒda
 = 
s
->
rdø
 +

1029 (
	`CSR_RCVRL
(
s
Ë- 
rcvrc
) *

1030 (
	`BCR_SWSTYLE
(
s
) ? 16 : 8 );

1031 
	`RMDLOAD
(&
rmd
, 
	`PHYSADDR
(
s
,
ƒda
));

1032 i‡(
rmd
.
rmd1
.
own
) {

1033 #ifde‡
PCNET_DEBUG_RMD


1034 
	`¥ötf
("pcnet - scan buffer: RCVRC=%d PREV_RCVRC=%d\n",

1035 
rcvrc
, 
	`CSR_RCVRC
(
s
));

1037 
	`CSR_RCVRC
(
s
Ë
rcvrc
;

1038 
	`p˙ë_rdã_pﬁl
(
s
);

1044 i‡(!(
	`CSR_CRST
(
s
) & 0x8000)) {

1045 #ifde‡
PCNET_DEBUG_RMD


1046 
	`¥ötf
("p˙ë -Çÿbuf„r: RCVRC=%d\n", 
	`CSR_RCVRC
(
s
));

1048 
s
->
c§
[0] |= 0x1000;

1049 
	`CSR_MISSC
(
s
)++;

1051 
uöt8_t
 *
§c
 = &
s
->
buf„r
[8];

1052 
èrgë_phys_addr_t
 
¸da
 = 
	`CSR_CRDA
(
s
);

1053 
p˙ë_RMD
 
rmd
;

1054 
pktcou¡
 = 0;

1056 
	`mem˝y
(
§c
, 
buf
, 
size
);

1060 
§c
[
size
] = 0;

1061 
§c
[
size
 + 1] = 0;

1062 
§c
[
size
 + 2] = 0;

1063 
§c
[
size
 + 3] = 0;

1064 
size
 += 4;

1067 i‡(!
	`CSR_ASTRP_RCV
(
s
)) {

1068 
uöt32_t
 
fcs
 = ~0;

1069 
uöt8_t
 *
p
 = 
§c
;

1071 
size
 < 46) {

1072 
§c
[
size
++] = 0;

1075 
p
 !&
§c
[
size
]) {

1076 
	`CRC
(
fcs
, *
p
++);

1078 ((
uöt32_t
 *)&
§c
[
size
])[0] = 
	`ht⁄l
(
fcs
);

1079 
size
 += 4;

1080 } 
size
 += 4;

1083 #ifde‡
PCNET_DEBUG_MATCH


1084 
	`PRINT_PKTHDR
(
buf
);

1087 
	`RMDLOAD
(&
rmd
, 
	`PHYSADDR
(
s
,
¸da
));

1089 
rmd
.
rmd1
.
°p
 = 1;

1091 
	#PCNET_RECV_STORE
() do { \

1092 
cou¡
 = 
	`MIN
(4096 - 
rmd
.
rmd1
.
b˙t
,
size
); \

1093 
èrgë_phys_addr_t
 
rbadr
 = 
	`PHYSADDR
(
s
, 
rmd
.
rmd0
.rbadr); \

1094 
s
->
	`phys_mem_wrôe
(s->
dma_›aque
, 
rbadr
, 
§c
, 
cou¡
, 
	`CSR_BSWP
(s)); \

1095 
§c
 +
cou¡
; 
size
 -= count; \

1096 
rmd
.
rmd2
.
m˙t
 = 
cou¡
;Ñmd.
rmd1
.
own
 = 0; \

1097 
	`RMDSTORE
(&
rmd
, 
	`PHYSADDR
(
s
,
¸da
)); \

1098 
pktcou¡
++; \

1099 } 0)

	)

1101 
	`PCNET_RECV_STORE
();

1102 i‡((
size
 > 0Ë&& 
	`CSR_NRDA
(
s
)) {

1103 
èrgë_phys_addr_t
 
ƒda
 = 
	`CSR_NRDA
(
s
);

1104 
	`RMDLOAD
(&
rmd
, 
	`PHYSADDR
(
s
,
ƒda
));

1105 i‡(
rmd
.
rmd1
.
own
) {

1106 
¸da
 = 
ƒda
;

1107 
	`PCNET_RECV_STORE
();

1108 i‡((
size
 > 0Ë&& (
ƒda
=
	`CSR_NNRD
(
s
))) {

1109 
	`RMDLOAD
(&
rmd
, 
	`PHYSADDR
(
s
,
ƒda
));

1110 i‡(
rmd
.
rmd1
.
own
) {

1111 
¸da
 = 
ƒda
;

1112 
	`PCNET_RECV_STORE
();

1118 #unde‡
PCNET_RECV_STORE


1120 
	`RMDLOAD
(&
rmd
, 
	`PHYSADDR
(
s
,
¸da
));

1121 i‡(
size
 == 0) {

1122 
rmd
.
rmd1
.
íp
 = 1;

1123 
rmd
.
rmd1
.
∑m
 = !
	`CSR_PROM
(
s
Ë&& 
is_∑dr
;

1124 
rmd
.
rmd1
.
œfm
 = !
	`CSR_PROM
(
s
Ë&& 
is_œdr
;

1125 
rmd
.
rmd1
.
bam
 = !
	`CSR_PROM
(
s
Ë&& 
is_bˇ°
;

1127 
rmd
.
rmd1
.
oÊo
 = 1;

1128 
rmd
.
rmd1
.
buff
 = 1;

1129 
rmd
.
rmd1
.
îr
 = 1;

1131 
	`RMDSTORE
(&
rmd
, 
	`PHYSADDR
(
s
,
¸da
));

1132 
s
->
c§
[0] |= 0x0400;

1134 #ifde‡
PCNET_DEBUG


1135 
	`¥ötf
("RCVRC=%d CRDA=0x%08x BLKS=%d\n",

1136 
	`CSR_RCVRC
(
s
), 
	`PHYSADDR
(s,
	`CSR_CRDA
(s)), 
pktcou¡
);

1138 #ifde‡
PCNET_DEBUG_RMD


1139 
	`PRINT_RMD
(&
rmd
);

1142 
pktcou¡
--) {

1143 i‡(
	`CSR_RCVRC
(
s
) <= 1)

1144 
	`CSR_RCVRC
(
s
Ë
	`CSR_RCVRL
(s);

1146 
	`CSR_RCVRC
(
s
)--;

1149 
	`p˙ë_rdã_pﬁl
(
s
);

1154 
	`p˙ë_pﬁl
(
s
);

1155 
	`p˙ë_upd©e_úq
(
s
);

1156 
	}
}

1158 
	$p˙ë_å™smô
(
PCNëSèã
 *
s
)

1160 
èrgë_phys_addr_t
 
xmô_cxda
 = 0;

1161 
cou¡
 = 
	`CSR_XMTRL
(
s
)-1;

1162 
s
->
xmô_pos
 = -1;

1164 i‡(!
	`CSR_TXON
(
s
)) {

1165 
s
->
c§
[0] &= ~0x0008;

1169 
s
->
tx_busy
 = 1;

1171 
txagaö
:

1172 i‡(
	`p˙ë_tdã_pﬁl
(
s
)) {

1173 
p˙ë_TMD
 
tmd
;

1175 
	`TMDLOAD
(&
tmd
, 
	`PHYSADDR
(
s
,
	`CSR_CXDA
(s)));

1177 #ifde‡
PCNET_DEBUG_TMD


1178 
	`¥ötf
(" TMDLOAD 0x%08x\n", 
	`PHYSADDR
(
s
,
	`CSR_CXDA
(s)));

1179 
	`PRINT_TMD
(&
tmd
);

1181 i‡(
tmd
.
tmd1
.
°p
) {

1182 
s
->
xmô_pos
 = 0;

1183 i‡(!
tmd
.
tmd1
.
íp
) {

1184 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, 
	`PHYSADDR
(s, 
tmd
.
tmd0
.
tbadr
),

1185 
s
->
buf„r
, 4096 - 
tmd
.
tmd1
.
b˙t
,

1186 
	`CSR_BSWP
(
s
));

1187 
s
->
xmô_pos
 +4096 - 
tmd
.
tmd1
.
b˙t
;

1189 
xmô_cxda
 = 
	`PHYSADDR
(
s
,
	`CSR_CXDA
(s));

1191 i‡(
tmd
.
tmd1
.
íp
 && (
s
->
xmô_pos
 >= 0)) {

1192 
s
->
	`phys_mem_ªad
(s->
dma_›aque
, 
	`PHYSADDR
(s, 
tmd
.
tmd0
.
tbadr
),

1193 
s
->
buf„r
 + s->
xmô_pos
, 4096 - 
tmd
.
tmd1
.
b˙t
,

1194 
	`CSR_BSWP
(
s
));

1195 
s
->
xmô_pos
 +4096 - 
tmd
.
tmd1
.
b˙t
;

1196 #ifde‡
PCNET_DEBUG


1197 
	`¥ötf
("p˙ë_å™smô size=%d\n", 
s
->
xmô_pos
);

1199 i‡(
	`CSR_LOOP
(
s
))

1200 
	`p˙ë_ª˚ive
(
s
, s->
buf„r
, s->
xmô_pos
);

1202 
	`qemu_£nd_∑ckë
(
s
->
vc
, s->
buf„r
, s->
xmô_pos
);

1204 
s
->
c§
[0] &= ~0x0008;

1205 
s
->
c§
[4] |= 0x0004;

1206 
s
->
xmô_pos
 = -1;

1209 
tmd
.
tmd1
.
own
 = 0;

1210 
	`TMDSTORE
(&
tmd
, 
	`PHYSADDR
(
s
,
	`CSR_CXDA
(s)));

1211 i‡(!
	`CSR_TOKINTD
(
s
Ë|| (
	`CSR_LTINTEN
(sË&& 
tmd
.
tmd1
.
…öt
))

1212 
s
->
c§
[0] |= 0x0200;

1214 i‡(
	`CSR_XMTRC
(
s
)<=1)

1215 
	`CSR_XMTRC
(
s
Ë
	`CSR_XMTRL
(s);

1217 
	`CSR_XMTRC
(
s
)--;

1218 i‡(
cou¡
--)

1219 
txagaö
;

1222 i‡(
s
->
xmô_pos
 >= 0) {

1223 
p˙ë_TMD
 
tmd
;

1224 
	`TMDLOAD
(&
tmd
, 
	`PHYSADDR
(
s
,
xmô_cxda
));

1225 
tmd
.
tmd2
.
buff
 =Åmd.tmd2.
uÊo
 =Åmd.
tmd1
.
îr
 = 1;

1226 
tmd
.
tmd1
.
own
 = 0;

1227 
	`TMDSTORE
(&
tmd
, 
	`PHYSADDR
(
s
,
xmô_cxda
));

1228 
s
->
c§
[0] |= 0x0200;

1229 i‡(!
	`CSR_DXSUFLO
(
s
)) {

1230 
s
->
c§
[0] &= ~0x0010;

1232 i‡(
cou¡
--)

1233 
txagaö
;

1236 
s
->
tx_busy
 = 0;

1237 
	}
}

1239 
	$p˙ë_pﬁl
(
PCNëSèã
 *
s
)

1241 i‡(
	`CSR_RXON
(
s
)) {

1242 
	`p˙ë_rdã_pﬁl
(
s
);

1245 i‡(
	`CSR_TDMD
(
s
) ||

1246 (
	`CSR_TXON
(
s
Ë&& !
	`CSR_DPOLL
(sË&& 
	`p˙ë_tdã_pﬁl
(s)))

1249 i‡(
s
->
tx_busy
)

1252 
	`p˙ë_å™smô
(
s
);

1254 
	}
}

1256 
	$p˙ë_pﬁl_timî
(*
›aque
)

1258 
PCNëSèã
 *
s
 = 
›aque
;

1260 
	`qemu_dñ_timî
(
s
->
pﬁl_timî
);

1262 i‡(
	`CSR_TDMD
(
s
)) {

1263 
	`p˙ë_å™smô
(
s
);

1266 
	`p˙ë_upd©e_úq
(
s
);

1268 i‡(!
	`CSR_STOP
(
s
Ë&& !
	`CSR_SPND
(sË&& !
	`CSR_DPOLL
(s)) {

1269 
uöt64_t
 
now
 = 
	`qemu_gë_˛ock
(
vm_˛ock
) * 33;

1270 i‡(!
s
->
timî
 || !
now
)

1271 
s
->
timî
 = 
now
;

1273 
uöt64_t
 
t
 = 
now
 - 
s
->
timî
 + 
	`CSR_POLL
(s);

1274 i‡(
t
 > 0xffffLL) {

1275 
	`p˙ë_pﬁl
(
s
);

1276 
	`CSR_POLL
(
s
Ë
	`CSR_PINT
(s);

1278 
	`CSR_POLL
(
s
Ë
t
;

1280 
	`qemu_mod_timî
(
s
->
pﬁl_timî
,

1281 
	`p˙ë_gë_√xt_pﬁl_time
(
s
,
	`qemu_gë_˛ock
(
vm_˛ock
)));

1283 
	}
}

1286 
	$p˙ë_c§_wrôew
(
PCNëSèã
 *
s
, 
uöt32_t
 
øp
, uöt32_à
√w_vÆue
)

1288 
uöt16_t
 
vÆ
 = 
√w_vÆue
;

1289 #ifde‡
PCNET_DEBUG_CSR


1290 
	`¥ötf
("p˙ë_c§_wrôewÑ≠=%d vÆ=0x%04x\n", 
øp
, 
vÆ
);

1292 
øp
) {

1294 
s
->
c§
[0] &~(
vÆ
 & 0x7f00);

1296 
s
->
c§
[0] = (s->c§[0] & ~0x0040Ë| (
vÆ
 & 0x0048);

1298 
vÆ
 = (vÆ & 0x007fË| (
s
->
c§
[0] & 0x7f00);

1301 i‡((
vÆ
&7) == 7)

1302 
vÆ
 &= ~3;

1304 i‡(!
	`CSR_STOP
(
s
Ë&& (
vÆ
 & 4))

1305 
	`p˙ë_°›
(
s
);

1307 i‡(!
	`CSR_INIT
(
s
Ë&& (
vÆ
 & 1))

1308 
	`p˙ë_öô
(
s
);

1310 i‡(!
	`CSR_STRT
(
s
Ë&& (
vÆ
 & 2))

1311 
	`p˙ë_°¨t
(
s
);

1313 i‡(
	`CSR_TDMD
(
s
))

1314 
	`p˙ë_å™smô
(
s
);

1362 i‡(
	`CSR_STOP
(
s
Ë|| 
	`CSR_SPND
(s))

1368 
s
->
c§
[4] &~(
vÆ
 & 0x026a);

1369 
vÆ
 &~0x026a; vÆ |
s
->
c§
[4] & 0x026a;

1372 
s
->
c§
[5] &~(
vÆ
 & 0x0a90);

1373 
vÆ
 &~0x0a90; vÆ |
s
->
c§
[5] & 0x0a90;

1376 
	`p˙ë_c§_wrôew
(
s
,1,
vÆ
);

1379 
	`p˙ë_c§_wrôew
(
s
,2,
vÆ
);

1382 
	`p˙ë_b¸_wrôew
(
s
,
BCR_SWS
,
vÆ
);

1387 
s
->
c§
[
øp
] = 
vÆ
;

1388 
	}
}

1390 
uöt32_t
 
	$p˙ë_c§_ªadw
(
PCNëSèã
 *
s
, 
uöt32_t
 
øp
)

1392 
uöt32_t
 
vÆ
;

1393 
øp
) {

1395 
	`p˙ë_upd©e_úq
(
s
);

1396 
vÆ
 = 
s
->
c§
[0];

1397 
vÆ
 |= (val & 0x7800) ? 0x8000 : 0;

1400  
	`p˙ë_c§_ªadw
(
s
,1);

1402  
	`p˙ë_c§_ªadw
(
s
,2);

1404  
	`p˙ë_b¸_ªadw
(
s
,
BCR_SWS
);

1406 
vÆ
 = 
s
->
c§
[89];

1407 
vÆ
 <<= 16;

1408 
vÆ
 |
s
->
c§
[88];

1411 
vÆ
 = 
s
->
c§
[
øp
];

1413 #ifde‡
PCNET_DEBUG_CSR


1414 
	`¥ötf
("p˙ë_c§_ªadwÑ≠=%d vÆ=0x%04x\n", 
øp
, 
vÆ
);

1416  
vÆ
;

1417 
	}
}

1419 
	$p˙ë_b¸_wrôew
(
PCNëSèã
 *
s
, 
uöt32_t
 
øp
, uöt32_à
vÆ
)

1421 
øp
 &= 127;

1422 #ifde‡
PCNET_DEBUG_BCR


1423 
	`¥ötf
("p˙ë_b¸_wrôewÑ≠=%d vÆ=0x%04x\n", 
øp
, 
vÆ
);

1425 
øp
) {

1426 
BCR_SWS
:

1427 i‡(!(
	`CSR_STOP
(
s
Ë|| 
	`CSR_SPND
(s)))

1429 
vÆ
 &= ~0x0300;

1430 
vÆ
 & 0x00ff) {

1432 
vÆ
 |= 0x0200;

1435 
vÆ
 |= 0x0100;

1439 
vÆ
 |= 0x0300;

1442 
	`¥ötf
("Bad SWSTYLE=0x%02x\n", 
vÆ
 & 0xff);

1443 
vÆ
 = 0x0200;

1446 #ifde‡
PCNET_DEBUG


1447 
	`¥ötf
("BCR_SWS=0x%04x\n", 
vÆ
);

1449 
BCR_LNKST
:

1450 
BCR_LED1
:

1451 
BCR_LED2
:

1452 
BCR_LED3
:

1453 
BCR_MC
:

1454 
BCR_FDC
:

1455 
BCR_BSBC
:

1456 
BCR_EECAS
:

1457 
BCR_PLAT
:

1458 
s
->
b¸
[
øp
] = 
vÆ
;

1463 
	}
}

1465 
uöt32_t
 
	$p˙ë_b¸_ªadw
(
PCNëSèã
 *
s
, 
uöt32_t
 
øp
)

1467 
uöt32_t
 
vÆ
;

1468 
øp
 &= 127;

1469 
øp
) {

1470 
BCR_LNKST
:

1471 
BCR_LED1
:

1472 
BCR_LED2
:

1473 
BCR_LED3
:

1474 
vÆ
 = 
s
->
b¸
[
øp
] & ~0x8000;

1475 
vÆ
 |(vÆ & 0x017‡& 
s
->
 k°
) ? 0x8000 : 0;

1478 
vÆ
 = 
øp
 < 32 ? 
s
->
b¸
[rap] : 0;

1481 #ifde‡
PCNET_DEBUG_BCR


1482 
	`¥ötf
("p˙ë_b¸_ªadwÑ≠=%d vÆ=0x%04x\n", 
øp
, 
vÆ
);

1484  
vÆ
;

1485 
	}
}

1487 
	$p˙ë_h_ª£t
(*
›aque
)

1489 
PCNëSèã
 *
s
 = 
›aque
;

1490 
i
;

1491 
uöt16_t
 
checksum
;

1495 
	`mem˝y
(
s
->
¥om
, s->
nd
->
maˇddr
, 6);

1496 
s
->
¥om
[12] = s->prom[13] = 0x00;

1497 
s
->
¥om
[14] = s->prom[15] = 0x57;

1499 
i
 = 0,
checksum
 = 0; i < 16; i++)

1500 
checksum
 +
s
->
¥om
[
i
];

1501 *(
uöt16_t
 *)&
s
->
¥om
[12] = 
	`˝u_to_À16
(
checksum
);

1504 
s
->
b¸
[
BCR_MSRDA
] = 0x0005;

1505 
s
->
b¸
[
BCR_MSWRA
] = 0x0005;

1506 
s
->
b¸
[
BCR_MC
 ] = 0x0002;

1507 
s
->
b¸
[
BCR_LNKST
] = 0x00c0;

1508 
s
->
b¸
[
BCR_LED1
 ] = 0x0084;

1509 
s
->
b¸
[
BCR_LED2
 ] = 0x0088;

1510 
s
->
b¸
[
BCR_LED3
 ] = 0x0090;

1511 
s
->
b¸
[
BCR_FDC
 ] = 0x0000;

1512 
s
->
b¸
[
BCR_BSBC
 ] = 0x9001;

1513 
s
->
b¸
[
BCR_EECAS
] = 0x0002;

1514 
s
->
b¸
[
BCR_SWS
 ] = 0x0200;

1515 
s
->
b¸
[
BCR_PLAT
 ] = 0xff06;

1517 
	`p˙ë_s_ª£t
(
s
);

1518 
	}
}

1520 
	$p˙ë_≠rom_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

1522 
PCNëSèã
 *
s
 = 
›aque
;

1523 #ifde‡
PCNET_DEBUG


1524 
	`¥ötf
("p˙ë_≠rom_wrôebáddr=0x%08x vÆ=0x%02x\n", 
addr
, 
vÆ
);

1527 i‡(
	`p˙ë_b¸_ªadw
(
s
,2) & 0x80)

1528 
s
->
¥om
[
addr
 & 15] = 
vÆ
;

1529 
	}
}

1531 
uöt32_t
 
	$p˙ë_≠rom_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

1533 
PCNëSèã
 *
s
 = 
›aque
;

1534 
uöt32_t
 
vÆ
 = 
s
->
¥om
[
addr
 &= 15];

1535 #ifde‡
PCNET_DEBUG


1536 
	`¥ötf
("p˙ë_≠rom_ªadbáddr=0x%08x vÆ=0x%02x\n", 
addr
, 
vÆ
);

1538  
vÆ
;

1539 
	}
}

1541 
	$p˙ë_i›‹t_wrôew
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

1543 
PCNëSèã
 *
s
 = 
›aque
;

1544 
	`p˙ë_pﬁl_timî
(
s
);

1545 #ifde‡
PCNET_DEBUG_IO


1546 
	`¥ötf
("p˙ë_i›‹t_wrôewáddr=0x%08x vÆ=0x%04x\n", 
addr
, 
vÆ
);

1548 i‡(!
	`BCR_DWIO
(
s
)) {

1549 
addr
 & 0x0f) {

1551 
	`p˙ë_c§_wrôew
(
s
, s->
øp
, 
vÆ
);

1554 
s
->
øp
 = 
vÆ
 & 0x7f;

1557 
	`p˙ë_b¸_wrôew
(
s
, s->
øp
, 
vÆ
);

1561 
	`p˙ë_upd©e_úq
(
s
);

1562 
	}
}

1564 
uöt32_t
 
	$p˙ë_i›‹t_ªadw
(*
›aque
, 
uöt32_t
 
addr
)

1566 
PCNëSèã
 *
s
 = 
›aque
;

1567 
uöt32_t
 
vÆ
 = -1;

1568 
	`p˙ë_pﬁl_timî
(
s
);

1569 i‡(!
	`BCR_DWIO
(
s
)) {

1570 
addr
 & 0x0f) {

1572 
vÆ
 = 
	`p˙ë_c§_ªadw
(
s
, s->
øp
);

1575 
vÆ
 = 
s
->
øp
;

1578 
	`p˙ë_s_ª£t
(
s
);

1579 
vÆ
 = 0;

1582 
vÆ
 = 
	`p˙ë_b¸_ªadw
(
s
, s->
øp
);

1586 
	`p˙ë_upd©e_úq
(
s
);

1587 #ifde‡
PCNET_DEBUG_IO


1588 
	`¥ötf
("p˙ë_i›‹t_ªadwáddr=0x%08x vÆ=0x%04x\n", 
addr
, 
vÆ
 & 0xffff);

1590  
vÆ
;

1591 
	}
}

1593 
	$p˙ë_i›‹t_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

1595 
PCNëSèã
 *
s
 = 
›aque
;

1596 
	`p˙ë_pﬁl_timî
(
s
);

1597 #ifde‡
PCNET_DEBUG_IO


1598 
	`¥ötf
("p˙ë_i›‹t_wrôñáddr=0x%08x vÆ=0x%08x\n", 
addr
, 
vÆ
);

1600 i‡(
	`BCR_DWIO
(
s
)) {

1601 
addr
 & 0x0f) {

1603 
	`p˙ë_c§_wrôew
(
s
, s->
øp
, 
vÆ
 & 0xffff);

1606 
s
->
øp
 = 
vÆ
 & 0x7f;

1609 
	`p˙ë_b¸_wrôew
(
s
, s->
øp
, 
vÆ
 & 0xffff);

1613 i‡((
addr
 & 0x0f) == 0) {

1615 
	`p˙ë_b¸_wrôew
(
s
, 
BCR_BSBC
, 
	`p˙ë_b¸_ªadw
(s, BCR_BSBC) | 0x0080);

1616 #ifde‡
PCNET_DEBUG_IO


1617 
	`¥ötf
("device switched into dword i/o mode\n");

1620 
	`p˙ë_upd©e_úq
(
s
);

1621 
	}
}

1623 
uöt32_t
 
	$p˙ë_i›‹t_ªadl
(*
›aque
, 
uöt32_t
 
addr
)

1625 
PCNëSèã
 *
s
 = 
›aque
;

1626 
uöt32_t
 
vÆ
 = -1;

1627 
	`p˙ë_pﬁl_timî
(
s
);

1628 i‡(
	`BCR_DWIO
(
s
)) {

1629 
addr
 & 0x0f) {

1631 
vÆ
 = 
	`p˙ë_c§_ªadw
(
s
, s->
øp
);

1634 
vÆ
 = 
s
->
øp
;

1637 
	`p˙ë_s_ª£t
(
s
);

1638 
vÆ
 = 0;

1641 
vÆ
 = 
	`p˙ë_b¸_ªadw
(
s
, s->
øp
);

1645 
	`p˙ë_upd©e_úq
(
s
);

1646 #ifde‡
PCNET_DEBUG_IO


1647 
	`¥ötf
("p˙ë_i›‹t_ªad»addr=0x%08x vÆ=0x%08x\n", 
addr
, 
vÆ
);

1649  
vÆ
;

1650 
	}
}

1652 
	$p˙ë_i›‹t_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

1653 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

1655 
PCNëSèã
 *
d
 = (PCNëSèã *)
pci_dev
;

1657 #ifde‡
PCNET_DEBUG_IO


1658 
	`¥ötf
("p˙ë_i›‹t_m≠áddr=0x%04x size=0x%04x\n", 
addr
, 
size
);

1661 
	`ªgi°î_i›‹t_wrôe
(
addr
, 16, 1, 
p˙ë_≠rom_wrôeb
, 
d
);

1662 
	`ªgi°î_i›‹t_ªad
(
addr
, 16, 1, 
p˙ë_≠rom_ªadb
, 
d
);

1664 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 0x10, 0x10, 2, 
p˙ë_i›‹t_wrôew
, 
d
);

1665 
	`ªgi°î_i›‹t_ªad
(
addr
 + 0x10, 0x10, 2, 
p˙ë_i›‹t_ªadw
, 
d
);

1666 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 0x10, 0x10, 4, 
p˙ë_i›‹t_wrôñ
, 
d
);

1667 
	`ªgi°î_i›‹t_ªad
(
addr
 + 0x10, 0x10, 4, 
p˙ë_i›‹t_ªadl
, 
d
);

1668 
	}
}

1670 
	$p˙ë_mmio_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1672 
PCNëSèã
 *
d
 = 
›aque
;

1673 #ifde‡
PCNET_DEBUG_IO


1674 
	`¥ötf
("p˙ë_mmio_wrôebáddr=0x%08x vÆ=0x%02x\n", 
addr
, 
vÆ
);

1676 i‡(!(
addr
 & 0x10))

1677 
	`p˙ë_≠rom_wrôeb
(
d
, 
addr
 & 0x0f, 
vÆ
);

1678 
	}
}

1680 
uöt32_t
 
	$p˙ë_mmio_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1682 
PCNëSèã
 *
d
 = 
›aque
;

1683 
uöt32_t
 
vÆ
 = -1;

1684 i‡(!(
addr
 & 0x10))

1685 
vÆ
 = 
	`p˙ë_≠rom_ªadb
(
d
, 
addr
 & 0x0f);

1686 #ifde‡
PCNET_DEBUG_IO


1687 
	`¥ötf
("p˙ë_mmio_ªadbáddr=0x%08x vÆ=0x%02x\n", 
addr
, 
vÆ
 & 0xff);

1689  
vÆ
;

1690 
	}
}

1692 
	$p˙ë_mmio_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1694 
PCNëSèã
 *
d
 = 
›aque
;

1695 #ifde‡
PCNET_DEBUG_IO


1696 
	`¥ötf
("p˙ë_mmio_wrôewáddr=0x%08x vÆ=0x%04x\n", 
addr
, 
vÆ
);

1698 i‡(
addr
 & 0x10)

1699 
	`p˙ë_i›‹t_wrôew
(
d
, 
addr
 & 0x0f, 
vÆ
);

1701 
addr
 &= 0x0f;

1702 
	`p˙ë_≠rom_wrôeb
(
d
, 
addr
, 
vÆ
 & 0xff);

1703 
	`p˙ë_≠rom_wrôeb
(
d
, 
addr
+1, (
vÆ
 & 0xff00) >> 8);

1705 
	}
}

1707 
uöt32_t
 
	$p˙ë_mmio_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1709 
PCNëSèã
 *
d
 = 
›aque
;

1710 
uöt32_t
 
vÆ
 = -1;

1711 i‡(
addr
 & 0x10)

1712 
vÆ
 = 
	`p˙ë_i›‹t_ªadw
(
d
, 
addr
 & 0x0f);

1714 
addr
 &= 0x0f;

1715 
vÆ
 = 
	`p˙ë_≠rom_ªadb
(
d
, 
addr
+1);

1716 
vÆ
 <<= 8;

1717 
vÆ
 |
	`p˙ë_≠rom_ªadb
(
d
, 
addr
);

1719 #ifde‡
PCNET_DEBUG_IO


1720 
	`¥ötf
("p˙ë_mmio_ªadwáddr=0x%08x vÆ = 0x%04x\n", 
addr
, 
vÆ
 & 0xffff);

1722  
vÆ
;

1723 
	}
}

1725 
	$p˙ë_mmio_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1727 
PCNëSèã
 *
d
 = 
›aque
;

1728 #ifde‡
PCNET_DEBUG_IO


1729 
	`¥ötf
("p˙ë_mmio_wrôñáddr=0x%08x vÆ=0x%08x\n", 
addr
, 
vÆ
);

1731 i‡(
addr
 & 0x10)

1732 
	`p˙ë_i›‹t_wrôñ
(
d
, 
addr
 & 0x0f, 
vÆ
);

1734 
addr
 &= 0x0f;

1735 
	`p˙ë_≠rom_wrôeb
(
d
, 
addr
, 
vÆ
 & 0xff);

1736 
	`p˙ë_≠rom_wrôeb
(
d
, 
addr
+1, (
vÆ
 & 0xff00) >> 8);

1737 
	`p˙ë_≠rom_wrôeb
(
d
, 
addr
+2, (
vÆ
 & 0xff0000) >> 16);

1738 
	`p˙ë_≠rom_wrôeb
(
d
, 
addr
+3, (
vÆ
 & 0xff000000) >> 24);

1740 
	}
}

1742 
uöt32_t
 
	$p˙ë_mmio_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

1744 
PCNëSèã
 *
d
 = 
›aque
;

1745 
uöt32_t
 
vÆ
;

1746 i‡(
addr
 & 0x10)

1747 
vÆ
 = 
	`p˙ë_i›‹t_ªadl
(
d
, 
addr
 & 0x0f);

1749 
addr
 &= 0x0f;

1750 
vÆ
 = 
	`p˙ë_≠rom_ªadb
(
d
, 
addr
+3);

1751 
vÆ
 <<= 8;

1752 
vÆ
 |
	`p˙ë_≠rom_ªadb
(
d
, 
addr
+2);

1753 
vÆ
 <<= 8;

1754 
vÆ
 |
	`p˙ë_≠rom_ªadb
(
d
, 
addr
+1);

1755 
vÆ
 <<= 8;

1756 
vÆ
 |
	`p˙ë_≠rom_ªadb
(
d
, 
addr
);

1758 #ifde‡
PCNET_DEBUG_IO


1759 
	`¥ötf
("p˙ë_mmio_ªad»addr=0x%08x vÆ=0x%08x\n", 
addr
, 
vÆ
);

1761  
vÆ
;

1762 
	}
}

1765 
	$p˙ë_ßve
(
QEMUFûe
 *
f
, *
›aque
)

1767 
PCNëSèã
 *
s
 = 
›aque
;

1768 
i
;

1770 i‡(
s
->
pci_dev
)

1771 
	`pci_devi˚_ßve
(
s
->
pci_dev
, 
f
);

1773 
	`qemu_put_be32s
(
f
, &
s
->
øp
);

1774 
	`qemu_put_be32s
(
f
, &
s
->
i§
);

1775 
	`qemu_put_be32s
(
f
, &
s
->
 k°
);

1776 
	`qemu_put_be32s
(
f
, &
s
->
rdø
);

1777 
	`qemu_put_be32s
(
f
, &
s
->
tdø
);

1778 
	`qemu_put_buf„r
(
f
, 
s
->
¥om
, 16);

1779 
i
 = 0; i < 128; i++)

1780 
	`qemu_put_be16s
(
f
, &
s
->
c§
[
i
]);

1781 
i
 = 0; i < 32; i++)

1782 
	`qemu_put_be16s
(
f
, &
s
->
b¸
[
i
]);

1783 
	`qemu_put_be64s
(
f
, &
s
->
timî
);

1784 
	`qemu_put_be32s
(
f
, &
s
->
xmô_pos
);

1785 
	`qemu_put_be32s
(
f
, &
s
->
ªcv_pos
);

1786 
	`qemu_put_buf„r
(
f
, 
s
->
buf„r
, 4096);

1787 
	`qemu_put_be32s
(
f
, &
s
->
tx_busy
);

1788 
	`qemu_put_timî
(
f
, 
s
->
pﬁl_timî
);

1789 
	}
}

1791 
	$p˙ë_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

1793 
PCNëSèã
 *
s
 = 
›aque
;

1794 
i
, 
ªt
;

1796 i‡(
vîsi⁄_id
 != 2)

1797  -
EINVAL
;

1799 i‡(
s
->
pci_dev
) {

1800 
ªt
 = 
	`pci_devi˚_lﬂd
(
s
->
pci_dev
, 
f
);

1801 i‡(
ªt
 < 0)

1802  
ªt
;

1805 
	`qemu_gë_be32s
(
f
, &
s
->
øp
);

1806 
	`qemu_gë_be32s
(
f
, &
s
->
i§
);

1807 
	`qemu_gë_be32s
(
f
, &
s
->
 k°
);

1808 
	`qemu_gë_be32s
(
f
, &
s
->
rdø
);

1809 
	`qemu_gë_be32s
(
f
, &
s
->
tdø
);

1810 
	`qemu_gë_buf„r
(
f
, 
s
->
¥om
, 16);

1811 
i
 = 0; i < 128; i++)

1812 
	`qemu_gë_be16s
(
f
, &
s
->
c§
[
i
]);

1813 
i
 = 0; i < 32; i++)

1814 
	`qemu_gë_be16s
(
f
, &
s
->
b¸
[
i
]);

1815 
	`qemu_gë_be64s
(
f
, &
s
->
timî
);

1816 
	`qemu_gë_be32s
(
f
, &
s
->
xmô_pos
);

1817 
	`qemu_gë_be32s
(
f
, &
s
->
ªcv_pos
);

1818 
	`qemu_gë_buf„r
(
f
, 
s
->
buf„r
, 4096);

1819 
	`qemu_gë_be32s
(
f
, &
s
->
tx_busy
);

1820 
	`qemu_gë_timî
(
f
, 
s
->
pﬁl_timî
);

1823 
	}
}

1825 
	$p˙ë_comm⁄_öô
(
PCNëSèã
 *
d
, 
NICInfo
 *
nd
, c⁄° *
öfo_°r
)

1827 
ö°™˚
;

1829 
d
->
pﬁl_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
p˙ë_pﬁl_timî
, d);

1831 
d
->
nd
 =Çd;

1833 
d
->
vc
 = 
	`qemu_√w_vœn_˛õ¡
(
nd
->
vœn
, 
p˙ë_ª˚ive
,

1834 
p˙ë_ˇn_ª˚ive
, 
d
);

1836 
	`¢¥ötf
(
d
->
vc
->
öfo_°r
, (d->vc->info_str),

1838 
d
->
nd
->
maˇddr
[0],

1839 
d
->
nd
->
maˇddr
[1],

1840 
d
->
nd
->
maˇddr
[2],

1841 
d
->
nd
->
maˇddr
[3],

1842 
d
->
nd
->
maˇddr
[4],

1843 
d
->
nd
->
maˇddr
[5]);

1845 
	`p˙ë_h_ª£t
(
d
);

1847 
ö°™˚
 = 
	`pci_bus_num
(
d
->
dev
.
bus
Ë<< 8 | d->dev.
dev‚
;

1848 
	`ªgi°î_ßvevm
("p˙ë", 
ö°™˚
, 2, 
p˙ë_ßve
, 
p˙ë_lﬂd
, 
d
);

1849 
	}
}

1853 
CPUWrôeMem‹yFunc
 *
	gp˙ë_mmio_wrôe
[] = {

1854 (
CPUWrôeMem‹yFunc
 *)&
p˙ë_mmio_wrôeb
,

1855 (
CPUWrôeMem‹yFunc
 *)&
p˙ë_mmio_wrôew
,

1856 (
CPUWrôeMem‹yFunc
 *)&
p˙ë_mmio_wrôñ


1859 
CPURódMem‹yFunc
 *
	gp˙ë_mmio_ªad
[] = {

1860 (
CPURódMem‹yFunc
 *)&
p˙ë_mmio_ªadb
,

1861 (
CPURódMem‹yFunc
 *)&
p˙ë_mmio_ªadw
,

1862 (
CPURódMem‹yFunc
 *)&
p˙ë_mmio_ªadl


1865 
	$p˙ë_mmio_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

1866 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

1868 
PCNëSèã
 *
d
 = (PCNëSèã *)
pci_dev
;

1870 #ifde‡
PCNET_DEBUG_IO


1871 
	`¥ötf
("p˙ë_i›‹t_m≠áddr=0x%08x 0x%08x\n", 
addr
, 
size
);

1874 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
PCNET_PNPMMIO_SIZE
, 
d
->
mmio_ödex
);

1875 
	}
}

1877 
	$p˙ë_pci_£t_úq_cb
(*
›aque
, 
i§
)

1879 
PCNëSèã
 *
s
 = 
›aque
;

1881 
	`pci_£t_úq
(&
s
->
dev
, 0, 
i§
);

1882 
	}
}

1884 
	$pci_physiˇl_mem‹y_wrôe
(*
dma_›aque
, 
èrgë_phys_addr_t
 
addr
,

1885 
uöt8_t
 *
buf
, 
Àn
, 
do_bsw≠
)

1887 
	`˝u_physiˇl_mem‹y_wrôe
(
addr
, 
buf
, 
Àn
);

1888 
	}
}

1890 
	$pci_physiˇl_mem‹y_ªad
(*
dma_›aque
, 
èrgë_phys_addr_t
 
addr
,

1891 
uöt8_t
 *
buf
, 
Àn
, 
do_bsw≠
)

1893 
	`˝u_physiˇl_mem‹y_ªad
(
addr
, 
buf
, 
Àn
);

1894 
	}
}

1896 
	$pci_p˙ë_öô
(
PCIBus
 *
bus
, 
NICInfo
 *
nd
, 
dev‚
)

1898 
PCNëSèã
 *
d
;

1899 
uöt8_t
 *
pci_c⁄f
;

1902 
	`¥ötf
("sizeof(RMD)=%d, sizeof(TMD)=%d\n",

1903 (
p˙ë_RMD
), (
p˙ë_TMD
));

1906 
d
 = (
PCNëSèã
 *)
	`pci_ªgi°î_devi˚
(
bus
, "PCNet", (PCNetState),

1907 
dev‚
, 
NULL
, NULL);

1909 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

1911 *(
uöt16_t
 *)&
pci_c⁄f
[0x00] = 
	`˝u_to_À16
(0x1022);

1912 *(
uöt16_t
 *)&
pci_c⁄f
[0x02] = 
	`˝u_to_À16
(0x2000);

1913 *(
uöt16_t
 *)&
pci_c⁄f
[0x04] = 
	`˝u_to_À16
(0x0007);

1914 *(
uöt16_t
 *)&
pci_c⁄f
[0x06] = 
	`˝u_to_À16
(0x0280);

1915 
pci_c⁄f
[0x08] = 0x10;

1916 
pci_c⁄f
[0x09] = 0x00;

1917 
pci_c⁄f
[0x0a] = 0x00;

1918 
pci_c⁄f
[0x0b] = 0x02;

1919 
pci_c⁄f
[0x0e] = 0x00;

1921 *(
uöt32_t
 *)&
pci_c⁄f
[0x10] = 
	`˝u_to_À32
(0x00000001);

1922 *(
uöt32_t
 *)&
pci_c⁄f
[0x14] = 
	`˝u_to_À32
(0x00000000);

1924 
pci_c⁄f
[0x3d] = 1;

1925 
pci_c⁄f
[0x3e] = 0x06;

1926 
pci_c⁄f
[0x3f] = 0xff;

1929 
d
->
mmio_ödex
 =

1930 
	`˝u_ªgi°î_io_mem‹y
(0, 
p˙ë_mmio_ªad
, 
p˙ë_mmio_wrôe
, 
d
);

1932 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 0, 
PCNET_IOPORT_SIZE
,

1933 
PCI_ADDRESS_SPACE_IO
, 
p˙ë_i›‹t_m≠
);

1935 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
d
, 1, 
PCNET_PNPMMIO_SIZE
,

1936 
PCI_ADDRESS_SPACE_MEM
, 
p˙ë_mmio_m≠
);

1938 
d
->
£t_úq_cb
 = 
p˙ë_pci_£t_úq_cb
;

1939 
d
->
phys_mem_ªad
 = 
pci_physiˇl_mem‹y_ªad
;

1940 
d
->
phys_mem_wrôe
 = 
pci_physiˇl_mem‹y_wrôe
;

1941 
d
->
pci_dev
 = &d->
dev
;

1943 
	`p˙ë_comm⁄_öô
(
d
, 
nd
, "pcnet");

1944 
	}
}

1948 #i‡
deföed
 (
TARGET_SPARC
Ë&& !deföed(
TARGET_SPARC64
)

1950 
CPURódMem‹yFunc
 *
	gœn˚_mem_ªad
[3] = {

1951 (
CPURódMem‹yFunc
 *)&
p˙ë_i›‹t_ªadw
,

1952 (
CPURódMem‹yFunc
 *)&
p˙ë_i›‹t_ªadw
,

1953 (
CPURódMem‹yFunc
 *)&
p˙ë_i›‹t_ªadw
,

1956 
CPUWrôeMem‹yFunc
 *
	gœn˚_mem_wrôe
[3] = {

1957 (
CPUWrôeMem‹yFunc
 *)&
p˙ë_i›‹t_wrôew
,

1958 (
CPUWrôeMem‹yFunc
 *)&
p˙ë_i›‹t_wrôew
,

1959 (
CPUWrôeMem‹yFunc
 *)&
p˙ë_i›‹t_wrôew
,

1962 
	$p˙ë_•¨c_£t_úq_cb
(*
›aque
, 
i§
)

1964 
PCNëSèã
 *
s
 = 
›aque
;

1966 
	`Àdma_£t_úq
(
s
->
dma_›aque
, 
i§
);

1967 
	}
}

1969 *
	$œn˚_öô
(
NICInfo
 *
nd
, 
uöt32_t
 
Àaddr
, *
dma_›aque
)

1971 
PCNëSèã
 *
d
;

1972 
œn˚_io_mem‹y
;

1974 
d
 = 
	`qemu_mÆlocz
((
PCNëSèã
));

1975 i‡(!
d
)

1976  
NULL
;

1978 
œn˚_io_mem‹y
 =

1979 
	`˝u_ªgi°î_io_mem‹y
(0, 
œn˚_mem_ªad
, 
œn˚_mem_wrôe
, 
d
);

1981 
d
->
dma_›aque
 = dma_opaque;

1982 
	`˝u_ªgi°î_physiˇl_mem‹y
(
Àaddr
, 4, 
œn˚_io_mem‹y
);

1984 
d
->
£t_úq_cb
 = 
p˙ë_•¨c_£t_úq_cb
;

1985 
d
->
phys_mem_ªad
 = 
Àdma_mem‹y_ªad
;

1986 
d
->
phys_mem_wrôe
 = 
Àdma_mem‹y_wrôe
;

1988 
	`p˙ë_comm⁄_öô
(
d
, 
nd
, "lance");

1990  
d
;

1991 
	}
}

	@pcspk.c

25 
	~"vl.h
"

27 
	#PCSPK_BUF_LEN
 1792

	)

28 
	#PCSPK_SAMPLE_RATE
 32000

	)

29 
	#PCSPK_MAX_FREQ
 (
PCSPK_SAMPLE_RATE
 >> 1)

	)

30 
	#PCSPK_MIN_COUNT
 ((
PIT_FREQ
 + 
PCSPK_MAX_FREQ
 - 1Ë/ PCSPK_MAX_FREQ)

	)

33 
uöt8_t
 
	mßm∂e_buf
[
PCSPK_BUF_LEN
];

34 
QEMUSoundC¨d
 
	mˇrd
;

35 
SWVoi˚Out
 *
	mvoi˚
;

36 
PITSèã
 *
	mpô
;

37 
	mpô_cou¡
;

38 
	mßm∂es
;

39 
	m∂ay_pos
;

40 
	md©a_⁄
;

41 
	mdummy_ª‰esh_˛ock
;

42 } 
	tPCSpkSèã
;

44 c⁄° *
	gs_•k
 = "pcspk";

45 
PCSpkSèã
 
	gpc•k_°©e
;

47 
ölöe
 
	$gíî©e_ßm∂es
(
PCSpkSèã
 *
s
)

49 
i
;

51 i‡(
s
->
pô_cou¡
) {

52 c⁄° 
uöt32_t
 
m
 = 
PCSPK_SAMPLE_RATE
 * 
s
->
pô_cou¡
;

53 c⁄° 
uöt32_t
 
n
 = ((
uöt64_t
)
PIT_FREQ
 << 32Ë/ 
m
;

56 
s
->
ßm∂es
 = (
PCSPK_BUF_LEN
 * 
PIT_FREQ
 / 
m
 * m / (PIT_FREQ >> 1) + 1) >> 1;

57 
i
 = 0; i < 
s
->
ßm∂es
; ++i)

58 
s
->
ßm∂e_buf
[
i
] = (64 & (
n
 * i >> 25)) - 32;

60 
s
->
ßm∂es
 = 
PCSPK_BUF_LEN
;

61 
i
 = 0; i < 
PCSPK_BUF_LEN
; ++i)

62 
s
->
ßm∂e_buf
[
i
] = 128;

64 
	}
}

66 
	$pc•k_ˇŒback
(*
›aque
, 
‰ì
)

68 
PCSpkSèã
 *
s
 = 
›aque
;

69 
n
;

71 i‡(
	`pô_gë_mode
(
s
->
pô
, 2) != 3)

74 
n
 = 
	`pô_gë_öôül_cou¡
(
s
->
pô
, 2);

76 i‡(
n
 < 
PCSPK_MIN_COUNT
)

77 
n
 = 0;

79 i‡(
s
->
pô_cou¡
 !
n
) {

80 
s
->
pô_cou¡
 = 
n
;

81 
s
->
∂ay_pos
 = 0;

82 
	`gíî©e_ßm∂es
(
s
);

85 
‰ì
 > 0) {

86 
n
 = 
	`audio_MIN
(
s
->
ßm∂es
 - s->
∂ay_pos
, ()
‰ì
);

87 
n
 = 
	`AUD_wrôe
(
s
->
voi˚
, &s->
ßm∂e_buf
[s->
∂ay_pos
],Ç);

88 i‡(!
n
)

90 
s
->
∂ay_pos
 = (s->∂ay_po†+ 
n
Ë% s->
ßm∂es
;

91 
‰ì
 -
n
;

93 
	}
}

95 
	$pc•k_audio_öô
(
AudioSèã
 *
audio
)

97 
PCSpkSèã
 *
s
 = &
pc•k_°©e
;

98 
aud£âögs_t
 
as
 = {
PCSPK_SAMPLE_RATE
, 1, 
AUD_FMT_U8
, 0};

100 i‡(!
audio
) {

101 
	`AUD_log
(
s_•k
, "Noáudio state\n");

104 
	`AUD_ªgi°î_ˇrd
(
audio
, 
s_•k
, &
s
->
ˇrd
);

106 
s
->
voi˚
 = 
	`AUD_›í_out
(&s->
ˇrd
, s->voi˚, 
s_•k
, s, 
pc•k_ˇŒback
, &
as
);

107 i‡(!
s
->
voi˚
) {

108 
	`AUD_log
(
s_•k
, "CouldÇot open voice\n");

113 
	}
}

115 
uöt32_t
 
	$pc•k_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

117 
PCSpkSèã
 *
s
 = 
›aque
;

118 
out
;

120 
s
->
dummy_ª‰esh_˛ock
 ^= (1 << 4);

121 
out
 = 
	`pô_gë_out
(
s
->
pô
, 2, 
	`qemu_gë_˛ock
(
vm_˛ock
)) << 5;

123  
	`pô_gë_g©e
(
s
->
pô
, 2Ë| (s->
d©a_⁄
 << 1Ë| s->
dummy_ª‰esh_˛ock
 | 
out
;

124 
	}
}

126 
	$pc•k_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

128 
PCSpkSèã
 *
s
 = 
›aque
;

129 c⁄° 
g©e
 = 
vÆ
 & 1;

131 
s
->
d©a_⁄
 = (
vÆ
 >> 1) & 1;

132 
	`pô_£t_g©e
(
s
->
pô
, 2, 
g©e
);

133 i‡(
s
->
voi˚
) {

134 i‡(
g©e
)

135 
s
->
∂ay_pos
 = 0;

136 
	`AUD_£t_a˘ive_out
(
s
->
voi˚
, 
g©e
 & s->
d©a_⁄
);

138 
	}
}

140 
	$pc•k_öô
(
PITSèã
 *
pô
)

142 
PCSpkSèã
 *
s
 = &
pc•k_°©e
;

144 
s
->
pô
 =Öit;

145 
	`ªgi°î_i›‹t_ªad
(0x61, 1, 1, 
pc•k_i›‹t_ªad
, 
s
);

146 
	`ªgi°î_i›‹t_wrôe
(0x61, 1, 1, 
pc•k_i›‹t_wrôe
, 
s
);

147 
	}
}

	@pflash_cfi02.c

39 
	~"vl.h
"

42 #ifde‡
PFLASH_DEBUG


43 
	#DPRINTF
(
fmt
, 
¨gs
...) \

45 
	`¥ötf
("PFLASH: " 
fmt
 , ##
¨gs
); \

46 } 0)

	)

48 
	#DPRINTF
(
fmt
, 
¨gs
...Ëdÿ{ } 0)

	)

51 
	spÊash_t
 {

52 
BlockDrivîSèã
 *
	mbs
;

53 
èrgë_ul⁄g
 
	mba£
;

54 
èrgë_ul⁄g
 
	m£˘‹_Àn
;

55 
èrgë_ul⁄g
 
	mtŸÆ_Àn
;

56 
	mwidth
;

57 
	mwcy˛e
;

58 
	mby∑ss
;

59 
	mro
;

60 
uöt8_t
 
	mcmd
;

61 
uöt8_t
 
	m°©us
;

62 
uöt16_t
 
	midít
[4];

63 
uöt8_t
 
	mcfi_Àn
;

64 
uöt8_t
 
	mcfi_èbÀ
[0x52];

65 
QEMUTimî
 *
	mtimî
;

66 
øm_addr_t
 
	moff
;

67 
	mÊ_mem
;

68 *
	m°‹age
;

71 
	$pÊash_timî
 (*
›aque
)

73 
pÊash_t
 *
pÊ
 = 
›aque
;

75 
	`DPRINTF
("%s: comm™d %02x d⁄e\n", 
__func__
, 
pÊ
->
cmd
);

77 
pÊ
->
°©us
 ^= 0x80;

78 i‡(
pÊ
->
by∑ss
) {

79 
pÊ
->
wcy˛e
 = 2;

81 
	`˝u_ªgi°î_physiˇl_mem‹y
(
pÊ
->
ba£
,ÖÊ->
tŸÆ_Àn
,

82 
pÊ
->
off
 | 
IO_MEM_ROMD
 |ÖÊ->
Ê_mem
);

83 
pÊ
->
wcy˛e
 = 0;

85 
pÊ
->
cmd
 = 0;

86 
	}
}

88 
uöt32_t
 
	$pÊash_ªad
 (
pÊash_t
 *
pÊ
, 
èrgë_ul⁄g
 
off£t
, 
width
)

90 
èrgë_ul⁄g
 
boff
;

91 
uöt32_t
 
ªt
;

92 
uöt8_t
 *
p
;

94 
	`DPRINTF
("%s: off£à%08x\n", 
__func__
, 
off£t
);

95 
ªt
 = -1;

96 
off£t
 -
pÊ
->
ba£
;

97 
boff
 = 
off£t
 & 0xFF;

98 i‡(
pÊ
->
width
 == 2)

99 
boff
 = boff >> 1;

100 i‡(
pÊ
->
width
 == 4)

101 
boff
 = boff >> 2;

102 
pÊ
->
cmd
) {

105 
	`DPRINTF
("%s: unknow¿comm™d sèã: %x\n", 
__func__
, 
pÊ
->
cmd
);

106 
pÊ
->
wcy˛e
 = 0;

107 
pÊ
->
cmd
 = 0;

111 
Êash_ªad
:

113 
p
 = 
pÊ
->
°‹age
;

114 
width
) {

116 
ªt
 = 
p
[
off£t
];

120 #i‡
	`deföed
(
TARGET_WORDS_BIGENDIAN
)

121 
ªt
 = 
p
[
off£t
] << 8;

122 
ªt
 |
p
[
off£t
 + 1];

124 
ªt
 = 
p
[
off£t
];

125 
ªt
 |
p
[
off£t
 + 1] << 8;

130 #i‡
	`deföed
(
TARGET_WORDS_BIGENDIAN
)

131 
ªt
 = 
p
[
off£t
] << 24;

132 
ªt
 |
p
[
off£t
 + 1] << 16;

133 
ªt
 |
p
[
off£t
 + 2] << 8;

134 
ªt
 |
p
[
off£t
 + 3];

136 
ªt
 = 
p
[
off£t
];

137 
ªt
 |
p
[
off£t
 + 1] << 8;

138 
ªt
 |
p
[
off£t
 + 2] << 16;

139 
ªt
 |
p
[
off£t
 + 3] << 24;

147 
boff
) {

150 
ªt
 = 
pÊ
->
idít
[
boff
 & 0x01];

153 
ªt
 = 0x00;

157 i‡(
pÊ
->
idít
[2 + (
boff
 & 0x01)] =(
uöt8_t
)-1)

158 
Êash_ªad
;

159 
ªt
 = 
pÊ
->
idít
[2 + (
boff
 & 0x01)];

162 
Êash_ªad
;

164 
	`DPRINTF
("%s: ID %d %x\n", 
__func__
, 
boff
, 
ªt
);

170 
ªt
 = 
pÊ
->
°©us
;

171 
	`DPRINTF
("%s: sètu†%x\n", 
__func__
, 
ªt
);

173 
pÊ
->
°©us
 ^= 0x40;

177 i‡(
boff
 > 
pÊ
->
cfi_Àn
)

178 
ªt
 = 0;

180 
ªt
 = 
pÊ
->
cfi_èbÀ
[
boff
];

184  
ªt
;

185 
	}
}

188 
	$pÊash_upd©e
(
pÊash_t
 *
pÊ
, 
off£t
,

189 
size
)

191 
off£t_íd
;

192 i‡(
pÊ
->
bs
) {

193 
off£t_íd
 = 
off£t
 + 
size
;

195 
off£t
 = offset >> 9;

196 
off£t_íd
 = (offset_end + 511) >> 9;

197 
	`bdrv_wrôe
(
pÊ
->
bs
, 
off£t
,ÖÊ->
°‹age
 + (offset << 9),

198 
off£t_íd
 - 
off£t
);

200 
	}
}

202 
	$pÊash_wrôe
 (
pÊash_t
 *
pÊ
, 
èrgë_ul⁄g
 
off£t
, 
uöt32_t
 
vÆue
,

203 
width
)

205 
èrgë_ul⁄g
 
boff
;

206 
uöt8_t
 *
p
;

207 
uöt8_t
 
cmd
;

211 i‡(
pÊ
->
wcy˛e
 == 0)

212 
off£t
 -(
èrgë_ul⁄g
)()
pÊ
->
°‹age
;

214 
off£t
 -
pÊ
->
ba£
;

216 
cmd
 = 
vÆue
;

217 
	`DPRINTF
("%s: off£à%08x %08x %d\n", 
__func__
, 
off£t
, 
vÆue
, 
width
);

218 i‡(
pÊ
->
cmd
 != 0xA0 && cmd == 0xF0) {

219 
	`DPRINTF
("%s: flashÑesetásked (%02x %02x)\n",

220 
__func__
, 
pÊ
->
cmd
, cmd);

221 
ª£t_Êash
;

224 
	`˝u_ªgi°î_physiˇl_mem‹y
(
pÊ
->
ba£
,ÖÊ->
tŸÆ_Àn
,ÖÊ->
Ê_mem
);

225 
boff
 = 
off£t
 & (
pÊ
->
£˘‹_Àn
 - 1);

226 i‡(
pÊ
->
width
 == 2)

227 
boff
 = boff >> 1;

228 i‡(
pÊ
->
width
 == 4)

229 
boff
 = boff >> 2;

230 
pÊ
->
wcy˛e
) {

233 
check_u∆ock0
:

234 i‡(
boff
 =0x55 && 
cmd
 == 0x98) {

235 
íãr_CFI_mode
:

237 
pÊ
->
wcy˛e
 = 7;

238 
pÊ
->
cmd
 = 0x98;

241 i‡(
boff
 !0x555 || 
cmd
 != 0xAA) {

242 
	`DPRINTF
("%s: unlock0 failed %04x %02x %04x\n",

243 
__func__
, 
boff
, 
cmd
, 0x555);

244 
ª£t_Êash
;

246 
	`DPRINTF
("%s: u∆ock sequí˚ sèπed\n", 
__func__
);

250 
check_u∆ock1
:

251 i‡(
boff
 !0x2AA || 
cmd
 != 0x55) {

252 
	`DPRINTF
("%s: u∆ock1 faûed %04x %02x\n", 
__func__
, 
boff
, 
cmd
);

253 
ª£t_Êash
;

255 
	`DPRINTF
("%s: u∆ock sequí˚ d⁄e\n", 
__func__
);

259 i‡(!
pÊ
->
by∑ss
 && 
boff
 != 0x555) {

260 
	`DPRINTF
("%s: comm™d faûed %04x %02x\n", 
__func__
, 
boff
, 
cmd
);

261 
ª£t_Êash
;

263 
cmd
) {

265 
pÊ
->
by∑ss
 = 1;

266 
do_by∑ss
;

270 
pÊ
->
cmd
 = cmd;

271 
	`DPRINTF
("%s: sèπög comm™d %02x\n", 
__func__
, 
cmd
);

274 
	`DPRINTF
("%s: unknow¿comm™d %02x\n", 
__func__
, 
cmd
);

275 
ª£t_Êash
;

279 
pÊ
->
cmd
) {

282 
check_u∆ock0
;

284 
	`DPRINTF
("%s: write data offset %08x %08x %d\n",

285 
__func__
, 
off£t
, 
vÆue
, 
width
);

286 
p
 = 
pÊ
->
°‹age
;

287 
width
) {

289 
p
[
off£t
] &
vÆue
;

290 
	`pÊash_upd©e
(
pÊ
, 
off£t
, 1);

293 #i‡
	`deföed
(
TARGET_WORDS_BIGENDIAN
)

294 
p
[
off£t
] &
vÆue
 >> 8;

295 
p
[
off£t
 + 1] &
vÆue
;

297 
p
[
off£t
] &
vÆue
;

298 
p
[
off£t
 + 1] &
vÆue
 >> 8;

300 
	`pÊash_upd©e
(
pÊ
, 
off£t
, 2);

303 #i‡
	`deföed
(
TARGET_WORDS_BIGENDIAN
)

304 
p
[
off£t
] &
vÆue
 >> 24;

305 
p
[
off£t
 + 1] &
vÆue
 >> 16;

306 
p
[
off£t
 + 2] &
vÆue
 >> 8;

307 
p
[
off£t
 + 3] &
vÆue
;

309 
p
[
off£t
] &
vÆue
;

310 
p
[
off£t
 + 1] &
vÆue
 >> 8;

311 
p
[
off£t
 + 2] &
vÆue
 >> 16;

312 
p
[
off£t
 + 3] &
vÆue
 >> 24;

314 
	`pÊash_upd©e
(
pÊ
, 
off£t
, 4);

317 
pÊ
->
°©us
 = 0x00 | ~(
vÆue
 & 0x80);

319 i‡(
pÊ
->
by∑ss
)

320 
do_by∑ss
;

321 
ª£t_Êash
;

323 i‡(
pÊ
->
by∑ss
 && 
cmd
 == 0x00) {

325 
ª£t_Êash
;

328 i‡(
boff
 =0x55 && 
cmd
 == 0x98)

329 
íãr_CFI_mode
;

332 
	`DPRINTF
("%s: invalid write for command %02x\n",

333 
__func__
, 
pÊ
->
cmd
);

334 
ª£t_Êash
;

337 
pÊ
->
cmd
) {

343 
check_u∆ock1
;

346 
	`DPRINTF
("%s: invalid command state %02x (wc 4)\n",

347 
__func__
, 
pÊ
->
cmd
);

348 
ª£t_Êash
;

352 
cmd
) {

354 i‡(
boff
 != 0x555) {

355 
	`DPRINTF
("%s: chipÉrase: invalidáddress %04x\n",

356 
__func__
, 
off£t
);

357 
ª£t_Êash
;

360 
	`DPRINTF
("%s: sèπ chùÉø£\n", 
__func__
);

361 
	`mem£t
(
pÊ
->
°‹age
, 0xFF,ÖÊ->
tŸÆ_Àn
);

362 
pÊ
->
°©us
 = 0x00;

363 
	`pÊash_upd©e
(
pÊ
, 0,ÖÊ->
tŸÆ_Àn
);

365 
	`qemu_mod_timî
(
pÊ
->
timî
,

366 
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ (
ticks_≥r_£c
 * 5));

370 
p
 = 
pÊ
->
°‹age
;

371 
off£t
 &~(
pÊ
->
£˘‹_Àn
 - 1);

372 
	`DPRINTF
("%s: sèπ se˘‹Éø£áà%08x\n", 
__func__
, 
off£t
);

373 
	`mem£t
(
p
 + 
off£t
, 0xFF, 
pÊ
->
£˘‹_Àn
);

374 
	`pÊash_upd©e
(
pÊ
, 
off£t
,ÖÊ->
£˘‹_Àn
);

375 
pÊ
->
°©us
 = 0x00;

377 
	`qemu_mod_timî
(
pÊ
->
timî
,

378 
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ (
ticks_≥r_£c
 / 2));

381 
	`DPRINTF
("%s: invÆid comm™d %02x (w¯5)\n", 
__func__
, 
cmd
);

382 
ª£t_Êash
;

384 
pÊ
->
cmd
 = cmd;

387 
pÊ
->
cmd
) {

396 
	`DPRINTF
("%s: invalid command state %02x (wc 6)\n",

397 
__func__
, 
pÊ
->
cmd
);

398 
ª£t_Êash
;

402 
	`DPRINTF
("%s: invÆid wrôêö CFI quîy mode\n", 
__func__
);

403 
ª£t_Êash
;

406 
	`DPRINTF
("%s: invÆid wrôê°©ê(w¯7)\n", 
__func__
);

407 
ª£t_Êash
;

409 
pÊ
->
wcy˛e
++;

414 
ª£t_Êash
:

415 i‡(
pÊ
->
wcy˛e
 != 0) {

416 
	`˝u_ªgi°î_physiˇl_mem‹y
(
pÊ
->
ba£
,ÖÊ->
tŸÆ_Àn
,

417 
pÊ
->
off
 | 
IO_MEM_ROMD
 |ÖÊ->
Ê_mem
);

419 
pÊ
->
by∑ss
 = 0;

420 
pÊ
->
wcy˛e
 = 0;

421 
pÊ
->
cmd
 = 0;

424 
do_by∑ss
:

425 
pÊ
->
wcy˛e
 = 2;

426 
pÊ
->
cmd
 = 0;

428 
	}
}

431 
uöt32_t
 
	$pÊash_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

433  
	`pÊash_ªad
(
›aque
, 
addr
, 1);

434 
	}
}

436 
uöt32_t
 
	$pÊash_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

438 
pÊash_t
 *
pÊ
 = 
›aque
;

440  
	`pÊash_ªad
(
pÊ
, 
addr
, 2);

441 
	}
}

443 
uöt32_t
 
	$pÊash_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

445 
pÊash_t
 *
pÊ
 = 
›aque
;

447  
	`pÊash_ªad
(
pÊ
, 
addr
, 4);

448 
	}
}

450 
	$pÊash_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

451 
uöt32_t
 
vÆue
)

453 
	`pÊash_wrôe
(
›aque
, 
addr
, 
vÆue
, 1);

454 
	}
}

456 
	$pÊash_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

457 
uöt32_t
 
vÆue
)

459 
pÊash_t
 *
pÊ
 = 
›aque
;

461 
	`pÊash_wrôe
(
pÊ
, 
addr
, 
vÆue
, 2);

462 
	}
}

464 
	$pÊash_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

465 
uöt32_t
 
vÆue
)

467 
pÊash_t
 *
pÊ
 = 
›aque
;

469 
	`pÊash_wrôe
(
pÊ
, 
addr
, 
vÆue
, 4);

470 
	}
}

472 
CPUWrôeMem‹yFunc
 *
	gpÊash_wrôe_›s
[] = {

473 &
pÊash_wrôeb
,

474 &
pÊash_wrôew
,

475 &
pÊash_wrôñ
,

478 
CPURódMem‹yFunc
 *
	gpÊash_ªad_›s
[] = {

479 &
pÊash_ªadb
,

480 &
pÊash_ªadw
,

481 &
pÊash_ªadl
,

485 
	$˘z32
 (
uöt32_t
 
n
)

487 
ªt
;

489 
ªt
 = 0;

490 i‡(!(
n
 & 0xFFFF)) {

491 
ªt
 += 16;

492 
n
 =Ç >> 16;

494 i‡(!(
n
 & 0xFF)) {

495 
ªt
 += 8;

496 
n
 =Ç >> 8;

498 i‡(!(
n
 & 0xF)) {

499 
ªt
 += 4;

500 
n
 =Ç >> 4;

502 i‡(!(
n
 & 0x3)) {

503 
ªt
 += 2;

504 
n
 =Ç >> 2;

506 i‡(!(
n
 & 0x1)) {

507 
ªt
++;

508 
n
 =Ç >> 1;

511 i‡(!
n
)

512 
ªt
++;

515  
ªt
;

516 
	}
}

518 
pÊash_t
 *
	$pÊash_ªgi°î
 (
èrgë_ul⁄g
 
ba£
, 
øm_addr_t
 
off
,

519 
BlockDrivîSèã
 *
bs
,

520 
èrgë_ul⁄g
 
£˘‹_Àn
, 
nb_blocs
, 
width
,

521 
uöt16_t
 
id0
, uöt16_à
id1
,

522 
uöt16_t
 
id2
, uöt16_à
id3
)

524 
pÊash_t
 *
pÊ
;

525 
èrgë_l⁄g
 
tŸÆ_Àn
;

527 
tŸÆ_Àn
 = 
£˘‹_Àn
 * 
nb_blocs
;

529 i‡(
tŸÆ_Àn
 != (8 * 1024 * 1024) &&Åotal_len != (16 * 1024 * 1024) &&

530 
tŸÆ_Àn
 != (32 * 1024 * 1024) &&Åotal_len != (64 * 1024 * 1024))

531  
NULL
;

532 
pÊ
 = 
	`qemu_mÆlocz
((
pÊash_t
));

533 i‡(
pÊ
 =
NULL
)

534  
NULL
;

535 
pÊ
->
°‹age
 = 
phys_øm_ba£
 + 
off
;

536 
pÊ
->
Ê_mem
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pÊash_ªad_›s
, 
pÊash_wrôe_›s
,Öfl);

537 
pÊ
->
off
 = off;

538 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 
tŸÆ_Àn
,

539 
off
 | 
pÊ
->
Ê_mem
 | 
IO_MEM_ROMD
);

540 
pÊ
->
bs
 = bs;

541 i‡(
pÊ
->
bs
) {

543 
	`bdrv_ªad
(
pÊ
->
bs
, 0,ÖÊ->
°‹age
, 
tŸÆ_Àn
 >> 9);

548 
pÊ
->
ro
 = 1;

550 
pÊ
->
ro
 = 0;

552 
pÊ
->
timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
pÊash_timî
,Öfl);

553 
pÊ
->
ba£
 = base;

554 
pÊ
->
£˘‹_Àn
 = sector_len;

555 
pÊ
->
tŸÆ_Àn
 =Åotal_len;

556 
pÊ
->
width
 = width;

557 
pÊ
->
wcy˛e
 = 0;

558 
pÊ
->
cmd
 = 0;

559 
pÊ
->
°©us
 = 0;

560 
pÊ
->
idít
[0] = 
id0
;

561 
pÊ
->
idít
[1] = 
id1
;

562 
pÊ
->
idít
[2] = 
id2
;

563 
pÊ
->
idít
[3] = 
id3
;

565 
pÊ
->
cfi_Àn
 = 0x52;

567 
pÊ
->
cfi_èbÀ
[0x10] = 'Q';

568 
pÊ
->
cfi_èbÀ
[0x11] = 'R';

569 
pÊ
->
cfi_èbÀ
[0x12] = 'Y';

571 
pÊ
->
cfi_èbÀ
[0x13] = 0x02;

572 
pÊ
->
cfi_èbÀ
[0x14] = 0x00;

574 
pÊ
->
cfi_èbÀ
[0x15] = 0x00;

575 
pÊ
->
cfi_èbÀ
[0x16] = 0x00;

577 
pÊ
->
cfi_èbÀ
[0x17] = 0x00;

578 
pÊ
->
cfi_èbÀ
[0x18] = 0x00;

580 
pÊ
->
cfi_èbÀ
[0x19] = 0x00;

581 
pÊ
->
cfi_èbÀ
[0x1A] = 0x00;

583 
pÊ
->
cfi_èbÀ
[0x1B] = 0x27;

585 
pÊ
->
cfi_èbÀ
[0x1C] = 0x36;

587 
pÊ
->
cfi_èbÀ
[0x1D] = 0x00;

589 
pÊ
->
cfi_èbÀ
[0x1E] = 0x00;

591 
pÊ
->
cfi_èbÀ
[0x1F] = 0x07;

593 
pÊ
->
cfi_èbÀ
[0x20] = 0x04;

595 
pÊ
->
cfi_èbÀ
[0x21] = 0x09;

597 
pÊ
->
cfi_èbÀ
[0x22] = 0x0C;

599 
pÊ
->
cfi_èbÀ
[0x23] = 0x01;

601 
pÊ
->
cfi_èbÀ
[0x24] = 0x04;

603 
pÊ
->
cfi_èbÀ
[0x25] = 0x0A;

605 
pÊ
->
cfi_èbÀ
[0x26] = 0x0D;

607 
pÊ
->
cfi_èbÀ
[0x27] = 
	`˘z32
(
tŸÆ_Àn
) + 1;

609 
pÊ
->
cfi_èbÀ
[0x28] = 0x02;

610 
pÊ
->
cfi_èbÀ
[0x29] = 0x00;

612 
pÊ
->
cfi_èbÀ
[0x2A] = 0x05;

613 
pÊ
->
cfi_èbÀ
[0x2B] = 0x00;

615 
pÊ
->
cfi_èbÀ
[0x2C] = 0x01;

617 
pÊ
->
cfi_èbÀ
[0x2D] = 
nb_blocs
 - 1;

618 
pÊ
->
cfi_èbÀ
[0x2E] = (
nb_blocs
 - 1) >> 8;

619 
pÊ
->
cfi_èbÀ
[0x2F] = 
£˘‹_Àn
 >> 8;

620 
pÊ
->
cfi_èbÀ
[0x30] = 
£˘‹_Àn
 >> 16;

622  
pÊ
;

623 
	}
}

	@piix4acpi.c

26 
	~"vl.h
"

29 
	#SCI_EN
 (1 << 0)

	)

30 
	#GBL_RLS
 (1 << 2)

	)

31 
	#SLP_TYP_Sx
 (7 << 10)

	)

32 
	#SLP_EN
 (1 << 13)

	)

36 
	#SLP_TYP_S5
 (7 << 10)

	)

38 
A˝iDevi˚Sèã
 
	tA˝iDevi˚Sèã
;

39 
A˝iDevi˚Sèã
 *
	ga˝i_devi˚_èbÀ
;

41 
	sPCIA˝iSèã
 {

42 
PCIDevi˚
 
	mdev
;

43 
uöt16_t
 
	mpm1_c⁄åﬁ
;

44 } 
	tPCIA˝iSèã
;

46 
	$piix4a˝i_ßve
(
QEMUFûe
 *
f
, *
›aque
)

48 
PCIA˝iSèã
 *
s
 = 
›aque
;

49 
	`pci_devi˚_ßve
(&
s
->
dev
, 
f
);

50 
	`qemu_put_be16s
(
f
, &
s
->
pm1_c⁄åﬁ
);

51 
	}
}

53 
	$piix4a˝i_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

55 
PCIA˝iSèã
 *
s
 = 
›aque
;

56 
ªt
;

57 i‡(
vîsi⁄_id
 > 1)

58  -
EINVAL
;

59 
ªt
 = 
	`pci_devi˚_lﬂd
(&
s
->
dev
, 
f
);

60 i‡(
ªt
 < 0)

61  
ªt
;

62 
	`qemu_gë_be16s
(
f
, &
s
->
pm1_c⁄åﬁ
);

64 
	}
}

66 
	$a˝iPm1C⁄åﬁ_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

68 
PCIA˝iSèã
 *
s
 = 
›aque
;

69 
s
->
pm1_c⁄åﬁ
 = (s->pm1_c⁄åﬁ & 0xff00Ë| (
vÆ
 & 0xff);

70 
	}
}

72 
uöt32_t
 
	$a˝iPm1C⁄åﬁ_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

74 
PCIA˝iSèã
 *
s
 = 
›aque
;

76  (
uöt8_t
)(
s
->
pm1_c⁄åﬁ
 & ~(
GBL_RLS
|
SLP_EN
));

77 
	}
}

79 
	$a˝iPm1C⁄åﬁP1_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

81 
PCIA˝iSèã
 *
s
 = 
›aque
;

83 
vÆ
 <<= 8;

84 
s
->
pm1_c⁄åﬁ
 = ((s->pm1_c⁄åﬁ & 0xffË| 
vÆ
Ë& ~
SLP_EN
;

87 i‡((
vÆ
 & (
SLP_EN
|
SLP_TYP_Sx
)Ë=(SLP_EN|
SLP_TYP_S5
))

88 
	`qemu_sy°em_shutdown_ªque°
();

89 
	}
}

91 
uöt32_t
 
	$a˝iPm1C⁄åﬁP1_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

93 
PCIA˝iSèã
 *
s
 = 
›aque
;

95  (
uöt8_t
)((
s
->
pm1_c⁄åﬁ
 & ~(
GBL_RLS
|
SLP_EN
)) >> 8);

96 
	}
}

98 
	$a˝iPm1C⁄åﬁ_wrôew
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

100 
PCIA˝iSèã
 *
s
 = 
›aque
;

102 
s
->
pm1_c⁄åﬁ
 = 
vÆ
 & ~
SLP_EN
;

105 i‡((
vÆ
 & (
SLP_EN
|
SLP_TYP_Sx
)Ë=(SLP_EN|
SLP_TYP_S5
))

106 
	`qemu_sy°em_shutdown_ªque°
();

107 
	}
}

109 
uöt32_t
 
	$a˝iPm1C⁄åﬁ_ªadw
(*
›aque
, 
uöt32_t
 
addr
)

111 
PCIA˝iSèã
 *
s
 = 
›aque
;

113  (
s
->
pm1_c⁄åﬁ
 & ~(
GBL_RLS
|
SLP_EN
));

114 
	}
}

116 
	$a˝i_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

117 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

119 
PCIA˝iSèã
 *
d
 = (PCIA˝iSèã *)
pci_dev
;

122 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 4, 1, 1, 
a˝iPm1C⁄åﬁ_wrôeb
, 
d
);

123 
	`ªgi°î_i›‹t_ªad
(
addr
 + 4, 1, 1, 
a˝iPm1C⁄åﬁ_ªadb
, 
d
);

124 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 4 + 1, 1, 1, 
a˝iPm1C⁄åﬁP1_wrôeb
, 
d
);

125 
	`ªgi°î_i›‹t_ªad
(
addr
 + 4 +1, 1, 1, 
a˝iPm1C⁄åﬁP1_ªadb
, 
d
);

128 
	`ªgi°î_i›‹t_wrôe
(
addr
 + 4, 2, 2, 
a˝iPm1C⁄åﬁ_wrôew
, 
d
);

129 
	`ªgi°î_i›‹t_ªad
(
addr
 + 4, 2, 2, 
a˝iPm1C⁄åﬁ_ªadw
, 
d
);

130 
	}
}

133 
	$pci_piix4_a˝i_öô
(
PCIBus
 *
bus
, 
dev‚
)

135 
PCIA˝iSèã
 *
d
;

136 
uöt8_t
 *
pci_c⁄f
;

139 
d
 = (
PCIA˝iSèã
 *)
	`pci_ªgi°î_devi˚
(

140 
bus
, "PIIX4 ACPI", (
PCIA˝iSèã
),

141 
dev‚
, 
NULL
, NULL);

143 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

144 
pci_c⁄f
[0x00] = 0x86;

145 
pci_c⁄f
[0x01] = 0x80;

146 
pci_c⁄f
[0x02] = 0x13;

147 
pci_c⁄f
[0x03] = 0x71;

148 
pci_c⁄f
[0x08] = 0x01;

149 
pci_c⁄f
[0x09] = 0x00;

150 
pci_c⁄f
[0x0a] = 0x80;

151 
pci_c⁄f
[0x0b] = 0x06;

152 
pci_c⁄f
[0x0e] = 0x00;

153 
pci_c⁄f
[0x3d] = 0x01;

163 
pci_c⁄f
[0x40] = 0x41;

164 
pci_c⁄f
[0x41] = 0x1f;

165 
pci_c⁄f
[0x42] = 0x00;

166 
pci_c⁄f
[0x43] = 0x00;

167 
d
->
pm1_c⁄åﬁ
 = 
SCI_EN
;

169 
	`a˝i_m≠
((
PCIDevi˚
 *)
d
, 0, 0x1f40, 0x10, 
PCI_ADDRESS_SPACE_IO
);

171 
	`ªgi°î_ßvevm
("piix4a˝i", 0, 1, 
piix4a˝i_ßve
, 
piix4a˝i_lﬂd
, 
d
);

172 
	}
}

	@piix_pci.c

25 
	~"vl.h
"

26 
uöt32_t
 
	tpci_addr_t
;

27 
	~"pci_ho°.h
"

29 
PCIHo°Sèã
 
	tI440FXSèã
;

31 
	$i440fx_addr_wrôñ
(* 
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

33 
I440FXSèã
 *
s
 = 
›aque
;

34 
s
->
c⁄fig_ªg
 = 
vÆ
;

35 
	}
}

37 
uöt32_t
 
	$i440fx_addr_ªadl
(* 
›aque
, 
uöt32_t
 
addr
)

39 
I440FXSèã
 *
s
 = 
›aque
;

40  
s
->
c⁄fig_ªg
;

41 
	}
}

43 
piix3_£t_úq
(*
pic
, 
úq_num
, 
Àvñ
);

48 
	$pci_¶Ÿ_gë_púq
(
PCIDevi˚
 *
pci_dev
, 
úq_num
)

50 
¶Ÿ_addíd
;

51 
¶Ÿ_addíd
 = (
pci_dev
->
dev‚
 >> 3) - 1;

52  (
úq_num
 + 
¶Ÿ_addíd
) & 3;

53 
	}
}

55 
uöt32_t
 
	giß_∑ge_descs
[384 / 4];

56 
uöt8_t
 
	gsmm_íabÀd
;

58 
	$upd©e_∑m
(
PCIDevi˚
 *
d
, 
uöt32_t
 
°¨t
, uöt32_à
íd
, 
r
)

60 
uöt32_t
 
addr
;

63 
r
) {

66 
	`˝u_ªgi°î_physiˇl_mem‹y
(
°¨t
, 
íd
 - start,

67 
°¨t
);

71 
	`˝u_ªgi°î_physiˇl_mem‹y
(
°¨t
, 
íd
 - start,

72 
°¨t
 | 
IO_MEM_ROM
);

77 
addr
 = 
°¨t
;ádd∏< 
íd
;áddr += 4096) {

78 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 4096,

79 
iß_∑ge_descs
[(
addr
 - 0xa0000) >> 12]);

83 
	}
}

85 
	$i440fx_upd©e_mem‹y_m≠pögs
(
PCIDevi˚
 *
d
)

87 
i
, 
r
;

88 
uöt32_t
 
smøm
, 
addr
;

90 
	`upd©e_∑m
(
d
, 0xf0000, 0x100000, (d->
c⁄fig
[0x59] >> 4) & 3);

91 
i
 = 0; i < 12; i++) {

92 
r
 = (
d
->
c⁄fig
[(
i
 >> 1) + 0x5a] >> ((i & 1) * 4)) & 3;

93 
	`upd©e_∑m
(
d
, 0xc0000 + 0x4000 * 
i
, 0xc0000 + 0x4000 * (ò+ 1), 
r
);

95 
smøm
 = 
d
->
c⁄fig
[0x72];

96 i‡((
smm_íabÀd
 && (
smøm
 & 0x08)) || (smram & 0x40)) {

97 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xa0000, 0x20000, 0xa0000);

99 
addr
 = 0xa0000;áddr < 0xc0000;áddr += 4096) {

100 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 4096,

101 
iß_∑ge_descs
[(
addr
 - 0xa0000) >> 12]);

104 
	}
}

106 
	$i440fx_£t_smm
(
PCIDevi˚
 *
d
, 
vÆ
)

108 
vÆ
 = (val != 0);

109 i‡(
smm_íabÀd
 !
vÆ
) {

110 
smm_íabÀd
 = 
vÆ
;

111 
	`i440fx_upd©e_mem‹y_m≠pögs
(
d
);

113 
	}
}

119 
	$i440fx_öô_mem‹y_m≠pögs
(
PCIDevi˚
 *
d
)

121 
i
;

122 
i
 = 0; i < 96; i++) {

123 
iß_∑ge_descs
[
i
] = 
	`˝u_gë_physiˇl_∑ge_desc
(0xa0000 + i * 0x1000);

125 
	}
}

127 
	$i440fx_wrôe_c⁄fig
(
PCIDevi˚
 *
d
,

128 
uöt32_t
 
addªss
, uöt32_à
vÆ
, 
Àn
)

131 
	`pci_deÁu…_wrôe_c⁄fig
(
d
, 
addªss
, 
vÆ
, 
Àn
);

132 i‡((
addªss
 >= 0x59 &&áddress <= 0x5f) ||áddress == 0x72)

133 
	`i440fx_upd©e_mem‹y_m≠pögs
(
d
);

134 
	}
}

136 
	$i440fx_ßve
(
QEMUFûe
* 
f
, *
›aque
)

138 
PCIDevi˚
 *
d
 = 
›aque
;

139 
	`pci_devi˚_ßve
(
d
, 
f
);

140 
	`qemu_put_8s
(
f
, &
smm_íabÀd
);

141 
	}
}

143 
	$i440fx_lﬂd
(
QEMUFûe
* 
f
, *
›aque
, 
vîsi⁄_id
)

145 
PCIDevi˚
 *
d
 = 
›aque
;

146 
ªt
;

148 i‡(
vîsi⁄_id
 != 1)

149  -
EINVAL
;

150 
ªt
 = 
	`pci_devi˚_lﬂd
(
d
, 
f
);

151 i‡(
ªt
 < 0)

152  
ªt
;

153 
	`i440fx_upd©e_mem‹y_m≠pögs
(
d
);

154 
	`qemu_gë_8s
(
f
, &
smm_íabÀd
);

156 
	}
}

158 
PCIBus
 *
	$i440fx_öô
(
PCIDevi˚
 **
pi440fx_°©e
)

160 
PCIBus
 *
b
;

161 
PCIDevi˚
 *
d
;

162 
I440FXSèã
 *
s
;

164 
s
 = 
	`qemu_mÆlocz
((
I440FXSèã
));

165 
b
 = 
	`pci_ªgi°î_bus
(
piix3_£t_úq
, 
pci_¶Ÿ_gë_púq
, 
NULL
, 0, 4);

166 
s
->
bus
 = 
b
;

168 
	`ªgi°î_i›‹t_wrôe
(0xcf8, 4, 4, 
i440fx_addr_wrôñ
, 
s
);

169 
	`ªgi°î_i›‹t_ªad
(0xcf8, 4, 4, 
i440fx_addr_ªadl
, 
s
);

171 
	`ªgi°î_i›‹t_wrôe
(0xcfc, 4, 1, 
pci_ho°_d©a_wrôeb
, 
s
);

172 
	`ªgi°î_i›‹t_wrôe
(0xcfc, 4, 2, 
pci_ho°_d©a_wrôew
, 
s
);

173 
	`ªgi°î_i›‹t_wrôe
(0xcfc, 4, 4, 
pci_ho°_d©a_wrôñ
, 
s
);

174 
	`ªgi°î_i›‹t_ªad
(0xcfc, 4, 1, 
pci_ho°_d©a_ªadb
, 
s
);

175 
	`ªgi°î_i›‹t_ªad
(0xcfc, 4, 2, 
pci_ho°_d©a_ªadw
, 
s
);

176 
	`ªgi°î_i›‹t_ªad
(0xcfc, 4, 4, 
pci_ho°_d©a_ªadl
, 
s
);

178 
d
 = 
	`pci_ªgi°î_devi˚
(
b
, "i440FX", (
PCIDevi˚
), 0,

179 
NULL
, 
i440fx_wrôe_c⁄fig
);

181 
d
->
c⁄fig
[0x00] = 0x86;

182 
d
->
c⁄fig
[0x01] = 0x80;

183 
d
->
c⁄fig
[0x02] = 0x37;

184 
d
->
c⁄fig
[0x03] = 0x12;

185 
d
->
c⁄fig
[0x08] = 0x02;

186 
d
->
c⁄fig
[0x0a] = 0x00;

187 
d
->
c⁄fig
[0x0b] = 0x06;

188 
d
->
c⁄fig
[0x0e] = 0x00;

190 
d
->
c⁄fig
[0x72] = 0x02;

192 
	`ªgi°î_ßvevm
("I440FX", 0, 1, 
i440fx_ßve
, 
i440fx_lﬂd
, 
d
);

193 *
pi440fx_°©e
 = 
d
;

194  
b
;

195 
	}
}

199 
PCIDevi˚
 *
	gpiix3_dev
;

200 
PCIDevi˚
 *
	gpiix4_dev
;

203 
	#PCI_IRQ_WORDS
 ((
PCI_DEVICES_MAX
 + 31Ë/ 32)

	)

205 
	gpci_úq_Àvñs
[4];

207 
	$piix3_£t_úq
(*
pic
, 
úq_num
, 
Àvñ
)

209 
i
, 
pic_úq
, 
pic_Àvñ
;

211 
pci_úq_Àvñs
[
úq_num
] = 
Àvñ
;

215 
pic_úq
 = 
piix3_dev
->
c⁄fig
[0x60 + 
úq_num
];

216 i‡(
pic_úq
 < 16) {

219 
pic_Àvñ
 = 0;

220 
i
 = 0; i < 4; i++) {

221 i‡(
pic_úq
 =
piix3_dev
->
c⁄fig
[0x60 + 
i
])

222 
pic_Àvñ
 |
pci_úq_Àvñs
[
i
];

224 
	`pic_£t_úq
(
pic_úq
, 
pic_Àvñ
);

226 
	}
}

228 
	$piix3_ª£t
(
PCIDevi˚
 *
d
)

230 
uöt8_t
 *
pci_c⁄f
 = 
d
->
c⁄fig
;

232 
pci_c⁄f
[0x04] = 0x07;

233 
pci_c⁄f
[0x05] = 0x00;

234 
pci_c⁄f
[0x06] = 0x00;

235 
pci_c⁄f
[0x07] = 0x02;

236 
pci_c⁄f
[0x4c] = 0x4d;

237 
pci_c⁄f
[0x4e] = 0x03;

238 
pci_c⁄f
[0x4f] = 0x00;

239 
pci_c⁄f
[0x60] = 0x80;

240 
pci_c⁄f
[0x69] = 0x02;

241 
pci_c⁄f
[0x70] = 0x80;

242 
pci_c⁄f
[0x76] = 0x0c;

243 
pci_c⁄f
[0x77] = 0x0c;

244 
pci_c⁄f
[0x78] = 0x02;

245 
pci_c⁄f
[0x79] = 0x00;

246 
pci_c⁄f
[0x80] = 0x00;

247 
pci_c⁄f
[0x82] = 0x00;

248 
pci_c⁄f
[0xa0] = 0x08;

249 
pci_c⁄f
[0xa2] = 0x00;

250 
pci_c⁄f
[0xa3] = 0x00;

251 
pci_c⁄f
[0xa4] = 0x00;

252 
pci_c⁄f
[0xa5] = 0x00;

253 
pci_c⁄f
[0xa6] = 0x00;

254 
pci_c⁄f
[0xa7] = 0x00;

255 
pci_c⁄f
[0xa8] = 0x0f;

256 
pci_c⁄f
[0xaa] = 0x00;

257 
pci_c⁄f
[0xab] = 0x00;

258 
pci_c⁄f
[0xac] = 0x00;

259 
pci_c⁄f
[0xae] = 0x00;

260 
	}
}

262 
	$piix4_ª£t
(
PCIDevi˚
 *
d
)

264 
uöt8_t
 *
pci_c⁄f
 = 
d
->
c⁄fig
;

266 
pci_c⁄f
[0x04] = 0x07;

267 
pci_c⁄f
[0x05] = 0x00;

268 
pci_c⁄f
[0x06] = 0x00;

269 
pci_c⁄f
[0x07] = 0x02;

270 
pci_c⁄f
[0x4c] = 0x4d;

271 
pci_c⁄f
[0x4e] = 0x03;

272 
pci_c⁄f
[0x4f] = 0x00;

273 
pci_c⁄f
[0x60] = 0x0a;

274 
pci_c⁄f
[0x61] = 0x0a;

275 
pci_c⁄f
[0x62] = 0x0b;

276 
pci_c⁄f
[0x63] = 0x0b;

277 
pci_c⁄f
[0x69] = 0x02;

278 
pci_c⁄f
[0x70] = 0x80;

279 
pci_c⁄f
[0x76] = 0x0c;

280 
pci_c⁄f
[0x77] = 0x0c;

281 
pci_c⁄f
[0x78] = 0x02;

282 
pci_c⁄f
[0x79] = 0x00;

283 
pci_c⁄f
[0x80] = 0x00;

284 
pci_c⁄f
[0x82] = 0x00;

285 
pci_c⁄f
[0xa0] = 0x08;

286 
pci_c⁄f
[0xa2] = 0x00;

287 
pci_c⁄f
[0xa3] = 0x00;

288 
pci_c⁄f
[0xa4] = 0x00;

289 
pci_c⁄f
[0xa5] = 0x00;

290 
pci_c⁄f
[0xa6] = 0x00;

291 
pci_c⁄f
[0xa7] = 0x00;

292 
pci_c⁄f
[0xa8] = 0x0f;

293 
pci_c⁄f
[0xaa] = 0x00;

294 
pci_c⁄f
[0xab] = 0x00;

295 
pci_c⁄f
[0xac] = 0x00;

296 
pci_c⁄f
[0xae] = 0x00;

297 
	}
}

299 
	$piix_ßve
(
QEMUFûe
* 
f
, *
›aque
)

301 
PCIDevi˚
 *
d
 = 
›aque
;

302 
	`pci_devi˚_ßve
(
d
, 
f
);

303 
	}
}

305 
	$piix_lﬂd
(
QEMUFûe
* 
f
, *
›aque
, 
vîsi⁄_id
)

307 
PCIDevi˚
 *
d
 = 
›aque
;

308 i‡(
vîsi⁄_id
 != 2)

309  -
EINVAL
;

310  
	`pci_devi˚_lﬂd
(
d
, 
f
);

311 
	}
}

313 
	$piix_öô
(
PCIBus
 *
bus
, 
dev‚
)

315 
PCIDevi˚
 *
d
;

316 
uöt8_t
 *
pci_c⁄f
;

318 
d
 = 
	`pci_ªgi°î_devi˚
(
bus
, "PIIX", (
PCIDevi˚
),

319 
dev‚
, 
NULL
, NULL);

320 
	`ªgi°î_ßvevm
("PIIX", 0, 2, 
piix_ßve
, 
piix_lﬂd
, 
d
);

322 
piix3_dev
 = 
d
;

323 
pci_c⁄f
 = 
d
->
c⁄fig
;

325 
pci_c⁄f
[0x00] = 0x86;

326 
pci_c⁄f
[0x01] = 0x80;

327 
pci_c⁄f
[0x02] = 0x2E;

328 
pci_c⁄f
[0x03] = 0x12;

329 
pci_c⁄f
[0x08] = 0x02;

330 
pci_c⁄f
[0x0a] = 0x01;

331 
pci_c⁄f
[0x0b] = 0x06;

332 
pci_c⁄f
[0x0e] = 0x80;

334 
	`piix3_ª£t
(
d
);

335  
d
->
dev‚
;

336 
	}
}

338 
	$piix3_öô
(
PCIBus
 *
bus
, 
dev‚
)

340 
PCIDevi˚
 *
d
;

341 
uöt8_t
 *
pci_c⁄f
;

343 
d
 = 
	`pci_ªgi°î_devi˚
(
bus
, "PIIX3", (
PCIDevi˚
),

344 
dev‚
, 
NULL
, NULL);

345 
	`ªgi°î_ßvevm
("PIIX3", 0, 2, 
piix_ßve
, 
piix_lﬂd
, 
d
);

347 
piix3_dev
 = 
d
;

348 
pci_c⁄f
 = 
d
->
c⁄fig
;

350 
pci_c⁄f
[0x00] = 0x86;

351 
pci_c⁄f
[0x01] = 0x80;

352 
pci_c⁄f
[0x02] = 0x00;

353 
pci_c⁄f
[0x03] = 0x70;

354 
pci_c⁄f
[0x0a] = 0x01;

355 
pci_c⁄f
[0x0b] = 0x06;

356 
pci_c⁄f
[0x0e] = 0x80;

358 
	`piix3_ª£t
(
d
);

359  
d
->
dev‚
;

360 
	}
}

362 
	$piix4_öô
(
PCIBus
 *
bus
, 
dev‚
)

364 
PCIDevi˚
 *
d
;

365 
uöt8_t
 *
pci_c⁄f
;

367 
d
 = 
	`pci_ªgi°î_devi˚
(
bus
, "PIIX4", (
PCIDevi˚
),

368 
dev‚
, 
NULL
, NULL);

369 
	`ªgi°î_ßvevm
("PIIX4", 0, 2, 
piix_ßve
, 
piix_lﬂd
, 
d
);

371 
piix4_dev
 = 
d
;

372 
pci_c⁄f
 = 
d
->
c⁄fig
;

374 
pci_c⁄f
[0x00] = 0x86;

375 
pci_c⁄f
[0x01] = 0x80;

376 
pci_c⁄f
[0x02] = 0x10;

377 
pci_c⁄f
[0x03] = 0x71;

378 
pci_c⁄f
[0x0a] = 0x01;

379 
pci_c⁄f
[0x0b] = 0x06;

380 
pci_c⁄f
[0x0e] = 0x80;

382 
	`piix4_ª£t
(
d
);

383  
d
->
dev‚
;

384 
	}
}

	@pl011.c

10 
	~"vl.h
"

13 
uöt32_t
 
	mba£
;

14 
uöt32_t
 
	mªadbuff
;

15 
uöt32_t
 
	mÊags
;

16 
uöt32_t
 
	ml¸
;

17 
uöt32_t
 
	m¸
;

18 
uöt32_t
 
	mdma¸
;

19 
uöt32_t
 
	möt_íabÀd
;

20 
uöt32_t
 
	möt_Àvñ
;

21 
uöt32_t
 
	mªad_fifo
[16];

22 
uöt32_t
 
	mû¥
;

23 
uöt32_t
 
	mibrd
;

24 
uöt32_t
 
	mfbrd
;

25 
uöt32_t
 
	miÊ
;

26 
	mªad_pos
;

27 
	mªad_cou¡
;

28 
	mªad_åiggî
;

29 
Ch¨DrivîSèã
 *
	mchr
;

30 *
	mpic
;

31 
	múq
;

32 } 
	t∂011_°©e
;

34 
	#PL011_INT_TX
 0x20

	)

35 
	#PL011_INT_RX
 0x10

	)

37 
	#PL011_FLAG_TXFE
 0x80

	)

38 
	#PL011_FLAG_RXFF
 0x40

	)

39 
	#PL011_FLAG_TXFF
 0x20

	)

40 
	#PL011_FLAG_RXFE
 0x10

	)

42 c⁄° 
	g∂011_id
[] =

45 
	$∂011_upd©e
(
∂011_°©e
 *
s
)

47 
uöt32_t
 
Êags
;

49 
Êags
 = 
s
->
öt_Àvñ
 & s->
öt_íabÀd
;

50 
	`pic_£t_úq_√w
(
s
->
pic
, s->
úq
, 
Êags
 != 0);

51 
	}
}

53 
uöt32_t
 
	$∂011_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

55 
∂011_°©e
 *
s
 = (∂011_°©ê*)
›aque
;

56 
uöt32_t
 
c
;

58 
off£t
 -
s
->
ba£
;

59 i‡(
off£t
 >= 0xfe0 && offset < 0x1000) {

60  
∂011_id
[(
off£t
 - 0xfe0) >> 2];

62 
off£t
 >> 2) {

64 
s
->
Êags
 &~
PL011_FLAG_RXFF
;

65 
c
 = 
s
->
ªad_fifo
[s->
ªad_pos
];

66 i‡(
s
->
ªad_cou¡
 > 0) {

67 
s
->
ªad_cou¡
--;

68 i‡(++
s
->
ªad_pos
 == 16)

69 
s
->
ªad_pos
 = 0;

71 i‡(
s
->
ªad_cou¡
 == 0) {

72 
s
->
Êags
 |
PL011_FLAG_RXFE
;

74 i‡(
s
->
ªad_cou¡
 =s->
ªad_åiggî
 - 1)

75 
s
->
öt_Àvñ
 &~ 
PL011_INT_RX
;

76 
	`∂011_upd©e
(
s
);

77  
c
;

81  
s
->
Êags
;

83  
s
->
û¥
;

85  
s
->
ibrd
;

87  
s
->
fbrd
;

89  
s
->
l¸
;

91  
s
->
¸
;

93  
s
->
iÊ
;

95  
s
->
öt_íabÀd
;

97  
s
->
öt_Àvñ
;

99  
s
->
öt_Àvñ
 & s->
öt_íabÀd
;

101  
s
->
dma¸
;

103 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "∂011_ªad: Bad off£à%x\n", 
off£t
);

106 
	}
}

108 
	$∂011_£t_ªad_åiggî
(
∂011_°©e
 *
s
)

115 i‡(
s
->
l¸
 & 0x10)

116 
s
->
ªad_åiggî
 = (s->
iÊ
 >> 1) & 0x1c;

119 
s
->
ªad_åiggî
 = 1;

120 
	}
}

122 
	$∂011_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

123 
uöt32_t
 
vÆue
)

125 
∂011_°©e
 *
s
 = (∂011_°©ê*)
›aque
;

126 
ch
;

128 
off£t
 -
s
->
ba£
;

129 
off£t
 >> 2) {

132 
ch
 = 
vÆue
;

133 i‡(
s
->
chr
)

134 
	`qemu_chr_wrôe
(
s
->
chr
, &
ch
, 1);

135 
s
->
öt_Àvñ
 |
PL011_INT_TX
;

136 
	`∂011_upd©e
(
s
);

139 
s
->
¸
 = 
vÆue
;

142 
s
->
û¥
 = 
vÆue
;

145 
s
->
ibrd
 = 
vÆue
;

148 
s
->
fbrd
 = 
vÆue
;

151 
s
->
l¸
 = 
vÆue
;

152 
	`∂011_£t_ªad_åiggî
(
s
);

156 
s
->
¸
 = 
vÆue
;

159 
s
->
iÊ
 = 
vÆue
;

160 
	`∂011_£t_ªad_åiggî
(
s
);

163 
s
->
öt_íabÀd
 = 
vÆue
;

164 
	`∂011_upd©e
(
s
);

167 
s
->
öt_Àvñ
 &~
vÆue
;

168 
	`∂011_upd©e
(
s
);

171 
s
->
dma¸
 = 
vÆue
;

172 i‡(
vÆue
 & 3)

173 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "PL011: DMAÇot implemented\n");

176 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "∂011_wrôe: Bad off£à%x\n", 
off£t
);

178 
	}
}

180 
	$∂011_ˇn_ªcõve
(*
›aque
)

182 
∂011_°©e
 *
s
 = (∂011_°©ê*)
›aque
;

184 i‡(
s
->
l¸
 & 0x10)

185  
s
->
ªad_cou¡
 < 16;

187  
s
->
ªad_cou¡
 < 1;

188 
	}
}

190 
	$∂011_ªcõve
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
size
)

192 
∂011_°©e
 *
s
 = (∂011_°©ê*)
›aque
;

193 
¶Ÿ
;

195 
¶Ÿ
 = 
s
->
ªad_pos
 + s->
ªad_cou¡
;

196 i‡(
¶Ÿ
 >= 16)

197 
¶Ÿ
 -= 16;

198 
s
->
ªad_fifo
[
¶Ÿ
] = *
buf
;

199 
s
->
ªad_cou¡
++;

200 
s
->
Êags
 &~
PL011_FLAG_RXFE
;

201 i‡(
s
->
¸
 & 0x10 || s->
ªad_cou¡
 == 16) {

202 
s
->
Êags
 |
PL011_FLAG_RXFF
;

204 i‡(
s
->
ªad_cou¡
 =s->
ªad_åiggî
) {

205 
s
->
öt_Àvñ
 |
PL011_INT_RX
;

206 
	`∂011_upd©e
(
s
);

208 
	}
}

210 
	$∂011_evít
(*
›aque
, 
evít
)

213 
	}
}

215 
CPURódMem‹yFunc
 *
	g∂011_ªad‚
[] = {

216 
∂011_ªad
,

217 
∂011_ªad
,

218 
∂011_ªad


221 
CPUWrôeMem‹yFunc
 *
	g∂011_wrôe‚
[] = {

222 
∂011_wrôe
,

223 
∂011_wrôe
,

224 
∂011_wrôe


227 
	$∂011_öô
(
uöt32_t
 
ba£
, *
pic
, 
úq
,

228 
Ch¨DrivîSèã
 *
chr
)

230 
iomemty≥
;

231 
∂011_°©e
 *
s
;

233 
s
 = (
∂011_°©e
 *)
	`qemu_mÆlocz
((pl011_state));

234 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
∂011_ªad‚
,

235 
∂011_wrôe‚
, 
s
);

236 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

237 
s
->
ba£
 = base;

238 
s
->
pic
 =Öic;

239 
s
->
úq
 = irq;

240 
s
->
chr
 = chr;

241 
s
->
ªad_åiggî
 = 1;

242 
s
->
iÊ
 = 0x12;

243 
s
->
¸
 = 0x300;

244 
s
->
Êags
 = 0x90;

245 i‡(
chr
){

246 
	`qemu_chr_add_h™dÀrs
(
chr
, 
∂011_ˇn_ªcõve
, 
∂011_ªcõve
,

247 
∂011_evít
, 
s
);

250 
	}
}

	@pl050.c

10 
	~"vl.h
"

13 *
	mdev
;

14 
uöt32_t
 
	mba£
;

15 
uöt32_t
 
	m¸
;

16 
uöt32_t
 
	m˛k
;

17 
uöt32_t
 
	mœ°
;

18 *
	mpic
;

19 
	m≥ndög
;

20 
	múq
;

21 
	mis_mou£
;

22 } 
	t∂050_°©e
;

24 c⁄° 
	g∂050_id
[] =

27 
	$∂050_upd©e
(*
›aque
, 
Àvñ
)

29 
∂050_°©e
 *
s
 = (∂050_°©ê*)
›aque
;

30 
øi£
;

32 
s
->
≥ndög
 = 
Àvñ
;

33 
øi£
 = (
s
->
≥ndög
 && (s->
¸
 & 0x10) != 0)

34 || (
s
->
¸
 & 0x08) != 0;

35 
	`pic_£t_úq_√w
(
s
->
pic
, s->
úq
, 
øi£
);

36 
	}
}

38 
uöt32_t
 
	$∂050_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

40 
∂050_°©e
 *
s
 = (∂050_°©ê*)
›aque
;

41 
off£t
 -
s
->
ba£
;

42 i‡(
off£t
 >= 0xfe0 && offset < 0x1000)

43  
∂050_id
[(
off£t
 - 0xfe0) >> 2];

45 
off£t
 >> 2) {

47  
s
->
¸
;

50 i‡(
s
->
≥ndög
) {

56 i‡(
s
->
≥ndög
)

57 
s
->
œ°
 = 
	`ps2_ªad_d©a
(s->
dev
);

58  
s
->
œ°
;

60  
s
->
˛k
;

62  
s
->
≥ndög
 | 2;

64 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "∂050_ªad: Bad off£à%x\n", 
off£t
);

67 
	}
}

69 
	$∂050_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

70 
uöt32_t
 
vÆue
)

72 
∂050_°©e
 *
s
 = (∂050_°©ê*)
›aque
;

73 
off£t
 -
s
->
ba£
;

74 
off£t
 >> 2) {

76 
s
->
¸
 = 
vÆue
;

77 
	`∂050_upd©e
(
s
, s->
≥ndög
);

83 i‡(
s
->
is_mou£
) {

84 
	`ps2_wrôe_mou£
(
s
->
dev
, 
vÆue
);

86 
	`ps2_wrôe_keybﬂrd
(
s
->
dev
, 
vÆue
);

90 
s
->
˛k
 = 
vÆue
;

93 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "∂050_wrôe: Bad off£à%x\n", 
off£t
);

95 
	}
}

96 
CPURódMem‹yFunc
 *
	g∂050_ªad‚
[] = {

97 
∂050_ªad
,

98 
∂050_ªad
,

99 
∂050_ªad


102 
CPUWrôeMem‹yFunc
 *
	g∂050_wrôe‚
[] = {

103 
∂050_wrôe
,

104 
∂050_wrôe
,

105 
∂050_wrôe


108 
	$∂050_öô
(
uöt32_t
 
ba£
, *
pic
, 
úq
, 
is_mou£
)

110 
iomemty≥
;

111 
∂050_°©e
 *
s
;

113 
s
 = (
∂050_°©e
 *)
	`qemu_mÆlocz
((pl050_state));

114 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
∂050_ªad‚
,

115 
∂050_wrôe‚
, 
s
);

116 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

117 
s
->
ba£
 = base;

118 
s
->
pic
 =Öic;

119 
s
->
úq
 = irq;

120 
s
->
is_mou£
 = is_mouse;

121 i‡(
is_mou£
)

122 
s
->
dev
 = 
	`ps2_mou£_öô
(
∂050_upd©e
, s);

124 
s
->
dev
 = 
	`ps2_kbd_öô
(
∂050_upd©e
, s);

126 
	}
}

	@pl080.c

10 
	~"vl.h
"

12 
	#PL080_MAX_CHANNELS
 8

	)

13 
	#PL080_CONF_E
 0x1

	)

14 
	#PL080_CONF_M1
 0x2

	)

15 
	#PL080_CONF_M2
 0x4

	)

17 
	#PL080_CCONF_H
 0x40000

	)

18 
	#PL080_CCONF_A
 0x20000

	)

19 
	#PL080_CCONF_L
 0x10000

	)

20 
	#PL080_CCONF_ITC
 0x08000

	)

21 
	#PL080_CCONF_IE
 0x04000

	)

22 
	#PL080_CCONF_E
 0x00001

	)

24 
	#PL080_CCTRL_I
 0x80000000

	)

25 
	#PL080_CCTRL_DI
 0x08000000

	)

26 
	#PL080_CCTRL_SI
 0x04000000

	)

27 
	#PL080_CCTRL_D
 0x02000000

	)

28 
	#PL080_CCTRL_S
 0x01000000

	)

31 
uöt32_t
 
	m§c
;

32 
uöt32_t
 
	mde°
;

33 
uöt32_t
 
	mŒi
;

34 
uöt32_t
 
	m˘æ
;

35 
uöt32_t
 
	mc⁄f
;

36 } 
	t∂080_ch™√l
;

39 
uöt32_t
 
	mba£
;

40 
uöt8_t
 
	mtc_öt
;

41 
uöt8_t
 
	mtc_mask
;

42 
uöt8_t
 
	mîr_öt
;

43 
uöt8_t
 
	mîr_mask
;

44 
uöt32_t
 
	mc⁄f
;

45 
uöt32_t
 
	msync
;

46 
uöt32_t
 
	mªq_sögÀ
;

47 
uöt32_t
 
	mªq_bur°
;

48 
∂080_ch™√l
 
	mch™
[
PL080_MAX_CHANNELS
];

49 
	mnch™√ls
;

51 
	mru¬ög
;

52 *
	mpic
;

53 
	múq
;

54 } 
	t∂080_°©e
;

56 c⁄° 
	g∂080_id
[] =

59 c⁄° 
	g∂081_id
[] =

62 
	$∂080_upd©e
(
∂080_°©e
 *
s
)

64 i‡((
s
->
tc_öt
 & s->
tc_mask
)

65 || (
s
->
îr_öt
 & s->
îr_mask
))

66 
	`pic_£t_úq_√w
(
s
->
pic
, s->
úq
, 1);

68 
	`pic_£t_úq_√w
(
s
->
pic
, s->
úq
, 1);

69 
	}
}

71 
	$∂080_run
(
∂080_°©e
 *
s
)

73 
c
;

74 
Êow
;

75 
∂080_ch™√l
 *
ch
;

76 
swidth
;

77 
dwidth
;

78 
xsize
;

79 
n
;

80 
§c_id
;

81 
de°_id
;

82 
size
;

83 
buff
[4];

84 
uöt32_t
 
ªq
;

86 
s
->
tc_mask
 = 0;

87 
c
 = 0; c < 
s
->
nch™√ls
; c++) {

88 i‡(
s
->
ch™
[
c
].
c⁄f
 & 
PL080_CCONF_ITC
)

89 
s
->
tc_mask
 |1 << 
c
;

90 i‡(
s
->
ch™
[
c
].
c⁄f
 & 
PL080_CCONF_IE
)

91 
s
->
îr_mask
 |1 << 
c
;

94 i‡((
s
->
c⁄f
 & 
PL080_CONF_E
) == 0)

97 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "DMAáctive\n");

100 i‡(
s
->
ru¬ög
) {

101 
s
->
ru¬ög
++;

104 
s
->
ru¬ög
 = 1;

105 
s
->
ru¬ög
) {

106 
c
 = 0; c < 
s
->
nch™√ls
; c++) {

107 
ch
 = &
s
->
ch™
[
c
];

108 
agaö
:

110 i‡((
ch
->
c⁄f
 & (
PL080_CCONF_H
 | 
PL080_CCONF_E
))

111 !
PL080_CCONF_E
)

113 
Êow
 = (
ch
->
c⁄f
 >> 11) & 7;

114 i‡(
Êow
 >= 4) {

115 
	`˝u_ab‹t
(
˝u_sögÀ_ív
,

118 
§c_id
 = (
ch
->
c⁄f
 >> 1) & 0x1f;

119 
de°_id
 = (
ch
->
c⁄f
 >> 6) & 0x1f;

120 
size
 = 
ch
->
˘æ
 & 0xfff;

121 
ªq
 = 
s
->
ªq_sögÀ
 | s->
ªq_bur°
;

122 
Êow
) {

126 i‡((
ªq
 & (1u << 
de°_id
)) == 0)

127 
size
 = 0;

130 i‡((
ªq
 & (1u << 
§c_id
)) == 0)

131 
size
 = 0;

134 i‡((
ªq
 & (1u << 
§c_id
)) == 0

135 || (
ªq
 & (1u << 
de°_id
)) == 0)

136 
size
 = 0;

139 i‡(!
size
)

146 
swidth
 = 1 << ((
ch
->
˘æ
 >> 18) & 7);

147 
dwidth
 = 1 << ((
ch
->
˘æ
 >> 21) & 7);

148 
n
 = 0;Ç < 
dwidth
;Ç+
swidth
) {

149 
	`˝u_physiˇl_mem‹y_ªad
(
ch
->
§c
, 
buff
 + 
n
, 
swidth
);

150 i‡(
ch
->
˘æ
 & 
PL080_CCTRL_SI
)

151 
ch
->
§c
 +
swidth
;

153 
xsize
 = (
dwidth
 < 
swidth
) ? swidth : dwidth;

155 
n
 = 0;Ç < 
xsize
;Ç +
dwidth
) {

156 
	`˝u_physiˇl_mem‹y_wrôe
(
ch
->
de°
 + 
n
, 
buff
 +Ç, 
dwidth
);

157 i‡(
ch
->
˘æ
 & 
PL080_CCTRL_DI
)

158 
ch
->
de°
 +
swidth
;

161 
size
--;

162 
ch
->
˘æ
 = (ch->˘æ & 0xfffff000Ë| 
size
;

163 i‡(
size
 == 0) {

165 i‡(
ch
->
Œi
) {

166 
ch
->
§c
 = 
	`ldl_phys
(ch->
Œi
);

167 
ch
->
de°
 = 
	`ldl_phys
(ch->
Œi
 + 4);

168 
ch
->
˘æ
 = 
	`ldl_phys
(ch->
Œi
 + 12);

169 
ch
->
Œi
 = 
	`ldl_phys
(ch->lli + 8);

171 
ch
->
c⁄f
 &~
PL080_CCONF_E
;

173 i‡(
ch
->
˘æ
 & 
PL080_CCTRL_I
) {

174 
s
->
tc_öt
 |1 << 
c
;

177 
agaö
;

179 i‡(--
s
->
ru¬ög
)

180 
s
->
ru¬ög
 = 1;

182 
	}
}

184 
uöt32_t
 
	$∂080_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

186 
∂080_°©e
 *
s
 = (∂080_°©ê*)
›aque
;

187 
uöt32_t
 
i
;

188 
uöt32_t
 
mask
;

190 
off£t
 -
s
->
ba£
;

191 i‡(
off£t
 >= 0xfe0 && offset < 0x1000) {

192 i‡(
s
->
nch™√ls
 == 8) {

193  
∂080_id
[(
off£t
 - 0xfe0) >> 2];

195  
∂081_id
[(
off£t
 - 0xfe0) >> 2];

198 i‡(
off£t
 >= 0x100 && offset < 0x200) {

199 
i
 = (
off£t
 & 0xe0) >> 5;

200 i‡(
i
 >
s
->
nch™√ls
)

201 
bad_off£t
;

202 
off£t
 >> 2) {

204  
s
->
ch™
[
i
].
§c
;

206  
s
->
ch™
[
i
].
de°
;

208  
s
->
ch™
[
i
].
Œi
;

210  
s
->
ch™
[
i
].
˘æ
;

212  
s
->
ch™
[
i
].
c⁄f
;

214 
bad_off£t
;

217 
off£t
 >> 2) {

219  (
s
->
tc_öt
 & s->
tc_mask
Ë| (s->
îr_öt
 & s->
îr_mask
);

221  (
s
->
tc_öt
 & s->
tc_mask
);

223  (
s
->
îr_öt
 & s->
îr_mask
);

225  
s
->
tc_öt
;

227  
s
->
îr_öt
;

229 
mask
 = 0;

230 
i
 = 0; i < 
s
->
nch™√ls
; i++) {

231 i‡(
s
->
ch™
[
i
].
c⁄f
 & 
PL080_CCONF_E
)

232 
mask
 |1 << 
i
;

234  
mask
;

242  
s
->
c⁄f
;

244  
s
->
sync
;

246 
bad_off£t
:

247 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "∂080_ªad: Bad off£à%x\n", 
off£t
);

250 
	}
}

252 
	$∂080_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

253 
uöt32_t
 
vÆue
)

255 
∂080_°©e
 *
s
 = (∂080_°©ê*)
›aque
;

256 
i
;

258 
off£t
 -
s
->
ba£
;

259 i‡(
off£t
 >= 0x100 && offset < 0x200) {

260 
i
 = (
off£t
 & 0xe0) >> 5;

261 i‡(
i
 >
s
->
nch™√ls
)

262 
bad_off£t
;

263 
off£t
 >> 2) {

265 
s
->
ch™
[
i
].
§c
 = 
vÆue
;

268 
s
->
ch™
[
i
].
de°
 = 
vÆue
;

271 
s
->
ch™
[
i
].
Œi
 = 
vÆue
;

274 
s
->
ch™
[
i
].
˘æ
 = 
vÆue
;

277 
s
->
ch™
[
i
].
c⁄f
 = 
vÆue
;

278 
	`∂080_run
(
s
);

282 
off£t
 >> 2) {

284 
s
->
tc_öt
 &~
vÆue
;

287 
s
->
îr_öt
 &~
vÆue
;

294 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "pl080_write: Soft DMAÇot implemented\n");

297 
s
->
c⁄f
 = 
vÆue
;

298 i‡(
s
->
c⁄f
 & (
PL080_CONF_M1
 | PL080_CONF_M1)) {

299 
	`˝u_ab‹t
(
˝u_sögÀ_ív
,

302 
	`∂080_run
(
s
);

305 
s
->
sync
 = 
vÆue
;

308 
bad_off£t
:

309 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "∂080_wrôe: Bad off£à%x\n", 
off£t
);

311 
	`∂080_upd©e
(
s
);

312 
	}
}

314 
CPURódMem‹yFunc
 *
	g∂080_ªad‚
[] = {

315 
∂080_ªad
,

316 
∂080_ªad
,

317 
∂080_ªad


320 
CPUWrôeMem‹yFunc
 *
	g∂080_wrôe‚
[] = {

321 
∂080_wrôe
,

322 
∂080_wrôe
,

323 
∂080_wrôe


328 *
	$∂080_öô
(
uöt32_t
 
ba£
, *
pic
, 
úq
, 
nch™√ls
)

330 
iomemty≥
;

331 
∂080_°©e
 *
s
;

333 
s
 = (
∂080_°©e
 *)
	`qemu_mÆlocz
((pl080_state));

334 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
∂080_ªad‚
,

335 
∂080_wrôe‚
, 
s
);

336 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

337 
s
->
ba£
 = base;

338 
s
->
pic
 =Öic;

339 
s
->
úq
 = irq;

340 
s
->
nch™√ls
 =Çchannels;

342  
s
;

343 
	}
}

	@pl110.c

10 
	~"vl.h
"

12 
	#PL110_CR_EN
 0x001

	)

13 
	#PL110_CR_BEBO
 0x200

	)

14 
	#PL110_CR_BEPO
 0x400

	)

15 
	#PL110_CR_PWR
 0x800

	)

17 
	e∂110_bµmode


19 
	mBPP_1
,

20 
	mBPP_2
,

21 
	mBPP_4
,

22 
	mBPP_8
,

23 
	mBPP_16
,

24 
	mBPP_32


28 
uöt32_t
 
	mba£
;

29 
Di•œySèã
 *
	mds
;

31 
	mvîßtûe
;

32 *
	mpic
;

33 
uöt32_t
 
	mtimög
[4];

34 
uöt32_t
 
	m¸
;

35 
uöt32_t
 
	mupba£
;

36 
uöt32_t
 
	mÕba£
;

37 
uöt32_t
 
	möt_°©us
;

38 
uöt32_t
 
	möt_mask
;

39 
	mcﬁs
;

40 
	mrows
;

41 
∂110_bµmode
 
	mbµ
;

42 
	mövÆid©e
;

43 
uöt32_t
 
	m∑Œëã
[256];

44 
uöt32_t
 
	møw_∑Œëã
[128];

45 
	múq
;

46 } 
	t∂110_°©e
;

48 c⁄° 
	g∂110_id
[] =

54 c⁄° 
	g∂110_vîßtûe_id
[] =

57 
	#∂110_vîßtûe_id
 
∂110_id


	)

60 
ölöe
 
uöt32_t
 
	$rgb_to_pixñ8
(
r
, 
g
, 
b
)

62  ((
r
 >> 5Ë<< 5Ë| ((
g
 >> 5Ë<< 2Ë| (
b
 >> 6);

63 
	}
}

65 
ölöe
 
uöt32_t
 
	$rgb_to_pixñ15
(
r
, 
g
, 
b
)

67  ((
r
 >> 3Ë<< 10Ë| ((
g
 >> 3Ë<< 5Ë| (
b
 >> 3);

68 
	}
}

70 
ölöe
 
uöt32_t
 
	$rgb_to_pixñ16
(
r
, 
g
, 
b
)

72  ((
r
 >> 3Ë<< 11Ë| ((
g
 >> 2Ë<< 5Ë| (
b
 >> 3);

73 
	}
}

75 
ölöe
 
uöt32_t
 
	$rgb_to_pixñ24
(
r
, 
g
, 
b
)

77  (
r
 << 16Ë| (
g
 << 8Ë| 
b
;

78 
	}
}

80 
ölöe
 
uöt32_t
 
	$rgb_to_pixñ32
(
r
, 
g
, 
b
)

82  (
r
 << 16Ë| (
g
 << 8Ë| 
b
;

83 
	}
}

85 (*
	tdøw‚
)(
	tuöt32_t
 *, 
	tuöt8_t
 *, const uint8_t *, );

87 
	#BITS
 8

	)

88 
	~"∂110_ãm∂©e.h
"

89 
	#BITS
 15

	)

90 
	~"∂110_ãm∂©e.h
"

91 
	#BITS
 16

	)

92 
	~"∂110_ãm∂©e.h
"

93 
	#BITS
 24

	)

94 
	~"∂110_ãm∂©e.h
"

95 
	#BITS
 32

	)

96 
	~"∂110_ãm∂©e.h
"

98 
	$∂110_íabÀd
(
∂110_°©e
 *
s
)

100  (
s
->
¸
 & 
PL110_CR_EN
Ë&& (s->¸ & 
PL110_CR_PWR
);

101 
	}
}

103 
	$∂110_upd©e_di•œy
(*
›aque
)

105 
∂110_°©e
 *
s
 = (∂110_°©ê*)
›aque
;

106 
døw‚
* 
‚èbÀ
;

107 
døw‚
 
‚
;

108 
uöt32_t
 *
∑Œëã
;

109 
uöt32_t
 
addr
;

110 
uöt32_t
 
ba£
;

111 
de°_width
;

112 
§c_width
;

113 
uöt8_t
 *
de°
;

114 
uöt8_t
 *
§c
;

115 
fú°
, 
œ°
 = 0;

116 
dúty
, 
√w_dúty
;

117 
i
;

119 i‡(!
	`∂110_íabÀd
(
s
))

122 
s
->
ds
->
dïth
) {

126 
‚èbÀ
 = 
∂110_døw_‚_8
;

127 
de°_width
 = 1;

130 
‚èbÀ
 = 
∂110_døw_‚_15
;

131 
de°_width
 = 2;

134 
‚èbÀ
 = 
∂110_døw_‚_16
;

135 
de°_width
 = 2;

138 
‚èbÀ
 = 
∂110_døw_‚_24
;

139 
de°_width
 = 3;

142 
‚èbÀ
 = 
∂110_døw_‚_32
;

143 
de°_width
 = 4;

146 
	`Ârötf
(
°dîr
, "pl110: Bad color depth\n");

147 
	`exô
(1);

149 i‡(
s
->
¸
 & 
PL110_CR_BEBO
)

150 
‚
 = 
‚èbÀ
[
s
->
bµ
 + 6];

151 i‡(
s
->
¸
 & 
PL110_CR_BEPO
)

152 
‚
 = 
‚èbÀ
[
s
->
bµ
 + 12];

154 
‚
 = 
‚èbÀ
[
s
->
bµ
];

156 
§c_width
 = 
s
->
cﬁs
;

157 
s
->
bµ
) {

158 
BPP_1
:

159 
§c_width
 >>= 3;

161 
BPP_2
:

162 
§c_width
 >>= 2;

164 
BPP_4
:

165 
§c_width
 >>= 1;

167 
BPP_8
:

169 
BPP_16
:

170 
§c_width
 <<= 1;

172 
BPP_32
:

173 
§c_width
 <<= 2;

176 
de°_width
 *
s
->
cﬁs
;

177 
∑Œëã
 = 
s
->pallette;

178 
ba£
 = 
s
->
upba£
;

180 i‡(
ba£
 > 0x80000000)

181 
ba£
 -= 0x80000000;

182 
§c
 = 
phys_øm_ba£
 + 
ba£
;

183 
de°
 = 
s
->
ds
->
d©a
;

184 
fú°
 = -1;

185 
addr
 = 
ba£
;

187 
dúty
 = 
	`˝u_physiˇl_mem‹y_gë_dúty
(
addr
, 
VGA_DIRTY_FLAG
);

188 
√w_dúty
 = 
dúty
;

189 
i
 = 0; i < 
s
->
rows
; i++) {

190 i‡((
addr
 & ~
TARGET_PAGE_MASK
Ë+ 
§c_width
 >
TARGET_PAGE_SIZE
) {

191 
uöt32_t
 
tmp
;

192 
√w_dúty
 = 0;

193 
tmp
 = 0;Åm∞< 
§c_width
;Åm∞+
TARGET_PAGE_SIZE
) {

194 
√w_dúty
 |
	`˝u_physiˇl_mem‹y_gë_dúty
(
addr
 + 
tmp
,

195 
VGA_DIRTY_FLAG
);

199 i‡(
dúty
 || 
√w_dúty
 || 
s
->
övÆid©e
) {

200 
	`‚
(
∑Œëã
, 
de°
, 
§c
, 
s
->
cﬁs
);

201 i‡(
fú°
 == -1)

202 
fú°
 = 
i
;

203 
œ°
 = 
i
;

205 
dúty
 = 
√w_dúty
;

206 
addr
 +
§c_width
;

207 
de°
 +
de°_width
;

208 
§c
 +
§c_width
;

210 i‡(
fú°
 < 0)

213 
s
->
övÆid©e
 = 0;

214 
	`˝u_physiˇl_mem‹y_ª£t_dúty
(
ba£
 + 
fú°
 * 
§c_width
,

215 
ba£
 + (
œ°
 + 1Ë* 
§c_width
,

216 
VGA_DIRTY_FLAG
);

217 
	`dpy_upd©e
(
s
->
ds
, 0, 
fú°
, s->
cﬁs
, 
œ°
 - first + 1);

218 
	}
}

220 
	$∂110_övÆid©e_di•œy
(* 
›aque
)

222 
∂110_°©e
 *
s
 = (∂110_°©ê*)
›aque
;

223 
s
->
övÆid©e
 = 1;

224 
	}
}

226 
	$∂110_upd©e_∑Œëã
(
∂110_°©e
 *
s
, 
n
)

228 
i
;

229 
uöt32_t
 
øw
;

230 
r
, 
g
, 
b
;

232 
øw
 = 
s
->
øw_∑Œëã
[
n
];

233 
n
 <<= 1;

234 
i
 = 0; i < 2; i++) {

235 
r
 = (
øw
 & 0x1f) << 3;

236 
øw
 >>= 5;

237 
g
 = (
øw
 & 0x1f) << 3;

238 
øw
 >>= 5;

239 
b
 = (
øw
 & 0x1f) << 3;

241 
øw
 >>= 6;

242 
s
->
ds
->
dïth
) {

244 
s
->
∑Œëã
[
n
] = 
	`rgb_to_pixñ8
(
r
, 
g
, 
b
);

247 
s
->
∑Œëã
[
n
] = 
	`rgb_to_pixñ15
(
r
, 
g
, 
b
);

250 
s
->
∑Œëã
[
n
] = 
	`rgb_to_pixñ16
(
r
, 
g
, 
b
);

254 
s
->
∑Œëã
[
n
] = 
	`rgb_to_pixñ32
(
r
, 
g
, 
b
);

257 
n
++;

259 
	}
}

261 
	$∂110_ªsize
(
∂110_°©e
 *
s
, 
width
, 
height
)

263 i‡(
width
 !
s
->
cﬁs
 || 
height
 !s->
rows
) {

264 i‡(
	`∂110_íabÀd
(
s
)) {

265 
	`dpy_ªsize
(
s
->
ds
, 
width
, 
height
);

268 
s
->
cﬁs
 = 
width
;

269 
s
->
rows
 = 
height
;

270 
	}
}

273 
	$∂110_upd©e
(
∂110_°©e
 *
s
)

276 
	}
}

278 
uöt32_t
 
	$∂110_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

280 
∂110_°©e
 *
s
 = (∂110_°©ê*)
›aque
;

282 
off£t
 -
s
->
ba£
;

283 i‡(
off£t
 >= 0xfe0 && offset < 0x1000) {

284 i‡(
s
->
vîßtûe
)

285  
∂110_vîßtûe_id
[(
off£t
 - 0xfe0) >> 2];

287  
∂110_id
[(
off£t
 - 0xfe0) >> 2];

289 i‡(
off£t
 >= 0x200 && offset < 0x400) {

290  
s
->
øw_∑Œëã
[(
off£t
 - 0x200) >> 2];

292 
off£t
 >> 2) {

294  
s
->
timög
[0];

296  
s
->
timög
[1];

298  
s
->
timög
[2];

300  
s
->
timög
[3];

302  
s
->
upba£
;

304  
s
->
Õba£
;

306  
s
->
öt_mask
;

308  
s
->
¸
;

310  
s
->
öt_°©us
;

312  
s
->
öt_°©us
 & s->
öt_mask
;

315  
s
->
upba£
;

317  
s
->
Õba£
;

319 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "∂110_ªad: Bad off£à%x\n", 
off£t
);

322 
	}
}

324 
	$∂110_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

325 
uöt32_t
 
vÆ
)

327 
∂110_°©e
 *
s
 = (∂110_°©ê*)
›aque
;

328 
n
;

332 
s
->
övÆid©e
 = 1;

333 
off£t
 -
s
->
ba£
;

334 i‡(
off£t
 >= 0x200 && offset < 0x400) {

336 
n
 = (
off£t
 - 0x200) >> 2;

337 
s
->
øw_∑Œëã
[(
off£t
 - 0x200Ë>> 2] = 
vÆ
;

338 
	`∂110_upd©e_∑Œëã
(
s
, 
n
);

341 
off£t
 >> 2) {

343 
s
->
timög
[0] = 
vÆ
;

344 
n
 = ((
vÆ
 & 0xfc) + 4) * 4;

345 
	`∂110_ªsize
(
s
, 
n
, s->
rows
);

348 
s
->
timög
[1] = 
vÆ
;

349 
n
 = (
vÆ
 & 0x3ff) + 1;

350 
	`∂110_ªsize
(
s
, s->
cﬁs
, 
n
);

353 
s
->
timög
[2] = 
vÆ
;

356 
s
->
timög
[3] = 
vÆ
;

359 
s
->
upba£
 = 
vÆ
;

362 
s
->
Õba£
 = 
vÆ
;

365 i‡(
s
->
vîßtûe
)

366 
c⁄åﬁ
;

367 
imsc
:

368 
s
->
öt_mask
 = 
vÆ
;

369 
	`∂110_upd©e
(
s
);

372 i‡(
s
->
vîßtûe
)

373 
imsc
;

374 
c⁄åﬁ
:

375 
s
->
¸
 = 
vÆ
;

376 
s
->
bµ
 = (
vÆ
 >> 1) & 7;

377 i‡(
	`∂110_íabÀd
(
s
)) {

378 
	`dpy_ªsize
(
s
->
ds
, s->
cﬁs
, s->
rows
);

382 
s
->
öt_°©us
 &~
vÆ
;

383 
	`∂110_upd©e
(
s
);

386 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "∂110_wrôe: Bad off£à%x\n", 
off£t
);

388 
	}
}

390 
CPURódMem‹yFunc
 *
	g∂110_ªad‚
[] = {

391 
∂110_ªad
,

392 
∂110_ªad
,

393 
∂110_ªad


396 
CPUWrôeMem‹yFunc
 *
	g∂110_wrôe‚
[] = {

397 
∂110_wrôe
,

398 
∂110_wrôe
,

399 
∂110_wrôe


402 *
	$∂110_öô
(
Di•œySèã
 *
ds
, 
uöt32_t
 
ba£
, *
pic
, 
úq
,

403 
vîßtûe
)

405 
∂110_°©e
 *
s
;

406 
iomemty≥
;

408 
s
 = (
∂110_°©e
 *)
	`qemu_mÆlocz
((pl110_state));

409 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
∂110_ªad‚
,

410 
∂110_wrôe‚
, 
s
);

411 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

412 
s
->
ba£
 = base;

413 
s
->
ds
 = ds;

414 
s
->
vîßtûe
 = versatile;

415 
s
->
pic
 =Öic;

416 
s
->
úq
 = irq;

417 
	`gøphic_c⁄sﬁe_öô
(
ds
, 
∂110_upd©e_di•œy
, 
∂110_övÆid©e_di•œy
,

418 
NULL
, 
s
);

420  
s
;

421 
	}
}

	@pl110_template.h

12 #i‚de‡
ORDER


14 #i‡
BITS
 == 8

15 
	#COPY_PIXEL
(
to
, 
‰om
Ë*—o++Ë
	)
from

16 #ñi‡
BITS
 == 15 || BITS == 16

17 
	#COPY_PIXEL
(
to
, 
‰om
Ë*(
uöt16_t
 *Èÿ‰om;Åÿ+2;

	)

18 #ñi‡
BITS
 == 24

19 
	#COPY_PIXEL
(
to
, 
‰om
) \

20 *(
to
++Ë
‰om
; *—o++Ë(‰omË>> 8; *—o++Ë(‰omË>> 16

	)

21 #ñi‡
BITS
 == 32

22 
	#COPY_PIXEL
(
to
, 
‰om
Ë*(
uöt32_t
 *Èÿ‰om;Åÿ+4;

	)

24 #îr‹ 
unknown
 
bô
 
dïth


27 
	#ORDER
 0

	)

28 
	~"∂110_ãm∂©e.h
"

29 
	#ORDER
 1

	)

30 
	~"∂110_ãm∂©e.h
"

31 
	#ORDER
 2

	)

32 
	~"∂110_ãm∂©e.h
"

34 
døw‚
 
glue
(
∂110_døw_‚_
,
BITS
)[18] =

36 
glue
(
∂110_døw_löe1_lbÕ
,
BITS
),

37 
glue
(
∂110_døw_löe2_lbÕ
,
BITS
),

38 
glue
(
∂110_døw_löe4_lbÕ
,
BITS
),

39 
glue
(
∂110_døw_löe8_lbÕ
,
BITS
),

40 
glue
(
∂110_døw_löe16_lbÕ
,
BITS
),

41 
glue
(
∂110_døw_löe32_lbÕ
,
BITS
),

43 
glue
(
∂110_døw_löe1_bbbp
,
BITS
),

44 
glue
(
∂110_døw_löe2_bbbp
,
BITS
),

45 
glue
(
∂110_døw_löe4_bbbp
,
BITS
),

46 
glue
(
∂110_døw_löe8_bbbp
,
BITS
),

47 
glue
(
∂110_døw_löe16_bbbp
,
BITS
),

48 
glue
(
∂110_døw_löe32_bbbp
,
BITS
),

50 
glue
(
∂110_døw_löe1_lbbp
,
BITS
),

51 
glue
(
∂110_døw_löe2_lbbp
,
BITS
),

52 
glue
(
∂110_døw_löe4_lbbp
,
BITS
),

53 
glue
(
∂110_døw_löe8_lbbp
,
BITS
),

54 
glue
(
∂110_døw_löe16_lbbp
,
BITS
),

55 
glue
(
∂110_døw_löe32_lbbp
,
BITS
)

58 #unde‡
BITS


59 #unde‡
COPY_PIXEL


63 #i‡
ORDER
 == 0

64 
	#NAME
 
	`glue
(
lbÕ
, 
BITS
)

	)

65 #ifde‡
WORDS_BIGENDIAN


66 
	#SWAP_WORDS
 1

	)

68 #ñi‡
ORDER
 == 1

69 
	#NAME
 
	`glue
(
bbbp
, 
BITS
)

	)

70 #i‚de‡
WORDS_BIGENDIAN


71 
	#SWAP_WORDS
 1

	)

74 
	#SWAP_PIXELS
 1

	)

75 
	#NAME
 
	`glue
(
lbbp
, 
BITS
)

	)

76 #ifde‡
WORDS_BIGENDIAN


77 
	#SWAP_WORDS
 1

	)

81 
	#FN_2
(
x
, 
y
Ë
	`FN
(x, yËFN(x+1, y)

	)

82 
	#FN_4
(
x
, 
y
Ë
	`FN_2
(x, yËFN_2(x+2, y)

	)

83 
	#FN_8
(
y
Ë
	`FN_4
(0, yËFN_4(4, y)

	)

85 
	$glue
(
∂110_døw_löe1_
,
NAME
)(
uöt32_t
 *
∑Œëã
, 
uöt8_t
 *
d
, c⁄° uöt8_à*
§c
, 
width
)

87 
uöt32_t
 
d©a
;

88 
width
 > 0) {

89 
d©a
 = *(
uöt32_t
 *)
§c
;

90 #ifde‡
SWAP_PIXELS


91 
	#FN
(
x
, 
y
Ë
	`COPY_PIXEL
(
d
, 
∑Œëã
[(
d©a
 >> (y + 7 - (x))Ë& 1]);

	)

93 
	#FN
(
x
, 
y
Ë
	`COPY_PIXEL
(
d
, 
∑Œëã
[(
d©a
 >> ((xË+ y)Ë& 1]);

	)

95 #ifde‡
SWAP_WORDS


96 
	`FN_8
(24)

97 
	`FN_8
(16)

98 
	`FN_8
(8)

99 
	`FN_8
(0)

101 
	`FN_8
(0)

102 
	`FN_8
(8)

103 
	`FN_8
(16)

104 
	`FN_8
(24)

106 #unde‡
FN


107 
width
 -= 32;

108 
§c
 += 4;

110 
	}
}

112 
	$glue
(
∂110_døw_löe2_
,
NAME
)(
uöt32_t
 *
∑Œëã
, 
uöt8_t
 *
d
, c⁄° uöt8_à*
§c
, 
width
)

114 
uöt32_t
 
d©a
;

115 
width
 > 0) {

116 
d©a
 = *(
uöt32_t
 *)
§c
;

117 #ifde‡
SWAP_PIXELS


118 
	#FN
(
x
, 
y
Ë
	`COPY_PIXEL
(
d
, 
∑Œëã
[(
d©a
 >> (y + 6 - (x)*2)Ë& 3]);

	)

120 
	#FN
(
x
, 
y
Ë
	`COPY_PIXEL
(
d
, 
∑Œëã
[(
d©a
 >> ((x)*2 + y)Ë& 3]);

	)

122 #ifde‡
SWAP_WORDS


123 
	`FN_4
(0, 24)

124 
	`FN_4
(0, 16)

125 
	`FN_4
(0, 8)

126 
	`FN_4
(0, 0)

128 
	`FN_4
(0, 0)

129 
	`FN_4
(0, 8)

130 
	`FN_4
(0, 16)

131 
	`FN_4
(0, 24)

133 #unde‡
FN


134 
width
 -= 16;

135 
§c
 += 4;

137 
	}
}

139 
	$glue
(
∂110_døw_löe4_
,
NAME
)(
uöt32_t
 *
∑Œëã
, 
uöt8_t
 *
d
, c⁄° uöt8_à*
§c
, 
width
)

141 
uöt32_t
 
d©a
;

142 
width
 > 0) {

143 
d©a
 = *(
uöt32_t
 *)
§c
;

144 #ifde‡
SWAP_PIXELS


145 
	#FN
(
x
, 
y
Ë
	`COPY_PIXEL
(
d
, 
∑Œëã
[(
d©a
 >> (y + 4 - (x)*4)Ë& 0xf]);

	)

147 
	#FN
(
x
, 
y
Ë
	`COPY_PIXEL
(
d
, 
∑Œëã
[(
d©a
 >> ((x)*4 + y)Ë& 0xf]);

	)

149 #ifde‡
SWAP_WORDS


150 
	`FN_2
(0, 24)

151 
	`FN_2
(0, 16)

152 
	`FN_2
(0, 8)

153 
	`FN_2
(0, 0)

155 
	`FN_2
(0, 0)

156 
	`FN_2
(0, 8)

157 
	`FN_2
(0, 16)

158 
	`FN_2
(0, 24)

160 #unde‡
FN


161 
width
 -= 8;

162 
§c
 += 4;

164 
	}
}

166 
	$glue
(
∂110_døw_löe8_
,
NAME
)(
uöt32_t
 *
∑Œëã
, 
uöt8_t
 *
d
, c⁄° uöt8_à*
§c
, 
width
)

168 
uöt32_t
 
d©a
;

169 
width
 > 0) {

170 
d©a
 = *(
uöt32_t
 *)
§c
;

171 
	#FN
(
x
Ë
	`COPY_PIXEL
(
d
, 
∑Œëã
[(
d©a
 >> (x)Ë& 0xff]);

	)

172 #ifde‡
SWAP_WORDS


173 
	`FN
(24)

174 
	`FN
(16)

175 
	`FN
(8)

176 
	`FN
(0)

178 
	`FN
(0)

179 
	`FN
(8)

180 
	`FN
(16)

181 
	`FN
(24)

183 #unde‡
FN


184 
width
 -= 4;

185 
§c
 += 4;

187 
	}
}

189 
	$glue
(
∂110_døw_löe16_
,
NAME
)(
uöt32_t
 *
∑Œëã
, 
uöt8_t
 *
d
, c⁄° uöt8_à*
§c
, 
width
)

191 
uöt32_t
 
d©a
;

192 
r
, 
g
, 
b
;

193 
width
 > 0) {

194 
d©a
 = *(
uöt32_t
 *)
§c
;

195 #ifde‡
SWAP_WORDS


196 
d©a
 = 
	`bsw≠32
(data);

199 
r
 = 
d©a
 & 0x1f;

200 
d©a
 >>= 5;

201 
g
 = 
d©a
 & 0x3f;

202 
d©a
 >>= 6;

203 
b
 = 
d©a
 & 0x1f;

204 
d©a
 >>= 5;

206 
r
 = (
d©a
 & 0x1f) << 3;

207 
d©a
 >>= 5;

208 
g
 = (
d©a
 & 0x3f) << 2;

209 
d©a
 >>= 6;

210 
b
 = (
d©a
 & 0x1f) << 3;

211 
d©a
 >>= 5;

213 
	`COPY_PIXEL
(
d
, 
	`glue
(
rgb_to_pixñ
,
BITS
)(
r
, 
g
, 
b
));

214 
r
 = (
d©a
 & 0x1f) << 3;

215 
d©a
 >>= 5;

216 
g
 = (
d©a
 & 0x3f) << 2;

217 
d©a
 >>= 6;

218 
b
 = (
d©a
 & 0x1f) << 3;

219 
d©a
 >>= 5;

220 
	`COPY_PIXEL
(
d
, 
	`glue
(
rgb_to_pixñ
,
BITS
)(
r
, 
g
, 
b
));

221 
width
 -= 2;

222 
§c
 += 4;

224 
	}
}

226 
	$glue
(
∂110_døw_löe32_
,
NAME
)(
uöt32_t
 *
∑Œëã
, 
uöt8_t
 *
d
, c⁄° uöt8_à*
§c
, 
width
)

228 
uöt32_t
 
d©a
;

229 
r
, 
g
, 
b
;

230 
width
 > 0) {

231 
d©a
 = *(
uöt32_t
 *)
§c
;

232 #ifde‡
SWAP_WORDS


233 
r
 = 
d©a
 & 0xff;

234 
g
 = (
d©a
 >> 8) & 0xff;

235 
b
 = (
d©a
 >> 16) & 0xff;

237 
r
 = (
d©a
 >> 24) & 0xff;

238 
g
 = (
d©a
 >> 16) & 0xff;

239 
b
 = (
d©a
 >> 8) & 0xff;

241 
	`COPY_PIXEL
(
d
, 
	`glue
(
rgb_to_pixñ
,
BITS
)(
r
, 
g
, 
b
));

242 
width
--;

243 
§c
 += 4;

245 
	}
}

247 #unde‡
SWAP_PIXELS


248 #unde‡
NAME


249 #unde‡
SWAP_WORDS


250 #unde‡
ORDER


	@pl190.c

10 
	~"vl.h
"

11 
	~"¨m_pic.h
"

17 
	#PL190_NUM_PRIO
 17

	)

20 
¨m_pic_h™dÀr
 
	mh™dÀr
;

21 
uöt32_t
 
	mba£
;

22 
Di•œySèã
 *
	mds
;

23 
uöt32_t
 
	mÀvñ
;

24 
uöt32_t
 
	mso·_Àvñ
;

25 
uöt32_t
 
	múq_íabÀ
;

26 
uöt32_t
 
	mfiq_£À˘
;

27 
uöt32_t
 
	mdeÁu…_addr
;

28 
uöt8_t
 
	mve˘_c⁄åﬁ
[16];

29 
uöt32_t
 
	mve˘_addr
[
PL190_NUM_PRIO
];

31 
uöt32_t
 
	m¥io_mask
[
PL190_NUM_PRIO
 + 1];

32 
	m¥Ÿe˘ed
;

34 
	m¥i‹ôy
;

35 
	m¥ev_¥io
[
PL190_NUM_PRIO
];

36 *
	m∑ª¡
;

37 
	múq
;

38 
	mfiq
;

39 } 
	t∂190_°©e
;

41 c⁄° 
	g∂190_id
[] =

44 
ölöe
 
uöt32_t
 
	$∂190_úq_Àvñ
(
∂190_°©e
 *
s
)

46  (
s
->
Àvñ
 | s->
so·_Àvñ
Ë& s->
úq_íabÀ
 & ~s->
fiq_£À˘
;

47 
	}
}

50 
	$∂190_upd©e
(
∂190_°©e
 *
s
)

52 
uöt32_t
 
Àvñ
 = 
	`∂190_úq_Àvñ
(
s
);

53 
£t
;

55 
£t
 = (
Àvñ
 & 
s
->
¥io_mask
[s->
¥i‹ôy
]) != 0;

56 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
úq
, 
£t
);

57 
£t
 = ((
s
->
Àvñ
 | s->
so·_Àvñ
Ë& s->
fiq_£À˘
) != 0;

58 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
fiq
, 
£t
);

59 
	}
}

61 
	$∂190_£t_úq
(*
›aque
, 
úq
, 
Àvñ
)

63 
∂190_°©e
 *
s
 = (∂190_°©ê*)
›aque
;

65 i‡(
Àvñ
)

66 
s
->
Àvñ
 |1u << 
úq
;

68 
s
->
Àvñ
 &~(1u << 
úq
);

69 
	`∂190_upd©e
(
s
);

70 
	}
}

72 
	$∂190_upd©e_ve˘‹s
(
∂190_°©e
 *
s
)

74 
uöt32_t
 
mask
;

75 
i
;

76 
n
;

78 
mask
 = 0;

79 
i
 = 0; i < 16; i++)

81 
s
->
¥io_mask
[
i
] = 
mask
;

82 i‡(
s
->
ve˘_c⁄åﬁ
[
i
] & 0x20)

84 
n
 = 
s
->
ve˘_c⁄åﬁ
[
i
] & 0x1f;

85 
mask
 |1 << 
n
;

88 
s
->
¥io_mask
[16] = 
mask
;

89 
	`∂190_upd©e
(
s
);

90 
	}
}

92 
uöt32_t
 
	$∂190_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

94 
∂190_°©e
 *
s
 = (∂190_°©ê*)
›aque
;

95 
i
;

97 
off£t
 -
s
->
ba£
;

98 i‡(
off£t
 >= 0xfe0 && offset < 0x1000) {

99  
∂190_id
[(
off£t
 - 0xfe0) >> 2];

101 i‡(
off£t
 >= 0x100 && offset < 0x140) {

102  
s
->
ve˘_addr
[(
off£t
 - 0x100) >> 2];

104 i‡(
off£t
 >= 0x200 && offset < 0x240) {

105  
s
->
ve˘_c⁄åﬁ
[(
off£t
 - 0x200) >> 2];

107 
off£t
 >> 2) {

109  
	`∂190_úq_Àvñ
(
s
);

111  (
s
->
Àvñ
 | s->
so·_Àvñ
Ë& s->
fiq_£À˘
;

113  
s
->
Àvñ
 | s->
so·_Àvñ
;

115  
s
->
fiq_£À˘
;

117  
s
->
úq_íabÀ
;

119  
s
->
so·_Àvñ
;

121  
s
->
¥Ÿe˘ed
;

125 
i
 = 0; i < 
s
->
¥i‹ôy
; i++)

127 i‡((
s
->
Àvñ
 | s->
so·_Àvñ
Ë& s->
¥io_mask
[
i
])

132 i‡(
i
 =
PL190_NUM_PRIO
)

133  
s
->
ve˘_addr
[16];

134 i‡(
i
 < 
s
->
¥i‹ôy
)

136 
s
->
¥ev_¥io
[
i
] = s->
¥i‹ôy
;

137 
s
->
¥i‹ôy
 = 
i
;

138 
	`∂190_upd©e
(
s
);

140  
s
->
ve˘_addr
[s->
¥i‹ôy
];

142  
s
->
ve˘_addr
[16];

144 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "∂190_ªad: Bad off£à%x\n", 
off£t
);

147 
	}
}

149 
	$∂190_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
, 
uöt32_t
 
vÆ
)

151 
∂190_°©e
 *
s
 = (∂190_°©ê*)
›aque
;

153 
off£t
 -
s
->
ba£
;

154 i‡(
off£t
 >= 0x100 && offset < 0x140) {

155 
s
->
ve˘_addr
[(
off£t
 - 0x100Ë>> 2] = 
vÆ
;

156 
	`∂190_upd©e_ve˘‹s
(
s
);

159 i‡(
off£t
 >= 0x200 && offset < 0x240) {

160 
s
->
ve˘_c⁄åﬁ
[(
off£t
 - 0x200Ë>> 2] = 
vÆ
;

161 
	`∂190_upd©e_ve˘‹s
(
s
);

164 
off£t
 >> 2) {

170 
s
->
fiq_£À˘
 = 
vÆ
;

173 
s
->
úq_íabÀ
 |
vÆ
;

176 
s
->
úq_íabÀ
 &~
vÆ
;

179 
s
->
so·_Àvñ
 |
vÆ
;

182 
s
->
so·_Àvñ
 &~
vÆ
;

186 
s
->
¥Ÿe˘ed
 = 
vÆ
 & 1;

191 i‡(
s
->
¥i‹ôy
 < 
PL190_NUM_PRIO
)

192 
s
->
¥i‹ôy
 = s->
¥ev_¥io
[s->priority];

195 
s
->
deÁu…_addr
 = 
vÆ
;

198 i‡(
vÆ
)

199 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "pl190: Test modeÇot implemented\n");

202 
	`˝u_ab‹t
(
˝u_sögÀ_ív
, "∂190_wrôe: Bad off£à%x\n", 
off£t
);

205 
	`∂190_upd©e
(
s
);

206 
	}
}

208 
CPURódMem‹yFunc
 *
	g∂190_ªad‚
[] = {

209 
∂190_ªad
,

210 
∂190_ªad
,

211 
∂190_ªad


214 
CPUWrôeMem‹yFunc
 *
	g∂190_wrôe‚
[] = {

215 
∂190_wrôe
,

216 
∂190_wrôe
,

217 
∂190_wrôe


220 
	$∂190_ª£t
(
∂190_°©e
 *
s
)

222 
i
;

224 
i
 = 0; i < 16; i++)

226 
s
->
ve˘_addr
[
i
] = 0;

227 
s
->
ve˘_c⁄åﬁ
[
i
] = 0;

229 
s
->
ve˘_addr
[16] = 0;

230 
s
->
¥io_mask
[17] = 0xffffffff;

231 
s
->
¥i‹ôy
 = 
PL190_NUM_PRIO
;

232 
	`∂190_upd©e_ve˘‹s
(
s
);

233 
	}
}

235 *
	$∂190_öô
(
uöt32_t
 
ba£
, *
∑ª¡
, 
úq
, 
fiq
)

237 
∂190_°©e
 *
s
;

238 
iomemty≥
;

240 
s
 = (
∂190_°©e
 *)
	`qemu_mÆlocz
((pl190_state));

241 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
∂190_ªad‚
,

242 
∂190_wrôe‚
, 
s
);

243 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

244 
s
->
h™dÀr
 = 
∂190_£t_úq
;

245 
s
->
ba£
 = base;

246 
s
->
∑ª¡
 =Öarent;

247 
s
->
úq
 = irq;

248 
s
->
fiq
 = fiq;

249 
	`∂190_ª£t
(
s
);

251  
s
;

252 
	}
}

	@ppc.c

24 
	~"vl.h
"

25 
	~"m48t59.h
"

31 
	sµc_tb_t
 {

33 
öt64_t
 
	mtb_off£t
;

34 
uöt32_t
 
	mtb_‰eq
;

36 
uöt64_t
 
	mde¸_√xt
;

37 
QEMUTimî
 *
	mde¸_timî
;

40 
ölöe
 
uöt64_t
 
	$˝u_µc_gë_tb
 (
µc_tb_t
 *
tb_ív
)

43  
	`muldiv64
(
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ 
tb_ív
->
tb_off£t
,

44 
tb_ív
->
tb_‰eq
, 
ticks_≥r_£c
);

45 
	}
}

47 
uöt32_t
 
	$˝u_µc_lﬂd_tbl
 (
CPUSèã
 *
ív
)

49 
µc_tb_t
 *
tb_ív
 = 
ív
->tb_env;

50 
uöt64_t
 
tb
;

52 
tb
 = 
	`˝u_µc_gë_tb
(
tb_ív
);

53 #ifde‡
DEBUG_TB


55 
œ°_time
;

56 
now
;

57 
now
 = 
	`time
(
NULL
);

58 i‡(
œ°_time
 !
now
) {

59 
œ°_time
 = 
now
;

60 
	`¥ötf
("%s:Åb=0x%016lx %d %08lx\n",

61 
__func__
, 
tb
, 
now
, 
tb_ív
->
tb_off£t
);

66  
tb
 & 0xFFFFFFFF;

67 
	}
}

69 
uöt32_t
 
	$˝u_µc_lﬂd_tbu
 (
CPUSèã
 *
ív
)

71 
µc_tb_t
 *
tb_ív
 = 
ív
->tb_env;

72 
uöt64_t
 
tb
;

74 
tb
 = 
	`˝u_µc_gë_tb
(
tb_ív
);

75 #ifde‡
DEBUG_TB


76 
	`¥ötf
("%s:Åb=0x%016lx\n", 
__func__
, 
tb
);

78  
tb
 >> 32;

79 
	}
}

81 
	$˝u_µc_°‹e_tb
 (
µc_tb_t
 *
tb_ív
, 
uöt64_t
 
vÆue
)

83 
tb_ív
->
tb_off£t
 = 
	`muldiv64
(
vÆue
, 
ticks_≥r_£c
,Åb_ív->
tb_‰eq
)

84 - 
	`qemu_gë_˛ock
(
vm_˛ock
);

85 #ifde‡
DEBUG_TB


86 
	`¥ötf
("%s:Åb=0x%016lx off£t=%08x\n", 
__func__
, 
vÆue
);

88 
	}
}

90 
	$˝u_µc_°‹e_tbu
 (
CPUSèã
 *
ív
, 
uöt32_t
 
vÆue
)

92 
µc_tb_t
 *
tb_ív
 = 
ív
->tb_env;

94 
	`˝u_µc_°‹e_tb
(
tb_ív
,

95 ((
uöt64_t
)
vÆue
 << 32Ë| 
	`˝u_µc_lﬂd_tbl
(
ív
));

96 
	}
}

98 
	$˝u_µc_°‹e_tbl
 (
CPUSèã
 *
ív
, 
uöt32_t
 
vÆue
)

100 
µc_tb_t
 *
tb_ív
 = 
ív
->tb_env;

102 
	`˝u_µc_°‹e_tb
(
tb_ív
,

103 ((
uöt64_t
)
	`˝u_µc_lﬂd_tbu
(
ív
Ë<< 32Ë| 
vÆue
);

104 
	}
}

106 
uöt32_t
 
	$˝u_µc_lﬂd_de¸
 (
CPUSèã
 *
ív
)

108 
µc_tb_t
 *
tb_ív
 = 
ív
->tb_env;

109 
uöt32_t
 
de¸
;

110 
öt64_t
 
diff
;

112 
diff
 = 
tb_ív
->
de¸_√xt
 - 
	`qemu_gë_˛ock
(
vm_˛ock
);

113 i‡(
diff
 >= 0)

114 
de¸
 = 
	`muldiv64
(
diff
, 
tb_ív
->
tb_‰eq
, 
ticks_≥r_£c
);

116 
de¸
 = -
	`muldiv64
(-
diff
, 
tb_ív
->
tb_‰eq
, 
ticks_≥r_£c
);

117 #i‡
	`deföed
(
DEBUG_TB
)

118 
	`¥ötf
("%s: 0x%08x\n", 
__func__
, 
de¸
);

120  
de¸
;

121 
	}
}

126 
ölöe
 
	$˝u_µc_de¸_ex˝
 (
CPUSèã
 *
ív
)

129 #ifde‡
DEBUG_TB


130 
	`¥ötf
("raise decrementerÉxception\n");

132 
	`˝u_öãºu±
(
ív
, 
CPU_INTERRUPT_TIMER
);

133 
	}
}

135 
	$_˝u_µc_°‹e_de¸
 (
CPUSèã
 *
ív
, 
uöt32_t
 
de¸
,

136 
uöt32_t
 
vÆue
, 
is_ex˝
)

138 
µc_tb_t
 *
tb_ív
 = 
ív
->tb_env;

139 
uöt64_t
 
now
, 
√xt
;

141 #ifde‡
DEBUG_TB


142 
	`¥ötf
("%s: 0x%08x => 0x%08x\n", 
__func__
, 
de¸
, 
vÆue
);

144 
now
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

145 
√xt
 = 
now
 + 
	`muldiv64
(
vÆue
, 
ticks_≥r_£c
, 
tb_ív
->
tb_‰eq
);

146 i‡(
is_ex˝
)

147 
√xt
 +
tb_ív
->
de¸_√xt
 - 
now
;

148 i‡(
√xt
 =
now
)

149 
√xt
++;

150 
tb_ív
->
de¸_√xt
 = 
√xt
;

152 
	`qemu_mod_timî
(
tb_ív
->
de¸_timî
, 
√xt
);

156 i‡((
vÆue
 & 0x80000000Ë&& !(
de¸
 & 0x80000000))

157 
	`˝u_µc_de¸_ex˝
(
ív
);

158 
	}
}

160 
	$˝u_µc_°‹e_de¸
 (
CPUSèã
 *
ív
, 
uöt32_t
 
vÆue
)

162 
	`_˝u_µc_°‹e_de¸
(
ív
, 
	`˝u_µc_lﬂd_de¸
”nv), 
vÆue
, 0);

163 
	}
}

165 
	$˝u_µc_de¸_cb
 (*
›aque
)

167 
	`_˝u_µc_°‹e_de¸
(
›aque
, 0x00000000, 0xFFFFFFFF, 1);

168 
	}
}

171 
µc_tb_t
 *
	$˝u_µc_tb_öô
 (
CPUSèã
 *
ív
, 
uöt32_t
 
‰eq
)

173 
µc_tb_t
 *
tb_ív
;

175 
tb_ív
 = 
	`qemu_mÆlocz
((
µc_tb_t
));

176 i‡(
tb_ív
 =
NULL
)

177  
NULL
;

178 
ív
->
tb_ív
 =Åb_env;

179 i‡(
tb_ív
->
tb_‰eq
 == 0 || 1) {

180 
tb_ív
->
tb_‰eq
 = 
‰eq
;

182 
tb_ív
->
de¸_timî
 =

183 
	`qemu_√w_timî
(
vm_˛ock
, &
˝u_µc_de¸_cb
, 
ív
);

188 
	`_˝u_µc_°‹e_de¸
(
ív
, 0xFFFFFFFF, 0xFFFFFFFF, 0);

191  
tb_ív
;

192 
	}
}

197 
	$˝u_µc_ª£t
 (
CPUSèã
 *
ív
)

199 
	`¥ötf
("Resetásked... StopÉmulation\n");

200 
	`ab‹t
();

201 
	}
}

206 
	$PPC_debug_wrôe
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

208 
addr
 &= 0xF;

209 
addr
) {

211 
	`¥ötf
("%c", 
vÆ
);

214 
	`¥ötf
("\n");

215 
	`fÊush
(
°dout
);

218 
	`¥ötf
("SëÜogÀvñÅÿ%04x\n", 
vÆ
);

219 
	`˝u_£t_log
(
vÆ
 | 0x100);

222 
	}
}

226 
	$NVRAM_£t_byã
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
, 
uöt8_t
 
vÆue
)

228 
	`m48t59_wrôe
(
nvøm
, 
addr
, 
vÆue
);

229 
	}
}

231 
uöt8_t
 
	$NVRAM_gë_byã
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
)

233  
	`m48t59_ªad
(
nvøm
, 
addr
);

234 
	}
}

236 
	$NVRAM_£t_w‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
, 
uöt16_t
 
vÆue
)

238 
	`m48t59_wrôe
(
nvøm
, 
addr
, 
vÆue
 >> 8);

239 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 1, 
vÆue
 & 0xFF);

240 
	}
}

242 
uöt16_t
 
	$NVRAM_gë_w‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
)

244 
uöt16_t
 
tmp
;

246 
tmp
 = 
	`m48t59_ªad
(
nvøm
, 
addr
) << 8;

247 
tmp
 |
	`m48t59_ªad
(
nvøm
, 
addr
 + 1);

248  
tmp
;

249 
	}
}

251 
	$NVRAM_£t_lw‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
, uöt32_à
vÆue
)

253 
	`m48t59_wrôe
(
nvøm
, 
addr
, 
vÆue
 >> 24);

254 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 1, (
vÆue
 >> 16) & 0xFF);

255 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 2, (
vÆue
 >> 8) & 0xFF);

256 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 3, 
vÆue
 & 0xFF);

257 
	}
}

259 
uöt32_t
 
	$NVRAM_gë_lw‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
)

261 
uöt32_t
 
tmp
;

263 
tmp
 = 
	`m48t59_ªad
(
nvøm
, 
addr
) << 24;

264 
tmp
 |
	`m48t59_ªad
(
nvøm
, 
addr
 + 1) << 16;

265 
tmp
 |
	`m48t59_ªad
(
nvøm
, 
addr
 + 2) << 8;

266 
tmp
 |
	`m48t59_ªad
(
nvøm
, 
addr
 + 3);

267  
tmp
;

268 
	}
}

270 
	$NVRAM_£t_°rög
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
,

271 c⁄° *
°r
, 
uöt32_t
 
max
)

273 
i
;

275 
i
 = 0; i < 
max
 && 
°r
[i] != '\0'; i++) {

276 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 
i
, 
°r
[i]);

278 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 
max
 - 1, '\0');

279 
	}
}

281 
	$NVRAM_gë_°rög
 (
m48t59_t
 *
nvøm
, 
uöt8_t
 *
d°
, 
uöt16_t
 
addr
, 
max
)

283 
i
;

285 
	`mem£t
(
d°
, 0, 
max
);

286 
i
 = 0; i < 
max
; i++) {

287 
d°
[
i
] = 
	`NVRAM_gë_byã
(
nvøm
, 
addr
 + i);

288 i‡(
d°
[
i
] == '\0')

292  
i
;

293 
	}
}

295 
uöt16_t
 
	$NVRAM_¸c_upd©e
 (
uöt16_t
 
¥ev
, uöt16_à
vÆue
)

297 
uöt16_t
 
tmp
;

298 
uöt16_t
 
pd
, 
pd1
, 
pd2
;

300 
tmp
 = 
¥ev
 >> 8;

301 
pd
 = 
¥ev
 ^ 
vÆue
;

302 
pd1
 = 
pd
 & 0x000F;

303 
pd2
 = ((
pd
 >> 4Ë& 0x000FË^ 
pd1
;

304 
tmp
 ^(
pd1
 << 3) | (pd1 << 8);

305 
tmp
 ^
pd2
 | (pd2 << 7) | (pd2 << 12);

307  
tmp
;

308 
	}
}

310 
uöt16_t
 
	$NVRAM_compuã_¸c
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
°¨t
, uöt32_à
cou¡
)

312 
uöt32_t
 
i
;

313 
uöt16_t
 
¸c
 = 0xFFFF;

314 
odd
;

316 
odd
 = 
cou¡
 & 1;

317 
cou¡
 &= ~1;

318 
i
 = 0; i !
cou¡
; i++) {

319 
¸c
 = 
	`NVRAM_¸c_upd©e
(¸c, 
	`NVRAM_gë_w‹d
(
nvøm
, 
°¨t
 + 
i
));

321 i‡(
odd
) {

322 
¸c
 = 
	`NVRAM_¸c_upd©e
(¸c, 
	`NVRAM_gë_byã
(
nvøm
, 
°¨t
 + 
i
) << 8);

325  
¸c
;

326 
	}
}

328 
	#CMDLINE_ADDR
 0x017ff000

	)

330 
	$PPC_NVRAM_£t_∑øms
 (
m48t59_t
 *
nvøm
, 
uöt16_t
 
NVRAM_size
,

331 c⁄° *
¨ch
,

332 
uöt32_t
 
RAM_size
, 
boŸ_devi˚
,

333 
uöt32_t
 
kî√l_image
, uöt32_à
kî√l_size
,

334 c⁄° *
cmdlöe
,

335 
uöt32_t
 
öôrd_image
, uöt32_à
öôrd_size
,

336 
uöt32_t
 
NVRAM_image
,

337 
width
, 
height
, 
dïth
)

339 
uöt16_t
 
¸c
;

342 
	`NVRAM_£t_°rög
(
nvøm
, 0x00, "QEMU_BIOS", 16);

343 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x10, 0x00000002);

344 
	`NVRAM_£t_w‹d
(
nvøm
, 0x14, 
NVRAM_size
);

345 
	`NVRAM_£t_°rög
(
nvøm
, 0x20, 
¨ch
, 16);

346 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x30, 
RAM_size
);

347 
	`NVRAM_£t_byã
(
nvøm
, 0x34, 
boŸ_devi˚
);

348 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x38, 
kî√l_image
);

349 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x3C, 
kî√l_size
);

350 i‡(
cmdlöe
) {

352 
	`°r˝y
(
phys_øm_ba£
 + 
CMDLINE_ADDR
, 
cmdlöe
);

353 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x40, 
CMDLINE_ADDR
);

354 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x44, 
	`°æí
(
cmdlöe
));

356 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x40, 0);

357 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x44, 0);

359 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x48, 
öôrd_image
);

360 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x4C, 
öôrd_size
);

361 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x50, 
NVRAM_image
);

363 
	`NVRAM_£t_w‹d
(
nvøm
, 0x54, 
width
);

364 
	`NVRAM_£t_w‹d
(
nvøm
, 0x56, 
height
);

365 
	`NVRAM_£t_w‹d
(
nvøm
, 0x58, 
dïth
);

366 
¸c
 = 
	`NVRAM_compuã_¸c
(
nvøm
, 0x00, 0xF8);

367 
	`NVRAM_£t_w‹d
(
nvøm
, 0xFC, 
¸c
);

370 
	}
}

	@ppc_chrp.c

24 
	~"vl.h
"

26 
	#BIOS_FILENAME
 "µc_rom.bö"

	)

27 
	#VGABIOS_FILENAME
 "video.x"

	)

28 
	#NVRAM_SIZE
 0x2000

	)

30 
	#KERNEL_LOAD_ADDR
 0x01000000

	)

31 
	#INITRD_LOAD_ADDR
 0x01800000

	)

36 
	gdbdma_mem_ödex
;

37 
	gcuda_mem_ödex
;

38 
	gide0_mem_ödex
 = -1;

39 
	gide1_mem_ödex
 = -1;

40 
	g›ípic_mem_ödex
 = -1;

41 
	ghóthrow_pic_mem_ödex
 = -1;

42 
	gmacio_nvøm_mem_ödex
 = -1;

46 
	$dbdma_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

48 
	`¥ötf
("%s: 0x%08x <0x%08x\n", 
__func__
, 
addr
, 
vÆue
);

49 
	}
}

51 
	$dbdma_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

53 
	}
}

55 
	$dbdma_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

57 
	}
}

59 
uöt32_t
 
	$dbdma_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

61 
	`¥ötf
("%s: 0x%08x => 0x00000000\n", 
__func__
, 
addr
);

63 
	}
}

65 
uöt32_t
 
	$dbdma_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

68 
	}
}

70 
uöt32_t
 
	$dbdma_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

73 
	}
}

75 
CPUWrôeMem‹yFunc
 *
	gdbdma_wrôe
[] = {

76 &
dbdma_wrôeb
,

77 &
dbdma_wrôew
,

78 &
dbdma_wrôñ
,

81 
CPURódMem‹yFunc
 *
	gdbdma_ªad
[] = {

82 &
dbdma_ªadb
,

83 &
dbdma_ªadw
,

84 &
dbdma_ªadl
,

88 
	sMacIONVRAMSèã
 {

89 
uöt8_t
 
	md©a
[0x2000];

90 } 
	tMacIONVRAMSèã
;

92 
	$macio_nvøm_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

94 
MacIONVRAMSèã
 *
s
 = 
›aque
;

95 
addr
 = (addr >> 4) & 0x1fff;

96 
s
->
d©a
[
addr
] = 
vÆue
;

98 
	}
}

100 
uöt32_t
 
	$macio_nvøm_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

102 
MacIONVRAMSèã
 *
s
 = 
›aque
;

103 
uöt32_t
 
vÆue
;

105 
addr
 = (addr >> 4) & 0x1fff;

106 
vÆue
 = 
s
->
d©a
[
addr
];

108  
vÆue
;

109 
	}
}

111 
CPUWrôeMem‹yFunc
 *
	gmacio_nvøm_wrôe
[] = {

112 &
macio_nvøm_wrôeb
,

113 &
macio_nvøm_wrôeb
,

114 &
macio_nvøm_wrôeb
,

117 
CPURódMem‹yFunc
 *
	gmacio_nvøm_ªad
[] = {

118 &
macio_nvøm_ªadb
,

119 &
macio_nvøm_ªadb
,

120 &
macio_nvøm_ªadb
,

123 
MacIONVRAMSèã
 *
	$macio_nvøm_öô
()

125 
MacIONVRAMSèã
 *
s
;

126 
s
 = 
	`qemu_mÆlocz
((
MacIONVRAMSèã
));

127 i‡(!
s
)

128  
NULL
;

129 
macio_nvøm_mem_ödex
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
macio_nvøm_ªad
,

130 
macio_nvøm_wrôe
, 
s
);

131  
s
;

132 
	}
}

134 
	$macio_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

135 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

137 i‡(
hóthrow_pic_mem_ödex
 >= 0) {

138 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x00000, 0x1000,

139 
hóthrow_pic_mem_ödex
);

141 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x08000, 0x1000, 
dbdma_mem_ödex
);

142 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x16000, 0x2000, 
cuda_mem_ödex
);

143 i‡(
ide0_mem_ödex
 >= 0)

144 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x1f000, 0x1000, 
ide0_mem_ödex
);

145 i‡(
ide1_mem_ödex
 >= 0)

146 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x20000, 0x1000, 
ide1_mem_ödex
);

147 i‡(
›ípic_mem_ödex
 >= 0) {

148 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x40000, 0x40000,

149 
›ípic_mem_ödex
);

151 i‡(
macio_nvøm_mem_ödex
 >= 0)

152 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x60000, 0x20000, 
macio_nvøm_mem_ödex
);

153 
	}
}

155 
	$macio_öô
(
PCIBus
 *
bus
, 
devi˚_id
)

157 
PCIDevi˚
 *
d
;

159 
d
 = 
	`pci_ªgi°î_devi˚
(
bus
, "macio", (
PCIDevi˚
),

160 -1, 
NULL
, NULL);

163 
d
->
c⁄fig
[0x00] = 0x6b;

164 
d
->
c⁄fig
[0x01] = 0x10;

165 
d
->
c⁄fig
[0x02] = 
devi˚_id
;

166 
d
->
c⁄fig
[0x03] = 
devi˚_id
 >> 8;

168 
d
->
c⁄fig
[0x0a] = 0x00;

169 
d
->
c⁄fig
[0x0b] = 0xff;

170 
d
->
c⁄fig
[0x0e] = 0x00;

172 
d
->
c⁄fig
[0x3d] = 0x01;

174 
dbdma_mem_ödex
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
dbdma_ªad
, 
dbdma_wrôe
, 
NULL
);

176 
	`pci_ªgi°î_io_ªgi⁄
(
d
, 0, 0x80000,

177 
PCI_ADDRESS_SPACE_MEM
, 
macio_m≠
);

178 
	}
}

181 
	$unö_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

183 
	}
}

185 
uöt32_t
 
	$unö_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

188 
	}
}

190 
CPUWrôeMem‹yFunc
 *
	gunö_wrôe
[] = {

191 &
unö_wrôñ
,

192 &
unö_wrôñ
,

193 &
unö_wrôñ
,

196 
CPURódMem‹yFunc
 *
	gunö_ªad
[] = {

197 &
unö_ªadl
,

198 &
unö_ªadl
,

199 &
unö_ªadl
,

204 
	$vga_osi_ˇŒ
(
CPUSèã
 *
ív
)

206 
vga_vbl_íabÀd
;

207 
löesize
;

213 
ív
->
g¥
[5]) {

217 i‡(
ív
->
g¥
[6] != 1 ||Énv->gpr[7] != 0)

218 
ív
->
g¥
[3] = 1;

220 
ív
->
g¥
[3] = 0;

223 i‡(
ív
->
g¥
[6] != 0) {

224 i‡(
ív
->
g¥
[6] != 1 ||Énv->gpr[7] != 0) {

225 
ív
->
g¥
[3] = 1;

229 
ív
->
g¥
[3] = 0;

230 
ív
->
g¥
[4] = (1 << 16) | 1;

231 
ív
->
g¥
[5] = (1 << 16) | 0;

232 
ív
->
g¥
[6] = (
gøphic_width
 << 16Ë| 
gøphic_height
;

233 
ív
->
g¥
[7] = 85 << 16;

234 
ív
->
g¥
[8] = (
gøphic_dïth
 + 7) & ~7;

235 
löesize
 = ((
gøphic_dïth
 + 7Ë>> 3Ë* 
gøphic_width
;

236 
löesize
 = (linesize + 3) & ~3;

237 
ív
->
g¥
[9] = (
löesize
 << 16) | 0;

240 
ív
->
g¥
[3] = 0;

243 i‡(
ív
->
g¥
[6] == 0 ||Énv->gpr[6] == 1)

244 
vga_vbl_íabÀd
 = 
ív
->
g¥
[6];

245 
ív
->
g¥
[3] = 0;

251 
ív
->
g¥
[3] = 0;

255 
ív
->
g¥
[3] = 0;

261 
	`Ârötf
(
°dîr
, "unsuµ‹ãd OSI cÆ»R5=%08x\n", 
ív
->
g¥
[5]);

265 
	}
}

268 
	$pic_úq_ªque°
(*
›aque
, 
Àvñ
)

270 
	}
}

272 
uöt8_t
 
	$nvøm_chksum
(c⁄° 
uöt8_t
 *
buf
, 
n
)

274 
sum
, 
i
;

275 
sum
 = 0;

276 
i
 = 0; i < 
n
; i++)

277 
sum
 +
buf
[
i
];

278  (
sum
 & 0xff) + (sum >> 8);

279 
	}
}

282 
	$pmac_f‹m©_nvøm_∑πôi⁄
(
uöt8_t
 *
buf
, 
Àn
)

284 
∑πôi⁄_«me
[12] = "wwwwwwwwwwww";

286 
buf
[0] = 0x7f;

287 
buf
[1] = 0;

288 
buf
[2] = 
Àn
 >> 8;

289 
buf
[3] = 
Àn
;

290 
	`mem˝y
(
buf
 + 4, 
∑πôi⁄_«me
, 12);

291 
buf
[1] = 
	`nvøm_chksum
(buf, 16);

292 
	}
}

295 
	$µc_chΩ_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

296 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
,

297 
¢≠shŸ
,

298 c⁄° *
kî√l_fûíame
,

299 c⁄° *
kî√l_cmdlöe
,

300 c⁄° *
öôrd_fûíame
,

301 
is_hóthrow
)

303 
CPUSèã
 *
ív
;

304 
buf
[1024];

305 
SëIRQFunc
 *
£t_úq
;

306 *
pic
;

307 
m48t59_t
 *
nvøm
;

308 
unö_mem‹y
;

309 
löux_boŸ
, 
i
;

310 
bios_off£t
, 
vga_bios_off£t
;

311 
uöt32_t
 
kî√l_ba£
, 
kî√l_size
, 
öôrd_ba£
, 
öôrd_size
;

312 
µc_def_t
 *
def
;

313 
PCIBus
 *
pci_bus
;

314 c⁄° *
¨ch_«me
;

315 
vga_bios_size
, 
bios_size
;

317 
löux_boŸ
 = (
kî√l_fûíame
 !
NULL
);

320 
ív
 = 
	`˝u_öô
();

321 
	`ªgi°î_ßvevm
("˝u", 0, 3, 
˝u_ßve
, 
˝u_lﬂd
, 
ív
);

333 
	`µc_föd_by_«me
("750", &
def
);

339 i‡(
def
 =
NULL
) {

340 
	`˝u_ab‹t
(
ív
, "UnableÅo find PowerPC CPU definition\n");

342 
	`˝u_µc_ªgi°î
(
ív
, 
def
);

345 
	`˝u_µc_tb_öô
(
ív
, 100UL * 1000UL * 1000UL);

347 
ív
->
osi_ˇŒ
 = 
vga_osi_ˇŒ
;

350 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 
IO_MEM_RAM
);

353 
bios_off£t
 = 
øm_size
 + 
vga_øm_size
;

354 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
BIOS_FILENAME
);

355 
bios_size
 = 
	`lﬂd_image
(
buf
, 
phys_øm_ba£
 + 
bios_off£t
);

356 i‡(
bios_size
 < 0 || bios_sizê> 
BIOS_SIZE
) {

357 
	`Ârötf
(
°dîr
, "qemu: couldÇŸÜﬂd PowîPC bio†'%s'\n", 
buf
);

358 
	`exô
(1);

360 
bios_size
 = (bios_size + 0xfff) & ~0xfff;

361 
	`˝u_ªgi°î_physiˇl_mem‹y
((
uöt32_t
)(-
bios_size
),

362 
bios_size
, 
bios_off£t
 | 
IO_MEM_ROM
);

365 
vga_bios_off£t
 = 
bios_off£t
 + 
bios_size
;

366 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
VGABIOS_FILENAME
);

367 
vga_bios_size
 = 
	`lﬂd_image
(
buf
, 
phys_øm_ba£
 + 
vga_bios_off£t
 + 8);

368 i‡(
vga_bios_size
 < 0) {

370 
	`Ârötf
(
°dîr
, "qemu: w¨nög: couldÇŸÜﬂd VGA bio†'%s'\n", 
buf
);

371 
vga_bios_size
 = 0;

375 
phys_øm_ba£
[
vga_bios_off£t
] = 'N';

376 
phys_øm_ba£
[
vga_bios_off£t
 + 1] = 'D';

377 
phys_øm_ba£
[
vga_bios_off£t
 + 2] = 'R';

378 
phys_øm_ba£
[
vga_bios_off£t
 + 3] = 'V';

379 
	`˝u_to_be32w
((
uöt32_t
 *)(
phys_øm_ba£
 + 
vga_bios_off£t
 + 4),

380 
vga_bios_size
);

381 
vga_bios_size
 += 8;

383 
vga_bios_size
 = (vga_bios_size + 0xfff) & ~0xfff;

385 i‡(
löux_boŸ
) {

386 
kî√l_ba£
 = 
KERNEL_LOAD_ADDR
;

388 
kî√l_size
 = 
	`lﬂd_image
(
kî√l_fûíame
, 
phys_øm_ba£
 + 
kî√l_ba£
);

389 i‡(
kî√l_size
 < 0) {

390 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad kernel '%s'\n",

391 
kî√l_fûíame
);

392 
	`exô
(1);

395 i‡(
öôrd_fûíame
) {

396 
öôrd_ba£
 = 
INITRD_LOAD_ADDR
;

397 
öôrd_size
 = 
	`lﬂd_image
(
öôrd_fûíame
,

398 
phys_øm_ba£
 + 
öôrd_ba£
);

399 i‡(
öôrd_size
 < 0) {

400 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad initialÑam disk '%s'\n",

401 
öôrd_fûíame
);

402 
	`exô
(1);

405 
öôrd_ba£
 = 0;

406 
öôrd_size
 = 0;

408 
boŸ_devi˚
 = 'm';

410 
kî√l_ba£
 = 0;

411 
kî√l_size
 = 0;

412 
öôrd_ba£
 = 0;

413 
öôrd_size
 = 0;

416 i‡(
is_hóthrow
) {

417 
iß_mem_ba£
 = 0x80000000;

420 
	`iß_mmio_öô
(0xfe000000, 0x00200000);

423 
pic
 = 
	`hóthrow_pic_öô
(&
hóthrow_pic_mem_ödex
);

424 
£t_úq
 = 
hóthrow_pic_£t_úq
;

425 
pci_bus
 = 
	`pci_gøckÀ_öô
(0x„c00000, 
pic
);

426 
	`pci_vga_öô
(
pci_bus
, 
ds
, 
phys_øm_ba£
 + 
øm_size
,

427 
øm_size
, 
vga_øm_size
,

428 
vga_bios_off£t
, 
vga_bios_size
);

431 
iß_pic
 = 
	`pic_öô
(
pic_úq_ªque°
, 
NULL
);

434 
	`£rül_öô
(&
pic_£t_úq_√w
, 
iß_pic
, 0x3f8, 4, 
£rül_hds
[0]);

436 
i
 = 0; i < 
nb_nics
; i++) {

437 i‡(!
nd_èbÀ
[
i
].
modñ
)

438 
nd_èbÀ
[
i
].
modñ
 = "ne2k_pci";

439 
	`pci_nic_öô
(
pci_bus
, &
nd_èbÀ
[
i
], -1);

442 
	`pci_cmd646_ide_öô
(
pci_bus
, &
bs_èbÀ
[0], 0);

445 
cuda_mem_ödex
 = 
	`cuda_öô
(
£t_úq
, 
pic
, 0x12);

447 
	`adb_kbd_öô
(&
adb_bus
);

448 
	`adb_mou£_öô
(&
adb_bus
);

451 
MacIONVRAMSèã
 *
nvr
;

452 
nvr
 = 
	`macio_nvøm_öô
();

453 
	`pmac_f‹m©_nvøm_∑πôi⁄
(
nvr
->
d©a
, 0x2000);

456 
	`macio_öô
(
pci_bus
, 0x0017);

458 
nvøm
 = 
	`m48t59_öô
(8, 0xFFF04000, 0x0074, 
NVRAM_SIZE
, 59);

460 
¨ch_«me
 = "HEATHROW";

462 
iß_mem_ba£
 = 0x80000000;

465 
	`iß_mmio_öô
(0xf2000000, 0x00800000);

468 
unö_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
unö_ªad
, 
unö_wrôe
, 
NULL
);

469 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xf8000000, 0x00001000, 
unö_mem‹y
);

471 
pic
 = 
	`›ípic_öô
(
NULL
, &
›ípic_mem_ödex
, 1, &
ív
);

472 
£t_úq
 = 
›ípic_£t_úq
;

473 
pci_bus
 = 
	`pci_pmac_öô
(
pic
);

475 
	`pci_vga_öô
(
pci_bus
, 
ds
, 
phys_øm_ba£
 + 
øm_size
,

476 
øm_size
, 
vga_øm_size
,

477 
vga_bios_off£t
, 
vga_bios_size
);

480 
iß_pic
 = 
	`pic_öô
(
pic_úq_ªque°
, 
NULL
);

483 
	`£rül_öô
(&
pic_£t_úq_√w
, 
iß_pic
, 0x3f8, 4, 
£rül_hds
[0]);

485 
i
 = 0; i < 
nb_nics
; i++) {

486 
	`pci_√2000_öô
(
pci_bus
, &
nd_èbÀ
[
i
], -1);

490 
ide0_mem_ödex
 = 
	`pmac_ide_öô
(&
bs_èbÀ
[0], 
£t_úq
, 
pic
, 0x13);

491 
ide1_mem_ödex
 = 
	`pmac_ide_öô
(&
bs_èbÀ
[2], 
£t_úq
, 
pic
, 0x14);

493 
	`pci_cmd646_ide_öô
(
pci_bus
, &
bs_èbÀ
[0], 0);

496 
cuda_mem_ödex
 = 
	`cuda_öô
(
£t_úq
, 
pic
, 0x19);

498 
	`adb_kbd_öô
(&
adb_bus
);

499 
	`adb_mou£_öô
(&
adb_bus
);

501 
	`macio_öô
(
pci_bus
, 0x0022);

503 
nvøm
 = 
	`m48t59_öô
(8, 0xFFF04000, 0x0074, 
NVRAM_SIZE
, 59);

505 
¨ch_«me
 = "MAC99";

508 i‡(
usb_íabÀd
) {

509 
	`usb_ohci_öô
(
pci_bus
, 3, -1);

512 i‡(
gøphic_dïth
 != 15 && graphic_depth != 32 && graphic_depth != 8)

513 
gøphic_dïth
 = 15;

515 
	`PPC_NVRAM_£t_∑øms
(
nvøm
, 
NVRAM_SIZE
, 
¨ch_«me
, 
øm_size
, 
boŸ_devi˚
,

516 
kî√l_ba£
, 
kî√l_size
,

517 
kî√l_cmdlöe
,

518 
öôrd_ba£
, 
öôrd_size
,

521 
gøphic_width
, 
gøphic_height
, 
gøphic_dïth
);

525 
	`ªgi°î_i›‹t_wrôe
(0x0F00, 4, 1, &
PPC_debug_wrôe
, 
NULL
);

526 
	}
}

528 
	$µc_c‹e99_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

529 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
,

530 
¢≠shŸ
,

531 c⁄° *
kî√l_fûíame
,

532 c⁄° *
kî√l_cmdlöe
,

533 c⁄° *
öôrd_fûíame
)

535 
	`µc_chΩ_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

536 
ds
, 
fd_fûíame
, 
¢≠shŸ
,

537 
kî√l_fûíame
, 
kî√l_cmdlöe
,

538 
öôrd_fûíame
, 0);

539 
	}
}

541 
	$µc_hóthrow_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

542 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
,

543 
¢≠shŸ
,

544 c⁄° *
kî√l_fûíame
,

545 c⁄° *
kî√l_cmdlöe
,

546 c⁄° *
öôrd_fûíame
)

548 
	`µc_chΩ_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

549 
ds
, 
fd_fûíame
, 
¢≠shŸ
,

550 
kî√l_fûíame
, 
kî√l_cmdlöe
,

551 
öôrd_fûíame
, 1);

552 
	}
}

554 
QEMUMachöe
 
	gc‹e99_machöe
 = {

557 
µc_c‹e99_öô
,

560 
QEMUMachöe
 
	ghóthrow_machöe
 = {

563 
µc_hóthrow_öô
,

	@ppc_prep.c

24 
	~"vl.h
"

29 
	#BIOS_FILENAME
 "µc_rom.bö"

	)

30 
	#KERNEL_LOAD_ADDR
 0x01000000

	)

31 
	#INITRD_LOAD_ADDR
 0x01800000

	)

33 
logÀvñ
;

34 
FILE
 *
logfûe
;

36 #i‡
deföed
 (
HARD_DEBUG_PPC_IO
Ë&& !deföed (
DEBUG_PPC_IO
)

37 
	#DEBUG_PPC_IO


	)

40 #i‡
deföed
 (
HARD_DEBUG_PPC_IO
)

41 
	#PPC_IO_DPRINTF
(
fmt
, 
¨gs
...) \

43 i‡(
logÀvñ
 & 
CPU_LOG_IOPORT
) { \

44 
	`Ârötf
(
logfûe
, "%s: " 
fmt
, 
__func__
 , ##
¨gs
); \

46 
	`¥ötf
("%†: " 
fmt
, 
__func__
 , ##
¨gs
); \

48 } 0)

	)

49 #ñi‡
deföed
 (
DEBUG_PPC_IO
)

50 
	#PPC_IO_DPRINTF
(
fmt
, 
¨gs
...) \

52 i‡(
logÀvñ
 & 
CPU_LOG_IOPORT
) { \

53 
	`Ârötf
(
logfûe
, "%s: " 
fmt
, 
__func__
 , ##
¨gs
); \

55 } 0)

	)

57 
	#PPC_IO_DPRINTF
(
fmt
, 
¨gs
...Ëdÿ{ } 0)

	)

61 c⁄° 
	gide_ioba£
[2] = { 0x1f0, 0x170 };

62 c⁄° 
	gide_ioba£2
[2] = { 0x3f6, 0x376 };

63 c⁄° 
	gide_úq
[2] = { 13, 13 };

65 
	#NE2000_NB_MAX
 6

	)

67 
uöt32_t
 
	g√2000_io
[
NE2000_NB_MAX
] = { 0x300, 0x320, 0x340, 0x360, 0x280, 0x380 };

68 
	g√2000_úq
[
NE2000_NB_MAX
] = { 9, 10, 11, 3, 4, 5 };

73 
	#PPC_IO_BASE
 0x80000000

	)

76 
	g•ókî_d©a_⁄
;

77 
	gdummy_ª‰esh_˛ock
;

79 
	$•ókî_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

82 
•ókî_d©a_⁄
 = (
vÆ
 >> 1) & 1;

83 
	`pô_£t_g©e
(
pô
, 2, 
vÆ
 & 1);

85 
	}
}

87 
uöt32_t
 
	$•ókî_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

90 
out
;

91 
out
 = 
	`pô_gë_out
(
pô
, 2, 
	`qemu_gë_˛ock
(
vm_˛ock
));

92 
dummy_ª‰esh_˛ock
 ^= 1;

93  (
•ókî_d©a_⁄
 << 1Ë| 
	`pô_gë_g©e
(
pô
, 2Ë| (
out
 << 5) |

94 (
dummy_ª‰esh_˛ock
 << 4);

97 
	}
}

99 
	$pic_úq_ªque°
(*
›aque
, 
Àvñ
)

101 i‡(
Àvñ
)

102 
	`˝u_öãºu±
(
fú°_˝u
, 
CPU_INTERRUPT_HARD
);

104 
	`˝u_ª£t_öãºu±
(
fú°_˝u
, 
CPU_INTERRUPT_HARD
);

105 
	}
}

109 
	$_PPC_öèck_wrôe
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

112 
	}
}

114 
ölöe
 
uöt32_t
 
	$_PPC_öèck_ªad
 (
èrgë_phys_addr_t
 
addr
)

116 
uöt32_t
 
ªtvÆ
 = 0;

118 i‡(
addr
 == 0xBFFFFFF0)

119 
ªtvÆ
 = 
	`pic_öèck_ªad
(
iß_pic
);

122  
ªtvÆ
;

123 
	}
}

125 
uöt32_t
 
	$PPC_öèck_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

127  
	`_PPC_öèck_ªad
(
addr
);

128 
	}
}

130 
uöt32_t
 
	$PPC_öèck_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

132 #ifde‡
TARGET_WORDS_BIGENDIAN


133  
	`bsw≠16
(
	`_PPC_öèck_ªad
(
addr
));

135  
	`_PPC_öèck_ªad
(
addr
);

137 
	}
}

139 
uöt32_t
 
	$PPC_öèck_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

141 #ifde‡
TARGET_WORDS_BIGENDIAN


142  
	`bsw≠32
(
	`_PPC_öèck_ªad
(
addr
));

144  
	`_PPC_öèck_ªad
(
addr
);

146 
	}
}

148 
CPUWrôeMem‹yFunc
 *
	gPPC_öèck_wrôe
[] = {

149 &
_PPC_öèck_wrôe
,

150 &
_PPC_öèck_wrôe
,

151 &
_PPC_öèck_wrôe
,

154 
CPURódMem‹yFunc
 *
	gPPC_öèck_ªad
[] = {

155 &
PPC_öèck_ªadb
,

156 &
PPC_öèck_ªadw
,

157 &
PPC_öèck_ªadl
,

164 
uöt32_t
 
	mvíi_devi
;

165 
uöt32_t
 
	mªvi
;

167 
uöt32_t
 
	mgc§
;

168 
uöt32_t
 
	mxc‰
;

169 
uöt32_t
 
	m˘32
;

170 
uöt32_t
 
	mmc§
;

172 
uöt32_t
 
	mg¥g
[6];

174 
uöt32_t
 
	m„í
;

175 
uöt32_t
 
	m„°
;

176 
uöt32_t
 
	m„ma
;

177 
uöt32_t
 
	m„˛
;

178 
uöt32_t
 
	mìí
;

179 
uöt32_t
 
	mì°
;

180 
uöt32_t
 
	mì˛
;

181 
uöt32_t
 
	mìöt
;

182 
uöt32_t
 
	mìmck0
;

183 
uöt32_t
 
	mìmck1
;

185 } 
	gXCSR
;

187 
	$PPC_XCSR_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

189 
	`¥ötf
("%s: 0x%08lx => 0x%08x\n", 
__func__
, ()
addr
, 
vÆue
);

190 
	}
}

192 
	$PPC_XCSR_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

194 #ifde‡
TARGET_WORDS_BIGENDIAN


195 
vÆue
 = 
	`bsw≠16
(value);

197 
	`¥ötf
("%s: 0x%08lx => 0x%08x\n", 
__func__
, ()
addr
, 
vÆue
);

198 
	}
}

200 
	$PPC_XCSR_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆue
)

202 #ifde‡
TARGET_WORDS_BIGENDIAN


203 
vÆue
 = 
	`bsw≠32
(value);

205 
	`¥ötf
("%s: 0x%08lx => 0x%08x\n", 
__func__
, ()
addr
, 
vÆue
);

206 
	}
}

208 
uöt32_t
 
	$PPC_XCSR_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

210 
uöt32_t
 
ªtvÆ
 = 0;

212 
	`¥ötf
("%s: 0x%08lx <%d\n", 
__func__
, ()
addr
, 
ªtvÆ
);

214  
ªtvÆ
;

215 
	}
}

217 
uöt32_t
 
	$PPC_XCSR_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

219 
uöt32_t
 
ªtvÆ
 = 0;

221 
	`¥ötf
("%s: 0x%08lx <%d\n", 
__func__
, ()
addr
, 
ªtvÆ
);

222 #ifde‡
TARGET_WORDS_BIGENDIAN


223 
ªtvÆ
 = 
	`bsw≠16
(retval);

226  
ªtvÆ
;

227 
	}
}

229 
uöt32_t
 
	$PPC_XCSR_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

231 
uöt32_t
 
ªtvÆ
 = 0;

233 
	`¥ötf
("%s: 0x%08lx <%d\n", 
__func__
, ()
addr
, 
ªtvÆ
);

234 #ifde‡
TARGET_WORDS_BIGENDIAN


235 
ªtvÆ
 = 
	`bsw≠32
(retval);

238  
ªtvÆ
;

239 
	}
}

241 
CPUWrôeMem‹yFunc
 *
	gPPC_XCSR_wrôe
[] = {

242 &
PPC_XCSR_wrôeb
,

243 &
PPC_XCSR_wrôew
,

244 &
PPC_XCSR_wrôñ
,

247 
CPURódMem‹yFunc
 *
	gPPC_XCSR_ªad
[] = {

248 &
PPC_XCSR_ªadb
,

249 &
PPC_XCSR_ªadw
,

250 &
PPC_XCSR_ªadl
,

255 
	ssys˘æ_t
 {

256 
m48t59_t
 *
	mnvøm
;

257 
uöt8_t
 
	m°©e
;

258 
uöt8_t
 
	msysc⁄åﬁ
;

259 
uöt8_t
 
	mÁke_io
[2];

260 
	mc⁄tiguous_m≠
;

261 
	mídün
;

262 } 
	tsys˘æ_t
;

265 
	mSTATE_HARDFILE
 = 0x01,

268 
sys˘æ_t
 *
	gsys˘æ
;

270 
	$PREP_io_wrôe
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

272 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

274 
	`PPC_IO_DPRINTF
("0x%08lx => 0x%08x\n", ()
addr
 - 
PPC_IO_BASE
, 
vÆ
);

275 
sys˘æ
->
Áke_io
[
addr
 - 0x0398] = 
vÆ
;

276 
	}
}

278 
uöt32_t
 
	$PREP_io_ªad
 (*
›aque
, 
uöt32_t
 
addr
)

280 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

282 
	`PPC_IO_DPRINTF
("0x%08lx <0x%08x\n", ()
addr
 - 
PPC_IO_BASE
,

283 
sys˘æ
->
Áke_io
[
addr
 - 0x0398]);

284  
sys˘æ
->
Áke_io
[
addr
 - 0x0398];

285 
	}
}

287 
	$PREP_io_800_wrôeb
 (*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

289 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

291 
	`PPC_IO_DPRINTF
("0x%08lx => 0x%08x\n", ()
addr
 - 
PPC_IO_BASE
, 
vÆ
);

292 
addr
) {

296 i‡(
vÆ
 & 0x01) {

300 i‡(
vÆ
 & 0x02) {

301 
sys˘æ
->
ídün
 = 1;

303 
sys˘æ
->
ídün
 = 0;

317 i‡(
vÆ
 & 1)

318 
sys˘æ
->
°©e
 |
STATE_HARDFILE
;

320 
sys˘æ
->
°©e
 &~
STATE_HARDFILE
;

324 i‡(
sys˘æ
->
nvøm
 !
NULL
)

325 
	`m48t59_toggÀ_lock
(
sys˘æ
->
nvøm
, 1);

329 i‡(
sys˘æ
->
nvøm
 !
NULL
)

330 
	`m48t59_toggÀ_lock
(
sys˘æ
->
nvøm
, 2);

338 
sys˘æ
->
sysc⁄åﬁ
 = 
vÆ
 & 0x0F;

342 
sys˘æ
->
c⁄tiguous_m≠
 = 
vÆ
 & 0x01;

345 
	`¥ötf
("ERROR: unaffected IOÖort write: %04lx => %02x\n",

346 ()
addr
, 
vÆ
);

349 
	}
}

351 
uöt32_t
 
	$PREP_io_800_ªadb
 (*
›aque
, 
uöt32_t
 
addr
)

353 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

354 
uöt32_t
 
ªtvÆ
 = 0xFF;

356 
addr
) {

359 
ªtvÆ
 = 0x00;

363 
ªtvÆ
 = 0xEF;

367 
ªtvÆ
 = 0xAD;

371 
ªtvÆ
 = 0xE0;

380 
ªtvÆ
 = 0x3C;

384 
ªtvÆ
 = 0x39;

391 
ªtvÆ
 = 0x00;

397 
ªtvÆ
 = 
sys˘æ
->
sysc⁄åﬁ
;

401 
ªtvÆ
 = 0x03;

405 
ªtvÆ
 = 
sys˘æ
->
c⁄tiguous_m≠
;

408 
	`¥ötf
("ERROR: u«f„˘ed IOÖ‹t: %04lxÑód\n", ()
addr
);

411 
	`PPC_IO_DPRINTF
("0x%08lx <0x%08x\n", ()
addr
 - 
PPC_IO_BASE
, 
ªtvÆ
);

413  
ªtvÆ
;

414 
	}
}

416 
ölöe
 
èrgë_phys_addr_t
 
	$¥ï_IO_addªss
 (
sys˘æ_t
 *
sys˘æ
,

417 
èrgë_phys_addr_t
 
addr
)

419 i‡(
sys˘æ
->
c⁄tiguous_m≠
 == 0) {

421 
addr
 &= 0xFFFF;

424 
addr
 = (addr & 0x1F) | ((addr & 0x007FFF000) >> 7);

427  
addr
;

428 
	}
}

430 
	$PPC_¥ï_io_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

431 
uöt32_t
 
vÆue
)

433 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

435 
addr
 = 
	`¥ï_IO_addªss
(
sys˘æ
,áddr);

436 
	`˝u_outb
(
NULL
, 
addr
, 
vÆue
);

437 
	}
}

439 
uöt32_t
 
	$PPC_¥ï_io_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

441 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

442 
uöt32_t
 
ªt
;

444 
addr
 = 
	`¥ï_IO_addªss
(
sys˘æ
,áddr);

445 
ªt
 = 
	`˝u_öb
(
NULL
, 
addr
);

447  
ªt
;

448 
	}
}

450 
	$PPC_¥ï_io_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

451 
uöt32_t
 
vÆue
)

453 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

455 
addr
 = 
	`¥ï_IO_addªss
(
sys˘æ
,áddr);

456 #ifde‡
TARGET_WORDS_BIGENDIAN


457 
vÆue
 = 
	`bsw≠16
(value);

459 
	`PPC_IO_DPRINTF
("0x%08lx => 0x%08x\n", ()
addr
, 
vÆue
);

460 
	`˝u_outw
(
NULL
, 
addr
, 
vÆue
);

461 
	}
}

463 
uöt32_t
 
	$PPC_¥ï_io_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

465 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

466 
uöt32_t
 
ªt
;

468 
addr
 = 
	`¥ï_IO_addªss
(
sys˘æ
,áddr);

469 
ªt
 = 
	`˝u_öw
(
NULL
, 
addr
);

470 #ifde‡
TARGET_WORDS_BIGENDIAN


471 
ªt
 = 
	`bsw≠16
(ret);

473 
	`PPC_IO_DPRINTF
("0x%08lx <0x%08x\n", ()
addr
, 
ªt
);

475  
ªt
;

476 
	}
}

478 
	$PPC_¥ï_io_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

479 
uöt32_t
 
vÆue
)

481 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

483 
addr
 = 
	`¥ï_IO_addªss
(
sys˘æ
,áddr);

484 #ifde‡
TARGET_WORDS_BIGENDIAN


485 
vÆue
 = 
	`bsw≠32
(value);

487 
	`PPC_IO_DPRINTF
("0x%08lx => 0x%08x\n", ()
addr
, 
vÆue
);

488 
	`˝u_oué
(
NULL
, 
addr
, 
vÆue
);

489 
	}
}

491 
uöt32_t
 
	$PPC_¥ï_io_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

493 
sys˘æ_t
 *
sys˘æ
 = 
›aque
;

494 
uöt32_t
 
ªt
;

496 
addr
 = 
	`¥ï_IO_addªss
(
sys˘æ
,áddr);

497 
ªt
 = 
	`˝u_öl
(
NULL
, 
addr
);

498 #ifde‡
TARGET_WORDS_BIGENDIAN


499 
ªt
 = 
	`bsw≠32
(ret);

501 
	`PPC_IO_DPRINTF
("0x%08lx <0x%08x\n", ()
addr
, 
ªt
);

503  
ªt
;

504 
	}
}

506 
CPUWrôeMem‹yFunc
 *
	gPPC_¥ï_io_wrôe
[] = {

507 &
PPC_¥ï_io_wrôeb
,

508 &
PPC_¥ï_io_wrôew
,

509 &
PPC_¥ï_io_wrôñ
,

512 
CPURódMem‹yFunc
 *
	gPPC_¥ï_io_ªad
[] = {

513 &
PPC_¥ï_io_ªadb
,

514 &
PPC_¥ï_io_ªadw
,

515 &
PPC_¥ï_io_ªadl
,

518 
	#NVRAM_SIZE
 0x2000

	)

521 
	$µc_¥ï_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

522 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

523 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

524 c⁄° *
öôrd_fûíame
)

526 
CPUSèã
 *
ív
;

527 
buf
[1024];

528 
m48t59_t
 *
nvøm
;

529 
PPC_io_mem‹y
;

530 
löux_boŸ
, 
i
, 
nb_nics1
, 
bios_size
;

531 
bios_off£t
;

532 
uöt32_t
 
kî√l_ba£
, 
kî√l_size
, 
öôrd_ba£
, 
öôrd_size
;

533 
µc_def_t
 *
def
;

534 
PCIBus
 *
pci_bus
;

536 
sys˘æ
 = 
	`qemu_mÆlocz
((
sys˘æ_t
));

537 i‡(
sys˘æ
 =
NULL
)

540 
löux_boŸ
 = (
kî√l_fûíame
 !
NULL
);

544 
ív
 = 
	`˝u_öô
();

545 
	`ªgi°î_ßvevm
("˝u", 0, 3, 
˝u_ßve
, 
˝u_lﬂd
, 
ív
);

551 
	`µc_föd_by_«me
("604", &
def
);

552 i‡(
def
 =
NULL
) {

553 
	`˝u_ab‹t
(
ív
, "UnableÅo find PowerPC CPU definition\n");

555 
	`˝u_µc_ªgi°î
(
ív
, 
def
);

557 
	`˝u_µc_tb_öô
(
ív
, 100UL * 1000UL * 1000UL);

560 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 
IO_MEM_RAM
);

563 
bios_off£t
 = 
øm_size
 + 
vga_øm_size
;

564 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
BIOS_FILENAME
);

565 
bios_size
 = 
	`lﬂd_image
(
buf
, 
phys_øm_ba£
 + 
bios_off£t
);

566 i‡(
bios_size
 < 0 || bios_sizê> 
BIOS_SIZE
) {

567 
	`Ârötf
(
°dîr
, "qemu: couldÇŸÜﬂd PPC PREP bio†'%s'\n", 
buf
);

568 
	`exô
(1);

570 
bios_size
 = (bios_size + 0xfff) & ~0xfff;

571 
	`˝u_ªgi°î_physiˇl_mem‹y
((
uöt32_t
)(-
bios_size
),

572 
bios_size
, 
bios_off£t
 | 
IO_MEM_ROM
);

574 i‡(
löux_boŸ
) {

575 
kî√l_ba£
 = 
KERNEL_LOAD_ADDR
;

577 
kî√l_size
 = 
	`lﬂd_image
(
kî√l_fûíame
, 
phys_øm_ba£
 + 
kî√l_ba£
);

578 i‡(
kî√l_size
 < 0) {

579 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad kernel '%s'\n",

580 
kî√l_fûíame
);

581 
	`exô
(1);

584 i‡(
öôrd_fûíame
) {

585 
öôrd_ba£
 = 
INITRD_LOAD_ADDR
;

586 
öôrd_size
 = 
	`lﬂd_image
(
öôrd_fûíame
,

587 
phys_øm_ba£
 + 
öôrd_ba£
);

588 i‡(
öôrd_size
 < 0) {

589 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad initialÑam disk '%s'\n",

590 
öôrd_fûíame
);

591 
	`exô
(1);

594 
öôrd_ba£
 = 0;

595 
öôrd_size
 = 0;

597 
boŸ_devi˚
 = 'm';

599 
kî√l_ba£
 = 0;

600 
kî√l_size
 = 0;

601 
öôrd_ba£
 = 0;

602 
öôrd_size
 = 0;

605 
iß_mem_ba£
 = 0xc0000000;

606 
pci_bus
 = 
	`pci_¥ï_öô
();

609 
PPC_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
PPC_¥ï_io_ªad
,

610 
PPC_¥ï_io_wrôe
, 
sys˘æ
);

611 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x80000000, 0x00800000, 
PPC_io_mem‹y
);

614 
	`pci_vga_öô
(
pci_bus
, 
ds
, 
phys_øm_ba£
 + 
øm_size
,Ñam_size,

615 
vga_øm_size
, 0, 0);

616 
	`πc_öô
(0x70, 8);

618 
iß_pic
 = 
	`pic_öô
(
pic_úq_ªque°
, 
fú°_˝u
);

621 
	`£rül_öô
(&
pic_£t_úq_√w
, 
iß_pic
, 0x3f8, 4, 
£rül_hds
[0]);

622 
nb_nics1
 = 
nb_nics
;

623 i‡(
nb_nics1
 > 
NE2000_NB_MAX
)

624 
nb_nics1
 = 
NE2000_NB_MAX
;

625 
i
 = 0; i < 
nb_nics1
; i++) {

626 i‡(
nd_èbÀ
[0].
modñ
 =
NULL


627 || 
	`°rcmp
(
nd_èbÀ
[0].
modñ
, "ne2k_isa") == 0) {

628 
	`iß_√2000_öô
(
√2000_io
[
i
], 
√2000_úq
[i], &
nd_èbÀ
[i]);

630 
	`Ârötf
(
°dîr
, "qemu: Unsuµ‹ãd NIC: %s\n", 
nd_èbÀ
[0].
modñ
);

631 
	`exô
 (1);

635 
i
 = 0; i < 2; i++) {

636 
	`iß_ide_öô
(
ide_ioba£
[
i
], 
ide_ioba£2
[i], 
ide_úq
[i],

637 
bs_èbÀ
[2 * 
i
], bs_table[2 * i + 1]);

639 
	`kbd_öô
();

640 
	`DMA_öô
(1);

644 
	`fd˘æ_öô
(6, 2, 0, 0x3f0, 
fd_èbÀ
);

647 
	`ªgi°î_i›‹t_ªad
(0x61, 1, 1, 
•ókî_i›‹t_ªad
, 
NULL
);

648 
	`ªgi°î_i›‹t_wrôe
(0x61, 1, 1, 
•ókî_i›‹t_wrôe
, 
NULL
);

650 
	`ªgi°î_i›‹t_ªad
(0x398, 2, 1, &
PREP_io_ªad
, 
sys˘æ
);

651 
	`ªgi°î_i›‹t_wrôe
(0x398, 2, 1, &
PREP_io_wrôe
, 
sys˘æ
);

653 
	`ªgi°î_i›‹t_ªad
(0x0092, 0x01, 1, &
PREP_io_800_ªadb
, 
sys˘æ
);

654 
	`ªgi°î_i›‹t_wrôe
(0x0092, 0x01, 1, &
PREP_io_800_wrôeb
, 
sys˘æ
);

655 
	`ªgi°î_i›‹t_ªad
(0x0800, 0x52, 1, &
PREP_io_800_ªadb
, 
sys˘æ
);

656 
	`ªgi°î_i›‹t_wrôe
(0x0800, 0x52, 1, &
PREP_io_800_wrôeb
, 
sys˘æ
);

658 
PPC_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
PPC_öèck_ªad
,

659 
PPC_öèck_wrôe
, 
NULL
);

660 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xBFFFFFF0, 0x4, 
PPC_io_mem‹y
);

663 
PPC_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
PPC_XCSR_ªad
, 
PPC_XCSR_wrôe
, 
NULL
);

664 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xFEFF0000, 0x1000, 
PPC_io_mem‹y
);

667 i‡(
usb_íabÀd
) {

668 
	`usb_ohci_öô
(
pci_bus
, 3, -1);

671 
nvøm
 = 
	`m48t59_öô
(8, 0, 0x0074, 
NVRAM_SIZE
, 59);

672 i‡(
nvøm
 =
NULL
)

674 
sys˘æ
->
nvøm
 =Çvram;

677 
	`PPC_NVRAM_£t_∑øms
(
nvøm
, 
NVRAM_SIZE
, "PREP", 
øm_size
, 
boŸ_devi˚
,

678 
kî√l_ba£
, 
kî√l_size
,

679 
kî√l_cmdlöe
,

680 
öôrd_ba£
, 
öôrd_size
,

683 
gøphic_width
, 
gøphic_height
, 
gøphic_dïth
);

686 
	`ªgi°î_i›‹t_wrôe
(0x0F00, 4, 1, &
PPC_debug_wrôe
, 
NULL
);

687 
	}
}

689 
QEMUMachöe
 
	g¥ï_machöe
 = {

692 
µc_¥ï_öô
,

	@prep_pci.c

25 
	~"vl.h
"

26 
uöt32_t
 
	tpci_addr_t
;

27 
	~"pci_ho°.h
"

29 
PCIHo°Sèã
 
	tPREPPCISèã
;

31 
	$pci_¥ï_addr_wrôñ
(* 
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

33 
PREPPCISèã
 *
s
 = 
›aque
;

34 
s
->
c⁄fig_ªg
 = 
vÆ
;

35 
	}
}

37 
uöt32_t
 
	$pci_¥ï_addr_ªadl
(* 
›aque
, 
uöt32_t
 
addr
)

39 
PREPPCISèã
 *
s
 = 
›aque
;

40  
s
->
c⁄fig_ªg
;

41 
	}
}

43 
ölöe
 
uöt32_t
 
	$PPC_PCIIO_c⁄fig
(
èrgë_phys_addr_t
 
addr
)

45 
i
;

47 
i
 = 0; i < 11; i++) {

48 i‡((
addr
 & (1 << (11 + 
i
))) != 0)

51  (
addr
 & 0x7ffË| (
i
 << 11);

52 
	}
}

54 
	$PPC_PCIIO_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

56 
PREPPCISèã
 *
s
 = 
›aque
;

57 
	`pci_d©a_wrôe
(
s
->
bus
, 
	`PPC_PCIIO_c⁄fig
(
addr
), 
vÆ
, 1);

58 
	}
}

60 
	$PPC_PCIIO_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

62 
PREPPCISèã
 *
s
 = 
›aque
;

63 #ifde‡
TARGET_WORDS_BIGENDIAN


64 
vÆ
 = 
	`bsw≠16
(val);

66 
	`pci_d©a_wrôe
(
s
->
bus
, 
	`PPC_PCIIO_c⁄fig
(
addr
), 
vÆ
, 2);

67 
	}
}

69 
	$PPC_PCIIO_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

71 
PREPPCISèã
 *
s
 = 
›aque
;

72 #ifde‡
TARGET_WORDS_BIGENDIAN


73 
vÆ
 = 
	`bsw≠32
(val);

75 
	`pci_d©a_wrôe
(
s
->
bus
, 
	`PPC_PCIIO_c⁄fig
(
addr
), 
vÆ
, 4);

76 
	}
}

78 
uöt32_t
 
	$PPC_PCIIO_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

80 
PREPPCISèã
 *
s
 = 
›aque
;

81 
uöt32_t
 
vÆ
;

82 
vÆ
 = 
	`pci_d©a_ªad
(
s
->
bus
, 
	`PPC_PCIIO_c⁄fig
(
addr
), 1);

83  
vÆ
;

84 
	}
}

86 
uöt32_t
 
	$PPC_PCIIO_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

88 
PREPPCISèã
 *
s
 = 
›aque
;

89 
uöt32_t
 
vÆ
;

90 
vÆ
 = 
	`pci_d©a_ªad
(
s
->
bus
, 
	`PPC_PCIIO_c⁄fig
(
addr
), 2);

91 #ifde‡
TARGET_WORDS_BIGENDIAN


92 
vÆ
 = 
	`bsw≠16
(val);

94  
vÆ
;

95 
	}
}

97 
uöt32_t
 
	$PPC_PCIIO_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

99 
PREPPCISèã
 *
s
 = 
›aque
;

100 
uöt32_t
 
vÆ
;

101 
vÆ
 = 
	`pci_d©a_ªad
(
s
->
bus
, 
	`PPC_PCIIO_c⁄fig
(
addr
), 4);

102 #ifde‡
TARGET_WORDS_BIGENDIAN


103 
vÆ
 = 
	`bsw≠32
(val);

105  
vÆ
;

106 
	}
}

108 
CPUWrôeMem‹yFunc
 *
	gPPC_PCIIO_wrôe
[] = {

109 &
PPC_PCIIO_wrôeb
,

110 &
PPC_PCIIO_wrôew
,

111 &
PPC_PCIIO_wrôñ
,

114 
CPURódMem‹yFunc
 *
	gPPC_PCIIO_ªad
[] = {

115 &
PPC_PCIIO_ªadb
,

116 &
PPC_PCIIO_ªadw
,

117 &
PPC_PCIIO_ªadl
,

121 
	$¥ï_m≠_úq
(
PCIDevi˚
 *
pci_dev
, 
úq_num
)

123  (
úq_num
 + (
pci_dev
->
dev‚
 >> 3)) & 1;

124 
	}
}

126 
	$¥ï_£t_úq
(*
pic
, 
úq_num
, 
Àvñ
)

128 
	`pic_£t_úq
(
úq_num
 ? 11 : 9, 
Àvñ
);

129 
	}
}

131 
PCIBus
 *
	$pci_¥ï_öô
()

133 
PREPPCISèã
 *
s
;

134 
PCIDevi˚
 *
d
;

135 
PPC_io_mem‹y
;

137 
s
 = 
	`qemu_mÆlocz
((
PREPPCISèã
));

138 
s
->
bus
 = 
	`pci_ªgi°î_bus
(
¥ï_£t_úq
, 
¥ï_m≠_úq
, 
NULL
, 0, 2);

140 
	`ªgi°î_i›‹t_wrôe
(0xcf8, 4, 4, 
pci_¥ï_addr_wrôñ
, 
s
);

141 
	`ªgi°î_i›‹t_ªad
(0xcf8, 4, 4, 
pci_¥ï_addr_ªadl
, 
s
);

143 
	`ªgi°î_i›‹t_wrôe
(0xcfc, 4, 1, 
pci_ho°_d©a_wrôeb
, 
s
);

144 
	`ªgi°î_i›‹t_wrôe
(0xcfc, 4, 2, 
pci_ho°_d©a_wrôew
, 
s
);

145 
	`ªgi°î_i›‹t_wrôe
(0xcfc, 4, 4, 
pci_ho°_d©a_wrôñ
, 
s
);

146 
	`ªgi°î_i›‹t_ªad
(0xcfc, 4, 1, 
pci_ho°_d©a_ªadb
, 
s
);

147 
	`ªgi°î_i›‹t_ªad
(0xcfc, 4, 2, 
pci_ho°_d©a_ªadw
, 
s
);

148 
	`ªgi°î_i›‹t_ªad
(0xcfc, 4, 4, 
pci_ho°_d©a_ªadl
, 
s
);

150 
PPC_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
PPC_PCIIO_ªad
,

151 
PPC_PCIIO_wrôe
, 
s
);

152 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x80800000, 0x00400000, 
PPC_io_mem‹y
);

155 
d
 = 
	`pci_ªgi°î_devi˚
(
s
->
bus
, "PREP Host Bridge - Motorola Raven",

156 (
PCIDevi˚
), 0, 
NULL
, NULL);

157 
d
->
c⁄fig
[0x00] = 0x57;

158 
d
->
c⁄fig
[0x01] = 0x10;

159 
d
->
c⁄fig
[0x02] = 0x01;

160 
d
->
c⁄fig
[0x03] = 0x48;

161 
d
->
c⁄fig
[0x08] = 0x00;

162 
d
->
c⁄fig
[0x0A] = 0x00;

163 
d
->
c⁄fig
[0x0B] = 0x06;

164 
d
->
c⁄fig
[0x0C] = 0x08;

165 
d
->
c⁄fig
[0x0D] = 0x10;

166 
d
->
c⁄fig
[0x0E] = 0x00;

167 
d
->
c⁄fig
[0x34] = 0x00;

169  
s
->
bus
;

170 
	}
}

	@ps2.c

24 
	~"vl.h
"

33 
	#KBD_CMD_SET_LEDS
 0xED

	)

34 
	#KBD_CMD_ECHO
 0xEE

	)

35 
	#KBD_CMD_GET_ID
 0xF2

	)

36 
	#KBD_CMD_SET_RATE
 0xF3

	)

37 
	#KBD_CMD_ENABLE
 0xF4

	)

38 
	#KBD_CMD_RESET_DISABLE
 0xF5

	)

39 
	#KBD_CMD_RESET_ENABLE
 0xF6

	)

40 
	#KBD_CMD_RESET
 0xFF

	)

43 
	#KBD_REPLY_POR
 0xAA

	)

44 
	#KBD_REPLY_ACK
 0xFA

	)

45 
	#KBD_REPLY_RESEND
 0xFE

	)

48 
	#AUX_SET_SCALE11
 0xE6

	)

49 
	#AUX_SET_SCALE21
 0xE7

	)

50 
	#AUX_SET_RES
 0xE8

	)

51 
	#AUX_GET_SCALE
 0xE9

	)

52 
	#AUX_SET_STREAM
 0xEA

	)

53 
	#AUX_POLL
 0xEB

	)

54 
	#AUX_RESET_WRAP
 0xEC

	)

55 
	#AUX_SET_WRAP
 0xEE

	)

56 
	#AUX_SET_REMOTE
 0xF0

	)

57 
	#AUX_GET_TYPE
 0xF2

	)

58 
	#AUX_SET_SAMPLE
 0xF3

	)

59 
	#AUX_ENABLE_DEV
 0xF4

	)

60 
	#AUX_DISABLE_DEV
 0xF5

	)

61 
	#AUX_SET_DEFAULT
 0xF6

	)

62 
	#AUX_RESET
 0xFF

	)

63 
	#AUX_ACK
 0xFA

	)

65 
	#MOUSE_STATUS_REMOTE
 0x40

	)

66 
	#MOUSE_STATUS_ENABLED
 0x20

	)

67 
	#MOUSE_STATUS_SCALE21
 0x10

	)

69 
	#PS2_QUEUE_SIZE
 256

	)

72 
uöt8_t
 
	md©a
[
PS2_QUEUE_SIZE
];

73 
	mΩå
, 
	mw±r
, 
	mcou¡
;

74 } 
	tPS2Queue
;

77 
PS2Queue
 
	mqueue
;

78 
öt32_t
 
	mwrôe_cmd
;

79 (*
	mupd©e_úq
)(*, );

80 *
	mupd©e_¨g
;

81 } 
	tPS2Sèã
;

84 
PS2Sèã
 
	mcomm⁄
;

85 
	msˇn_íabÀd
;

89 
	må™¶©e
;

90 } 
	tPS2KbdSèã
;

93 
PS2Sèã
 
	mcomm⁄
;

94 
uöt8_t
 
	mmou£_°©us
;

95 
uöt8_t
 
	mmou£_ªsﬁuti⁄
;

96 
uöt8_t
 
	mmou£_ßm∂e_øã
;

97 
uöt8_t
 
	mmou£_wøp
;

98 
uöt8_t
 
	mmou£_ty≥
;

99 
uöt8_t
 
	mmou£_dëe˘_°©e
;

100 
	mmou£_dx
;

101 
	mmou£_dy
;

102 
	mmou£_dz
;

103 
uöt8_t
 
	mmou£_buâ⁄s
;

104 } 
	tPS2Mou£Sèã
;

107 c⁄° 
	gps2_øw_keycode
[128] = {

118 
	$ps2_queue
(*
›aque
, 
b
)

120 
PS2Sèã
 *
s
 = (PS2Sèã *)
›aque
;

121 
PS2Queue
 *
q
 = &
s
->
queue
;

123 i‡(
q
->
cou¡
 >
PS2_QUEUE_SIZE
)

125 
q
->
d©a
[q->
w±r
] = 
b
;

126 i‡(++
q
->
w±r
 =
PS2_QUEUE_SIZE
)

127 
q
->
w±r
 = 0;

128 
q
->
cou¡
++;

129 
s
->
	`upd©e_úq
(s->
upd©e_¨g
, 1);

130 
	}
}

132 
	$ps2_put_keycode
(*
›aque
, 
keycode
)

134 
PS2KbdSèã
 *
s
 = 
›aque
;

135 i‡(!
s
->
å™¶©e
 && 
keycode
 < 0xe0)

137 i‡(
keycode
 & 0x80)

138 
	`ps2_queue
(&
s
->
comm⁄
, 0xf0);

139 
keycode
 = 
ps2_øw_keycode
[keycode & 0x7f];

141 
	`ps2_queue
(&
s
->
comm⁄
, 
keycode
);

142 
	}
}

144 
uöt32_t
 
	$ps2_ªad_d©a
(*
›aque
)

146 
PS2Sèã
 *
s
 = (PS2Sèã *)
›aque
;

147 
PS2Queue
 *
q
;

148 
vÆ
, 
ödex
;

150 
q
 = &
s
->
queue
;

151 i‡(
q
->
cou¡
 == 0) {

155 
ödex
 = 
q
->
Ωå
 - 1;

156 i‡(
ödex
 < 0)

157 
ödex
 = 
PS2_QUEUE_SIZE
 - 1;

158 
vÆ
 = 
q
->
d©a
[
ödex
];

160 
vÆ
 = 
q
->
d©a
[q->
Ωå
];

161 i‡(++
q
->
Ωå
 =
PS2_QUEUE_SIZE
)

162 
q
->
Ωå
 = 0;

163 
q
->
cou¡
--;

165 
s
->
	`upd©e_úq
(s->
upd©e_¨g
, 0);

167 
s
->
	`upd©e_úq
(s->
upd©e_¨g
, 
q
->
cou¡
 != 0);

169  
vÆ
;

170 
	}
}

172 
	$ps2_ª£t_keybﬂrd
(
PS2KbdSèã
 *
s
)

174 
s
->
sˇn_íabÀd
 = 1;

175 
	}
}

177 
	$ps2_wrôe_keybﬂrd
(*
›aque
, 
vÆ
)

179 
PS2KbdSèã
 *
s
 = (PS2KbdSèã *)
›aque
;

181 
s
->
comm⁄
.
wrôe_cmd
) {

184 
vÆ
) {

186 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

189 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_RESEND
);

191 
KBD_CMD_GET_ID
:

192 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

193 
	`ps2_queue
(&
s
->
comm⁄
, 0xab);

194 
	`ps2_queue
(&
s
->
comm⁄
, 0x83);

196 
KBD_CMD_ECHO
:

197 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_CMD_ECHO
);

199 
KBD_CMD_ENABLE
:

200 
s
->
sˇn_íabÀd
 = 1;

201 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

203 
KBD_CMD_SET_LEDS
:

204 
KBD_CMD_SET_RATE
:

205 
s
->
comm⁄
.
wrôe_cmd
 = 
vÆ
;

206 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

208 
KBD_CMD_RESET_DISABLE
:

209 
	`ps2_ª£t_keybﬂrd
(
s
);

210 
s
->
sˇn_íabÀd
 = 0;

211 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

213 
KBD_CMD_RESET_ENABLE
:

214 
	`ps2_ª£t_keybﬂrd
(
s
);

215 
s
->
sˇn_íabÀd
 = 1;

216 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

218 
KBD_CMD_RESET
:

219 
	`ps2_ª£t_keybﬂrd
(
s
);

220 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

221 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_POR
);

224 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

228 
KBD_CMD_SET_LEDS
:

229 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

230 
s
->
comm⁄
.
wrôe_cmd
 = -1;

232 
KBD_CMD_SET_RATE
:

233 
	`ps2_queue
(&
s
->
comm⁄
, 
KBD_REPLY_ACK
);

234 
s
->
comm⁄
.
wrôe_cmd
 = -1;

237 
	}
}

243 
	$ps2_keybﬂrd_£t_å™¶©i⁄
(*
›aque
, 
mode
)

245 
PS2KbdSèã
 *
s
 = (PS2KbdSèã *)
›aque
;

246 
s
->
å™¶©e
 = 
mode
;

247 
	}
}

249 
	$ps2_mou£_£nd_∑ckë
(
PS2Mou£Sèã
 *
s
)

251 
b
;

252 
dx1
, 
dy1
, 
dz1
;

254 
dx1
 = 
s
->
mou£_dx
;

255 
dy1
 = 
s
->
mou£_dy
;

256 
dz1
 = 
s
->
mou£_dz
;

258 i‡(
dx1
 > 127)

259 
dx1
 = 127;

260 i‡(
dx1
 < -127)

261 
dx1
 = -127;

262 i‡(
dy1
 > 127)

263 
dy1
 = 127;

264 i‡(
dy1
 < -127)

265 
dy1
 = -127;

266 
b
 = 0x08 | ((
dx1
 < 0Ë<< 4Ë| ((
dy1
 < 0Ë<< 5Ë| (
s
->
mou£_buâ⁄s
 & 0x07);

267 
	`ps2_queue
(&
s
->
comm⁄
, 
b
);

268 
	`ps2_queue
(&
s
->
comm⁄
, 
dx1
 & 0xff);

269 
	`ps2_queue
(&
s
->
comm⁄
, 
dy1
 & 0xff);

271 
s
->
mou£_ty≥
) {

275 i‡(
dz1
 > 127)

276 
dz1
 = 127;

277 i‡(
dz1
 < -127)

278 
dz1
 = -127;

279 
	`ps2_queue
(&
s
->
comm⁄
, 
dz1
 & 0xff);

282 i‡(
dz1
 > 7)

283 
dz1
 = 7;

284 i‡(
dz1
 < -7)

285 
dz1
 = -7;

286 
b
 = (
dz1
 & 0x0fË| ((
s
->
mou£_buâ⁄s
 & 0x18) << 1);

287 
	`ps2_queue
(&
s
->
comm⁄
, 
b
);

292 
s
->
mou£_dx
 -
dx1
;

293 
s
->
mou£_dy
 -
dy1
;

294 
s
->
mou£_dz
 -
dz1
;

295 
	}
}

297 
	$ps2_mou£_evít
(*
›aque
,

298 
dx
, 
dy
, 
dz
, 
buâ⁄s_°©e
)

300 
PS2Mou£Sèã
 *
s
 = 
›aque
;

303 i‡(!(
s
->
mou£_°©us
 & 
MOUSE_STATUS_ENABLED
))

306 
s
->
mou£_dx
 +
dx
;

307 
s
->
mou£_dy
 -
dy
;

308 
s
->
mou£_dz
 +
dz
;

310 i‡(
s
->
mou£_dx
 =0 && s->
mou£_dy
 =0 && s->
mou£_dz
 == 0 &&

311 
s
->
mou£_buâ⁄s
 =
buâ⁄s_°©e
)

313 
s
->
mou£_buâ⁄s
 = 
buâ⁄s_°©e
;

315 i‡(!(
s
->
mou£_°©us
 & 
MOUSE_STATUS_REMOTE
) &&

316 (
s
->
comm⁄
.
queue
.
cou¡
 < (
PS2_QUEUE_SIZE
 - 16))) {

320 
	`ps2_mou£_£nd_∑ckë
(
s
);

321 i‡(
s
->
mou£_dx
 =0 && s->
mou£_dy
 =0 && s->
mou£_dz
 == 0)

325 
	}
}

327 
	$ps2_wrôe_mou£
(*
›aque
, 
vÆ
)

329 
PS2Mou£Sèã
 *
s
 = (PS2Mou£Sèã *)
›aque
;

330 #ifde‡
DEBUG_MOUSE


331 
	`¥ötf
("kbd: wrôêmou£ 0x%02x\n", 
vÆ
);

333 
s
->
comm⁄
.
wrôe_cmd
) {

337 i‡(
s
->
mou£_wøp
) {

338 i‡(
vÆ
 =
AUX_RESET_WRAP
) {

339 
s
->
mou£_wøp
 = 0;

340 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

342 } i‡(
vÆ
 !
AUX_RESET
) {

343 
	`ps2_queue
(&
s
->
comm⁄
, 
vÆ
);

347 
vÆ
) {

348 
AUX_SET_SCALE11
:

349 
s
->
mou£_°©us
 &~
MOUSE_STATUS_SCALE21
;

350 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

352 
AUX_SET_SCALE21
:

353 
s
->
mou£_°©us
 |
MOUSE_STATUS_SCALE21
;

354 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

356 
AUX_SET_STREAM
:

357 
s
->
mou£_°©us
 &~
MOUSE_STATUS_REMOTE
;

358 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

360 
AUX_SET_WRAP
:

361 
s
->
mou£_wøp
 = 1;

362 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

364 
AUX_SET_REMOTE
:

365 
s
->
mou£_°©us
 |
MOUSE_STATUS_REMOTE
;

366 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

368 
AUX_GET_TYPE
:

369 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

370 
	`ps2_queue
(&
s
->
comm⁄
, s->
mou£_ty≥
);

372 
AUX_SET_RES
:

373 
AUX_SET_SAMPLE
:

374 
s
->
comm⁄
.
wrôe_cmd
 = 
vÆ
;

375 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

377 
AUX_GET_SCALE
:

378 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

379 
	`ps2_queue
(&
s
->
comm⁄
, s->
mou£_°©us
);

380 
	`ps2_queue
(&
s
->
comm⁄
, s->
mou£_ªsﬁuti⁄
);

381 
	`ps2_queue
(&
s
->
comm⁄
, s->
mou£_ßm∂e_øã
);

383 
AUX_POLL
:

384 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

385 
	`ps2_mou£_£nd_∑ckë
(
s
);

387 
AUX_ENABLE_DEV
:

388 
s
->
mou£_°©us
 |
MOUSE_STATUS_ENABLED
;

389 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

391 
AUX_DISABLE_DEV
:

392 
s
->
mou£_°©us
 &~
MOUSE_STATUS_ENABLED
;

393 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

395 
AUX_SET_DEFAULT
:

396 
s
->
mou£_ßm∂e_øã
 = 100;

397 
s
->
mou£_ªsﬁuti⁄
 = 2;

398 
s
->
mou£_°©us
 = 0;

399 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

401 
AUX_RESET
:

402 
s
->
mou£_ßm∂e_øã
 = 100;

403 
s
->
mou£_ªsﬁuti⁄
 = 2;

404 
s
->
mou£_°©us
 = 0;

405 
s
->
mou£_ty≥
 = 0;

406 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

407 
	`ps2_queue
(&
s
->
comm⁄
, 0xaa);

408 
	`ps2_queue
(&
s
->
comm⁄
, s->
mou£_ty≥
);

414 
AUX_SET_SAMPLE
:

415 
s
->
mou£_ßm∂e_øã
 = 
vÆ
;

417 
s
->
mou£_dëe˘_°©e
) {

420 i‡(
vÆ
 == 200)

421 
s
->
mou£_dëe˘_°©e
 = 1;

424 i‡(
vÆ
 == 100)

425 
s
->
mou£_dëe˘_°©e
 = 2;

426 i‡(
vÆ
 == 200)

427 
s
->
mou£_dëe˘_°©e
 = 3;

429 
s
->
mou£_dëe˘_°©e
 = 0;

432 i‡(
vÆ
 == 80)

433 
s
->
mou£_ty≥
 = 3;

434 
s
->
mou£_dëe˘_°©e
 = 0;

437 i‡(
vÆ
 == 80)

438 
s
->
mou£_ty≥
 = 4;

439 
s
->
mou£_dëe˘_°©e
 = 0;

442 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

443 
s
->
comm⁄
.
wrôe_cmd
 = -1;

445 
AUX_SET_RES
:

446 
s
->
mou£_ªsﬁuti⁄
 = 
vÆ
;

447 
	`ps2_queue
(&
s
->
comm⁄
, 
AUX_ACK
);

448 
s
->
comm⁄
.
wrôe_cmd
 = -1;

451 
	}
}

453 
	$ps2_ª£t
(*
›aque
)

455 
PS2Sèã
 *
s
 = (PS2Sèã *)
›aque
;

456 
PS2Queue
 *
q
;

457 
s
->
wrôe_cmd
 = -1;

458 
q
 = &
s
->
queue
;

459 
q
->
Ωå
 = 0;

460 
q
->
w±r
 = 0;

461 
q
->
cou¡
 = 0;

462 
	}
}

464 
	$ps2_comm⁄_ßve
 (
QEMUFûe
 *
f
, 
PS2Sèã
 *
s
)

466 
	`qemu_put_be32s
 (
f
, &
s
->
wrôe_cmd
);

467 
	`qemu_put_be32s
 (
f
, &
s
->
queue
.
Ωå
);

468 
	`qemu_put_be32s
 (
f
, &
s
->
queue
.
w±r
);

469 
	`qemu_put_be32s
 (
f
, &
s
->
queue
.
cou¡
);

470 
	`qemu_put_buf„r
 (
f
, 
s
->
queue
.
d©a
,  (s->queue.data));

471 
	}
}

473 
	$ps2_comm⁄_lﬂd
 (
QEMUFûe
 *
f
, 
PS2Sèã
 *
s
)

475 
	`qemu_gë_be32s
 (
f
, &
s
->
wrôe_cmd
);

476 
	`qemu_gë_be32s
 (
f
, &
s
->
queue
.
Ωå
);

477 
	`qemu_gë_be32s
 (
f
, &
s
->
queue
.
w±r
);

478 
	`qemu_gë_be32s
 (
f
, &
s
->
queue
.
cou¡
);

479 
	`qemu_gë_buf„r
 (
f
, 
s
->
queue
.
d©a
,  (s->queue.data));

480 
	}
}

482 
	$ps2_kbd_ßve
(
QEMUFûe
* 
f
, * 
›aque
)

484 
PS2KbdSèã
 *
s
 = (PS2KbdSèã*)
›aque
;

486 
	`ps2_comm⁄_ßve
 (
f
, &
s
->
comm⁄
);

487 
	`qemu_put_be32s
(
f
, &
s
->
sˇn_íabÀd
);

488 
	`qemu_put_be32s
(
f
, &
s
->
å™¶©e
);

489 
	}
}

491 
	$ps2_mou£_ßve
(
QEMUFûe
* 
f
, * 
›aque
)

493 
PS2Mou£Sèã
 *
s
 = (PS2Mou£Sèã*)
›aque
;

495 
	`ps2_comm⁄_ßve
 (
f
, &
s
->
comm⁄
);

496 
	`qemu_put_8s
(
f
, &
s
->
mou£_°©us
);

497 
	`qemu_put_8s
(
f
, &
s
->
mou£_ªsﬁuti⁄
);

498 
	`qemu_put_8s
(
f
, &
s
->
mou£_ßm∂e_øã
);

499 
	`qemu_put_8s
(
f
, &
s
->
mou£_wøp
);

500 
	`qemu_put_8s
(
f
, &
s
->
mou£_ty≥
);

501 
	`qemu_put_8s
(
f
, &
s
->
mou£_dëe˘_°©e
);

502 
	`qemu_put_be32s
(
f
, &
s
->
mou£_dx
);

503 
	`qemu_put_be32s
(
f
, &
s
->
mou£_dy
);

504 
	`qemu_put_be32s
(
f
, &
s
->
mou£_dz
);

505 
	`qemu_put_8s
(
f
, &
s
->
mou£_buâ⁄s
);

506 
	}
}

508 
	$ps2_kbd_lﬂd
(
QEMUFûe
* 
f
, * 
›aque
, 
vîsi⁄_id
)

510 
PS2KbdSèã
 *
s
 = (PS2KbdSèã*)
›aque
;

512 i‡(
vîsi⁄_id
 != 2)

513  -
EINVAL
;

515 
	`ps2_comm⁄_lﬂd
 (
f
, &
s
->
comm⁄
);

516 
	`qemu_gë_be32s
(
f
, &
s
->
sˇn_íabÀd
);

517 
	`qemu_gë_be32s
(
f
, &
s
->
å™¶©e
);

519 
	}
}

521 
	$ps2_mou£_lﬂd
(
QEMUFûe
* 
f
, * 
›aque
, 
vîsi⁄_id
)

523 
PS2Mou£Sèã
 *
s
 = (PS2Mou£Sèã*)
›aque
;

525 i‡(
vîsi⁄_id
 != 2)

526  -
EINVAL
;

528 
	`ps2_comm⁄_lﬂd
 (
f
, &
s
->
comm⁄
);

529 
	`qemu_gë_8s
(
f
, &
s
->
mou£_°©us
);

530 
	`qemu_gë_8s
(
f
, &
s
->
mou£_ªsﬁuti⁄
);

531 
	`qemu_gë_8s
(
f
, &
s
->
mou£_ßm∂e_øã
);

532 
	`qemu_gë_8s
(
f
, &
s
->
mou£_wøp
);

533 
	`qemu_gë_8s
(
f
, &
s
->
mou£_ty≥
);

534 
	`qemu_gë_8s
(
f
, &
s
->
mou£_dëe˘_°©e
);

535 
	`qemu_gë_be32s
(
f
, &
s
->
mou£_dx
);

536 
	`qemu_gë_be32s
(
f
, &
s
->
mou£_dy
);

537 
	`qemu_gë_be32s
(
f
, &
s
->
mou£_dz
);

538 
	`qemu_gë_8s
(
f
, &
s
->
mou£_buâ⁄s
);

540 
	}
}

542 *
ps2_kbd_öô
((*
upd©e_úq
)(*, ), *
upd©e_¨g
)

544 
PS2KbdSèã
 *
s
 = (PS2KbdSèã *)
	`qemu_mÆlocz
((PS2KbdState));

546 
s
->
comm⁄
.
upd©e_úq
 = update_irq;

547 
s
->
comm⁄
.
upd©e_¨g
 = update_arg;

548 
	`ps2_ª£t
(&
s
->
comm⁄
);

549 
	`ªgi°î_ßvevm
("ps2kbd", 0, 2, 
ps2_kbd_ßve
, 
ps2_kbd_lﬂd
, 
s
);

550 
	`qemu_add_kbd_evít_h™dÀr
(
ps2_put_keycode
, 
s
);

551 
	`qemu_ªgi°î_ª£t
(
ps2_ª£t
, &
s
->
comm⁄
);

552  
s
;

553 
	}
}

555 *
ps2_mou£_öô
((*
upd©e_úq
)(*, ), *
upd©e_¨g
)

557 
PS2Mou£Sèã
 *
s
 = (PS2Mou£Sèã *)
	`qemu_mÆlocz
((PS2MouseState));

559 
s
->
comm⁄
.
upd©e_úq
 = update_irq;

560 
s
->
comm⁄
.
upd©e_¨g
 = update_arg;

561 
	`ps2_ª£t
(&
s
->
comm⁄
);

562 
	`ªgi°î_ßvevm
("ps2mou£", 0, 2, 
ps2_mou£_ßve
, 
ps2_mou£_lﬂd
, 
s
);

563 
	`qemu_add_mou£_evít_h™dÀr
(
ps2_mou£_evít
, 
s
, 0, "QEMU PS/2 Mouse");

564 
	`qemu_ªgi°î_ª£t
(
ps2_ª£t
, &
s
->
comm⁄
);

565  
s
;

566 
	}
}

	@realview.c

10 
	~"vl.h
"

11 
	~"¨m_pic.h
"

15 
	$ªÆvõw_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

16 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

17 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

18 c⁄° *
öôrd_fûíame
)

20 
CPUSèã
 *
ív
;

21 *
pic
;

22 *
scsi_hba
;

23 
PCIBus
 *
pci_bus
;

24 
NICInfo
 *
nd
;

25 
n
;

26 
d⁄e_smc
 = 0;

28 
ív
 = 
	`˝u_öô
();

29 
	`˝u_¨m_£t_modñ
(
ív
, 
ARM_CPUID_ARM926
);

33 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 
IO_MEM_RAM
);

35 
	`¨m_sys˘l_öô
(0x10000000, 0xc1400400);

36 
pic
 = 
	`¨m_pic_öô_˝u
(
ív
);

40 
pic
 = 
	`¨m_gic_öô
(0x10040000,Öic, 
ARM_PIC_CPU_IRQ
);

41 
	`∂050_öô
(0x10006000, 
pic
, 20, 0);

42 
	`∂050_öô
(0x10007000, 
pic
, 21, 1);

44 
	`∂011_öô
(0x10009000, 
pic
, 12, 
£rül_hds
[0]);

45 
	`∂011_öô
(0x1000a000, 
pic
, 13, 
£rül_hds
[1]);

46 
	`∂011_öô
(0x1000b000, 
pic
, 14, 
£rül_hds
[2]);

47 
	`∂011_öô
(0x1000c000, 
pic
, 15, 
£rül_hds
[3]);

50 
	`∂080_öô
(0x10030000, 
pic
, 24, 2);

52 
	`•804_öô
(0x10011000, 
pic
, 4);

53 
	`•804_öô
(0x10012000, 
pic
, 5);

55 
	`∂110_öô
(
ds
, 0x10020000, 
pic
, 23, 1);

57 
pci_bus
 = 
	`pci_vpb_öô
(
pic
, 48, 1);

58 i‡(
usb_íabÀd
) {

59 
	`usb_ohci_öô
(
pci_bus
, 3, -1);

61 
scsi_hba
 = 
	`lsi_scsi_öô
(
pci_bus
, -1);

62 
n
 = 0;Ç < 
MAX_DISKS
;Ç++) {

63 i‡(
bs_èbÀ
[
n
]) {

64 
	`lsi_scsi_©èch
(
scsi_hba
, 
bs_èbÀ
[
n
],Ç);

67 
n
 = 0;Ç < 
nb_nics
;Ç++) {

68 
nd
 = &
nd_èbÀ
[
n
];

69 i‡(!
nd
->
modñ
)

70 
nd
->
modñ
 = 
d⁄e_smc
 ? "rtl8139" : "smc91c111";

71 i‡(
	`°rcmp
(
nd
->
modñ
, "smc91c111") == 0) {

72 
	`smc91c111_öô
(
nd
, 0x4e000000, 
pic
, 28);

74 
	`pci_nic_öô
(
pci_bus
, 
nd
, -1);

130 
	`¨m_lﬂd_kî√l
(
ív
, 
øm_size
, 
kî√l_fûíame
, 
kî√l_cmdlöe
,

131 
öôrd_fûíame
, 0x33b);

132 
	}
}

134 
QEMUMachöe
 
	gªÆvõw_machöe
 = {

137 
ªÆvõw_öô


	@rtl8139.c

46 
	~"vl.h
"

51 
	#PCI_FREQUENCY
 33000000L

	)

57 
	#RTL8139_CALCULATE_RXCRC
 1

	)

62 #i‡
deföed
(
RTL8139_CALCULATE_RXCRC
)

64 
	~<zlib.h
>

67 
	#SET_MASKED
(
öput
, 
mask
, 
cuº
) \

68 ––(
öput
Ë& ~(
mask
ËË| ( (
cuº
Ë& (maskËË)

	)

71 
	#MOD2
(
öput
, 
size
) \

72 ––
öput
 ) & ( 
size
 - 1 ) )

	)

74 #i‡
deföed
 (
DEBUG_RTL8139
)

75 
	#DEBUG_PRINT
(
x
Ëdÿ{ 
¥ötf
 x ; } 0)

	)

77 
	#DEBUG_PRINT
(
x
)

	)

81 
	eRTL8139_ªgi°îs
 {

82 
	mMAC0
 = 0,

83 
	mMAR0
 = 8,

84 
	mTxSètus0
 = 0x10,

86 
	mTxAddr0
 = 0x20,

87 
	mRxBuf
 = 0x30,

88 
	mChùCmd
 = 0x37,

89 
	mRxBufPå
 = 0x38,

90 
	mRxBufAddr
 = 0x3A,

91 
	mI¡rMask
 = 0x3C,

92 
	mI¡rSètus
 = 0x3E,

93 
	mTxC⁄fig
 = 0x40,

94 
	mRxC⁄fig
 = 0x44,

95 
	mTimî
 = 0x48,

96 
	mRxMis£d
 = 0x4C,

97 
	mCfg9346
 = 0x50,

98 
	mC⁄fig0
 = 0x51,

99 
	mC⁄fig1
 = 0x52,

100 
	mFœshReg
 = 0x54,

101 
	mMedüSètus
 = 0x58,

102 
	mC⁄fig3
 = 0x59,

103 
	mC⁄fig4
 = 0x5A,

104 
	mH…Clk
 = 0x5B,

105 
	mMu…iI¡r
 = 0x5C,

106 
	mPCIRevisi⁄ID
 = 0x5E,

107 
	mTxSumm¨y
 = 0x60,

108 
	mBasicModeCål
 = 0x62,

109 
	mBasicModeSètus
 = 0x64,

110 
	mNWayAdvît
 = 0x66,

111 
	mNWayLPAR
 = 0x68,

112 
	mNWayEx∑nsi⁄
 = 0x6A,

114 
	mFIFOTMS
 = 0x70,

115 
	mCSCR
 = 0x74,

116 
	mPARA78
 = 0x78,

117 
	mPARA7c
 = 0x7c,

118 
	mC⁄fig5
 = 0xD8,

120 
	mTxPﬁl
 = 0xD9,

121 
	mRxMaxSize
 = 0xDA,

122 
	mCpCmd
 = 0xE0,

123 
	mI¡rMôig©e
 = 0xE2,

124 
	mRxRögAddrLO
 = 0xE4,

125 
	mRxRögAddrHI
 = 0xE8,

126 
	mTxThªsh
 = 0xEC,

129 
	eCÀ¨BôMasks
 {

130 
	mMu…iI¡rCÀ¨
 = 0xF000,

131 
	mChùCmdCÀ¨
 = 0xE2,

132 
	mC⁄fig1CÀ¨
 = (1<<7)|(1<<6)|(1<<3)|(1<<2)|(1<<1),

135 
	eChùCmdBôs
 {

136 
	mCmdRe£t
 = 0x10,

137 
	mCmdRxEnb
 = 0x08,

138 
	mCmdTxEnb
 = 0x04,

139 
	mRxBufEm±y
 = 0x01,

143 
	eC∂usCmdBôs
 {

144 
	mCPlusRxVLAN
 = 0x0040,

145 
	mCPlusRxChkSum
 = 0x0020,

146 
	mCPlusRxEnb
 = 0x0002,

147 
	mCPlusTxEnb
 = 0x0001,

151 
	eI¡rSètusBôs
 {

152 
	mPCIEº
 = 0x8000,

153 
	mPCSTimeout
 = 0x4000,

154 
	mRxFIFOOvî
 = 0x40,

155 
	mRxUndîrun
 = 0x20,

156 
	mRxOvîÊow
 = 0x10,

157 
	mTxEº
 = 0x08,

158 
	mTxOK
 = 0x04,

159 
	mRxEº
 = 0x02,

160 
	mRxOK
 = 0x01,

162 
	mRxAckBôs
 = 
RxFIFOOvî
 | 
RxOvîÊow
 | 
RxOK
,

165 
	eTxSètusBôs
 {

166 
	mTxHo°Owns
 = 0x2000,

167 
	mTxUndîrun
 = 0x4000,

168 
	mTxSètOK
 = 0x8000,

169 
	mTxOutOfWödow
 = 0x20000000,

170 
	mTxAb‹ãd
 = 0x40000000,

171 
	mTxC¨rõrLo°
 = 0x80000000,

173 
	eRxSètusBôs
 {

174 
	mRxMu…iˇ°
 = 0x8000,

175 
	mRxPhysiˇl
 = 0x4000,

176 
	mRxBrﬂdˇ°
 = 0x2000,

177 
	mRxBadSymbﬁ
 = 0x0020,

178 
	mRxRu¡
 = 0x0010,

179 
	mRxTooL⁄g
 = 0x0008,

180 
	mRxCRCEº
 = 0x0004,

181 
	mRxBadAlign
 = 0x0002,

182 
	mRxSètusOK
 = 0x0001,

186 
	erx_mode_bôs
 {

187 
	mAc˚±Eº
 = 0x20,

188 
	mAc˚±Ru¡
 = 0x10,

189 
	mAc˚±Brﬂdˇ°
 = 0x08,

190 
	mAc˚±Mu…iˇ°
 = 0x04,

191 
	mAc˚±MyPhys
 = 0x02,

192 
	mAc˚±AŒPhys
 = 0x01,

196 
	etx_c⁄fig_bôs
 {

199 
	mTxIFGShi·
 = 24,

200 
	mTxIFG84
 = (0 << 
TxIFGShi·
),

201 
	mTxIFG88
 = (1 << 
TxIFGShi·
),

202 
	mTxIFG92
 = (2 << 
TxIFGShi·
),

203 
	mTxIFG96
 = (3 << 
TxIFGShi·
),

205 
	mTxLo›Back
 = (1 << 18) | (1 << 17),

206 
	mTxCRC
 = (1 << 16),

207 
	mTxCÀ¨Abt
 = (1 << 0),

208 
	mTxDMAShi·
 = 8,

209 
	mTxRëryShi·
 = 4,

211 
	mTxVîsi⁄Mask
 = 0x7C800000,

216 
	eTSAD_bôs
 {

217 
	mTSAD_TOK3
 = 1<<15,

218 
	mTSAD_TOK2
 = 1<<14,

219 
	mTSAD_TOK1
 = 1<<13,

220 
	mTSAD_TOK0
 = 1<<12,

221 
	mTSAD_TUN3
 = 1<<11,

222 
	mTSAD_TUN2
 = 1<<10,

223 
	mTSAD_TUN1
 = 1<<9,

224 
	mTSAD_TUN0
 = 1<<8,

225 
	mTSAD_TABT3
 = 1<<07,

226 
	mTSAD_TABT2
 = 1<<06,

227 
	mTSAD_TABT1
 = 1<<05,

228 
	mTSAD_TABT0
 = 1<<04,

229 
	mTSAD_OWN3
 = 1<<03,

230 
	mTSAD_OWN2
 = 1<<02,

231 
	mTSAD_OWN1
 = 1<<01,

232 
	mTSAD_OWN0
 = 1<<00,

237 
	eC⁄fig1Bôs
 {

238 
	mCfg1_PM_E«bÀ
 = 0x01,

239 
	mCfg1_VPD_E«bÀ
 = 0x02,

240 
	mCfg1_PIO
 = 0x04,

241 
	mCfg1_MMIO
 = 0x08,

242 
	mLWAKE
 = 0x10,

243 
	mCfg1_Drivî_Lﬂd
 = 0x20,

244 
	mCfg1_LED0
 = 0x40,

245 
	mCfg1_LED1
 = 0x80,

246 
	mSLEEP
 = (1 << 1),

247 
	mPWRDN
 = (1 << 0),

251 
	eC⁄fig3Bôs
 {

252 
	mCfg3_FBtBEn
 = (1 << 0),

253 
	mCfg3_FuncRegEn
 = (1 << 1),

254 
	mCfg3_CLKRUN_En
 = (1 << 2),

255 
	mCfg3_C¨dB_En
 = (1 << 3),

256 
	mCfg3_LökUp
 = (1 << 4),

257 
	mCfg3_Magic
 = (1 << 5),

258 
	mCfg3_PARM_En
 = (1 << 6),

259 
	mCfg3_GNTSñ
 = (1 << 7),

263 
	eC⁄fig4Bôs
 {

264 
	mLWPTN
 = (1 << 2),

268 
	eC⁄fig5Bôs
 {

269 
	mCfg5_PME_STS
 = (1 << 0),

270 
	mCfg5_LANWake
 = (1 << 1),

271 
	mCfg5_LDPS
 = (1 << 2),

272 
	mCfg5_FIFOAddrPå
 = (1 << 3),

273 
	mCfg5_UWF
 = (1 << 4),

274 
	mCfg5_MWF
 = (1 << 5),

275 
	mCfg5_BWF
 = (1 << 6),

278 
	eRxC⁄figBôs
 {

280 
	mRxCfgFIFOShi·
 = 13,

281 
	mRxCfgFIFON⁄e
 = (7 << 
RxCfgFIFOShi·
),

284 
	mRxCfgDMAShi·
 = 8,

285 
	mRxCfgDMAU∆imôed
 = (7 << 
RxCfgDMAShi·
),

288 
	mRxCfgRcv8K
 = 0,

289 
	mRxCfgRcv16K
 = (1 << 11),

290 
	mRxCfgRcv32K
 = (1 << 12),

291 
	mRxCfgRcv64K
 = (1 << 11) | (1 << 12),

294 
	mRxNoWøp
 = (1 << 7),

307 
	eCSCRBôs
 {

308 
	mCSCR_Te°fun
 = 1<<15,

309 
	mCSCR_LD
 = 1<<9,

310 
	mCSCR_HEART_BIT
 = 1<<8,

311 
	mCSCR_JBEN
 = 1<<7,

312 
	mCSCR_F_LINK_100
 = 1<<6,

313 
	mCSCR_F_C⁄√˘
 = 1<<5,

314 
	mCSCR_C⁄_°©us
 = 1<<3,

315 
	mCSCR_C⁄_°©us_En
 = 1<<2,

316 
	mCSCR_PASS_SCR
 = 1<<0,

319 
	eCfg9346Bôs
 {

320 
	mCfg9346_Lock
 = 0x00,

321 
	mCfg9346_U∆ock
 = 0xC0,

325 
	mCH_8139
 = 0,

326 
	mCH_8139_K
,

327 
	mCH_8139A
,

328 
	mCH_8139A_G
,

329 
	mCH_8139B
,

330 
	mCH_8130
,

331 
	mCH_8139C
,

332 
	mCH_8100
,

333 
	mCH_8100B_8139D
,

334 
	mCH_8101
,

335 } 
	tchù_t
;

337 
	echù_Êags
 {

338 
	mHasH…Clk
 = (1 << 0),

339 
	mHasLWake
 = (1 << 1),

342 
	#HW_REVID
(
b30
, 
b29
, 
b28
, 
b27
, 
b26
, 
b23
, 
b22
) \

343 (
b30
<<30 | 
b29
<<29 | 
b28
<<28 | 
b27
<<27 | 
b26
<<26 | 
b23
<<23 | 
b22
<<22)

	)

344 
	#HW_REVID_MASK
 
	`HW_REVID
(1, 1, 1, 1, 1, 1, 1)

	)

346 
	#RTL8139_PCI_REVID_8139
 0x10

	)

347 
	#RTL8139_PCI_REVID_8139CPLUS
 0x20

	)

349 
	#RTL8139_PCI_REVID
 
RTL8139_PCI_REVID_8139CPLUS


	)

352 
	#EEPROM_9346_ADDR_BITS
 6

	)

353 
	#EEPROM_9346_SIZE
 (1 << 
EEPROM_9346_ADDR_BITS
)

	)

354 
	#EEPROM_9346_ADDR_MASK
 (
EEPROM_9346_SIZE
 - 1)

	)

356 
	eChù9346O≥øti⁄


358 
	mChù9346_›_mask
 = 0xc0,

359 
	mChù9346_›_ªad
 = 0x80,

360 
	mChù9346_›_wrôe
 = 0x40,

361 
	mChù9346_›_ext_mask
 = 0xf0,

362 
	mChù9346_›_wrôe_íabÀ
 = 0x30,

363 
	mChù9346_›_wrôe_Æl
 = 0x10,

364 
	mChù9346_›_wrôe_dißbÀ
 = 0x00,

367 
	eChù9346Mode


369 
	mChù9346_n⁄e
 = 0,

370 
	mChù9346_íãr_comm™d_mode
,

371 
	mChù9346_ªad_comm™d
,

372 
	mChù9346_d©a_ªad
,

373 
	mChù9346_d©a_wrôe
,

374 
	mChù9346_d©a_wrôe_Æl
,

377 
	sEE¥om9346


379 
uöt16_t
 
	mc⁄ã¡s
[
EEPROM_9346_SIZE
];

380 
	mmode
;

381 
uöt32_t
 
	mtick
;

382 
uöt8_t
 
	maddªss
;

383 
uöt16_t
 
	möput
;

384 
uöt16_t
 
	mouçut
;

386 
uöt8_t
 
	mìcs
;

387 
uöt8_t
 
	mìsk
;

388 
uöt8_t
 
	mìdi
;

389 
uöt8_t
 
	mìdo
;

390 } 
	tEE¥om9346
;

392 
	sRTL8139TÆlyCou¡îs


395 
uöt64_t
 
	mTxOk
;

396 
uöt64_t
 
	mRxOk
;

397 
uöt64_t
 
	mTxERR
;

398 
uöt32_t
 
	mRxERR
;

399 
uöt16_t
 
	mMissPkt
;

400 
uöt16_t
 
	mFAE
;

401 
uöt32_t
 
	mTx1Cﬁ
;

402 
uöt32_t
 
	mTxMCﬁ
;

403 
uöt64_t
 
	mRxOkPhy
;

404 
uöt64_t
 
	mRxOkBrd
;

405 
uöt32_t
 
	mRxOkMul
;

406 
uöt16_t
 
	mTxAbt
;

407 
uöt16_t
 
	mTxUnd∫
;

408 } 
	tRTL8139TÆlyCou¡îs
;

411 
RTL8139TÆlyCou¡îs_˛ór
(
RTL8139TÆlyCou¡îs
* 
cou¡îs
);

414 
RTL8139TÆlyCou¡îs_physiˇl_mem‹y_wrôe
(
èrgë_phys_addr_t
 
tc_addr
, 
RTL8139TÆlyCou¡îs
* 
cou¡îs
);

417 
RTL8139TÆlyCou¡îs_lﬂd
(
QEMUFûe
* 
f
, 
RTL8139TÆlyCou¡îs
 *
èŒy_cou¡îs
);

420 
RTL8139TÆlyCou¡îs_ßve
(
QEMUFûe
* 
f
, 
RTL8139TÆlyCou¡îs
 *
èŒy_cou¡îs
);

422 
	sRTL8139Sèã
 {

423 
uöt8_t
 
	mphys
[8];

424 
uöt8_t
 
	mmu…
[8];

426 
uöt32_t
 
	mTxSètus
[4];

427 
uöt32_t
 
	mTxAddr
[4];

428 
uöt32_t
 
	mRxBuf
;

429 
uöt32_t
 
	mRxBuf„rSize
;

430 
uöt32_t
 
	mRxBufPå
;

431 
uöt32_t
 
	mRxBufAddr
;

433 
uöt16_t
 
	mI¡rSètus
;

434 
uöt16_t
 
	mI¡rMask
;

436 
uöt32_t
 
	mTxC⁄fig
;

437 
uöt32_t
 
	mRxC⁄fig
;

438 
uöt32_t
 
	mRxMis£d
;

440 
uöt16_t
 
	mCSCR
;

442 
uöt8_t
 
	mCfg9346
;

443 
uöt8_t
 
	mC⁄fig0
;

444 
uöt8_t
 
	mC⁄fig1
;

445 
uöt8_t
 
	mC⁄fig3
;

446 
uöt8_t
 
	mC⁄fig4
;

447 
uöt8_t
 
	mC⁄fig5
;

449 
uöt8_t
 
	m˛ock_íabÀd
;

450 
uöt8_t
 
	mbChùCmdSèã
;

452 
uöt16_t
 
	mMu…iI¡r
;

454 
uöt16_t
 
	mBasicModeCål
;

455 
uöt16_t
 
	mBasicModeSètus
;

456 
uöt16_t
 
	mNWayAdvît
;

457 
uöt16_t
 
	mNWayLPAR
;

458 
uöt16_t
 
	mNWayEx∑nsi⁄
;

460 
uöt16_t
 
	mCpCmd
;

461 
uöt8_t
 
	mTxThªsh
;

463 
	múq
;

464 
PCIDevi˚
 *
	mpci_dev
;

465 
VLANClõ¡Sèã
 *
	mvc
;

466 
uöt8_t
 
	mmaˇddr
[6];

467 
	mπl8139_mmio_io_addr
;

470 
uöt32_t
 
	mcuºTxDesc
;

473 
uöt32_t
 
	mcuºCPlusRxDesc
;

474 
uöt32_t
 
	mcuºCPlusTxDesc
;

476 
uöt32_t
 
	mRxRögAddrLO
;

477 
uöt32_t
 
	mRxRögAddrHI
;

479 
EE¥om9346
 
	mì¥om
;

481 
uöt32_t
 
	mTCTR
;

482 
uöt32_t
 
	mTimîI¡
;

483 
öt64_t
 
	mTCTR_ba£
;

486 
RTL8139TÆlyCou¡îs
 
	mèŒy_cou¡îs
;

489 
uöt8_t
 *
	m˝lus_txbuf„r
;

490 
	m˝lus_txbuf„r_Àn
;

491 
	m˝lus_txbuf„r_off£t
;

494 
QEMUTimî
 *
	mtimî
;

496 } 
	tRTL8139Sèã
;

498 
	$¥om9346_decode_comm™d
(
EE¥om9346
 *
ì¥om
, 
uöt8_t
 
comm™d
)

500 
	`DEBUG_PRINT
(("RTL8139:Éïrom comm™d 0x%02x\n", 
comm™d
));

502 
comm™d
 & 
Chù9346_›_mask
)

504 
Chù9346_›_ªad
:

506 
ì¥om
->
addªss
 = 
comm™d
 & 
EEPROM_9346_ADDR_MASK
;

507 
ì¥om
->
ouçut
 =Éïrom->
c⁄ã¡s
[ì¥om->
addªss
];

508 
ì¥om
->
ìdo
 = 0;

509 
ì¥om
->
tick
 = 0;

510 
ì¥om
->
mode
 = 
Chù9346_d©a_ªad
;

511 
	`DEBUG_PRINT
(("RTL8139:ÉepromÑead fromáddress 0x%02x data=0x%04x\n",

512 
ì¥om
->
addªss
,Éïrom->
ouçut
));

516 
Chù9346_›_wrôe
:

518 
ì¥om
->
addªss
 = 
comm™d
 & 
EEPROM_9346_ADDR_MASK
;

519 
ì¥om
->
öput
 = 0;

520 
ì¥om
->
tick
 = 0;

521 
ì¥om
->
mode
 = 
Chù9346_n⁄e
;

522 
	`DEBUG_PRINT
(("RTL8139:Éeprom begin writeÅoáddress 0x%02x\n",

523 
ì¥om
->
addªss
));

527 
ì¥om
->
mode
 = 
Chù9346_n⁄e
;

528 
comm™d
 & 
Chù9346_›_ext_mask
)

530 
Chù9346_›_wrôe_íabÀ
:

531 
	`DEBUG_PRINT
(("RTL8139:Éeprom writeÉnabled\n"));

533 
Chù9346_›_wrôe_Æl
:

534 
	`DEBUG_PRINT
(("RTL8139:Éeprom begin writeáll\n"));

536 
Chù9346_›_wrôe_dißbÀ
:

537 
	`DEBUG_PRINT
(("RTL8139:Éeprom write disabled\n"));

542 
	}
}

544 
	$¥om9346_shi·_˛ock
(
EE¥om9346
 *
ì¥om
)

546 
bô
 = 
ì¥om
->
ìdi
?1:0;

548 ++ 
ì¥om
->
tick
;

550 
	`DEBUG_PRINT
(("ì¥om:Åick %dÉedi=%dÉedo=%d\n", 
ì¥om
->
tick
,Éïrom->
ìdi
,Éïrom->
ìdo
));

552 
ì¥om
->
mode
)

554 
Chù9346_íãr_comm™d_mode
:

555 i‡(
bô
)

557 
ì¥om
->
mode
 = 
Chù9346_ªad_comm™d
;

558 
ì¥om
->
tick
 = 0;

559 
ì¥om
->
öput
 = 0;

560 
	`DEBUG_PRINT
(("eeprom: +++ synchronized, begin commandÑead\n"));

564 
Chù9346_ªad_comm™d
:

565 
ì¥om
->
öput
 = (ì¥om->öpuà<< 1Ë| (
bô
 & 1);

566 i‡(
ì¥om
->
tick
 == 8)

568 
	`¥om9346_decode_comm™d
(
ì¥om
,Éïrom->
öput
 & 0xff);

572 
Chù9346_d©a_ªad
:

573 
ì¥om
->
ìdo
 = (ì¥om->
ouçut
 & 0x8000)?1:0;

574 
ì¥om
->
ouçut
 <<= 1;

575 i‡(
ì¥om
->
tick
 == 16)

581 
ì¥om
->
mode
 = 
Chù9346_íãr_comm™d_mode
;

582 
ì¥om
->
öput
 = 0;

583 
ì¥om
->
tick
 = 0;

585 
	`DEBUG_PRINT
(("eeprom: +++Énd ofÑead,áwaitingÇext command\n"));

588 ++
ì¥om
->
addªss
;

589 
ì¥om
->
addªss
 &
EEPROM_9346_ADDR_MASK
;

590 
ì¥om
->
ouçut
 =Éïrom->
c⁄ã¡s
[ì¥om->
addªss
];

591 
ì¥om
->
tick
 = 0;

593 
	`DEBUG_PRINT
(("eeprom: +++ÑeadÇextáddress 0x%02x data=0x%04x\n",

594 
ì¥om
->
addªss
,Éïrom->
ouçut
));

599 
Chù9346_d©a_wrôe
:

600 
ì¥om
->
öput
 = (ì¥om->öpuà<< 1Ë| (
bô
 & 1);

601 i‡(
ì¥om
->
tick
 == 16)

603 
	`DEBUG_PRINT
(("RTL8139:Éeprom writeÅoáddress 0x%02x data=0x%04x\n",

604 
ì¥om
->
addªss
,Éïrom->
öput
));

606 
ì¥om
->
c⁄ã¡s
[ì¥om->
addªss
] =Éïrom->
öput
;

607 
ì¥om
->
mode
 = 
Chù9346_n⁄e
;

608 
ì¥om
->
tick
 = 0;

609 
ì¥om
->
öput
 = 0;

613 
Chù9346_d©a_wrôe_Æl
:

614 
ì¥om
->
öput
 = (ì¥om->öpuà<< 1Ë| (
bô
 & 1);

615 i‡(
ì¥om
->
tick
 == 16)

617 
i
;

618 
i
 = 0; i < 
EEPROM_9346_SIZE
; i++)

620 
ì¥om
->
c⁄ã¡s
[
i
] =Éïrom->
öput
;

622 
	`DEBUG_PRINT
(("RTL8139:Éeprom filled with data=0x%04x\n",

623 
ì¥om
->
öput
));

625 
ì¥om
->
mode
 = 
Chù9346_íãr_comm™d_mode
;

626 
ì¥om
->
tick
 = 0;

627 
ì¥om
->
öput
 = 0;

634 
	}
}

636 
	$¥om9346_gë_wúe
(
RTL8139Sèã
 *
s
)

638 
EE¥om9346
 *
ì¥om
 = &
s
->eeprom;

639 i‡(!
ì¥om
->
ìcs
)

642  
ì¥om
->
ìdo
;

643 
	}
}

645 
	$¥om9346_£t_wúe
(
RTL8139Sèã
 *
s
, 
ìcs
, 
ìsk
, 
ìdi
)

647 
EE¥om9346
 *
ì¥om
 = &
s
->eeprom;

648 
uöt8_t
 
ﬁd_ìcs
 = 
ì¥om
->
ìcs
;

649 
uöt8_t
 
ﬁd_ìsk
 = 
ì¥om
->
ìsk
;

651 
ì¥om
->
ìcs
 =Éecs;

652 
ì¥om
->
ìsk
 =Éesk;

653 
ì¥om
->
ìdi
 =Éedi;

655 
	`DEBUG_PRINT
(("eeprom: +++ wires CS=%d SK=%d DI=%d DO=%d\n",

656 
ì¥om
->
ìcs
,Éïrom->
ìsk
,Éïrom->
ìdi
,Éïrom->
ìdo
));

658 i‡(!
ﬁd_ìcs
 && 
ìcs
)

661 
ì¥om
->
tick
 = 0;

662 
ì¥om
->
öput
 = 0;

663 
ì¥om
->
ouçut
 = 0;

664 
ì¥om
->
mode
 = 
Chù9346_íãr_comm™d_mode
;

666 
	`DEBUG_PRINT
(("===Éeprom: begináccess,Énter command mode\n"));

669 i‡(!
ìcs
)

671 
	`DEBUG_PRINT
(("===Éeprom:Éndáccess\n"));

675 i‡(!
ﬁd_ìsk
 && 
ìsk
)

678 
	`¥om9346_shi·_˛ock
(
ì¥om
);

680 
	}
}

682 
	$πl8139_upd©e_úq
(
RTL8139Sèã
 *
s
)

684 
i§
;

685 
i§
 = (
s
->
I¡rSètus
 & s->
I¡rMask
) & 0xffff;

687 
	`DEBUG_PRINT
(("RTL8139: Set IRQÜine %dÅo %d (%04x %04x)\n",

688 
s
->
úq
, 
i§
 ? 1 : 0, s->
I¡rSètus
, s->
I¡rMask
));

690 i‡(
s
->
úq
 == 16) {

692 
	`pci_£t_úq
(
s
->
pci_dev
, 0, (
i§
 != 0));

695 
	`pic_£t_úq
(
s
->
úq
, (
i§
 != 0));

697 
	}
}

699 
	#POLYNOMIAL
 0x04c11db6

	)

703 
	$compuã_mˇ°_idx
(c⁄° 
uöt8_t
 *
ï
)

705 
uöt32_t
 
¸c
;

706 
ˇºy
, 
i
, 
j
;

707 
uöt8_t
 
b
;

709 
¸c
 = 0xffffffff;

710 
i
 = 0; i < 6; i++) {

711 
b
 = *
ï
++;

712 
j
 = 0; j < 8; j++) {

713 
ˇºy
 = ((
¸c
 & 0x80000000LË? 1 : 0Ë^ (
b
 & 0x01);

714 
¸c
 <<= 1;

715 
b
 >>= 1;

716 i‡(
ˇºy
)

717 
¸c
 = ((¸¯^ 
POLYNOMIAL
Ë| 
ˇºy
);

720  (
¸c
 >> 26);

721 
	}
}

723 
	$πl8139_RxWøp
(
RTL8139Sèã
 *
s
)

726  (
s
->
RxC⁄fig
 & (1 << 7));

727 
	}
}

729 
	$πl8139_ª˚ivî_íabÀd
(
RTL8139Sèã
 *
s
)

731  
s
->
bChùCmdSèã
 & 
CmdRxEnb
;

732 
	}
}

734 
	$πl8139_å™smôãr_íabÀd
(
RTL8139Sèã
 *
s
)

736  
s
->
bChùCmdSèã
 & 
CmdTxEnb
;

737 
	}
}

739 
	$πl8139_˝_ª˚ivî_íabÀd
(
RTL8139Sèã
 *
s
)

741  
s
->
CpCmd
 & 
CPlusRxEnb
;

742 
	}
}

744 
	$πl8139_˝_å™smôãr_íabÀd
(
RTL8139Sèã
 *
s
)

746  
s
->
CpCmd
 & 
CPlusTxEnb
;

747 
	}
}

749 
	$πl8139_wrôe_buf„r
(
RTL8139Sèã
 *
s
, c⁄° *
buf
, 
size
)

751 i‡(
s
->
RxBufAddr
 + 
size
 > s->
RxBuf„rSize
)

753 
wøµed
 = 
	`MOD2
(
s
->
RxBufAddr
 + 
size
, s->
RxBuf„rSize
);

756 i‡(
wøµed
 && !(
s
->
RxBuf„rSize
 < 65536 && 
	`πl8139_RxWøp
(s)))

758 
	`DEBUG_PRINT
((">>> RTL8139:ÑxÖackë wøµed i¿buf„∏© %d\n", 
size
-
wøµed
));

760 i‡(
size
 > 
wøµed
)

762 
	`˝u_physiˇl_mem‹y_wrôe
–
s
->
RxBuf
 + s->
RxBufAddr
,

763 
buf
, 
size
-
wøµed
 );

767 
s
->
RxBufAddr
 = 0;

769 
	`˝u_physiˇl_mem‹y_wrôe
–
s
->
RxBuf
 + s->
RxBufAddr
,

770 
buf
 + (
size
-
wøµed
), wrapped );

772 
s
->
RxBufAddr
 = 
wøµed
;

779 
	`˝u_physiˇl_mem‹y_wrôe
–
s
->
RxBuf
 + s->
RxBufAddr
, 
buf
, 
size
 );

781 
s
->
RxBufAddr
 +
size
;

782 
	}
}

784 
	#MIN_BUF_SIZE
 60

	)

785 
ölöe
 
èrgë_phys_addr_t
 
	$πl8139_addr64
(
uöt32_t
 
low
, uöt32_à
high
)

787 #i‡
TARGET_PHYS_ADDR_BITS
 > 32

788  
low
 | ((
èrgë_phys_addr_t
)
high
 << 32);

790  
low
;

792 
	}
}

794 
	$πl8139_ˇn_ª˚ive
(*
›aque
)

796 
RTL8139Sèã
 *
s
 = 
›aque
;

797 
avaû
;

800 i‡(!
s
->
˛ock_íabÀd
)

802 i‡(!
	`πl8139_ª˚ivî_íabÀd
(
s
))

805 i‡(
	`πl8139_˝_ª˚ivî_íabÀd
(
s
)) {

810 
avaû
 = 
	`MOD2
(
s
->
RxBuf„rSize
 + s->
RxBufPå
 - s->
RxBufAddr
,

811 
s
->
RxBuf„rSize
);

812  (
avaû
 == 0 ||ávail >= 1514);

814 
	}
}

816 
	$πl8139_do_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
size
, 
do_öãºu±
)

818 
RTL8139Sèã
 *
s
 = 
›aque
;

820 
uöt32_t
 
∑ckë_hódî
 = 0;

822 
uöt8_t
 
buf1
[60];

823 c⁄° 
uöt8_t
 
brﬂdˇ°_maˇddr
[6] =

826 
	`DEBUG_PRINT
((">>> RTL8139:Ñe˚ivedÜí=%d\n", 
size
));

829 i‡(!
s
->
˛ock_íabÀd
)

831 
	`DEBUG_PRINT
(("RTL8139: stopped ==========================\n"));

837 i‡(!
	`πl8139_ª˚ivî_íabÀd
(
s
))

839 
	`DEBUG_PRINT
(("RTL8139:Ñeceiver disabled ================\n"));

844 i‡(
s
->
RxC⁄fig
 & 
Ac˚±AŒPhys
) {

846 
	`DEBUG_PRINT
((">>> RTL8139:ÖacketÑeceived inÖromiscuous mode\n"));

849 i‡(!
	`memcmp
(
buf
, 
brﬂdˇ°_maˇddr
, 6)) {

851 i‡(!(
s
->
RxC⁄fig
 & 
Ac˚±Brﬂdˇ°
))

853 
	`DEBUG_PRINT
((">>> RTL8139: broadcastÖacketÑejected\n"));

856 ++
s
->
èŒy_cou¡îs
.
RxERR
;

861 
∑ckë_hódî
 |
RxBrﬂdˇ°
;

863 
	`DEBUG_PRINT
((">>> RTL8139: broadcastÖacketÑeceived\n"));

866 ++
s
->
èŒy_cou¡îs
.
RxOkBrd
;

868 } i‡(
buf
[0] & 0x01) {

870 i‡(!(
s
->
RxC⁄fig
 & 
Ac˚±Mu…iˇ°
))

872 
	`DEBUG_PRINT
((">>> RTL8139: multicastÖacketÑejected\n"));

875 ++
s
->
èŒy_cou¡îs
.
RxERR
;

880 
mˇ°_idx
 = 
	`compuã_mˇ°_idx
(
buf
);

882 i‡(!(
s
->
mu…
[
mˇ°_idx
 >> 3] & (1 << (mcast_idx & 7))))

884 
	`DEBUG_PRINT
((">>> RTL8139: multicastáddress mismatch\n"));

887 ++
s
->
èŒy_cou¡îs
.
RxERR
;

892 
∑ckë_hódî
 |
RxMu…iˇ°
;

894 
	`DEBUG_PRINT
((">>> RTL8139: multicastÖacketÑeceived\n"));

897 ++
s
->
èŒy_cou¡îs
.
RxOkMul
;

899 } i‡(
s
->
phys
[0] =
buf
[0] &&

900 
s
->
phys
[1] =
buf
[1] &&

901 
s
->
phys
[2] =
buf
[2] &&

902 
s
->
phys
[3] =
buf
[3] &&

903 
s
->
phys
[4] =
buf
[4] &&

904 
s
->
phys
[5] =
buf
[5]) {

906 i‡(!(
s
->
RxC⁄fig
 & 
Ac˚±MyPhys
))

908 
	`DEBUG_PRINT
((">>> RTL8139:ÑejectingÖhysicaláddress matchingÖacket\n"));

911 ++
s
->
èŒy_cou¡îs
.
RxERR
;

916 
∑ckë_hódî
 |
RxPhysiˇl
;

918 
	`DEBUG_PRINT
((">>> RTL8139:Öhysicaláddress matchingÖacketÑeceived\n"));

921 ++
s
->
èŒy_cou¡îs
.
RxOkPhy
;

925 
	`DEBUG_PRINT
((">>> RTL8139: unknownÖacket\n"));

928 ++
s
->
èŒy_cou¡îs
.
RxERR
;

935 i‡(
size
 < 
MIN_BUF_SIZE
) {

936 
	`mem˝y
(
buf1
, 
buf
, 
size
);

937 
	`mem£t
(
buf1
 + 
size
, 0, 
MIN_BUF_SIZE
 - size);

938 
buf
 = 
buf1
;

939 
size
 = 
MIN_BUF_SIZE
;

942 i‡(
	`πl8139_˝_ª˚ivî_íabÀd
(
s
))

944 
	`DEBUG_PRINT
(("RTL8139: in C+ Rx mode ================\n"));

949 
	#CP_RX_OWN
 (1<<31)

	)

951 
	#CP_RX_EOR
 (1<<30)

	)

953 
	#CP_RX_BUFFER_SIZE_MASK
 ((1<<13Ë- 1)

	)

955 
	#CP_RX_TAVA
 (1<<16)

	)

957 
	#CP_RX_VLAN_TAG_MASK
 ((1<<16Ë- 1)

	)

961 
des¸ùt‹
 = 
s
->
cuºCPlusRxDesc
;

962 
èrgë_phys_addr_t
 
˝lus_rx_rög_desc
;

964 
˝lus_rx_rög_desc
 = 
	`πl8139_addr64
(
s
->
RxRögAddrLO
, s->
RxRögAddrHI
);

965 
˝lus_rx_rög_desc
 +16 * 
des¸ùt‹
;

967 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêªadög RX des¸ùt‹ %d from ho° mem‹yáà%08x %08x = %016" 
PRIx64
 "\n",

968 
des¸ùt‹
, 
s
->
RxRögAddrHI
, s->
RxRögAddrLO
, (
uöt64_t
)
˝lus_rx_rög_desc
));

970 
uöt32_t
 
vÆ
, 
rxdw0
,
rxdw1
,
rxbufLO
,
rxbufHI
;

972 
	`˝u_physiˇl_mem‹y_ªad
(
˝lus_rx_rög_desc
, (
uöt8_t
 *)&
vÆ
, 4);

973 
rxdw0
 = 
	`À32_to_˝u
(
vÆ
);

974 
	`˝u_physiˇl_mem‹y_ªad
(
˝lus_rx_rög_desc
+4, (
uöt8_t
 *)&
vÆ
, 4);

975 
rxdw1
 = 
	`À32_to_˝u
(
vÆ
);

976 
	`˝u_physiˇl_mem‹y_ªad
(
˝lus_rx_rög_desc
+8, (
uöt8_t
 *)&
vÆ
, 4);

977 
rxbufLO
 = 
	`À32_to_˝u
(
vÆ
);

978 
	`˝u_physiˇl_mem‹y_ªad
(
˝lus_rx_rög_desc
+12, (
uöt8_t
 *)&
vÆ
, 4);

979 
rxbufHI
 = 
	`À32_to_˝u
(
vÆ
);

981 
	`DEBUG_PRINT
(("RTL8139: +++ C+ mode RX descriptor %d %08x %08x %08x %08x\n",

982 
des¸ùt‹
,

983 
rxdw0
, 
rxdw1
, 
rxbufLO
, 
rxbufHI
));

985 i‡(!(
rxdw0
 & 
CP_RX_OWN
))

987 
	`DEBUG_PRINT
(("RTL8139: C+ Rx modê: des¸ùt‹ %d i†ow√d by ho°\n", 
des¸ùt‹
));

989 
s
->
I¡rSètus
 |
RxOvîÊow
;

990 ++
s
->
RxMis£d
;

993 ++
s
->
èŒy_cou¡îs
.
RxERR
;

994 ++
s
->
èŒy_cou¡îs
.
MissPkt
;

996 
	`πl8139_upd©e_úq
(
s
);

1000 
uöt32_t
 
rx_•a˚
 = 
rxdw0
 & 
CP_RX_BUFFER_SIZE_MASK
;

1004 i‡(
size
+4 > 
rx_•a˚
)

1006 
	`DEBUG_PRINT
(("RTL8139: C+ Rx mode : descriptor %d size %dÑeceived %d + 4\n",

1007 
des¸ùt‹
, 
rx_•a˚
, 
size
));

1009 
s
->
I¡rSètus
 |
RxOvîÊow
;

1010 ++
s
->
RxMis£d
;

1013 ++
s
->
èŒy_cou¡îs
.
RxERR
;

1014 ++
s
->
èŒy_cou¡îs
.
MissPkt
;

1016 
	`πl8139_upd©e_úq
(
s
);

1020 
èrgë_phys_addr_t
 
rx_addr
 = 
	`πl8139_addr64
(
rxbufLO
, 
rxbufHI
);

1023 
	`˝u_physiˇl_mem‹y_wrôe
–
rx_addr
, 
buf
, 
size
 );

1025 i‡(
s
->
CpCmd
 & 
CPlusRxChkSum
)

1031 #i‡
	`deföed
 (
RTL8139_CALCULATE_RXCRC
)

1032 
vÆ
 = 
	`˝u_to_À32
(
	`¸c32
(0, 
buf
, 
size
));

1034 
vÆ
 = 0;

1036 
	`˝u_physiˇl_mem‹y_wrôe
–
rx_addr
+
size
, (
uöt8_t
 *)&
vÆ
, 4);

1039 
	#CP_RX_STATUS_FS
 (1<<29)

	)

1041 
	#CP_RX_STATUS_LS
 (1<<28)

	)

1043 
	#CP_RX_STATUS_MAR
 (1<<26)

	)

1045 
	#CP_RX_STATUS_PAM
 (1<<25)

	)

1047 
	#CP_RX_STATUS_BAR
 (1<<24)

	)

1049 
	#CP_RX_STATUS_RUNT
 (1<<19)

	)

1051 
	#CP_RX_STATUS_CRC
 (1<<18)

	)

1053 
	#CP_RX_STATUS_IPF
 (1<<15)

	)

1055 
	#CP_RX_STATUS_UDPF
 (1<<14)

	)

1057 
	#CP_RX_STATUS_TCPF
 (1<<13)

	)

1060 
rxdw0
 &~
CP_RX_OWN
;

1063 
rxdw0
 |
CP_RX_STATUS_FS
;

1066 
rxdw0
 |
CP_RX_STATUS_LS
;

1069 i‡(
∑ckë_hódî
 & 
RxBrﬂdˇ°
)

1070 
rxdw0
 |
CP_RX_STATUS_BAR
;

1071 i‡(
∑ckë_hódî
 & 
RxMu…iˇ°
)

1072 
rxdw0
 |
CP_RX_STATUS_MAR
;

1073 i‡(
∑ckë_hódî
 & 
RxPhysiˇl
)

1074 
rxdw0
 |
CP_RX_STATUS_PAM
;

1077 
rxdw0
 &~
CP_RX_BUFFER_SIZE_MASK
;

1078 
rxdw0
 |(
size
+4);

1081 
rxdw1
 &~
CP_RX_TAVA
;

1084 
vÆ
 = 
	`˝u_to_À32
(
rxdw0
);

1085 
	`˝u_physiˇl_mem‹y_wrôe
(
˝lus_rx_rög_desc
, (
uöt8_t
 *)&
vÆ
, 4);

1086 
vÆ
 = 
	`˝u_to_À32
(
rxdw1
);

1087 
	`˝u_physiˇl_mem‹y_wrôe
(
˝lus_rx_rög_desc
+4, (
uöt8_t
 *)&
vÆ
, 4);

1090 ++
s
->
èŒy_cou¡îs
.
RxOk
;

1093 i‡(
rxdw0
 & 
CP_RX_EOR
)

1095 
s
->
cuºCPlusRxDesc
 = 0;

1099 ++
s
->
cuºCPlusRxDesc
;

1102 
	`DEBUG_PRINT
(("RTL8139: done C+ Rx mode ----------------\n"));

1107 
	`DEBUG_PRINT
(("RTL8139: inÑing Rx mode ================\n"));

1110 
avaû
 = 
	`MOD2
(
s
->
RxBuf„rSize
 + s->
RxBufPå
 - s->
RxBufAddr
, s->RxBufferSize);

1114 i‡(
avaû
 !0 && 
size
 + 8 >=ávail)

1116 
	`DEBUG_PRINT
(("rx overflow:Ñx bufferÜength %d head 0x%04xÑead 0x%04x ===ávailable 0x%04xÇeed 0x%04x\n",

1117 
s
->
RxBuf„rSize
, s->
RxBufAddr
, s->
RxBufPå
, 
avaû
, 
size
 + 8));

1119 
s
->
I¡rSètus
 |
RxOvîÊow
;

1120 ++
s
->
RxMis£d
;

1121 
	`πl8139_upd©e_úq
(
s
);

1125 
∑ckë_hódî
 |
RxSètusOK
;

1127 
∑ckë_hódî
 |(((
size
+4) << 16) & 0xffff0000);

1130 
uöt32_t
 
vÆ
 = 
	`˝u_to_À32
(
∑ckë_hódî
);

1132 
	`πl8139_wrôe_buf„r
(
s
, (
uöt8_t
 *)&
vÆ
, 4);

1134 
	`πl8139_wrôe_buf„r
(
s
, 
buf
, 
size
);

1137 #i‡
	`deföed
 (
RTL8139_CALCULATE_RXCRC
)

1138 
vÆ
 = 
	`˝u_to_À32
(
	`¸c32
(0, 
buf
, 
size
));

1140 
vÆ
 = 0;

1143 
	`πl8139_wrôe_buf„r
(
s
, (
uöt8_t
 *)&
vÆ
, 4);

1146 
s
->
RxBufAddr
 = 
	`MOD2
((s->RxBufAdd∏+ 3Ë& ~0x3, s->
RxBuf„rSize
);

1150 
	`DEBUG_PRINT
(("Ñeceived:Ñx bufferÜength %d head 0x%04xÑead 0x%04x\n",

1151 
s
->
RxBuf„rSize
, s->
RxBufAddr
, s->
RxBufPå
));

1154 
s
->
I¡rSètus
 |
RxOK
;

1156 i‡(
do_öãºu±
)

1158 
	`πl8139_upd©e_úq
(
s
);

1160 
	}
}

1162 
	$πl8139_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
size
)

1164 
	`πl8139_do_ª˚ive
(
›aque
, 
buf
, 
size
, 1);

1165 
	}
}

1167 
	$πl8139_ª£t_rxrög
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
buf„rSize
)

1169 
s
->
RxBuf„rSize
 = 
buf„rSize
;

1170 
s
->
RxBufPå
 = 0;

1171 
s
->
RxBufAddr
 = 0;

1172 
	}
}

1174 
	$πl8139_ª£t
(
RTL8139Sèã
 *
s
)

1176 
i
;

1179 
	`mem˝y
(
s
->
phys
, s->
maˇddr
, 6);

1182 
s
->
I¡rSètus
 = 0;

1183 
s
->
I¡rMask
 = 0;

1185 
	`πl8139_upd©e_úq
(
s
);

1188 
s
->
ì¥om
.
c⁄ã¡s
[0] = 0x8129;

1191 
s
->
ì¥om
.
c⁄ã¡s
[1] = 0x10ec;

1192 
s
->
ì¥om
.
c⁄ã¡s
[2] = 0x8139;

1194 
	`mem˝y
(&
s
->
ì¥om
.
c⁄ã¡s
[7], s->
maˇddr
, 6);

1197 
i
 = 0; i < 4; ++i)

1199 
s
->
TxSètus
[
i
] = 
TxHo°Owns
;

1202 
s
->
cuºTxDesc
 = 0;

1203 
s
->
cuºCPlusRxDesc
 = 0;

1204 
s
->
cuºCPlusTxDesc
 = 0;

1206 
s
->
RxRögAddrLO
 = 0;

1207 
s
->
RxRögAddrHI
 = 0;

1209 
s
->
RxBuf
 = 0;

1211 
	`πl8139_ª£t_rxrög
(
s
, 8192);

1214 
s
->
TxC⁄fig
 = 0;

1218 
s
->
˛ock_íabÀd
 = 0;

1220 
s
->
TxC⁄fig
 |
	`HW_REVID
(1, 1, 1, 0, 1, 1, 0);

1221 
s
->
˛ock_íabÀd
 = 1;

1224 
s
->
bChùCmdSèã
 = 
CmdRe£t
; ;

1227 
s
->
C⁄fig0
 = 0x0;

1228 
s
->
C⁄fig1
 = 0xC;

1229 
s
->
C⁄fig3
 = 0x1;

1230 
s
->
C⁄fig5
 = 0x0;

1232 
s
->
CSCR
 = 
CSCR_F_LINK_100
 | 
CSCR_HEART_BIT
 | 
CSCR_LD
;

1234 
s
->
CpCmd
 = 0x0;

1238 
s
->
BasicModeCål
 = 0x1000;

1240 
s
->
BasicModeSètus
 = 0x7809;

1242 
s
->
BasicModeSètus
 |= 0x0020;

1243 
s
->
BasicModeSètus
 |= 0x0004;

1245 
s
->
NWayAdvît
 = 0x05e1;

1246 
s
->
NWayLPAR
 = 0x05e1;

1247 
s
->
NWayEx∑nsi⁄
 = 0x0001;

1250 
s
->
TCTR
 = 0;

1251 
s
->
TimîI¡
 = 0;

1252 
s
->
TCTR_ba£
 = 0;

1255 
	`RTL8139TÆlyCou¡îs_˛ór
(&
s
->
èŒy_cou¡îs
);

1256 
	}
}

1258 
	$RTL8139TÆlyCou¡îs_˛ór
(
RTL8139TÆlyCou¡îs
* 
cou¡îs
)

1260 
cou¡îs
->
TxOk
 = 0;

1261 
cou¡îs
->
RxOk
 = 0;

1262 
cou¡îs
->
TxERR
 = 0;

1263 
cou¡îs
->
RxERR
 = 0;

1264 
cou¡îs
->
MissPkt
 = 0;

1265 
cou¡îs
->
FAE
 = 0;

1266 
cou¡îs
->
Tx1Cﬁ
 = 0;

1267 
cou¡îs
->
TxMCﬁ
 = 0;

1268 
cou¡îs
->
RxOkPhy
 = 0;

1269 
cou¡îs
->
RxOkBrd
 = 0;

1270 
cou¡îs
->
RxOkMul
 = 0;

1271 
cou¡îs
->
TxAbt
 = 0;

1272 
cou¡îs
->
TxUnd∫
 = 0;

1273 
	}
}

1275 
	$RTL8139TÆlyCou¡îs_physiˇl_mem‹y_wrôe
(
èrgë_phys_addr_t
 
tc_addr
, 
RTL8139TÆlyCou¡îs
* 
èŒy_cou¡îs
)

1277 
uöt16_t
 
vÆ16
;

1278 
uöt32_t
 
vÆ32
;

1279 
uöt64_t
 
vÆ64
;

1281 
vÆ64
 = 
	`˝u_to_À64
(
èŒy_cou¡îs
->
TxOk
);

1282 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 0, (
uöt8_t
 *)&
vÆ64
, 8);

1284 
vÆ64
 = 
	`˝u_to_À64
(
èŒy_cou¡îs
->
RxOk
);

1285 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 8, (
uöt8_t
 *)&
vÆ64
, 8);

1287 
vÆ64
 = 
	`˝u_to_À64
(
èŒy_cou¡îs
->
TxERR
);

1288 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 16, (
uöt8_t
 *)&
vÆ64
, 8);

1290 
vÆ32
 = 
	`˝u_to_À32
(
èŒy_cou¡îs
->
RxERR
);

1291 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 24, (
uöt8_t
 *)&
vÆ32
, 4);

1293 
vÆ16
 = 
	`˝u_to_À16
(
èŒy_cou¡îs
->
MissPkt
);

1294 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 28, (
uöt8_t
 *)&
vÆ16
, 2);

1296 
vÆ16
 = 
	`˝u_to_À16
(
èŒy_cou¡îs
->
FAE
);

1297 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 30, (
uöt8_t
 *)&
vÆ16
, 2);

1299 
vÆ32
 = 
	`˝u_to_À32
(
èŒy_cou¡îs
->
Tx1Cﬁ
);

1300 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 32, (
uöt8_t
 *)&
vÆ32
, 4);

1302 
vÆ32
 = 
	`˝u_to_À32
(
èŒy_cou¡îs
->
TxMCﬁ
);

1303 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 36, (
uöt8_t
 *)&
vÆ32
, 4);

1305 
vÆ64
 = 
	`˝u_to_À64
(
èŒy_cou¡îs
->
RxOkPhy
);

1306 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 40, (
uöt8_t
 *)&
vÆ64
, 8);

1308 
vÆ64
 = 
	`˝u_to_À64
(
èŒy_cou¡îs
->
RxOkBrd
);

1309 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 48, (
uöt8_t
 *)&
vÆ64
, 8);

1311 
vÆ32
 = 
	`˝u_to_À32
(
èŒy_cou¡îs
->
RxOkMul
);

1312 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 56, (
uöt8_t
 *)&
vÆ32
, 4);

1314 
vÆ16
 = 
	`˝u_to_À16
(
èŒy_cou¡îs
->
TxAbt
);

1315 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 60, (
uöt8_t
 *)&
vÆ16
, 2);

1317 
vÆ16
 = 
	`˝u_to_À16
(
èŒy_cou¡îs
->
TxUnd∫
);

1318 
	`˝u_physiˇl_mem‹y_wrôe
(
tc_addr
 + 62, (
uöt8_t
 *)&
vÆ16
, 2);

1319 
	}
}

1322 
	$RTL8139TÆlyCou¡îs_lﬂd
(
QEMUFûe
* 
f
, 
RTL8139TÆlyCou¡îs
 *
èŒy_cou¡îs
)

1324 
	`qemu_gë_be64s
(
f
, &
èŒy_cou¡îs
->
TxOk
);

1325 
	`qemu_gë_be64s
(
f
, &
èŒy_cou¡îs
->
RxOk
);

1326 
	`qemu_gë_be64s
(
f
, &
èŒy_cou¡îs
->
TxERR
);

1327 
	`qemu_gë_be32s
(
f
, &
èŒy_cou¡îs
->
RxERR
);

1328 
	`qemu_gë_be16s
(
f
, &
èŒy_cou¡îs
->
MissPkt
);

1329 
	`qemu_gë_be16s
(
f
, &
èŒy_cou¡îs
->
FAE
);

1330 
	`qemu_gë_be32s
(
f
, &
èŒy_cou¡îs
->
Tx1Cﬁ
);

1331 
	`qemu_gë_be32s
(
f
, &
èŒy_cou¡îs
->
TxMCﬁ
);

1332 
	`qemu_gë_be64s
(
f
, &
èŒy_cou¡îs
->
RxOkPhy
);

1333 
	`qemu_gë_be64s
(
f
, &
èŒy_cou¡îs
->
RxOkBrd
);

1334 
	`qemu_gë_be32s
(
f
, &
èŒy_cou¡îs
->
RxOkMul
);

1335 
	`qemu_gë_be16s
(
f
, &
èŒy_cou¡îs
->
TxAbt
);

1336 
	`qemu_gë_be16s
(
f
, &
èŒy_cou¡îs
->
TxUnd∫
);

1337 
	}
}

1340 
	$RTL8139TÆlyCou¡îs_ßve
(
QEMUFûe
* 
f
, 
RTL8139TÆlyCou¡îs
 *
èŒy_cou¡îs
)

1342 
	`qemu_put_be64s
(
f
, &
èŒy_cou¡îs
->
TxOk
);

1343 
	`qemu_put_be64s
(
f
, &
èŒy_cou¡îs
->
RxOk
);

1344 
	`qemu_put_be64s
(
f
, &
èŒy_cou¡îs
->
TxERR
);

1345 
	`qemu_put_be32s
(
f
, &
èŒy_cou¡îs
->
RxERR
);

1346 
	`qemu_put_be16s
(
f
, &
èŒy_cou¡îs
->
MissPkt
);

1347 
	`qemu_put_be16s
(
f
, &
èŒy_cou¡îs
->
FAE
);

1348 
	`qemu_put_be32s
(
f
, &
èŒy_cou¡îs
->
Tx1Cﬁ
);

1349 
	`qemu_put_be32s
(
f
, &
èŒy_cou¡îs
->
TxMCﬁ
);

1350 
	`qemu_put_be64s
(
f
, &
èŒy_cou¡îs
->
RxOkPhy
);

1351 
	`qemu_put_be64s
(
f
, &
èŒy_cou¡îs
->
RxOkBrd
);

1352 
	`qemu_put_be32s
(
f
, &
èŒy_cou¡îs
->
RxOkMul
);

1353 
	`qemu_put_be16s
(
f
, &
èŒy_cou¡îs
->
TxAbt
);

1354 
	`qemu_put_be16s
(
f
, &
èŒy_cou¡îs
->
TxUnd∫
);

1355 
	}
}

1357 
	$πl8139_ChùCmd_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1359 
vÆ
 &= 0xff;

1361 
	`DEBUG_PRINT
(("RTL8139: ChùCmd wrôêvÆ=0x%08x\n", 
vÆ
));

1363 i‡(
vÆ
 & 
CmdRe£t
)

1365 
	`DEBUG_PRINT
(("RTL8139: ChipCmdÑeset\n"));

1366 
	`πl8139_ª£t
(
s
);

1368 i‡(
vÆ
 & 
CmdRxEnb
)

1370 
	`DEBUG_PRINT
(("RTL8139: ChipCmdÉnableÑeceiver\n"));

1372 
s
->
cuºCPlusRxDesc
 = 0;

1374 i‡(
vÆ
 & 
CmdTxEnb
)

1376 
	`DEBUG_PRINT
(("RTL8139: ChipCmdÉnableÅransmitter\n"));

1378 
s
->
cuºCPlusTxDesc
 = 0;

1382 
vÆ
 = 
	`SET_MASKED
(vÆ, 0xe3, 
s
->
bChùCmdSèã
);

1385 
vÆ
 &~
CmdRe£t
;

1387 
s
->
bChùCmdSèã
 = 
vÆ
;

1388 
	}
}

1390 
	$πl8139_RxBuf„rEm±y
(
RTL8139Sèã
 *
s
)

1392 
uƒód
 = 
	`MOD2
(
s
->
RxBuf„rSize
 + s->
RxBufAddr
 - s->
RxBufPå
, s->RxBufferSize);

1394 i‡(
uƒód
 != 0)

1396 
	`DEBUG_PRINT
(("RTL8139:Ñe˚ivî buf„∏d©®avaûabÀ 0x%04x\n", 
uƒód
));

1400 
	`DEBUG_PRINT
(("RTL8139:Ñeceiver buffer isÉmpty\n"));

1403 
	}
}

1405 
uöt32_t
 
	$πl8139_ChùCmd_ªad
(
RTL8139Sèã
 *
s
)

1407 
uöt32_t
 
ªt
 = 
s
->
bChùCmdSèã
;

1409 i‡(
	`πl8139_RxBuf„rEm±y
(
s
))

1410 
ªt
 |
RxBufEm±y
;

1412 
	`DEBUG_PRINT
(("RTL8139: ChùCmdÑód vÆ=0x%04x\n", 
ªt
));

1414  
ªt
;

1415 
	}
}

1417 
	$πl8139_CpCmd_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1419 
i
;

1421 
vÆ
 &= 0xffff;

1423 
	`DEBUG_PRINT
(("RTL8139C+ comm™dÑegi°î wrôe(wËvÆ=0x%04x\n", 
vÆ
));

1426 
vÆ
 = 
	`SET_MASKED
(vÆ, 0xff84, 
s
->
CpCmd
);

1428 i‡–(
s
->
CpCmd
 & 
CPlusTxEnb
) &&

1429 !(
vÆ
 & 
CPlusTxEnb
) )

1436 
i
 = 0; i < 4; i++)

1438 
s
->
TxSètus
[
i
] = 
TxHo°Owns
;

1442 
s
->
CpCmd
 = 
vÆ
;

1443 
	}
}

1445 
uöt32_t
 
	$πl8139_CpCmd_ªad
(
RTL8139Sèã
 *
s
)

1447 
uöt32_t
 
ªt
 = 
s
->
CpCmd
;

1449 
	`DEBUG_PRINT
(("RTL8139C+ comm™dÑegi°îÑód(wËvÆ=0x%04x\n", 
ªt
));

1451  
ªt
;

1452 
	}
}

1454 
	$πl8139_I¡rMôig©e_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1456 
	`DEBUG_PRINT
(("RTL8139C+ I¡rMôig©êªgi°î wrôe(wËvÆ=0x%04x\n", 
vÆ
));

1457 
	}
}

1459 
uöt32_t
 
	$πl8139_I¡rMôig©e_ªad
(
RTL8139Sèã
 *
s
)

1461 
uöt32_t
 
ªt
 = 0;

1463 
	`DEBUG_PRINT
(("RTL8139C+ I¡rMôig©êªgi°îÑód(wËvÆ=0x%04x\n", 
ªt
));

1465  
ªt
;

1466 
	}
}

1468 
	$πl8139_c⁄fig_wrôóbÀ
(
RTL8139Sèã
 *
s
)

1470 i‡(
s
->
Cfg9346
 & 
Cfg9346_U∆ock
)

1475 
	`DEBUG_PRINT
(("RTL8139: ConfigurationÑegistersáre write-protected\n"));

1478 
	}
}

1480 
	$πl8139_BasicModeCål_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1482 
vÆ
 &= 0xffff;

1484 
	`DEBUG_PRINT
(("RTL8139: BasicModeCå»ªgi°î wrôe(wËvÆ=0x%04x\n", 
vÆ
));

1487 
uöt32
 
mask
 = 0x4cff;

1489 i‡(1 || !
	`πl8139_c⁄fig_wrôóbÀ
(
s
))

1492 
mask
 |= 0x3000;

1494 
mask
 |= 0x0100;

1497 
vÆ
 = 
	`SET_MASKED
(vÆ, 
mask
, 
s
->
BasicModeCål
);

1499 
s
->
BasicModeCål
 = 
vÆ
;

1500 
	}
}

1502 
uöt32_t
 
	$πl8139_BasicModeCål_ªad
(
RTL8139Sèã
 *
s
)

1504 
uöt32_t
 
ªt
 = 
s
->
BasicModeCål
;

1506 
	`DEBUG_PRINT
(("RTL8139: BasicModeCå»ªgi°îÑód(wËvÆ=0x%04x\n", 
ªt
));

1508  
ªt
;

1509 
	}
}

1511 
	$πl8139_BasicModeSètus_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1513 
vÆ
 &= 0xffff;

1515 
	`DEBUG_PRINT
(("RTL8139: BasicModeSètu†ªgi°î wrôe(wËvÆ=0x%04x\n", 
vÆ
));

1518 
vÆ
 = 
	`SET_MASKED
(vÆ, 0xff3f, 
s
->
BasicModeSètus
);

1520 
s
->
BasicModeSètus
 = 
vÆ
;

1521 
	}
}

1523 
uöt32_t
 
	$πl8139_BasicModeSètus_ªad
(
RTL8139Sèã
 *
s
)

1525 
uöt32_t
 
ªt
 = 
s
->
BasicModeSètus
;

1527 
	`DEBUG_PRINT
(("RTL8139: BasicModeSètu†ªgi°îÑód(wËvÆ=0x%04x\n", 
ªt
));

1529  
ªt
;

1530 
	}
}

1532 
	$πl8139_Cfg9346_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1534 
vÆ
 &= 0xff;

1536 
	`DEBUG_PRINT
(("RTL8139: Cfg9346 wrôêvÆ=0x%02x\n", 
vÆ
));

1539 
vÆ
 = 
	`SET_MASKED
(vÆ, 0x31, 
s
->
Cfg9346
);

1541 
uöt32_t
 
›mode
 = 
vÆ
 & 0xc0;

1542 
uöt32_t
 
ì¥om_vÆ
 = 
vÆ
 & 0xf;

1544 i‡(
›mode
 == 0x80) {

1546 
ìcs
 = (
ì¥om_vÆ
 & 0x08)?1:0;

1547 
ìsk
 = (
ì¥om_vÆ
 & 0x04)?1:0;

1548 
ìdi
 = (
ì¥om_vÆ
 & 0x02)?1:0;

1549 
	`¥om9346_£t_wúe
(
s
, 
ìcs
, 
ìsk
, 
ìdi
);

1550 } i‡(
›mode
 == 0x40) {

1552 
vÆ
 = 0;

1553 
	`πl8139_ª£t
(
s
);

1556 
s
->
Cfg9346
 = 
vÆ
;

1557 
	}
}

1559 
uöt32_t
 
	$πl8139_Cfg9346_ªad
(
RTL8139Sèã
 *
s
)

1561 
uöt32_t
 
ªt
 = 
s
->
Cfg9346
;

1563 
uöt32_t
 
›mode
 = 
ªt
 & 0xc0;

1565 i‡(
›mode
 == 0x80)

1568 
ìdo
 = 
	`¥om9346_gë_wúe
(
s
);

1569 i‡(
ìdo
)

1571 
ªt
 |= 0x01;

1575 
ªt
 &= ~0x01;

1579 
	`DEBUG_PRINT
(("RTL8139: Cfg9346Ñód vÆ=0x%02x\n", 
ªt
));

1581  
ªt
;

1582 
	}
}

1584 
	$πl8139_C⁄fig0_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1586 
vÆ
 &= 0xff;

1588 
	`DEBUG_PRINT
(("RTL8139: C⁄fig0 wrôêvÆ=0x%02x\n", 
vÆ
));

1590 i‡(!
	`πl8139_c⁄fig_wrôóbÀ
(
s
))

1594 
vÆ
 = 
	`SET_MASKED
(vÆ, 0xf8, 
s
->
C⁄fig0
);

1596 
s
->
C⁄fig0
 = 
vÆ
;

1597 
	}
}

1599 
uöt32_t
 
	$πl8139_C⁄fig0_ªad
(
RTL8139Sèã
 *
s
)

1601 
uöt32_t
 
ªt
 = 
s
->
C⁄fig0
;

1603 
	`DEBUG_PRINT
(("RTL8139: C⁄fig0Ñód vÆ=0x%02x\n", 
ªt
));

1605  
ªt
;

1606 
	}
}

1608 
	$πl8139_C⁄fig1_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1610 
vÆ
 &= 0xff;

1612 
	`DEBUG_PRINT
(("RTL8139: C⁄fig1 wrôêvÆ=0x%02x\n", 
vÆ
));

1614 i‡(!
	`πl8139_c⁄fig_wrôóbÀ
(
s
))

1618 
vÆ
 = 
	`SET_MASKED
(vÆ, 0xC, 
s
->
C⁄fig1
);

1620 
s
->
C⁄fig1
 = 
vÆ
;

1621 
	}
}

1623 
uöt32_t
 
	$πl8139_C⁄fig1_ªad
(
RTL8139Sèã
 *
s
)

1625 
uöt32_t
 
ªt
 = 
s
->
C⁄fig1
;

1627 
	`DEBUG_PRINT
(("RTL8139: C⁄fig1Ñód vÆ=0x%02x\n", 
ªt
));

1629  
ªt
;

1630 
	}
}

1632 
	$πl8139_C⁄fig3_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1634 
vÆ
 &= 0xff;

1636 
	`DEBUG_PRINT
(("RTL8139: C⁄fig3 wrôêvÆ=0x%02x\n", 
vÆ
));

1638 i‡(!
	`πl8139_c⁄fig_wrôóbÀ
(
s
))

1642 
vÆ
 = 
	`SET_MASKED
(vÆ, 0x8F, 
s
->
C⁄fig3
);

1644 
s
->
C⁄fig3
 = 
vÆ
;

1645 
	}
}

1647 
uöt32_t
 
	$πl8139_C⁄fig3_ªad
(
RTL8139Sèã
 *
s
)

1649 
uöt32_t
 
ªt
 = 
s
->
C⁄fig3
;

1651 
	`DEBUG_PRINT
(("RTL8139: C⁄fig3Ñód vÆ=0x%02x\n", 
ªt
));

1653  
ªt
;

1654 
	}
}

1656 
	$πl8139_C⁄fig4_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1658 
vÆ
 &= 0xff;

1660 
	`DEBUG_PRINT
(("RTL8139: C⁄fig4 wrôêvÆ=0x%02x\n", 
vÆ
));

1662 i‡(!
	`πl8139_c⁄fig_wrôóbÀ
(
s
))

1666 
vÆ
 = 
	`SET_MASKED
(vÆ, 0x0a, 
s
->
C⁄fig4
);

1668 
s
->
C⁄fig4
 = 
vÆ
;

1669 
	}
}

1671 
uöt32_t
 
	$πl8139_C⁄fig4_ªad
(
RTL8139Sèã
 *
s
)

1673 
uöt32_t
 
ªt
 = 
s
->
C⁄fig4
;

1675 
	`DEBUG_PRINT
(("RTL8139: C⁄fig4Ñód vÆ=0x%02x\n", 
ªt
));

1677  
ªt
;

1678 
	}
}

1680 
	$πl8139_C⁄fig5_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1682 
vÆ
 &= 0xff;

1684 
	`DEBUG_PRINT
(("RTL8139: C⁄fig5 wrôêvÆ=0x%02x\n", 
vÆ
));

1687 
vÆ
 = 
	`SET_MASKED
(vÆ, 0x80, 
s
->
C⁄fig5
);

1689 
s
->
C⁄fig5
 = 
vÆ
;

1690 
	}
}

1692 
uöt32_t
 
	$πl8139_C⁄fig5_ªad
(
RTL8139Sèã
 *
s
)

1694 
uöt32_t
 
ªt
 = 
s
->
C⁄fig5
;

1696 
	`DEBUG_PRINT
(("RTL8139: C⁄fig5Ñód vÆ=0x%02x\n", 
ªt
));

1698  
ªt
;

1699 
	}
}

1701 
	$πl8139_TxC⁄fig_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1703 i‡(!
	`πl8139_å™smôãr_íabÀd
(
s
))

1705 
	`DEBUG_PRINT
(("RTL8139:Åønsmôã∏dißbÀd;ÇÿTxC⁄fig wrôêvÆ=0x%08x\n", 
vÆ
));

1709 
	`DEBUG_PRINT
(("RTL8139: TxC⁄fig wrôêvÆ=0x%08x\n", 
vÆ
));

1711 
vÆ
 = 
	`SET_MASKED
(vÆ, 
TxVîsi⁄Mask
 | 0x8070f80f, 
s
->
TxC⁄fig
);

1713 
s
->
TxC⁄fig
 = 
vÆ
;

1714 
	}
}

1716 
	$πl8139_TxC⁄fig_wrôeb
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1718 
	`DEBUG_PRINT
(("RTL8139C TxC⁄fig vü wrôe(bËvÆ=0x%02x\n", 
vÆ
));

1720 
uöt32_t
 
tc
 = 
s
->
TxC⁄fig
;

1721 
tc
 &= 0xFFFFFF00;

1722 
tc
 |(
vÆ
 & 0x000000FF);

1723 
	`πl8139_TxC⁄fig_wrôe
(
s
, 
tc
);

1724 
	}
}

1726 
uöt32_t
 
	$πl8139_TxC⁄fig_ªad
(
RTL8139Sèã
 *
s
)

1728 
uöt32_t
 
ªt
 = 
s
->
TxC⁄fig
;

1730 
	`DEBUG_PRINT
(("RTL8139: TxC⁄figÑód vÆ=0x%04x\n", 
ªt
));

1732  
ªt
;

1733 
	}
}

1735 
	$πl8139_RxC⁄fig_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

1737 
	`DEBUG_PRINT
(("RTL8139: RxC⁄fig wrôêvÆ=0x%08x\n", 
vÆ
));

1740 
vÆ
 = 
	`SET_MASKED
(vÆ, 0xf0fc0040, 
s
->
RxC⁄fig
);

1742 
s
->
RxC⁄fig
 = 
vÆ
;

1745 
	`πl8139_ª£t_rxrög
(
s
, 8192 << ((s->
RxC⁄fig
 >> 11) & 0x3));

1747 
	`DEBUG_PRINT
(("RTL8139: RxC⁄fig wrôêª£àbuf„∏sizêtÿ%d\n", 
s
->
RxBuf„rSize
));

1748 
	}
}

1750 
uöt32_t
 
	$πl8139_RxC⁄fig_ªad
(
RTL8139Sèã
 *
s
)

1752 
uöt32_t
 
ªt
 = 
s
->
RxC⁄fig
;

1754 
	`DEBUG_PRINT
(("RTL8139: RxC⁄figÑód vÆ=0x%08x\n", 
ªt
));

1756  
ªt
;

1757 
	}
}

1759 
	$πl8139_å™s„r_‰ame
(
RTL8139Sèã
 *
s
, c⁄° 
uöt8_t
 *
buf
, 
size
, 
do_öãºu±
)

1761 i‡(!
size
)

1763 
	`DEBUG_PRINT
(("RTL8139: +++ÉmptyÉthernet frame\n"));

1767 i‡(
TxLo›Back
 =(
s
->
TxC⁄fig
 & TxLoopBack))

1769 
	`DEBUG_PRINT
(("RTL8139: +++ÅransmitÜoopback mode\n"));

1770 
	`πl8139_do_ª˚ive
(
s
, 
buf
, 
size
, 
do_öãºu±
);

1774 
	`qemu_£nd_∑ckë
(
s
->
vc
, 
buf
, 
size
);

1776 
	}
}

1778 
	$πl8139_å™smô_⁄e
(
RTL8139Sèã
 *
s
, 
des¸ùt‹
)

1780 i‡(!
	`πl8139_å™smôãr_íabÀd
(
s
))

1782 
	`DEBUG_PRINT
(("RTL8139: +++ cannotÅransmit from descriptor %d:Åransmitter disabled\n",

1783 
des¸ùt‹
));

1784 
s
->
TxSètus
[
des¸ùt‹
] = 
TxAb‹ãd
 | 
TxHo°Owns
;

1788 i‡(
s
->
TxSètus
[
des¸ùt‹
] & 
TxHo°Owns
)

1790 
	`DEBUG_PRINT
(("RTL8139: +++ cannotÅransmit from descriptor %d: owned by host (%08x)\n",

1791 
des¸ùt‹
, 
s
->
TxSètus
[descriptor]));

1792 
s
->
TxSètus
[
des¸ùt‹
] = 
TxAb‹ãd
 | 
TxHo°Owns
;

1796 
	`DEBUG_PRINT
(("RTL8139: +++Åønsmôtög from des¸ùt‹ %d\n", 
des¸ùt‹
));

1798 
txsize
 = 
s
->
TxSètus
[
des¸ùt‹
] & 0x1fff;

1799 
uöt8_t
 
txbuf„r
[0x2000];

1801 
	`DEBUG_PRINT
(("RTL8139: +++ÅransmitÑeading %d bytes from host memoryát 0x%08x\n",

1802 
txsize
, 
s
->
TxAddr
[
des¸ùt‹
]));

1804 
	`˝u_physiˇl_mem‹y_ªad
(
s
->
TxAddr
[
des¸ùt‹
], 
txbuf„r
, 
txsize
);

1807 
s
->
TxSètus
[
des¸ùt‹
] |
TxHo°Owns
;

1808 
s
->
TxSètus
[
des¸ùt‹
] |
TxSètOK
;

1810 
	`πl8139_å™s„r_‰ame
(
s
, 
txbuf„r
, 
txsize
, 0);

1812 
	`DEBUG_PRINT
(("RTL8139: +++Åønsmôãd %d byã†‰om des¸ùt‹ %d\n", 
txsize
, 
des¸ùt‹
));

1815 
s
->
I¡rSètus
 |
TxOK
;

1816 
	`πl8139_upd©e_úq
(
s
);

1819 
	}
}

1822 
	sù_hódî


1824 
uöt8_t
 
	mù_vî_Àn
;

1825 
uöt8_t
 
	mù_tos
;

1826 
uöt16_t
 
	mù_Àn
;

1827 
uöt16_t
 
	mù_id
;

1828 
uöt16_t
 
	mù_off
;

1829 
uöt8_t
 
	mù_âl
;

1830 
uöt8_t
 
	mù_p
;

1831 
uöt16_t
 
	mù_sum
;

1832 
uöt32_t
 
	mù_§c
,
	mù_d°
;

1833 } 
	tù_hódî
;

1835 
	#IP_HEADER_VERSION_4
 4

	)

1836 
	#IP_HEADER_VERSION
(
ù
Ë((ù->
ù_vî_Àn
 >> 4)&0xf)

	)

1837 
	#IP_HEADER_LENGTH
(
ù
Ë(((ù->
ù_vî_Àn
)&0xfË<< 2)

	)

1839 
	st˝_hódî


1841 
uöt16_t
 
	mth_•‹t
;

1842 
uöt16_t
 
	mth_dp‹t
;

1843 
uöt32_t
 
	mth_£q
;

1844 
uöt32_t
 
	mth_ack
;

1845 
uöt16_t
 
	mth_off£t_Êags
;

1846 
uöt16_t
 
	mth_wö
;

1847 
uöt16_t
 
	mth_sum
;

1848 
uöt16_t
 
	mth_uΩ
;

1849 } 
	tt˝_hódî
;

1851 
	sudp_hódî


1853 
uöt16_t
 
	muh_•‹t
;

1854 
uöt16_t
 
	muh_dp‹t
;

1855 
uöt16_t
 
	muh_uÀn
;

1856 
uöt16_t
 
	muh_sum
;

1857 } 
	tudp_hódî
;

1859 
	sù_p£udo_hódî


1861 
uöt32_t
 
	mù_§c
;

1862 
uöt32_t
 
	mù_d°
;

1863 
uöt8_t
 
	mzîos
;

1864 
uöt8_t
 
	mù_¥Ÿo
;

1865 
uöt16_t
 
	mù_∑ylﬂd
;

1866 } 
	tù_p£udo_hódî
;

1868 
	#IP_PROTO_TCP
 6

	)

1869 
	#IP_PROTO_UDP
 17

	)

1871 
	#TCP_HEADER_DATA_OFFSET
(
t˝
Ë(((
	`be16_to_˝u
—˝->
th_off£t_Êags
Ë>> 12)&0xfË<< 2)

	)

1872 
	#TCP_FLAGS_ONLY
(
Êags
Ë((Êags)&0x3f)

	)

1873 
	#TCP_HEADER_FLAGS
(
t˝
Ë
	`TCP_FLAGS_ONLY
(
	`be16_to_˝u
—˝->
th_off£t_Êags
))

	)

1875 
	#TCP_HEADER_CLEAR_FLAGS
(
t˝
, 
off
Ë(—˝)->
th_off£t_Êags
 &
	`˝u_to_be16
(~
	`TCP_FLAGS_ONLY
(off)))

	)

1877 
	#TCP_FLAG_FIN
 0x01

	)

1878 
	#TCP_FLAG_PUSH
 0x08

	)

1881 
uöt16_t
 
	$⁄es_com∂emít_sum
(
uöt8_t
 *
d©a
, 
size_t
 
Àn
)

1883 
uöt32_t
 
ªsu…
 = 0;

1885 ; 
Àn
 > 1; 
d©a
+=2,Üen-=2)

1887 
ªsu…
 +*(
uöt16_t
*)
d©a
;

1891 i‡(
Àn
)

1893 
uöt8_t
 
odd
[2] = {*
d©a
, 0};

1894 
ªsu…
 +*(
uöt16_t
*)
odd
;

1897 
ªsu…
>>16)

1898 
ªsu…
 = (result & 0xffff) + (result >> 16);

1900  
ªsu…
;

1901 
	}
}

1903 
uöt16_t
 
	$ù_checksum
(*
d©a
, 
size_t
 
Àn
)

1905  ~
	`⁄es_com∂emít_sum
((
uöt8_t
*)
d©a
, 
Àn
);

1906 
	}
}

1908 
	$πl8139_˝lus_å™smô_⁄e
(
RTL8139Sèã
 *
s
)

1910 i‡(!
	`πl8139_å™smôãr_íabÀd
(
s
))

1912 
	`DEBUG_PRINT
(("RTL8139: +++ C+ mode:Åransmitter disabled\n"));

1916 i‡(!
	`πl8139_˝_å™smôãr_íabÀd
(
s
))

1918 
	`DEBUG_PRINT
(("RTL8139: +++ C+ mode: C+Åransmitter disabled\n"));

1922 
des¸ùt‹
 = 
s
->
cuºCPlusTxDesc
;

1924 
èrgë_phys_addr_t
 
˝lus_tx_rög_desc
 =

1925 
	`πl8139_addr64
(
s
->
TxAddr
[0], s->TxAddr[1]);

1928 
˝lus_tx_rög_desc
 +16 * 
des¸ùt‹
;

1930 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modeÑeading TX descriptor %d from host memoryát %08x0x%08x = 0x%8lx\n",

1931 
des¸ùt‹
, 
s
->
TxAddr
[1], s->TxAddr[0], 
˝lus_tx_rög_desc
));

1933 
uöt32_t
 
vÆ
, 
txdw0
,
txdw1
,
txbufLO
,
txbufHI
;

1935 
	`˝u_physiˇl_mem‹y_ªad
(
˝lus_tx_rög_desc
, (
uöt8_t
 *)&
vÆ
, 4);

1936 
txdw0
 = 
	`À32_to_˝u
(
vÆ
);

1937 
	`˝u_physiˇl_mem‹y_ªad
(
˝lus_tx_rög_desc
+4, (
uöt8_t
 *)&
vÆ
, 4);

1938 
txdw1
 = 
	`À32_to_˝u
(
vÆ
);

1939 
	`˝u_physiˇl_mem‹y_ªad
(
˝lus_tx_rög_desc
+8, (
uöt8_t
 *)&
vÆ
, 4);

1940 
txbufLO
 = 
	`À32_to_˝u
(
vÆ
);

1941 
	`˝u_physiˇl_mem‹y_ªad
(
˝lus_tx_rög_desc
+12, (
uöt8_t
 *)&
vÆ
, 4);

1942 
txbufHI
 = 
	`À32_to_˝u
(
vÆ
);

1944 
	`DEBUG_PRINT
(("RTL8139: +++ C+ mode TX descriptor %d %08x %08x %08x %08x\n",

1945 
des¸ùt‹
,

1946 
txdw0
, 
txdw1
, 
txbufLO
, 
txbufHI
));

1949 
	#CP_TX_OWN
 (1<<31)

	)

1951 
	#CP_TX_EOR
 (1<<30)

	)

1953 
	#CP_TX_FS
 (1<<29)

	)

1955 
	#CP_TX_LS
 (1<<28)

	)

1957 
	#CP_TX_LGSEN
 (1<<27)

	)

1959 
	#CP_TC_LGSEN_MSS_MASK
 ((1 << 12Ë- 1)

	)

1962 
	#CP_TX_IPCS
 (1<<18)

	)

1964 
	#CP_TX_UDPCS
 (1<<17)

	)

1966 
	#CP_TX_TCPCS
 (1<<16)

	)

1969 
	#CP_TX_BUFFER_SIZE
 (1<<16)

	)

1970 
	#CP_TX_BUFFER_SIZE_MASK
 (
CP_TX_BUFFER_SIZE
 - 1)

	)

1972 
	#CP_RX_TAGC
 (1<<17)

	)

1974 
	#CP_TX_VLAN_TAG_MASK
 ((1<<16Ë- 1)

	)

1980 
	#CP_TX_STATUS_UNF
 (1<<25)

	)

1982 
	#CP_TX_STATUS_TES
 (1<<23)

	)

1984 
	#CP_TX_STATUS_OWC
 (1<<22)

	)

1986 
	#CP_TX_STATUS_LNKF
 (1<<21)

	)

1988 
	#CP_TX_STATUS_EXC
 (1<<20)

	)

1990 i‡(!(
txdw0
 & 
CP_TX_OWN
))

1992 
	`DEBUG_PRINT
(("RTL8139: C+ Tx modê: des¸ùt‹ %d i†ow√d by ho°\n", 
des¸ùt‹
));

1996 
	`DEBUG_PRINT
(("RTL8139: +++ C+ Tx modê:Åønsmôtög from des¸ùt‹ %d\n", 
des¸ùt‹
));

1998 i‡(
txdw0
 & 
CP_TX_FS
)

2000 
	`DEBUG_PRINT
(("RTL8139: +++ C+ Tx modê: des¸ùt‹ %d i†fú° segmíàdes¸ùt‹\n", 
des¸ùt‹
));

2003 
s
->
˝lus_txbuf„r_off£t
 = 0;

2006 
txsize
 = 
txdw0
 & 
CP_TX_BUFFER_SIZE_MASK
;

2007 
èrgë_phys_addr_t
 
tx_addr
 = 
	`πl8139_addr64
(
txbufLO
, 
txbufHI
);

2010 i‡(!
s
->
˝lus_txbuf„r
)

2012 
s
->
˝lus_txbuf„r_Àn
 = 
CP_TX_BUFFER_SIZE
;

2013 
s
->
˝lus_txbuf„r
 = 
	`mÆloc
(s->
˝lus_txbuf„r_Àn
);

2014 
s
->
˝lus_txbuf„r_off£t
 = 0;

2016 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêå™smissi⁄ buf„∏Æloˇãd s∑˚ %d\n", 
s
->
˝lus_txbuf„r_Àn
));

2019 i‡(
s
->
˝lus_txbuf„r
 && s->
˝lus_txbuf„r_off£t
 + 
txsize
 >s->
˝lus_txbuf„r_Àn
)

2021 
	`‰ì
(
s
->
˝lus_txbuf„r
);

2022 
s
->
˝lus_txbuf„r
 = 
NULL
;

2024 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêå™smissi⁄ buf„∏•a˚Éx˚eded: %d\n", 
s
->
˝lus_txbuf„r_off£t
 + 
txsize
));

2027 i‡(!
s
->
˝lus_txbuf„r
)

2031 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêå™smôî faûedÅÿªÆloˇã %d byãs\n", 
s
->
˝lus_txbuf„r_Àn
));

2034 ++
s
->
èŒy_cou¡îs
.
TxERR
;

2035 ++
s
->
èŒy_cou¡îs
.
TxAbt
;

2042 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêå™smôÑódög %d byã†‰om ho° mem‹yáà%016" 
PRIx64
 "Åo offset %d\n",

2043 
txsize
, (
uöt64_t
)
tx_addr
, 
s
->
˝lus_txbuf„r_off£t
));

2045 
	`˝u_physiˇl_mem‹y_ªad
(
tx_addr
, 
s
->
˝lus_txbuf„r
 + s->
˝lus_txbuf„r_off£t
, 
txsize
);

2046 
s
->
˝lus_txbuf„r_off£t
 +
txsize
;

2049 i‡(
txdw0
 & 
CP_TX_EOR
)

2051 
s
->
cuºCPlusTxDesc
 = 0;

2055 ++
s
->
cuºCPlusTxDesc
;

2056 i‡(
s
->
cuºCPlusTxDesc
 >= 64)

2057 
s
->
cuºCPlusTxDesc
 = 0;

2061 
txdw0
 &~
CP_RX_OWN
;

2064 
txdw0
 &~
CP_TX_STATUS_UNF
;

2065 
txdw0
 &~
CP_TX_STATUS_TES
;

2066 
txdw0
 &~
CP_TX_STATUS_OWC
;

2067 
txdw0
 &~
CP_TX_STATUS_LNKF
;

2068 
txdw0
 &~
CP_TX_STATUS_EXC
;

2071 
vÆ
 = 
	`˝u_to_À32
(
txdw0
);

2072 
	`˝u_physiˇl_mem‹y_wrôe
(
˝lus_tx_rög_desc
, (
uöt8_t
 *)&
vÆ
, 4);

2077 i‡(
txdw0
 & 
CP_TX_LS
)

2079 
	`DEBUG_PRINT
(("RTL8139: +++ C+ Tx modê: des¸ùt‹ %d i†œ° segmíàdes¸ùt‹\n", 
des¸ùt‹
));

2083 
uöt8_t
 *
ßved_buf„r
 = 
s
->
˝lus_txbuf„r
;

2084 
ßved_size
 = 
s
->
˝lus_txbuf„r_off£t
;

2085 
ßved_buf„r_Àn
 = 
s
->
˝lus_txbuf„r_Àn
;

2088 
s
->
˝lus_txbuf„r
 = 
NULL
;

2089 
s
->
˝lus_txbuf„r_off£t
 = 0;

2090 
s
->
˝lus_txbuf„r_Àn
 = 0;

2092 i‡(
txdw0
 & (
CP_TX_IPCS
 | 
CP_TX_UDPCS
 | 
CP_TX_TCPCS
 | 
CP_TX_LGSEN
))

2094 
	`DEBUG_PRINT
(("RTL8139: +++ C+ mode offloadedÅask checksum\n"));

2096 
	#ETH_P_IP
 0x0800

	)

2097 
	#ETH_HLEN
 14

	)

2098 
	#ETH_MTU
 1500

	)

2101 
ù_hódî
 *
ù
 = 0;

2102 
hÀn
 = 0;

2103 
uöt8_t
 
ù_¥Ÿocﬁ
 = 0;

2104 
uöt16_t
 
ù_d©a_Àn
 = 0;

2106 
uöt8_t
 *
ëh_∑ylﬂd_d©a
 = 0;

2107 
size_t
 
ëh_∑ylﬂd_Àn
 = 0;

2109 
¥Ÿo
 = 
	`be16_to_˝u
(*(
uöt16_t
 *)(
ßved_buf„r
 + 12));

2110 i‡(
¥Ÿo
 =
ETH_P_IP
)

2112 
	`DEBUG_PRINT
(("RTL8139: +++ C+ mode has IPÖacket\n"));

2115 
ëh_∑ylﬂd_d©a
 = 
ßved_buf„r
 + 
ETH_HLEN
;

2116 
ëh_∑ylﬂd_Àn
 = 
ßved_size
 - 
ETH_HLEN
;

2118 
ù
 = (
ù_hódî
*)
ëh_∑ylﬂd_d©a
;

2120 i‡(
	`IP_HEADER_VERSION
(
ù
Ë!
IP_HEADER_VERSION_4
) {

2121 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modê∑ckë ha†bad IP vîsi⁄ %dÉx≥˘ed %d\n", 
	`IP_HEADER_VERSION
(
ù
), 
IP_HEADER_VERSION_4
));

2122 
ù
 = 
NULL
;

2124 
hÀn
 = 
	`IP_HEADER_LENGTH
(
ù
);

2125 
ù_¥Ÿocﬁ
 = 
ù
->
ù_p
;

2126 
ù_d©a_Àn
 = 
	`be16_to_˝u
(
ù
->
ù_Àn
Ë- 
hÀn
;

2130 i‡(
ù
)

2132 i‡(
txdw0
 & 
CP_TX_IPCS
)

2134 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modeÇeed IP checksum\n"));

2136 i‡(
hÀn
<(
ù_hódî
Ë|| hÀn>
ëh_∑ylﬂd_Àn
) {

2142 
ù
->
ù_sum
 = 0;

2143 
ù
->
ù_sum
 = 
	`ù_checksum
(ù, 
hÀn
);

2144 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêIP hódîÜí=%d checksum=%04x\n", 
hÀn
, 
ù
->
ù_sum
));

2148 i‡((
txdw0
 & 
CP_TX_LGSEN
Ë&& 
ù_¥Ÿocﬁ
 =
IP_PROTO_TCP
)

2150 #i‡
	`deföed
 (
DEBUG_RTL8139
)

2151 
œrge_£nd_mss
 = (
txdw0
 >> 16Ë& 
CP_TC_LGSEN_MSS_MASK
;

2153 
	`DEBUG_PRINT
(("RTL8139: +++ C+ mode offloadedÅask TSO MTU=%d IP data %d frame data %d specified MSS=%d\n",

2154 
ETH_MTU
, 
ù_d©a_Àn
, 
ßved_size
 - 
ETH_HLEN
, 
œrge_£nd_mss
));

2156 
t˝_£nd_off£t
 = 0;

2157 
£nd_cou¡
 = 0;

2160 
uöt8_t
 
ßved_ù_hódî
[60];

2163 
	`mem˝y
(
ßved_ù_hódî
, 
ëh_∑ylﬂd_d©a
, 
hÀn
);

2166 
uöt8_t
 *
d©a_to_checksum
 = 
ëh_∑ylﬂd_d©a
 + 
hÀn
 - 12;

2170 
t˝_hódî
 *
p_t˝_hdr
 = (t˝_hódî*)(
ëh_∑ylﬂd_d©a
 + 
hÀn
);

2172 
t˝_hÀn
 = 
	`TCP_HEADER_DATA_OFFSET
(
p_t˝_hdr
);

2175 
t˝_d©a_Àn
 = 
ù_d©a_Àn
 - 
t˝_hÀn
;

2176 
t˝_chunk_size
 = 
ETH_MTU
 - 
hÀn
 - 
t˝_hÀn
;

2178 
	`DEBUG_PRINT
(("RTL8139: +++ C+ mode TSO IP dataÜen %d TCP hlen %d TCP dataÜen %d TCP chunk size %d\n",

2179 
ù_d©a_Àn
, 
t˝_hÀn
, 
t˝_d©a_Àn
, 
t˝_chunk_size
));

2184 
is_œ°_‰ame
 = 0;

2186 
t˝_£nd_off£t
 = 0;Å˝_£nd_off£à< 
t˝_d©a_Àn
;Å˝_£nd_off£à+
t˝_chunk_size
)

2188 
uöt16_t
 
chunk_size
 = 
t˝_chunk_size
;

2191 i‡(
t˝_£nd_off£t
 + 
t˝_chunk_size
 >
t˝_d©a_Àn
)

2193 
is_œ°_‰ame
 = 1;

2194 
chunk_size
 = 
t˝_d©a_Àn
 - 
t˝_£nd_off£t
;

2197 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêTSO TCP seqnÿ%08x\n", 
	`be32_to_˝u
(
p_t˝_hdr
->
th_£q
)));

2201 
	`mem˝y
(
d©a_to_checksum
, 
ßved_ù_hódî
 + 12, 8);

2203 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêTSO cÆcuœtög TCP checksum f‹Öackë wôh %d byã†d©a\n", 
t˝_hÀn
 + 
chunk_size
));

2205 i‡(
t˝_£nd_off£t
)

2207 
	`mem˝y
((
uöt8_t
*)
p_t˝_hdr
 + 
t˝_hÀn
, (uöt8_t*Ì_t˝_hd∏+Å˝_hÀ¿+ 
t˝_£nd_off£t
, 
chunk_size
);

2211 i‡(!
is_œ°_‰ame
)

2213 
	`TCP_HEADER_CLEAR_FLAGS
(
p_t˝_hdr
, 
TCP_FLAG_PUSH
|
TCP_FLAG_FIN
);

2217 
ù_p£udo_hódî
 *
p_t˝ù_hdr
 = (ù_p£udo_hódî *)
d©a_to_checksum
;

2218 
p_t˝ù_hdr
->
zîos
 = 0;

2219 
p_t˝ù_hdr
->
ù_¥Ÿo
 = 
IP_PROTO_TCP
;

2220 
p_t˝ù_hdr
->
ù_∑ylﬂd
 = 
	`˝u_to_be16
(
t˝_hÀn
 + 
chunk_size
);

2222 
p_t˝_hdr
->
th_sum
 = 0;

2224 
t˝_checksum
 = 
	`ù_checksum
(
d©a_to_checksum
, 
t˝_hÀn
 + 
chunk_size
 + 12);

2225 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêTSO TCP checksum %04x\n", 
t˝_checksum
));

2227 
p_t˝_hdr
->
th_sum
 = 
t˝_checksum
;

2230 
	`mem˝y
(
ëh_∑ylﬂd_d©a
, 
ßved_ù_hódî
, 
hÀn
);

2233 
ù
->
ù_Àn
 = 
	`˝u_to_be16
(
hÀn
 + 
t˝_hÀn
 + 
chunk_size
);

2236 
ù
->
ù_id
 = 
	`˝u_to_be16
(
t˝_£nd_off£t
/
t˝_chunk_size
 + 
	`be16_to_˝u
(ip->ip_id));

2238 
ù
->
ù_sum
 = 0;

2239 
ù
->
ù_sum
 = 
	`ù_checksum
(
ëh_∑ylﬂd_d©a
, 
hÀn
);

2240 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêTSO IP hódîÜí=%d checksum=%04x\n", 
hÀn
, 
ù
->
ù_sum
));

2242 
tso_£nd_size
 = 
ETH_HLEN
 + 
hÀn
 + 
t˝_hÀn
 + 
chunk_size
;

2243 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêTSOÅøns„ºögÖackë sizê%d\n", 
tso_£nd_size
));

2244 
	`πl8139_å™s„r_‰ame
(
s
, 
ßved_buf„r
, 
tso_£nd_size
, 0);

2247 
p_t˝_hdr
->
th_£q
 = 
	`˝u_to_be32
(
chunk_size
 + 
	`be32_to_˝u
(p_tcp_hdr->th_seq));

2248 ++
£nd_cou¡
;

2252 
ßved_size
 = 0;

2254 i‡(
txdw0
 & (
CP_TX_TCPCS
|
CP_TX_UDPCS
))

2256 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modeÇeed TCP or UDP checksum\n"));

2259 
uöt8_t
 
ßved_ù_hódî
[60];

2260 
	`mem˝y
(
ßved_ù_hódî
, 
ëh_∑ylﬂd_d©a
, 
hÀn
);

2262 
uöt8_t
 *
d©a_to_checksum
 = 
ëh_∑ylﬂd_d©a
 + 
hÀn
 - 12;

2267 
	`mem˝y
(
d©a_to_checksum
, 
ßved_ù_hódî
 + 12, 8);

2269 i‡((
txdw0
 & 
CP_TX_TCPCS
Ë&& 
ù_¥Ÿocﬁ
 =
IP_PROTO_TCP
)

2271 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêˇlcuœtög TCP checksum f‹Öackë wôh %d byã†d©a\n", 
ù_d©a_Àn
));

2273 
ù_p£udo_hódî
 *
p_t˝ù_hdr
 = (ù_p£udo_hódî *)
d©a_to_checksum
;

2274 
p_t˝ù_hdr
->
zîos
 = 0;

2275 
p_t˝ù_hdr
->
ù_¥Ÿo
 = 
IP_PROTO_TCP
;

2276 
p_t˝ù_hdr
->
ù_∑ylﬂd
 = 
	`˝u_to_be16
(
ù_d©a_Àn
);

2278 
t˝_hódî
* 
p_t˝_hdr
 = (t˝_hódî *Ë(
d©a_to_checksum
+12);

2280 
p_t˝_hdr
->
th_sum
 = 0;

2282 
t˝_checksum
 = 
	`ù_checksum
(
d©a_to_checksum
, 
ù_d©a_Àn
 + 12);

2283 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêTCP checksum %04x\n", 
t˝_checksum
));

2285 
p_t˝_hdr
->
th_sum
 = 
t˝_checksum
;

2287 i‡((
txdw0
 & 
CP_TX_UDPCS
Ë&& 
ù_¥Ÿocﬁ
 =
IP_PROTO_UDP
)

2289 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêˇlcuœtög UDP checksum f‹Öackë wôh %d byã†d©a\n", 
ù_d©a_Àn
));

2291 
ù_p£udo_hódî
 *
p_udpù_hdr
 = (ù_p£udo_hódî *)
d©a_to_checksum
;

2292 
p_udpù_hdr
->
zîos
 = 0;

2293 
p_udpù_hdr
->
ù_¥Ÿo
 = 
IP_PROTO_UDP
;

2294 
p_udpù_hdr
->
ù_∑ylﬂd
 = 
	`˝u_to_be16
(
ù_d©a_Àn
);

2296 
udp_hódî
 *
p_udp_hdr
 = (udp_hódî *Ë(
d©a_to_checksum
+12);

2298 
p_udp_hdr
->
uh_sum
 = 0;

2300 
udp_checksum
 = 
	`ù_checksum
(
d©a_to_checksum
, 
ù_d©a_Àn
 + 12);

2301 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêUDP checksum %04x\n", 
udp_checksum
));

2303 
p_udp_hdr
->
uh_sum
 = 
udp_checksum
;

2307 
	`mem˝y
(
ëh_∑ylﬂd_d©a
, 
ßved_ù_hódî
, 
hÀn
);

2313 ++
s
->
èŒy_cou¡îs
.
TxOk
;

2315 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modêå™smôtög %d byã†∑ckë\n", 
ßved_size
));

2317 
	`πl8139_å™s„r_‰ame
(
s
, 
ßved_buf„r
, 
ßved_size
, 1);

2320 i‡(!
s
->
˝lus_txbuf„r
)

2322 
s
->
˝lus_txbuf„r
 = 
ßved_buf„r
;

2323 
s
->
˝lus_txbuf„r_Àn
 = 
ßved_buf„r_Àn
;

2324 
s
->
˝lus_txbuf„r_off£t
 = 0;

2328 
	`‰ì
(
ßved_buf„r
);

2333 
	`DEBUG_PRINT
(("RTL8139: +++ C+ modeÅransmission continueÅoÇext descriptor\n"));

2337 
	}
}

2339 
	$πl8139_˝lus_å™smô
(
RTL8139Sèã
 *
s
)

2341 
txcou¡
 = 0;

2343 
	`πl8139_˝lus_å™smô_⁄e
(
s
))

2345 ++
txcou¡
;

2349 i‡(!
txcou¡
)

2351 
	`DEBUG_PRINT
(("RTL8139: C+ mode :Åransmitter queue stalled, current TxDesc = %d\n",

2352 
s
->
cuºCPlusTxDesc
));

2357 
s
->
I¡rSètus
 |
TxOK
;

2358 
	`πl8139_upd©e_úq
(
s
);

2360 
	}
}

2362 
	$πl8139_å™smô
(
RTL8139Sèã
 *
s
)

2364 
des¸ùt‹
 = 
s
->
cuºTxDesc
, 
txcou¡
 = 0;

2367 i‡(
	`πl8139_å™smô_⁄e
(
s
, 
des¸ùt‹
))

2369 ++
s
->
cuºTxDesc
;

2370 
s
->
cuºTxDesc
 %= 4;

2371 ++
txcou¡
;

2375 i‡(!
txcou¡
)

2377 
	`DEBUG_PRINT
(("RTL8139:Åønsmôã∏queuê°ÆÀd, cuºíàTxDes¯%d\n", 
s
->
cuºTxDesc
));

2379 
	}
}

2381 
	$πl8139_TxSètus_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
txRegOff£t
, uöt32_à
vÆ
)

2384 
des¸ùt‹
 = 
txRegOff£t
/4;

2388 i‡(
	`πl8139_˝_å™smôãr_íabÀd
(
s
))

2390 
	`DEBUG_PRINT
(("RTL8139C+ DTCCR wrôêoff£t=0x%x vÆ=0x%08x des¸ùt‹=%d\n", 
txRegOff£t
, 
vÆ
, 
des¸ùt‹
));

2393 
s
->
TxSètus
[
des¸ùt‹
] = 
vÆ
;

2395 i‡(
des¸ùt‹
 =0 && (
vÆ
 & 0x8))

2397 
èrgë_phys_addr_t
 
tc_addr
 = 
	`πl8139_addr64
(
s
->
TxSètus
[0] & ~0x3f, s->TxStatus[1]);

2400 
	`RTL8139TÆlyCou¡îs_physiˇl_mem‹y_wrôe
–
tc_addr
, &
s
->
èŒy_cou¡îs
);

2403 
s
->
TxSètus
[0] &= ~0x8;

2409 
	`DEBUG_PRINT
(("RTL8139: TxSètu†wrôêoff£t=0x%x vÆ=0x%08x des¸ùt‹=%d\n", 
txRegOff£t
, 
vÆ
, 
des¸ùt‹
));

2412 
vÆ
 &= ~0xff00c000;

2413 
vÆ
 = 
	`SET_MASKED
(vÆ, 0x00c00000, 
s
->
TxSètus
[
des¸ùt‹
]);

2415 
s
->
TxSètus
[
des¸ùt‹
] = 
vÆ
;

2418 
	`πl8139_å™smô
(
s
);

2419 
	}
}

2421 
uöt32_t
 
	$πl8139_TxSètus_ªad
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
txRegOff£t
)

2423 
uöt32_t
 
ªt
 = 
s
->
TxSètus
[
txRegOff£t
/4];

2425 
	`DEBUG_PRINT
(("RTL8139: TxSètu†ªad off£t=0x%x vÆ=0x%08x\n", 
txRegOff£t
, 
ªt
));

2427  
ªt
;

2428 
	}
}

2430 
uöt16_t
 
	$πl8139_TSAD_ªad
(
RTL8139Sèã
 *
s
)

2432 
uöt16_t
 
ªt
 = 0;

2436 
ªt
 = ((
s
->
TxSètus
[3] & 
TxSètOK
 )?
TSAD_TOK3
:0)

2437 |((
s
->
TxSètus
[2] & 
TxSètOK
 )?
TSAD_TOK2
:0)

2438 |((
s
->
TxSètus
[1] & 
TxSètOK
 )?
TSAD_TOK1
:0)

2439 |((
s
->
TxSètus
[0] & 
TxSètOK
 )?
TSAD_TOK0
:0)

2441 |((
s
->
TxSètus
[3] & 
TxUndîrun
)?
TSAD_TUN3
:0)

2442 |((
s
->
TxSètus
[2] & 
TxUndîrun
)?
TSAD_TUN2
:0)

2443 |((
s
->
TxSètus
[1] & 
TxUndîrun
)?
TSAD_TUN1
:0)

2444 |((
s
->
TxSètus
[0] & 
TxUndîrun
)?
TSAD_TUN0
:0)

2446 |((
s
->
TxSètus
[3] & 
TxAb‹ãd
 )?
TSAD_TABT3
:0)

2447 |((
s
->
TxSètus
[2] & 
TxAb‹ãd
 )?
TSAD_TABT2
:0)

2448 |((
s
->
TxSètus
[1] & 
TxAb‹ãd
 )?
TSAD_TABT1
:0)

2449 |((
s
->
TxSètus
[0] & 
TxAb‹ãd
 )?
TSAD_TABT0
:0)

2451 |((
s
->
TxSètus
[3] & 
TxHo°Owns
 )?
TSAD_OWN3
:0)

2452 |((
s
->
TxSètus
[2] & 
TxHo°Owns
 )?
TSAD_OWN2
:0)

2453 |((
s
->
TxSètus
[1] & 
TxHo°Owns
 )?
TSAD_OWN1
:0)

2454 |((
s
->
TxSètus
[0] & 
TxHo°Owns
 )?
TSAD_OWN0
:0) ;

2457 
	`DEBUG_PRINT
(("RTL8139: TSADÑód vÆ=0x%04x\n", 
ªt
));

2459  
ªt
;

2460 
	}
}

2462 
uöt16_t
 
	$πl8139_CSCR_ªad
(
RTL8139Sèã
 *
s
)

2464 
uöt16_t
 
ªt
 = 
s
->
CSCR
;

2466 
	`DEBUG_PRINT
(("RTL8139: CSCRÑód vÆ=0x%04x\n", 
ªt
));

2468  
ªt
;

2469 
	}
}

2471 
	$πl8139_TxAddr_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
txAddrOff£t
, uöt32_à
vÆ
)

2473 
	`DEBUG_PRINT
(("RTL8139: TxAdd∏wrôêoff£t=0x%x vÆ=0x%08x\n", 
txAddrOff£t
, 
vÆ
));

2475 
s
->
TxAddr
[
txAddrOff£t
/4] = 
	`À32_to_˝u
(
vÆ
);

2476 
	}
}

2478 
uöt32_t
 
	$πl8139_TxAddr_ªad
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
txAddrOff£t
)

2480 
uöt32_t
 
ªt
 = 
	`˝u_to_À32
(
s
->
TxAddr
[
txAddrOff£t
/4]);

2482 
	`DEBUG_PRINT
(("RTL8139: TxAdd∏ªad off£t=0x%x vÆ=0x%08x\n", 
txAddrOff£t
, 
ªt
));

2484  
ªt
;

2485 
	}
}

2487 
	$πl8139_RxBufPå_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

2489 
	`DEBUG_PRINT
(("RTL8139: RxBufPå wrôêvÆ=0x%04x\n", 
vÆ
));

2492 
s
->
RxBufPå
 = 
	`MOD2
(
vÆ
 + 0x10, s->
RxBuf„rSize
);

2494 
	`DEBUG_PRINT
((" CAPR write:Ñx bufferÜength %d head 0x%04xÑead 0x%04x\n",

2495 
s
->
RxBuf„rSize
, s->
RxBufAddr
, s->
RxBufPå
));

2496 
	}
}

2498 
uöt32_t
 
	$πl8139_RxBufPå_ªad
(
RTL8139Sèã
 *
s
)

2501 
uöt32_t
 
ªt
 = 
s
->
RxBufPå
 - 0x10;

2503 
	`DEBUG_PRINT
(("RTL8139: RxBufPåÑód vÆ=0x%04x\n", 
ªt
));

2505  
ªt
;

2506 
	}
}

2508 
uöt32_t
 
	$πl8139_RxBufAddr_ªad
(
RTL8139Sèã
 *
s
)

2511 
uöt32_t
 
ªt
 = 
s
->
RxBufAddr
;

2513 
	`DEBUG_PRINT
(("RTL8139: RxBufAdd∏ªad vÆ=0x%04x\n", 
ªt
));

2515  
ªt
;

2516 
	}
}

2518 
	$πl8139_RxBuf_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

2520 
	`DEBUG_PRINT
(("RTL8139: RxBu‡wrôêvÆ=0x%08x\n", 
vÆ
));

2522 
s
->
RxBuf
 = 
vÆ
;

2525 
	}
}

2527 
uöt32_t
 
	$πl8139_RxBuf_ªad
(
RTL8139Sèã
 *
s
)

2529 
uöt32_t
 
ªt
 = 
s
->
RxBuf
;

2531 
	`DEBUG_PRINT
(("RTL8139: RxBu‡ªad vÆ=0x%08x\n", 
ªt
));

2533  
ªt
;

2534 
	}
}

2536 
	$πl8139_I¡rMask_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

2538 
	`DEBUG_PRINT
(("RTL8139: I¡rMask wrôe(wËvÆ=0x%04x\n", 
vÆ
));

2541 
vÆ
 = 
	`SET_MASKED
(vÆ, 0x1e00, 
s
->
I¡rMask
);

2543 
s
->
I¡rMask
 = 
vÆ
;

2545 
	`πl8139_upd©e_úq
(
s
);

2546 
	}
}

2548 
uöt32_t
 
	$πl8139_I¡rMask_ªad
(
RTL8139Sèã
 *
s
)

2550 
uöt32_t
 
ªt
 = 
s
->
I¡rMask
;

2552 
	`DEBUG_PRINT
(("RTL8139: I¡rMaskÑód(wËvÆ=0x%04x\n", 
ªt
));

2554  
ªt
;

2555 
	}
}

2557 
	$πl8139_I¡rSètus_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

2559 
	`DEBUG_PRINT
(("RTL8139: I¡rSètu†wrôe(wËvÆ=0x%04x\n", 
vÆ
));

2568 
uöt16_t
 
√wSètus
 = 
s
->
I¡rSètus
 & ~
vÆ
;

2571 
√wSètus
 = 
	`SET_MASKED
“ewSètus, 0x1e00, 
s
->
I¡rSètus
);

2574 
s
->
I¡rSètus
 = 0;

2575 
	`πl8139_upd©e_úq
(
s
);

2577 
s
->
I¡rSètus
 = 
√wSètus
;

2578 
	`πl8139_upd©e_úq
(
s
);

2580 
	}
}

2582 
uöt32_t
 
	$πl8139_I¡rSètus_ªad
(
RTL8139Sèã
 *
s
)

2584 
uöt32_t
 
ªt
 = 
s
->
I¡rSètus
;

2586 
	`DEBUG_PRINT
(("RTL8139: I¡rSètu†ªad(wËvÆ=0x%04x\n", 
ªt
));

2591 
s
->
I¡rSètus
 = 0;

2593 
	`πl8139_upd©e_úq
(
s
);

2597  
ªt
;

2598 
	}
}

2600 
	$πl8139_Mu…iI¡r_wrôe
(
RTL8139Sèã
 *
s
, 
uöt32_t
 
vÆ
)

2602 
	`DEBUG_PRINT
(("RTL8139: Mu…iI¡∏wrôe(wËvÆ=0x%04x\n", 
vÆ
));

2605 
vÆ
 = 
	`SET_MASKED
(vÆ, 0xf000, 
s
->
Mu…iI¡r
);

2607 
s
->
Mu…iI¡r
 = 
vÆ
;

2608 
	}
}

2610 
uöt32_t
 
	$πl8139_Mu…iI¡r_ªad
(
RTL8139Sèã
 *
s
)

2612 
uöt32_t
 
ªt
 = 
s
->
Mu…iI¡r
;

2614 
	`DEBUG_PRINT
(("RTL8139: Mu…iI¡∏ªad(wËvÆ=0x%04x\n", 
ªt
));

2616  
ªt
;

2617 
	}
}

2619 
	$πl8139_io_wrôeb
(*
›aque
, 
uöt8_t
 
addr
, 
uöt32_t
 
vÆ
)

2621 
RTL8139Sèã
 *
s
 = 
›aque
;

2623 
addr
 &= 0xff;

2625 
addr
)

2627 
MAC0
 ... MAC0+5:

2628 
s
->
phys
[
addr
 - 
MAC0
] = 
vÆ
;

2630 
MAC0
+6 ... MAC0+7:

2633 
MAR0
 ... MAR0+7:

2634 
s
->
mu…
[
addr
 - 
MAR0
] = 
vÆ
;

2636 
ChùCmd
:

2637 
	`πl8139_ChùCmd_wrôe
(
s
, 
vÆ
);

2639 
Cfg9346
:

2640 
	`πl8139_Cfg9346_wrôe
(
s
, 
vÆ
);

2642 
TxC⁄fig
:

2643 
	`πl8139_TxC⁄fig_wrôeb
(
s
, 
vÆ
);

2645 
C⁄fig0
:

2646 
	`πl8139_C⁄fig0_wrôe
(
s
, 
vÆ
);

2648 
C⁄fig1
:

2649 
	`πl8139_C⁄fig1_wrôe
(
s
, 
vÆ
);

2651 
C⁄fig3
:

2652 
	`πl8139_C⁄fig3_wrôe
(
s
, 
vÆ
);

2654 
C⁄fig4
:

2655 
	`πl8139_C⁄fig4_wrôe
(
s
, 
vÆ
);

2657 
C⁄fig5
:

2658 
	`πl8139_C⁄fig5_wrôe
(
s
, 
vÆ
);

2660 
MedüSètus
:

2662 
	`DEBUG_PRINT
(("RTL8139:ÇŸ im∂emíãd wrôe(bËtÿMedüSètu†vÆ=0x%02x\n", 
vÆ
));

2665 
H…Clk
:

2666 
	`DEBUG_PRINT
(("RTL8139: H…Clk wrôêvÆ=0x%08x\n", 
vÆ
));

2667 i‡(
vÆ
 == 'R')

2669 
s
->
˛ock_íabÀd
 = 1;

2671 i‡(
vÆ
 == 'H')

2673 
s
->
˛ock_íabÀd
 = 0;

2677 
TxThªsh
:

2678 
	`DEBUG_PRINT
(("RTL8139C+ TxThªsh wrôe(bËvÆ=0x%02x\n", 
vÆ
));

2679 
s
->
TxThªsh
 = 
vÆ
;

2682 
TxPﬁl
:

2683 
	`DEBUG_PRINT
(("RTL8139C+ TxPﬁ»wrôe(bËvÆ=0x%02x\n", 
vÆ
));

2684 i‡(
vÆ
 & (1 << 7))

2686 
	`DEBUG_PRINT
(("RTL8139C+ TxPoll highÖriorityÅransmission (not implemented)\n"));

2689 i‡(
vÆ
 & (1 << 6))

2691 
	`DEBUG_PRINT
(("RTL8139C+ TxPollÇormalÖriorityÅransmission\n"));

2692 
	`πl8139_˝lus_å™smô
(
s
);

2698 
	`DEBUG_PRINT
(("RTL8139:ÇŸ im∂emíãd wrôe(bËaddr=0x%x vÆ=0x%02x\n", 
addr
, 
vÆ
));

2701 
	}
}

2703 
	$πl8139_io_wrôew
(*
›aque
, 
uöt8_t
 
addr
, 
uöt32_t
 
vÆ
)

2705 
RTL8139Sèã
 *
s
 = 
›aque
;

2707 
addr
 &= 0xfe;

2709 
addr
)

2711 
I¡rMask
:

2712 
	`πl8139_I¡rMask_wrôe
(
s
, 
vÆ
);

2715 
I¡rSètus
:

2716 
	`πl8139_I¡rSètus_wrôe
(
s
, 
vÆ
);

2719 
Mu…iI¡r
:

2720 
	`πl8139_Mu…iI¡r_wrôe
(
s
, 
vÆ
);

2723 
RxBufPå
:

2724 
	`πl8139_RxBufPå_wrôe
(
s
, 
vÆ
);

2727 
BasicModeCål
:

2728 
	`πl8139_BasicModeCål_wrôe
(
s
, 
vÆ
);

2730 
BasicModeSètus
:

2731 
	`πl8139_BasicModeSètus_wrôe
(
s
, 
vÆ
);

2733 
NWayAdvît
:

2734 
	`DEBUG_PRINT
(("RTL8139: NWayAdvîàwrôe(wËvÆ=0x%04x\n", 
vÆ
));

2735 
s
->
NWayAdvît
 = 
vÆ
;

2737 
NWayLPAR
:

2738 
	`DEBUG_PRINT
(("RTL8139: f‹biddí NWayLPAR wrôe(wËvÆ=0x%04x\n", 
vÆ
));

2740 
NWayEx∑nsi⁄
:

2741 
	`DEBUG_PRINT
(("RTL8139: NWayEx∑nsi⁄ wrôe(wËvÆ=0x%04x\n", 
vÆ
));

2742 
s
->
NWayEx∑nsi⁄
 = 
vÆ
;

2745 
CpCmd
:

2746 
	`πl8139_CpCmd_wrôe
(
s
, 
vÆ
);

2749 
I¡rMôig©e
:

2750 
	`πl8139_I¡rMôig©e_wrôe
(
s
, 
vÆ
);

2754 
	`DEBUG_PRINT
(("RTL8139: i›‹àwrôe(wËaddr=0x%x vÆ=0x%04x vü wrôe(b)\n", 
addr
, 
vÆ
));

2756 #ifde‡
TARGET_WORDS_BIGENDIAN


2757 
	`πl8139_io_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 8) & 0xff);

2758 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 + 1, 
vÆ
 & 0xff);

2760 
	`πl8139_io_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

2761 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

2765 
	}
}

2767 
	$πl8139_io_wrôñ
(*
›aque
, 
uöt8_t
 
addr
, 
uöt32_t
 
vÆ
)

2769 
RTL8139Sèã
 *
s
 = 
›aque
;

2771 
addr
 &= 0xfc;

2773 
addr
)

2775 
RxMis£d
:

2776 
	`DEBUG_PRINT
(("RTL8139: RxMissed clearing on write\n"));

2777 
s
->
RxMis£d
 = 0;

2780 
TxC⁄fig
:

2781 
	`πl8139_TxC⁄fig_wrôe
(
s
, 
vÆ
);

2784 
RxC⁄fig
:

2785 
	`πl8139_RxC⁄fig_wrôe
(
s
, 
vÆ
);

2788 
TxSètus0
 ... TxStatus0+4*4-1:

2789 
	`πl8139_TxSètus_wrôe
(
s
, 
addr
-
TxSètus0
, 
vÆ
);

2792 
TxAddr0
 ... TxAddr0+4*4-1:

2793 
	`πl8139_TxAddr_wrôe
(
s
, 
addr
-
TxAddr0
, 
vÆ
);

2796 
RxBuf
:

2797 
	`πl8139_RxBuf_wrôe
(
s
, 
vÆ
);

2800 
RxRögAddrLO
:

2801 
	`DEBUG_PRINT
(("RTL8139: C+ RxRögÜow bô†wrôêvÆ=0x%08x\n", 
vÆ
));

2802 
s
->
RxRögAddrLO
 = 
vÆ
;

2805 
RxRögAddrHI
:

2806 
	`DEBUG_PRINT
(("RTL8139: C+ RxRög high bô†wrôêvÆ=0x%08x\n", 
vÆ
));

2807 
s
->
RxRögAddrHI
 = 
vÆ
;

2810 
Timî
:

2811 
	`DEBUG_PRINT
(("RTL8139: TCTR TimerÑeset on write\n"));

2812 
s
->
TCTR
 = 0;

2813 
s
->
TCTR_ba£
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

2816 
FœshReg
:

2817 
	`DEBUG_PRINT
(("RTL8139: FœshReg TimîI¡ wrôêvÆ=0x%08x\n", 
vÆ
));

2818 
s
->
TimîI¡
 = 
vÆ
;

2822 
	`DEBUG_PRINT
(("RTL8139: i›‹àwrôe÷Ëaddr=0x%x vÆ=0x%08x vü wrôe(b)\n", 
addr
, 
vÆ
));

2823 #ifde‡
TARGET_WORDS_BIGENDIAN


2824 
	`πl8139_io_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 24) & 0xff);

2825 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 16) & 0xff);

2826 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 8) & 0xff);

2827 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 + 3, 
vÆ
 & 0xff);

2829 
	`πl8139_io_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

2830 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

2831 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 16) & 0xff);

2832 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 + 3, (
vÆ
 >> 24) & 0xff);

2836 
	}
}

2838 
uöt32_t
 
	$πl8139_io_ªadb
(*
›aque
, 
uöt8_t
 
addr
)

2840 
RTL8139Sèã
 *
s
 = 
›aque
;

2841 
ªt
;

2843 
addr
 &= 0xff;

2845 
addr
)

2847 
MAC0
 ... MAC0+5:

2848 
ªt
 = 
s
->
phys
[
addr
 - 
MAC0
];

2850 
MAC0
+6 ... MAC0+7:

2851 
ªt
 = 0;

2853 
MAR0
 ... MAR0+7:

2854 
ªt
 = 
s
->
mu…
[
addr
 - 
MAR0
];

2856 
ChùCmd
:

2857 
ªt
 = 
	`πl8139_ChùCmd_ªad
(
s
);

2859 
Cfg9346
:

2860 
ªt
 = 
	`πl8139_Cfg9346_ªad
(
s
);

2862 
C⁄fig0
:

2863 
ªt
 = 
	`πl8139_C⁄fig0_ªad
(
s
);

2865 
C⁄fig1
:

2866 
ªt
 = 
	`πl8139_C⁄fig1_ªad
(
s
);

2868 
C⁄fig3
:

2869 
ªt
 = 
	`πl8139_C⁄fig3_ªad
(
s
);

2871 
C⁄fig4
:

2872 
ªt
 = 
	`πl8139_C⁄fig4_ªad
(
s
);

2874 
C⁄fig5
:

2875 
ªt
 = 
	`πl8139_C⁄fig5_ªad
(
s
);

2878 
MedüSètus
:

2879 
ªt
 = 0xd0;

2880 
	`DEBUG_PRINT
(("RTL8139: MedüSètu†ªad 0x%x\n", 
ªt
));

2883 
H…Clk
:

2884 
ªt
 = 
s
->
˛ock_íabÀd
;

2885 
	`DEBUG_PRINT
(("RTL8139: H…ClkÑód 0x%x\n", 
ªt
));

2888 
PCIRevisi⁄ID
:

2889 
ªt
 = 
RTL8139_PCI_REVID
;

2890 
	`DEBUG_PRINT
(("RTL8139: PCI Revisi⁄ IDÑód 0x%x\n", 
ªt
));

2893 
TxThªsh
:

2894 
ªt
 = 
s
->
TxThªsh
;

2895 
	`DEBUG_PRINT
(("RTL8139C+ TxThªshÑód(bËvÆ=0x%02x\n", 
ªt
));

2899 
ªt
 = 
s
->
TxC⁄fig
 >> 24;

2900 
	`DEBUG_PRINT
(("RTL8139C TxC⁄figáà0x43Ñód(bËvÆ=0x%02x\n", 
ªt
));

2904 
	`DEBUG_PRINT
(("RTL8139:ÇŸ im∂emíãdÑód(bËaddr=0x%x\n", 
addr
));

2905 
ªt
 = 0;

2909  
ªt
;

2910 
	}
}

2912 
uöt32_t
 
	$πl8139_io_ªadw
(*
›aque
, 
uöt8_t
 
addr
)

2914 
RTL8139Sèã
 *
s
 = 
›aque
;

2915 
uöt32_t
 
ªt
;

2917 
addr
 &= 0xfe;

2919 
addr
)

2921 
I¡rMask
:

2922 
ªt
 = 
	`πl8139_I¡rMask_ªad
(
s
);

2925 
I¡rSètus
:

2926 
ªt
 = 
	`πl8139_I¡rSètus_ªad
(
s
);

2929 
Mu…iI¡r
:

2930 
ªt
 = 
	`πl8139_Mu…iI¡r_ªad
(
s
);

2933 
RxBufPå
:

2934 
ªt
 = 
	`πl8139_RxBufPå_ªad
(
s
);

2937 
RxBufAddr
:

2938 
ªt
 = 
	`πl8139_RxBufAddr_ªad
(
s
);

2941 
BasicModeCål
:

2942 
ªt
 = 
	`πl8139_BasicModeCål_ªad
(
s
);

2944 
BasicModeSètus
:

2945 
ªt
 = 
	`πl8139_BasicModeSètus_ªad
(
s
);

2947 
NWayAdvît
:

2948 
ªt
 = 
s
->
NWayAdvît
;

2949 
	`DEBUG_PRINT
(("RTL8139: NWayAdvîàªad(wËvÆ=0x%04x\n", 
ªt
));

2951 
NWayLPAR
:

2952 
ªt
 = 
s
->
NWayLPAR
;

2953 
	`DEBUG_PRINT
(("RTL8139: NWayLPARÑód(wËvÆ=0x%04x\n", 
ªt
));

2955 
NWayEx∑nsi⁄
:

2956 
ªt
 = 
s
->
NWayEx∑nsi⁄
;

2957 
	`DEBUG_PRINT
(("RTL8139: NWayEx∑nsi⁄Ñód(wËvÆ=0x%04x\n", 
ªt
));

2960 
CpCmd
:

2961 
ªt
 = 
	`πl8139_CpCmd_ªad
(
s
);

2964 
I¡rMôig©e
:

2965 
ªt
 = 
	`πl8139_I¡rMôig©e_ªad
(
s
);

2968 
TxSumm¨y
:

2969 
ªt
 = 
	`πl8139_TSAD_ªad
(
s
);

2972 
CSCR
:

2973 
ªt
 = 
	`πl8139_CSCR_ªad
(
s
);

2977 
	`DEBUG_PRINT
(("RTL8139: i›‹àªad(wËaddr=0x%x vüÑód(b)\n", 
addr
));

2979 #ifde‡
TARGET_WORDS_BIGENDIAN


2980 
ªt
 = 
	`πl8139_io_ªadb
(
›aque
, 
addr
) << 8;

2981 
ªt
 |
	`πl8139_io_ªadb
(
›aque
, 
addr
 + 1);

2983 
ªt
 = 
	`πl8139_io_ªadb
(
›aque
, 
addr
);

2984 
ªt
 |
	`πl8139_io_ªadb
(
›aque
, 
addr
 + 1) << 8;

2987 
	`DEBUG_PRINT
(("RTL8139: i›‹àªad(wËaddr=0x%x vÆ=0x%04x\n", 
addr
, 
ªt
));

2991  
ªt
;

2992 
	}
}

2994 
uöt32_t
 
	$πl8139_io_ªadl
(*
›aque
, 
uöt8_t
 
addr
)

2996 
RTL8139Sèã
 *
s
 = 
›aque
;

2997 
uöt32_t
 
ªt
;

2999 
addr
 &= 0xfc;

3001 
addr
)

3003 
RxMis£d
:

3004 
ªt
 = 
s
->
RxMis£d
;

3006 
	`DEBUG_PRINT
(("RTL8139: RxMis£dÑód vÆ=0x%08x\n", 
ªt
));

3009 
TxC⁄fig
:

3010 
ªt
 = 
	`πl8139_TxC⁄fig_ªad
(
s
);

3013 
RxC⁄fig
:

3014 
ªt
 = 
	`πl8139_RxC⁄fig_ªad
(
s
);

3017 
TxSètus0
 ... TxStatus0+4*4-1:

3018 
ªt
 = 
	`πl8139_TxSètus_ªad
(
s
, 
addr
-
TxSètus0
);

3021 
TxAddr0
 ... TxAddr0+4*4-1:

3022 
ªt
 = 
	`πl8139_TxAddr_ªad
(
s
, 
addr
-
TxAddr0
);

3025 
RxBuf
:

3026 
ªt
 = 
	`πl8139_RxBuf_ªad
(
s
);

3029 
RxRögAddrLO
:

3030 
ªt
 = 
s
->
RxRögAddrLO
;

3031 
	`DEBUG_PRINT
(("RTL8139: C+ RxRögÜow bô†ªad vÆ=0x%08x\n", 
ªt
));

3034 
RxRögAddrHI
:

3035 
ªt
 = 
s
->
RxRögAddrHI
;

3036 
	`DEBUG_PRINT
(("RTL8139: C+ RxRög high bô†ªad vÆ=0x%08x\n", 
ªt
));

3039 
Timî
:

3040 
ªt
 = 
s
->
TCTR
;

3041 
	`DEBUG_PRINT
(("RTL8139: TCTR TimîÑód vÆ=0x%08x\n", 
ªt
));

3044 
FœshReg
:

3045 
ªt
 = 
s
->
TimîI¡
;

3046 
	`DEBUG_PRINT
(("RTL8139: FœshReg TimîI¡Ñód vÆ=0x%08x\n", 
ªt
));

3050 
	`DEBUG_PRINT
(("RTL8139: i›‹àªad÷Ëaddr=0x%x vüÑód(b)\n", 
addr
));

3052 #ifde‡
TARGET_WORDS_BIGENDIAN


3053 
ªt
 = 
	`πl8139_io_ªadb
(
›aque
, 
addr
) << 24;

3054 
ªt
 |
	`πl8139_io_ªadb
(
›aque
, 
addr
 + 1) << 16;

3055 
ªt
 |
	`πl8139_io_ªadb
(
›aque
, 
addr
 + 2) << 8;

3056 
ªt
 |
	`πl8139_io_ªadb
(
›aque
, 
addr
 + 3);

3058 
ªt
 = 
	`πl8139_io_ªadb
(
›aque
, 
addr
);

3059 
ªt
 |
	`πl8139_io_ªadb
(
›aque
, 
addr
 + 1) << 8;

3060 
ªt
 |
	`πl8139_io_ªadb
(
›aque
, 
addr
 + 2) << 16;

3061 
ªt
 |
	`πl8139_io_ªadb
(
›aque
, 
addr
 + 3) << 24;

3064 
	`DEBUG_PRINT
(("RTL8139:Ñód÷Ëaddr=0x%x vÆ=%08x\n", 
addr
, 
ªt
));

3068  
ªt
;

3069 
	}
}

3073 
	$πl8139_i›‹t_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

3075 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 & 0xFF, 
vÆ
);

3076 
	}
}

3078 
	$πl8139_i›‹t_wrôew
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

3080 
	`πl8139_io_wrôew
(
›aque
, 
addr
 & 0xFF, 
vÆ
);

3081 
	}
}

3083 
	$πl8139_i›‹t_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

3085 
	`πl8139_io_wrôñ
(
›aque
, 
addr
 & 0xFF, 
vÆ
);

3086 
	}
}

3088 
uöt32_t
 
	$πl8139_i›‹t_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

3090  
	`πl8139_io_ªadb
(
›aque
, 
addr
 & 0xFF);

3091 
	}
}

3093 
uöt32_t
 
	$πl8139_i›‹t_ªadw
(*
›aque
, 
uöt32_t
 
addr
)

3095  
	`πl8139_io_ªadw
(
›aque
, 
addr
 & 0xFF);

3096 
	}
}

3098 
uöt32_t
 
	$πl8139_i›‹t_ªadl
(*
›aque
, 
uöt32_t
 
addr
)

3100  
	`πl8139_io_ªadl
(
›aque
, 
addr
 & 0xFF);

3101 
	}
}

3105 
	$πl8139_mmio_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

3107 
	`πl8139_io_wrôeb
(
›aque
, 
addr
 & 0xFF, 
vÆ
);

3108 
	}
}

3110 
	$πl8139_mmio_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

3112 
	`πl8139_io_wrôew
(
›aque
, 
addr
 & 0xFF, 
vÆ
);

3113 
	}
}

3115 
	$πl8139_mmio_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

3117 
	`πl8139_io_wrôñ
(
›aque
, 
addr
 & 0xFF, 
vÆ
);

3118 
	}
}

3120 
uöt32_t
 
	$πl8139_mmio_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

3122  
	`πl8139_io_ªadb
(
›aque
, 
addr
 & 0xFF);

3123 
	}
}

3125 
uöt32_t
 
	$πl8139_mmio_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

3127  
	`πl8139_io_ªadw
(
›aque
, 
addr
 & 0xFF);

3128 
	}
}

3130 
uöt32_t
 
	$πl8139_mmio_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

3132  
	`πl8139_io_ªadl
(
›aque
, 
addr
 & 0xFF);

3133 
	}
}

3137 
	$πl8139_ßve
(
QEMUFûe
* 
f
,* 
›aque
)

3139 
RTL8139Sèã
* 
s
=(RTL8139Sèã*)
›aque
;

3140 
i
;

3142 
	`pci_devi˚_ßve
(
s
->
pci_dev
, 
f
);

3144 
	`qemu_put_buf„r
(
f
, 
s
->
phys
, 6);

3145 
	`qemu_put_buf„r
(
f
, 
s
->
mu…
, 8);

3147 
i
=0; i<4; ++i)

3149 
	`qemu_put_be32s
(
f
, &
s
->
TxSètus
[
i
]);

3151 
i
=0; i<4; ++i)

3153 
	`qemu_put_be32s
(
f
, &
s
->
TxAddr
[
i
]);

3156 
	`qemu_put_be32s
(
f
, &
s
->
RxBuf
);

3157 
	`qemu_put_be32s
(
f
, &
s
->
RxBuf„rSize
);

3158 
	`qemu_put_be32s
(
f
, &
s
->
RxBufPå
);

3159 
	`qemu_put_be32s
(
f
, &
s
->
RxBufAddr
);

3161 
	`qemu_put_be16s
(
f
, &
s
->
I¡rSètus
);

3162 
	`qemu_put_be16s
(
f
, &
s
->
I¡rMask
);

3164 
	`qemu_put_be32s
(
f
, &
s
->
TxC⁄fig
);

3165 
	`qemu_put_be32s
(
f
, &
s
->
RxC⁄fig
);

3166 
	`qemu_put_be32s
(
f
, &
s
->
RxMis£d
);

3167 
	`qemu_put_be16s
(
f
, &
s
->
CSCR
);

3169 
	`qemu_put_8s
(
f
, &
s
->
Cfg9346
);

3170 
	`qemu_put_8s
(
f
, &
s
->
C⁄fig0
);

3171 
	`qemu_put_8s
(
f
, &
s
->
C⁄fig1
);

3172 
	`qemu_put_8s
(
f
, &
s
->
C⁄fig3
);

3173 
	`qemu_put_8s
(
f
, &
s
->
C⁄fig4
);

3174 
	`qemu_put_8s
(
f
, &
s
->
C⁄fig5
);

3176 
	`qemu_put_8s
(
f
, &
s
->
˛ock_íabÀd
);

3177 
	`qemu_put_8s
(
f
, &
s
->
bChùCmdSèã
);

3179 
	`qemu_put_be16s
(
f
, &
s
->
Mu…iI¡r
);

3181 
	`qemu_put_be16s
(
f
, &
s
->
BasicModeCål
);

3182 
	`qemu_put_be16s
(
f
, &
s
->
BasicModeSètus
);

3183 
	`qemu_put_be16s
(
f
, &
s
->
NWayAdvît
);

3184 
	`qemu_put_be16s
(
f
, &
s
->
NWayLPAR
);

3185 
	`qemu_put_be16s
(
f
, &
s
->
NWayEx∑nsi⁄
);

3187 
	`qemu_put_be16s
(
f
, &
s
->
CpCmd
);

3188 
	`qemu_put_8s
(
f
, &
s
->
TxThªsh
);

3190 
	`qemu_put_be32s
(
f
, &
s
->
úq
);

3191 
	`qemu_put_buf„r
(
f
, 
s
->
maˇddr
, 6);

3192 
	`qemu_put_be32s
(
f
, &
s
->
πl8139_mmio_io_addr
);

3194 
	`qemu_put_be32s
(
f
, &
s
->
cuºTxDesc
);

3195 
	`qemu_put_be32s
(
f
, &
s
->
cuºCPlusRxDesc
);

3196 
	`qemu_put_be32s
(
f
, &
s
->
cuºCPlusTxDesc
);

3197 
	`qemu_put_be32s
(
f
, &
s
->
RxRögAddrLO
);

3198 
	`qemu_put_be32s
(
f
, &
s
->
RxRögAddrHI
);

3200 
i
=0; i<
EEPROM_9346_SIZE
; ++i)

3202 
	`qemu_put_be16s
(
f
, &
s
->
ì¥om
.
c⁄ã¡s
[
i
]);

3204 
	`qemu_put_be32s
(
f
, &
s
->
ì¥om
.
mode
);

3205 
	`qemu_put_be32s
(
f
, &
s
->
ì¥om
.
tick
);

3206 
	`qemu_put_8s
(
f
, &
s
->
ì¥om
.
addªss
);

3207 
	`qemu_put_be16s
(
f
, &
s
->
ì¥om
.
öput
);

3208 
	`qemu_put_be16s
(
f
, &
s
->
ì¥om
.
ouçut
);

3210 
	`qemu_put_8s
(
f
, &
s
->
ì¥om
.
ìcs
);

3211 
	`qemu_put_8s
(
f
, &
s
->
ì¥om
.
ìsk
);

3212 
	`qemu_put_8s
(
f
, &
s
->
ì¥om
.
ìdi
);

3213 
	`qemu_put_8s
(
f
, &
s
->
ì¥om
.
ìdo
);

3215 
	`qemu_put_be32s
(
f
, &
s
->
TCTR
);

3216 
	`qemu_put_be32s
(
f
, &
s
->
TimîI¡
);

3217 
	`qemu_put_be64s
(
f
, &
s
->
TCTR_ba£
);

3219 
	`RTL8139TÆlyCou¡îs_ßve
(
f
, &
s
->
èŒy_cou¡îs
);

3220 
	}
}

3222 
	$πl8139_lﬂd
(
QEMUFûe
* 
f
,* 
›aque
,
vîsi⁄_id
)

3224 
RTL8139Sèã
* 
s
=(RTL8139Sèã*)
›aque
;

3225 
i
, 
ªt
;

3228 i‡(
vîsi⁄_id
 > 3)

3229  -
EINVAL
;

3231 i‡(
vîsi⁄_id
 >= 3) {

3232 
ªt
 = 
	`pci_devi˚_lﬂd
(
s
->
pci_dev
, 
f
);

3233 i‡(
ªt
 < 0)

3234  
ªt
;

3238 
	`qemu_gë_buf„r
(
f
, 
s
->
phys
, 6);

3239 
	`qemu_gë_buf„r
(
f
, 
s
->
mu…
, 8);

3241 
i
=0; i<4; ++i)

3243 
	`qemu_gë_be32s
(
f
, &
s
->
TxSètus
[
i
]);

3245 
i
=0; i<4; ++i)

3247 
	`qemu_gë_be32s
(
f
, &
s
->
TxAddr
[
i
]);

3250 
	`qemu_gë_be32s
(
f
, &
s
->
RxBuf
);

3251 
	`qemu_gë_be32s
(
f
, &
s
->
RxBuf„rSize
);

3252 
	`qemu_gë_be32s
(
f
, &
s
->
RxBufPå
);

3253 
	`qemu_gë_be32s
(
f
, &
s
->
RxBufAddr
);

3255 
	`qemu_gë_be16s
(
f
, &
s
->
I¡rSètus
);

3256 
	`qemu_gë_be16s
(
f
, &
s
->
I¡rMask
);

3258 
	`qemu_gë_be32s
(
f
, &
s
->
TxC⁄fig
);

3259 
	`qemu_gë_be32s
(
f
, &
s
->
RxC⁄fig
);

3260 
	`qemu_gë_be32s
(
f
, &
s
->
RxMis£d
);

3261 
	`qemu_gë_be16s
(
f
, &
s
->
CSCR
);

3263 
	`qemu_gë_8s
(
f
, &
s
->
Cfg9346
);

3264 
	`qemu_gë_8s
(
f
, &
s
->
C⁄fig0
);

3265 
	`qemu_gë_8s
(
f
, &
s
->
C⁄fig1
);

3266 
	`qemu_gë_8s
(
f
, &
s
->
C⁄fig3
);

3267 
	`qemu_gë_8s
(
f
, &
s
->
C⁄fig4
);

3268 
	`qemu_gë_8s
(
f
, &
s
->
C⁄fig5
);

3270 
	`qemu_gë_8s
(
f
, &
s
->
˛ock_íabÀd
);

3271 
	`qemu_gë_8s
(
f
, &
s
->
bChùCmdSèã
);

3273 
	`qemu_gë_be16s
(
f
, &
s
->
Mu…iI¡r
);

3275 
	`qemu_gë_be16s
(
f
, &
s
->
BasicModeCål
);

3276 
	`qemu_gë_be16s
(
f
, &
s
->
BasicModeSètus
);

3277 
	`qemu_gë_be16s
(
f
, &
s
->
NWayAdvît
);

3278 
	`qemu_gë_be16s
(
f
, &
s
->
NWayLPAR
);

3279 
	`qemu_gë_be16s
(
f
, &
s
->
NWayEx∑nsi⁄
);

3281 
	`qemu_gë_be16s
(
f
, &
s
->
CpCmd
);

3282 
	`qemu_gë_8s
(
f
, &
s
->
TxThªsh
);

3284 
	`qemu_gë_be32s
(
f
, &
s
->
úq
);

3285 
	`qemu_gë_buf„r
(
f
, 
s
->
maˇddr
, 6);

3286 
	`qemu_gë_be32s
(
f
, &
s
->
πl8139_mmio_io_addr
);

3288 
	`qemu_gë_be32s
(
f
, &
s
->
cuºTxDesc
);

3289 
	`qemu_gë_be32s
(
f
, &
s
->
cuºCPlusRxDesc
);

3290 
	`qemu_gë_be32s
(
f
, &
s
->
cuºCPlusTxDesc
);

3291 
	`qemu_gë_be32s
(
f
, &
s
->
RxRögAddrLO
);

3292 
	`qemu_gë_be32s
(
f
, &
s
->
RxRögAddrHI
);

3294 
i
=0; i<
EEPROM_9346_SIZE
; ++i)

3296 
	`qemu_gë_be16s
(
f
, &
s
->
ì¥om
.
c⁄ã¡s
[
i
]);

3298 
	`qemu_gë_be32s
(
f
, &
s
->
ì¥om
.
mode
);

3299 
	`qemu_gë_be32s
(
f
, &
s
->
ì¥om
.
tick
);

3300 
	`qemu_gë_8s
(
f
, &
s
->
ì¥om
.
addªss
);

3301 
	`qemu_gë_be16s
(
f
, &
s
->
ì¥om
.
öput
);

3302 
	`qemu_gë_be16s
(
f
, &
s
->
ì¥om
.
ouçut
);

3304 
	`qemu_gë_8s
(
f
, &
s
->
ì¥om
.
ìcs
);

3305 
	`qemu_gë_8s
(
f
, &
s
->
ì¥om
.
ìsk
);

3306 
	`qemu_gë_8s
(
f
, &
s
->
ì¥om
.
ìdi
);

3307 
	`qemu_gë_8s
(
f
, &
s
->
ì¥om
.
ìdo
);

3310 i‡(
vîsi⁄_id
 >= 2)

3312 
	`qemu_gë_be32s
(
f
, &
s
->
TCTR
);

3313 
	`qemu_gë_be32s
(
f
, &
s
->
TimîI¡
);

3314 
	`qemu_gë_be64s
(
f
, &
s
->
TCTR_ba£
);

3316 
	`RTL8139TÆlyCou¡îs_lﬂd
(
f
, &
s
->
èŒy_cou¡îs
);

3321 
s
->
TCTR
 = 0;

3322 
s
->
TimîI¡
 = 0;

3323 
s
->
TCTR_ba£
 = 0;

3325 
	`RTL8139TÆlyCou¡îs_˛ór
(&
s
->
èŒy_cou¡îs
);

3329 
	}
}

3334 
	sPCIRTL8139Sèã
 {

3335 
PCIDevi˚
 
	mdev
;

3336 
RTL8139Sèã
 
	mπl8139
;

3337 } 
	tPCIRTL8139Sèã
;

3339 
	$πl8139_mmio_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

3340 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

3342 
PCIRTL8139Sèã
 *
d
 = (PCIRTL8139Sèã *)
pci_dev
;

3343 
RTL8139Sèã
 *
s
 = &
d
->
πl8139
;

3345 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0, 0x100, 
s
->
πl8139_mmio_io_addr
);

3346 
	}
}

3348 
	$πl8139_i›‹t_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

3349 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

3351 
PCIRTL8139Sèã
 *
d
 = (PCIRTL8139Sèã *)
pci_dev
;

3352 
RTL8139Sèã
 *
s
 = &
d
->
πl8139
;

3354 
	`ªgi°î_i›‹t_wrôe
(
addr
, 0x100, 1, 
πl8139_i›‹t_wrôeb
, 
s
);

3355 
	`ªgi°î_i›‹t_ªad
–
addr
, 0x100, 1, 
πl8139_i›‹t_ªadb
, 
s
);

3357 
	`ªgi°î_i›‹t_wrôe
(
addr
, 0x100, 2, 
πl8139_i›‹t_wrôew
, 
s
);

3358 
	`ªgi°î_i›‹t_ªad
–
addr
, 0x100, 2, 
πl8139_i›‹t_ªadw
, 
s
);

3360 
	`ªgi°î_i›‹t_wrôe
(
addr
, 0x100, 4, 
πl8139_i›‹t_wrôñ
, 
s
);

3361 
	`ªgi°î_i›‹t_ªad
–
addr
, 0x100, 4, 
πl8139_i›‹t_ªadl
, 
s
);

3362 
	}
}

3364 
CPURódMem‹yFunc
 *
	gπl8139_mmio_ªad
[3] = {

3365 
πl8139_mmio_ªadb
,

3366 
πl8139_mmio_ªadw
,

3367 
πl8139_mmio_ªadl
,

3370 
CPUWrôeMem‹yFunc
 *
	gπl8139_mmio_wrôe
[3] = {

3371 
πl8139_mmio_wrôeb
,

3372 
πl8139_mmio_wrôew
,

3373 
πl8139_mmio_wrôñ
,

3376 
ölöe
 
öt64_t
 
	$πl8139_gë_√xt_t˘r_time
(
RTL8139Sèã
 *
s
, 
öt64_t
 
cuºít_time
)

3378 
öt64_t
 
√xt_time
 = 
cuºít_time
 +

3379 
	`muldiv64
(1, 
ticks_≥r_£c
, 
PCI_FREQUENCY
);

3380 i‡(
√xt_time
 <
cuºít_time
)

3381 
√xt_time
 = 
cuºít_time
 + 1;

3382  
√xt_time
;

3383 
	}
}

3385 #i‡
RTL8139_ONBOARD_TIMER


3386 
	$πl8139_timî
(*
›aque
)

3388 
RTL8139Sèã
 *
s
 = 
›aque
;

3390 
is_timeout
 = 0;

3392 
öt64_t
 
cuº_time
;

3393 
uöt32_t
 
cuº_tick
;

3395 i‡(!
s
->
˛ock_íabÀd
)

3397 
	`DEBUG_PRINT
(("RTL8139: >>>Åimer: clock isÇotÑunning\n"));

3401 
cuº_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

3403 
cuº_tick
 = 
	`muldiv64
(
cuº_time
 - 
s
->
TCTR_ba£
, 
PCI_FREQUENCY
, 
ticks_≥r_£c
);

3405 i‡(
s
->
TimîI¡
 && 
cuº_tick
 >= s->TimerInt)

3407 i‡(
s
->
TCTR
 < s->
TimîI¡
 || 
cuº_tick
 < s->TCTR)

3409 
is_timeout
 = 1;

3413 
s
->
TCTR
 = 
cuº_tick
;

3417 i‡(
is_timeout
)

3419 
	`DEBUG_PRINT
(("RTL8139: >>>Åimî:Åimeouàtick=%08u\n", 
s
->
TCTR
));

3420 
s
->
I¡rSètus
 |
PCSTimeout
;

3421 
	`πl8139_upd©e_úq
(
s
);

3424 
	`qemu_mod_timî
(
s
->
timî
,

3425 
	`πl8139_gë_√xt_t˘r_time
(
s
,
cuº_time
));

3426 
	}
}

3429 
	$pci_πl8139_öô
(
PCIBus
 *
bus
, 
NICInfo
 *
nd
, 
dev‚
)

3431 
PCIRTL8139Sèã
 *
d
;

3432 
RTL8139Sèã
 *
s
;

3433 
uöt8_t
 *
pci_c⁄f
;

3434 
ö°™˚
;

3436 
d
 = (
PCIRTL8139Sèã
 *)
	`pci_ªgi°î_devi˚
(
bus
,

3437 "RTL8139", (
PCIRTL8139Sèã
),

3438 
dev‚
,

3439 
NULL
, NULL);

3440 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

3441 
pci_c⁄f
[0x00] = 0xec;

3442 
pci_c⁄f
[0x01] = 0x10;

3443 
pci_c⁄f
[0x02] = 0x39;

3444 
pci_c⁄f
[0x03] = 0x81;

3445 
pci_c⁄f
[0x04] = 0x05;

3446 
pci_c⁄f
[0x08] = 
RTL8139_PCI_REVID
;

3447 
pci_c⁄f
[0x0a] = 0x00;

3448 
pci_c⁄f
[0x0b] = 0x02;

3449 
pci_c⁄f
[0x0e] = 0x00;

3450 
pci_c⁄f
[0x3d] = 1;

3451 
pci_c⁄f
[0x34] = 0xdc;

3452 
pci_c⁄f
[0x2c] = 0x53;

3453 
pci_c⁄f
[0x2d] = 0x58;

3454 
pci_c⁄f
[0x2e] = 0x01;

3455 
pci_c⁄f
[0x2f] = 0x00;

3457 
s
 = &
d
->
πl8139
;

3460 
s
->
πl8139_mmio_io_addr
 =

3461 
	`˝u_ªgi°î_io_mem‹y
(0, 
πl8139_mmio_ªad
, 
πl8139_mmio_wrôe
, 
s
);

3463 
	`pci_ªgi°î_io_ªgi⁄
(&
d
->
dev
, 0, 0x100,

3464 
PCI_ADDRESS_SPACE_IO
, 
πl8139_i›‹t_m≠
);

3466 
	`pci_ªgi°î_io_ªgi⁄
(&
d
->
dev
, 1, 0x100,

3467 
PCI_ADDRESS_SPACE_MEM
, 
πl8139_mmio_m≠
);

3469 
s
->
úq
 = 16;

3470 
s
->
pci_dev
 = (
PCIDevi˚
 *)
d
;

3471 
	`mem˝y
(
s
->
maˇddr
, 
nd
->macaddr, 6);

3472 
	`πl8139_ª£t
(
s
);

3473 
s
->
vc
 = 
	`qemu_√w_vœn_˛õ¡
(
nd
->
vœn
, 
πl8139_ª˚ive
,

3474 
πl8139_ˇn_ª˚ive
, 
s
);

3476 
	`¢¥ötf
(
s
->
vc
->
öfo_°r
, (s->vc->info_str),

3478 
s
->
maˇddr
[0],

3479 
s
->
maˇddr
[1],

3480 
s
->
maˇddr
[2],

3481 
s
->
maˇddr
[3],

3482 
s
->
maˇddr
[4],

3483 
s
->
maˇddr
[5]);

3485 
s
->
˝lus_txbuf„r
 = 
NULL
;

3486 
s
->
˝lus_txbuf„r_Àn
 = 0;

3487 
s
->
˝lus_txbuf„r_off£t
 = 0;

3489 
ö°™˚
 = 
	`pci_bus_num
(
bus
Ë<< 8 | 
s
->
pci_dev
->
dev‚
;

3490 
	`ªgi°î_ßvevm
("πl8139", 
ö°™˚
, 3, 
πl8139_ßve
, 
πl8139_lﬂd
, 
s
);

3492 #i‡
RTL8139_ONBOARD_TIMER


3493 
s
->
timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
πl8139_timî
, s);

3495 
	`qemu_mod_timî
(
s
->
timî
,

3496 
	`πl8139_gë_√xt_t˘r_time
(
s
,
	`qemu_gë_˛ock
(
vm_˛ock
)));

3498 
	}
}

	@sb16.c

24 
	~"vl.h
"

26 
	#LENOFA
(
a
Ë((Ë(◊)/◊[0])))

	)

28 
	#dﬁog
(...Ë
	`AUD_log
 ("sb16", 
__VA_ARGS__
)

	)

33 #ifde‡
DEBUG


34 
	#ldebug
(...Ë
	`dﬁog
 (
__VA_ARGS__
)

	)

36 
	#ldebug
(...)

	)

39 
	#IO_READ_PROTO
(
«me
) \

40 
uöt32_t
 
	`«me
 (*
›aque
, uöt32_à
≈‹t
)

	)

41 
	#IO_WRITE_PROTO
(
«me
) \

42 
	`«me
 (*
›aque
, 
uöt32_t
 
≈‹t
, uöt32_à
vÆ
)

	)

44 c⁄° 
	ge3
[] = "COPYRIGHT (C) CREATIVE TECHNOLOGY LTD, 1992.";

47 
	mvî_lo
;

48 
	mvî_hi
;

49 
	múq
;

50 
	mdma
;

51 
	mhdma
;

52 
	mp‹t
;

53 } 
	gc⁄f
 = {5, 4, 5, 1, 5, 0x220};

55 
	sSB16Sèã
 {

56 
QEMUSoundC¨d
 
	mˇrd
;

57 
	múq
;

58 
	mdma
;

59 
	mhdma
;

60 
	mp‹t
;

61 
	mvî
;

63 
	mö_ödex
;

64 
	mout_d©a_Àn
;

65 
	mfmt_°îeo
;

66 
	mfmt_sig√d
;

67 
	mfmt_bôs
;

68 
audfmt_e
 
	mfmt
;

69 
	mdma_auto
;

70 
	mblock_size
;

71 
	mfifo
;

72 
	m‰eq
;

73 
	mtime_c⁄°
;

74 
	m•ókî
;

75 
	m√eded_byãs
;

76 
	mcmd
;

77 
	mu£_hdma
;

78 
	mhigh•ìd
;

79 
	mˇn_wrôe
;

81 
	mv2x6
;

83 
uöt8_t
 
	mc•_∑øm
;

84 
uöt8_t
 
	mc•_vÆue
;

85 
uöt8_t
 
	mc•_mode
;

86 
uöt8_t
 
	mc•_ªgs
[256];

87 
uöt8_t
 
	mc•_ödex
;

88 
uöt8_t
 
	mc•_ªg83
[4];

89 
	mc•_ªg83r
;

90 
	mc•_ªg83w
;

92 
uöt8_t
 
	mö2_d©a
[10];

93 
uöt8_t
 
	mout_d©a
[50];

94 
uöt8_t
 
	mã°_ªg
;

95 
uöt8_t
 
	mœ°_ªad_byã
;

96 
	mnzîo
;

98 
	mÀ·_tûl_úq
;

100 
	mdma_ru¬ög
;

101 
	mbyãs_≥r_£c⁄d
;

102 
	mÆign
;

103 
	maudio_‰ì
;

104 
SWVoi˚Out
 *
	mvoi˚
;

106 
QEMUTimî
 *
	maux_ts
;

108 
	mmixî_ƒeg
;

109 
uöt8_t
 
	mmixî_ªgs
[256];

110 } 
	tSB16Sèã
;

112 
SB_audio_ˇŒback
 (*
›aque
, 
‰ì
);

114 
	$magic_of_úq
 (
úq
)

116 
úq
) {

126 
	`dﬁog
 ("bad irq %d\n", 
úq
);

129 
	}
}

131 
	$úq_of_magic
 (
magic
)

133 
magic
) {

143 
	`dﬁog
 ("bad irq magi¯%d\n", 
magic
);

146 
	}
}

149 
	$log_d•
 (
SB16Sèã
 *
d•
)

151 
	`ldebug
 ("%s:%s:%d:%s:dmasize=%d:freq=%d:const=%d:speaker=%d\n",

152 
d•
->
fmt_°îeo
 ? "Stereo" : "Mono",

153 
d•
->
fmt_sig√d
 ? "Signed" : "Unsigned",

154 
d•
->
fmt_bôs
,

155 
d•
->
dma_auto
 ? "Auto" : "Single",

156 
d•
->
block_size
,

157 
d•
->
‰eq
,

158 
d•
->
time_c⁄°
,

159 
d•
->
•ókî
);

160 
	}
}

163 
	$•ókî
 (
SB16Sèã
 *
s
, 
⁄
)

165 
s
->
•ókî
 = 
⁄
;

167 
	}
}

169 
	$c⁄åﬁ
 (
SB16Sèã
 *
s
, 
hﬁd
)

171 
dma
 = 
s
->
u£_hdma
 ? s->
hdma
 : s->dma;

172 
s
->
dma_ru¬ög
 = 
hﬁd
;

174 
	`ldebug
 ("hﬁd %d high %d dm®%d\n", 
hﬁd
, 
s
->
u£_hdma
, 
dma
);

176 i‡(
hﬁd
) {

177 
	`DMA_hﬁd_DREQ
 (
dma
);

178 
	`AUD_£t_a˘ive_out
 (
s
->
voi˚
, 1);

181 
	`DMA_ªÀa£_DREQ
 (
dma
);

182 
	`AUD_£t_a˘ive_out
 (
s
->
voi˚
, 0);

184 
	}
}

186 
	$aux_timî
 (*
›aque
)

188 
SB16Sèã
 *
s
 = 
›aque
;

189 
s
->
ˇn_wrôe
 = 1;

190 
	`pic_£t_úq
 (
s
->
úq
, 1);

191 
	}
}

193 
	#DMA8_AUTO
 1

	)

194 
	#DMA8_HIGH
 2

	)

196 
	$c⁄töue_dma8
 (
SB16Sèã
 *
s
)

198 i‡(
s
->
‰eq
 > 0) {

199 
aud£âögs_t
 
as
;

201 
s
->
audio_‰ì
 = 0;

203 
as
.
‰eq
 = 
s
->freq;

204 
as
.
nch™√ls
 = 1 << 
s
->
fmt_°îeo
;

205 
as
.
fmt
 = 
s
->fmt;

206 
as
.
ídü¬ess
 = 0;

208 
s
->
voi˚
 = 
	`AUD_›í_out
 (

209 &
s
->
ˇrd
,

210 
s
->
voi˚
,

212 
s
,

213 
SB_audio_ˇŒback
,

214 &
as


218 
	`c⁄åﬁ
 (
s
, 1);

219 
	}
}

221 
	$dma_cmd8
 (
SB16Sèã
 *
s
, 
mask
, 
dma_Àn
)

223 
s
->
fmt
 = 
AUD_FMT_U8
;

224 
s
->
u£_hdma
 = 0;

225 
s
->
fmt_bôs
 = 8;

226 
s
->
fmt_sig√d
 = 0;

227 
s
->
fmt_°îeo
 = (s->
mixî_ªgs
[0x0e] & 2) != 0;

228 i‡(-1 =
s
->
time_c⁄°
) {

229 i‡(
s
->
‰eq
 <= 0)

230 
s
->
‰eq
 = 11025;

233 
tmp
 = (256 - 
s
->
time_c⁄°
);

234 
s
->
‰eq
 = (1000000 + (
tmp
 / 2)) /Åmp;

237 i‡(
dma_Àn
 != -1) {

238 
s
->
block_size
 = 
dma_Àn
 << s->
fmt_°îeo
;

248 
s
->
block_size
 &~s->
fmt_°îeo
;

251 
s
->
‰eq
 >>s->
fmt_°îeo
;

252 
s
->
À·_tûl_úq
 = s->
block_size
;

253 
s
->
byãs_≥r_£c⁄d
 = (s->
‰eq
 << s->
fmt_°îeo
);

255 
s
->
dma_auto
 = (
mask
 & 
DMA8_AUTO
) != 0;

256 
s
->
Æign
 = (1 << s->
fmt_°îeo
) - 1;

258 i‡(
s
->
block_size
 & s->
Æign
) {

259 
	`dﬁog
 ("warning: misaligned block size %d,álignment %d\n",

260 
s
->
block_size
, s->
Æign
 + 1);

263 
	`ldebug
 ("freq %d, stereo %d, sign %d, bits %d, "

265 
s
->
‰eq
, s->
fmt_°îeo
, s->
fmt_sig√d
, s->
fmt_bôs
,

266 
s
->
block_size
, s->
dma_auto
, s->
fifo
, s->
high•ìd
);

268 
	`c⁄töue_dma8
 (
s
);

269 
	`•ókî
 (
s
, 1);

270 
	}
}

272 
	$dma_cmd
 (
SB16Sèã
 *
s
, 
uöt8_t
 
cmd
, uöt8_à
d0
, 
dma_Àn
)

274 
s
->
u£_hdma
 = 
cmd
 < 0xc0;

275 
s
->
fifo
 = (
cmd
 >> 1) & 1;

276 
s
->
dma_auto
 = (
cmd
 >> 2) & 1;

277 
s
->
fmt_sig√d
 = (
d0
 >> 4) & 1;

278 
s
->
fmt_°îeo
 = (
d0
 >> 5) & 1;

280 
cmd
 >> 4) {

282 
s
->
fmt_bôs
 = 16;

286 
s
->
fmt_bôs
 = 8;

290 i‡(-1 !
s
->
time_c⁄°
) {

292 
tmp
 = 256 - 
s
->
time_c⁄°
;

293 
s
->
‰eq
 = (1000000 + (
tmp
 / 2)) /Åmp;

296 
s
->
‰eq
 = 1000000 / ((255 - s->
time_c⁄°
));

298 
s
->
time_c⁄°
 = -1;

301 
s
->
block_size
 = 
dma_Àn
 + 1;

302 
s
->
block_size
 <<(s->
fmt_bôs
 == 16);

303 i‡(!
s
->
dma_auto
) {

308 
s
->
block_size
 <<s->
fmt_°îeo
;

311 
	`ldebug
 ("freq %d, stereo %d, sign %d, bits %d, "

313 
s
->
‰eq
, s->
fmt_°îeo
, s->
fmt_sig√d
, s->
fmt_bôs
,

314 
s
->
block_size
, s->
dma_auto
, s->
fifo
, s->
high•ìd
);

316 i‡(16 =
s
->
fmt_bôs
) {

317 i‡(
s
->
fmt_sig√d
) {

318 
s
->
fmt
 = 
AUD_FMT_S16
;

321 
s
->
fmt
 = 
AUD_FMT_U16
;

325 i‡(
s
->
fmt_sig√d
) {

326 
s
->
fmt
 = 
AUD_FMT_S8
;

329 
s
->
fmt
 = 
AUD_FMT_U8
;

333 
s
->
À·_tûl_úq
 = s->
block_size
;

335 
s
->
byãs_≥r_£c⁄d
 = (s->
‰eq
 << s->
fmt_°îeo
Ë<< (s->
fmt_bôs
 == 16);

336 
s
->
high•ìd
 = 0;

337 
s
->
Æign
 = (1 << (s->
fmt_°îeo
 + (s->
fmt_bôs
 == 16))) - 1;

338 i‡(
s
->
block_size
 & s->
Æign
) {

339 
	`dﬁog
 ("warning: misaligned block size %d,álignment %d\n",

340 
s
->
block_size
, s->
Æign
 + 1);

343 i‡(
s
->
‰eq
) {

344 
aud£âögs_t
 
as
;

346 
s
->
audio_‰ì
 = 0;

348 
as
.
‰eq
 = 
s
->freq;

349 
as
.
nch™√ls
 = 1 << 
s
->
fmt_°îeo
;

350 
as
.
fmt
 = 
s
->fmt;

351 
as
.
ídü¬ess
 = 0;

353 
s
->
voi˚
 = 
	`AUD_›í_out
 (

354 &
s
->
ˇrd
,

355 
s
->
voi˚
,

357 
s
,

358 
SB_audio_ˇŒback
,

359 &
as


363 
	`c⁄åﬁ
 (
s
, 1);

364 
	`•ókî
 (
s
, 1);

365 
	}
}

367 
ölöe
 
	$d•_out_d©a
 (
SB16Sèã
 *
s
, 
uöt8_t
 
vÆ
)

369 
	`ldebug
 ("outd©®%#x\n", 
vÆ
);

370 i‡((
size_t
Ë
s
->
out_d©a_Àn
 <  (s->
out_d©a
)) {

371 
s
->
out_d©a
[s->
out_d©a_Àn
++] = 
vÆ
;

373 
	}
}

375 
ölöe
 
uöt8_t
 
	$d•_gë_d©a
 (
SB16Sèã
 *
s
)

377 i‡(
s
->
ö_ödex
) {

378  
s
->
ö2_d©a
[--s->
ö_ödex
];

381 
	`dﬁog
 ("buffer underflow\n");

384 
	}
}

386 
	$comm™d
 (
SB16Sèã
 *
s
, 
uöt8_t
 
cmd
)

388 
	`ldebug
 ("comm™d %#x\n", 
cmd
);

390 i‡(
cmd
 > 0xaf && cmd < 0xd0) {

391 i‡(
cmd
 & 8) {

392 
	`dﬁog
 ("ADCÇŸ yë suµ‹ãd (comm™d %#x)\n", 
cmd
);

395 
cmd
 >> 4) {

400 
	`dﬁog
 ("%#x wr⁄g bôs\n", 
cmd
);

402 
s
->
√eded_byãs
 = 3;

405 
s
->
√eded_byãs
 = 0;

407 
cmd
) {

409 
	`d•_out_d©a
 (
s
, 0x10);

410 
w¨n
;

413 
s
->
√eded_byãs
 = 1;

414 
w¨n
;

417 
s
->
√eded_byãs
 = 2;

418 
w¨n
;

422 
w¨n
;

425 
s
->
√eded_byãs
 = 2;

426 
w¨n
;

429 
	`d•_out_d©a
 (
s
, 0xf8);

430 
w¨n
;

433 
s
->
√eded_byãs
 = 1;

434 
w¨n
;

437 
s
->
√eded_byãs
 = 1;

438 
w¨n
;

441 
s
->
√eded_byãs
 = 2;

442 
s
->
block_size
 = 0;

446 
	`dma_cmd8
 (
s
, 
DMA8_AUTO
, -1);

450 
	`d•_out_d©a
 (
s
, 0xff);

451 
w¨n
;

454 
	`dﬁog
 ("0x35 - MIDI commandÇot implemented\n");

458 
s
->
‰eq
 = -1;

459 
s
->
time_c⁄°
 = -1;

460 
s
->
√eded_byãs
 = 1;

464 
s
->
‰eq
 = -1;

465 
s
->
time_c⁄°
 = -1;

466 
s
->
√eded_byãs
 = 2;

470 
s
->
‰eq
 = -1;

471 
s
->
time_c⁄°
 = -1;

472 
s
->
√eded_byãs
 = 2;

473 
w¨n
;

476 
	`d•_out_d©a
 (
s
, 0xaa);

477 
w¨n
;

483 
s
->
√eded_byãs
 = 2;

487 
s
->
√eded_byãs
 = 2;

488 
	`dﬁog
 ("0x75 - DMA DAC, 4-bit ADPCMÇot implemented\n");

492 
s
->
√eded_byãs
 = 2;

493 
	`dﬁog
 ("0x74 - DMA DAC, 4-bit ADPCM ReferenceÇot implemented\n");

497 
s
->
√eded_byãs
 = 2;

498 
	`dﬁog
 ("0x74 - DMA DAC, 2.6-bit ADPCMÇot implemented\n");

502 
s
->
√eded_byãs
 = 2;

503 
	`dﬁog
 ("0x74 - DMA DAC, 2.6-bit ADPCM ReferenceÇot implemented\n");

507 
	`dﬁog
 ("0x7d - Autio-Initialize DMA DAC, 4-bit ADPCM Reference\n");

508 
	`dﬁog
 ("not implemented\n");

512 
	`dﬁog
 (

515 
	`dﬁog
 ("not implemented\n");

519 
s
->
√eded_byãs
 = 2;

524 
	`dma_cmd8
 (
s
, ((
cmd
 & 1Ë=0Ë| 
DMA8_HIGH
, -1);

528 
	`c⁄åﬁ
 (
s
, 0);

532 
	`•ókî
 (
s
, 1);

536 
	`•ókî
 (
s
, 0);

542 
	`c⁄töue_dma8
 (
s
);

546 
	`c⁄åﬁ
 (
s
, 0);

550 
	`c⁄åﬁ
 (
s
, 1);

554 
s
->
dma_auto
 = 0;

558 
s
->
dma_auto
 = 0;

562 
s
->
√eded_byãs
 = 1;

566 
	`d•_out_d©a
 (
s
, s->
vî
 & 0xff);

567 
	`d•_out_d©a
 (
s
, s->
vî
 >> 8);

571 
s
->
√eded_byãs
 = 1;

572 
w¨n
;

576 
i
;

577 
i
 =  (
e3
) - 1; i >= 0; --i)

578 
	`d•_out_d©a
 (
s
, 
e3
[
i
]);

583 
s
->
√eded_byãs
 = 1;

587 
	`dﬁog
 ("AttemptÅoÖrobe for ESS (0xe7)?\n");

591 
	`d•_out_d©a
 (
s
, s->
ã°_ªg
);

596 
	`d•_out_d©a
 (
s
, 0xaa);

597 
s
->
mixî_ªgs
[0x82] |(
cmd
 == 0xf2) ? 1 : 2;

598 
	`pic_£t_úq
 (
s
->
úq
, 1);

602 
s
->
√eded_byãs
 = 1;

603 
w¨n
;

606 
	`d•_out_d©a
 (
s
, 0);

607 
w¨n
;

610 
	`d•_out_d©a
 (
s
, 0);

611 
w¨n
;

614 
	`dﬁog
 ("Uƒecognized comm™d %#x\n", 
cmd
);

619 i‡(!
s
->
√eded_byãs
) {

620 
	`ldebug
 ("\n");

623 
exô
:

624 i‡(!
s
->
√eded_byãs
) {

625 
s
->
cmd
 = -1;

628 
s
->
cmd
 = cmd;

632 
w¨n
:

633 
	`dﬁog
 ("warning: command %#x,%d isÇotÅruly understood yet\n",

634 
cmd
, 
s
->
√eded_byãs
);

635 
exô
;

637 
	}
}

639 
uöt16_t
 
	$d•_gë_lohi
 (
SB16Sèã
 *
s
)

641 
uöt8_t
 
hi
 = 
	`d•_gë_d©a
 (
s
);

642 
uöt8_t
 
lo
 = 
	`d•_gë_d©a
 (
s
);

643  (
hi
 << 8Ë| 
lo
;

644 
	}
}

646 
uöt16_t
 
	$d•_gë_hûo
 (
SB16Sèã
 *
s
)

648 
uöt8_t
 
lo
 = 
	`d•_gë_d©a
 (
s
);

649 
uöt8_t
 
hi
 = 
	`d•_gë_d©a
 (
s
);

650  (
hi
 << 8Ë| 
lo
;

651 
	}
}

653 
	$com∂ëe
 (
SB16Sèã
 *
s
)

655 
d0
, 
d1
, 
d2
;

656 
	`ldebug
 ("complete command %#x, in_index %d,Çeeded_bytes %d\n",

657 
s
->
cmd
, s->
ö_ödex
, s->
√eded_byãs
);

659 i‡(
s
->
cmd
 > 0xaf && s->cmd < 0xd0) {

660 
d2
 = 
	`d•_gë_d©a
 (
s
);

661 
d1
 = 
	`d•_gë_d©a
 (
s
);

662 
d0
 = 
	`d•_gë_d©a
 (
s
);

664 i‡(
s
->
cmd
 & 8) {

665 
	`dﬁog
 ("ADCÖarams cmd = %#x d0 = %d, d1 = %d, d2 = %d\n",

666 
s
->
cmd
, 
d0
, 
d1
, 
d2
);

669 
	`ldebug
 ("cmd = %#x d0 = %d, d1 = %d, d2 = %d\n",

670 
s
->
cmd
, 
d0
, 
d1
, 
d2
);

671 
	`dma_cmd
 (
s
, s->
cmd
, 
d0
, 
d1
 + (
d2
 << 8));

675 
s
->
cmd
) {

677 
s
->
c•_mode
 = 
	`d•_gë_d©a
 (s);

678 
s
->
c•_ªg83r
 = 0;

679 
s
->
c•_ªg83w
 = 0;

680 
	`ldebug
 ("CSP comm™d 0x04: mode=%#x\n", 
s
->
c•_mode
);

684 
s
->
c•_∑øm
 = 
	`d•_gë_d©a
 (s);

685 
s
->
c•_vÆue
 = 
	`d•_gë_d©a
 (s);

686 
	`ldebug
 ("CSP command 0x05:Öaram=%#x value=%#x\n",

687 
s
->
c•_∑øm
,

688 
s
->
c•_vÆue
);

692 
d0
 = 
	`d•_gë_d©a
 (
s
);

693 
d1
 = 
	`d•_gë_d©a
 (
s
);

694 
	`ldebug
 ("wrôêCSPÑegi°î %d <- %#x\n", 
d1
, 
d0
);

695 i‡(
d1
 == 0x83) {

696 
	`ldebug
 ("0x83[%d] <- %#x\n", 
s
->
c•_ªg83r
, 
d0
);

697 
s
->
c•_ªg83
[s->
c•_ªg83r
 % 4] = 
d0
;

698 
s
->
c•_ªg83r
 += 1;

701 
s
->
c•_ªgs
[
d1
] = 
d0
;

706 
d0
 = 
	`d•_gë_d©a
 (
s
);

707 
	`ldebug
 ("read CSPÑegister %#x -> %#x, mode=%#x\n",

708 
d0
, 
s
->
c•_ªgs
[d0], s->
c•_mode
);

709 i‡(
d0
 == 0x83) {

710 
	`ldebug
 ("0x83[%d] -> %#x\n",

711 
s
->
c•_ªg83w
,

712 
s
->
c•_ªg83
[s->
c•_ªg83w
 % 4]);

713 
	`d•_out_d©a
 (
s
, s->
c•_ªg83
[s->
c•_ªg83w
 % 4]);

714 
s
->
c•_ªg83w
 += 1;

717 
	`d•_out_d©a
 (
s
, s->
c•_ªgs
[
d0
]);

722 
d0
 = 
	`d•_gë_d©a
 (
s
);

723 
	`dﬁog
 ("cmd 0x10 d0=%#x\n", 
d0
);

727 
	`dma_cmd8
 (
s
, 0, 
	`d•_gë_lohi
 (s) + 1);

731 
s
->
time_c⁄°
 = 
	`d•_gë_d©a
 (s);

732 
	`ldebug
 ("£àtimêc⁄° %d\n", 
s
->
time_c⁄°
);

737 
	`dﬁog
 ("cmd 0x42 mightÇot do what itÅhink it should\n");

740 
s
->
‰eq
 = 
	`d•_gë_hûo
 (s);

741 
	`ldebug
 ("£à‰eq %d\n", 
s
->
‰eq
);

745 
s
->
block_size
 = 
	`d•_gë_lohi
 (s) + 1;

746 
	`ldebug
 ("£àdm®blockÜí %d\n", 
s
->
block_size
);

758 
‰eq
, 
ßm∂es
, 
byãs
;

759 
öt64_t
 
ticks
;

761 
‰eq
 = 
s
->freq > 0 ? s->freq : 11025;

762 
ßm∂es
 = 
	`d•_gë_lohi
 (
s
) + 1;

763 
byãs
 = 
ßm∂es
 << 
s
->
fmt_°îeo
 << (s->
fmt_bôs
 == 16);

764 
ticks
 = (
byãs
 * 
ticks_≥r_£c
Ë/ 
‰eq
;

765 i‡(
ticks
 < 
ticks_≥r_£c
 / 1024) {

766 
	`pic_£t_úq
 (
s
->
úq
, 1);

769 i‡(
s
->
aux_ts
) {

770 
	`qemu_mod_timî
 (

771 
s
->
aux_ts
,

772 
	`qemu_gë_˛ock
 (
vm_˛ock
Ë+ 
ticks


776 
	`ldebug
 ("mix sûí˚ %d %d %" 
PRId64
 "\n", 
ßm∂es
, 
byãs
, 
ticks
);

781 
d0
 = 
	`d•_gë_d©a
 (
s
);

782 
s
->
out_d©a_Àn
 = 0;

783 
	`ldebug
 ("E0 d©®%#x\n", 
d0
);

784 
	`d•_out_d©a
 (
s
, ~
d0
);

788 
d0
 = 
	`d•_gë_d©a
 (
s
);

789 
	`ldebug
 ("E2 = %#x\n", 
d0
);

793 
s
->
ã°_ªg
 = 
	`d•_gë_d©a
 (s);

797 
d0
 = 
	`d•_gë_d©a
 (
s
);

798 
	`ldebug
 ("comm™d 0xf9 wôh %#x\n", 
d0
);

799 
d0
) {

801 
	`d•_out_d©a
 (
s
, 0xff);

805 
	`d•_out_d©a
 (
s
, 0x07);

809 
	`d•_out_d©a
 (
s
, 0x38);

813 
	`d•_out_d©a
 (
s
, 0x00);

819 
	`dﬁog
 ("com∂ëe: uƒecognized comm™d %#x\n", 
s
->
cmd
);

824 
	`ldebug
 ("\n");

825 
s
->
cmd
 = -1;

827 
	}
}

829 
	$Àgacy_ª£t
 (
SB16Sèã
 *
s
)

831 
aud£âögs_t
 
as
;

833 
s
->
‰eq
 = 11025;

834 
s
->
fmt_sig√d
 = 0;

835 
s
->
fmt_bôs
 = 8;

836 
s
->
fmt_°îeo
 = 0;

838 
as
.
‰eq
 = 
s
->freq;

839 
as
.
nch™√ls
 = 1;

840 
as
.
fmt
 = 
AUD_FMT_U8
;

841 
as
.
ídü¬ess
 = 0;

843 
s
->
voi˚
 = 
	`AUD_›í_out
 (

844 &
s
->
ˇrd
,

845 
s
->
voi˚
,

847 
s
,

848 
SB_audio_ˇŒback
,

849 &
as


854 
	}
}

856 
	$ª£t
 (
SB16Sèã
 *
s
)

858 
	`pic_£t_úq
 (
s
->
úq
, 0);

859 i‡(
s
->
dma_auto
) {

860 
	`pic_£t_úq
 (
s
->
úq
, 1);

861 
	`pic_£t_úq
 (
s
->
úq
, 0);

864 
s
->
mixî_ªgs
[0x82] = 0;

865 
s
->
dma_auto
 = 0;

866 
s
->
ö_ödex
 = 0;

867 
s
->
out_d©a_Àn
 = 0;

868 
s
->
À·_tûl_úq
 = 0;

869 
s
->
√eded_byãs
 = 0;

870 
s
->
block_size
 = -1;

871 
s
->
nzîo
 = 0;

872 
s
->
high•ìd
 = 0;

873 
s
->
v2x6
 = 0;

874 
s
->
cmd
 = -1;

876 
	`d•_out_d©a
(
s
, 0xaa);

877 
	`•ókî
 (
s
, 0);

878 
	`c⁄åﬁ
 (
s
, 0);

879 
	`Àgacy_ª£t
 (
s
);

880 
	}
}

882 
	$IO_WRITE_PROTO
 (
d•_wrôe
)

884 
SB16Sèã
 *
s
 = 
›aque
;

885 
ù‹t
;

887 
ù‹t
 = 
≈‹t
 - 
s
->
p‹t
;

889 
	`ldebug
 ("wrôê%#x <- %#x\n", 
≈‹t
, 
vÆ
);

890 
ù‹t
) {

892 
vÆ
) {

894 i‡(
s
->
v2x6
 == 1) {

895 i‡(0 && 
s
->
high•ìd
) {

896 
s
->
high•ìd
 = 0;

897 
	`pic_£t_úq
 (
s
->
úq
, 0);

898 
	`c⁄åﬁ
 (
s
, 0);

901 
	`ª£t
 (
s
);

904 
s
->
v2x6
 = 0;

909 
s
->
v2x6
 = 1;

913 
s
->
v2x6
 = 0;

917 
	`ª£t
 (
s
);

921 
	`d•_out_d©a
 (
s
, 0x38);

922 
	`ª£t
 (
s
);

923 
s
->
v2x6
 = 0x39;

927 
s
->
v2x6
 = 
vÆ
;

936 i‡(0 =
s
->
√eded_byãs
) {

937 
	`comm™d
 (
s
, 
vÆ
);

939 i‡(0 =
s
->
√eded_byãs
) {

940 
	`log_d•
 (
s
);

945 i‡(
s
->
ö_ödex
 = (s->
ö2_d©a
)) {

946 
	`dﬁog
 ("in data overrun\n");

949 
s
->
ö2_d©a
[s->
ö_ödex
++] = 
vÆ
;

950 i‡(
s
->
ö_ödex
 =s->
√eded_byãs
) {

951 
s
->
√eded_byãs
 = 0;

952 
	`com∂ëe
 (
s
);

954 
	`log_d•
 (
s
);

962 
	`ldebug
 ("“p‹t=%#x, vÆ=%#x)\n", 
≈‹t
, 
vÆ
);

965 
	}
}

967 
	$IO_READ_PROTO
 (
d•_ªad
)

969 
SB16Sèã
 *
s
 = 
›aque
;

970 
ù‹t
, 
ªtvÆ
, 
ack
 = 0;

972 
ù‹t
 = 
≈‹t
 - 
s
->
p‹t
;

974 
ù‹t
) {

976 
ªtvÆ
 = 0xff;

980 i‡(
s
->
out_d©a_Àn
) {

981 
ªtvÆ
 = 
s
->
out_d©a
[--s->
out_d©a_Àn
];

982 
s
->
œ°_ªad_byã
 = 
ªtvÆ
;

985 i‡(
s
->
cmd
 != -1) {

986 
	`dﬁog
 ("empty output buffer for command %#x\n",

987 
s
->
cmd
);

989 
ªtvÆ
 = 
s
->
œ°_ªad_byã
;

995 
ªtvÆ
 = 
s
->
ˇn_wrôe
 ? 0 : 0x80;

1000 
ªtvÆ
 = 0;

1004 
ªtvÆ
 = (!
s
->
out_d©a_Àn
 || s->
high•ìd
) ? 0 : 0x80;

1005 i‡(
s
->
mixî_ªgs
[0x82] & 1) {

1006 
ack
 = 1;

1007 
s
->
mixî_ªgs
[0x82] &= 1;

1008 
	`pic_£t_úq
 (
s
->
úq
, 0);

1013 
ªtvÆ
 = 0xff;

1014 i‡(
s
->
mixî_ªgs
[0x82] & 2) {

1015 
ack
 = 1;

1016 
s
->
mixî_ªgs
[0x82] &= 2;

1017 
	`pic_£t_úq
 (
s
->
úq
, 0);

1022 
îr‹
;

1025 i‡(!
ack
) {

1026 
	`ldebug
 ("ªad %#x -> %#x\n", 
≈‹t
, 
ªtvÆ
);

1029  
ªtvÆ
;

1031 
îr‹
:

1032 
	`dﬁog
 ("w¨nög: d•_ªad %#xÉº‹\n", 
≈‹t
);

1034 
	}
}

1036 
	$ª£t_mixî
 (
SB16Sèã
 *
s
)

1038 
i
;

1040 
	`mem£t
 (
s
->
mixî_ªgs
, 0xff, 0x7f);

1041 
	`mem£t
 (
s
->
mixî_ªgs
 + 0x83, 0xff,  (s->mixer_regs) - 0x83);

1043 
s
->
mixî_ªgs
[0x02] = 4;

1044 
s
->
mixî_ªgs
[0x06] = 4;

1045 
s
->
mixî_ªgs
[0x08] = 0;

1046 
s
->
mixî_ªgs
[0x0a] = 0;

1049 
s
->
mixî_ªgs
[0x0c] = 0;

1052 
s
->
mixî_ªgs
[0x0e] = 0;

1055 
s
->
mixî_ªgs
[0x04] = (4 << 5) | (4 << 1);

1057 
s
->
mixî_ªgs
[0x22] = (4 << 5) | (4 << 1);

1059 
s
->
mixî_ªgs
[0x26] = (4 << 5) | (4 << 1);

1061 
i
 = 0x30; i < 0x48; i++) {

1062 
s
->
mixî_ªgs
[
i
] = 0x20;

1064 
	}
}

1066 
	$IO_WRITE_PROTO
(
mixî_wrôe_ödexb
)

1068 
SB16Sèã
 *
s
 = 
›aque
;

1069 (Ë
≈‹t
;

1070 
s
->
mixî_ƒeg
 = 
vÆ
;

1071 
	}
}

1073 
	$IO_WRITE_PROTO
(
mixî_wrôe_d©ab
)

1075 
SB16Sèã
 *
s
 = 
›aque
;

1077 (Ë
≈‹t
;

1078 
	`ldebug
 ("mixî_wrôê[%#x] <- %#x\n", 
s
->
mixî_ƒeg
, 
vÆ
);

1080 
s
->
mixî_ƒeg
) {

1082 
	`ª£t_mixî
 (
s
);

1087 
úq
 = 
	`úq_of_magic
 (
vÆ
);

1088 
	`ldebug
 ("£âög irqÅÿ%d (vÆ=%#x)\n", 
úq
, 
vÆ
);

1089 i‡(
úq
 > 0) {

1090 
s
->
úq
 = irq;

1097 
dma
, 
hdma
;

1099 
dma
 = 
	`lsbödex
 (
vÆ
 & 0xf);

1100 
hdma
 = 
	`lsbödex
 (
vÆ
 & 0xf0);

1101 i‡(
dma
 !
s
->dm®|| 
hdma
 != s->hdma) {

1102 
	`dﬁog
 (

1105 
dma
, 
s
->dma, 
hdma
, s->hdma, 
vÆ
);

1108 
s
->
dma
 = dma;

1109 
s
->
hdma
 = hdma;

1115 
	`dﬁog
 ("attemptÅo write into IRQ statusÑegister (val=%#x)\n",

1116 
vÆ
);

1120 i‡(
s
->
mixî_ƒeg
 >= 0x80) {

1121 
	`ldebug
 ("©ãm±Åÿwrôêmixî[%#x] <- %#x\n", 
s
->
mixî_ƒeg
, 
vÆ
);

1126 
s
->
mixî_ªgs
[s->
mixî_ƒeg
] = 
vÆ
;

1127 
	}
}

1129 
	$IO_WRITE_PROTO
(
mixî_wrôe_ödexw
)

1131 
	`mixî_wrôe_ödexb
 (
›aque
, 
≈‹t
, 
vÆ
 & 0xff);

1132 
	`mixî_wrôe_d©ab
 (
›aque
, 
≈‹t
, (
vÆ
 >> 8) & 0xff);

1133 
	}
}

1135 
	$IO_READ_PROTO
(
mixî_ªad
)

1137 
SB16Sèã
 *
s
 = 
›aque
;

1139 (Ë
≈‹t
;

1140 #i‚de‡
DEBUG_SB16_MOST


1141 i‡(
s
->
mixî_ƒeg
 != 0x82) {

1142 
	`ldebug
 ("mixer_read[%#x] -> %#x\n",

1143 
s
->
mixî_ƒeg
, s->
mixî_ªgs
[s->mixer_nreg]);

1146 
	`ldebug
 ("mixer_read[%#x] -> %#x\n",

1147 
s
->
mixî_ƒeg
, s->
mixî_ªgs
[s->mixer_nreg]);

1149  
s
->
mixî_ªgs
[s->
mixî_ƒeg
];

1150 
	}
}

1152 
	$wrôe_audio
 (
SB16Sèã
 *
s
, 
nch™
, 
dma_pos
,

1153 
dma_Àn
, 
Àn
)

1155 
ãmp
, 
√t
;

1156 
uöt8_t
 
tmpbuf
[4096];

1158 
ãmp
 = 
Àn
;

1159 
√t
 = 0;

1161 
ãmp
) {

1162 
À·
 = 
dma_Àn
 - 
dma_pos
;

1163 
c›õd
;

1164 
size_t
 
to_c›y
;

1166 
to_c›y
 = 
	`audio_MIN
 (
ãmp
, 
À·
);

1167 i‡(
to_c›y
 >  (
tmpbuf
)) {

1168 
to_c›y
 =  (
tmpbuf
);

1171 
c›õd
 = 
	`DMA_ªad_mem‹y
 (
nch™
, 
tmpbuf
, 
dma_pos
, 
to_c›y
);

1172 
c›õd
 = 
	`AUD_wrôe
 (
s
->
voi˚
, 
tmpbuf
, copied);

1174 
ãmp
 -
c›õd
;

1175 
dma_pos
 = (dma_po†+ 
c›õd
Ë% 
dma_Àn
;

1176 
√t
 +
c›õd
;

1178 i‡(!
c›õd
) {

1183  
√t
;

1184 
	}
}

1186 
	$SB_ªad_DMA
 (*
›aque
, 
nch™
, 
dma_pos
, 
dma_Àn
)

1188 
SB16Sèã
 *
s
 = 
›aque
;

1189 
tûl
, 
c›y
, 
wrôãn
, 
‰ì
;

1191 i‡(
s
->
À·_tûl_úq
 < 0) {

1192 
s
->
À·_tûl_úq
 = s->
block_size
;

1195 i‡(
s
->
voi˚
) {

1196 
‰ì
 = 
s
->
audio_‰ì
 & ~s->
Æign
;

1197 i‡((
‰ì
 <0Ë|| !
dma_Àn
) {

1198  
dma_pos
;

1202 
‰ì
 = 
dma_Àn
;

1205 
c›y
 = 
‰ì
;

1206 
tûl
 = 
s
->
À·_tûl_úq
;

1208 #ifde‡
DEBUG_SB16_MOST


1209 
	`dﬁog
 ("pos:%06d %dÅill:%dÜen:%d\n",

1210 
dma_pos
, 
‰ì
, 
tûl
, 
dma_Àn
);

1213 i‡(
tûl
 <
c›y
) {

1214 i‡(0 =
s
->
dma_auto
) {

1215 
c›y
 = 
tûl
;

1219 
wrôãn
 = 
	`wrôe_audio
 (
s
, 
nch™
, 
dma_pos
, 
dma_Àn
, 
c›y
);

1220 
dma_pos
 = (dma_po†+ 
wrôãn
Ë% 
dma_Àn
;

1221 
s
->
À·_tûl_úq
 -
wrôãn
;

1223 i‡(
s
->
À·_tûl_úq
 <= 0) {

1224 
s
->
mixî_ªgs
[0x82] |(
nch™
 & 4) ? 2 : 1;

1225 
	`pic_£t_úq
 (
s
->
úq
, 1);

1226 i‡(0 =
s
->
dma_auto
) {

1227 
	`c⁄åﬁ
 (
s
, 0);

1228 
	`•ókî
 (
s
, 0);

1232 #ifde‡
DEBUG_SB16_MOST


1233 
	`ldebug
 ("pos %5d free %5d size %5dÅill % 5d copy %5d written %5d size %5d\n",

1234 
dma_pos
, 
‰ì
, 
dma_Àn
, 
s
->
À·_tûl_úq
, 
c›y
, 
wrôãn
,

1235 
s
->
block_size
);

1238 i‡(
s
->
block_size
) {

1239 
s
->
À·_tûl_úq
 <= 0) {

1240 
s
->
À·_tûl_úq
 = s->
block_size
 + s->left_till_irq;

1244  
dma_pos
;

1245 
	}
}

1247 
	$SB_audio_ˇŒback
 (*
›aque
, 
‰ì
)

1249 
SB16Sèã
 *
s
 = 
›aque
;

1250 
s
->
audio_‰ì
 = 
‰ì
;

1251 
	}
}

1253 
	$SB_ßve
 (
QEMUFûe
 *
f
, *
›aque
)

1255 
SB16Sèã
 *
s
 = 
›aque
;

1257 
	`qemu_put_be32s
 (
f
, &
s
->
úq
);

1258 
	`qemu_put_be32s
 (
f
, &
s
->
dma
);

1259 
	`qemu_put_be32s
 (
f
, &
s
->
hdma
);

1260 
	`qemu_put_be32s
 (
f
, &
s
->
p‹t
);

1261 
	`qemu_put_be32s
 (
f
, &
s
->
vî
);

1262 
	`qemu_put_be32s
 (
f
, &
s
->
ö_ödex
);

1263 
	`qemu_put_be32s
 (
f
, &
s
->
out_d©a_Àn
);

1264 
	`qemu_put_be32s
 (
f
, &
s
->
fmt_°îeo
);

1265 
	`qemu_put_be32s
 (
f
, &
s
->
fmt_sig√d
);

1266 
	`qemu_put_be32s
 (
f
, &
s
->
fmt_bôs
);

1267 
	`qemu_put_be32s
 (
f
, &
s
->
fmt
);

1268 
	`qemu_put_be32s
 (
f
, &
s
->
dma_auto
);

1269 
	`qemu_put_be32s
 (
f
, &
s
->
block_size
);

1270 
	`qemu_put_be32s
 (
f
, &
s
->
fifo
);

1271 
	`qemu_put_be32s
 (
f
, &
s
->
‰eq
);

1272 
	`qemu_put_be32s
 (
f
, &
s
->
time_c⁄°
);

1273 
	`qemu_put_be32s
 (
f
, &
s
->
•ókî
);

1274 
	`qemu_put_be32s
 (
f
, &
s
->
√eded_byãs
);

1275 
	`qemu_put_be32s
 (
f
, &
s
->
cmd
);

1276 
	`qemu_put_be32s
 (
f
, &
s
->
u£_hdma
);

1277 
	`qemu_put_be32s
 (
f
, &
s
->
high•ìd
);

1278 
	`qemu_put_be32s
 (
f
, &
s
->
ˇn_wrôe
);

1279 
	`qemu_put_be32s
 (
f
, &
s
->
v2x6
);

1281 
	`qemu_put_8s
 (
f
, &
s
->
c•_∑øm
);

1282 
	`qemu_put_8s
 (
f
, &
s
->
c•_vÆue
);

1283 
	`qemu_put_8s
 (
f
, &
s
->
c•_mode
);

1284 
	`qemu_put_8s
 (
f
, &
s
->
c•_∑øm
);

1285 
	`qemu_put_buf„r
 (
f
, 
s
->
c•_ªgs
, 256);

1286 
	`qemu_put_8s
 (
f
, &
s
->
c•_ödex
);

1287 
	`qemu_put_buf„r
 (
f
, 
s
->
c•_ªg83
, 4);

1288 
	`qemu_put_be32s
 (
f
, &
s
->
c•_ªg83r
);

1289 
	`qemu_put_be32s
 (
f
, &
s
->
c•_ªg83w
);

1291 
	`qemu_put_buf„r
 (
f
, 
s
->
ö2_d©a
,  (s->in2_data));

1292 
	`qemu_put_buf„r
 (
f
, 
s
->
out_d©a
,  (s->out_data));

1293 
	`qemu_put_8s
 (
f
, &
s
->
ã°_ªg
);

1294 
	`qemu_put_8s
 (
f
, &
s
->
œ°_ªad_byã
);

1296 
	`qemu_put_be32s
 (
f
, &
s
->
nzîo
);

1297 
	`qemu_put_be32s
 (
f
, &
s
->
À·_tûl_úq
);

1298 
	`qemu_put_be32s
 (
f
, &
s
->
dma_ru¬ög
);

1299 
	`qemu_put_be32s
 (
f
, &
s
->
byãs_≥r_£c⁄d
);

1300 
	`qemu_put_be32s
 (
f
, &
s
->
Æign
);

1302 
	`qemu_put_be32s
 (
f
, &
s
->
mixî_ƒeg
);

1303 
	`qemu_put_buf„r
 (
f
, 
s
->
mixî_ªgs
, 256);

1304 
	}
}

1306 
	$SB_lﬂd
 (
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

1308 
SB16Sèã
 *
s
 = 
›aque
;

1310 i‡(
vîsi⁄_id
 != 1) {

1311  -
EINVAL
;

1314 
	`qemu_gë_be32s
 (
f
, &
s
->
úq
);

1315 
	`qemu_gë_be32s
 (
f
, &
s
->
dma
);

1316 
	`qemu_gë_be32s
 (
f
, &
s
->
hdma
);

1317 
	`qemu_gë_be32s
 (
f
, &
s
->
p‹t
);

1318 
	`qemu_gë_be32s
 (
f
, &
s
->
vî
);

1319 
	`qemu_gë_be32s
 (
f
, &
s
->
ö_ödex
);

1320 
	`qemu_gë_be32s
 (
f
, &
s
->
out_d©a_Àn
);

1321 
	`qemu_gë_be32s
 (
f
, &
s
->
fmt_°îeo
);

1322 
	`qemu_gë_be32s
 (
f
, &
s
->
fmt_sig√d
);

1323 
	`qemu_gë_be32s
 (
f
, &
s
->
fmt_bôs
);

1324 
	`qemu_gë_be32s
 (
f
, &
s
->
fmt
);

1325 
	`qemu_gë_be32s
 (
f
, &
s
->
dma_auto
);

1326 
	`qemu_gë_be32s
 (
f
, &
s
->
block_size
);

1327 
	`qemu_gë_be32s
 (
f
, &
s
->
fifo
);

1328 
	`qemu_gë_be32s
 (
f
, &
s
->
‰eq
);

1329 
	`qemu_gë_be32s
 (
f
, &
s
->
time_c⁄°
);

1330 
	`qemu_gë_be32s
 (
f
, &
s
->
•ókî
);

1331 
	`qemu_gë_be32s
 (
f
, &
s
->
√eded_byãs
);

1332 
	`qemu_gë_be32s
 (
f
, &
s
->
cmd
);

1333 
	`qemu_gë_be32s
 (
f
, &
s
->
u£_hdma
);

1334 
	`qemu_gë_be32s
 (
f
, &
s
->
high•ìd
);

1335 
	`qemu_gë_be32s
 (
f
, &
s
->
ˇn_wrôe
);

1336 
	`qemu_gë_be32s
 (
f
, &
s
->
v2x6
);

1338 
	`qemu_gë_8s
 (
f
, &
s
->
c•_∑øm
);

1339 
	`qemu_gë_8s
 (
f
, &
s
->
c•_vÆue
);

1340 
	`qemu_gë_8s
 (
f
, &
s
->
c•_mode
);

1341 
	`qemu_gë_8s
 (
f
, &
s
->
c•_∑øm
);

1342 
	`qemu_gë_buf„r
 (
f
, 
s
->
c•_ªgs
, 256);

1343 
	`qemu_gë_8s
 (
f
, &
s
->
c•_ödex
);

1344 
	`qemu_gë_buf„r
 (
f
, 
s
->
c•_ªg83
, 4);

1345 
	`qemu_gë_be32s
 (
f
, &
s
->
c•_ªg83r
);

1346 
	`qemu_gë_be32s
 (
f
, &
s
->
c•_ªg83w
);

1348 
	`qemu_gë_buf„r
 (
f
, 
s
->
ö2_d©a
,  (s->in2_data));

1349 
	`qemu_gë_buf„r
 (
f
, 
s
->
out_d©a
,  (s->out_data));

1350 
	`qemu_gë_8s
 (
f
, &
s
->
ã°_ªg
);

1351 
	`qemu_gë_8s
 (
f
, &
s
->
œ°_ªad_byã
);

1353 
	`qemu_gë_be32s
 (
f
, &
s
->
nzîo
);

1354 
	`qemu_gë_be32s
 (
f
, &
s
->
À·_tûl_úq
);

1355 
	`qemu_gë_be32s
 (
f
, &
s
->
dma_ru¬ög
);

1356 
	`qemu_gë_be32s
 (
f
, &
s
->
byãs_≥r_£c⁄d
);

1357 
	`qemu_gë_be32s
 (
f
, &
s
->
Æign
);

1359 
	`qemu_gë_be32s
 (
f
, &
s
->
mixî_ƒeg
);

1360 
	`qemu_gë_buf„r
 (
f
, 
s
->
mixî_ªgs
, 256);

1362 i‡(
s
->
voi˚
) {

1363 
	`AUD_˛o£_out
 (&
s
->
ˇrd
, s->
voi˚
);

1364 
s
->
voi˚
 = 
NULL
;

1367 i‡(
s
->
dma_ru¬ög
) {

1368 i‡(
s
->
‰eq
) {

1369 
aud£âögs_t
 
as
;

1371 
s
->
audio_‰ì
 = 0;

1373 
as
.
‰eq
 = 
s
->freq;

1374 
as
.
nch™√ls
 = 1 << 
s
->
fmt_°îeo
;

1375 
as
.
fmt
 = 
s
->fmt;

1376 
as
.
ídü¬ess
 = 0;

1378 
s
->
voi˚
 = 
	`AUD_›í_out
 (

1379 &
s
->
ˇrd
,

1380 
s
->
voi˚
,

1382 
s
,

1383 
SB_audio_ˇŒback
,

1384 &
as


1388 
	`c⁄åﬁ
 (
s
, 1);

1389 
	`•ókî
 (
s
, s->
•ókî
);

1392 
	}
}

1394 
	$SB16_öô
 (
AudioSèã
 *
audio
)

1396 
SB16Sèã
 *
s
;

1397 
i
;

1398 c⁄° 
uöt8_t
 
d•_wrôe_p‹ts
[] = {0x6, 0xc};

1399 c⁄° 
uöt8_t
 
d•_ªad_p‹ts
[] = {0x6, 0xa, 0xc, 0xd, 0xe, 0xf};

1401 i‡(!
audio
) {

1402 
	`dﬁog
 ("Noáudio state\n");

1406 
s
 = 
	`qemu_mÆlocz
 ( (*s));

1407 i‡(!
s
) {

1408 
	`dﬁog
 ("CouldÇotállocate memory for SB16 (%zu bytes)\n",

1409  (*
s
));

1413 
s
->
cmd
 = -1;

1414 
s
->
úq
 = 
c⁄f
.irq;

1415 
s
->
dma
 = 
c⁄f
.dma;

1416 
s
->
hdma
 = 
c⁄f
.hdma;

1417 
s
->
p‹t
 = 
c⁄f
.port;

1418 
s
->
vî
 = 
c⁄f
.
vî_lo
 | (c⁄f.
vî_hi
 << 8);

1420 
s
->
mixî_ªgs
[0x80] = 
	`magic_of_úq
 (s->
úq
);

1421 
s
->
mixî_ªgs
[0x81] = (1 << s->
dma
Ë| (1 << s->
hdma
);

1422 
s
->
mixî_ªgs
[0x82] = 2 << 5;

1424 
s
->
c•_ªgs
[5] = 1;

1425 
s
->
c•_ªgs
[9] = 0xf8;

1427 
	`ª£t_mixî
 (
s
);

1428 
s
->
aux_ts
 = 
	`qemu_√w_timî
 (
vm_˛ock
, 
aux_timî
, s);

1429 i‡(!
s
->
aux_ts
) {

1430 
	`dﬁog
 ("warning: CouldÇot createáuxiliaryÅimer\n");

1433 
i
 = 0; i < 
	`LENOFA
 (
d•_wrôe_p‹ts
); i++) {

1434 
	`ªgi°î_i›‹t_wrôe
 (
s
->
p‹t
 + 
d•_wrôe_p‹ts
[
i
], 1, 1, 
d•_wrôe
, s);

1437 
i
 = 0; i < 
	`LENOFA
 (
d•_ªad_p‹ts
); i++) {

1438 
	`ªgi°î_i›‹t_ªad
 (
s
->
p‹t
 + 
d•_ªad_p‹ts
[
i
], 1, 1, 
d•_ªad
, s);

1441 
	`ªgi°î_i›‹t_wrôe
 (
s
->
p‹t
 + 0x4, 1, 1, 
mixî_wrôe_ödexb
, s);

1442 
	`ªgi°î_i›‹t_wrôe
 (
s
->
p‹t
 + 0x4, 1, 2, 
mixî_wrôe_ödexw
, s);

1443 
	`ªgi°î_i›‹t_ªad
 (
s
->
p‹t
 + 0x5, 1, 1, 
mixî_ªad
, s);

1444 
	`ªgi°î_i›‹t_wrôe
 (
s
->
p‹t
 + 0x5, 1, 1, 
mixî_wrôe_d©ab
, s);

1446 
	`DMA_ªgi°î_ch™√l
 (
s
->
hdma
, 
SB_ªad_DMA
, s);

1447 
	`DMA_ªgi°î_ch™√l
 (
s
->
dma
, 
SB_ªad_DMA
, s);

1448 
s
->
ˇn_wrôe
 = 1;

1450 
	`ªgi°î_ßvevm
 ("sb16", 0, 1, 
SB_ßve
, 
SB_lﬂd
, 
s
);

1451 
	`AUD_ªgi°î_ˇrd
 (
audio
, "sb16", &
s
->
ˇrd
);

1453 
	}
}

	@scsi-disk.c

18 #ifde‡
DEBUG_SCSI


19 
	#DPRINTF
(
fmt
, 
¨gs
...) \

20 dÿ{ 
	`¥ötf
("scsi-disk: " 
fmt
 , ##
¨gs
); } 0)

	)

22 
	#DPRINTF
(
fmt
, 
¨gs
...Ëdÿ{} 0)

	)

25 
	#BADF
(
fmt
, 
¨gs
...) \

26 dÿ{ 
	`Ârötf
(
°dîr
, "scsi-disk: " 
fmt
 , ##
¨gs
); } 0)

	)

28 
	~"vl.h
"

30 
	#SENSE_NO_SENSE
 0

	)

31 
	#SENSE_NOT_READY
 2

	)

32 
	#SENSE_HARDWARE_ERROR
 4

	)

33 
	#SENSE_ILLEGAL_REQUEST
 5

	)

35 
	#SCSI_DMA_BUF_SIZE
 65536

	)

37 
	sSCSIReque°
 {

38 
SCSIDevi˚
 *
	mdev
;

39 
uöt32_t
 
	mèg
;

43 
	m£˘‹
;

44 
	m£˘‹_cou¡
;

46 
	mbuf_Àn
;

47 
uöt8_t
 
	mdma_buf
[
SCSI_DMA_BUF_SIZE
];

48 
BlockDrivîAIOCB
 *
	maiocb
;

49 
SCSIReque°
 *
	m√xt
;

50 } 
	tSCSIReque°
;

52 
	sSCSIDevi˚


54 
BlockDrivîSèã
 *
	mbdrv
;

55 
SCSIReque°
 *
	mªque°s
;

58 
	m˛u°î_size
;

59 
	m£n£
;

60 
	mtcq
;

63 
scsi_com∂ëi⁄‚
 
	mcom∂ëi⁄
;

64 *
	m›aque
;

68 
SCSIReque°
 *
	g‰ì_ªque°s
 = 
NULL
;

70 
SCSIReque°
 *
	$scsi_√w_ªque°
(
SCSIDevi˚
 *
s
, 
uöt32_t
 
èg
)

72 
SCSIReque°
 *
r
;

74 i‡(
‰ì_ªque°s
) {

75 
r
 = 
‰ì_ªque°s
;

76 
‰ì_ªque°s
 = 
r
->
√xt
;

78 
r
 = 
	`qemu_mÆloc
((
SCSIReque°
));

80 
r
->
dev
 = 
s
;

81 
r
->
èg
 =Åag;

82 
r
->
£˘‹_cou¡
 = 0;

83 
r
->
buf_Àn
 = 0;

84 
r
->
aiocb
 = 
NULL
;

86 
r
->
√xt
 = 
s
->
ªque°s
;

87 
s
->
ªque°s
 = 
r
;

88  
r
;

89 
	}
}

91 
	$scsi_ªmove_ªque°
(
SCSIReque°
 *
r
)

93 
SCSIReque°
 *
œ°
;

94 
SCSIDevi˚
 *
s
 = 
r
->
dev
;

96 i‡(
s
->
ªque°s
 =
r
) {

97 
s
->
ªque°s
 = 
r
->
√xt
;

99 
œ°
 = 
s
->
ªque°s
;

100 
œ°
 &&Üa°->
√xt
 !
r
)

101 
œ°
 =Üa°->
√xt
;

102 i‡(
œ°
) {

103 
œ°
->
√xt
 = 
r
->next;

105 
	`BADF
("OrphanedÑequest\n");

108 
r
->
√xt
 = 
‰ì_ªque°s
;

109 
‰ì_ªque°s
 = 
r
;

110 
	}
}

112 
SCSIReque°
 *
	$scsi_föd_ªque°
(
SCSIDevi˚
 *
s
, 
uöt32_t
 
èg
)

114 
SCSIReque°
 *
r
;

116 
r
 = 
s
->
ªque°s
;

117 
r
 &&Ñ->
èg
 !=Åag)

118 
r
 =Ñ->
√xt
;

120  
r
;

121 
	}
}

124 
	$scsi_comm™d_com∂ëe
(
SCSIReque°
 *
r
, 
£n£
)

126 
SCSIDevi˚
 *
s
 = 
r
->
dev
;

127 
uöt32_t
 
èg
;

128 
	`DPRINTF
("Comm™d com∂ëêèg=0x%x sí£=%d\n", 
r
->
èg
, 
£n£
);

129 
s
->
£n£
 = sense;

130 
èg
 = 
r
->tag;

131 
	`scsi_ªmove_ªque°
(
r
);

132 
s
->
	`com∂ëi⁄
(s->
›aque
, 
SCSI_REASON_DONE
, 
èg
, 
£n£
);

133 
	}
}

136 
	$scsi_ˇn˚l_io
(
SCSIDevi˚
 *
s
, 
uöt32_t
 
èg
)

138 
SCSIReque°
 *
r
;

139 
	`DPRINTF
("C™˚»èg=0x%x\n", 
èg
);

140 
r
 = 
	`scsi_föd_ªque°
(
s
, 
èg
);

141 i‡(
r
) {

142 i‡(
r
->
aiocb
)

143 
	`bdrv_aio_ˇn˚l
(
r
->
aiocb
);

144 
r
->
aiocb
 = 
NULL
;

145 
	`scsi_ªmove_ªque°
(
r
);

147 
	}
}

149 
	$scsi_ªad_com∂ëe
(* 
›aque
, 
ªt
)

151 
SCSIReque°
 *
r
 = (SCSIReque° *)
›aque
;

152 
SCSIDevi˚
 *
s
 = 
r
->
dev
;

154 i‡(
ªt
) {

155 
	`DPRINTF
("IOÉrror\n");

156 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_HARDWARE_ERROR
);

159 
	`DPRINTF
("D©®ªadyÅag=0x%xÜí=%d\n", 
r
->
èg
,Ñ->
buf_Àn
);

161 
s
->
	`com∂ëi⁄
(s->
›aque
, 
SCSI_REASON_DATA
, 
r
->
èg
,Ñ->
buf_Àn
);

162 
	}
}

165 
	$scsi_ªad_d©a
(
SCSIDevi˚
 *
s
, 
uöt32_t
 
èg
)

167 
SCSIReque°
 *
r
;

168 
uöt32_t
 
n
;

170 
r
 = 
	`scsi_föd_ªque°
(
s
, 
èg
);

171 i‡(!
r
) {

172 
	`BADF
("BadÑódÅag 0x%x\n", 
èg
);

174 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_HARDWARE_ERROR
);

177 i‡(
r
->
£˘‹_cou¡
 =(
uöt32_t
)-1) {

178 
	`DPRINTF
("Ród buf_Àn=%d\n", 
r
->
buf_Àn
);

179 
r
->
£˘‹_cou¡
 = 0;

180 
s
->
	`com∂ëi⁄
(s->
›aque
, 
SCSI_REASON_DATA
, 
r
->
èg
,Ñ->
buf_Àn
);

183 
	`DPRINTF
("Ród se˘‹_cou¡=%d\n", 
r
->
£˘‹_cou¡
);

184 i‡(
r
->
£˘‹_cou¡
 == 0) {

185 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_NO_SENSE
);

189 
n
 = 
r
->
£˘‹_cou¡
;

190 i‡(
n
 > 
SCSI_DMA_BUF_SIZE
 / 512)

191 
n
 = 
SCSI_DMA_BUF_SIZE
 / 512;

193 
r
->
buf_Àn
 = 
n
 * 512;

194 
r
->
aiocb
 = 
	`bdrv_aio_ªad
(
s
->
bdrv
,Ñ->
£˘‹
,Ñ->
dma_buf
, 
n
,

195 
scsi_ªad_com∂ëe
, 
r
);

196 i‡(
r
->
aiocb
 =
NULL
)

197 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_HARDWARE_ERROR
);

198 
r
->
£˘‹
 +
n
;

199 
r
->
£˘‹_cou¡
 -
n
;

200 
	}
}

202 
	$scsi_wrôe_com∂ëe
(* 
›aque
, 
ªt
)

204 
SCSIReque°
 *
r
 = (SCSIReque° *)
›aque
;

205 
SCSIDevi˚
 *
s
 = 
r
->
dev
;

206 
uöt32_t
 
Àn
;

208 i‡(
ªt
) {

209 
	`Ârötf
(
°dîr
, "scsi-disc: IO writeÉrror\n");

210 
	`exô
(1);

213 
r
->
aiocb
 = 
NULL
;

214 i‡(
r
->
£˘‹_cou¡
 == 0) {

215 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_NO_SENSE
);

217 
Àn
 = 
r
->
£˘‹_cou¡
 * 512;

218 i‡(
Àn
 > 
SCSI_DMA_BUF_SIZE
) {

219 
Àn
 = 
SCSI_DMA_BUF_SIZE
;

221 
r
->
buf_Àn
 = 
Àn
;

222 
	`DPRINTF
("Wrôêcom∂ëêèg=0x%x m‹e=%d\n", 
r
->
èg
, 
Àn
);

223 
s
->
	`com∂ëi⁄
(s->
›aque
, 
SCSI_REASON_DATA
, 
r
->
èg
, 
Àn
);

225 
	}
}

229 
	$scsi_wrôe_d©a
(
SCSIDevi˚
 *
s
, 
uöt32_t
 
èg
)

231 
SCSIReque°
 *
r
;

232 
uöt32_t
 
n
;

234 
	`DPRINTF
("Wrôêd©®èg=0x%x\n", 
èg
);

235 
r
 = 
	`scsi_föd_ªque°
(
s
, 
èg
);

236 i‡(!
r
) {

237 
	`BADF
("Bad wrôêèg 0x%x\n", 
èg
);

238 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_HARDWARE_ERROR
);

241 i‡(
r
->
aiocb
)

242 
	`BADF
("DataÅransferálready inÖrogress\n");

243 
n
 = 
r
->
buf_Àn
 / 512;

244 i‡(
n
) {

245 
r
->
aiocb
 = 
	`bdrv_aio_wrôe
(
s
->
bdrv
,Ñ->
£˘‹
,Ñ->
dma_buf
, 
n
,

246 
scsi_wrôe_com∂ëe
, 
r
);

247 i‡(
r
->
aiocb
 =
NULL
)

248 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_HARDWARE_ERROR
);

249 
r
->
£˘‹
 +
n
;

250 
r
->
£˘‹_cou¡
 -
n
;

253 
	`scsi_wrôe_com∂ëe
(
r
, 0);

257 
	}
}

260 
uöt8_t
 *
	$scsi_gë_buf
(
SCSIDevi˚
 *
s
, 
uöt32_t
 
èg
)

262 
SCSIReque°
 *
r
;

264 
r
 = 
	`scsi_föd_ªque°
(
s
, 
èg
);

265 i‡(!
r
) {

266 
	`BADF
("Bad buf„∏èg 0x%x\n", 
èg
);

267  
NULL
;

269  
r
->
dma_buf
;

270 
	}
}

277 
öt32_t
 
	$scsi_£nd_comm™d
(
SCSIDevi˚
 *
s
, 
uöt32_t
 
èg
, 
uöt8_t
 *
buf
, 
lun
)

279 
öt64_t
 
nb_£˘‹s
;

280 
uöt32_t
 
lba
;

281 
uöt32_t
 
Àn
;

282 
cmdÀn
;

283 
is_wrôe
;

284 
uöt8_t
 
comm™d
;

285 
uöt8_t
 *
outbuf
;

286 
SCSIReque°
 *
r
;

288 
comm™d
 = 
buf
[0];

289 
r
 = 
	`scsi_föd_ªque°
(
s
, 
èg
);

290 i‡(
r
) {

291 
	`BADF
("Tag 0x%xáÃódy i¿u£\n", 
èg
);

292 
	`scsi_ˇn˚l_io
(
s
, 
èg
);

296 
r
 = 
	`scsi_√w_ªque°
(
s
, 
èg
);

297 
outbuf
 = 
r
->
dma_buf
;

298 
is_wrôe
 = 0;

299 
	`DPRINTF
("Comm™d:Üun=%dÅag=0x%x d©a=0x%02x", 
lun
, 
èg
, 
buf
[0]);

300 
comm™d
 >> 5) {

302 
lba
 = 
buf
[3] | (buf[2] << 8) | ((buf[1] & 0x1f) << 16);

303 
Àn
 = 
buf
[4];

304 
cmdÀn
 = 6;

308 
lba
 = 
buf
[5] | (buf[4] << 8) | (buf[3] << 16) | (buf[2] << 24);

309 
Àn
 = 
buf
[8] | (buf[7] << 8);

310 
cmdÀn
 = 10;

313 
lba
 = 
buf
[5] | (buf[4] << 8) | (buf[3] << 16) | (buf[2] << 24);

314 
Àn
 = 
buf
[13] | (buf[12] << 8) | (buf[11] << 16) | (buf[10] << 24);

315 
cmdÀn
 = 16;

318 
lba
 = 
buf
[5] | (buf[4] << 8) | (buf[3] << 16) | (buf[2] << 24);

319 
Àn
 = 
buf
[9] | (buf[8] << 8) | (buf[7] << 16) | (buf[6] << 24);

320 
cmdÀn
 = 12;

323 
	`BADF
("Unsuµ‹ãd comm™dÜígth, comm™d %x\n", 
comm™d
);

324 
Áû
;

326 #ifde‡
DEBUG_SCSI


328 
i
;

329 
i
 = 1; i < 
cmdÀn
; i++) {

330 
	`¥ötf
(" 0x%02x", 
buf
[
i
]);

332 
	`¥ötf
("\n");

335 i‡(
lun
 || 
buf
[1] >> 5) {

337 
	`DPRINTF
("Unim∂emíãd LUN %d\n", 
lun
 ?Üu¿: 
buf
[1] >> 5);

338 
Áû
;

340 
comm™d
) {

342 
	`DPRINTF
("Test Unit Ready\n");

345 
	`DPRINTF
("Reque° Sí£ (À¿%d)\n", 
Àn
);

346 i‡(
Àn
 < 4)

347 
Áû
;

348 
	`mem£t
(
buf
, 0, 4);

349 
outbuf
[0] = 0xf0;

350 
outbuf
[1] = 0;

351 
outbuf
[2] = 
s
->
£n£
;

352 
r
->
buf_Àn
 = 4;

355 
	`DPRINTF
("Inquúy (À¿%d)\n", 
Àn
);

356 i‡(
Àn
 < 36) {

357 
	`BADF
("Inquúy buf„∏toÿsmÆ»(%d)\n", 
Àn
);

359 
	`mem£t
(
outbuf
, 0, 36);

360 i‡(
	`bdrv_gë_ty≥_höt
(
s
->
bdrv
Ë=
BDRV_TYPE_CDROM
) {

361 
outbuf
[0] = 5;

362 
outbuf
[1] = 0x80;

363 
	`mem˝y
(&
outbuf
[16], "QEMU CD-ROM ", 16);

365 
outbuf
[0] = 0;

366 
	`mem˝y
(&
outbuf
[16], "QEMU HARDDISK ", 16);

368 
	`mem˝y
(&
outbuf
[8], "QEMU ", 8);

369 
	`mem˝y
(&
outbuf
[32], 
QEMU_VERSION
, 4);

372 
outbuf
[2] = 3;

373 
outbuf
[3] = 2;

374 
outbuf
[4] = 32;

376 
outbuf
[7] = 0x10 | (
s
->
tcq
 ? 0x02 : 0);

377 
r
->
buf_Àn
 = 36;

380 
	`DPRINTF
("Reserve(6)\n");

381 i‡(
buf
[1] & 1)

382 
Áû
;

385 
	`DPRINTF
("Release(6)\n");

386 i‡(
buf
[1] & 1)

387 
Áû
;

392 
uöt8_t
 *
p
;

393 
∑ge
;

395 
∑ge
 = 
buf
[2] & 0x3f;

396 
	`DPRINTF
("ModêSí£ (∑gê%d,Üí %d)\n", 
∑ge
, 
Àn
);

397 
p
 = 
outbuf
;

398 
	`mem£t
(
p
, 0, 4);

399 
outbuf
[1] = 0;

400 
outbuf
[3] = 0;

401 i‡(
	`bdrv_gë_ty≥_höt
(
s
->
bdrv
Ë=
BDRV_TYPE_CDROM
) {

402 
outbuf
[2] = 0x80;

404 
p
 += 4;

405 i‡((
∑ge
 == 8 ||Öage == 0x3f)) {

407 
p
[0] = 8;

408 
p
[1] = 0x12;

409 
p
[2] = 4;

410 
p
 += 19;

412 i‡((
∑ge
 == 0x3f ||Öage == 0x2a)

413 && (
	`bdrv_gë_ty≥_höt
(
s
->
bdrv
Ë=
BDRV_TYPE_CDROM
)) {

415 
p
[0] = 0x2a;

416 
p
[1] = 0x14;

417 
p
[2] = 3;

418 
p
[3] = 0;

419 
p
[4] = 0x7f;

421 
p
[5] = 0xff;

424 
p
[6] = 0x2d | (
	`bdrv_is_locked
(
s
->
bdrv
)? 2 : 0);

426 
p
[7] = 0;

428 
p
[8] = (50 * 176) >> 8;

429 
p
[9] = (50 * 176) & 0xff;

430 
p
[10] = 0 >> 8;

431 
p
[11] = 0 & 0xff;

432 
p
[12] = 2048 >> 8;

433 
p
[13] = 2048 & 0xff;

434 
p
[14] = (16 * 176) >> 8;

435 
p
[15] = (16 * 176) & 0xff;

436 
p
[18] = (16 * 176) >> 8;

437 
p
[19] = (16 * 176) & 0xff;

438 
p
[20] = (16 * 176) >> 8;

439 
p
[21] = (16 * 176) & 0xff;

440 
p
 += 21;

442 
r
->
buf_Àn
 = 
p
 - 
outbuf
;

443 
outbuf
[0] = 
r
->
buf_Àn
 - 4;

444 i‡(
r
->
buf_Àn
 > 
Àn
)

445 
r
->
buf_Àn
 = 
Àn
;

449 
	`DPRINTF
("Start Stop Unit\n");

452 
	`DPRINTF
("PªvíàAŒow Medium RemovÆ (¥evíà%d)\n", 
buf
[4] & 3);

453 
	`bdrv_£t_locked
(
s
->
bdrv
, 
buf
[4] & 1);

456 
	`DPRINTF
("Read Capacity\n");

458 
	`mem£t
(
outbuf
, 0, 8);

459 
	`bdrv_gë_geomëry
(
s
->
bdrv
, &
nb_£˘‹s
);

461 i‡(
nb_£˘‹s
) {

462 
nb_£˘‹s
--;

463 
outbuf
[0] = (
nb_£˘‹s
 >> 24) & 0xff;

464 
outbuf
[1] = (
nb_£˘‹s
 >> 16) & 0xff;

465 
outbuf
[2] = (
nb_£˘‹s
 >> 8) & 0xff;

466 
outbuf
[3] = 
nb_£˘‹s
 & 0xff;

467 
outbuf
[4] = 0;

468 
outbuf
[5] = 0;

469 
outbuf
[6] = 
s
->
˛u°î_size
 * 2;

470 
outbuf
[7] = 0;

471 
r
->
buf_Àn
 = 8;

473 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_NOT_READY
);

479 
	`DPRINTF
("Ród (£˘‹ %d, cou¡ %d)\n", 
lba
, 
Àn
);

480 
r
->
£˘‹
 = 
lba
 * 
s
->
˛u°î_size
;

481 
r
->
£˘‹_cou¡
 = 
Àn
 * 
s
->
˛u°î_size
;

485 
	`DPRINTF
("Wrôê(£˘‹ %d, cou¡ %d)\n", 
lba
, 
Àn
);

486 
r
->
£˘‹
 = 
lba
 * 
s
->
˛u°î_size
;

487 
r
->
£˘‹_cou¡
 = 
Àn
 * 
s
->
˛u°î_size
;

488 
is_wrôe
 = 1;

491 
	`DPRINTF
("Syn¸⁄i£ cachê(£˘‹ %d, cou¡ %d)\n", 
lba
, 
Àn
);

492 
	`bdrv_Êush
(
s
->
bdrv
);

496 
°¨t_åack
, 
f‹m©
, 
msf
, 
to˛í
;

498 
msf
 = 
buf
[1] & 2;

499 
f‹m©
 = 
buf
[2] & 0xf;

500 
°¨t_åack
 = 
buf
[6];

501 
	`bdrv_gë_geomëry
(
s
->
bdrv
, &
nb_£˘‹s
);

502 
	`DPRINTF
("Ród TOC (åack %d f‹m© %d ms‡%d)\n", 
°¨t_åack
, 
f‹m©
, 
msf
 >> 1);

503 
f‹m©
) {

505 
to˛í
 = 
	`cdrom_ªad_toc
(
nb_£˘‹s
, 
outbuf
, 
msf
, 
°¨t_åack
);

509 
to˛í
 = 12;

510 
	`mem£t
(
outbuf
, 0, 12);

511 
outbuf
[1] = 0x0a;

512 
outbuf
[2] = 0x01;

513 
outbuf
[3] = 0x01;

516 
to˛í
 = 
	`cdrom_ªad_toc_øw
(
nb_£˘‹s
, 
outbuf
, 
msf
, 
°¨t_åack
);

519 
îr‹_cmd
;

521 i‡(
to˛í
 > 0) {

522 i‡(
Àn
 > 
to˛í
)

523 
Àn
 = 
to˛í
;

524 
r
->
buf_Àn
 = 
Àn
;

527 
îr‹_cmd
:

528 
	`DPRINTF
("Read TOCÉrror\n");

529 
Áû
;

532 
	`DPRINTF
("Gë C⁄figuøti⁄ (π %d, maxÀ¿%d)\n", 
buf
[1] & 3, 
Àn
);

533 
	`mem£t
(
outbuf
, 0, 8);

536 
outbuf
[7] = 8;

537 
r
->
buf_Àn
 = 8;

540 
	`DPRINTF
("Reserve(10)\n");

541 i‡(
buf
[1] & 3)

542 
Áû
;

545 
	`DPRINTF
("Release(10)\n");

546 i‡(
buf
[1] & 3)

547 
Áû
;

550 
	`DPRINTF
("Rï‹àLUN†÷í %d)\n", 
Àn
);

551 i‡(
Àn
 < 16)

552 
Áû
;

553 
	`mem£t
(
outbuf
, 0, 16);

554 
outbuf
[3] = 8;

555 
r
->
buf_Àn
 = 16;

558 
	`DPRINTF
("Unknow¿SCSI comm™d (%2.2x)\n", 
buf
[0]);

559 
Áû
:

560 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_ILLEGAL_REQUEST
);

563 i‡(
r
->
£˘‹_cou¡
 =0 &&Ñ->
buf_Àn
 == 0) {

564 
	`scsi_comm™d_com∂ëe
(
r
, 
SENSE_NO_SENSE
);

566 
Àn
 = 
r
->
£˘‹_cou¡
 * 512 +Ñ->
buf_Àn
;

567 i‡(
is_wrôe
) {

568  -
Àn
;

570 i‡(!
r
->
£˘‹_cou¡
)

571 
r
->
£˘‹_cou¡
 = -1;

572  
Àn
;

574 
	}
}

576 
	$scsi_disk_de°roy
(
SCSIDevi˚
 *
s
)

578 
	`qemu_‰ì
(
s
);

579 
	}
}

581 
SCSIDevi˚
 *
	$scsi_disk_öô
(
BlockDrivîSèã
 *
bdrv
,

582 
tcq
,

583 
scsi_com∂ëi⁄‚
 
com∂ëi⁄
,

584 *
›aque
)

586 
SCSIDevi˚
 *
s
;

588 
s
 = (
SCSIDevi˚
 *)
	`qemu_mÆlocz
((SCSIDevice));

589 
s
->
bdrv
 = bdrv;

590 
s
->
tcq
 =Åcq;

591 
s
->
com∂ëi⁄
 = completion;

592 
s
->
›aque
 = opaque;

593 i‡(
	`bdrv_gë_ty≥_höt
(
s
->
bdrv
Ë=
BDRV_TYPE_CDROM
) {

594 
s
->
˛u°î_size
 = 4;

596 
s
->
˛u°î_size
 = 1;

599  
s
;

600 
	}
}

	@serial.c

25 
	~"vl.h
"

26 
	~<sys/time.h
>

27 
	~<time.h
>

28 
	~<as£π.h
>

29 
	~<ãrmios.h
>

30 
	~<sys/io˘l.h
>

34 
	#UART_LCR_DLAB
 0x80

	)

36 
	#UART_IER_MSI
 0x08

	)

37 
	#UART_IER_RLSI
 0x04

	)

38 
	#UART_IER_THRI
 0x02

	)

39 
	#UART_IER_RDI
 0x01

	)

41 
	#UART_IIR_NO_INT
 0x01

	)

42 
	#UART_IIR_ID
 0x06

	)

44 
	#UART_IIR_MSI
 0x00

	)

45 
	#UART_IIR_THRI
 0x02

	)

46 
	#UART_IIR_RDI
 0x04

	)

47 
	#UART_IIR_RLSI
 0x06

	)

48 
	#UART_IIR_CTI
 0x0C

	)

50 
	#UART_IIR_FENF
 0x80

	)

51 
	#UART_IIR_FE
 0xC0

	)

56 
	#UART_MCR_LOOP
 0x10

	)

57 
	#UART_MCR_OUT2
 0x08

	)

58 
	#UART_MCR_OUT1
 0x04

	)

59 
	#UART_MCR_RTS
 0x02

	)

60 
	#UART_MCR_DTR
 0x01

	)

65 
	#UART_MSR_DCD
 0x80

	)

66 
	#UART_MSR_RI
 0x40

	)

67 
	#UART_MSR_DSR
 0x20

	)

68 
	#UART_MSR_CTS
 0x10

	)

69 
	#UART_MSR_DDCD
 0x08

	)

70 
	#UART_MSR_TERI
 0x04

	)

71 
	#UART_MSR_DDSR
 0x02

	)

72 
	#UART_MSR_DCTS
 0x01

	)

73 
	#UART_MSR_ANY_DELTA
 0x0F

	)

75 
	#UART_LSR_TEMT
 0x40

	)

76 
	#UART_LSR_THRE
 0x20

	)

77 
	#UART_LSR_BI
 0x10

	)

78 
	#UART_LSR_FE
 0x08

	)

79 
	#UART_LSR_PE
 0x04

	)

80 
	#UART_LSR_OE
 0x02

	)

81 
	#UART_LSR_DR
 0x01

	)

82 
	#UART_LSR_INT_ANY
 0x1E

	)

86 
	#UART_FCR_ITL_1
 0x00

	)

87 
	#UART_FCR_ITL_2
 0x40

	)

88 
	#UART_FCR_ITL_3
 0x80

	)

89 
	#UART_FCR_ITL_4
 0xC0

	)

91 
	#UART_FCR_DMS
 0x08

	)

92 
	#UART_FCR_XFR
 0x04

	)

93 
	#UART_FCR_RFR
 0x02

	)

94 
	#UART_FCR_FE
 0x01

	)

96 
	#UART_FIFO_LENGTH
 16

	)

98 
	#XMIT_FIFO
 0

	)

99 
	#RECV_FIFO
 1

	)

100 
	#MAX_XMIT_RETRY
 4

	)

102 
	sSîülFIFO
 {

103 
uöt8_t
 
	md©a
[
UART_FIFO_LENGTH
];

104 
uöt8_t
 
	mcou¡
;

105 
uöt8_t
 
	môl
;

106 
uöt8_t
 
	mèû
;

107 
uöt8_t
 
	mhód
;

108 } 
	gSîülFIFO
;

110 
	sSîülSèã
 {

111 
uöt16_t
 
	mdividî
;

112 
uöt8_t
 
	mrbr
;

113 
uöt8_t
 
	mthr
;

114 
uöt8_t
 
	mt§
;

115 
uöt8_t
 
	mõr
;

116 
uöt8_t
 
	miú
;

117 
uöt8_t
 
	ml¸
;

118 
uöt8_t
 
	mm¸
;

119 
uöt8_t
 
	ml§
;

120 
uöt8_t
 
	mm§
;

121 
uöt8_t
 
	ms¸
;

122 
uöt8_t
 
	mf¸
;

125 
	mthr_ùídög
;

126 
SëIRQFunc
 *
	m£t_úq
;

127 *
	múq_›aque
;

128 
	múq
;

129 
Ch¨DrivîSèã
 *
	mchr
;

130 
	mœ°_bªak_íabÀ
;

131 
èrgë_ul⁄g
 
	mba£
;

132 
	mô_shi·
;

133 
	mt§_ªåy
;

135 
uöt64_t
 
	mœ°_xmô_ts
;

136 
SîülFIFO
 
	mªcv_fifo
;

137 
SîülFIFO
 
	mxmô_fifo
;

139 
QEMUTimî
 *
	mfifo_timeout_timî
;

140 
	mtimeout_ùídög
;

141 
QEMUTimî
 *
	må™smô_timî
;

144 
uöt64_t
 
	mch¨_å™smô_time
;

145 
	mpﬁl_m¶
;

147 
QEMUTimî
 *
	mmodem_°©us_pﬁl
;

155 
	#TOKEN_PERIOD
 1000

	)

157 
	#TOKENS_MAX
 100000

	)

159 
	gtokís_avaû
;

161 
	$fifo_˛ór
(
SîülSèã
 *
s
, 
fifo
) {

162 
SîülFIFO
 *
f
 = ( 
fifo
 ) ? &
s
->
ªcv_fifo
 : &s->
xmô_fifo
;

163 
	`mem£t
(
f
->
d©a
, 0, 
UART_FIFO_LENGTH
);

164 
f
->
cou¡
 = 0;

165 
f
->
hód
 = 0;

166 
f
->
èû
 = 0;

167 
	}
}

169 
	$fifo_put
(
SîülSèã
 *
s
, 
fifo
, 
uöt8_t
 
chr
) {

170 
SîülFIFO
 *
f
 = ( 
fifo
 ) ? &
s
->
ªcv_fifo
 : &s->
xmô_fifo
;

172 
f
->
d©a
[f->
hód
++] = 
chr
;

174 i‡(
f
->
hód
 =
UART_FIFO_LENGTH
)

175 
f
->
hód
 = 0;

176 
f
->
cou¡
++;

178 
tokís_avaû
 = 
TOKENS_MAX
;

181 
	}
}

183 
uöt8_t
 
	$fifo_gë
(
SîülSèã
 *
s
, 
fifo
) {

184 
SîülFIFO
 *
f
 = ( 
fifo
 ) ? &
s
->
ªcv_fifo
 : &s->
xmô_fifo
;

185 
uöt8_t
 
c
;

187 if–
f
->
cou¡
 == 0 )

190 
c
 = 
f
->
d©a
[f->
èû
++];

191 i‡(
f
->
èû
 =
UART_FIFO_LENGTH
)

192 
f
->
èû
 = 0;

193 
f
->
cou¡
--;

195 
tokís_avaû
 = 
TOKENS_MAX
;

197  
c
;

198 
	}
}

200 
	$£rül_upd©e_úq
(
SîülSèã
 *
s
)

202 
uöt8_t
 
tmp_iú
 = 
UART_IIR_NO_INT
;

204 i‡(!
s
->
õr
) {

205 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 0);

209 i‡––
s
->
õr
 & 
UART_IER_RLSI
 ) && (s->
l§
 & 
UART_LSR_INT_ANY
 ) ) {

210 
tmp_iú
 = 
UART_IIR_RLSI
;

211 } i‡–
s
->
timeout_ùídög
 ) {

212 
tmp_iú
 = 
UART_IIR_CTI
;

213 } i‡––
s
->
õr
 & 
UART_IER_RDI
 ) && (s->
l§
 & 
UART_LSR_DR
 ) ) {

214 i‡–!(
s
->
iú
 & 
UART_FCR_FE
) ) {

215 
tmp_iú
 = 
UART_IIR_RDI
;

216 } i‡–
s
->
ªcv_fifo
.
cou¡
 >s->ªcv_fifo.
ôl
 ) {

217 
tmp_iú
 = 
UART_IIR_RDI
;

219 } i‡–(
s
->
õr
 & 
UART_IER_THRI
Ë&& s->
thr_ùídög
 ) {

220 
tmp_iú
 = 
UART_IIR_THRI
;

221 } i‡–(
s
->
õr
 & 
UART_IER_MSI
Ë&& (s->
m§
 & 
UART_MSR_ANY_DELTA
) ) {

222 
tmp_iú
 = 
UART_IIR_MSI
;

225 
s
->
iú
 = 
tmp_iú
 | ( s->iir & 0xF0 );

227 i‡–
tmp_iú
 !
UART_IIR_NO_INT
 ) {

228 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 1);

230 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 0);

232 
	}
}

234 
	$£rül_upd©e_∑ømëîs
(
SîülSèã
 *
s
)

236 
•ìd
, 
∑rôy
, 
d©a_bôs
, 
°›_bôs
, 
‰ame_size
;

237 
QEMUSîülSëP¨ams
 
s•
;

239 i‡(
s
->
dividî
 == 0)

242 
‰ame_size
 = 1;

243 i‡(
s
->
l¸
 & 0x08) {

244 i‡(
s
->
l¸
 & 0x10)

245 
∑rôy
 = 'E';

247 
∑rôy
 = 'O';

249 
∑rôy
 = 'N';

250 
‰ame_size
 = 0;

252 i‡(
s
->
l¸
 & 0x04)

253 
°›_bôs
 = 2;

255 
°›_bôs
 = 1;

257 
d©a_bôs
 = (
s
->
l¸
 & 0x03) + 5;

258 
‰ame_size
 +
d©a_bôs
 + 
°›_bôs
;

260 
•ìd
 = 115200 / 
s
->
dividî
;

261 
s•
.
•ìd
 = speed;

262 
s•
.
∑rôy
 =Öarity;

263 
s•
.
d©a_bôs
 = data_bits;

264 
s•
.
°›_bôs
 = stop_bits;

265 
s
->
ch¨_å™smô_time
 = ( 
ticks_≥r_£c
 / 
•ìd
 ) * 
‰ame_size
;

266 
	`qemu_chr_io˘l
(
s
->
chr
, 
CHR_IOCTL_SERIAL_SET_PARAMS
, &
s•
);

268 
	`¥ötf
("speed=%dÖarity=%c data=%d stop=%d\n",

269 
•ìd
, 
∑rôy
, 
d©a_bôs
, 
°›_bôs
);

271 
	}
}

273 
	$£rül_gë_tokí
()

275 
timevÆ
 
œ°_ªfû_time
;

276 
°¨ãd
;

278 
	`as£π
(
tokís_avaû
 >= 0);

279 i‡(!
tokís_avaû
) {

280 
timevÆ
 
dñè
, 
now
;

281 
gíî©ed
;

283 i‡(!
°¨ãd
) {

284 
	`gëtimeofday
(&
œ°_ªfû_time
, 
NULL
);

285 
tokís_avaû
 = 
TOKENS_MAX
;

286 
°¨ãd
 = 1;

289 
ªåy
:

290 
	`gëtimeofday
(&
now
, 
NULL
);

291 
dñè
.
tv_£c
 = 
now
.tv_£¯- 
œ°_ªfû_time
.tv_sec;

292 
dñè
.
tv_u£c
 = 
now
.tv_u£¯- 
œ°_ªfû_time
.tv_usec;

293 i‡(
dñè
.
tv_u£c
 < 0) {

294 
dñè
.
tv_u£c
 += 1000000;

295 
dñè
.
tv_£c
--;

297 
	`as£π
(
dñè
.
tv_u£c
 >0 && dñè.
tv_£c
 >= 0);

298 i‡(
dñè
.
tv_u£c
 < 
TOKEN_PERIOD
) {

299 
time•ec
 
ts
;

301 
ts
.
tv_£c
 = 
TOKEN_PERIOD
 / 1000000;

302 
ts
.
tv_n£c
 = (
TOKEN_PERIOD
 % 1000000) * 1000;

303 
	`«no¶ìp
(&
ts
, &tsË< 0 && 
î∫o
 =
EINTR
)

305 
ªåy
;

307 
gíî©ed
 = (
dñè
.
tv_£c
 * 1000000Ë/ 
TOKEN_PERIOD
;

308 
gíî©ed
 +=

309 ((
dñè
.
tv_£c
 * 1000000Ë% 
TOKEN_PERIOD
 + dñè.
tv_u£c
) / TOKEN_PERIOD;

310 
	`as£π
(
gíî©ed
 > 0);

312 
œ°_ªfû_time
.
tv_u£c
 +(
gíî©ed
 * 
TOKEN_PERIOD
) % 1000000;

313 
œ°_ªfû_time
.
tv_£c
 +œ°_ªfû_time.
tv_u£c
 / 1000000;

314 
œ°_ªfû_time
.
tv_u£c
 %= 1000000;

315 
œ°_ªfû_time
.
tv_£c
 +(
gíî©ed
 * 
TOKEN_PERIOD
) / 1000000;

316 i‡(
gíî©ed
 > 
TOKENS_MAX
)

317 
gíî©ed
 = 
TOKENS_MAX
;

318 
tokís_avaû
 = 
gíî©ed
;

320 
tokís_avaû
--;

321 
	}
}

323 
	$£rül_upd©e_m¶
–
SîülSèã
 *
s
 )

325 
uöt8_t
 
om§
;

326 
Êags
;

328 
	`qemu_dñ_timî
(
s
->
modem_°©us_pﬁl
);

330 i‡–
	`qemu_chr_io˘l
(
s
->
chr
,
CHR_IOCTL_SERIAL_GET_TIOCM
, &
Êags
Ë=-
ENOTSUP
 ) {

331 
s
->
pﬁl_m¶
 = -1;

335 
om§
 = 
s
->
m§
;

337 
s
->
m§
 = ( 
Êags
 & 
TIOCM_CTS
 ) ? s->m§ | 
UART_MSR_CTS
 : s->msr & ~UART_MSR_CTS;

338 
s
->
m§
 = ( 
Êags
 & 
TIOCM_DSR
 ) ? s->m§ | 
UART_MSR_DSR
 : s->msr & ~UART_MSR_DSR;

339 
s
->
m§
 = ( 
Êags
 & 
TIOCM_CAR
 ) ? s->m§ | 
UART_MSR_DCD
 : s->msr & ~UART_MSR_DCD;

340 
s
->
m§
 = ( 
Êags
 & 
TIOCM_RI
 ) ? s->m§ | 
UART_MSR_RI
 : s->msr & ~UART_MSR_RI;

342 i‡–
s
->
m§
 !
om§
 ) {

344 
s
->
m§
 = s->m§ | ( ( s->m§ >> 4 ) ^ ( 
om§
 >> 4 ) );

346 i‡––
s
->
m§
 & 
UART_MSR_TERI
 ) && !–
om§
 & 
UART_MSR_RI
 ) )

347 
s
->
m§
 &~
UART_MSR_TERI
;

348 
	`£rül_upd©e_úq
(
s
);

354 i‡–
s
->
pﬁl_m¶
 )

355 
	`qemu_mod_timî
(
s
->
modem_°©us_pﬁl
, 
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ 
ticks_≥r_£c
 / 100);

356 
	}
}

358 
	$£rül_xmô
(*
›aque
) {

359 
SîülSèã
 *
s
 = 
›aque
;

360 
uöt64_t
 
√w_xmô_ts
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

362 i‡–
s
->
t§_ªåy
 <= 0 ) {

363 i‡(
s
->
f¸
 & 
UART_FCR_FE
) {

364 
s
->
t§
 = 
	`fifo_gë
(s,
XMIT_FIFO
);

365 i‡–!
s
->
xmô_fifo
.
cou¡
 )

366 
s
->
l§
 |
UART_LSR_THRE
;

368 
s
->
t§
 = s->
thr
;

369 
s
->
l§
 |
UART_LSR_THRE
;

373 i‡–
	`qemu_chr_wrôe
(
s
->
chr
, &s->
t§
, 1) != 1 ) {

374 i‡––
s
->
t§_ªåy
 > 0 ) && ( s->t§_ªåy <
MAX_XMIT_RETRY
 ) ) {

375 
s
->
t§_ªåy
++;

376 
	`qemu_mod_timî
(
s
->
å™smô_timî
, 
√w_xmô_ts
 + s->
ch¨_å™smô_time
 );

378 } i‡–
s
->
pﬁl_m¶
 < 0 ) {

382 
s
->
t§_ªåy
 = -1;

386 
s
->
t§_ªåy
 = 0;

389 
s
->
œ°_xmô_ts
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

390 i‡–!(
s
->
l§
 & 
UART_LSR_THRE
) )

391 
	`qemu_mod_timî
(
s
->
å™smô_timî
, s->
œ°_xmô_ts
 + s->
ch¨_å™smô_time
 );

393 i‡–
s
->
l§
 & 
UART_LSR_THRE
 ) {

394 
s
->
l§
 |
UART_LSR_TEMT
;

395 
s
->
thr_ùídög
 = 1;

396 
	`£rül_upd©e_úq
(
s
);

398 
	}
}

401 
	$£rül_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

403 
SîülSèã
 *
s
 = 
›aque
;

405 
addr
 &= 7;

406 #ifde‡
DEBUG_SERIAL


407 
	`¥ötf
("£rül: wrôêaddr=0x%02x vÆ=0x%02x\n", 
addr
, 
vÆ
);

409 
addr
) {

412 i‡(
s
->
l¸
 & 
UART_LCR_DLAB
) {

413 
s
->
dividî
 = (s->dividî & 0xff00Ë| 
vÆ
;

414 
	`£rül_upd©e_∑ømëîs
(
s
);

416 
s
->
thr
 = (
uöt8_t
Ë
vÆ
;

417 if(
s
->
f¸
 & 
UART_FCR_FE
) {

418 
	`fifo_put
(
s
, 
XMIT_FIFO
, s->
thr
);

419 
s
->
thr_ùídög
 = 0;

420 
s
->
l§
 &~
UART_LSR_TEMT
;

421 
s
->
l§
 &~
UART_LSR_THRE
;

422 
	`£rül_upd©e_úq
(
s
);

424 
s
->
thr_ùídög
 = 0;

425 
s
->
l§
 &~
UART_LSR_THRE
;

426 
	`£rül_upd©e_úq
(
s
);

428 
	`£rül_xmô
(
s
);

432 i‡(
s
->
l¸
 & 
UART_LCR_DLAB
) {

433 
s
->
dividî
 = (s->dividî & 0x00ffË| (
vÆ
 << 8);

434 
	`£rül_upd©e_∑ømëîs
(
s
);

436 
s
->
õr
 = 
vÆ
 & 0x0f;

439 i‡–
s
->
pﬁl_m¶
 >= 0 ) {

440 i‡–
s
->
õr
 & 
UART_IER_MSI
 ) {

441 
s
->
pﬁl_m¶
 = 1;

442 
	`£rül_upd©e_m¶
(
s
);

444 
	`qemu_dñ_timî
(
s
->
modem_°©us_pﬁl
);

445 
s
->
pﬁl_m¶
 = 0;

448 i‡(
s
->
l§
 & 
UART_LSR_THRE
) {

449 
s
->
thr_ùídög
 = 1;

450 
	`£rül_upd©e_úq
(
s
);

455 
vÆ
 = val & 0xFF;

457 i‡–
s
->
f¸
 =
vÆ
)

461 i‡–(
vÆ
 ^ 
s
->
f¸
Ë& 
UART_FCR_FE
 )

462 
vÆ
 |
UART_FCR_XFR
 | 
UART_FCR_RFR
;

466 i‡–
vÆ
 & 
UART_FCR_RFR
 ) {

467 
	`qemu_dñ_timî
(
s
->
fifo_timeout_timî
);

468 
s
->
timeout_ùídög
=0;

469 
	`fifo_˛ór
(
s
,
RECV_FIFO
);

472 i‡–
vÆ
 & 
UART_FCR_XFR
 ) {

473 
	`fifo_˛ór
(
s
,
XMIT_FIFO
);

476 i‡–
vÆ
 & 
UART_FCR_FE
 ) {

477 
s
->
iú
 |
UART_IIR_FE
;

479  
vÆ
 & 0xC0 ) {

480 
UART_FCR_ITL_1
:

481 
s
->
ªcv_fifo
.
ôl
 = 1;

483 
UART_FCR_ITL_2
:

484 
s
->
ªcv_fifo
.
ôl
 = 4;

486 
UART_FCR_ITL_3
:

487 
s
->
ªcv_fifo
.
ôl
 = 8;

489 
UART_FCR_ITL_4
:

490 
s
->
ªcv_fifo
.
ôl
 = 14;

494 
s
->
iú
 &~
UART_IIR_FE
;

497 
s
->
f¸
 = 
vÆ
 & 0xC9;

498 
	`£rül_upd©e_úq
(
s
);

502 
bªak_íabÀ
;

503 
s
->
l¸
 = 
vÆ
;

504 
	`£rül_upd©e_∑ømëîs
(
s
);

505 
bªak_íabÀ
 = (
vÆ
 >> 6) & 1;

506 i‡(
bªak_íabÀ
 !
s
->
œ°_bªak_íabÀ
) {

507 
s
->
œ°_bªak_íabÀ
 = 
bªak_íabÀ
;

508 
	`qemu_chr_io˘l
(
s
->
chr
, 
CHR_IOCTL_SERIAL_SET_BREAK
,

509 &
bªak_íabÀ
);

515 
Êags
;

516 
ﬁd_m¸
 = 
s
->
m¸
;

517 
s
->
m¸
 = 
vÆ
 & 0x1f;

518 i‡–
vÆ
 & 
UART_MCR_LOOP
 )

521 i‡–
s
->
pﬁl_m¶
 >0 && 
ﬁd_m¸
 !s->
m¸
 ) {

523 
	`qemu_chr_io˘l
(
s
->
chr
,
CHR_IOCTL_SERIAL_GET_TIOCM
, &
Êags
);

525 
Êags
 &~–
TIOCM_RTS
 | 
TIOCM_DTR
 );

527 i‡–
vÆ
 & 
UART_MCR_RTS
 )

528 
Êags
 |
TIOCM_RTS
;

529 i‡–
vÆ
 & 
UART_MCR_DTR
 )

530 
Êags
 |
TIOCM_DTR
;

532 
	`qemu_chr_io˘l
(
s
->
chr
,
CHR_IOCTL_SERIAL_SET_TIOCM
, &
Êags
);

535 
	`qemu_mod_timî
(
s
->
modem_°©us_pﬁl
, 
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ s->
ch¨_å™smô_time
 );

544 
s
->
s¸
 = 
vÆ
;

547 
	}
}

549 
uöt32_t
 
	$£rül_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

551 
SîülSèã
 *
s
 = 
›aque
;

552 
uöt32_t
 
ªt
;

554 
addr
 &= 7;

555 
addr
) {

558 i‡(
s
->
l¸
 & 
UART_LCR_DLAB
) {

559 
ªt
 = 
s
->
dividî
 & 0xff;

561 if(
s
->
f¸
 & 
UART_FCR_FE
) {

562 
ªt
 = 
	`fifo_gë
(
s
,
RECV_FIFO
);

563 i‡–
s
->
ªcv_fifo
.
cou¡
 == 0 )

564 
s
->
l§
 &~(
UART_LSR_DR
 | 
UART_LSR_BI
);

566 
	`qemu_mod_timî
(
s
->
fifo_timeout_timî
, 
	`qemu_gë_˛ock
 (
vm_˛ock
Ë+ s->
ch¨_å™smô_time
 * 4 );

567 
s
->
timeout_ùídög
 = 0;

569 
ªt
 = 
s
->
rbr
;

570 
s
->
l§
 &~(
UART_LSR_DR
 | 
UART_LSR_BI
);

572 
	`£rül_upd©e_úq
(
s
);

576 i‡(
s
->
l¸
 & 
UART_LCR_DLAB
) {

577 
ªt
 = (
s
->
dividî
 >> 8) & 0xff;

579 
ªt
 = 
s
->
õr
;

583 
ªt
 = 
s
->
iú
;

584 
s
->
thr_ùídög
 = 0;

585 
	`£rül_upd©e_úq
(
s
);

588 
ªt
 = 
s
->
l¸
;

591 
ªt
 = 
s
->
m¸
;

594 
	`£rül_gë_tokí
();

595 
ªt
 = 
s
->
l§
;

597 i‡–
s
->
l§
 & 
UART_LSR_BI
 ) {

598 
s
->
l§
 &~
UART_LSR_BI
;

599 
	`£rül_upd©e_úq
(
s
);

603 
	`£rül_gë_tokí
();

604 i‡(
s
->
m¸
 & 
UART_MCR_LOOP
) {

607 
ªt
 = (
s
->
m¸
 & 0x0c) << 4;

608 
ªt
 |(
s
->
m¸
 & 0x02) << 3;

609 
ªt
 |(
s
->
m¸
 & 0x01) << 5;

611 i‡–
s
->
pﬁl_m¶
 >= 0 )

612 
	`£rül_upd©e_m¶
(
s
);

613 
ªt
 = 
s
->
m§
;

615 i‡–
s
->
m§
 & 
UART_MSR_ANY_DELTA
 ) {

616 
s
->
m§
 &= 0xF0;

617 
	`£rül_upd©e_úq
(
s
);

622 
ªt
 = 
s
->
s¸
;

625 #ifde‡
DEBUG_SERIAL


626 
	`¥ötf
("£rül:Ñódáddr=0x%02x vÆ=0x%02x\n", 
addr
, 
ªt
);

628  
ªt
;

629 
	}
}

631 
	$£rül_ˇn_ª˚ive
(
SîülSèã
 *
s
)

633 if(
s
->
f¸
 & 
UART_FCR_FE
) {

634 if(
s
->
ªcv_fifo
.
cou¡
 < 
UART_FIFO_LENGTH
)

638  ( 
s
->
ªcv_fifo
.
cou¡
 <s->ªcv_fifo.
ôl
 ) ? s->recv_fifo.itl - s->recv_fifo.count : 1;

642  !(
s
->
l§
 & 
UART_LSR_DR
);

644 
	}
}

646 
	$£rül_ª˚ive_bªak
(
SîülSèã
 *
s
)

648 
s
->
rbr
 = 0;

649 
s
->
l§
 |
UART_LSR_BI
 | 
UART_LSR_DR
;

650 
	`£rül_upd©e_úq
(
s
);

651 
	}
}

654 
	$fifo_timeout_öt
 (*
›aque
) {

655 
SîülSèã
 *
s
 = 
›aque
;

656 i‡–
s
->
ªcv_fifo
.
cou¡
 ) {

657 
s
->
timeout_ùídög
 = 1;

658 
	`£rül_upd©e_úq
(
s
);

660 
	}
}

662 
	$£rül_ˇn_ª˚ive1
(*
›aque
)

664 
SîülSèã
 *
s
 = 
›aque
;

665  
	`£rül_ˇn_ª˚ive
(
s
);

666 
	}
}

668 
	$£rül_ª˚ive1
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
size
)

670 
SîülSèã
 *
s
 = 
›aque
;

671 
tokís_avaû
 = 
TOKENS_MAX
;

672 if(
s
->
f¸
 & 
UART_FCR_FE
) {

673 
i
;

674 
i
 = 0; i < 
size
; i++) {

675 
	`fifo_put
(
s
, 
RECV_FIFO
, 
buf
[
i
]);

677 
s
->
l§
 |
UART_LSR_DR
;

679 
	`qemu_mod_timî
(
s
->
fifo_timeout_timî
, 
	`qemu_gë_˛ock
 (
vm_˛ock
Ë+ s->
ch¨_å™smô_time
 * 4);

681 
s
->
rbr
 = 
buf
[0];

682 
s
->
l§
 |
UART_LSR_DR
;

684 
	`£rül_upd©e_úq
(
s
);

685 
	}
}

687 
	$£rül_evít
(*
›aque
, 
evít
)

689 
SîülSèã
 *
s
 = 
›aque
;

690 
tokís_avaû
 = 
TOKENS_MAX
;

691 i‡(
evít
 =
CHR_EVENT_BREAK
)

692 
	`£rül_ª˚ive_bªak
(
s
);

693 
	}
}

695 
	$£rül_ßve
(
QEMUFûe
 *
f
, *
›aque
)

697 
SîülSèã
 *
s
 = 
›aque
;

699 
	`qemu_put_be16s
(
f
,&
s
->
dividî
);

700 
	`qemu_put_8s
(
f
,&
s
->
rbr
);

701 
	`qemu_put_8s
(
f
,&
s
->
õr
);

702 
	`qemu_put_8s
(
f
,&
s
->
iú
);

703 
	`qemu_put_8s
(
f
,&
s
->
l¸
);

704 
	`qemu_put_8s
(
f
,&
s
->
m¸
);

705 
	`qemu_put_8s
(
f
,&
s
->
l§
);

706 
	`qemu_put_8s
(
f
,&
s
->
m§
);

707 
	`qemu_put_8s
(
f
,&
s
->
s¸
);

708 
	`qemu_gë_8s
(
f
,&
s
->
f¸
);

709 
	}
}

711 
	$£rül_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

713 
SîülSèã
 *
s
 = 
›aque
;

715 if(
vîsi⁄_id
 > 2)

716  -
EINVAL
;

718 i‡(
vîsi⁄_id
 >= 2)

719 
	`qemu_gë_be16s
(
f
, &
s
->
dividî
);

721 
s
->
dividî
 = 
	`qemu_gë_byã
(
f
);

722 
	`qemu_gë_8s
(
f
,&
s
->
rbr
);

723 
	`qemu_gë_8s
(
f
,&
s
->
õr
);

724 
	`qemu_gë_8s
(
f
,&
s
->
iú
);

725 
	`qemu_gë_8s
(
f
,&
s
->
l¸
);

726 
	`qemu_gë_8s
(
f
,&
s
->
m¸
);

727 
	`qemu_gë_8s
(
f
,&
s
->
l§
);

728 
	`qemu_gë_8s
(
f
,&
s
->
m§
);

729 
	`qemu_gë_8s
(
f
,&
s
->
s¸
);

730 
	`qemu_gë_8s
(
f
,&
s
->
f¸
);

733 
	}
}

736 
SîülSèã
 *
	$£rül_öô
(
SëIRQFunc
 *
£t_úq
, *
›aque
,

737 
ba£
, 
úq
, 
Ch¨DrivîSèã
 *
chr
)

739 
SîülSèã
 *
s
;

741 
s
 = 
	`qemu_mÆlocz
((
SîülSèã
));

742 i‡(!
s
)

743  
NULL
;

744 
s
->
£t_úq
 = set_irq;

745 
s
->
úq_›aque
 = 
›aque
;

746 
s
->
úq
 = irq;

747 
s
->
õr
 = 0;

748 
s
->
l§
 = 
UART_LSR_TEMT
 | 
UART_LSR_THRE
;

749 
s
->
iú
 = 
UART_IIR_NO_INT
;

750 
s
->
m¸
 = 
UART_MCR_OUT2
;

751 
s
->
m§
 = 
UART_MSR_DCD
 | 
UART_MSR_DSR
 | 
UART_MSR_CTS
;

753 
s
->
dividî
 = 0x0C;

754 
s
->
t§_ªåy
 = 0;

755 
s
->
ch¨_å™smô_time
 = ( 
ticks_≥r_£c
 / 9600 ) * 9;

757 
s
->
modem_°©us_pﬁl
 = 
	`qemu_√w_timî
(
vm_˛ock
, ( 
QEMUTimîCB
 *Ë
£rül_upd©e_m¶
, s);

759 
s
->
pﬁl_m¶
 = 0;

761 
	`fifo_˛ór
(
s
,
RECV_FIFO
);

762 
	`fifo_˛ór
(
s
,
XMIT_FIFO
);

763 
s
->
œ°_xmô_ts
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

764 
s
->
fifo_timeout_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, ( 
QEMUTimîCB
 *Ë
fifo_timeout_öt
, s);

765 
s
->
å™smô_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, ( 
QEMUTimîCB
 *Ë
£rül_xmô
, s);

767 
	`ªgi°î_ßvevm
("£rül", 
ba£
, 2, 
£rül_ßve
, 
£rül_lﬂd
, 
s
);

769 
	`ªgi°î_i›‹t_wrôe
(
ba£
, 8, 1, 
£rül_i›‹t_wrôe
, 
s
);

770 
	`ªgi°î_i›‹t_ªad
(
ba£
, 8, 1, 
£rül_i›‹t_ªad
, 
s
);

771 
s
->
chr
 = chr;

772 
	`qemu_chr_add_h™dÀrs
(
chr
, 
£rül_ˇn_ª˚ive1
, 
£rül_ª˚ive1
,

773 
£rül_evít
, 
s
);

774 
	`£rül_upd©e_m¶
(
s
);

775  
s
;

776 
	}
}

	@sh7750.c

24 
	~<°dio.h
>

25 
	~<as£π.h
>

26 
	~"vl.h
"

27 
	~"sh7750_ªgs.h
"

28 
	~"sh7750_ªg«mes.h
"

31 
uöt8_t
 
	md©a
[16];

32 
uöt8_t
 
	mÀngth
;

33 
uöt8_t
 
	mwrôe_idx
;

34 
uöt8_t
 
	mªad_idx
;

35 } 
	tfifo
;

37 
	#NB_DEVICES
 4

	)

39 
	sSH7750Sèã
 {

41 
CPUSH4Sèã
 *
	m˝u
;

43 
uöt32_t
 
	m≥rùh_‰eq
;

45 
uöt16_t
 
	mrf¸
;

47 
Ch¨DrivîSèã
 *
	m£rül1
;

48 
uöt8_t
 
	mscs¸1
;

49 
uöt8_t
 
	mscsmr1
;

50 
uöt8_t
 
	mscbº1
;

51 
uöt8_t
 
	mscs§1
;

52 
uöt8_t
 
	mscs§1_ªad
;

53 
uöt8_t
 
	ms˘§1
;

54 
uöt8_t
 
	ms˘§1_lﬂded
;

55 
uöt8_t
 
	ms˘dr1
;

56 
uöt8_t
 
	ms¸dr1
;

58 
Ch¨DrivîSèã
 *
	m£rül2
;

59 
uöt16_t
 
	ms˛§2
;

60 
uöt16_t
 
	mscs¸2
;

61 
uöt16_t
 
	mscf¸2
;

62 
uöt16_t
 
	mscf§2
;

63 
uöt16_t
 
	mscsmr2
;

64 
uöt8_t
 
	mscbº2
;

65 
fifo
 
	m£rül2_ª˚ive_fifo
;

66 
fifo
 
	m£rül2_å™smô_fifo
;

68 
uöt8_t
 
	mt°r
;

70 
QEMUTimî
 *
	mtimî0
;

71 
uöt16_t
 
	mt¸0
;

72 
uöt32_t
 
	mtc‹0
;

73 
uöt32_t
 
	mt˙t0
;

75 
uöt16_t
 
	mgpioic
;

76 
uöt32_t
 
	mp˘ø
;

77 
uöt32_t
 
	mp˘rb
;

78 
uöt16_t
 
	mp‹tdúa
;

79 
uöt16_t
 
	mp‹çuŒu∑
;

80 
uöt16_t
 
	mp‹tdúb
;

81 
uöt16_t
 
	mp‹çuŒupb
;

82 
uöt16_t
 
	mpdåa
;

83 
uöt16_t
 
	mpdåb
;

84 
uöt16_t
 
	m≥rùh_pdåa
;

85 
uöt16_t
 
	m≥rùh_p‹tdúa
;

86 
uöt16_t
 
	m≥rùh_pdåb
;

87 
uöt16_t
 
	m≥rùh_p‹tdúb
;

88 
sh7750_io_devi˚
 *
	mdevi˚s
[
NB_DEVICES
];

90 
uöt32_t
 
	mc¸
;

91 } 
	tSH7750Sèã
;

101 
	$°¨t_timî0
(
SH7750Sèã
 * 
s
)

103 
uöt64_t
 
now
, 
√xt
, 
¥esˇÀr
;

105 i‡((
s
->
t¸0
 & 6) == 6) {

106 
	`Ârötf
(
°dîr
, "rtc clock forÅimer 0Çot supported\n");

107 
	`as£π
(0);

110 i‡((
s
->
t¸0
 & 7) == 5) {

111 
	`Ârötf
(
°dîr
, "timer 0 configurationÇot supported\n");

112 
	`as£π
(0);

115 i‡((
s
->
t¸0
 & 4) == 4)

116 
¥esˇÀr
 = 1024;

118 
¥esˇÀr
 = 4 << (
s
->
t¸0
 & 3);

120 
now
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

122 
√xt
 =

123 
now
 + 
	`muldiv64
(
¥esˇÀr
 * 
s
->
t˙t0
, 
ticks_≥r_£c
,

124 
s
->
≥rùh_‰eq
);

125 i‡(
√xt
 =
now
)

126 
√xt
 = 
now
 + 1;

127 
	`Ârötf
(
°dîr
, "now=%016" 
PRIx64
 ",Çext=%016" PRIx64 "\n", 
now
, 
√xt
);

128 
	`Ârötf
(
°dîr
, "timer will underflow in %f seconds\n",

129 (Ë(
√xt
 - 
now
Ë/ (Ë
ticks_≥r_£c
);

131 
	`qemu_mod_timî
(
s
->
timî0
, 
√xt
);

132 
	}
}

134 
	$timî_°¨t_ch™ged
(
SH7750Sèã
 * 
s
)

136 i‡(
s
->
t°r
 & 
SH7750_TSTR_STR0
) {

137 
	`°¨t_timî0
(
s
);

139 
	`Ârötf
(
°dîr
, "timer 0 is stopped\n");

140 
	`qemu_dñ_timî
(
s
->
timî0
);

142 
	}
}

144 
	$timî0_cb
(*
›aque
)

146 
SH7750Sèã
 *
s
 = 
›aque
;

148 
s
->
t˙t0
 = (
uöt32_t
) 0;

149 i‡(--
s
->
t˙t0
 =(
uöt32_t
) - 1) {

150 
	`Ârötf
(
°dîr
, "timer 0 underflow\n");

151 
s
->
t˙t0
 = s->
tc‹0
;

152 
s
->
t¸0
 |
SH7750_TCR_UNF
;

153 i‡(
s
->
t¸0
 & 
SH7750_TCR_UNIE
) {

154 
	`Ârötf
(
°dîr
,

156 
	`as£π
(0);

159 
	`°¨t_timî0
(
s
);

160 
	}
}

162 
	$öô_timîs
(
SH7750Sèã
 * 
s
)

164 
s
->
tc‹0
 = 0xffffffff;

165 
s
->
t˙t0
 = 0xffffffff;

166 
s
->
timî0
 = 
	`qemu_√w_timî
(
vm_˛ock
, &
timî0_cb
, s);

167 
	}
}

173 
	$£rül1_ˇn_ª˚ive
(*
›aque
)

175 
SH7750Sèã
 *
s
 = 
›aque
;

177  
s
->
scs¸1
 & 
SH7750_SCSCR_RE
;

178 
	}
}

180 
	$£rül1_ª˚ive_ch¨
(
SH7750Sèã
 * 
s
, 
uöt8_t
 
c
)

182 i‡(
s
->
scs§1
 & 
SH7750_SCSSR1_RDRF
) {

183 
s
->
scs§1
 |
SH7750_SCSSR1_ORER
;

187 
s
->
s¸dr1
 = 
c
;

188 
s
->
scs§1
 |
SH7750_SCSSR1_RDRF
;

189 
	}
}

191 
	$£rül1_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 * 
buf
, 
size
)

193 
SH7750Sèã
 *
s
 = 
›aque
;

194 
i
;

196 
i
 = 0; i < 
size
; i++) {

197 
	`£rül1_ª˚ive_ch¨
(
s
, 
buf
[
i
]);

199 
	}
}

201 
	$£rül1_evít
(*
›aque
, 
evít
)

203 
	`as£π
(0);

204 
	}
}

206 
	$£rül1_maybe_£nd
(
SH7750Sèã
 * 
s
)

208 
uöt8_t
 
c
;

210 i‡(
s
->
scs§1
 & 
SH7750_SCSSR1_TDRE
)

212 
c
 = 
s
->
s˘dr1
;

213 
s
->
scs§1
 |
SH7750_SCSSR1_TDRE
 | 
SH7750_SCSSR1_TEND
;

214 i‡(
s
->
scs¸1
 & 
SH7750_SCSCR_TIE
) {

215 
	`Ârötf
(
°dîr
, "interrupts for serialÖort 1Çot implemented\n");

216 
	`as£π
(0);

219 
	`qemu_chr_wrôe
(
s
->
£rül1
, &
c
, 1);

220 
	}
}

222 
	$£rül1_ch™ge_scs§1
(
SH7750Sèã
 * 
s
, 
uöt8_t
 
mem_vÆue
)

224 
uöt8_t
 
√w_Êags
;

227 i‡((
s
->
scs¸1
 & 
SH7750_SCSCR_TE
) == 0) {

228 
mem_vÆue
 |
SH7750_SCSSR1_TDRE
 | 
SH7750_SCSSR1_TEND
;

233 
√w_Êags
 = 
s
->
scs§1
 & ~s->
scs§1_ªad
;

234 
√w_Êags
 &
mem_vÆue
 | ~
s
->
scs§1_ªad
;

236 
s
->
scs§1
 = (
√w_Êags
 & 0xf8Ë| (
mem_vÆue
 & 1);

237 
s
->
scs§1_ªad
 &
mem_vÆue
;

240 i‡((
s
->
scs§1
 & 
SH7750_SCSSR1_TDRE
) == 0) {

241 
s
->
scs§1
 &~
SH7750_SCSSR1_TEND
;

245 
	`£rül1_maybe_£nd
(
s
);

246 
	}
}

248 
	$£rül1_upd©e_∑ømëîs
(
SH7750Sèã
 * 
s
)

250 
QEMUSîülSëP¨ams
 
s•
;

252 i‡(
s
->
scsmr1
 & 
SH7750_SCSMR_CHR_7
)

253 
s•
.
d©a_bôs
 = 7;

255 
s•
.
d©a_bôs
 = 8;

256 i‡(
s
->
scsmr1
 & 
SH7750_SCSMR_PE
) {

257 i‡(
s
->
scsmr1
 & 
SH7750_SCSMR_PM_ODD
)

258 
s•
.
∑rôy
 = 'O';

260 
s•
.
∑rôy
 = 'E';

262 
s•
.
∑rôy
 = 'N';

263 i‡(
s
->
scsmr1
 & 
SH7750_SCSMR_STOP_2
)

264 
s•
.
°›_bôs
 = 2;

266 
s•
.
°›_bôs
 = 1;

267 
	`Ârötf
(
°dîr
, "SCSMR1=%04x SCBRR1=%02x\n", 
s
->
scsmr1
, s->
scbº1
);

268 
s•
.
•ìd
 = 
s
->
≥rùh_‰eq
 /

269 (32 * 
s
->
scbº1
 * (1 << (2 * (s->
scsmr1
 & 3)))) - 1;

270 
	`Ârötf
(
°dîr
, "data bits=%d, stop bits=%d,Öarity=%c, speed=%d\n",

271 
s•
.
d©a_bôs
, s•.
°›_bôs
, s•.
∑rôy
, s•.
•ìd
);

272 
	`qemu_chr_io˘l
(
s
->
£rül1
, 
CHR_IOCTL_SERIAL_SET_PARAMS
, &
s•
);

273 
	}
}

275 
	$scs¸1_ch™ged
(
SH7750Sèã
 * 
s
)

277 i‡(
s
->
scs¸1
 & (
SH7750_SCSCR_TE
 | 
SH7750_SCSCR_RE
)) {

278 i‡(!
s
->
£rül1
) {

279 
	`Ârötf
(
°dîr
, "serialÖort 1Çot boundÅoánything\n");

280 
	`as£π
(0);

282 
	`£rül1_upd©e_∑ømëîs
(
s
);

284 i‡((
s
->
scs¸1
 & 
SH7750_SCSCR_RE
) == 0) {

285 
s
->
scs§1
 |
SH7750_SCSSR1_TDRE
;

287 
	}
}

289 
	$öô_£rül1
(
SH7750Sèã
 * 
s
, 
£rül_nb
)

291 
Ch¨DrivîSèã
 *
chr
;

293 
s
->
scs§1
 = 0x84;

294 
chr
 = 
£rül_hds
[
£rül_nb
];

295 i‡(!
chr
) {

296 
	`Ârötf
(
°dîr
,

301 
s
->
£rül1
 = 
chr
;

302 
	`qemu_chr_add_h™dÀrs
(
chr
, 
£rül1_ˇn_ª˚ive
,

303 
£rül1_ª˚ive
, 
£rül1_evít
, 
s
);

304 
	}
}

310 
	$£rül2_ˇn_ª˚ive
(*
›aque
)

312 
SH7750Sèã
 *
s
 = 
›aque
;

313 
uöt8_t
 
max_fifo_size
[] = { 15, 1, 4, 6, 8, 10, 12, 14 };

315  
s
->
£rül2_ª˚ive_fifo
.
Àngth
 <

316 
max_fifo_size
[(
s
->
scf¸2
 >> 9) & 7];

317 
	}
}

319 
	$£rül2_adju°_ª˚ive_Êags
(
SH7750Sèã
 * 
s
)

321 
uöt8_t
 
max_fifo_size
[] = { 1, 4, 8, 14 };

324 i‡(
s
->
£rül2_ª˚ive_fifo
.
Àngth
 >=

325 
max_fifo_size
[(
s
->
scf¸2
 >> 7) & 3]) {

326 
s
->
scf§2
 |
SH7750_SCFSR2_RDF
;

327 
s
->
scf§2
 &~
SH7750_SCFSR2_DR
;

329 
s
->
scf§2
 &~
SH7750_SCFSR2_RDF
;

330 i‡(
s
->
£rül2_ª˚ive_fifo
.
Àngth
 > 0)

331 
s
->
scf§2
 |
SH7750_SCFSR2_DR
;

333 
s
->
scf§2
 &~
SH7750_SCFSR2_DR
;

335 
	}
}

337 
	$£rül2_≠≥nd_ch¨
(
SH7750Sèã
 * 
s
, 
uöt8_t
 
c
)

339 i‡(
s
->
£rül2_ª˚ive_fifo
.
Àngth
 == 16) {

341 
s
->
s˛§2
 |
SH7750_SCLSR2_ORER
;

345 
s
->
£rül2_ª˚ive_fifo
.
d©a
[s->£rül2_ª˚ive_fifo.
wrôe_idx
++] = 
c
;

346 
s
->
£rül2_ª˚ive_fifo
.
Àngth
++;

347 
	`£rül2_adju°_ª˚ive_Êags
(
s
);

348 
	}
}

350 
	$£rül2_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 * 
buf
, 
size
)

352 
SH7750Sèã
 *
s
 = 
›aque
;

353 
i
;

355 
i
 = 0; i < 
size
; i++)

356 
	`£rül2_≠≥nd_ch¨
(
s
, 
buf
[
i
]);

357 
	}
}

359 
	$£rül2_evít
(*
›aque
, 
evít
)

362 
	`as£π
(0);

363 
	}
}

365 
	$£rül2_upd©e_∑ømëîs
(
SH7750Sèã
 * 
s
)

367 
QEMUSîülSëP¨ams
 
s•
;

369 i‡(
s
->
scsmr2
 & 
SH7750_SCSMR_CHR_7
)

370 
s•
.
d©a_bôs
 = 7;

372 
s•
.
d©a_bôs
 = 8;

373 i‡(
s
->
scsmr2
 & 
SH7750_SCSMR_PE
) {

374 i‡(
s
->
scsmr2
 & 
SH7750_SCSMR_PM_ODD
)

375 
s•
.
∑rôy
 = 'O';

377 
s•
.
∑rôy
 = 'E';

379 
s•
.
∑rôy
 = 'N';

380 i‡(
s
->
scsmr2
 & 
SH7750_SCSMR_STOP_2
)

381 
s•
.
°›_bôs
 = 2;

383 
s•
.
°›_bôs
 = 1;

384 
	`Ârötf
(
°dîr
, "SCSMR2=%04x SCBRR2=%02x\n", 
s
->
scsmr2
, s->
scbº2
);

385 
s•
.
•ìd
 = 
s
->
≥rùh_‰eq
 /

386 (32 * 
s
->
scbº2
 * (1 << (2 * (s->
scsmr2
 & 3)))) - 1;

387 
	`Ârötf
(
°dîr
, "data bits=%d, stop bits=%d,Öarity=%c, speed=%d\n",

388 
s•
.
d©a_bôs
, s•.
°›_bôs
, s•.
∑rôy
, s•.
•ìd
);

389 
	`qemu_chr_io˘l
(
s
->
£rül2
, 
CHR_IOCTL_SERIAL_SET_PARAMS
, &
s•
);

390 
	}
}

392 
	$scs¸2_ch™ged
(
SH7750Sèã
 * 
s
)

394 i‡(
s
->
scs¸2
 & (
SH7750_SCSCR_TE
 | 
SH7750_SCSCR_RE
)) {

395 i‡(!
s
->
£rül2
) {

396 
	`Ârötf
(
°dîr
, "serialÖort 2Çot boundÅoánything\n");

397 
	`as£π
(0);

399 
	`£rül2_upd©e_∑ømëîs
(
s
);

401 
	}
}

403 
	$öô_£rül2
(
SH7750Sèã
 * 
s
, 
£rül_nb
)

405 
Ch¨DrivîSèã
 *
chr
;

407 
s
->
scf§2
 = 0x0060;

409 
chr
 = 
£rül_hds
[
£rül_nb
];

410 i‡(!
chr
) {

411 
	`Ârötf
(
°dîr
,

416 
s
->
£rül2
 = 
chr
;

417 
	`qemu_chr_add_h™dÀrs
(
chr
, 
£rül2_ˇn_ª˚ive
,

418 
£rül2_ª˚ive
, 
£rül1_evít
, 
s
);

419 
	}
}

421 
	$öô_£rül_p‹ts
(
SH7750Sèã
 * 
s
)

423 
	`öô_£rül1
(
s
, 0);

424 
	`öô_£rül2
(
s
, 1);

425 
	}
}

431 
	$sh7750_ªgi°î_io_devi˚
(
SH7750Sèã
 * 
s
, 
sh7750_io_devi˚
 * 
devi˚
)

433 
i
;

435 
i
 = 0; i < 
NB_DEVICES
; i++) {

436 i‡(
s
->
devi˚s
[
i
] =
NULL
) {

437 
s
->
devi˚s
[
i
] = 
devi˚
;

442 
	}
}

444 
uöt16_t
 
	$p‹tdú
(
uöt32_t
 
v
)

446 
	#EVENPORTMASK
(
n
Ë((
v
 & (1<<(“)<<1))Ë>> (n))

	)

448 
	`EVENPORTMASK
(15) | EVENPORTMASK(14) | EVENPORTMASK(13) |

449 
	`EVENPORTMASK
(12) | EVENPORTMASK(11) | EVENPORTMASK(10) |

450 
	`EVENPORTMASK
(9) | EVENPORTMASK(8) | EVENPORTMASK(7) |

451 
	`EVENPORTMASK
(6) | EVENPORTMASK(5) | EVENPORTMASK(4) |

452 
	`EVENPORTMASK
(3) | EVENPORTMASK(2) | EVENPORTMASK(1) |

453 
	`EVENPORTMASK
(0);

454 
	}
}

456 
uöt16_t
 
	$p‹çuŒup
(
uöt32_t
 
v
)

458 
	#ODDPORTMASK
(
n
Ë((
v
 & (1<<((“)<<1)+1))Ë>> (n))

	)

460 
	`ODDPORTMASK
(15) | ODDPORTMASK(14) | ODDPORTMASK(13) |

461 
	`ODDPORTMASK
(12) | ODDPORTMASK(11) | ODDPORTMASK(10) |

462 
	`ODDPORTMASK
(9) | ODDPORTMASK(8) | ODDPORTMASK(7) | ODDPORTMASK(6) |

463 
	`ODDPORTMASK
(5) | ODDPORTMASK(4) | ODDPORTMASK(3) | ODDPORTMASK(2) |

464 
	`ODDPORTMASK
(1) | ODDPORTMASK(0);

465 
	}
}

467 
uöt16_t
 
	$p‹è_löes
(
SH7750Sèã
 * 
s
)

469  (
s
->
p‹tdúa
 & s->
pdåa
) |

470 (
s
->
≥rùh_p‹tdúa
 & s->
≥rùh_pdåa
) |

471 (~(
s
->
p‹tdúa
 | s->
≥rùh_p‹tdúa
Ë& s->
p‹çuŒu∑
);

472 
	}
}

474 
uöt16_t
 
	$p‹tb_löes
(
SH7750Sèã
 * 
s
)

476  (
s
->
p‹tdúb
 & s->
pdåb
) |

477 (
s
->
≥rùh_p‹tdúb
 & s->
≥rùh_pdåb
) |

478 (~(
s
->
p‹tdúb
 | s->
≥rùh_p‹tdúb
Ë& s->
p‹çuŒupb
);

479 
	}
}

481 
	$gí_p‹t_öãºu±s
(
SH7750Sèã
 * 
s
)

484 
	}
}

486 
	$p‹è_ch™ged
(
SH7750Sèã
 * 
s
, 
uöt16_t
 
¥ev
)

488 
uöt16_t
 
cuºíè
, 
ch™ges
;

489 
i
, 
r
 = 0;

492 
	`Ârötf
(
°dîr
, "porta changed from 0x%04xÅo 0x%04x\n",

493 
¥ev
, 
	`p‹è_löes
(
s
));

494 
	`Ârötf
(
°dîr
, "pdåa=0x%04x,Ö˘ø=0x%08x\n", 
s
->
pdåa
, s->
p˘ø
);

496 
cuºíè
 = 
	`p‹è_löes
(
s
);

497 i‡(
cuºíè
 =
¥ev
)

499 
ch™ges
 = 
cuºíè
 ^ 
¥ev
;

501 
i
 = 0; i < 
NB_DEVICES
; i++) {

502 i‡(
s
->
devi˚s
[
i
] && (s->devi˚s[i]->
p‹èmask_åiggî
 & 
ch™ges
)) {

503 
r
 |
s
->
devi˚s
[
i
]->
	`p‹t_ch™ge_cb
(
cuºíè
, 
	`p‹tb_löes
(s),

504 &
s
->
≥rùh_pdåa
,

505 &
s
->
≥rùh_p‹tdúa
,

506 &
s
->
≥rùh_pdåb
,

507 &
s
->
≥rùh_p‹tdúb
);

511 i‡(
r
)

512 
	`gí_p‹t_öãºu±s
(
s
);

513 
	}
}

515 
	$p‹tb_ch™ged
(
SH7750Sèã
 * 
s
, 
uöt16_t
 
¥ev
)

517 
uöt16_t
 
cuºítb
, 
ch™ges
;

518 
i
, 
r
 = 0;

520 
cuºítb
 = 
	`p‹tb_löes
(
s
);

521 i‡(
cuºítb
 =
¥ev
)

523 
ch™ges
 = 
cuºítb
 ^ 
¥ev
;

525 
i
 = 0; i < 
NB_DEVICES
; i++) {

526 i‡(
s
->
devi˚s
[
i
] && (s->devi˚s[i]->
p‹tbmask_åiggî
 & 
ch™ges
)) {

527 
r
 |
s
->
devi˚s
[
i
]->
	`p‹t_ch™ge_cb
(
	`p‹tb_löes
(s), 
cuºítb
,

528 &
s
->
≥rùh_pdåa
,

529 &
s
->
≥rùh_p‹tdúa
,

530 &
s
->
≥rùh_pdåb
,

531 &
s
->
≥rùh_p‹tdúb
);

535 i‡(
r
)

536 
	`gí_p‹t_öãºu±s
(
s
);

537 
	}
}

543 
	$îr‹_ac˚ss
(c⁄° *
köd
, 
èrgë_phys_addr_t
 
addr
)

545 
	`Ârötf
(
°dîr
, "%sÅo %s (0x%08x)Çot supported\n",

546 
köd
, 
	`ªg«me
(
addr
),áddr);

547 
	}
}

549 
	$ign‹e_ac˚ss
(c⁄° *
köd
, 
èrgë_phys_addr_t
 
addr
)

551 
	`Ârötf
(
°dîr
, "%sÅo %s (0x%08x) ignored\n",

552 
köd
, 
	`ªg«me
(
addr
),áddr);

553 
	}
}

555 
uöt32_t
 
	$sh7750_mem_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

557 
SH7750Sèã
 *
s
 = 
›aque
;

558 
uöt8_t
 
r
;

560 
addr
) {

561 
SH7750_SCSSR1_A7
:

562 
r
 = 
s
->
scs§1
;

563 
s
->
scs§1_ªad
 |
r
;

564  
s
->
scs§1
;

565 
SH7750_SCRDR1_A7
:

566 
s
->
scs§1
 &~
SH7750_SCSSR1_RDRF
;

567  
s
->
s¸dr1
;

569 
	`îr‹_ac˚ss
("byãÑód", 
addr
);

570 
	`as£π
(0);

572 
	}
}

574 
uöt32_t
 
	$sh7750_mem_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

576 
SH7750Sèã
 *
s
 = 
›aque
;

577 
uöt16_t
 
r
;

579 
addr
) {

580 
SH7750_RFCR_A7
:

581 
	`Ârötf
(
°dîr
,

583  
s
->
rf¸
++;

584 
SH7750_TCR0_A7
:

585  
s
->
t¸0
;

586 
SH7750_SCLSR2_A7
:

588 
r
 = 
s
->
s˛§2
;

589 
s
->
s˛§2
 = 0;

590  
r
;

591 
SH7750_SCSFR2_A7
:

592  
s
->
scf§2
;

593 
SH7750_PDTRA_A7
:

594  
	`p‹è_löes
(
s
);

595 
SH7750_PDTRB_A7
:

596  
	`p‹tb_löes
(
s
);

598 
	`îr‹_ac˚ss
("w‹dÑód", 
addr
);

599 
	`as£π
(0);

601 
	}
}

603 
uöt32_t
 
	$sh7750_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

605 
SH7750Sèã
 *
s
 = 
›aque
;

607 
addr
) {

608 
SH7750_MMUCR_A7
:

609  
s
->
˝u
->
mmu¸
;

610 
SH7750_PTEH_A7
:

611  
s
->
˝u
->
±eh
;

612 
SH7750_PTEL_A7
:

613  
s
->
˝u
->
±ñ
;

614 
SH7750_TTB_A7
:

615  
s
->
˝u
->
âb
;

616 
SH7750_TEA_A7
:

617  
s
->
˝u
->
ãa
;

618 
SH7750_TRA_A7
:

619  
s
->
˝u
->
åa
;

620 
SH7750_EXPEVT_A7
:

621  
s
->
˝u
->
ex≥vt
;

622 
SH7750_INTEVT_A7
:

623  
s
->
˝u
->
öãvt
;

624 
SH7750_CCR_A7
:

625  
s
->
c¸
;

633 
	`îr‹_ac˚ss
("l⁄gÑód", 
addr
);

634 
	`as£π
(0);

636 
	}
}

638 
	$sh7750_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

639 
uöt32_t
 
mem_vÆue
)

641 
SH7750Sèã
 *
s
 = 
›aque
;

643 
addr
) {

645 
SH7750_PRECHARGE0_A7
:

646 
SH7750_PRECHARGE1_A7
:

647 
	`ign‹e_ac˚ss
("byã wrôe", 
addr
);

649 
SH7750_SCBRR2_A7
:

650 
s
->
scbº2
 = 
mem_vÆue
;

652 
SH7750_TSTR_A7
:

653 
s
->
t°r
 = 
mem_vÆue
;

654 
	`timî_°¨t_ch™ged
(
s
);

656 
SH7750_SCSCR1_A7
:

657 
s
->
scs¸1
 = 
mem_vÆue
;

658 
	`scs¸1_ch™ged
(
s
);

660 
SH7750_SCSMR1_A7
:

661 
s
->
scsmr1
 = 
mem_vÆue
;

663 
SH7750_SCBRR1_A7
:

664 
s
->
scbº1
 = 
mem_vÆue
;

666 
SH7750_SCTDR1_A7
:

667 
s
->
scs§1
 &~
SH7750_SCSSR1_TEND
;

668 
s
->
s˘dr1
 = 
mem_vÆue
;

670 
SH7750_SCSSR1_A7
:

671 
	`£rül1_ch™ge_scs§1
(
s
, 
mem_vÆue
);

674 
	`îr‹_ac˚ss
("byã wrôe", 
addr
);

675 
	`as£π
(0);

677 
	}
}

679 
	$sh7750_mem_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

680 
uöt32_t
 
mem_vÆue
)

682 
SH7750Sèã
 *
s
 = 
›aque
;

683 
uöt16_t
 
ãmp
;

685 
addr
) {

687 
SH7750_SCBRR1_A7
:

688 
SH7750_SCBRR2_A7
:

689 
SH7750_BCR2_A7
:

690 
SH7750_BCR3_A7
:

691 
SH7750_RTCOR_A7
:

692 
SH7750_RTCNT_A7
:

693 
SH7750_RTCSR_A7
:

694 
	`ign‹e_ac˚ss
("w‹d wrôe", 
addr
);

697 
SH7750_PDTRA_A7
:

698 
ãmp
 = 
	`p‹è_löes
(
s
);

699 
s
->
pdåa
 = 
mem_vÆue
;

700 
	`p‹è_ch™ged
(
s
, 
ãmp
);

702 
SH7750_PDTRB_A7
:

703 
ãmp
 = 
	`p‹tb_löes
(
s
);

704 
s
->
pdåb
 = 
mem_vÆue
;

705 
	`p‹tb_ch™ged
(
s
, 
ãmp
);

707 
SH7750_RFCR_A7
:

708 
	`Ârötf
(
°dîr
, "WriteáccessÅoÑefresh countÑegister\n");

709 
s
->
rf¸
 = 
mem_vÆue
;

711 
SH7750_SCLSR2_A7
:

712 
s
->
s˛§2
 = 
mem_vÆue
;

714 
SH7750_SCSCR2_A7
:

715 
s
->
scs¸2
 = 
mem_vÆue
;

716 
	`scs¸2_ch™ged
(
s
);

718 
SH7750_SCFCR2_A7
:

719 
s
->
scf¸2
 = 
mem_vÆue
;

721 
SH7750_SCSMR2_A7
:

722 
s
->
scsmr2
 = 
mem_vÆue
;

724 
SH7750_TCR0_A7
:

725 
s
->
t¸0
 = 
mem_vÆue
;

727 
SH7750_GPIOIC_A7
:

728 
s
->
gpioic
 = 
mem_vÆue
;

729 i‡(
mem_vÆue
 != 0) {

730 
	`Ârötf
(
°dîr
, "I/O interruptsÇot implemented\n");

731 
	`as£π
(0);

735 
	`îr‹_ac˚ss
("w‹d wrôe", 
addr
);

736 
	`as£π
(0);

738 
	}
}

740 
	$sh7750_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

741 
uöt32_t
 
mem_vÆue
)

743 
SH7750Sèã
 *
s
 = 
›aque
;

744 
uöt16_t
 
ãmp
;

746 
addr
) {

748 
SH7750_BCR1_A7
:

749 
SH7750_BCR4_A7
:

750 
SH7750_WCR1_A7
:

751 
SH7750_WCR2_A7
:

752 
SH7750_WCR3_A7
:

753 
SH7750_MCR_A7
:

754 
	`ign‹e_ac˚ss
("l⁄g wrôe", 
addr
);

757 
SH7750_PCTRA_A7
:

758 
ãmp
 = 
	`p‹è_löes
(
s
);

759 
s
->
p˘ø
 = 
mem_vÆue
;

760 
s
->
p‹tdúa
 = 
	`p‹tdú
(
mem_vÆue
);

761 
s
->
p‹çuŒu∑
 = 
	`p‹çuŒup
(
mem_vÆue
);

762 
	`p‹è_ch™ged
(
s
, 
ãmp
);

764 
SH7750_PCTRB_A7
:

765 
ãmp
 = 
	`p‹tb_löes
(
s
);

766 
s
->
p˘rb
 = 
mem_vÆue
;

767 
s
->
p‹tdúb
 = 
	`p‹tdú
(
mem_vÆue
);

768 
s
->
p‹çuŒupb
 = 
	`p‹çuŒup
(
mem_vÆue
);

769 
	`p‹tb_ch™ged
(
s
, 
ãmp
);

771 
SH7750_TCNT0_A7
:

772 
s
->
t˙t0
 = 
mem_vÆue
 & 0xf;

774 
SH7750_MMUCR_A7
:

775 
s
->
˝u
->
mmu¸
 = 
mem_vÆue
;

777 
SH7750_PTEH_A7
:

778 
s
->
˝u
->
±eh
 = 
mem_vÆue
;

780 
SH7750_PTEL_A7
:

781 
s
->
˝u
->
±ñ
 = 
mem_vÆue
;

783 
SH7750_TTB_A7
:

784 
s
->
˝u
->
âb
 = 
mem_vÆue
;

786 
SH7750_TEA_A7
:

787 
s
->
˝u
->
ãa
 = 
mem_vÆue
;

789 
SH7750_TRA_A7
:

790 
s
->
˝u
->
åa
 = 
mem_vÆue
 & 0x000007ff;

792 
SH7750_EXPEVT_A7
:

793 
s
->
˝u
->
ex≥vt
 = 
mem_vÆue
 & 0x000007ff;

795 
SH7750_INTEVT_A7
:

796 
s
->
˝u
->
öãvt
 = 
mem_vÆue
 & 0x000007ff;

798 
SH7750_CCR_A7
:

799 
s
->
c¸
 = 
mem_vÆue
;

802 
	`îr‹_ac˚ss
("l⁄g wrôe", 
addr
);

803 
	`as£π
(0);

805 
	}
}

807 
CPURódMem‹yFunc
 *
	gsh7750_mem_ªad
[] = {

808 
sh7750_mem_ªadb
,

809 
sh7750_mem_ªadw
,

810 
sh7750_mem_ªadl


813 
CPUWrôeMem‹yFunc
 *
	gsh7750_mem_wrôe
[] = {

814 
sh7750_mem_wrôeb
,

815 
sh7750_mem_wrôew
,

816 
sh7750_mem_wrôñ


819 
SH7750Sèã
 *
	$sh7750_öô
(
CPUSH4Sèã
 * 
˝u
)

821 
SH7750Sèã
 *
s
;

822 
sh7750_io_mem‹y
;

824 
s
 = 
	`qemu_mÆlocz
((
SH7750Sèã
));

825 
s
->
˝u
 = cpu;

826 
s
->
≥rùh_‰eq
 = 60000000;

827 
sh7750_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0,

828 
sh7750_mem_ªad
,

829 
sh7750_mem_wrôe
, 
s
);

830 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x1c000000, 0x04000000, 
sh7750_io_mem‹y
);

831 
	`öô_timîs
(
s
);

832 
	`öô_£rül_p‹ts
(
s
);

833  
s
;

834 
	}
}

	@sh7750_regnames.c

1 
	~"vl.h
"

2 
	~"sh7750_ªgs.h
"

4 
	#REGNAME
(
r
Ë{r, #r},

	)

7 
uöt32_t
 
	mªgaddr
;

8 c⁄° *
	mªg«me
;

9 } 
	tªg«me_t
;

11 
ªg«me_t
 
	gªg«mes
[] = {

12 
REGNAME
(
SH7750_PTEH_A7
)

13 
REGNAME
(
SH7750_PTEL_A7
)

14 
REGNAME
(
SH7750_PTEA_A7
)

15 
REGNAME
(
SH7750_TTB_A7
)

16 
REGNAME
(
SH7750_TEA_A7
)

17 
REGNAME
(
SH7750_MMUCR_A7
)

18 
REGNAME
(
SH7750_CCR_A7
)

19 
REGNAME
(
SH7750_QACR0_A7
)

20 
REGNAME
(
SH7750_QACR1_A7
)

21 
REGNAME
(
SH7750_TRA_A7
)

22 
REGNAME
(
SH7750_EXPEVT_A7
)

23 
REGNAME
(
SH7750_INTEVT_A7
)

24 
REGNAME
(
SH7750_STBCR_A7
)

25 
REGNAME
(
SH7750_STBCR2_A7
)

26 
REGNAME
(
SH7750_FRQCR_A7
)

27 
REGNAME
(
SH7750_WTCNT_A7
)

28 
REGNAME
(
SH7750_WTCSR_A7
)

29 
REGNAME
(
SH7750_R64CNT_A7
)

30 
REGNAME
(
SH7750_RSECCNT_A7
)

31 
REGNAME
(
SH7750_RMINCNT_A7
)

32 
REGNAME
(
SH7750_RHRCNT_A7
)

33 
REGNAME
(
SH7750_RWKCNT_A7
)

34 
REGNAME
(
SH7750_RDAYCNT_A7
)

35 
REGNAME
(
SH7750_RMONCNT_A7
)

36 
REGNAME
(
SH7750_RYRCNT_A7
)

37 
REGNAME
(
SH7750_RSECAR_A7
)

38 
REGNAME
(
SH7750_RMINAR_A7
)

39 
REGNAME
(
SH7750_RHRAR_A7
)

40 
REGNAME
(
SH7750_RWKAR_A7
)

41 
REGNAME
(
SH7750_RDAYAR_A7
)

42 
REGNAME
(
SH7750_RMONAR_A7
)

43 
REGNAME
(
SH7750_RCR1_A7
)

44 
REGNAME
(
SH7750_RCR2_A7
)

45 
REGNAME
(
SH7750_TOCR_A7
)

46 
REGNAME
(
SH7750_TSTR_A7
)

47 
REGNAME
(
SH7750_TCOR0_A7
)

48 
REGNAME
(
SH7750_TCOR1_A7
)

49 
REGNAME
(
SH7750_TCOR2_A7
)

50 
REGNAME
(
SH7750_TCNT0_A7
)

51 
REGNAME
(
SH7750_TCNT1_A7
)

52 
REGNAME
(
SH7750_TCNT2_A7
)

53 
REGNAME
(
SH7750_TCR0_A7
)

54 
REGNAME
(
SH7750_TCR1_A7
)

55 
REGNAME
(
SH7750_TCR2_A7
)

56 
REGNAME
(
SH7750_TCPR2_A7
)

57 
REGNAME
(
SH7750_BCR1_A7
)

58 
REGNAME
(
SH7750_BCR2_A7
)

59 
REGNAME
(
SH7750_WCR1_A7
)

60 
REGNAME
(
SH7750_WCR2_A7
)

61 
REGNAME
(
SH7750_WCR3_A7
)

62 
REGNAME
(
SH7750_MCR_A7
)

63 
REGNAME
(
SH7750_PCR_A7
)

64 
REGNAME
(
SH7750_RTCSR_A7
)

65 
REGNAME
(
SH7750_RTCNT_A7
)

66 
REGNAME
(
SH7750_RTCOR_A7
)

67 
REGNAME
(
SH7750_RFCR_A7
)

68 
REGNAME
(
SH7750_SAR0_A7
)

69 
REGNAME
(
SH7750_SAR1_A7
)

70 
REGNAME
(
SH7750_SAR2_A7
)

71 
REGNAME
(
SH7750_SAR3_A7
)

72 
REGNAME
(
SH7750_DAR0_A7
)

73 
REGNAME
(
SH7750_DAR1_A7
)

74 
REGNAME
(
SH7750_DAR2_A7
)

75 
REGNAME
(
SH7750_DAR3_A7
)

76 
REGNAME
(
SH7750_DMATCR0_A7
)

77 
REGNAME
(
SH7750_DMATCR1_A7
)

78 
REGNAME
(
SH7750_DMATCR2_A7
)

79 
REGNAME
(
SH7750_DMATCR3_A7
)

80 
REGNAME
(
SH7750_CHCR0_A7
)

81 
REGNAME
(
SH7750_CHCR1_A7
)

82 
REGNAME
(
SH7750_CHCR2_A7
)

83 
REGNAME
(
SH7750_CHCR3_A7
)

84 
REGNAME
(
SH7750_DMAOR_A7
)

85 
REGNAME
(
SH7750_SCRDR1_A7
)

86 
REGNAME
(
SH7750_SCRDR2_A7
)

87 
REGNAME
(
SH7750_SCTDR1_A7
)

88 
REGNAME
(
SH7750_SCTDR2_A7
)

89 
REGNAME
(
SH7750_SCSMR1_A7
)

90 
REGNAME
(
SH7750_SCSMR2_A7
)

91 
REGNAME
(
SH7750_SCSCR1_A7
)

92 
REGNAME
(
SH7750_SCSCR2_A7
)

93 
REGNAME
(
SH7750_SCSSR1_A7
)

94 
REGNAME
(
SH7750_SCSFR2_A7
)

95 
REGNAME
(
SH7750_SCSPTR1_A7
)

96 
REGNAME
(
SH7750_SCSPTR2_A7
)

97 
REGNAME
(
SH7750_SCBRR1_A7
)

98 
REGNAME
(
SH7750_SCBRR2_A7
)

99 
REGNAME
(
SH7750_SCFCR2_A7
)

100 
REGNAME
(
SH7750_SCFDR2_A7
)

101 
REGNAME
(
SH7750_SCLSR2_A7
)

102 
REGNAME
(
SH7750_SCSCMR1_A7
)

103 
REGNAME
(
SH7750_PCTRA_A7
)

104 
REGNAME
(
SH7750_PDTRA_A7
)

105 
REGNAME
(
SH7750_PCTRB_A7
)

106 
REGNAME
(
SH7750_PDTRB_A7
)

107 
REGNAME
(
SH7750_GPIOIC_A7
)

108 
REGNAME
(
SH7750_ICR_A7
)

109 
REGNAME
(
SH7750_IPRA_A7
)

110 
REGNAME
(
SH7750_IPRB_A7
)

111 
REGNAME
(
SH7750_IPRC_A7
)

112 
REGNAME
(
SH7750_BCR3_A7
)

113 
REGNAME
(
SH7750_BCR4_A7
)

114 
REGNAME
(
SH7750_PRECHARGE0_A7
)

115 
REGNAME
(
SH7750_PRECHARGE1_A7
Ë{(
uöt32_t
) - 1, 0}

118 c⁄° *
	$ªg«me
(
uöt32_t
 
addr
)

120 
i
;

122 
i
 = 0; 
ªg«mes
[i].
ªgaddr
 !(
uöt32_t
) - 1; i++) {

123 i‡(
ªg«mes
[
i
].
ªgaddr
 =
addr
)

124  
ªg«mes
[
i
].
ªg«me
;

128 
	}
}

	@sh7750_regnames.h

1 #i‚de‡
_SH7750_REGNAMES_H


2 
	#_SH7750_REGNAMES_H


	)

4 c⁄° *
ªg«me
(
uöt32_t
 
addr
);

	@sh7750_regs.h

19 #i‚de‡
__SH7750_REGS_H__


20 
	#__SH7750_REGS_H__


	)

26 
	#SH7750_P4_BASE
 0xff000000

	)

28 
	#SH7750_A7_BASE
 0x1f000000

	)

30 
	#SH7750_P4_REG32
(
ofs
Ë(
SH7750_P4_BASE
 + (ofs))

	)

31 
	#SH7750_A7_REG32
(
ofs
Ë(
SH7750_A7_BASE
 + (ofs))

	)

38 
	#SH7750_PTEH_REGOFS
 0x000000

	)

39 
	#SH7750_PTEH
 
	`SH7750_P4_REG32
(
SH7750_PTEH_REGOFS
)

	)

40 
	#SH7750_PTEH_A7
 
	`SH7750_A7_REG32
(
SH7750_PTEH_REGOFS
)

	)

41 
	#SH7750_PTEH_VPN
 0xfffffd00

	)

42 
	#SH7750_PTEH_VPN_S
 10

	)

43 
	#SH7750_PTEH_ASID
 0x000000f‡

	)

44 
	#SH7750_PTEH_ASID_S
 0

	)

47 
	#SH7750_PTEL_REGOFS
 0x000004

	)

48 
	#SH7750_PTEL
 
	`SH7750_P4_REG32
(
SH7750_PTEL_REGOFS
)

	)

49 
	#SH7750_PTEL_A7
 
	`SH7750_A7_REG32
(
SH7750_PTEL_REGOFS
)

	)

50 
	#SH7750_PTEL_PPN
 0x1ffffc00

	)

51 
	#SH7750_PTEL_PPN_S
 10

	)

52 
	#SH7750_PTEL_V
 0x00000100

	)

53 
	#SH7750_PTEL_SZ1
 0x00000080

	)

54 
	#SH7750_PTEL_SZ0
 0x00000010

	)

55 
	#SH7750_PTEL_SZ_1KB
 0x00000000

	)

56 
	#SH7750_PTEL_SZ_4KB
 0x00000010

	)

57 
	#SH7750_PTEL_SZ_64KB
 0x00000080

	)

58 
	#SH7750_PTEL_SZ_1MB
 0x00000090

	)

59 
	#SH7750_PTEL_PR
 0x00000060

	)

60 
	#SH7750_PTEL_PR_ROPO
 0x00000000

	)

61 
	#SH7750_PTEL_PR_RWPO
 0x00000020

	)

62 
	#SH7750_PTEL_PR_ROPU
 0x00000040

	)

63 
	#SH7750_PTEL_PR_RWPU
 0x00000060

	)

64 
	#SH7750_PTEL_C
 0x00000008

	)

66 
	#SH7750_PTEL_D
 0x00000004

	)

68 
	#SH7750_PTEL_SH
 0x00000002

	)

70 
	#SH7750_PTEL_WT
 0x00000001

	)

76 
	#SH7750_PTEA_REGOFS
 0x000034

	)

77 
	#SH7750_PTEA
 
	`SH7750_P4_REG32
(
SH7750_PTEA_REGOFS
)

	)

78 
	#SH7750_PTEA_A7
 
	`SH7750_A7_REG32
(
SH7750_PTEA_REGOFS
)

	)

79 
	#SH7750_PTEA_TC
 0x00000008

	)

82 
	#SH7750_PTEA_SA
 0x00000007

	)

83 
	#SH7750_PTEA_SA_UNDEF
 0x00000000

	)

84 
	#SH7750_PTEA_SA_IOVAR
 0x00000001

	)

85 
	#SH7750_PTEA_SA_IO8
 0x00000002

	)

86 
	#SH7750_PTEA_SA_IO16
 0x00000003

	)

87 
	#SH7750_PTEA_SA_CMEM8
 0x00000004

	)

88 
	#SH7750_PTEA_SA_CMEM16
 0x00000005

	)

89 
	#SH7750_PTEA_SA_AMEM8
 0x00000006

	)

90 
	#SH7750_PTEA_SA_AMEM16
 0x00000007

	)

94 
	#SH7750_TTB_REGOFS
 0x000008

	)

95 
	#SH7750_TTB
 
	`SH7750_P4_REG32
(
SH7750_TTB_REGOFS
)

	)

96 
	#SH7750_TTB_A7
 
	`SH7750_A7_REG32
(
SH7750_TTB_REGOFS
)

	)

99 
	#SH7750_TEA_REGOFS
 0x00000¯

	)

100 
	#SH7750_TEA
 
	`SH7750_P4_REG32
(
SH7750_TEA_REGOFS
)

	)

101 
	#SH7750_TEA_A7
 
	`SH7750_A7_REG32
(
SH7750_TEA_REGOFS
)

	)

104 
	#SH7750_MMUCR_REGOFS
 0x000010

	)

105 
	#SH7750_MMUCR
 
	`SH7750_P4_REG32
(
SH7750_MMUCR_REGOFS
)

	)

106 
	#SH7750_MMUCR_A7
 
	`SH7750_A7_REG32
(
SH7750_MMUCR_REGOFS
)

	)

107 
	#SH7750_MMUCR_AT
 0x00000001

	)

108 
	#SH7750_MMUCR_TI
 0x00000004

	)

109 
	#SH7750_MMUCR_SV
 0x00000100

	)

110 
	#SH7750_MMUCR_SQMD
 0x00000200

	)

111 
	#SH7750_MMUCR_URC
 0x0000FC00

	)

112 
	#SH7750_MMUCR_URC_S
 10

	)

113 
	#SH7750_MMUCR_URB
 0x00FC0000

	)

114 
	#SH7750_MMUCR_URB_S
 18

	)

115 
	#SH7750_MMUCR_LRUI
 0xFC000000

	)

116 
	#SH7750_MMUCR_LRUI_S
 26

	)

128 
	#SH7750_CCR_REGOFS
 0x00001¯

	)

129 
	#SH7750_CCR
 
	`SH7750_P4_REG32
(
SH7750_CCR_REGOFS
)

	)

130 
	#SH7750_CCR_A7
 
	`SH7750_A7_REG32
(
SH7750_CCR_REGOFS
)

	)

132 
	#SH7750_CCR_IIX
 0x00008000

	)

133 
	#SH7750_CCR_ICI
 0x00000800

	)

135 
	#SH7750_CCR_ICE
 0x00000100

	)

136 
	#SH7750_CCR_OIX
 0x00000080

	)

137 
	#SH7750_CCR_ORA
 0x00000020

	)

140 
	#SH7750_CCR_OCI
 0x00000008

	)

141 
	#SH7750_CCR_CB
 0x00000004

	)

142 
	#SH7750_CCR_WT
 0x00000002

	)

143 
	#SH7750_CCR_OCE
 0x00000001

	)

146 
	#SH7750_QACR0_REGOFS
 0x000038

	)

147 
	#SH7750_QACR0
 
	`SH7750_P4_REG32
(
SH7750_QACR0_REGOFS
)

	)

148 
	#SH7750_QACR0_A7
 
	`SH7750_A7_REG32
(
SH7750_QACR0_REGOFS
)

	)

151 
	#SH7750_QACR1_REGOFS
 0x00003¯

	)

152 
	#SH7750_QACR1
 
	`SH7750_P4_REG32
(
SH7750_QACR1_REGOFS
)

	)

153 
	#SH7750_QACR1_A7
 
	`SH7750_A7_REG32
(
SH7750_QACR1_REGOFS
)

	)

161 
	#SH7750_TRA_REGOFS
 0x000020

	)

162 
	#SH7750_TRA
 
	`SH7750_P4_REG32
(
SH7750_TRA_REGOFS
)

	)

163 
	#SH7750_TRA_A7
 
	`SH7750_A7_REG32
(
SH7750_TRA_REGOFS
)

	)

165 
	#SH7750_TRA_IMM
 0x000003fd

	)

166 
	#SH7750_TRA_IMM_S
 2

	)

169 
	#SH7750_EXPEVT_REGOFS
 0x000024

	)

170 
	#SH7750_EXPEVT
 
	`SH7750_P4_REG32
(
SH7750_EXPEVT_REGOFS
)

	)

171 
	#SH7750_EXPEVT_A7
 
	`SH7750_A7_REG32
(
SH7750_EXPEVT_REGOFS
)

	)

173 
	#SH7750_EXPEVT_EX
 0x00000ff‡

	)

174 
	#SH7750_EXPEVT_EX_S
 0

	)

177 
	#SH7750_INTEVT_REGOFS
 0x000028

	)

178 
	#SH7750_INTEVT
 
	`SH7750_P4_REG32
(
SH7750_INTEVT_REGOFS
)

	)

179 
	#SH7750_INTEVT_A7
 
	`SH7750_A7_REG32
(
SH7750_INTEVT_REGOFS
)

	)

180 
	#SH7750_INTEVT_EX
 0x00000ff‡

	)

181 
	#SH7750_INTEVT_EX_S
 0

	)

186 
	#SH7750_EVT_TO_NUM
(
evt
Ë(”vtË>> 5)

	)

189 
	#SH7750_EVT_POWER_ON_RST
 0x000

	)

190 
	#SH7750_EVT_MANUAL_RST
 0x020

	)

191 
	#SH7750_EVT_TLB_MULT_HIT
 0x140

	)

194 
	#SH7750_EVT_USER_BREAK
 0x1E0

	)

195 
	#SH7750_EVT_IADDR_ERR
 0x0E0

	)

196 
	#SH7750_EVT_TLB_READ_MISS
 0x040

	)

198 
	#SH7750_EVT_TLB_READ_PROTV
 0x0A0

	)

200 
	#SH7750_EVT_ILLEGAL_INSTR
 0x180

	)

202 
	#SH7750_EVT_SLOT_ILLEGAL_INSTR
 0x1A0

	)

204 
	#SH7750_EVT_FPU_DISABLE
 0x800

	)

205 
	#SH7750_EVT_SLOT_FPU_DISABLE
 0x820

	)

206 
	#SH7750_EVT_DATA_READ_ERR
 0x0E0

	)

207 
	#SH7750_EVT_DATA_WRITE_ERR
 0x100

	)

208 
	#SH7750_EVT_DTLB_WRITE_MISS
 0x060

	)

209 
	#SH7750_EVT_DTLB_WRITE_PROTV
 0x0C0

	)

211 
	#SH7750_EVT_FPU_EXCEPTION
 0x120

	)

212 
	#SH7750_EVT_INITIAL_PGWRITE
 0x080

	)

213 
	#SH7750_EVT_TRAPA
 0x160

	)

216 
	#SH7750_EVT_NMI
 0x1C0

	)

217 
	#SH7750_EVT_IRQ0
 0x200

	)

218 
	#SH7750_EVT_IRQ1
 0x220

	)

219 
	#SH7750_EVT_IRQ2
 0x240

	)

220 
	#SH7750_EVT_IRQ3
 0x260

	)

221 
	#SH7750_EVT_IRQ4
 0x280

	)

222 
	#SH7750_EVT_IRQ5
 0x2A0

	)

223 
	#SH7750_EVT_IRQ6
 0x2C0

	)

224 
	#SH7750_EVT_IRQ7
 0x2E0

	)

225 
	#SH7750_EVT_IRQ8
 0x300

	)

226 
	#SH7750_EVT_IRQ9
 0x320

	)

227 
	#SH7750_EVT_IRQA
 0x340

	)

228 
	#SH7750_EVT_IRQB
 0x360

	)

229 
	#SH7750_EVT_IRQC
 0x380

	)

230 
	#SH7750_EVT_IRQD
 0x3A0

	)

231 
	#SH7750_EVT_IRQE
 0x3C0

	)

234 
	#SH7750_EVT_TUNI0
 0x400

	)

235 
	#SH7750_EVT_TUNI1
 0x420

	)

236 
	#SH7750_EVT_TUNI2
 0x440

	)

237 
	#SH7750_EVT_TICPI2
 0x460

	)

240 
	#SH7750_EVT_RTC_ATI
 0x480

	)

241 
	#SH7750_EVT_RTC_PRI
 0x4A0

	)

242 
	#SH7750_EVT_RTC_CUI
 0x4C0

	)

245 
	#SH7750_EVT_SCI_ERI
 0x4E0

	)

246 
	#SH7750_EVT_SCI_RXI
 0x500

	)

247 
	#SH7750_EVT_SCI_TXI
 0x520

	)

248 
	#SH7750_EVT_SCI_TEI
 0x540

	)

251 
	#SH7750_EVT_WDT_ITI
 0x560

	)

256 
	#SH7750_EVT_REF_RCMI
 0x580

	)

257 
	#SH7750_EVT_REF_ROVI
 0x5A0

	)

261 
	#SH7750_EVT_HUDI
 0x600

	)

264 
	#SH7750_EVT_GPIO
 0x620

	)

267 
	#SH7750_EVT_DMAC_DMTE0
 0x640

	)

268 
	#SH7750_EVT_DMAC_DMTE1
 0x660

	)

269 
	#SH7750_EVT_DMAC_DMTE2
 0x680

	)

270 
	#SH7750_EVT_DMAC_DMTE3
 0x6A0

	)

271 
	#SH7750_EVT_DMAC_DMAE
 0x6C0

	)

275 
	#SH7750_EVT_SCIF_ERI
 0x700

	)

276 
	#SH7750_EVT_SCIF_RXI
 0x720

	)

278 
	#SH7750_EVT_SCIF_BRI
 0x740

	)

279 
	#SH7750_EVT_SCIF_TXI
 0x760

	)

284 
	#SH7750_STBCR_REGOFS
 0xC00004

	)

285 
	#SH7750_STBCR
 
	`SH7750_P4_REG32
(
SH7750_STBCR_REGOFS
)

	)

286 
	#SH7750_STBCR_A7
 
	`SH7750_A7_REG32
(
SH7750_STBCR_REGOFS
)

	)

288 
	#SH7750_STBCR_STBY
 0x80

	)

291 
	#SH7750_STBCR_PHZ
 0x40

	)

296 
	#SH7750_STBCR_PPU
 0x20

	)

297 
	#SH7750_STBCR_MSTP4
 0x10

	)

298 
	#SH7750_STBCR_DMAC_STP
 
SH7750_STBCR_MSTP4


	)

299 
	#SH7750_STBCR_MSTP3
 0x08

	)

300 
	#SH7750_STBCR_SCIF_STP
 
SH7750_STBCR_MSTP3


	)

301 
	#SH7750_STBCR_MSTP2
 0x04

	)

302 
	#SH7750_STBCR_TMU_STP
 
SH7750_STBCR_MSTP2


	)

303 
	#SH7750_STBCR_MSTP1
 0x02

	)

304 
	#SH7750_STBCR_RTC_STP
 
SH7750_STBCR_MSTP1


	)

305 
	#SH7750_STBCR_MSPT0
 0x01

	)

306 
	#SH7750_STBCR_SCI_STP
 
SH7750_STBCR_MSTP0


	)

308 
	#SH7750_STBCR_STBY
 0x80

	)

311 
	#SH7750_STBCR2_REGOFS
 0xC00010

	)

312 
	#SH7750_STBCR2
 
	`SH7750_P4_REG32
(
SH7750_STBCR2_REGOFS
)

	)

313 
	#SH7750_STBCR2_A7
 
	`SH7750_A7_REG32
(
SH7750_STBCR2_REGOFS
)

	)

315 
	#SH7750_STBCR2_DSLP
 0x80

	)

320 
	#SH7750_STBCR2_MSTP6
 0x02

	)

322 
	#SH7750_STBCR2_SQ_STP
 
SH7750_STBCR2_MSTP6


	)

323 
	#SH7750_STBCR2_MSTP5
 0x01

	)

325 
	#SH7750_STBCR2_UBC_STP
 
SH7750_STBCR2_MSTP5


	)

330 
	#SH7750_FRQCR_REGOFS
 0xC00000

	)

331 
	#SH7750_FRQCR
 
	`SH7750_P4_REG32
(
SH7750_FRQCR_REGOFS
)

	)

332 
	#SH7750_FRQCR_A7
 
	`SH7750_A7_REG32
(
SH7750_FRQCR_REGOFS
)

	)

334 
	#SH7750_FRQCR_CKOEN
 0x0800

	)

337 
	#SH7750_FRQCR_PLL1EN
 0x0400

	)

338 
	#SH7750_FRQCR_PLL2EN
 0x0200

	)

340 
	#SH7750_FRQCR_IFC
 0x01C0

	)

341 
	#SH7750_FRQCR_IFCDIV1
 0x0000

	)

342 
	#SH7750_FRQCR_IFCDIV2
 0x0040

	)

343 
	#SH7750_FRQCR_IFCDIV3
 0x0080

	)

344 
	#SH7750_FRQCR_IFCDIV4
 0x00C0

	)

345 
	#SH7750_FRQCR_IFCDIV6
 0x0100

	)

346 
	#SH7750_FRQCR_IFCDIV8
 0x0140

	)

348 
	#SH7750_FRQCR_BFC
 0x0038

	)

349 
	#SH7750_FRQCR_BFCDIV1
 0x0000

	)

350 
	#SH7750_FRQCR_BFCDIV2
 0x0008

	)

351 
	#SH7750_FRQCR_BFCDIV3
 0x0010

	)

352 
	#SH7750_FRQCR_BFCDIV4
 0x0018

	)

353 
	#SH7750_FRQCR_BFCDIV6
 0x0020

	)

354 
	#SH7750_FRQCR_BFCDIV8
 0x0028

	)

356 
	#SH7750_FRQCR_PFC
 0x0007

	)

358 
	#SH7750_FRQCR_PFCDIV2
 0x0000

	)

359 
	#SH7750_FRQCR_PFCDIV3
 0x0001

	)

360 
	#SH7750_FRQCR_PFCDIV4
 0x0002

	)

361 
	#SH7750_FRQCR_PFCDIV6
 0x0003

	)

362 
	#SH7750_FRQCR_PFCDIV8
 0x0004

	)

369 
	#SH7750_WTCNT_REGOFS
 0xC00008

	)

370 
	#SH7750_WTCNT
 
	`SH7750_P4_REG32
(
SH7750_WTCNT_REGOFS
)

	)

371 
	#SH7750_WTCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_WTCNT_REGOFS
)

	)

372 
	#SH7750_WTCNT_KEY
 0x5A00

	)

377 
	#SH7750_WTCSR_REGOFS
 0xC0000C

	)

378 
	#SH7750_WTCSR
 
	`SH7750_P4_REG32
(
SH7750_WTCSR_REGOFS
)

	)

379 
	#SH7750_WTCSR_A7
 
	`SH7750_A7_REG32
(
SH7750_WTCSR_REGOFS
)

	)

380 
	#SH7750_WTCSR_KEY
 0xA500

	)

383 
	#SH7750_WTCSR_TME
 0x80

	)

384 
	#SH7750_WTCSR_MODE
 0x40

	)

385 
	#SH7750_WTCSR_MODE_WT
 0x40

	)

386 
	#SH7750_WTCSR_MODE_IT
 0x00

	)

387 
	#SH7750_WTCSR_RSTS
 0x20

	)

388 
	#SH7750_WTCSR_RST_MAN
 0x20

	)

389 
	#SH7750_WTCSR_RST_PWR
 0x00

	)

390 
	#SH7750_WTCSR_WOVF
 0x10

	)

391 
	#SH7750_WTCSR_IOVF
 0x08

	)

392 
	#SH7750_WTCSR_CKS
 0x07

	)

393 
	#SH7750_WTCSR_CKS_DIV32
 0x00

	)

394 
	#SH7750_WTCSR_CKS_DIV64
 0x01

	)

395 
	#SH7750_WTCSR_CKS_DIV128
 0x02

	)

396 
	#SH7750_WTCSR_CKS_DIV256
 0x03

	)

397 
	#SH7750_WTCSR_CKS_DIV512
 0x04

	)

398 
	#SH7750_WTCSR_CKS_DIV1024
 0x05

	)

399 
	#SH7750_WTCSR_CKS_DIV2048
 0x06

	)

400 
	#SH7750_WTCSR_CKS_DIV4096
 0x07

	)

406 
	#SH7750_R64CNT_REGOFS
 0xC80000

	)

407 
	#SH7750_R64CNT
 
	`SH7750_P4_REG32
(
SH7750_R64CNT_REGOFS
)

	)

408 
	#SH7750_R64CNT_A7
 
	`SH7750_A7_REG32
(
SH7750_R64CNT_REGOFS
)

	)

411 
	#SH7750_RSECCNT_REGOFS
 0xC80004

	)

412 
	#SH7750_RSECCNT
 
	`SH7750_P4_REG32
(
SH7750_RSECCNT_REGOFS
)

	)

413 
	#SH7750_RSECCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_RSECCNT_REGOFS
)

	)

416 
	#SH7750_RMINCNT_REGOFS
 0xC80008

	)

417 
	#SH7750_RMINCNT
 
	`SH7750_P4_REG32
(
SH7750_RMINCNT_REGOFS
)

	)

418 
	#SH7750_RMINCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_RMINCNT_REGOFS
)

	)

421 
	#SH7750_RHRCNT_REGOFS
 0xC8000C

	)

422 
	#SH7750_RHRCNT
 
	`SH7750_P4_REG32
(
SH7750_RHRCNT_REGOFS
)

	)

423 
	#SH7750_RHRCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_RHRCNT_REGOFS
)

	)

426 
	#SH7750_RWKCNT_REGOFS
 0xC80010

	)

427 
	#SH7750_RWKCNT
 
	`SH7750_P4_REG32
(
SH7750_RWKCNT_REGOFS
)

	)

428 
	#SH7750_RWKCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_RWKCNT_REGOFS
)

	)

430 
	#SH7750_RWKCNT_SUN
 0

	)

431 
	#SH7750_RWKCNT_MON
 1

	)

432 
	#SH7750_RWKCNT_TUE
 2

	)

433 
	#SH7750_RWKCNT_WED
 3

	)

434 
	#SH7750_RWKCNT_THU
 4

	)

435 
	#SH7750_RWKCNT_FRI
 5

	)

436 
	#SH7750_RWKCNT_SAT
 6

	)

439 
	#SH7750_RDAYCNT_REGOFS
 0xC80014

	)

440 
	#SH7750_RDAYCNT
 
	`SH7750_P4_REG32
(
SH7750_RDAYCNT_REGOFS
)

	)

441 
	#SH7750_RDAYCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_RDAYCNT_REGOFS
)

	)

444 
	#SH7750_RMONCNT_REGOFS
 0xC80018

	)

445 
	#SH7750_RMONCNT
 
	`SH7750_P4_REG32
(
SH7750_RMONCNT_REGOFS
)

	)

446 
	#SH7750_RMONCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_RMONCNT_REGOFS
)

	)

449 
	#SH7750_RYRCNT_REGOFS
 0xC8001C

	)

450 
	#SH7750_RYRCNT
 
	`SH7750_P4_REG32
(
SH7750_RYRCNT_REGOFS
)

	)

451 
	#SH7750_RYRCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_RYRCNT_REGOFS
)

	)

454 
	#SH7750_RSECAR_REGOFS
 0xC80020

	)

455 
	#SH7750_RSECAR
 
	`SH7750_P4_REG32
(
SH7750_RSECAR_REGOFS
)

	)

456 
	#SH7750_RSECAR_A7
 
	`SH7750_A7_REG32
(
SH7750_RSECAR_REGOFS
)

	)

457 
	#SH7750_RSECAR_ENB
 0x80

	)

460 
	#SH7750_RMINAR_REGOFS
 0xC80024

	)

461 
	#SH7750_RMINAR
 
	`SH7750_P4_REG32
(
SH7750_RMINAR_REGOFS
)

	)

462 
	#SH7750_RMINAR_A7
 
	`SH7750_A7_REG32
(
SH7750_RMINAR_REGOFS
)

	)

463 
	#SH7750_RMINAR_ENB
 0x80

	)

466 
	#SH7750_RHRAR_REGOFS
 0xC80028

	)

467 
	#SH7750_RHRAR
 
	`SH7750_P4_REG32
(
SH7750_RHRAR_REGOFS
)

	)

468 
	#SH7750_RHRAR_A7
 
	`SH7750_A7_REG32
(
SH7750_RHRAR_REGOFS
)

	)

469 
	#SH7750_RHRAR_ENB
 0x80

	)

472 
	#SH7750_RWKAR_REGOFS
 0xC8002C

	)

473 
	#SH7750_RWKAR
 
	`SH7750_P4_REG32
(
SH7750_RWKAR_REGOFS
)

	)

474 
	#SH7750_RWKAR_A7
 
	`SH7750_A7_REG32
(
SH7750_RWKAR_REGOFS
)

	)

475 
	#SH7750_RWKAR_ENB
 0x80

	)

477 
	#SH7750_RWKAR_SUN
 0

	)

478 
	#SH7750_RWKAR_MON
 1

	)

479 
	#SH7750_RWKAR_TUE
 2

	)

480 
	#SH7750_RWKAR_WED
 3

	)

481 
	#SH7750_RWKAR_THU
 4

	)

482 
	#SH7750_RWKAR_FRI
 5

	)

483 
	#SH7750_RWKAR_SAT
 6

	)

486 
	#SH7750_RDAYAR_REGOFS
 0xC80030

	)

487 
	#SH7750_RDAYAR
 
	`SH7750_P4_REG32
(
SH7750_RDAYAR_REGOFS
)

	)

488 
	#SH7750_RDAYAR_A7
 
	`SH7750_A7_REG32
(
SH7750_RDAYAR_REGOFS
)

	)

489 
	#SH7750_RDAYAR_ENB
 0x80

	)

492 
	#SH7750_RMONAR_REGOFS
 0xC80034

	)

493 
	#SH7750_RMONAR
 
	`SH7750_P4_REG32
(
SH7750_RMONAR_REGOFS
)

	)

494 
	#SH7750_RMONAR_A7
 
	`SH7750_A7_REG32
(
SH7750_RMONAR_REGOFS
)

	)

495 
	#SH7750_RMONAR_ENB
 0x80

	)

498 
	#SH7750_RCR1_REGOFS
 0xC80038

	)

499 
	#SH7750_RCR1
 
	`SH7750_P4_REG32
(
SH7750_RCR1_REGOFS
)

	)

500 
	#SH7750_RCR1_A7
 
	`SH7750_A7_REG32
(
SH7750_RCR1_REGOFS
)

	)

501 
	#SH7750_RCR1_CF
 0x80

	)

502 
	#SH7750_RCR1_CIE
 0x10

	)

503 
	#SH7750_RCR1_AIE
 0x08

	)

504 
	#SH7750_RCR1_AF
 0x01

	)

507 
	#SH7750_RCR2_REGOFS
 0xC8003C

	)

508 
	#SH7750_RCR2
 
	`SH7750_P4_REG32
(
SH7750_RCR2_REGOFS
)

	)

509 
	#SH7750_RCR2_A7
 
	`SH7750_A7_REG32
(
SH7750_RCR2_REGOFS
)

	)

510 
	#SH7750_RCR2_PEF
 0x80

	)

511 
	#SH7750_RCR2_PES
 0x70

	)

512 
	#SH7750_RCR2_PES_DIS
 0x00

	)

513 
	#SH7750_RCR2_PES_DIV256
 0x10

	)

514 
	#SH7750_RCR2_PES_DIV64
 0x20

	)

515 
	#SH7750_RCR2_PES_DIV16
 0x30

	)

516 
	#SH7750_RCR2_PES_DIV4
 0x40

	)

517 
	#SH7750_RCR2_PES_DIV2
 0x50

	)

518 
	#SH7750_RCR2_PES_x1
 0x60

	)

519 
	#SH7750_RCR2_PES_x2
 0x70

	)

520 
	#SH7750_RCR2_RTCEN
 0x08

	)

521 
	#SH7750_RCR2_ADJ
 0x04

	)

522 
	#SH7750_RCR2_RESET
 0x02

	)

523 
	#SH7750_RCR2_START
 0x01

	)

533 
	#SH7750_TOCR_REGOFS
 0xD80000

	)

534 
	#SH7750_TOCR
 
	`SH7750_P4_REG32
(
SH7750_TOCR_REGOFS
)

	)

535 
	#SH7750_TOCR_A7
 
	`SH7750_A7_REG32
(
SH7750_TOCR_REGOFS
)

	)

536 
	#SH7750_TOCR_TCOE
 0x01

	)

543 
	#SH7750_TSTR_REGOFS
 0xD80004

	)

544 
	#SH7750_TSTR
 
	`SH7750_P4_REG32
(
SH7750_TSTR_REGOFS
)

	)

545 
	#SH7750_TSTR_A7
 
	`SH7750_A7_REG32
(
SH7750_TSTR_REGOFS
)

	)

546 
	#SH7750_TSTR_STR2
 0x04

	)

547 
	#SH7750_TSTR_STR1
 0x02

	)

548 
	#SH7750_TSTR_STR0
 0x01

	)

549 
	#SH7750_TSTR_STR
(
n
Ë(1 << (n))

	)

552 
	#SH7750_TCOR_REGOFS
(
n
Ë(0xD80008 + (“)*12)Ë

	)

553 
	#SH7750_TCOR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_TCOR_REGOFS
“))

	)

554 
	#SH7750_TCOR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_TCOR_REGOFS
“))

	)

555 
	#SH7750_TCOR0
 
	`SH7750_TCOR
(0)

	)

556 
	#SH7750_TCOR1
 
	`SH7750_TCOR
(1)

	)

557 
	#SH7750_TCOR2
 
	`SH7750_TCOR
(2)

	)

558 
	#SH7750_TCOR0_A7
 
	`SH7750_TCOR_A7
(0)

	)

559 
	#SH7750_TCOR1_A7
 
	`SH7750_TCOR_A7
(1)

	)

560 
	#SH7750_TCOR2_A7
 
	`SH7750_TCOR_A7
(2)

	)

563 
	#SH7750_TCNT_REGOFS
(
n
Ë(0xD8000C + (“)*12)Ë

	)

564 
	#SH7750_TCNT
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_TCNT_REGOFS
“))

	)

565 
	#SH7750_TCNT_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_TCNT_REGOFS
“))

	)

566 
	#SH7750_TCNT0
 
	`SH7750_TCNT
(0)

	)

567 
	#SH7750_TCNT1
 
	`SH7750_TCNT
(1)

	)

568 
	#SH7750_TCNT2
 
	`SH7750_TCNT
(2)

	)

569 
	#SH7750_TCNT0_A7
 
	`SH7750_TCNT_A7
(0)

	)

570 
	#SH7750_TCNT1_A7
 
	`SH7750_TCNT_A7
(1)

	)

571 
	#SH7750_TCNT2_A7
 
	`SH7750_TCNT_A7
(2)

	)

574 
	#SH7750_TCR_REGOFS
(
n
Ë(0xD80010 + (“)*12)Ë

	)

575 
	#SH7750_TCR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_TCR_REGOFS
“))

	)

576 
	#SH7750_TCR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_TCR_REGOFS
“))

	)

577 
	#SH7750_TCR0
 
	`SH7750_TCR
(0)

	)

578 
	#SH7750_TCR1
 
	`SH7750_TCR
(1)

	)

579 
	#SH7750_TCR2
 
	`SH7750_TCR
(2)

	)

580 
	#SH7750_TCR0_A7
 
	`SH7750_TCR_A7
(0)

	)

581 
	#SH7750_TCR1_A7
 
	`SH7750_TCR_A7
(1)

	)

582 
	#SH7750_TCR2_A7
 
	`SH7750_TCR_A7
(2)

	)

584 
	#SH7750_TCR2_ICPF
 0x200

	)

586 
	#SH7750_TCR_UNF
 0x100

	)

587 
	#SH7750_TCR2_ICPE
 0x0C0

	)

588 
	#SH7750_TCR2_ICPE_DIS
 0x000

	)

589 
	#SH7750_TCR2_ICPE_NOINT
 0x080

	)

592 
	#SH7750_TCR2_ICPE_INT
 0x0C0

	)

594 
	#SH7750_TCR_UNIE
 0x020

	)

596 
	#SH7750_TCR_CKEG
 0x018

	)

597 
	#SH7750_TCR_CKEG_RAISE
 0x000

	)

598 
	#SH7750_TCR_CKEG_FALL
 0x008

	)

599 
	#SH7750_TCR_CKEG_BOTH
 0x018

	)

601 
	#SH7750_TCR_TPSC
 0x007

	)

602 
	#SH7750_TCR_TPSC_DIV4
 0x000

	)

603 
	#SH7750_TCR_TPSC_DIV16
 0x001

	)

604 
	#SH7750_TCR_TPSC_DIV64
 0x002

	)

605 
	#SH7750_TCR_TPSC_DIV256
 0x003

	)

606 
	#SH7750_TCR_TPSC_DIV1024
 0x004

	)

607 
	#SH7750_TCR_TPSC_RTC
 0x006

	)

608 
	#SH7750_TCR_TPSC_EXT
 0x007

	)

611 
	#SH7750_TCPR2_REGOFS
 0xD8002C

	)

612 
	#SH7750_TCPR2
 
	`SH7750_P4_REG32
(
SH7750_TCPR2_REGOFS
)

	)

613 
	#SH7750_TCPR2_A7
 
	`SH7750_A7_REG32
(
SH7750_TCPR2_REGOFS
)

	)

619 
	#SH7750_BCR1_REGOFS
 0x800000

	)

620 
	#SH7750_BCR1
 
	`SH7750_P4_REG32
(
SH7750_BCR1_REGOFS
)

	)

621 
	#SH7750_BCR1_A7
 
	`SH7750_A7_REG32
(
SH7750_BCR1_REGOFS
)

	)

622 
	#SH7750_BCR1_ENDIAN
 0x80000000

	)

623 
	#SH7750_BCR1_MASTER
 0x40000000

	)

624 
	#SH7750_BCR1_A0MPX
 0x20000000

	)

625 
	#SH7750_BCR1_IPUP
 0x02000000

	)

629 
	#SH7750_BCR1_OPUP
 0x01000000

	)

633 
	#SH7750_BCR1_A1MBC
 0x00200000

	)

638 
	#SH7750_BCR1_A4MBC
 0x00100000

	)

643 
	#SH7750_BCR1_BREQEN
 0x00080000

	)

648 
	#SH7750_BCR1_PSHR
 0x00040000

	)

651 
	#SH7750_BCR1_MEMMPX
 0x00020000

	)

654 
	#SH7750_BCR1_HIZMEM
 0x00008000

	)

660 
	#SH7750_BCR1_HIZCNT
 0x00004000

	)

667 
	#SH7750_BCR1_A0BST
 0x00003800

	)

668 
	#SH7750_BCR1_A0BST_SRAM
 0x0000

	)

669 
	#SH7750_BCR1_A0BST_ROM4
 0x0800

	)

671 
	#SH7750_BCR1_A0BST_ROM8
 0x1000

	)

673 
	#SH7750_BCR1_A0BST_ROM16
 0x1800

	)

675 
	#SH7750_BCR1_A0BST_ROM32
 0x2000

	)

678 
	#SH7750_BCR1_A5BST
 0x00000700

	)

679 
	#SH7750_BCR1_A5BST_SRAM
 0x0000

	)

680 
	#SH7750_BCR1_A5BST_ROM4
 0x0100

	)

682 
	#SH7750_BCR1_A5BST_ROM8
 0x0200

	)

684 
	#SH7750_BCR1_A5BST_ROM16
 0x0300

	)

686 
	#SH7750_BCR1_A5BST_ROM32
 0x0400

	)

689 
	#SH7750_BCR1_A6BST
 0x000000E0

	)

690 
	#SH7750_BCR1_A6BST_SRAM
 0x0000

	)

691 
	#SH7750_BCR1_A6BST_ROM4
 0x0020

	)

693 
	#SH7750_BCR1_A6BST_ROM8
 0x0040

	)

695 
	#SH7750_BCR1_A6BST_ROM16
 0x0060

	)

697 
	#SH7750_BCR1_A6BST_ROM32
 0x0080

	)

700 
	#SH7750_BCR1_DRAMTP
 0x001C

	)

701 
	#SH7750_BCR1_DRAMTP_2SRAM_3SRAM
 0x0000

	)

703 
	#SH7750_BCR1_DRAMTP_2SRAM_3SDRAM
 0x0008

	)

705 
	#SH7750_BCR1_DRAMTP_2SDRAM_3SDRAM
 0x000C

	)

707 
	#SH7750_BCR1_DRAMTP_2SRAM_3DRAM
 0x0010

	)

709 
	#SH7750_BCR1_DRAMTP_2DRAM_3DRAM
 0x0014

	)

712 
	#SH7750_BCR1_A56PCM
 0x00000001

	)

717 
	#SH7750_BCR2_REGOFS
 0x800004

	)

718 
	#SH7750_BCR2
 
	`SH7750_P4_REG32
(
SH7750_BCR2_REGOFS
)

	)

719 
	#SH7750_BCR2_A7
 
	`SH7750_A7_REG32
(
SH7750_BCR2_REGOFS
)

	)

721 
	#SH7750_BCR2_A0SZ
 0xC000

	)

722 
	#SH7750_BCR2_A0SZ_S
 14

	)

723 
	#SH7750_BCR2_A6SZ
 0x3000

	)

724 
	#SH7750_BCR2_A6SZ_S
 12

	)

725 
	#SH7750_BCR2_A5SZ
 0x0C00

	)

726 
	#SH7750_BCR2_A5SZ_S
 10

	)

727 
	#SH7750_BCR2_A4SZ
 0x0300

	)

728 
	#SH7750_BCR2_A4SZ_S
 8

	)

729 
	#SH7750_BCR2_A3SZ
 0x00C0

	)

730 
	#SH7750_BCR2_A3SZ_S
 6

	)

731 
	#SH7750_BCR2_A2SZ
 0x0030

	)

732 
	#SH7750_BCR2_A2SZ_S
 4

	)

733 
	#SH7750_BCR2_A1SZ
 0x000C

	)

734 
	#SH7750_BCR2_A1SZ_S
 2

	)

735 
	#SH7750_BCR2_SZ_64
 0

	)

736 
	#SH7750_BCR2_SZ_8
 1

	)

737 
	#SH7750_BCR2_SZ_16
 2

	)

738 
	#SH7750_BCR2_SZ_32
 3

	)

739 
	#SH7750_BCR2_PORTEN
 0x0001

	)

744 
	#SH7750_WCR1_REGOFS
 0x800008

	)

745 
	#SH7750_WCR1
 
	`SH7750_P4_REG32
(
SH7750_WCR1_REGOFS
)

	)

746 
	#SH7750_WCR1_A7
 
	`SH7750_A7_REG32
(
SH7750_WCR1_REGOFS
)

	)

747 
	#SH7750_WCR1_DMAIW
 0x70000000

	)

749 
	#SH7750_WCR1_DMAIW_S
 28

	)

750 
	#SH7750_WCR1_A6IW
 0x07000000

	)

751 
	#SH7750_WCR1_A6IW_S
 24

	)

752 
	#SH7750_WCR1_A5IW
 0x00700000

	)

753 
	#SH7750_WCR1_A5IW_S
 20

	)

754 
	#SH7750_WCR1_A4IW
 0x00070000

	)

755 
	#SH7750_WCR1_A4IW_S
 16

	)

756 
	#SH7750_WCR1_A3IW
 0x00007000

	)

757 
	#SH7750_WCR1_A3IW_S
 12

	)

758 
	#SH7750_WCR1_A2IW
 0x00000700

	)

759 
	#SH7750_WCR1_A2IW_S
 8

	)

760 
	#SH7750_WCR1_A1IW
 0x00000070

	)

761 
	#SH7750_WCR1_A1IW_S
 4

	)

762 
	#SH7750_WCR1_A0IW
 0x00000007

	)

763 
	#SH7750_WCR1_A0IW_S
 0

	)

766 
	#SH7750_WCR2_REGOFS
 0x80000C

	)

767 
	#SH7750_WCR2
 
	`SH7750_P4_REG32
(
SH7750_WCR2_REGOFS
)

	)

768 
	#SH7750_WCR2_A7
 
	`SH7750_A7_REG32
(
SH7750_WCR2_REGOFS
)

	)

770 
	#SH7750_WCR2_A6W
 0xE0000000

	)

771 
	#SH7750_WCR2_A6W_S
 29

	)

772 
	#SH7750_WCR2_A6B
 0x1C000000

	)

773 
	#SH7750_WCR2_A6B_S
 26

	)

774 
	#SH7750_WCR2_A5W
 0x03800000

	)

775 
	#SH7750_WCR2_A5W_S
 23

	)

776 
	#SH7750_WCR2_A5B
 0x00700000

	)

777 
	#SH7750_WCR2_A5B_S
 20

	)

778 
	#SH7750_WCR2_A4W
 0x000E0000

	)

779 
	#SH7750_WCR2_A4W_S
 17

	)

780 
	#SH7750_WCR2_A3W
 0x0000E000

	)

781 
	#SH7750_WCR2_A3W_S
 13

	)

782 
	#SH7750_WCR2_A2W
 0x00000E00

	)

783 
	#SH7750_WCR2_A2W_S
 9

	)

784 
	#SH7750_WCR2_A1W
 0x000001C0

	)

785 
	#SH7750_WCR2_A1W_S
 6

	)

786 
	#SH7750_WCR2_A0W
 0x00000038

	)

787 
	#SH7750_WCR2_A0W_S
 3

	)

788 
	#SH7750_WCR2_A0B
 0x00000007

	)

789 
	#SH7750_WCR2_A0B_S
 0

	)

791 
	#SH7750_WCR2_WS0
 0

	)

792 
	#SH7750_WCR2_WS1
 1

	)

793 
	#SH7750_WCR2_WS2
 2

	)

794 
	#SH7750_WCR2_WS3
 3

	)

795 
	#SH7750_WCR2_WS6
 4

	)

796 
	#SH7750_WCR2_WS9
 5

	)

797 
	#SH7750_WCR2_WS12
 6

	)

798 
	#SH7750_WCR2_WS15
 7

	)

800 
	#SH7750_WCR2_BPWS0
 0

	)

801 
	#SH7750_WCR2_BPWS1
 1

	)

802 
	#SH7750_WCR2_BPWS2
 2

	)

803 
	#SH7750_WCR2_BPWS3
 3

	)

804 
	#SH7750_WCR2_BPWS4
 4

	)

805 
	#SH7750_WCR2_BPWS5
 5

	)

806 
	#SH7750_WCR2_BPWS6
 6

	)

807 
	#SH7750_WCR2_BPWS7
 7

	)

810 
	#SH7750_WCR2_DRAM_CAS_ASW1
 0

	)

811 
	#SH7750_WCR2_DRAM_CAS_ASW2
 1

	)

812 
	#SH7750_WCR2_DRAM_CAS_ASW3
 2

	)

813 
	#SH7750_WCR2_DRAM_CAS_ASW4
 3

	)

814 
	#SH7750_WCR2_DRAM_CAS_ASW7
 4

	)

815 
	#SH7750_WCR2_DRAM_CAS_ASW10
 5

	)

816 
	#SH7750_WCR2_DRAM_CAS_ASW13
 6

	)

817 
	#SH7750_WCR2_DRAM_CAS_ASW16
 7

	)

820 
	#SH7750_WCR2_SDRAM_CAS_LAT1
 1

	)

821 
	#SH7750_WCR2_SDRAM_CAS_LAT2
 2

	)

822 
	#SH7750_WCR2_SDRAM_CAS_LAT3
 3

	)

823 
	#SH7750_WCR2_SDRAM_CAS_LAT4
 4

	)

824 
	#SH7750_WCR2_SDRAM_CAS_LAT5
 5

	)

827 
	#SH7750_WCR3_REGOFS
 0x800010

	)

828 
	#SH7750_WCR3
 
	`SH7750_P4_REG32
(
SH7750_WCR3_REGOFS
)

	)

829 
	#SH7750_WCR3_A7
 
	`SH7750_A7_REG32
(
SH7750_WCR3_REGOFS
)

	)

831 
	#SH7750_WCR3_A6S
 0x04000000

	)

832 
	#SH7750_WCR3_A6H
 0x03000000

	)

833 
	#SH7750_WCR3_A6H_S
 24

	)

834 
	#SH7750_WCR3_A5S
 0x00400000

	)

835 
	#SH7750_WCR3_A5H
 0x00300000

	)

836 
	#SH7750_WCR3_A5H_S
 20

	)

837 
	#SH7750_WCR3_A4S
 0x00040000

	)

838 
	#SH7750_WCR3_A4H
 0x00030000

	)

839 
	#SH7750_WCR3_A4H_S
 16

	)

840 
	#SH7750_WCR3_A3S
 0x00004000

	)

841 
	#SH7750_WCR3_A3H
 0x00003000

	)

842 
	#SH7750_WCR3_A3H_S
 12

	)

843 
	#SH7750_WCR3_A2S
 0x00000400

	)

844 
	#SH7750_WCR3_A2H
 0x00000300

	)

845 
	#SH7750_WCR3_A2H_S
 8

	)

846 
	#SH7750_WCR3_A1S
 0x00000040

	)

847 
	#SH7750_WCR3_A1H
 0x00000030

	)

848 
	#SH7750_WCR3_A1H_S
 4

	)

849 
	#SH7750_WCR3_A0S
 0x00000004

	)

850 
	#SH7750_WCR3_A0H
 0x00000003

	)

851 
	#SH7750_WCR3_A0H_S
 0

	)

853 
	#SH7750_WCR3_DHWS_0
 0

	)

854 
	#SH7750_WCR3_DHWS_1
 1

	)

855 
	#SH7750_WCR3_DHWS_2
 2

	)

856 
	#SH7750_WCR3_DHWS_3
 3

	)

858 
	#SH7750_MCR_REGOFS
 0x800014

	)

859 
	#SH7750_MCR
 
	`SH7750_P4_REG32
(
SH7750_MCR_REGOFS
)

	)

860 
	#SH7750_MCR_A7
 
	`SH7750_A7_REG32
(
SH7750_MCR_REGOFS
)

	)

862 
	#SH7750_MCR_RASD
 0x80000000

	)

863 
	#SH7750_MCR_MRSET
 0x40000000

	)

864 
	#SH7750_MCR_PALL
 0x00000000

	)

865 
	#SH7750_MCR_TRC
 0x38000000

	)

867 
	#SH7750_MCR_TRC_0
 0x00000000

	)

868 
	#SH7750_MCR_TRC_3
 0x08000000

	)

869 
	#SH7750_MCR_TRC_6
 0x10000000

	)

870 
	#SH7750_MCR_TRC_9
 0x18000000

	)

871 
	#SH7750_MCR_TRC_12
 0x20000000

	)

872 
	#SH7750_MCR_TRC_15
 0x28000000

	)

873 
	#SH7750_MCR_TRC_18
 0x30000000

	)

874 
	#SH7750_MCR_TRC_21
 0x38000000

	)

876 
	#SH7750_MCR_TCAS
 0x00800000

	)

877 
	#SH7750_MCR_TCAS_1
 0x00000000

	)

878 
	#SH7750_MCR_TCAS_2
 0x00800000

	)

880 
	#SH7750_MCR_TPC
 0x00380000

	)

884 
	#SH7750_MCR_TPC_S
 19

	)

885 
	#SH7750_MCR_TPC_SDRAM_1
 0x00000000

	)

886 
	#SH7750_MCR_TPC_SDRAM_2
 0x00080000

	)

887 
	#SH7750_MCR_TPC_SDRAM_3
 0x00100000

	)

888 
	#SH7750_MCR_TPC_SDRAM_4
 0x00180000

	)

889 
	#SH7750_MCR_TPC_SDRAM_5
 0x00200000

	)

890 
	#SH7750_MCR_TPC_SDRAM_6
 0x00280000

	)

891 
	#SH7750_MCR_TPC_SDRAM_7
 0x00300000

	)

892 
	#SH7750_MCR_TPC_SDRAM_8
 0x00380000

	)

894 
	#SH7750_MCR_RCD
 0x00030000

	)

897 
	#SH7750_MCR_RCD_DRAM_2
 0x00000000

	)

898 
	#SH7750_MCR_RCD_DRAM_3
 0x00010000

	)

899 
	#SH7750_MCR_RCD_DRAM_4
 0x00020000

	)

900 
	#SH7750_MCR_RCD_DRAM_5
 0x00030000

	)

901 
	#SH7750_MCR_RCD_SDRAM_2
 0x00010000

	)

902 
	#SH7750_MCR_RCD_SDRAM_3
 0x00020000

	)

903 
	#SH7750_MCR_RCD_SDRAM_4
 0x00030000

	)

905 
	#SH7750_MCR_TRWL
 0x0000E000

	)

906 
	#SH7750_MCR_TRWL_1
 0x00000000

	)

907 
	#SH7750_MCR_TRWL_2
 0x00002000

	)

908 
	#SH7750_MCR_TRWL_3
 0x00004000

	)

909 
	#SH7750_MCR_TRWL_4
 0x00006000

	)

910 
	#SH7750_MCR_TRWL_5
 0x00008000

	)

912 
	#SH7750_MCR_TRAS
 0x00001C00

	)

916 
	#SH7750_MCR_TRAS_DRAM_2
 0x00000000

	)

917 
	#SH7750_MCR_TRAS_DRAM_3
 0x00000400

	)

918 
	#SH7750_MCR_TRAS_DRAM_4
 0x00000800

	)

919 
	#SH7750_MCR_TRAS_DRAM_5
 0x00000C00

	)

920 
	#SH7750_MCR_TRAS_DRAM_6
 0x00001000

	)

921 
	#SH7750_MCR_TRAS_DRAM_7
 0x00001400

	)

922 
	#SH7750_MCR_TRAS_DRAM_8
 0x00001800

	)

923 
	#SH7750_MCR_TRAS_DRAM_9
 0x00001C00

	)

925 
	#SH7750_MCR_TRAS_SDRAM_TRC_4
 0x00000000

	)

926 
	#SH7750_MCR_TRAS_SDRAM_TRC_5
 0x00000400

	)

927 
	#SH7750_MCR_TRAS_SDRAM_TRC_6
 0x00000800

	)

928 
	#SH7750_MCR_TRAS_SDRAM_TRC_7
 0x00000C00

	)

929 
	#SH7750_MCR_TRAS_SDRAM_TRC_8
 0x00001000

	)

930 
	#SH7750_MCR_TRAS_SDRAM_TRC_9
 0x00001400

	)

931 
	#SH7750_MCR_TRAS_SDRAM_TRC_10
 0x00001800

	)

932 
	#SH7750_MCR_TRAS_SDRAM_TRC_11
 0x00001C00

	)

934 
	#SH7750_MCR_BE
 0x00000200

	)

935 
	#SH7750_MCR_SZ
 0x00000180

	)

936 
	#SH7750_MCR_SZ_64
 0x00000000

	)

937 
	#SH7750_MCR_SZ_16
 0x00000100

	)

938 
	#SH7750_MCR_SZ_32
 0x00000180

	)

940 
	#SH7750_MCR_AMX
 0x00000078

	)

941 
	#SH7750_MCR_AMX_S
 3

	)

942 
	#SH7750_MCR_AMX_DRAM_8BIT_COL
 0x00000000

	)

943 
	#SH7750_MCR_AMX_DRAM_9BIT_COL
 0x00000008

	)

944 
	#SH7750_MCR_AMX_DRAM_10BIT_COL
 0x00000010

	)

945 
	#SH7750_MCR_AMX_DRAM_11BIT_COL
 0x00000018

	)

946 
	#SH7750_MCR_AMX_DRAM_12BIT_COL
 0x00000020

	)

949 
	#SH7750_MCR_RFSH
 0x00000004

	)

950 
	#SH7750_MCR_RMODE
 0x00000002

	)

951 
	#SH7750_MCR_RMODE_NORMAL
 0x00000000

	)

952 
	#SH7750_MCR_RMODE_SELF
 0x00000002

	)

953 
	#SH7750_MCR_RMODE_EDO
 0x00000001

	)

956 
	#SH7750_SDRAM_MODE_A2_BASE
 0xFF900000

	)

957 
	#SH7750_SDRAM_MODE_A3_BASE
 0xFF940000

	)

958 
	#SH7750_SDRAM_MODE_A2_32BIT
(
x
Ë(
SH7750_SDRAM_MODE_A2_BASE
 + ((xË<< 2))

	)

959 
	#SH7750_SDRAM_MODE_A3_32BIT
(
x
Ë(
SH7750_SDRAM_MODE_A3_BASE
 + ((xË<< 2))

	)

960 
	#SH7750_SDRAM_MODE_A2_64BIT
(
x
Ë(
SH7750_SDRAM_MODE_A2_BASE
 + ((xË<< 3))

	)

961 
	#SH7750_SDRAM_MODE_A3_64BIT
(
x
Ë(
SH7750_SDRAM_MODE_A3_BASE
 + ((xË<< 3))

	)

965 
	#SH7750_PCR_REGOFS
 0x800018

	)

966 
	#SH7750_PCR
 
	`SH7750_P4_REG32
(
SH7750_PCR_REGOFS
)

	)

967 
	#SH7750_PCR_A7
 
	`SH7750_A7_REG32
(
SH7750_PCR_REGOFS
)

	)

969 
	#SH7750_PCR_A5PCW
 0xC000

	)

973 
	#SH7750_PCR_A5PCW_0
 0x0000

	)

974 
	#SH7750_PCR_A5PCW_15
 0x4000

	)

975 
	#SH7750_PCR_A5PCW_30
 0x8000

	)

976 
	#SH7750_PCR_A5PCW_50
 0xC000

	)

978 
	#SH7750_PCR_A6PCW
 0x3000

	)

982 
	#SH7750_PCR_A6PCW_0
 0x0000

	)

983 
	#SH7750_PCR_A6PCW_15
 0x1000

	)

984 
	#SH7750_PCR_A6PCW_30
 0x2000

	)

985 
	#SH7750_PCR_A6PCW_50
 0x3000

	)

987 
	#SH7750_PCR_A5TED
 0x0E00

	)

991 
	#SH7750_PCR_A5TED_S
 9

	)

992 
	#SH7750_PCR_A6TED
 0x01C0

	)

993 
	#SH7750_PCR_A6TED_S
 6

	)

995 
	#SH7750_PCR_TED_0WS
 0

	)

996 
	#SH7750_PCR_TED_1WS
 1

	)

997 
	#SH7750_PCR_TED_2WS
 2

	)

998 
	#SH7750_PCR_TED_3WS
 3

	)

999 
	#SH7750_PCR_TED_6WS
 4

	)

1000 
	#SH7750_PCR_TED_9WS
 5

	)

1001 
	#SH7750_PCR_TED_12WS
 6

	)

1002 
	#SH7750_PCR_TED_15WS
 7

	)

1004 
	#SH7750_PCR_A5TEH
 0x0038

	)

1008 
	#SH7750_PCR_A5TEH_S
 3

	)

1010 
	#SH7750_PCR_A6TEH
 0x0007

	)

1011 
	#SH7750_PCR_A6TEH_S
 0

	)

1013 
	#SH7750_PCR_TEH_0WS
 0

	)

1014 
	#SH7750_PCR_TEH_1WS
 1

	)

1015 
	#SH7750_PCR_TEH_2WS
 2

	)

1016 
	#SH7750_PCR_TEH_3WS
 3

	)

1017 
	#SH7750_PCR_TEH_6WS
 4

	)

1018 
	#SH7750_PCR_TEH_9WS
 5

	)

1019 
	#SH7750_PCR_TEH_12WS
 6

	)

1020 
	#SH7750_PCR_TEH_15WS
 7

	)

1023 
	#SH7750_RTCSR_REGOFS
 0x80001C

	)

1024 
	#SH7750_RTCSR
 
	`SH7750_P4_REG32
(
SH7750_RTCSR_REGOFS
)

	)

1025 
	#SH7750_RTCSR_A7
 
	`SH7750_A7_REG32
(
SH7750_RTCSR_REGOFS
)

	)

1027 
	#SH7750_RTCSR_KEY
 0xA500

	)

1028 
	#SH7750_RTCSR_CMF
 0x0080

	)

1031 
	#SH7750_RTCSR_CMIE
 0x0040

	)

1032 
	#SH7750_RTCSR_CKS
 0x0038

	)

1033 
	#SH7750_RTCSR_CKS_DIS
 0x0000

	)

1034 
	#SH7750_RTCSR_CKS_CKIO_DIV4
 0x0008

	)

1035 
	#SH7750_RTCSR_CKS_CKIO_DIV16
 0x0010

	)

1036 
	#SH7750_RTCSR_CKS_CKIO_DIV64
 0x0018

	)

1037 
	#SH7750_RTCSR_CKS_CKIO_DIV256
 0x0020

	)

1038 
	#SH7750_RTCSR_CKS_CKIO_DIV1024
 0x0028

	)

1039 
	#SH7750_RTCSR_CKS_CKIO_DIV2048
 0x0030

	)

1040 
	#SH7750_RTCSR_CKS_CKIO_DIV4096
 0x0038

	)

1042 
	#SH7750_RTCSR_OVF
 0x0004

	)

1043 
	#SH7750_RTCSR_OVIE
 0x0002

	)

1045 
	#SH7750_RTCSR_LMTS
 0x0001

	)

1046 
	#SH7750_RTCSR_LMTS_1024
 0x0000

	)

1047 
	#SH7750_RTCSR_LMTS_512
 0x0001

	)

1050 
	#SH7750_RTCNT_REGOFS
 0x800020

	)

1051 
	#SH7750_RTCNT
 
	`SH7750_P4_REG32
(
SH7750_RTCNT_REGOFS
)

	)

1052 
	#SH7750_RTCNT_A7
 
	`SH7750_A7_REG32
(
SH7750_RTCNT_REGOFS
)

	)

1054 
	#SH7750_RTCNT_KEY
 0xA500

	)

1057 
	#SH7750_RTCOR_REGOFS
 0x800024

	)

1058 
	#SH7750_RTCOR
 
	`SH7750_P4_REG32
(
SH7750_RTCOR_REGOFS
)

	)

1059 
	#SH7750_RTCOR_A7
 
	`SH7750_A7_REG32
(
SH7750_RTCOR_REGOFS
)

	)

1061 
	#SH7750_RTCOR_KEY
 0xA500

	)

1064 
	#SH7750_RFCR_REGOFS
 0x800028

	)

1065 
	#SH7750_RFCR
 
	`SH7750_P4_REG32
(
SH7750_RFCR_REGOFS
)

	)

1066 
	#SH7750_RFCR_A7
 
	`SH7750_A7_REG32
(
SH7750_RFCR_REGOFS
)

	)

1068 
	#SH7750_RFCR_KEY
 0xA400

	)

1075 
	#SH7750_SAR_REGOFS
(
n
Ë(0xA00000 + (“)*16)Ë

	)

1076 
	#SH7750_SAR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_SAR_REGOFS
“))

	)

1077 
	#SH7750_SAR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_SAR_REGOFS
“))

	)

1078 
	#SH7750_SAR0
 
	`SH7750_SAR
(0)

	)

1079 
	#SH7750_SAR1
 
	`SH7750_SAR
(1)

	)

1080 
	#SH7750_SAR2
 
	`SH7750_SAR
(2)

	)

1081 
	#SH7750_SAR3
 
	`SH7750_SAR
(3)

	)

1082 
	#SH7750_SAR0_A7
 
	`SH7750_SAR_A7
(0)

	)

1083 
	#SH7750_SAR1_A7
 
	`SH7750_SAR_A7
(1)

	)

1084 
	#SH7750_SAR2_A7
 
	`SH7750_SAR_A7
(2)

	)

1085 
	#SH7750_SAR3_A7
 
	`SH7750_SAR_A7
(3)

	)

1088 
	#SH7750_DAR_REGOFS
(
n
Ë(0xA00004 + (“)*16)Ë

	)

1089 
	#SH7750_DAR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_DAR_REGOFS
“))

	)

1090 
	#SH7750_DAR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_DAR_REGOFS
“))

	)

1091 
	#SH7750_DAR0
 
	`SH7750_DAR
(0)

	)

1092 
	#SH7750_DAR1
 
	`SH7750_DAR
(1)

	)

1093 
	#SH7750_DAR2
 
	`SH7750_DAR
(2)

	)

1094 
	#SH7750_DAR3
 
	`SH7750_DAR
(3)

	)

1095 
	#SH7750_DAR0_A7
 
	`SH7750_DAR_A7
(0)

	)

1096 
	#SH7750_DAR1_A7
 
	`SH7750_DAR_A7
(1)

	)

1097 
	#SH7750_DAR2_A7
 
	`SH7750_DAR_A7
(2)

	)

1098 
	#SH7750_DAR3_A7
 
	`SH7750_DAR_A7
(3)

	)

1101 
	#SH7750_DMATCR_REGOFS
(
n
Ë(0xA00008 + (“)*16)Ë

	)

1102 
	#SH7750_DMATCR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_DMATCR_REGOFS
“))

	)

1103 
	#SH7750_DMATCR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_DMATCR_REGOFS
“))

	)

1104 
	#SH7750_DMATCR0_P4
 
	`SH7750_DMATCR
(0)

	)

1105 
	#SH7750_DMATCR1_P4
 
	`SH7750_DMATCR
(1)

	)

1106 
	#SH7750_DMATCR2_P4
 
	`SH7750_DMATCR
(2)

	)

1107 
	#SH7750_DMATCR3_P4
 
	`SH7750_DMATCR
(3)

	)

1108 
	#SH7750_DMATCR0_A7
 
	`SH7750_DMATCR_A7
(0)

	)

1109 
	#SH7750_DMATCR1_A7
 
	`SH7750_DMATCR_A7
(1)

	)

1110 
	#SH7750_DMATCR2_A7
 
	`SH7750_DMATCR_A7
(2)

	)

1111 
	#SH7750_DMATCR3_A7
 
	`SH7750_DMATCR_A7
(3)

	)

1114 
	#SH7750_CHCR_REGOFS
(
n
Ë(0xA0000C + (“)*16)Ë

	)

1115 
	#SH7750_CHCR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_CHCR_REGOFS
“))

	)

1116 
	#SH7750_CHCR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_CHCR_REGOFS
“))

	)

1117 
	#SH7750_CHCR0
 
	`SH7750_CHCR
(0)

	)

1118 
	#SH7750_CHCR1
 
	`SH7750_CHCR
(1)

	)

1119 
	#SH7750_CHCR2
 
	`SH7750_CHCR
(2)

	)

1120 
	#SH7750_CHCR3
 
	`SH7750_CHCR
(3)

	)

1121 
	#SH7750_CHCR0_A7
 
	`SH7750_CHCR_A7
(0)

	)

1122 
	#SH7750_CHCR1_A7
 
	`SH7750_CHCR_A7
(1)

	)

1123 
	#SH7750_CHCR2_A7
 
	`SH7750_CHCR_A7
(2)

	)

1124 
	#SH7750_CHCR3_A7
 
	`SH7750_CHCR_A7
(3)

	)

1126 
	#SH7750_CHCR_SSA
 0xE0000000

	)

1127 
	#SH7750_CHCR_SSA_PCMCIA
 0x00000000

	)

1128 
	#SH7750_CHCR_SSA_DYNBSZ
 0x20000000

	)

1129 
	#SH7750_CHCR_SSA_IO8
 0x40000000

	)

1130 
	#SH7750_CHCR_SSA_IO16
 0x60000000

	)

1131 
	#SH7750_CHCR_SSA_CMEM8
 0x80000000

	)

1132 
	#SH7750_CHCR_SSA_CMEM16
 0xA0000000

	)

1133 
	#SH7750_CHCR_SSA_AMEM8
 0xC0000000

	)

1134 
	#SH7750_CHCR_SSA_AMEM16
 0xE0000000

	)

1136 
	#SH7750_CHCR_STC
 0x10000000

	)

1140 
	#SH7750_CHCR_DSA
 0x0E000000

	)

1141 
	#SH7750_CHCR_DSA_PCMCIA
 0x00000000

	)

1142 
	#SH7750_CHCR_DSA_DYNBSZ
 0x02000000

	)

1143 
	#SH7750_CHCR_DSA_IO8
 0x04000000

	)

1144 
	#SH7750_CHCR_DSA_IO16
 0x06000000

	)

1145 
	#SH7750_CHCR_DSA_CMEM8
 0x08000000

	)

1146 
	#SH7750_CHCR_DSA_CMEM16
 0x0A000000

	)

1147 
	#SH7750_CHCR_DSA_AMEM8
 0x0C000000

	)

1148 
	#SH7750_CHCR_DSA_AMEM16
 0x0E000000

	)

1150 
	#SH7750_CHCR_DTC
 0x01000000

	)

1155 
	#SH7750_CHCR_DS
 0x00080000

	)

1156 
	#SH7750_CHCR_DS_LOWLVL
 0x00000000

	)

1157 
	#SH7750_CHCR_DS_FALL
 0x00080000

	)

1159 
	#SH7750_CHCR_RL
 0x00040000

	)

1160 
	#SH7750_CHCR_RL_ACTH
 0x00000000

	)

1161 
	#SH7750_CHCR_RL_ACTL
 0x00040000

	)

1163 
	#SH7750_CHCR_AM
 0x00020000

	)

1164 
	#SH7750_CHCR_AM_RD
 0x00000000

	)

1165 
	#SH7750_CHCR_AM_WR
 0x00020000

	)

1167 
	#SH7750_CHCR_AL
 0x00010000

	)

1168 
	#SH7750_CHCR_AL_ACTH
 0x00000000

	)

1169 
	#SH7750_CHCR_AL_ACTL
 0x00010000

	)

1171 
	#SH7750_CHCR_DM
 0x0000C000

	)

1172 
	#SH7750_CHCR_DM_FIX
 0x00000000

	)

1173 
	#SH7750_CHCR_DM_INC
 0x00004000

	)

1174 
	#SH7750_CHCR_DM_DEC
 0x00008000

	)

1176 
	#SH7750_CHCR_SM
 0x00003000

	)

1177 
	#SH7750_CHCR_SM_FIX
 0x00000000

	)

1178 
	#SH7750_CHCR_SM_INC
 0x00001000

	)

1179 
	#SH7750_CHCR_SM_DEC
 0x00002000

	)

1181 
	#SH7750_CHCR_RS
 0x00000F00

	)

1182 
	#SH7750_CHCR_RS_ER_DA_EA_TO_EA
 0x000

	)

1185 
	#SH7750_CHCR_RS_ER_SA_EA_TO_ED
 0x200

	)

1188 
	#SH7750_CHCR_RS_ER_SA_ED_TO_EA
 0x300

	)

1192 
	#SH7750_CHCR_RS_AR_EA_TO_EA
 0x400

	)

1195 
	#SH7750_CHCR_RS_AR_EA_TO_OCP
 0x500

	)

1198 
	#SH7750_CHCR_RS_AR_OCP_TO_EA
 0x600

	)

1201 
	#SH7750_CHCR_RS_SCITX_EA_TO_SC
 0x800

	)

1204 
	#SH7750_CHCR_RS_SCIRX_SC_TO_EA
 0x900

	)

1207 
	#SH7750_CHCR_RS_SCIFTX_EA_TO_SC
 0xA00

	)

1210 
	#SH7750_CHCR_RS_SCIFRX_SC_TO_EA
 0xB00

	)

1213 
	#SH7750_CHCR_RS_TMU2_EA_TO_EA
 0xC00

	)

1217 
	#SH7750_CHCR_RS_TMU2_EA_TO_OCP
 0xD00

	)

1221 
	#SH7750_CHCR_RS_TMU2_OCP_TO_EA
 0xE00

	)

1226 
	#SH7750_CHCR_TM
 0x00000080

	)

1227 
	#SH7750_CHCR_TM_CSTEAL
 0x00000000

	)

1228 
	#SH7750_CHCR_TM_BURST
 0x00000080

	)

1230 
	#SH7750_CHCR_TS
 0x00000070

	)

1231 
	#SH7750_CHCR_TS_QUAD
 0x00000000

	)

1232 
	#SH7750_CHCR_TS_BYTE
 0x00000010

	)

1233 
	#SH7750_CHCR_TS_WORD
 0x00000020

	)

1234 
	#SH7750_CHCR_TS_LONG
 0x00000030

	)

1235 
	#SH7750_CHCR_TS_BLOCK
 0x00000040

	)

1237 
	#SH7750_CHCR_IE
 0x00000004

	)

1238 
	#SH7750_CHCR_TE
 0x00000002

	)

1239 
	#SH7750_CHCR_DE
 0x00000001

	)

1242 
	#SH7750_DMAOR_REGOFS
 0xA00040

	)

1243 
	#SH7750_DMAOR
 
	`SH7750_P4_REG32
(
SH7750_DMAOR_REGOFS
)

	)

1244 
	#SH7750_DMAOR_A7
 
	`SH7750_A7_REG32
(
SH7750_DMAOR_REGOFS
)

	)

1246 
	#SH7750_DMAOR_DDT
 0x00008000

	)

1248 
	#SH7750_DMAOR_PR
 0x00000300

	)

1249 
	#SH7750_DMAOR_PR_0123
 0x00000000

	)

1250 
	#SH7750_DMAOR_PR_0231
 0x00000100

	)

1251 
	#SH7750_DMAOR_PR_2013
 0x00000200

	)

1252 
	#SH7750_DMAOR_PR_RR
 0x00000300

	)

1254 
	#SH7750_DMAOR_COD
 0x00000010

	)

1255 
	#SH7750_DMAOR_AE
 0x00000004

	)

1256 
	#SH7750_DMAOR_NMIF
 0x00000002

	)

1257 
	#SH7750_DMAOR_DME
 0x00000001

	)

1264 
	#SH7750_SCRDR_REGOFS
(
n
Ë(“Ë=1 ? 0xE00014 : 0xE80014Ë

	)

1265 
	#SH7750_SCRDR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_SCRDR_REGOFS
“))

	)

1266 
	#SH7750_SCRDR1
 
	`SH7750_SCRDR
(1)

	)

1267 
	#SH7750_SCRDR2
 
	`SH7750_SCRDR
(2)

	)

1268 
	#SH7750_SCRDR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_SCRDR_REGOFS
“))

	)

1269 
	#SH7750_SCRDR1_A7
 
	`SH7750_SCRDR_A7
(1)

	)

1270 
	#SH7750_SCRDR2_A7
 
	`SH7750_SCRDR_A7
(2)

	)

1273 
	#SH7750_SCTDR_REGOFS
(
n
Ë(“Ë=1 ? 0xE0000C : 0xE8000CË

	)

1274 
	#SH7750_SCTDR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_SCTDR_REGOFS
“))

	)

1275 
	#SH7750_SCTDR1
 
	`SH7750_SCTDR
(1)

	)

1276 
	#SH7750_SCTDR2
 
	`SH7750_SCTDR
(2)

	)

1277 
	#SH7750_SCTDR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_SCTDR_REGOFS
“))

	)

1278 
	#SH7750_SCTDR1_A7
 
	`SH7750_SCTDR_A7
(1)

	)

1279 
	#SH7750_SCTDR2_A7
 
	`SH7750_SCTDR_A7
(2)

	)

1282 
	#SH7750_SCSMR_REGOFS
(
n
Ë(“Ë=1 ? 0xE00000 : 0xE80000Ë

	)

1283 
	#SH7750_SCSMR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_SCSMR_REGOFS
“))

	)

1284 
	#SH7750_SCSMR1
 
	`SH7750_SCSMR
(1)

	)

1285 
	#SH7750_SCSMR2
 
	`SH7750_SCSMR
(2)

	)

1286 
	#SH7750_SCSMR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_SCSMR_REGOFS
“))

	)

1287 
	#SH7750_SCSMR1_A7
 
	`SH7750_SCSMR_A7
(1)

	)

1288 
	#SH7750_SCSMR2_A7
 
	`SH7750_SCSMR_A7
(2)

	)

1290 
	#SH7750_SCSMR1_CA
 0x80

	)

1291 
	#SH7750_SCSMR1_CA_ASYNC
 0x00

	)

1292 
	#SH7750_SCSMR1_CA_SYNC
 0x80

	)

1293 
	#SH7750_SCSMR_CHR
 0x40

	)

1294 
	#SH7750_SCSMR_CHR_8
 0x00

	)

1295 
	#SH7750_SCSMR_CHR_7
 0x40

	)

1296 
	#SH7750_SCSMR_PE
 0x20

	)

1297 
	#SH7750_SCSMR_PM
 0x10

	)

1298 
	#SH7750_SCSMR_PM_EVEN
 0x00

	)

1299 
	#SH7750_SCSMR_PM_ODD
 0x10

	)

1300 
	#SH7750_SCSMR_STOP
 0x08

	)

1301 
	#SH7750_SCSMR_STOP_1
 0x00

	)

1302 
	#SH7750_SCSMR_STOP_2
 0x08

	)

1303 
	#SH7750_SCSMR1_MP
 0x04

	)

1304 
	#SH7750_SCSMR_CKS
 0x03

	)

1305 
	#SH7750_SCSMR_CKS_S
 0

	)

1306 
	#SH7750_SCSMR_CKS_DIV1
 0x00

	)

1307 
	#SH7750_SCSMR_CKS_DIV4
 0x01

	)

1308 
	#SH7750_SCSMR_CKS_DIV16
 0x02

	)

1309 
	#SH7750_SCSMR_CKS_DIV64
 0x03

	)

1312 
	#SH7750_SCSCR_REGOFS
(
n
Ë(“Ë=1 ? 0xE00008 : 0xE80008Ë

	)

1313 
	#SH7750_SCSCR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_SCSCR_REGOFS
“))

	)

1314 
	#SH7750_SCSCR1
 
	`SH7750_SCSCR
(1)

	)

1315 
	#SH7750_SCSCR2
 
	`SH7750_SCSCR
(2)

	)

1316 
	#SH7750_SCSCR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_SCSCR_REGOFS
“))

	)

1317 
	#SH7750_SCSCR1_A7
 
	`SH7750_SCSCR_A7
(1)

	)

1318 
	#SH7750_SCSCR2_A7
 
	`SH7750_SCSCR_A7
(2)

	)

1320 
	#SH7750_SCSCR_TIE
 0x80

	)

1321 
	#SH7750_SCSCR_RIE
 0x40

	)

1322 
	#SH7750_SCSCR_TE
 0x20

	)

1323 
	#SH7750_SCSCR_RE
 0x10

	)

1324 
	#SH7750_SCSCR1_MPIE
 0x08

	)

1325 
	#SH7750_SCSCR2_REIE
 0x08

	)

1326 
	#SH7750_SCSCR1_TEIE
 0x04

	)

1327 
	#SH7750_SCSCR1_CKE
 0x03

	)

1328 
	#SH7750_SCSCR_CKE_INTCLK
 0x00

	)

1329 
	#SH7750_SCSCR_CKE_EXTCLK
 0x02

	)

1330 
	#SH7750_SCSCR1_CKE_ASYNC_SCK_CLKOUT
 0x01

	)

1334 
	#SH7750_SCSSR_REGOFS
(
n
Ë(“Ë=1 ? 0xE00010 : 0xE80010Ë

	)

1335 
	#SH7750_SCSSR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_SCSSR_REGOFS
“))

	)

1336 
	#SH7750_SCSSR1
 
	`SH7750_SCSSR
(1)

	)

1337 
	#SH7750_SCSFR2
 
	`SH7750_SCSSR
(2)

	)

1338 
	#SH7750_SCSSR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_SCSSR_REGOFS
“))

	)

1339 
	#SH7750_SCSSR1_A7
 
	`SH7750_SCSSR_A7
(1)

	)

1340 
	#SH7750_SCSFR2_A7
 
	`SH7750_SCSSR_A7
(2)

	)

1342 
	#SH7750_SCSSR1_TDRE
 0x80

	)

1343 
	#SH7750_SCSSR1_RDRF
 0x40

	)

1344 
	#SH7750_SCSSR1_ORER
 0x20

	)

1345 
	#SH7750_SCSSR1_FER
 0x10

	)

1346 
	#SH7750_SCSSR1_PER
 0x08

	)

1347 
	#SH7750_SCSSR1_TEND
 0x04

	)

1348 
	#SH7750_SCSSR1_MPB
 0x02

	)

1349 
	#SH7750_SCSSR1_MPBT
 0x01

	)

1351 
	#SH7750_SCFSR2_PERN
 0xF000

	)

1352 
	#SH7750_SCFSR2_PERN_S
 12

	)

1353 
	#SH7750_SCFSR2_FERN
 0x0F00

	)

1354 
	#SH7750_SCFSR2_FERN_S
 8

	)

1355 
	#SH7750_SCFSR2_ER
 0x0080

	)

1356 
	#SH7750_SCFSR2_TEND
 0x0040

	)

1357 
	#SH7750_SCFSR2_TDFE
 0x0020

	)

1358 
	#SH7750_SCFSR2_BRK
 0x0010

	)

1359 
	#SH7750_SCFSR2_FER
 0x0008

	)

1360 
	#SH7750_SCFSR2_PER
 0x0004

	)

1361 
	#SH7750_SCFSR2_RDF
 0x0002

	)

1362 
	#SH7750_SCFSR2_DR
 0x0001

	)

1365 
	#SH7750_SCSPTR1_REGOFS
 0xE0001C

	)

1366 
	#SH7750_SCSPTR1
 
	`SH7750_P4_REG32
(
SH7750_SCSPTR1_REGOFS
)

	)

1367 
	#SH7750_SCSPTR1_A7
 
	`SH7750_A7_REG32
(
SH7750_SCSPTR1_REGOFS
)

	)

1369 
	#SH7750_SCSPTR1_EIO
 0x80

	)

1370 
	#SH7750_SCSPTR1_SPB1IO
 0x08

	)

1371 
	#SH7750_SCSPTR1_SPB1DT
 0x04

	)

1372 
	#SH7750_SCSPTR1_SPB0IO
 0x02

	)

1373 
	#SH7750_SCSPTR1_SPB0DT
 0x01

	)

1376 
	#SH7750_SCSPTR2_REGOFS
 0xE80020

	)

1377 
	#SH7750_SCSPTR2
 
	`SH7750_P4_REG32
(
SH7750_SCSPTR2_REGOFS
)

	)

1378 
	#SH7750_SCSPTR2_A7
 
	`SH7750_A7_REG32
(
SH7750_SCSPTR2_REGOFS
)

	)

1380 
	#SH7750_SCSPTR2_RTSIO
 0x80

	)

1381 
	#SH7750_SCSPTR2_RTSDT
 0x40

	)

1382 
	#SH7750_SCSPTR2_CTSIO
 0x20

	)

1383 
	#SH7750_SCSPTR2_CTSDT
 0x10

	)

1384 
	#SH7750_SCSPTR2_SPB2IO
 0x02

	)

1385 
	#SH7750_SCSPTR2_SPB2DT
 0x01

	)

1388 
	#SH7750_SCBRR_REGOFS
(
n
Ë(“Ë=1 ? 0xE00004 : 0xE80004Ë

	)

1389 
	#SH7750_SCBRR
(
n
Ë
	`SH7750_P4_REG32
(
	`SH7750_SCBRR_REGOFS
“))

	)

1390 
	#SH7750_SCBRR1
 
	`SH7750_SCBRR_P4
(1)

	)

1391 
	#SH7750_SCBRR2
 
	`SH7750_SCBRR_P4
(2)

	)

1392 
	#SH7750_SCBRR_A7
(
n
Ë
	`SH7750_A7_REG32
(
	`SH7750_SCBRR_REGOFS
“))

	)

1393 
	#SH7750_SCBRR1_A7
 
	`SH7750_SCBRR_A7
(1)

	)

1394 
	#SH7750_SCBRR2_A7
 
	`SH7750_SCBRR_A7
(2)

	)

1397 
	#SH7750_SCFCR2_REGOFS
 0xE80018

	)

1398 
	#SH7750_SCFCR2
 
	`SH7750_P4_REG32
(
SH7750_SCFCR2_REGOFS
)

	)

1399 
	#SH7750_SCFCR2_A7
 
	`SH7750_A7_REG32
(
SH7750_SCFCR2_REGOFS
)

	)

1401 
	#SH7750_SCFCR2_RSTRG
 0x700

	)

1405 
	#SH7750_SCFCR2_RSTRG_15
 0x000

	)

1406 
	#SH7750_SCFCR2_RSTRG_1
 0x000

	)

1407 
	#SH7750_SCFCR2_RSTRG_4
 0x000

	)

1408 
	#SH7750_SCFCR2_RSTRG_6
 0x000

	)

1409 
	#SH7750_SCFCR2_RSTRG_8
 0x000

	)

1410 
	#SH7750_SCFCR2_RSTRG_10
 0x000

	)

1411 
	#SH7750_SCFCR2_RSTRG_14
 0x000

	)

1413 
	#SH7750_SCFCR2_RTRG
 0x0C0

	)

1418 
	#SH7750_SCFCR2_RTRG_1
 0x000

	)

1419 
	#SH7750_SCFCR2_RTRG_4
 0x040

	)

1420 
	#SH7750_SCFCR2_RTRG_8
 0x080

	)

1421 
	#SH7750_SCFCR2_RTRG_14
 0x0C0

	)

1423 
	#SH7750_SCFCR2_TTRG
 0x030

	)

1428 
	#SH7750_SCFCR2_TTRG_8
 0x000

	)

1429 
	#SH7750_SCFCR2_TTRG_4
 0x010

	)

1430 
	#SH7750_SCFCR2_TTRG_2
 0x020

	)

1431 
	#SH7750_SCFCR2_TTRG_1
 0x030

	)

1433 
	#SH7750_SCFCR2_MCE
 0x008

	)

1434 
	#SH7750_SCFCR2_TFRST
 0x004

	)

1437 
	#SH7750_SCFCR2_RFRST
 0x002

	)

1441 
	#SH7750_SCFCR2_LOOP
 0x001

	)

1444 
	#SH7750_SCFDR2_REGOFS
 0xE8001C

	)

1445 
	#SH7750_SCFDR2
 
	`SH7750_P4_REG32
(
SH7750_SCFDR2_REGOFS
)

	)

1446 
	#SH7750_SCFDR2_A7
 
	`SH7750_A7_REG32
(
SH7750_SCFDR2_REGOFS
)

	)

1448 
	#SH7750_SCFDR2_T
 0x1F00

	)

1450 
	#SH7750_SCFDR2_T_S
 8

	)

1451 
	#SH7750_SCFDR2_R
 0x001F

	)

1453 
	#SH7750_SCFDR2_R_S
 0

	)

1456 
	#SH7750_SCLSR2_REGOFS
 0xE80024

	)

1457 
	#SH7750_SCLSR2
 
	`SH7750_P4_REG32
(
SH7750_SCLSR2_REGOFS
)

	)

1458 
	#SH7750_SCLSR2_A7
 
	`SH7750_A7_REG32
(
SH7750_SCLSR2_REGOFS
)

	)

1460 
	#SH7750_SCLSR2_ORER
 0x0001

	)

1466 
	#SH7750_SCSCMR1_REGOFS
 0xE00018

	)

1467 
	#SH7750_SCSCMR1
 
	`SH7750_P4_REG32
(
SH7750_SCSCMR1_REGOFS
)

	)

1468 
	#SH7750_SCSCMR1_A7
 
	`SH7750_A7_REG32
(
SH7750_SCSCMR1_REGOFS
)

	)

1470 
	#SH7750_SCSCMR1_SDIR
 0x08

	)

1471 
	#SH7750_SCSCMR1_SDIR_LSBF
 0x00

	)

1472 
	#SH7750_SCSCMR1_SDIR_MSBF
 0x08

	)

1474 
	#SH7750_SCSCMR1_SINV
 0x04

	)

1475 
	#SH7750_SCSCMR1_SMIF
 0x01

	)

1479 
	#SH7750_SCSMR1_GSM
 0x80

	)

1482 
	#SH7750_SCSSR1_ERS
 0x10

	)

1488 
	#SH7750_PCTRA_REGOFS
 0x80002C

	)

1489 
	#SH7750_PCTRA
 
	`SH7750_P4_REG32
(
SH7750_PCTRA_REGOFS
)

	)

1490 
	#SH7750_PCTRA_A7
 
	`SH7750_A7_REG32
(
SH7750_PCTRA_REGOFS
)

	)

1492 
	#SH7750_PCTRA_PBPUP
(
n
Ë0

	)

1493 
	#SH7750_PCTRA_PBNPUP
(
n
Ë(1 << (“)*2+1)Ë

	)

1494 
	#SH7750_PCTRA_PBINP
(
n
Ë0

	)

1495 
	#SH7750_PCTRA_PBOUT
(
n
Ë(1 << (“)*2)Ë

	)

1498 
	#SH7750_PDTRA_REGOFS
 0x800030

	)

1499 
	#SH7750_PDTRA
 
	`SH7750_P4_REG32
(
SH7750_PDTRA_REGOFS
)

	)

1500 
	#SH7750_PDTRA_A7
 
	`SH7750_A7_REG32
(
SH7750_PDTRA_REGOFS
)

	)

1502 
	#SH7750_PDTRA_BIT
(
n
Ë(1 << (n))

	)

1505 
	#SH7750_PCTRB_REGOFS
 0x800040

	)

1506 
	#SH7750_PCTRB
 
	`SH7750_P4_REG32
(
SH7750_PCTRB_REGOFS
)

	)

1507 
	#SH7750_PCTRB_A7
 
	`SH7750_A7_REG32
(
SH7750_PCTRB_REGOFS
)

	)

1509 
	#SH7750_PCTRB_PBPUP
(
n
Ë0

	)

1510 
	#SH7750_PCTRB_PBNPUP
(
n
Ë(1 << (“-16)*2+1)Ë

	)

1511 
	#SH7750_PCTRB_PBINP
(
n
Ë0

	)

1512 
	#SH7750_PCTRB_PBOUT
(
n
Ë(1 << (“-16)*2)Ë

	)

1515 
	#SH7750_PDTRB_REGOFS
 0x800044

	)

1516 
	#SH7750_PDTRB
 
	`SH7750_P4_REG32
(
SH7750_PDTRB_REGOFS
)

	)

1517 
	#SH7750_PDTRB_A7
 
	`SH7750_A7_REG32
(
SH7750_PDTRB_REGOFS
)

	)

1519 
	#SH7750_PDTRB_BIT
(
n
Ë(1 << (“)-16))

	)

1522 
	#SH7750_GPIOIC_REGOFS
 0x800048

	)

1523 
	#SH7750_GPIOIC
 
	`SH7750_P4_REG32
(
SH7750_GPIOIC_REGOFS
)

	)

1524 
	#SH7750_GPIOIC_A7
 
	`SH7750_A7_REG32
(
SH7750_GPIOIC_REGOFS
)

	)

1526 
	#SH7750_GPIOIC_PTIREN
(
n
Ë(1 << (n)Ë

	)

1532 
	#SH7750_ICR_REGOFS
 0xD00000

	)

1533 
	#SH7750_ICR
 
	`SH7750_P4_REG32
(
SH7750_ICR_REGOFS
)

	)

1534 
	#SH7750_ICR_A7
 
	`SH7750_A7_REG32
(
SH7750_ICR_REGOFS
)

	)

1536 
	#SH7750_ICR_NMIL
 0x8000

	)

1537 
	#SH7750_ICR_MAI
 0x4000

	)

1539 
	#SH7750_ICR_NMIB
 0x0200

	)

1540 
	#SH7750_ICR_NMIB_BLK
 0x0000

	)

1542 
	#SH7750_ICR_NMIB_NBLK
 0x0200

	)

1545 
	#SH7750_ICR_NMIE
 0x0100

	)

1546 
	#SH7750_ICR_NMIE_FALL
 0x0000

	)

1548 
	#SH7750_ICR_NMIE_RISE
 0x0100

	)

1551 
	#SH7750_ICR_IRLM
 0x0080

	)

1552 
	#SH7750_ICR_IRLM_ENC
 0x0000

	)

1554 
	#SH7750_ICR_IRLM_RAW
 0x0080

	)

1558 
	#SH7750_IPRA_REGOFS
 0xD00004

	)

1559 
	#SH7750_IPRA
 
	`SH7750_P4_REG32
(
SH7750_IPRA_REGOFS
)

	)

1560 
	#SH7750_IPRA_A7
 
	`SH7750_A7_REG32
(
SH7750_IPRA_REGOFS
)

	)

1562 
	#SH7750_IPRA_TMU0
 0xF000

	)

1563 
	#SH7750_IPRA_TMU0_S
 12

	)

1564 
	#SH7750_IPRA_TMU1
 0x0F00

	)

1565 
	#SH7750_IPRA_TMU1_S
 8

	)

1566 
	#SH7750_IPRA_TMU2
 0x00F0

	)

1567 
	#SH7750_IPRA_TMU2_S
 4

	)

1568 
	#SH7750_IPRA_RTC
 0x000F

	)

1569 
	#SH7750_IPRA_RTC_S
 0

	)

1572 
	#SH7750_IPRB_REGOFS
 0xD00008

	)

1573 
	#SH7750_IPRB
 
	`SH7750_P4_REG32
(
SH7750_IPRB_REGOFS
)

	)

1574 
	#SH7750_IPRB_A7
 
	`SH7750_A7_REG32
(
SH7750_IPRB_REGOFS
)

	)

1576 
	#SH7750_IPRB_WDT
 0xF000

	)

1577 
	#SH7750_IPRB_WDT_S
 12

	)

1578 
	#SH7750_IPRB_REF
 0x0F00

	)

1580 
	#SH7750_IPRB_REF_S
 8

	)

1581 
	#SH7750_IPRB_SCI1
 0x00F0

	)

1582 
	#SH7750_IPRB_SCI1_S
 4

	)

1585 
	#SH7750_IPRC_REGOFS
 0xD00004

	)

1586 
	#SH7750_IPRC
 
	`SH7750_P4_REG32
(
SH7750_IPRC_REGOFS
)

	)

1587 
	#SH7750_IPRC_A7
 
	`SH7750_A7_REG32
(
SH7750_IPRC_REGOFS
)

	)

1589 
	#SH7750_IPRC_GPIO
 0xF000

	)

1590 
	#SH7750_IPRC_GPIO_S
 12

	)

1591 
	#SH7750_IPRC_DMAC
 0x0F00

	)

1592 
	#SH7750_IPRC_DMAC_S
 8

	)

1593 
	#SH7750_IPRC_SCIF
 0x00F0

	)

1594 
	#SH7750_IPRC_SCIF_S
 4

	)

1595 
	#SH7750_IPRC_HUDI
 0x000F

	)

1596 
	#SH7750_IPRC_HUDI_S
 0

	)

1602 
	#SH7750_BARA
 0x200000

	)

1603 
	#SH7750_BAMRA
 0x200004

	)

1604 
	#SH7750_BBRA
 0x200008

	)

1605 
	#SH7750_BARB
 0x20000¯

	)

1606 
	#SH7750_BAMRB
 0x200010

	)

1607 
	#SH7750_BBRB
 0x200014

	)

1608 
	#SH7750_BASRB
 0x000018

	)

1609 
	#SH7750_BDRB
 0x200018

	)

1610 
	#SH7750_BDMRB
 0x20001¯

	)

1611 
	#SH7750_BRCR
 0x200020

	)

1613 
	#SH7750_BRCR_UDBE
 0x0001

	)

1618 
	#SH7750_BCR3_A7
 0x1f800050

	)

1619 
	#SH7750_BCR4_A7
 0x1e0a00f0

	)

1620 
	#SH7750_PRECHARGE0_A7
 0x1f900088

	)

1621 
	#SH7750_PRECHARGE1_A7
 0x1f940088

	)

	@shix.c

30 
	~"vl.h
"

32 
	#BIOS_FILENAME
 "shix_bios.bö"

	)

33 
	#BIOS_ADDRESS
 0xA0000000

	)

35 
	$DMA_run
()

38 
	}
}

40 
	$úq_öfo
()

43 
	}
}

45 
	$pic_£t_úq
(
úq
, 
Àvñ
)

48 
	}
}

50 
	$pic_öfo
()

53 
	}
}

55 
	$vga_upd©e_di•œy
()

58 
	}
}

60 
	$vga_övÆid©e_di•œy
()

63 
	}
}

65 
	$vga_s¸ìn_dump
(c⁄° *
fûíame
)

68 
	}
}

70 
	$shix_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

71 
Di•œySèã
 * 
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

72 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

73 c⁄° *
öôrd_fûíame
)

75 
ªt
;

76 
CPUSèã
 *
ív
;

77 
SH7750Sèã
 *
s
;

79 
	`¥ötf
("Initializing CPU\n");

80 
ív
 = 
	`˝u_öô
();

83 
	`¥ötf
("Allocating ROM\n");

84 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x00000000, 0x00004000, 
IO_MEM_ROM
);

85 
	`¥ötf
("Allocating SDRAM 1\n");

86 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x08000000, 0x01000000, 0x00004000);

87 
	`¥ötf
("Allocating SDRAM 2\n");

88 
	`˝u_ªgi°î_physiˇl_mem‹y
(0x0c000000, 0x01000000, 0x01004000);

91 
	`¥ötf
("%s:Üﬂd BIOS '%s'\n", 
__func__
, 
BIOS_FILENAME
);

92 
ªt
 = 
	`lﬂd_image
(
BIOS_FILENAME
, 
phys_øm_ba£
);

93 i‡(
ªt
 < 0) {

94 
	`Ârötf
(
°dîr
, "ªt=%d\n", 
ªt
);

95 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad SHIX bios '%s'\n",

96 
BIOS_FILENAME
);

97 
	`exô
(1);

101 
s
 = 
	`sh7750_öô
(
ív
);

103 
	`tc58128_öô
(
s
, "shix_löux_«nd.bö", 
NULL
);

104 
	`Ârötf
(
°dîr
, "initializationÅerminated\n");

105 
	}
}

107 
QEMUMachöe
 
	gshix_machöe
 = {

110 
shix_öô


	@slavio_intctl.c

24 
	~"vl.h
"

28 #ifde‡
DEBUG_IRQ


29 
	#DPRINTF
(
fmt
, 
¨gs
...) \

30 dÿ{ 
	`¥ötf
("IRQ: " 
fmt
 , ##
¨gs
); } 0)

	)

32 
	#DPRINTF
(
fmt
, 
¨gs
...)

	)

46 
	#MAX_CPUS
 16

	)

48 
	sSLAVIO_INTCTLSèã
 {

49 
uöt32_t
 
	möåeg_≥ndög
[
MAX_CPUS
];

50 
uöt32_t
 
	möåegm_≥ndög
;

51 
uöt32_t
 
	möåegm_dißbÀd
;

52 
uöt32_t
 
	mèrgë_˝u
;

53 #ifde‡
DEBUG_IRQ_COUNT


54 
uöt64_t
 
	múq_cou¡
[32];

56 
CPUSèã
 *
	m˝u_ívs
[
MAX_CPUS
];

57 } 
	tSLAVIO_INTCTLSèã
;

59 
	#INTCTL_MAXADDR
 0xf

	)

60 
	#INTCTLM_MAXADDR
 0xf

	)

61 
¶avio_check_öãºu±s
(*
›aque
);

64 
uöt32_t
 
	$¶avio_öt˘l_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

66 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

67 
uöt32_t
 
ßddr
;

68 
˝u
;

70 
˝u
 = (
addr
 & (
MAX_CPUS
 - 1Ë* 
TARGET_PAGE_SIZE
) >> 12;

71 
ßddr
 = (
addr
 & 
INTCTL_MAXADDR
) >> 2;

72 
ßddr
) {

74  
s
->
öåeg_≥ndög
[
˝u
];

79 
	}
}

81 
	$¶avio_öt˘l_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

83 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

84 
uöt32_t
 
ßddr
;

85 
˝u
;

87 
˝u
 = (
addr
 & (
MAX_CPUS
 - 1Ë* 
TARGET_PAGE_SIZE
) >> 12;

88 
ßddr
 = (
addr
 & 
INTCTL_MAXADDR
) >> 2;

89 
ßddr
) {

91 i‡(
vÆ
 & 0x4000)

92 
vÆ
 |= 80000000;

93 
vÆ
 &= 0xfffe0000;

94 
s
->
öåeg_≥ndög
[
˝u
] &~
vÆ
;

95 
	`DPRINTF
("CÀ¨ed cpu %d irq mask %x, curmask %x\n", 
˝u
, 
vÆ
, 
s
->
öåeg_≥ndög
[cpu]);

98 
vÆ
 &= 0xfffe0000;

99 
s
->
öåeg_≥ndög
[
˝u
] |
vÆ
;

100 
	`¶avio_check_öãºu±s
(
s
);

101 
	`DPRINTF
("Së cpu %d irq mask %x, curmask %x\n", 
˝u
, 
vÆ
, 
s
->
öåeg_≥ndög
[cpu]);

106 
	}
}

108 
CPURódMem‹yFunc
 *
	g¶avio_öt˘l_mem_ªad
[3] = {

109 
¶avio_öt˘l_mem_ªadl
,

110 
¶avio_öt˘l_mem_ªadl
,

111 
¶avio_öt˘l_mem_ªadl
,

114 
CPUWrôeMem‹yFunc
 *
	g¶avio_öt˘l_mem_wrôe
[3] = {

115 
¶avio_öt˘l_mem_wrôñ
,

116 
¶avio_öt˘l_mem_wrôñ
,

117 
¶avio_öt˘l_mem_wrôñ
,

121 
uöt32_t
 
	$¶avio_öt˘lm_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

123 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

124 
uöt32_t
 
ßddr
;

126 
ßddr
 = (
addr
 & 
INTCTLM_MAXADDR
) >> 2;

127 
ßddr
) {

129  
s
->
öåegm_≥ndög
 & 0x7fffffff;

131  
s
->
öåegm_dißbÀd
;

133  
s
->
èrgë_˝u
;

138 
	}
}

140 
	$¶avio_öt˘lm_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

142 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

143 
uöt32_t
 
ßddr
;

145 
ßddr
 = (
addr
 & 
INTCTLM_MAXADDR
) >> 2;

146 
ßddr
) {

149 
vÆ
 &= ~0x4fb2007f;

150 
s
->
öåegm_dißbÀd
 &~
vÆ
;

151 
	`DPRINTF
("E«bÀd ma°î irq mask %x, curmask %x\n", 
vÆ
, 
s
->
öåegm_dißbÀd
);

152 
	`¶avio_check_öãºu±s
(
s
);

156 
vÆ
 &= ~0x4fb2007f;

157 
s
->
öåegm_dißbÀd
 |
vÆ
;

158 
s
->
öåegm_≥ndög
 &~
vÆ
;

159 
	`DPRINTF
("DißbÀd ma°î irq mask %x, curmask %x\n", 
vÆ
, 
s
->
öåegm_dißbÀd
);

162 
s
->
èrgë_˝u
 = 
vÆ
 & (
MAX_CPUS
 - 1);

163 
	`DPRINTF
("Së ma°î irq cpu %d\n", 
s
->
èrgë_˝u
);

168 
	}
}

170 
CPURódMem‹yFunc
 *
	g¶avio_öt˘lm_mem_ªad
[3] = {

171 
¶avio_öt˘lm_mem_ªadl
,

172 
¶avio_öt˘lm_mem_ªadl
,

173 
¶avio_öt˘lm_mem_ªadl
,

176 
CPUWrôeMem‹yFunc
 *
	g¶avio_öt˘lm_mem_wrôe
[3] = {

177 
¶avio_öt˘lm_mem_wrôñ
,

178 
¶avio_öt˘lm_mem_wrôñ
,

179 
¶avio_öt˘lm_mem_wrôñ
,

182 
	$¶avio_pic_öfo
(*
›aque
)

184 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

185 
i
;

187 
i
 = 0; i < 
MAX_CPUS
; i++) {

188 
	`ãrm_¥ötf
("≥r-˝u %d:Öídög 0x%08x\n", 
i
, 
s
->
öåeg_≥ndög
[i]);

190 
	`ãrm_¥ötf
("ma°î:Öídög 0x%08x, dißbÀd 0x%08x\n", 
s
->
öåegm_≥ndög
, s->
öåegm_dißbÀd
);

191 
	}
}

193 
	$¶avio_úq_öfo
(*
›aque
)

195 #i‚de‡
DEBUG_IRQ_COUNT


196 
	`ãrm_¥ötf
("irq statistic codeÇot compiled.\n");

198 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

199 
i
;

200 
öt64_t
 
cou¡
;

202 
	`ãrm_¥ötf
("IRQ statistics:\n");

203 
i
 = 0; i < 32; i++) {

204 
cou¡
 = 
s
->
úq_cou¡
[
i
];

205 i‡(
cou¡
 > 0)

206 
	`ãrm_¥ötf
("%2d: %" 
PRId64
 "\n", 
i
, 
cou¡
);

209 
	}
}

211 c⁄° 
uöt32_t
 
	götbô_to_Àvñ
[32] = {

216 
	$¶avio_check_öãºu±s
(*
›aque
)

218 
CPUSèã
 *
ív
;

219 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

220 
uöt32_t
 
≥ndög
 = 
s
->
öåegm_≥ndög
;

221 
i
, 
j
, 
max
 = 0;

223 
≥ndög
 &~
s
->
öåegm_dißbÀd
;

225 i‡(
≥ndög
 && !(
s
->
öåegm_dißbÀd
 & 0x80000000)) {

226 
i
 = 0; i < 32; i++) {

227 i‡(
≥ndög
 & (1 << 
i
)) {

228 i‡(
max
 < 
ötbô_to_Àvñ
[
i
])

229 
max
 = 
ötbô_to_Àvñ
[
i
];

232 
ív
 = 
s
->
˝u_ívs
[s->
èrgë_˝u
];

233 i‡(!
ív
) {

234 
	`DPRINTF
("NÿCPU %d,ÇŸÅriggîed (≥ndög %x)\n", 
s
->
èrgë_˝u
, 
≥ndög
);

237 i‡(
ív
->
hÆãd
)

238 
ív
->
hÆãd
 = 0;

239 i‡(
ív
->
öãºu±_ödex
 == 0) {

240 
	`DPRINTF
("Triggîed CPU %dÖû %d\n", 
s
->
èrgë_˝u
, 
max
);

241 #ifde‡
DEBUG_IRQ_COUNT


242 
s
->
úq_cou¡
[
max
]++;

244 
ív
->
öãºu±_ödex
 = 
TT_EXTINT
 | 
max
;

245 
	`˝u_öãºu±
(
ív
, 
CPU_INTERRUPT_HARD
);

248 
	`DPRINTF
("NŸÅriggîed (≥ndög %x),ÖídögÉx˚±i⁄ %x\n", 
≥ndög
, 
ív
->
öãºu±_ödex
);

252 
	`DPRINTF
("NŸÅriggîed (≥ndög %x), dißbÀd %x\n", 
≥ndög
, 
s
->
öåegm_dißbÀd
);

254 
i
 = 0; i < 
MAX_CPUS
; i++) {

255 
max
 = 0;

256 
ív
 = 
s
->
˝u_ívs
[
i
];

257 i‡(!
ív
)

259 
j
 = 17; j < 32; j++) {

260 i‡(
s
->
öåeg_≥ndög
[
i
] & (1 << 
j
)) {

261 i‡(
max
 < 
j
 - 16)

262 
max
 = 
j
 - 16;

265 i‡(
max
 > 0) {

266 i‡(
ív
->
hÆãd
)

267 
ív
->
hÆãd
 = 0;

268 i‡(
ív
->
öãºu±_ödex
 == 0) {

269 
	`DPRINTF
("Triggîed so·öà%d f‹ cpu %d (≥ndög %x)\n", 
max
, 
i
, 
≥ndög
);

270 #ifde‡
DEBUG_IRQ_COUNT


271 
s
->
úq_cou¡
[
max
]++;

273 
ív
->
öãºu±_ödex
 = 
TT_EXTINT
 | 
max
;

274 
	`˝u_öãºu±
(
ív
, 
CPU_INTERRUPT_HARD
);

278 
	}
}

284 
	$¶avio_pic_£t_úq
(*
›aque
, 
úq
, 
Àvñ
)

286 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

288 
	`DPRINTF
("Së cpu %d irq %dÜevñ %d\n", 
s
->
èrgë_˝u
, 
úq
, 
Àvñ
);

289 i‡(
úq
 < 32) {

290 
uöt32_t
 
mask
 = 1 << 
úq
;

291 
uöt32_t
 
pû
 = 
ötbô_to_Àvñ
[
úq
];

292 i‡(
pû
 > 0) {

293 i‡(
Àvñ
) {

294 
s
->
öåegm_≥ndög
 |
mask
;

295 
s
->
öåeg_≥ndög
[s->
èrgë_˝u
] |1 << 
pû
;

298 
s
->
öåegm_≥ndög
 &~
mask
;

299 
s
->
öåeg_≥ndög
[s->
èrgë_˝u
] &~(1 << 
pû
);

303 
	`¶avio_check_öãºu±s
(
s
);

304 
	}
}

306 
	$¶avio_pic_£t_úq_˝u
(*
›aque
, 
úq
, 
Àvñ
, 
˝u
)

308 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

310 
	`DPRINTF
("Së cpu %dÜoˇ»úq %dÜevñ %d\n", 
˝u
, 
úq
, 
Àvñ
);

311 i‡(
˝u
 == ()-1) {

312 
	`¶avio_pic_£t_úq
(
›aque
, 
úq
, 
Àvñ
);

315 i‡(
úq
 < 32) {

316 
uöt32_t
 
pû
 = 
ötbô_to_Àvñ
[
úq
];

317 i‡(
pû
 > 0) {

318 i‡(
Àvñ
) {

319 
s
->
öåeg_≥ndög
[
˝u
] |1 << 
pû
;

322 
s
->
öåeg_≥ndög
[
˝u
] &~(1 << 
pû
);

326 
	`¶avio_check_öãºu±s
(
s
);

327 
	}
}

329 
	$¶avio_öt˘l_ßve
(
QEMUFûe
 *
f
, *
›aque
)

331 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

332 
i
;

334 
i
 = 0; i < 
MAX_CPUS
; i++) {

335 
	`qemu_put_be32s
(
f
, &
s
->
öåeg_≥ndög
[
i
]);

337 
	`qemu_put_be32s
(
f
, &
s
->
öåegm_≥ndög
);

338 
	`qemu_put_be32s
(
f
, &
s
->
öåegm_dißbÀd
);

339 
	`qemu_put_be32s
(
f
, &
s
->
èrgë_˝u
);

340 
	}
}

342 
	$¶avio_öt˘l_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

344 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

345 
i
;

347 i‡(
vîsi⁄_id
 != 1)

348  -
EINVAL
;

350 
i
 = 0; i < 
MAX_CPUS
; i++) {

351 
	`qemu_gë_be32s
(
f
, &
s
->
öåeg_≥ndög
[
i
]);

353 
	`qemu_gë_be32s
(
f
, &
s
->
öåegm_≥ndög
);

354 
	`qemu_gë_be32s
(
f
, &
s
->
öåegm_dißbÀd
);

355 
	`qemu_gë_be32s
(
f
, &
s
->
èrgë_˝u
);

357 
	}
}

359 
	$¶avio_öt˘l_ª£t
(*
›aque
)

361 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

362 
i
;

364 
i
 = 0; i < 
MAX_CPUS
; i++) {

365 
s
->
öåeg_≥ndög
[
i
] = 0;

367 
s
->
öåegm_dißbÀd
 = ~0xffb2007f;

368 
s
->
öåegm_≥ndög
 = 0;

369 
s
->
èrgë_˝u
 = 0;

370 
	}
}

372 
	$¶avio_öt˘l_£t_˝u
(*
›aque
, 
˝u
, 
CPUSèã
 *
ív
)

374 
SLAVIO_INTCTLSèã
 *
s
 = 
›aque
;

375 
s
->
˝u_ívs
[
˝u
] = 
ív
;

376 
	}
}

378 *
	$¶avio_öt˘l_öô
(
uöt32_t
 
addr
, uöt32_à
addrg
)

380 
¶avio_öt˘l_io_mem‹y
, 
¶avio_öt˘lm_io_mem‹y
, 
i
;

381 
SLAVIO_INTCTLSèã
 *
s
;

383 
s
 = 
	`qemu_mÆlocz
((
SLAVIO_INTCTLSèã
));

384 i‡(!
s
)

385  
NULL
;

387 
i
 = 0; i < 
MAX_CPUS
; i++) {

388 
¶avio_öt˘l_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
¶avio_öt˘l_mem_ªad
, 
¶avio_öt˘l_mem_wrôe
, 
s
);

389 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 
i
 * 
TARGET_PAGE_SIZE
, 
INTCTL_MAXADDR
, 
¶avio_öt˘l_io_mem‹y
);

392 
¶avio_öt˘lm_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
¶avio_öt˘lm_mem_ªad
, 
¶avio_öt˘lm_mem_wrôe
, 
s
);

393 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addrg
, 
INTCTLM_MAXADDR
, 
¶avio_öt˘lm_io_mem‹y
);

395 
	`ªgi°î_ßvevm
("¶avio_öt˘l", 
addr
, 1, 
¶avio_öt˘l_ßve
, 
¶avio_öt˘l_lﬂd
, 
s
);

396 
	`qemu_ªgi°î_ª£t
(
¶avio_öt˘l_ª£t
, 
s
);

397 
	`¶avio_öt˘l_ª£t
(
s
);

398  
s
;

399 
	}
}

	@slavio_misc.c

24 
	~"vl.h
"

36 #ifde‡
DEBUG_MISC


37 
	#MISC_DPRINTF
(
fmt
, 
¨gs
...) \

38 dÿ{ 
	`¥ötf
("MISC: " 
fmt
 , ##
¨gs
); } 0)

	)

40 
	#MISC_DPRINTF
(
fmt
, 
¨gs
...)

	)

43 
	sMiscSèã
 {

44 
	múq
;

45 
uöt8_t
 
	mc⁄fig
;

46 
uöt8_t
 
	maux1
, 
	maux2
;

47 
uöt8_t
 
	mdüg
, 
	mm˘æ
, 
	msys˘æ
;

48 } 
	tMiscSèã
;

50 
	#MISC_MAXADDR
 1

	)

52 
	$¶avio_misc_upd©e_úq
(*
›aque
)

54 
MiscSèã
 *
s
 = 
›aque
;

56 i‡((
s
->
aux2
 & 0x4Ë&& (s->
c⁄fig
 & 0x8)) {

57 
	`pic_£t_úq
(
s
->
úq
, 1);

59 
	`pic_£t_úq
(
s
->
úq
, 0);

61 
	}
}

63 
	$¶avio_misc_ª£t
(*
›aque
)

65 
MiscSèã
 *
s
 = 
›aque
;

68 
s
->
c⁄fig
 = s->
aux1
 = s->
aux2
 = s->
m˘æ
 = 0;

69 
	}
}

71 
	$¶avio_£t_powî_Áû
(*
›aque
, 
powî_Áûög
)

73 
MiscSèã
 *
s
 = 
›aque
;

75 
	`MISC_DPRINTF
("Powî faû: %d, c⁄fig: %d\n", 
powî_Áûög
, 
s
->
c⁄fig
);

76 i‡(
powî_Áûög
 && (
s
->
c⁄fig
 & 0x8)) {

77 
s
->
aux2
 |= 0x4;

79 
s
->
aux2
 &= ~0x4;

81 
	`¶avio_misc_upd©e_úq
(
s
);

82 
	}
}

84 
	$¶avio_misc_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

86 
MiscSèã
 *
s
 = 
›aque
;

88 
addr
 & 0xfff0000) {

90 
	`MISC_DPRINTF
("Wrôêc⁄fig %2.2x\n", 
vÆ
 & 0xff);

91 
s
->
c⁄fig
 = 
vÆ
 & 0xff;

92 
	`¶avio_misc_upd©e_úq
(
s
);

95 
	`MISC_DPRINTF
("Wrôêaux1 %2.2x\n", 
vÆ
 & 0xff);

96 
s
->
aux1
 = 
vÆ
 & 0xff;

99 
vÆ
 &= 0x3;

100 
	`MISC_DPRINTF
("Wrôêaux2 %2.2x\n", 
vÆ
);

101 
vÆ
 |
s
->
aux2
 & 0x4;

102 i‡(
vÆ
 & 0x2)

103 
vÆ
 &= 0x1;

104 
s
->
aux2
 = 
vÆ
;

105 i‡(
vÆ
 & 1)

106 
	`qemu_sy°em_shutdown_ªque°
();

107 
	`¶avio_misc_upd©e_úq
(
s
);

110 
	`MISC_DPRINTF
("Wrôêdüg %2.2x\n", 
vÆ
 & 0xff);

111 
s
->
düg
 = 
vÆ
 & 0xff;

114 
	`MISC_DPRINTF
("Wrôêmodem c⁄åﬁ %2.2x\n", 
vÆ
 & 0xff);

115 
s
->
m˘æ
 = 
vÆ
 & 0xff;

118 
	`MISC_DPRINTF
("Wrôêsy°em c⁄åﬁ %2.2x\n", 
vÆ
 & 0xff);

119 i‡(
vÆ
 & 1) {

120 
s
->
sys˘æ
 = 0x2;

121 
	`qemu_sy°em_ª£t_ªque°
();

125 
	`MISC_DPRINTF
("Wrôêpowî m™agemíà%2.2x\n", 
vÆ
 & 0xff);

126 
	`˝u_öãºu±
(
˝u_sögÀ_ív
, 
CPU_INTERRUPT_HALT
);

129 
	}
}

131 
uöt32_t
 
	$¶avio_misc_mem_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

133 
MiscSèã
 *
s
 = 
›aque
;

134 
uöt32_t
 
ªt
 = 0;

136 
addr
 & 0xfff0000) {

138 
ªt
 = 
s
->
c⁄fig
;

139 
	`MISC_DPRINTF
("Ród c⁄fig %2.2x\n", 
ªt
);

142 
ªt
 = 
s
->
aux1
;

143 
	`MISC_DPRINTF
("Ródáux1 %2.2x\n", 
ªt
);

146 
ªt
 = 
s
->
aux2
;

147 
	`MISC_DPRINTF
("Ródáux2 %2.2x\n", 
ªt
);

150 
ªt
 = 
s
->
düg
;

151 
	`MISC_DPRINTF
("Ród düg %2.2x\n", 
ªt
);

154 
ªt
 = 
s
->
m˘æ
;

155 
	`MISC_DPRINTF
("Ród modem c⁄åﬁ %2.2x\n", 
ªt
);

158 
	`MISC_DPRINTF
("Ród sy°em c⁄åﬁ %2.2x\n", 
ªt
);

159 
ªt
 = 
s
->
sys˘æ
;

162 
	`MISC_DPRINTF
("RódÖowî m™agemíà%2.2x\n", 
ªt
);

165  
ªt
;

166 
	}
}

168 
CPURódMem‹yFunc
 *
	g¶avio_misc_mem_ªad
[3] = {

169 
¶avio_misc_mem_ªadb
,

170 
¶avio_misc_mem_ªadb
,

171 
¶avio_misc_mem_ªadb
,

174 
CPUWrôeMem‹yFunc
 *
	g¶avio_misc_mem_wrôe
[3] = {

175 
¶avio_misc_mem_wrôeb
,

176 
¶avio_misc_mem_wrôeb
,

177 
¶avio_misc_mem_wrôeb
,

180 
	$¶avio_misc_ßve
(
QEMUFûe
 *
f
, *
›aque
)

182 
MiscSèã
 *
s
 = 
›aque
;

184 
	`qemu_put_be32s
(
f
, &
s
->
úq
);

185 
	`qemu_put_8s
(
f
, &
s
->
c⁄fig
);

186 
	`qemu_put_8s
(
f
, &
s
->
aux1
);

187 
	`qemu_put_8s
(
f
, &
s
->
aux2
);

188 
	`qemu_put_8s
(
f
, &
s
->
düg
);

189 
	`qemu_put_8s
(
f
, &
s
->
m˘æ
);

190 
	`qemu_put_8s
(
f
, &
s
->
sys˘æ
);

191 
	}
}

193 
	$¶avio_misc_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

195 
MiscSèã
 *
s
 = 
›aque
;

197 i‡(
vîsi⁄_id
 != 1)

198  -
EINVAL
;

200 
	`qemu_gë_be32s
(
f
, &
s
->
úq
);

201 
	`qemu_gë_8s
(
f
, &
s
->
c⁄fig
);

202 
	`qemu_gë_8s
(
f
, &
s
->
aux1
);

203 
	`qemu_gë_8s
(
f
, &
s
->
aux2
);

204 
	`qemu_gë_8s
(
f
, &
s
->
düg
);

205 
	`qemu_gë_8s
(
f
, &
s
->
m˘æ
);

206 
	`qemu_gë_8s
(
f
, &
s
->
sys˘æ
);

208 
	}
}

210 *
	$¶avio_misc_öô
(
uöt32_t
 
ba£
, 
úq
)

212 
¶avio_misc_io_mem‹y
;

213 
MiscSèã
 *
s
;

215 
s
 = 
	`qemu_mÆlocz
((
MiscSèã
));

216 i‡(!
s
)

217  
NULL
;

219 
¶avio_misc_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
¶avio_misc_mem_ªad
, 
¶avio_misc_mem_wrôe
, 
s
);

221 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x1800000, 
MISC_MAXADDR
, 
¶avio_misc_io_mem‹y
);

223 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x1900000, 
MISC_MAXADDR
, 
¶avio_misc_io_mem‹y
);

225 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x1910000, 
MISC_MAXADDR
, 
¶avio_misc_io_mem‹y
);

227 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x1a00000, 
MISC_MAXADDR
, 
¶avio_misc_io_mem‹y
);

229 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x1b00000, 
MISC_MAXADDR
, 
¶avio_misc_io_mem‹y
);

231 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x1f00000, 
MISC_MAXADDR
, 
¶avio_misc_io_mem‹y
);

233 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0xa000000, 
MISC_MAXADDR
, 
¶avio_misc_io_mem‹y
);

235 
s
->
úq
 = irq;

237 
	`ªgi°î_ßvevm
("¶avio_misc", 
ba£
, 1, 
¶avio_misc_ßve
, 
¶avio_misc_lﬂd
, 
s
);

238 
	`qemu_ªgi°î_ª£t
(
¶avio_misc_ª£t
, 
s
);

239 
	`¶avio_misc_ª£t
(
s
);

240  
s
;

241 
	}
}

	@slavio_serial.c

24 
	~"vl.h
"

52 #ifde‡
DEBUG_SERIAL


53 
	#SER_DPRINTF
(
fmt
, 
¨gs
...) \

54 dÿ{ 
	`¥ötf
("SER: " 
fmt
 , ##
¨gs
); } 0)

	)

55 
	#pic_£t_úq
(
úq
, 
Àvñ
) \

56 dÿ{ 
	`¥ötf
("SER: së_úq(%d): %d\n", (
úq
), (
Àvñ
)); 
	`pic_£t_úq
((úq),÷evñ));} 0)

	)

58 
	#SER_DPRINTF
(
fmt
, 
¨gs
...)

	)

60 #ifde‡
DEBUG_KBD


61 
	#KBD_DPRINTF
(
fmt
, 
¨gs
...) \

62 dÿ{ 
	`¥ötf
("KBD: " 
fmt
 , ##
¨gs
); } 0)

	)

64 
	#KBD_DPRINTF
(
fmt
, 
¨gs
...)

	)

66 #ifde‡
DEBUG_MOUSE


67 
	#MS_DPRINTF
(
fmt
, 
¨gs
...) \

68 dÿ{ 
	`¥ötf
("MSC: " 
fmt
 , ##
¨gs
); } 0)

	)

70 
	#MS_DPRINTF
(
fmt
, 
¨gs
...)

	)

74 
	mchn_a
, 
	mchn_b
,

75 } 
	tchn_id_t
;

77 
	#CHN_C
(
s
Ë((s)->
chn
 =
chn_b
? 'b' : 'a')

	)

80 
	m£r
, 
	mkbd
, 
	mmou£
,

81 } 
	tchn_ty≥_t
;

83 
	#SERIO_QUEUE_SIZE
 256

	)

86 
uöt8_t
 
	md©a
[
SERIO_QUEUE_SIZE
];

87 
	mΩå
, 
	mw±r
, 
	mcou¡
;

88 } 
	tSERIOQueue
;

90 
	sCh™√lSèã
 {

91 
	múq
;

92 
	mªg
;

93 
	mrxöt
, 
	mtxöt
, 
	mrxöt_undî_svc
, 
	mtxöt_undî_svc
;

94 
chn_id_t
 
	mchn
;

95 
chn_ty≥_t
 
	mty≥
;

96 
Ch™√lSèã
 *
	mŸhîchn
;

97 
uöt8_t
 
	mrx
, 
	mtx
, 
	mwªgs
[16], 
	mºegs
[16];

98 
SERIOQueue
 
	mqueue
;

99 
Ch¨DrivîSèã
 *
	mchr
;

100 } 
	tCh™√lSèã
;

102 
	sSîülSèã
 {

103 
Ch™√lSèã
 
	mchn
[2];

106 
	#SERIAL_MAXADDR
 7

	)

108 
h™dÀ_kbd_comm™d
(
Ch™√lSèã
 *
s
, 
vÆ
);

109 
£rül_ˇn_ª˚ive
(*
›aque
);

110 
£rül_ª˚ive_byã
(
Ch™√lSèã
 *
s
, 
ch
);

111 
ölöe
 
£t_txöt
(
Ch™√lSèã
 *
s
);

113 
	$put_queue
(*
›aque
, 
b
)

115 
Ch™√lSèã
 *
s
 = 
›aque
;

116 
SERIOQueue
 *
q
 = &
s
->
queue
;

118 
	`SER_DPRINTF
("ch™√»%¯put: 0x%02x\n", 
	`CHN_C
(
s
), 
b
);

119 i‡(
q
->
cou¡
 >
SERIO_QUEUE_SIZE
)

121 
q
->
d©a
[q->
w±r
] = 
b
;

122 i‡(++
q
->
w±r
 =
SERIO_QUEUE_SIZE
)

123 
q
->
w±r
 = 0;

124 
q
->
cou¡
++;

125 
	`£rül_ª˚ive_byã
(
s
, 0);

126 
	}
}

128 
uöt32_t
 
	$gë_queue
(*
›aque
)

130 
Ch™√lSèã
 *
s
 = 
›aque
;

131 
SERIOQueue
 *
q
 = &
s
->
queue
;

132 
vÆ
;

134 i‡(
q
->
cou¡
 == 0) {

137 
vÆ
 = 
q
->
d©a
[q->
Ωå
];

138 i‡(++
q
->
Ωå
 =
SERIO_QUEUE_SIZE
)

139 
q
->
Ωå
 = 0;

140 
q
->
cou¡
--;

142 
	`KBD_DPRINTF
("ch™√»%¯gë 0x%02x\n", 
	`CHN_C
(
s
), 
vÆ
);

143 i‡(
q
->
cou¡
 > 0)

144 
	`£rül_ª˚ive_byã
(
s
, 0);

145  
vÆ
;

146 
	}
}

148 
	$¶avio_£rül_upd©e_úq_chn
(
Ch™√lSèã
 *
s
)

150 i‡((
s
->
wªgs
[1] & 1) &&

151 (((
s
->
wªgs
[1] & 2Ë&& s->
txöt
 == 1) ||

152 ((((
s
->
wªgs
[1] & 0x18) == 8) || ((s->wregs[1] & 0x18) == 0x10)) &&

153 
s
->
rxöt
 == 1) ||

154 ((
s
->
wªgs
[15] & 0x80Ë&& (s->
ºegs
[0] & 0x80)))) {

158 
	}
}

160 
	$¶avio_£rül_upd©e_úq
(
Ch™√lSèã
 *
s
)

162 
úq
;

164 
úq
 = 
	`¶avio_£rül_upd©e_úq_chn
(
s
);

165 
úq
 |
	`¶avio_£rül_upd©e_úq_chn
(
s
->
Ÿhîchn
);

167 
	`pic_£t_úq
(
s
->
úq
, irq);

168 
	}
}

170 
	$¶avio_£rül_ª£t_chn
(
Ch™√lSèã
 *
s
)

172 
i
;

174 
s
->
ªg
 = 0;

175 
i
 = 0; i < 
SERIAL_MAXADDR
; i++) {

176 
s
->
ºegs
[
i
] = 0;

177 
s
->
wªgs
[
i
] = 0;

179 
s
->
wªgs
[4] = 4;

180 
s
->
wªgs
[9] = 0xc0;

181 
s
->
wªgs
[11] = 8;

182 
s
->
wªgs
[14] = 0x30;

183 
s
->
wªgs
[15] = 0xf8;

184 
s
->
ºegs
[0] = 0x44;

185 
s
->
ºegs
[1] = 6;

187 
s
->
rx
 = s->
tx
 = 0;

188 
s
->
rxöt
 = s->
txöt
 = 0;

189 
s
->
rxöt_undî_svc
 = s->
txöt_undî_svc
 = 0;

190 
	}
}

192 
	$¶avio_£rül_ª£t
(*
›aque
)

194 
SîülSèã
 *
s
 = 
›aque
;

195 
	`¶avio_£rül_ª£t_chn
(&
s
->
chn
[0]);

196 
	`¶avio_£rül_ª£t_chn
(&
s
->
chn
[1]);

197 
	}
}

199 
ölöe
 
	$˛r_rxöt
(
Ch™√lSèã
 *
s
)

201 
s
->
rxöt
 = 0;

202 
s
->
rxöt_undî_svc
 = 0;

203 i‡(
s
->
chn
 =
chn_a
)

204 
s
->
ºegs
[3] &= ~0x20;

206 
s
->
Ÿhîchn
->
ºegs
[3] &= ~4;

207 i‡(
s
->
txöt
)

208 
	`£t_txöt
(
s
);

210 
s
->
ºegs
[2] = 6;

211 
	`¶avio_£rül_upd©e_úq
(
s
);

212 
	}
}

214 
ölöe
 
	$£t_rxöt
(
Ch™√lSèã
 *
s
)

216 
s
->
rxöt
 = 1;

217 i‡(!
s
->
txöt_undî_svc
) {

218 
s
->
rxöt_undî_svc
 = 1;

219 i‡(
s
->
chn
 =
chn_a
)

220 
s
->
ºegs
[3] |= 0x20;

222 
s
->
Ÿhîchn
->
ºegs
[3] |= 4;

223 
s
->
ºegs
[2] = 4;

224 
	`¶avio_£rül_upd©e_úq
(
s
);

226 
	}
}

228 
ölöe
 
	$˛r_txöt
(
Ch™√lSèã
 *
s
)

230 
s
->
txöt
 = 0;

231 
s
->
txöt_undî_svc
 = 0;

232 i‡(
s
->
chn
 =
chn_a
)

233 
s
->
ºegs
[3] &= ~0x10;

235 
s
->
Ÿhîchn
->
ºegs
[3] &= ~2;

236 i‡(
s
->
rxöt
)

237 
	`£t_rxöt
(
s
);

239 
s
->
ºegs
[2] = 6;

240 
	`¶avio_£rül_upd©e_úq
(
s
);

241 
	}
}

243 
ölöe
 
	$£t_txöt
(
Ch™√lSèã
 *
s
)

245 
s
->
txöt
 = 1;

246 i‡(!
s
->
rxöt_undî_svc
) {

247 
s
->
txöt_undî_svc
 = 1;

248 i‡(
s
->
chn
 =
chn_a
)

249 
s
->
ºegs
[3] |= 0x10;

251 
s
->
Ÿhîchn
->
ºegs
[3] |= 2;

252 
s
->
ºegs
[2] = 0;

253 
	`¶avio_£rül_upd©e_úq
(
s
);

255 
	}
}

257 
	$¶avio_£rül_upd©e_∑ømëîs
(
Ch™√lSèã
 *
s
)

259 
•ìd
, 
∑rôy
, 
d©a_bôs
, 
°›_bôs
;

260 
QEMUSîülSëP¨ams
 
s•
;

262 i‡(!
s
->
chr
 || s->
ty≥
 !
£r
)

265 i‡(
s
->
wªgs
[4] & 1) {

266 i‡(
s
->
wªgs
[4] & 2)

267 
∑rôy
 = 'E';

269 
∑rôy
 = 'O';

271 
∑rôy
 = 'N';

273 i‡((
s
->
wªgs
[4] & 0x0c) == 0x0c)

274 
°›_bôs
 = 2;

276 
°›_bôs
 = 1;

277 
s
->
wªgs
[5] & 0x60) {

279 
d©a_bôs
 = 5;

282 
d©a_bôs
 = 7;

285 
d©a_bôs
 = 6;

289 
d©a_bôs
 = 8;

292 
•ìd
 = 2457600 / ((
s
->
wªgs
[12] | (s->wregs[13] << 8)) + 2);

293 
s
->
wªgs
[4] & 0xc0) {

297 
•ìd
 /= 16;

300 
•ìd
 /= 32;

304 
•ìd
 /= 64;

307 
s•
.
•ìd
 = speed;

308 
s•
.
∑rôy
 =Öarity;

309 
s•
.
d©a_bôs
 = data_bits;

310 
s•
.
°›_bôs
 = stop_bits;

311 
	`SER_DPRINTF
("ch™√»%c: s≥ed=%dÖ¨ôy=%¯d©a=%d st›=%d\n", 
	`CHN_C
(
s
),

312 
•ìd
, 
∑rôy
, 
d©a_bôs
, 
°›_bôs
);

313 
	`qemu_chr_io˘l
(
s
->
chr
, 
CHR_IOCTL_SERIAL_SET_PARAMS
, &
s•
);

314 
	}
}

316 
	$¶avio_£rül_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

318 
SîülSèã
 *
£r
 = 
›aque
;

319 
Ch™√lSèã
 *
s
;

320 
uöt32_t
 
ßddr
;

321 
√wªg
, 
ch™√l
;

323 
vÆ
 &= 0xff;

324 
ßddr
 = (
addr
 & 3) >> 1;

325 
ch™√l
 = (
addr
 & 
SERIAL_MAXADDR
) >> 2;

326 
s
 = &
£r
->
chn
[
ch™√l
];

327 
ßddr
) {

329 
	`SER_DPRINTF
("Wrôêch™√»%c,Ñeg[%d] = %2.2x\n", 
	`CHN_C
(
s
), s->
ªg
, 
vÆ
 & 0xff);

330 
√wªg
 = 0;

331 
s
->
ªg
) {

333 
√wªg
 = 
vÆ
 & 7;

334 
vÆ
 &= 0x38;

335 
vÆ
) {

337 
√wªg
 |= 0x8;

340 
	`˛r_txöt
(
s
);

343 i‡(
s
->
rxöt_undî_svc
)

344 
	`˛r_rxöt
(
s
);

345 i‡(
s
->
txöt_undî_svc
)

346 
	`˛r_txöt
(
s
);

356 
s
->
wªgs
[s->
ªg
] = 
vÆ
;

362 
s
->
wªgs
[s->
ªg
] = 
vÆ
;

363 
	`¶avio_£rül_upd©e_∑ømëîs
(
s
);

366 
vÆ
 & 0xc0) {

371 
	`¶avio_£rül_ª£t_chn
(&
£r
->
chn
[1]);

374 
	`¶avio_£rül_ª£t_chn
(&
£r
->
chn
[0]);

377 
	`¶avio_£rül_ª£t
(
£r
);

384 i‡(
s
->
ªg
 == 0)

385 
s
->
ªg
 = 
√wªg
;

387 
s
->
ªg
 = 0;

390 
	`SER_DPRINTF
("Wrôêch™√»%c, ch %d\n", 
	`CHN_C
(
s
), 
vÆ
);

391 i‡(
s
->
wªgs
[5] & 8) {

392 
s
->
tx
 = 
vÆ
;

393 i‡(
s
->
chr
)

394 
	`qemu_chr_wrôe
(
s
->
chr
, &s->
tx
, 1);

395 i‡(
s
->
ty≥
 =
kbd
) {

396 
	`h™dÀ_kbd_comm™d
(
s
, 
vÆ
);

398 
s
->
ºegs
[0] |= 4;

399 
s
->
ºegs
[1] |= 1;

400 
	`£t_txöt
(
s
);

406 
	}
}

408 
uöt32_t
 
	$¶avio_£rül_mem_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

410 
SîülSèã
 *
£r
 = 
›aque
;

411 
Ch™√lSèã
 *
s
;

412 
uöt32_t
 
ßddr
;

413 
uöt32_t
 
ªt
;

414 
ch™√l
;

416 
ßddr
 = (
addr
 & 3) >> 1;

417 
ch™√l
 = (
addr
 & 
SERIAL_MAXADDR
) >> 2;

418 
s
 = &
£r
->
chn
[
ch™√l
];

419 
ßddr
) {

421 
	`SER_DPRINTF
("Ród ch™√»%c,Ñeg[%d] = %2.2x\n", 
	`CHN_C
(
s
), s->
ªg
, s->
ºegs
[s->reg]);

422 
ªt
 = 
s
->
ºegs
[s->
ªg
];

423 
s
->
ªg
 = 0;

424  
ªt
;

426 
s
->
ºegs
[0] &= ~1;

427 
	`˛r_rxöt
(
s
);

428 i‡(
s
->
ty≥
 =
kbd
 || s->ty≥ =
mou£
)

429 
ªt
 = 
	`gë_queue
(
s
);

431 
ªt
 = 
s
->
rx
;

432 
	`SER_DPRINTF
("Ród ch™√»%c, ch %d\n", 
	`CHN_C
(
s
), 
ªt
);

433  
ªt
;

438 
	}
}

440 
	$£rül_ˇn_ª˚ive
(*
›aque
)

442 
Ch™√lSèã
 *
s
 = 
›aque
;

443 
ªt
;

445 i‡(((
s
->
wªgs
[3] & 1) == 0)

446 || ((
s
->
ºegs
[0] & 1) == 1))

447 
ªt
 = 0;

449 
ªt
 = 1;

451  
ªt
;

452 
	}
}

454 
	$£rül_ª˚ive_byã
(
Ch™√lSèã
 *
s
, 
ch
)

456 
	`SER_DPRINTF
("ch™√»%¯puàch %d\n", 
	`CHN_C
(
s
), 
ch
);

457 
s
->
ºegs
[0] |= 1;

458 
s
->
rx
 = 
ch
;

459 
	`£t_rxöt
(
s
);

460 
	}
}

462 
	$£rül_ª˚ive_bªak
(
Ch™√lSèã
 *
s
)

464 
s
->
ºegs
[0] |= 0x80;

465 
	`¶avio_£rül_upd©e_úq
(
s
);

466 
	}
}

468 
	$£rül_ª˚ive1
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
size
)

470 
Ch™√lSèã
 *
s
 = 
›aque
;

471 
	`£rül_ª˚ive_byã
(
s
, 
buf
[0]);

472 
	}
}

474 
	$£rül_evít
(*
›aque
, 
evít
)

476 
Ch™√lSèã
 *
s
 = 
›aque
;

477 i‡(
evít
 =
CHR_EVENT_BREAK
)

478 
	`£rül_ª˚ive_bªak
(
s
);

479 
	}
}

481 
CPURódMem‹yFunc
 *
	g¶avio_£rül_mem_ªad
[3] = {

482 
¶avio_£rül_mem_ªadb
,

483 
¶avio_£rül_mem_ªadb
,

484 
¶avio_£rül_mem_ªadb
,

487 
CPUWrôeMem‹yFunc
 *
	g¶avio_£rül_mem_wrôe
[3] = {

488 
¶avio_£rül_mem_wrôeb
,

489 
¶avio_£rül_mem_wrôeb
,

490 
¶avio_£rül_mem_wrôeb
,

493 
	$¶avio_£rül_ßve_chn
(
QEMUFûe
 *
f
, 
Ch™√lSèã
 *
s
)

495 
	`qemu_put_be32s
(
f
, &
s
->
úq
);

496 
	`qemu_put_be32s
(
f
, &
s
->
ªg
);

497 
	`qemu_put_be32s
(
f
, &
s
->
rxöt
);

498 
	`qemu_put_be32s
(
f
, &
s
->
txöt
);

499 
	`qemu_put_be32s
(
f
, &
s
->
rxöt_undî_svc
);

500 
	`qemu_put_be32s
(
f
, &
s
->
txöt_undî_svc
);

501 
	`qemu_put_8s
(
f
, &
s
->
rx
);

502 
	`qemu_put_8s
(
f
, &
s
->
tx
);

503 
	`qemu_put_buf„r
(
f
, 
s
->
wªgs
, 16);

504 
	`qemu_put_buf„r
(
f
, 
s
->
ºegs
, 16);

505 
	}
}

507 
	$¶avio_£rül_ßve
(
QEMUFûe
 *
f
, *
›aque
)

509 
SîülSèã
 *
s
 = 
›aque
;

511 
	`¶avio_£rül_ßve_chn
(
f
, &
s
->
chn
[0]);

512 
	`¶avio_£rül_ßve_chn
(
f
, &
s
->
chn
[1]);

513 
	}
}

515 
	$¶avio_£rül_lﬂd_chn
(
QEMUFûe
 *
f
, 
Ch™√lSèã
 *
s
, 
vîsi⁄_id
)

517 i‡(
vîsi⁄_id
 > 2)

518  -
EINVAL
;

520 
	`qemu_gë_be32s
(
f
, &
s
->
úq
);

521 
	`qemu_gë_be32s
(
f
, &
s
->
ªg
);

522 
	`qemu_gë_be32s
(
f
, &
s
->
rxöt
);

523 
	`qemu_gë_be32s
(
f
, &
s
->
txöt
);

524 i‡(
vîsi⁄_id
 >= 2) {

525 
	`qemu_gë_be32s
(
f
, &
s
->
rxöt_undî_svc
);

526 
	`qemu_gë_be32s
(
f
, &
s
->
txöt_undî_svc
);

528 
	`qemu_gë_8s
(
f
, &
s
->
rx
);

529 
	`qemu_gë_8s
(
f
, &
s
->
tx
);

530 
	`qemu_gë_buf„r
(
f
, 
s
->
wªgs
, 16);

531 
	`qemu_gë_buf„r
(
f
, 
s
->
ºegs
, 16);

533 
	}
}

535 
	$¶avio_£rül_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

537 
SîülSèã
 *
s
 = 
›aque
;

538 
ªt
;

540 
ªt
 = 
	`¶avio_£rül_lﬂd_chn
(
f
, &
s
->
chn
[0], 
vîsi⁄_id
);

541 i‡(
ªt
 != 0)

542  
ªt
;

543 
ªt
 = 
	`¶avio_£rül_lﬂd_chn
(
f
, &
s
->
chn
[1], 
vîsi⁄_id
);

544  
ªt
;

546 
	}
}

548 
SîülSèã
 *
	$¶avio_£rül_öô
(
ba£
, 
úq
, 
Ch¨DrivîSèã
 *
chr1
, Ch¨DrivîSèã *
chr2
)

550 
¶avio_£rül_io_mem‹y
, 
i
;

551 
SîülSèã
 *
s
;

553 
s
 = 
	`qemu_mÆlocz
((
SîülSèã
));

554 i‡(!
s
)

555  
NULL
;

557 
¶avio_£rül_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
¶avio_£rül_mem_ªad
, 
¶avio_£rül_mem_wrôe
, 
s
);

558 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 
SERIAL_MAXADDR
, 
¶avio_£rül_io_mem‹y
);

560 
s
->
chn
[0].
chr
 = 
chr1
;

561 
s
->
chn
[1].
chr
 = 
chr2
;

563 
i
 = 0; i < 2; i++) {

564 
s
->
chn
[
i
].
úq
 = irq;

565 
s
->
chn
[
i
].chn = 1 - i;

566 
s
->
chn
[
i
].
ty≥
 = 
£r
;

567 i‡(
s
->
chn
[
i
].
chr
) {

568 
	`qemu_chr_add_h™dÀrs
(
s
->
chn
[
i
].
chr
, 
£rül_ˇn_ª˚ive
,

569 
£rül_ª˚ive1
, 
£rül_evít
, &
s
->
chn
[
i
]);

572 
s
->
chn
[0].
Ÿhîchn
 = &s->chn[1];

573 
s
->
chn
[1].
Ÿhîchn
 = &s->chn[0];

574 
	`ªgi°î_ßvevm
("¶avio_£rül", 
ba£
, 2, 
¶avio_£rül_ßve
, 
¶avio_£rül_lﬂd
, 
s
);

575 
	`qemu_ªgi°î_ª£t
(
¶avio_£rül_ª£t
, 
s
);

576 
	`¶avio_£rül_ª£t
(
s
);

577  
s
;

578 
	}
}

580 c⁄° 
uöt8_t
 
	gkeycodes
[128] = {

591 
	$sunkbd_evít
(*
›aque
, 
ch
)

593 
Ch™√lSèã
 *
s
 = 
›aque
;

594 
ªÀa£
 = 
ch
 & 0x80;

596 
ch
 = 
keycodes
[ch & 0x7f];

597 
	`KBD_DPRINTF
("Keycodê%d (%s)\n", 
ch
, 
ªÀa£
? "release" : "press");

598 
	`put_queue
(
s
, 
ch
 | 
ªÀa£
);

599 
	}
}

601 
	$h™dÀ_kbd_comm™d
(
Ch™√lSèã
 *
s
, 
vÆ
)

603 
	`KBD_DPRINTF
("Comm™d %d\n", 
vÆ
);

604 
vÆ
) {

606 
	`put_queue
(
s
, 0xff);

607 
	`put_queue
(
s
, 5);

610 
	`put_queue
(
s
, 0xfe);

611 
	`put_queue
(
s
, 0x20);

616 
	}
}

618 
	$sunmou£_evít
(*
›aque
,

619 
dx
, 
dy
, 
dz
, 
buâ⁄s_°©e
)

621 
Ch™√lSèã
 *
s
 = 
›aque
;

622 
ch
;

625 i‡(
dx
 =0 && 
dy
 =0 && 
dz
 =0 && 
buâ⁄s_°©e
 == 0)

627 
	`MS_DPRINTF
("dx=%d dy=%d buâ⁄s=%01x\n", 
dx
, 
dy
, 
buâ⁄s_°©e
);

629 
ch
 = 0x80 | 0x7;

631 i‡(
buâ⁄s_°©e
 & 
MOUSE_EVENT_LBUTTON
)

632 
ch
 ^= 0x4;

633 i‡(
buâ⁄s_°©e
 & 
MOUSE_EVENT_MBUTTON
)

634 
ch
 ^= 0x2;

635 i‡(
buâ⁄s_°©e
 & 
MOUSE_EVENT_RBUTTON
)

636 
ch
 ^= 0x1;

638 
	`put_queue
(
s
, 
ch
);

640 
ch
 = 
dx
;

642 i‡(
ch
 > 127)

643 
ch
=127;

644 i‡(
ch
 < -127)

645 
ch
=-127;

647 
	`put_queue
(
s
, 
ch
 & 0xff);

649 
ch
 = -
dy
;

651 i‡(
ch
 > 127)

652 
ch
=127;

653 i‡(
ch
 < -127)

654 
ch
=-127;

656 
	`put_queue
(
s
, 
ch
 & 0xff);

660 
	`put_queue
(
s
, 0);

661 
	`put_queue
(
s
, 0);

662 
	}
}

664 
	$¶avio_£rül_ms_kbd_öô
(
ba£
, 
úq
)

666 
¶avio_£rül_io_mem‹y
, 
i
;

667 
SîülSèã
 *
s
;

669 
s
 = 
	`qemu_mÆlocz
((
SîülSèã
));

670 i‡(!
s
)

672 
i
 = 0; i < 2; i++) {

673 
s
->
chn
[
i
].
úq
 = irq;

674 
s
->
chn
[
i
].chn = 1 - i;

675 
s
->
chn
[
i
].
chr
 = 
NULL
;

677 
s
->
chn
[0].
Ÿhîchn
 = &s->chn[1];

678 
s
->
chn
[1].
Ÿhîchn
 = &s->chn[0];

679 
s
->
chn
[0].
ty≥
 = 
mou£
;

680 
s
->
chn
[1].
ty≥
 = 
kbd
;

682 
¶avio_£rül_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
¶avio_£rül_mem_ªad
, 
¶avio_£rül_mem_wrôe
, 
s
);

683 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 
SERIAL_MAXADDR
, 
¶avio_£rül_io_mem‹y
);

685 
	`qemu_add_mou£_evít_h™dÀr
(
sunmou£_evít
, &
s
->
chn
[0], 0, "QEMU Sun Mouse");

686 
	`qemu_add_kbd_evít_h™dÀr
(
sunkbd_evít
, &
s
->
chn
[1]);

687 
	`qemu_ªgi°î_ª£t
(
¶avio_£rül_ª£t
, 
s
);

688 
	`¶avio_£rül_ª£t
(
s
);

689 
	}
}

	@slavio_timer.c

24 
	~"vl.h
"

28 #ifde‡
DEBUG_TIMER


29 
	#DPRINTF
(
fmt
, 
¨gs
...) \

30 dÿ{ 
	`¥ötf
("TIMER: " 
fmt
 , ##
¨gs
); } 0)

	)

32 
	#DPRINTF
(
fmt
, 
¨gs
...)

	)

50 
	sSLAVIO_TIMERSèã
 {

51 
uöt32_t
 
	mlimô
, 
	mcou¡
, 
	mcou¡high
;

52 
öt64_t
 
	mcou¡_lﬂd_time
;

53 
öt64_t
 
	mexpúe_time
;

54 
öt64_t
 
	m°›_time
, 
	mtick_off£t
;

55 
QEMUTimî
 *
	múq_timî
;

56 
	múq
;

57 
	mªached
, 
	m°›≥d
;

58 
	mmode
;

59 
	m˝u
;

60 } 
	tSLAVIO_TIMERSèã
;

62 
	#TIMER_MAXADDR
 0x1f

	)

63 
	#CNT_FREQ
 2000000

	)

66 
	$¶avio_timî_gë_out
(
SLAVIO_TIMERSèã
 *
s
)

68 
out
;

69 
öt64_t
 
diff
, 
ticks
, 
cou¡
;

70 
uöt32_t
 
limô
;

74 i‡(
s
->
mode
 =1 && s->
°›≥d
)

75 
ticks
 = 
s
->
°›_time
;

77 
ticks
 = 
	`qemu_gë_˛ock
(
vm_˛ock
Ë- 
s
->
tick_off£t
;

79 
out
 = (
ticks
 > 
s
->
expúe_time
);

80 i‡(
out
)

81 
s
->
ªached
 = 0x80000000;

82 i‡(!
s
->
limô
)

83 
limô
 = 0x7fffffff;

85 
limô
 = 
s
->limit;

88 
limô
 =Üimit >> 9;

91 
diff
 = 
	`muldiv64
(
ticks
 - 
s
->
cou¡_lﬂd_time
, 
CNT_FREQ
, 
ticks_≥r_£c
);

95 
cou¡
 = 
diff
 % 
limô
;

96 
s
->
cou¡
 = count << 9;

97 
s
->
cou¡high
 = 
cou¡
 >> 22;

101 
s
->
expúe_time
 = 
ticks
 + 
	`muldiv64
(
limô
 - 
cou¡
, 
ticks_≥r_£c
, 
CNT_FREQ
);

103 
	`DPRINTF
("úq %dÜimô %dÑóched %d d %" 
PRId64
 " cou¡ %d s->¯%x dif‡%" PRId64 " st›≥d %d modê%d\n", 
s
->
úq
, 
limô
, s->
ªached
?1:0, (
ticks
-s->
cou¡_lﬂd_time
), 
cou¡
, s->cou¡, s->
expúe_time
 -Åicks, s->
°›≥d
, s->
mode
);

105 i‡(
s
->
mode
 != 1)

106 
	`pic_£t_úq_˝u
(
s
->
úq
, 
out
, s->
˝u
);

107 
	}
}

110 
	$¶avio_timî_úq
(*
›aque
)

112 
SLAVIO_TIMERSèã
 *
s
 = 
›aque
;

114 i‡(!
s
->
úq_timî
)

116 
	`¶avio_timî_gë_out
(
s
);

117 i‡(
s
->
mode
 != 1)

118 
	`qemu_mod_timî
(
s
->
úq_timî
, s->
expúe_time
);

119 
	}
}

121 
uöt32_t
 
	$¶avio_timî_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

123 
SLAVIO_TIMERSèã
 *
s
 = 
›aque
;

124 
uöt32_t
 
ßddr
;

126 
ßddr
 = (
addr
 & 
TIMER_MAXADDR
) >> 2;

127 
ßddr
) {

131 i‡(
s
->
mode
 != 1) {

133 
	`pic_£t_úq_˝u
(
s
->
úq
, 0, s->
˝u
);

134 
s
->
cou¡_lﬂd_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

135 
s
->
ªached
 = 0;

136  
s
->
limô
;

139 
	`¶avio_timî_gë_out
(
s
);

140  
s
->
cou¡high
 & 0x7fffffff;

145 
	`¶avio_timî_gë_out
(
s
);

146 i‡(
s
->
mode
 != 1)

147  (
s
->
cou¡
 & 0x7fffffffË| s->
ªached
;

149  
s
->
cou¡
;

152  
s
->
°›≥d
;

155  
s
->
mode
 & 1;

159 
	}
}

161 
	$¶avio_timî_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

163 
SLAVIO_TIMERSèã
 *
s
 = 
›aque
;

164 
uöt32_t
 
ßddr
;

166 
ßddr
 = (
addr
 & 
TIMER_MAXADDR
) >> 2;

167 
ßddr
) {

170 
s
->
cou¡_lﬂd_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

174 i‡(!
vÆ
)

175 
s
->
limô
 = 0x7fffffff;

177 
s
->
limô
 = 
vÆ
 & 0x7fffffff;

178 
	`¶avio_timî_úq
(
s
);

182 i‡(
s
->
mode
 == 1) {

183 i‡(
vÆ
 & 1) {

184 
s
->
°›_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

185 
s
->
°›≥d
 = 1;

188 i‡(
s
->
°›≥d
)

189 
s
->
tick_off£t
 +
	`qemu_gë_˛ock
(
vm_˛ock
Ë- s->
°›_time
;

190 
s
->
°›≥d
 = 0;

196 i‡(
s
->
mode
 == 0 || s->mode == 1)

197 
s
->
mode
 = 
vÆ
 & 1;

202 
	}
}

204 
CPURódMem‹yFunc
 *
	g¶avio_timî_mem_ªad
[3] = {

205 
¶avio_timî_mem_ªadl
,

206 
¶avio_timî_mem_ªadl
,

207 
¶avio_timî_mem_ªadl
,

210 
CPUWrôeMem‹yFunc
 *
	g¶avio_timî_mem_wrôe
[3] = {

211 
¶avio_timî_mem_wrôñ
,

212 
¶avio_timî_mem_wrôñ
,

213 
¶avio_timî_mem_wrôñ
,

216 
	$¶avio_timî_ßve
(
QEMUFûe
 *
f
, *
›aque
)

218 
SLAVIO_TIMERSèã
 *
s
 = 
›aque
;

220 
	`qemu_put_be32s
(
f
, &
s
->
limô
);

221 
	`qemu_put_be32s
(
f
, &
s
->
cou¡
);

222 
	`qemu_put_be32s
(
f
, &
s
->
cou¡high
);

223 
	`qemu_put_be64s
(
f
, &
s
->
cou¡_lﬂd_time
);

224 
	`qemu_put_be64s
(
f
, &
s
->
expúe_time
);

225 
	`qemu_put_be64s
(
f
, &
s
->
°›_time
);

226 
	`qemu_put_be64s
(
f
, &
s
->
tick_off£t
);

227 
	`qemu_put_be32s
(
f
, &
s
->
úq
);

228 
	`qemu_put_be32s
(
f
, &
s
->
ªached
);

229 
	`qemu_put_be32s
(
f
, &
s
->
°›≥d
);

230 
	`qemu_put_be32s
(
f
, &
s
->
mode
);

231 
	}
}

233 
	$¶avio_timî_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

235 
SLAVIO_TIMERSèã
 *
s
 = 
›aque
;

237 i‡(
vîsi⁄_id
 != 1)

238  -
EINVAL
;

240 
	`qemu_gë_be32s
(
f
, &
s
->
limô
);

241 
	`qemu_gë_be32s
(
f
, &
s
->
cou¡
);

242 
	`qemu_gë_be32s
(
f
, &
s
->
cou¡high
);

243 
	`qemu_gë_be64s
(
f
, &
s
->
cou¡_lﬂd_time
);

244 
	`qemu_gë_be64s
(
f
, &
s
->
expúe_time
);

245 
	`qemu_gë_be64s
(
f
, &
s
->
°›_time
);

246 
	`qemu_gë_be64s
(
f
, &
s
->
tick_off£t
);

247 
	`qemu_gë_be32s
(
f
, &
s
->
úq
);

248 
	`qemu_gë_be32s
(
f
, &
s
->
ªached
);

249 
	`qemu_gë_be32s
(
f
, &
s
->
°›≥d
);

250 
	`qemu_gë_be32s
(
f
, &
s
->
mode
);

252 
	}
}

254 
	$¶avio_timî_ª£t
(*
›aque
)

256 
SLAVIO_TIMERSèã
 *
s
 = 
›aque
;

258 
s
->
limô
 = 0;

259 
s
->
cou¡
 = 0;

260 
s
->
cou¡_lﬂd_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);;

261 
s
->
°›_time
 = s->
cou¡_lﬂd_time
;

262 
s
->
tick_off£t
 = 0;

263 
s
->
ªached
 = 0;

264 
s
->
mode
 &= 2;

265 
s
->
°›≥d
 = 1;

266 
	`¶avio_timî_gë_out
(
s
);

267 
	}
}

269 
	$¶avio_timî_öô
(
uöt32_t
 
addr
, 
úq
, 
mode
, 
˝u
)

271 
¶avio_timî_io_mem‹y
;

272 
SLAVIO_TIMERSèã
 *
s
;

274 
s
 = 
	`qemu_mÆlocz
((
SLAVIO_TIMERSèã
));

275 i‡(!
s
)

277 
s
->
úq
 = irq;

278 
s
->
mode
 = mode;

279 
s
->
˝u
 = cpu;

280 
s
->
úq_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
¶avio_timî_úq
, s);

282 
¶avio_timî_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
¶avio_timî_mem_ªad
,

283 
¶avio_timî_mem_wrôe
, 
s
);

284 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
TIMER_MAXADDR
, 
¶avio_timî_io_mem‹y
);

285 
	`ªgi°î_ßvevm
("¶avio_timî", 
addr
, 1, 
¶avio_timî_ßve
, 
¶avio_timî_lﬂd
, 
s
);

286 
	`qemu_ªgi°î_ª£t
(
¶avio_timî_ª£t
, 
s
);

287 
	`¶avio_timî_ª£t
(
s
);

288 
	}
}

	@smbus.h

25 
SMBusDevi˚
 
	tSMBusDevi˚
;

27 
	sSMBusDevi˚
 {

28 
uöt8_t
 
	maddr
;

29 (*
	mquick_cmd
)(
SMBusDevi˚
 *
	mdev
, 
uöt8_t
 
	mªad
);

30 (*
	m£nd_byã
)(
SMBusDevi˚
 *
	mdev
, 
uöt8_t
 
	mvÆ
);

31 
uöt8_t
 (*
ª˚ive_byã
)(
SMBusDevi˚
 *
	mdev
);

32 (*
	mwrôe_byã
)(
SMBusDevi˚
 *
	mdev
, 
uöt8_t
 
	mcmd
, uöt8_à
	mvÆ
);

33 
uöt8_t
 (*
ªad_byã
)(
SMBusDevi˚
 *
	mdev
, uöt8_à
	mcmd
);

34 (*
	mwrôe_w‹d
)(
SMBusDevi˚
 *
	mdev
, 
uöt8_t
 
	mcmd
, 
uöt16_t
 
	mvÆ
);

35 
uöt16_t
 (*
ªad_w‹d
)(
SMBusDevi˚
 *
	mdev
, 
uöt8_t
 
	mcmd
);

36 (*
	mwrôe_block
)(
SMBusDevi˚
 *
	mdev
, 
uöt8_t
 
	mcmd
, uöt8_à
	mÀn
, uöt8_à*
	mbuf
);

37 
uöt8_t
 (*
ªad_block
)(
SMBusDevi˚
 *
	mdev
, uöt8_à
	mcmd
, uöt8_à*
	mbuf
);

	@smbus_eeprom.c

25 
	~"vl.h
"

29 
	sSMBusEEPROMDevi˚
 {

30 
SMBusDevi˚
 
	mdev
;

31 
uöt8_t
 *
	md©a
;

32 
uöt8_t
 
	moff£t
;

33 } 
	tSMBusEEPROMDevi˚
;

35 
	$ì¥om_quick_cmd
(
SMBusDevi˚
 *
dev
, 
uöt8_t
 
ªad
)

37 #ifde‡
DEBUG


38 
	`¥ötf
("ì¥om_quick_cmd:áddr=0x%02xÑód=%d\n", 
dev
->
addr
, 
ªad
);

40 
	}
}

42 
	$ì¥om_£nd_byã
(
SMBusDevi˚
 *
dev
, 
uöt8_t
 
vÆ
)

44 
SMBusEEPROMDevi˚
 *
ì¥om
 = (SMBusEEPROMDevi˚ *Ë
dev
;

45 #ifde‡
DEBUG


46 
	`¥ötf
("ì¥om_£nd_byã:áddr=0x%02x vÆ=0x%02x\n", 
dev
->
addr
, 
vÆ
);

48 
ì¥om
->
off£t
 = 
vÆ
;

49 
	}
}

51 
uöt8_t
 
	$ì¥om_ª˚ive_byã
(
SMBusDevi˚
 *
dev
)

53 
SMBusEEPROMDevi˚
 *
ì¥om
 = (SMBusEEPROMDevi˚ *Ë
dev
;

54 
uöt8_t
 
vÆ
 = 
ì¥om
->
d©a
[ì¥om->
off£t
++];

55 #ifde‡
DEBUG


56 
	`¥ötf
("ì¥om_ª˚ive_byã:áddr=0x%02x vÆ=0x%02x\n", 
dev
->
addr
, 
vÆ
);

58  
vÆ
;

59 
	}
}

61 
	$ì¥om_wrôe_byã
(
SMBusDevi˚
 *
dev
, 
uöt8_t
 
cmd
, uöt8_à
vÆ
)

63 
SMBusEEPROMDevi˚
 *
ì¥om
 = (SMBusEEPROMDevi˚ *Ë
dev
;

64 #ifde‡
DEBUG


65 
	`¥ötf
("ì¥om_wrôe_byã:áddr=0x%02x cmd=0x%02x vÆ=0x%02x\n", 
dev
->
addr
,

66 
cmd
, 
vÆ
);

68 
ì¥om
->
d©a
[
cmd
] = 
vÆ
;

69 
	}
}

71 
uöt8_t
 
	$ì¥om_ªad_byã
(
SMBusDevi˚
 *
dev
, 
uöt8_t
 
cmd
)

73 
SMBusEEPROMDevi˚
 *
ì¥om
 = (SMBusEEPROMDevi˚ *Ë
dev
;

74 
uöt8_t
 
vÆ
 = 
ì¥om
->
d©a
[
cmd
];

75 #ifde‡
DEBUG


76 
	`¥ötf
("ì¥om_ªad_byã:áddr=0x%02x cmd=0x%02x vÆ=0x%02x\n", 
dev
->
addr
,

77 
cmd
, 
vÆ
);

79  
vÆ
;

80 
	}
}

82 
SMBusDevi˚
 *
	$smbus_ì¥om_devi˚_öô
(
uöt8_t
 
addr
, uöt8_à*
buf
)

84 
SMBusEEPROMDevi˚
 *
ì¥om
 = 
	`qemu_mÆlocz
((SMBusEEPROMDevice));

85 
ì¥om
->
dev
.
addr
 =áddr;

86 
ì¥om
->
dev
.
quick_cmd
 = 
ì¥om_quick_cmd
;

87 
ì¥om
->
dev
.
£nd_byã
 = 
ì¥om_£nd_byã
;

88 
ì¥om
->
dev
.
ª˚ive_byã
 = 
ì¥om_ª˚ive_byã
;

89 
ì¥om
->
dev
.
wrôe_byã
 = 
ì¥om_wrôe_byã
;

90 
ì¥om
->
dev
.
ªad_byã
 = 
ì¥om_ªad_byã
;

91 
ì¥om
->
d©a
 = 
buf
;

92 
ì¥om
->
off£t
 = 0;

93  (
SMBusDevi˚
 *Ë
ì¥om
;

94 
	}
}

	@smc91c111.c

10 
	~"vl.h
"

12 
	~<zlib.h
>

15 
	#NUM_PACKETS
 4

	)

18 
uöt32_t
 
	mba£
;

19 
VLANClõ¡Sèã
 *
	mvc
;

20 
uöt16_t
 
	mt¸
;

21 
uöt16_t
 
	mr¸
;

22 
uöt16_t
 
	m¸
;

23 
uöt16_t
 
	m˘r
;

24 
uöt16_t
 
	mg¥
;

25 
uöt16_t
 
	m±r
;

26 
uöt16_t
 
	mîcv
;

27 *
	mpic
;

28 
	múq
;

29 
	mb™k
;

30 
	m∑ckë_num
;

31 
	mtx_Æloc
;

33 
	mÆloˇãd
;

34 
	mtx_fifo_Àn
;

35 
	mtx_fifo
[
NUM_PACKETS
];

36 
	mrx_fifo_Àn
;

37 
	mrx_fifo
[
NUM_PACKETS
];

38 
	mtx_fifo_d⁄e_Àn
;

39 
	mtx_fifo_d⁄e
[
NUM_PACKETS
];

41 
uöt8_t
 
	md©a
[
NUM_PACKETS
][2048];

42 
uöt8_t
 
	möt_Àvñ
;

43 
uöt8_t
 
	möt_mask
;

44 
uöt8_t
 
	mmaˇddr
[6];

45 } 
	tsmc91c111_°©e
;

47 
	#RCR_SOFT_RST
 0x8000

	)

48 
	#RCR_STRIP_CRC
 0x0200

	)

49 
	#RCR_RXEN
 0x0100

	)

51 
	#TCR_EPH_LOOP
 0x2000

	)

52 
	#TCR_NOCRC
 0x0100

	)

53 
	#TCR_PAD_EN
 0x0080

	)

54 
	#TCR_FORCOL
 0x0004

	)

55 
	#TCR_LOOP
 0x0002

	)

56 
	#TCR_TXEN
 0x0001

	)

58 
	#INT_MD
 0x80

	)

59 
	#INT_ERCV
 0x40

	)

60 
	#INT_EPH
 0x20

	)

61 
	#INT_RX_OVRN
 0x10

	)

62 
	#INT_ALLOC
 0x08

	)

63 
	#INT_TX_EMPTY
 0x04

	)

64 
	#INT_TX
 0x02

	)

65 
	#INT_RCV
 0x01

	)

67 
	#CTR_AUTO_RELEASE
 0x0800

	)

68 
	#CTR_RELOAD
 0x0002

	)

69 
	#CTR_STORE
 0x0001

	)

71 
	#RS_ALGNERR
 0x8000

	)

72 
	#RS_BRODCAST
 0x4000

	)

73 
	#RS_BADCRC
 0x2000

	)

74 
	#RS_ODDFRAME
 0x1000

	)

75 
	#RS_TOOLONG
 0x0800

	)

76 
	#RS_TOOSHORT
 0x0400

	)

77 
	#RS_MULTICAST
 0x0001

	)

80 
	$smc91c111_upd©e
(
smc91c111_°©e
 *
s
)

82 
Àvñ
;

84 i‡(
s
->
tx_fifo_Àn
 == 0)

85 
s
->
öt_Àvñ
 |
INT_TX_EMPTY
;

86 i‡(
s
->
tx_fifo_d⁄e_Àn
 != 0)

87 
s
->
öt_Àvñ
 |
INT_TX
;

88 
Àvñ
 = (
s
->
öt_Àvñ
 & s->
öt_mask
) != 0;

89 
	`pic_£t_úq_√w
(
s
->
pic
, s->
úq
, 
Àvñ
);

90 
	}
}

93 
	$smc91c111_Æloˇã_∑ckë
(
smc91c111_°©e
 *
s
)

95 
i
;

96 i‡(
s
->
Æloˇãd
 =(1 << 
NUM_PACKETS
) - 1) {

100 
i
 = 0; i < 
NUM_PACKETS
; i++) {

101 i‡((
s
->
Æloˇãd
 & (1 << 
i
)) == 0)

104 
s
->
Æloˇãd
 |1 << 
i
;

105  
i
;

106 
	}
}

110 
	$smc91c111_tx_Æloc
(
smc91c111_°©e
 *
s
)

112 
s
->
tx_Æloc
 = 
	`smc91c111_Æloˇã_∑ckë
(s);

113 i‡(
s
->
tx_Æloc
 == 0x80)

115 
s
->
öt_Àvñ
 |
INT_ALLOC
;

116 
	`smc91c111_upd©e
(
s
);

117 
	}
}

120 
	$smc91c111_p›_rx_fifo
(
smc91c111_°©e
 *
s
)

122 
i
;

124 
s
->
rx_fifo_Àn
--;

125 i‡(
s
->
rx_fifo_Àn
) {

126 
i
 = 0; i < 
s
->
rx_fifo_Àn
; i++)

127 
s
->
rx_fifo
[
i
] = s->rx_fifo[i + 1];

128 
s
->
öt_Àvñ
 |
INT_RCV
;

130 
s
->
öt_Àvñ
 &~
INT_RCV
;

132 
	`smc91c111_upd©e
(
s
);

133 
	}
}

136 
	$smc91c111_p›_tx_fifo_d⁄e
(
smc91c111_°©e
 *
s
)

138 
i
;

140 i‡(
s
->
tx_fifo_d⁄e_Àn
 == 0)

142 
s
->
tx_fifo_d⁄e_Àn
--;

143 
i
 = 0; i < 
s
->
tx_fifo_d⁄e_Àn
; i++)

144 
s
->
tx_fifo_d⁄e
[
i
] = s->tx_fifo_done[i + 1];

145 
	}
}

148 
	$smc91c111_ªÀa£_∑ckë
(
smc91c111_°©e
 *
s
, 
∑ckë
)

150 
s
->
Æloˇãd
 &~(1 << 
∑ckë
);

151 i‡(
s
->
tx_Æloc
 == 0x80)

152 
	`smc91c111_tx_Æloc
(
s
);

153 
	}
}

156 
	$smc91c111_do_tx
(
smc91c111_°©e
 *
s
)

158 
i
;

159 
Àn
;

160 
c⁄åﬁ
;

161 
add_¸c
;

162 
∑ckënum
;

163 
uöt8_t
 *
p
;

165 i‡((
s
->
t¸
 & 
TCR_TXEN
) == 0)

167 i‡(
s
->
tx_fifo_Àn
 == 0)

169 
i
 = 0; i < 
s
->
tx_fifo_Àn
; i++) {

170 
∑ckënum
 = 
s
->
tx_fifo
[
i
];

171 
p
 = &
s
->
d©a
[
∑ckënum
][0];

173 *(
p
++) = 0x01;

174 *(
p
++) = 0x40;

175 
Àn
 = *(
p
++);

176 
Àn
 |(()*(
p
++)) << 8;

177 
Àn
 -= 6;

178 
c⁄åﬁ
 = 
p
[
Àn
 + 1];

179 i‡(
c⁄åﬁ
 & 0x20)

180 
Àn
++;

183 i‡(
Àn
 < 64 && (
s
->
t¸
 & 
TCR_PAD_EN
)) {

184 
	`mem£t
(
p
 + 
Àn
, 0, 64 -Üen);

185 
Àn
 = 64;

192 
add_¸c
 = (
c⁄åﬁ
 & 0x10Ë|| (
s
->
t¸
 & 
TCR_NOCRC
) == 0;

193 i‡(
add_¸c
) {

194 
uöt32_t
 
¸c
;

196 
¸c
 = 
	`¸c32
(~0, 
p
, 
Àn
);

197 
	`mem˝y
(
p
 + 
Àn
, &
¸c
, 4);

198 
Àn
 += 4;

201 
add_¸c
 = 0;

203 i‡(
s
->
˘r
 & 
CTR_AUTO_RELEASE
)

205 
	`smc91c111_ªÀa£_∑ckë
(
s
, 
∑ckënum
);

206 i‡(
s
->
tx_fifo_d⁄e_Àn
 < 
NUM_PACKETS
)

207 
s
->
tx_fifo_d⁄e
[s->
tx_fifo_d⁄e_Àn
++] = 
∑ckënum
;

208 
	`qemu_£nd_∑ckë
(
s
->
vc
, 
p
, 
Àn
);

210 
s
->
tx_fifo_Àn
 = 0;

211 
	`smc91c111_upd©e
(
s
);

212 
	}
}

215 
	$smc91c111_queue_tx
(
smc91c111_°©e
 *
s
, 
∑ckë
)

217 i‡(
s
->
tx_fifo_Àn
 =
NUM_PACKETS
)

219 
s
->
tx_fifo
[s->
tx_fifo_Àn
++] = 
∑ckë
;

220 
	`smc91c111_do_tx
(
s
);

221 
	}
}

223 
	$smc91c111_ª£t
(
smc91c111_°©e
 *
s
)

225 
s
->
b™k
 = 0;

226 
s
->
tx_fifo_Àn
 = 0;

227 
s
->
tx_fifo_d⁄e_Àn
 = 0;

228 
s
->
rx_fifo_Àn
 = 0;

229 
s
->
Æloˇãd
 = 0;

230 
s
->
∑ckë_num
 = 0;

231 
s
->
tx_Æloc
 = 0;

232 
s
->
t¸
 = 0;

233 
s
->
r¸
 = 0;

234 
s
->
¸
 = 0xa0b1;

235 
s
->
˘r
 = 0x1210;

236 
s
->
±r
 = 0;

237 
s
->
îcv
 = 0x1f;

238 
s
->
öt_Àvñ
 = 
INT_TX_EMPTY
;

239 
s
->
öt_mask
 = 0;

240 
	`smc91c111_upd©e
(
s
);

241 
	}
}

243 
	#SET_LOW
(
«me
, 
vÆ
Ë
s
->«mê(s->«mê& 0xff00Ë| 
	)
val

244 
	#SET_HIGH
(
«me
, 
vÆ
Ë
s
->«mê(s->«mê& 0xffË| (vÆ << 8)

	)

246 
	$smc91c111_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

247 
uöt32_t
 
vÆue
)

249 
smc91c111_°©e
 *
s
 = (smc91c111_°©ê*)
›aque
;

251 
off£t
 -
s
->
ba£
;

252 i‡(
off£t
 == 14) {

253 
s
->
b™k
 = 
vÆue
;

256 i‡(
off£t
 == 15)

258 
s
->
b™k
) {

260 
off£t
) {

262 
	`SET_LOW
(
t¸
, 
vÆue
);

265 
	`SET_HIGH
(
t¸
, 
vÆue
);

268 
	`SET_LOW
(
r¸
, 
vÆue
);

271 
	`SET_HIGH
(
r¸
, 
vÆue
);

272 i‡(
s
->
r¸
 & 
RCR_SOFT_RST
)

273 
	`smc91c111_ª£t
(
s
);

282 
off£t
) {

284 
	`SET_LOW
(
¸
, 
vÆue
);

287 
	`SET_HIGH
(
¸
,
vÆue
);

294 
	`SET_LOW
(
g¥
, 
vÆue
);

297 
	`SET_HIGH
(
g¥
, 
vÆue
);

300 i‡(
vÆue
 & 1)

301 
	`Ârötf
(
°dîr
, "smc91c111:EEPROM storeÇot implemented\n");

302 i‡(
vÆue
 & 2)

303 
	`Ârötf
(
°dîr
, "smc91c111:EEPROMÑeloadÇot implemented\n");

304 
vÆue
 &= ~3;

305 
	`SET_LOW
(
˘r
, 
vÆue
);

308 
	`SET_HIGH
(
˘r
, 
vÆue
);

314 
off£t
) {

316 
vÆue
 >> 5) {

320 
s
->
tx_Æloc
 = 0x80;

321 
s
->
öt_Àvñ
 &~
INT_ALLOC
;

322 
	`smc91c111_upd©e
(
s
);

323 
	`smc91c111_tx_Æloc
(
s
);

326 
s
->
Æloˇãd
 = 0;

327 
s
->
tx_fifo_Àn
 = 0;

328 
s
->
tx_fifo_d⁄e_Àn
 = 0;

329 
s
->
rx_fifo_Àn
 = 0;

330 
s
->
tx_Æloc
 = 0;

333 
	`smc91c111_p›_rx_fifo
(
s
);

336 i‡(
s
->
rx_fifo_Àn
 > 0) {

337 
	`smc91c111_ªÀa£_∑ckë
(
s
, s->
rx_fifo
[0]);

339 
	`smc91c111_p›_rx_fifo
(
s
);

342 
	`smc91c111_ªÀa£_∑ckë
(
s
, s->
∑ckë_num
);

345 
	`smc91c111_queue_tx
(
s
, s->
∑ckë_num
);

348 
s
->
tx_fifo_Àn
 = 0;

349 
s
->
tx_fifo_d⁄e_Àn
 = 0;

357 
s
->
∑ckë_num
 = 
vÆue
;

363 
	`SET_LOW
(
±r
, 
vÆue
);

366 
	`SET_HIGH
(
±r
, 
vÆue
);

370 
p
;

371 
n
;

373 i‡(
s
->
±r
 & 0x8000)

374 
n
 = 
s
->
rx_fifo
[0];

376 
n
 = 
s
->
∑ckë_num
;

377 
p
 = 
s
->
±r
 & 0x07ff;

378 i‡(
s
->
±r
 & 0x4000) {

379 
s
->
±r
 = (s->ptr & 0xf800) | ((s->ptr + 1) & 0x7ff);

381 
p
 +(
off£t
 & 3);

383 
s
->
d©a
[
n
][
p
] = 
vÆue
;

387 
s
->
öt_Àvñ
 &~(
vÆue
 & 0xd6);

388 i‡(
vÆue
 & 
INT_TX
)

389 
	`smc91c111_p›_tx_fifo_d⁄e
(
s
);

390 
	`smc91c111_upd©e
(
s
);

393 
s
->
öt_mask
 = 
vÆue
;

394 
	`smc91c111_upd©e
(
s
);

400 
off£t
) {

409 
s
->
îcv
 = 
vÆue
 & 0x1f;

416 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "smc91c111_write: BadÑeg %d:%x\n",

417 
s
->
b™k
, 
off£t
);

418 
	}
}

420 
uöt32_t
 
	$smc91c111_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

422 
smc91c111_°©e
 *
s
 = (smc91c111_°©ê*)
›aque
;

424 
off£t
 -
s
->
ba£
;

425 i‡(
off£t
 == 14) {

426  
s
->
b™k
;

428 i‡(
off£t
 == 15)

430 
s
->
b™k
) {

432 
off£t
) {

434  
s
->
t¸
 & 0xff;

436  
s
->
t¸
 >> 8;

442  
s
->
r¸
 & 0xff;

444  
s
->
r¸
 >> 8;

451 
i
;

452 
n
;

453 
n
 = 0;

454 
i
 = 0; i < 
NUM_PACKETS
; i++) {

455 i‡(
s
->
Æloˇãd
 & (1 << 
i
))

456 
n
++;

458  
n
;

461  
NUM_PACKETS
;

469 
off£t
) {

471  
s
->
¸
 & 0xff;

473  
s
->
¸
 >> 8;

478  
s
->
maˇddr
[
off£t
 - 4];

480  
s
->
g¥
 & 0xff;

482  
s
->
g¥
 >> 8;

484  
s
->
˘r
 & 0xff;

486  
s
->
˘r
 >> 8;

491 
off£t
) {

495  
s
->
∑ckë_num
;

497  
s
->
tx_Æloc
;

499 i‡(
s
->
tx_fifo_d⁄e_Àn
 == 0)

502  
s
->
tx_fifo_d⁄e
[0];

504 i‡(
s
->
rx_fifo_Àn
 == 0)

507  
s
->
rx_fifo
[0];

509  
s
->
±r
 & 0xff;

511  (
s
->
±r
 >> 8) & 0xf7;

514 
p
;

515 
n
;

517 i‡(
s
->
±r
 & 0x8000)

518 
n
 = 
s
->
rx_fifo
[0];

520 
n
 = 
s
->
∑ckë_num
;

521 
p
 = 
s
->
±r
 & 0x07ff;

522 i‡(
s
->
±r
 & 0x4000) {

523 
s
->
±r
 = (s->ptr & 0xf800) | ((s->ptr + 1) & 0x07ff);

525 
p
 +(
off£t
 & 3);

527  
s
->
d©a
[
n
][
p
];

530  
s
->
öt_Àvñ
;

532  
s
->
öt_mask
;

537 
off£t
) {

552  
s
->
îcv
;

558 
	`˝u_ab‹t
 (
˝u_sögÀ_ív
, "smc91c111_read: BadÑeg %d:%x\n",

559 
s
->
b™k
, 
off£t
);

561 
	}
}

563 
	$smc91c111_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

564 
uöt32_t
 
vÆue
)

566 
	`smc91c111_wrôeb
(
›aque
, 
off£t
, 
vÆue
 & 0xff);

567 
	`smc91c111_wrôeb
(
›aque
, 
off£t
 + 1, 
vÆue
 >> 8);

568 
	}
}

570 
	$smc91c111_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

571 
uöt32_t
 
vÆue
)

573 
smc91c111_°©e
 *
s
 = (smc91c111_°©ê*)
›aque
;

576 i‡(
off£t
 !
s
->
ba£
 + 0xc)

577 
	`smc91c111_wrôew
(
›aque
, 
off£t
, 
vÆue
 & 0xffff);

578 
	`smc91c111_wrôew
(
›aque
, 
off£t
 + 2, 
vÆue
 >> 16);

579 
	}
}

581 
uöt32_t
 
	$smc91c111_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

583 
uöt32_t
 
vÆ
;

584 
vÆ
 = 
	`smc91c111_ªadb
(
›aque
, 
off£t
);

585 
vÆ
 |
	`smc91c111_ªadb
(
›aque
, 
off£t
 + 1) << 8;

586  
vÆ
;

587 
	}
}

589 
uöt32_t
 
	$smc91c111_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

591 
uöt32_t
 
vÆ
;

592 
vÆ
 = 
	`smc91c111_ªadw
(
›aque
, 
off£t
);

593 
vÆ
 |
	`smc91c111_ªadw
(
›aque
, 
off£t
 + 2) << 16;

594  
vÆ
;

595 
	}
}

597 
	$smc91c111_ˇn_ª˚ive
(*
›aque
)

599 
smc91c111_°©e
 *
s
 = (smc91c111_°©ê*)
›aque
;

601 i‡((
s
->
r¸
 & 
RCR_RXEN
Ë=0 || (s->r¸ & 
RCR_SOFT_RST
))

603 i‡(
s
->
Æloˇãd
 =(1 << 
NUM_PACKETS
) - 1)

606 
	}
}

608 
	$smc91c111_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
size
)

610 
smc91c111_°©e
 *
s
 = (smc91c111_°©ê*)
›aque
;

611 
°©us
;

612 
∑ckësize
;

613 
uöt32_t
 
¸c
;

614 
∑ckënum
;

615 
uöt8_t
 *
p
;

617 i‡((
s
->
r¸
 & 
RCR_RXEN
Ë=0 || (s->r¸ & 
RCR_SOFT_RST
))

621 i‡(
size
 < 64)

622 
∑ckësize
 = 64;

624 
∑ckësize
 = (
size
 & ~1);

625 
∑ckësize
 += 6;

626 
¸c
 = (
s
->
r¸
 & 
RCR_STRIP_CRC
) == 0;

627 i‡(
¸c
)

628 
∑ckësize
 += 4;

630 i‡(
∑ckësize
 > 2048)

632 
∑ckënum
 = 
	`smc91c111_Æloˇã_∑ckë
(
s
);

633 i‡(
∑ckënum
 == 0x80)

635 
s
->
rx_fifo
[s->
rx_fifo_Àn
++] = 
∑ckënum
;

637 
p
 = &
s
->
d©a
[
∑ckënum
][0];

639 
°©us
 = 0;

640 i‡(
size
 > 1518)

641 
°©us
 |
RS_TOOLONG
;

642 i‡(
size
 & 1)

643 
°©us
 |
RS_ODDFRAME
;

644 *(
p
++Ë
°©us
 & 0xff;

645 *(
p
++Ë
°©us
 >> 8;

646 *(
p
++Ë
∑ckësize
 & 0xff;

647 *(
p
++Ë
∑ckësize
 >> 8;

648 
	`mem˝y
(
p
, 
buf
, 
size
 & ~1);

649 
p
 +(
size
 & ~1);

651 i‡(
size
 < 64) {

652 
∑d
;

654 i‡(
size
 & 1)

655 *(
p
++Ë
buf
[
size
 - 1];

656 
∑d
 = 64 - 
size
;

657 
	`mem£t
(
p
, 0, 
∑d
);

658 
p
 +
∑d
;

659 
size
 = 64;

665 i‡(
¸c
) {

666 
¸c
 = 
	`¸c32
(~0, 
buf
, 
size
);

667 *(
p
++Ë
¸c
 & 0xff; crc >>= 8;

668 *(
p
++Ë
¸c
 & 0xff; crc >>= 8;

669 *(
p
++Ë
¸c
 & 0xff; crc >>= 8;

670 *(
p
++Ë
¸c
 & 0xff; crc >>= 8;

672 i‡(
size
 & 1) {

673 *(
p
++Ë
buf
[
size
 - 1];

674 *(
p
++) = 0x60;

676 *(
p
++) = 0;

677 *(
p
++) = 0x40;

680 
s
->
öt_Àvñ
 |
INT_RCV
;

681 
	`smc91c111_upd©e
(
s
);

682 
	}
}

684 
CPURódMem‹yFunc
 *
	gsmc91c111_ªad‚
[] = {

685 
smc91c111_ªadb
,

686 
smc91c111_ªadw
,

687 
smc91c111_ªadl


690 
CPUWrôeMem‹yFunc
 *
	gsmc91c111_wrôe‚
[] = {

691 
smc91c111_wrôeb
,

692 
smc91c111_wrôew
,

693 
smc91c111_wrôñ


696 
	$smc91c111_öô
(
NICInfo
 *
nd
, 
uöt32_t
 
ba£
, *
pic
, 
úq
)

698 
smc91c111_°©e
 *
s
;

699 
iomemty≥
;

701 
s
 = (
smc91c111_°©e
 *)
	`qemu_mÆlocz
((smc91c111_state));

702 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
smc91c111_ªad‚
,

703 
smc91c111_wrôe‚
, 
s
);

704 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 16, 
iomemty≥
);

705 
s
->
ba£
 = base;

706 
s
->
pic
 =Öic;

707 
s
->
úq
 = irq;

708 
	`mem˝y
(
s
->
maˇddr
, 
nd
->macaddr, 6);

710 
	`smc91c111_ª£t
(
s
);

712 
s
->
vc
 = 
	`qemu_√w_vœn_˛õ¡
(
nd
->
vœn
, 
smc91c111_ª˚ive
,

713 
smc91c111_ˇn_ª˚ive
, 
s
);

715 
	}
}

	@sparc32_dma.c

24 
	~"vl.h
"

37 #ifde‡
DEBUG_DMA


38 
	#DPRINTF
(
fmt
, 
¨gs
...) \

39 dÿ{ 
	`¥ötf
("DMA: " 
fmt
 , ##
¨gs
); } 0)

	)

40 
	#pic_£t_úq_√w
(
˘l
, 
úq
, 
Àvñ
) \

41 dÿ{ 
	`¥ötf
("DMA: së_úq(%d): %d\n", (
úq
), (
Àvñ
)); \

42 
	`pic_£t_úq_√w
((
˘l
), (
úq
),(
Àvñ
));} 0)

	)

44 
	#DPRINTF
(
fmt
, 
¨gs
...)

	)

47 
	#DMA_REGS
 8

	)

48 
	#DMA_MAXADDR
 (
DMA_REGS
 * 4 - 1)

	)

50 
	#DMA_VER
 0xa0000000

	)

51 
	#DMA_INTR
 1

	)

52 
	#DMA_INTREN
 0x10

	)

53 
	#DMA_WRITE_MEM
 0x100

	)

54 
	#DMA_LOADED
 0x04000000

	)

55 
	#DMA_RESET
 0x80

	)

57 
DMASèã
 
	tDMASèã
;

59 
	sDMASèã
 {

60 
uöt32_t
 
	mdm¨egs
[
DMA_REGS
];

61 
	me•úq
, 
	mÀúq
;

62 *
	miommu
, *
	me•_›aque
, *
	mœn˚_›aque
, *
	möt˘l
;

65 
	$Àdma_£t_úq
(*
›aque
, 
i§
)

67 
DMASèã
 *
s
 = 
›aque
;

69 
	`pic_£t_úq_√w
(
s
->
öt˘l
, s->
Àúq
, 
i§
);

70 
	}
}

73 
	$Àdma_mem‹y_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

74 
uöt8_t
 *
buf
, 
Àn
, 
do_bsw≠
)

76 
DMASèã
 *
s
 = 
›aque
;

77 
i
;

79 
	`DPRINTF
("DMA write, direction: %c,áddr 0x%8.8x\n",

80 
s
->
dm¨egs
[0] & 
DMA_WRITE_MEM
 ? 'w': 'r', s->dmaregs[1]);

81 
addr
 |
s
->
dm¨egs
[7];

82 i‡(
do_bsw≠
) {

83 
	`•¨c_iommu_mem‹y_ªad
(
s
->
iommu
, 
addr
, 
buf
, 
Àn
);

85 
addr
 &= ~1;

86 
Àn
 &= ~1;

87 
	`•¨c_iommu_mem‹y_ªad
(
s
->
iommu
, 
addr
, 
buf
, 
Àn
);

88 
i
 = 0; i < 
Àn
; i += 2) {

89 
	`bsw≠16s
((
uöt16_t
 *)(
buf
 + 
i
));

92 
	}
}

94 
	$Àdma_mem‹y_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

95 
uöt8_t
 *
buf
, 
Àn
, 
do_bsw≠
)

97 
DMASèã
 *
s
 = 
›aque
;

98 
l
, 
i
;

99 
uöt16_t
 
tmp_buf
[32];

101 
	`DPRINTF
("DMAÑead, direction: %c,áddr 0x%8.8x\n",

102 
s
->
dm¨egs
[0] & 
DMA_WRITE_MEM
 ? 'w': 'r', s->dmaregs[1]);

103 
addr
 |
s
->
dm¨egs
[7];

104 i‡(
do_bsw≠
) {

105 
	`•¨c_iommu_mem‹y_wrôe
(
s
->
iommu
, 
addr
, 
buf
, 
Àn
);

107 
addr
 &= ~1;

108 
Àn
 &= ~1;

109 
Àn
 > 0) {

110 
l
 = 
Àn
;

111 i‡(
l
 > (
tmp_buf
))

112 
l
 = (
tmp_buf
);

113 
i
 = 0; i < 
l
; i += 2) {

114 
tmp_buf
[
i
 >> 1] = 
	`bsw≠16
(*(
uöt16_t
 *)(
buf
 + i));

116 
	`•¨c_iommu_mem‹y_wrôe
(
s
->
iommu
, 
addr
, (
uöt8_t
 *)
tmp_buf
, 
l
);

117 
Àn
 -
l
;

118 
buf
 +
l
;

119 
addr
 +
l
;

122 
	}
}

124 
	$e•dma_øi£_úq
(*
›aque
)

126 
DMASèã
 *
s
 = 
›aque
;

128 
s
->
dm¨egs
[0] |
DMA_INTR
;

129 
	`pic_£t_úq_√w
(
s
->
öt˘l
, s->
e•úq
, 1);

130 
	}
}

132 
	$e•dma_˛ór_úq
(*
›aque
)

134 
DMASèã
 *
s
 = 
›aque
;

136 
s
->
dm¨egs
[0] &~
DMA_INTR
;

137 
	`pic_£t_úq_√w
(
s
->
öt˘l
, s->
e•úq
, 0);

138 
	}
}

140 
	$e•dma_mem‹y_ªad
(*
›aque
, 
uöt8_t
 *
buf
, 
Àn
)

142 
DMASèã
 *
s
 = 
›aque
;

144 
	`DPRINTF
("DMAÑead, direction: %c,áddr 0x%8.8x\n",

145 
s
->
dm¨egs
[0] & 
DMA_WRITE_MEM
 ? 'w': 'r', s->dmaregs[1]);

146 
	`•¨c_iommu_mem‹y_ªad
(
s
->
iommu
, s->
dm¨egs
[1], 
buf
, 
Àn
);

147 
s
->
dm¨egs
[0] |
DMA_INTR
;

148 
s
->
dm¨egs
[1] +
Àn
;

149 
	}
}

151 
	$e•dma_mem‹y_wrôe
(*
›aque
, 
uöt8_t
 *
buf
, 
Àn
)

153 
DMASèã
 *
s
 = 
›aque
;

155 
	`DPRINTF
("DMA write, direction: %c,áddr 0x%8.8x\n",

156 
s
->
dm¨egs
[0] & 
DMA_WRITE_MEM
 ? 'w': 'r', s->dmaregs[1]);

157 
	`•¨c_iommu_mem‹y_wrôe
(
s
->
iommu
, s->
dm¨egs
[1], 
buf
, 
Àn
);

158 
s
->
dm¨egs
[0] |
DMA_INTR
;

159 
s
->
dm¨egs
[1] +
Àn
;

160 
	}
}

162 
uöt32_t
 
	$dma_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

164 
DMASèã
 *
s
 = 
›aque
;

165 
uöt32_t
 
ßddr
;

167 
ßddr
 = (
addr
 & 
DMA_MAXADDR
) >> 2;

168 
	`DPRINTF
("ªad dm¨eg[%d]: 0x%8.8x\n", 
ßddr
, 
s
->
dm¨egs
[saddr]);

170  
s
->
dm¨egs
[
ßddr
];

171 
	}
}

173 
	$dma_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

175 
DMASèã
 *
s
 = 
›aque
;

176 
uöt32_t
 
ßddr
;

178 
ßddr
 = (
addr
 & 
DMA_MAXADDR
) >> 2;

179 
	`DPRINTF
("wrôêdm¨eg[%d]: 0x%8.8x -> 0x%8.8x\n", 
ßddr
, 
s
->
dm¨egs
[ßddr], 
vÆ
);

180 
ßddr
) {

182 i‡(!(
vÆ
 & 
DMA_INTREN
))

183 
	`pic_£t_úq_√w
(
s
->
öt˘l
, s->
e•úq
, 0);

184 i‡(
vÆ
 & 
DMA_RESET
) {

185 
	`e•_ª£t
(
s
->
e•_›aque
);

186 } i‡(
vÆ
 & 0x40) {

187 
vÆ
 &= ~0x40;

188 } i‡(
vÆ
 == 0)

189 
vÆ
 = 0x40;

190 
vÆ
 &= 0x0fffffff;

191 
vÆ
 |
DMA_VER
;

194 
s
->
dm¨egs
[0] |
DMA_LOADED
;

197 i‡(!(
vÆ
 & 
DMA_INTREN
))

198 
	`pic_£t_úq_√w
(
s
->
öt˘l
, s->
Àúq
, 0);

199 i‡(
vÆ
 & 
DMA_RESET
)

200 
	`p˙ë_h_ª£t
(
s
->
œn˚_›aque
);

201 
vÆ
 &= 0x0fffffff;

202 
vÆ
 |
DMA_VER
;

207 
s
->
dm¨egs
[
ßddr
] = 
vÆ
;

208 
	}
}

210 
CPURódMem‹yFunc
 *
	gdma_mem_ªad
[3] = {

211 
dma_mem_ªadl
,

212 
dma_mem_ªadl
,

213 
dma_mem_ªadl
,

216 
CPUWrôeMem‹yFunc
 *
	gdma_mem_wrôe
[3] = {

217 
dma_mem_wrôñ
,

218 
dma_mem_wrôñ
,

219 
dma_mem_wrôñ
,

222 
	$dma_ª£t
(*
›aque
)

224 
DMASèã
 *
s
 = 
›aque
;

226 
	`mem£t
(
s
->
dm¨egs
, 0, 
DMA_REGS
 * 4);

227 
s
->
dm¨egs
[0] = 
DMA_VER
;

228 
s
->
dm¨egs
[4] = 
DMA_VER
;

229 
	}
}

231 
	$dma_ßve
(
QEMUFûe
 *
f
, *
›aque
)

233 
DMASèã
 *
s
 = 
›aque
;

234 
i
;

236 
i
 = 0; i < 
DMA_REGS
; i++)

237 
	`qemu_put_be32s
(
f
, &
s
->
dm¨egs
[
i
]);

238 
	}
}

240 
	$dma_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

242 
DMASèã
 *
s
 = 
›aque
;

243 
i
;

245 i‡(
vîsi⁄_id
 != 1)

246  -
EINVAL
;

247 
i
 = 0; i < 
DMA_REGS
; i++)

248 
	`qemu_gë_be32s
(
f
, &
s
->
dm¨egs
[
i
]);

251 
	}
}

253 *
	$•¨c32_dma_öô
(
uöt32_t
 
daddr
, 
e•úq
, 
Àúq
, *
iommu
, *
öt˘l
)

255 
DMASèã
 *
s
;

256 
dma_io_mem‹y
;

258 
s
 = 
	`qemu_mÆlocz
((
DMASèã
));

259 i‡(!
s
)

260  
NULL
;

262 
s
->
e•úq
 =Éspirq;

263 
s
->
Àúq
 =Üeirq;

264 
s
->
iommu
 = iommu;

265 
s
->
öt˘l
 = intctl;

267 
dma_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
dma_mem_ªad
, 
dma_mem_wrôe
, 
s
);

268 
	`˝u_ªgi°î_physiˇl_mem‹y
(
daddr
, 16 * 2, 
dma_io_mem‹y
);

270 
	`ªgi°î_ßvevm
("•¨c32_dma", 
daddr
, 1, 
dma_ßve
, 
dma_lﬂd
, 
s
);

271 
	`qemu_ªgi°î_ª£t
(
dma_ª£t
, 
s
);

273  
s
;

274 
	}
}

276 
	$•¨c32_dma_£t_ª£t_d©a
(*
›aque
, *
e•_›aque
,

277 *
œn˚_›aque
)

279 
DMASèã
 *
s
 = 
›aque
;

281 
s
->
e•_›aque
 =Ésp_opaque;

282 
s
->
œn˚_›aque
 =Üance_opaque;

283 
	}
}

	@sun4m.c

24 
	~"vl.h
"

26 
	#KERNEL_LOAD_ADDR
 0x00004000

	)

27 
	#CMDLINE_ADDR
 0x007ff000

	)

28 
	#INITRD_LOAD_ADDR
 0x00800000

	)

29 
	#PROM_SIZE_MAX
 (256 * 1024)

	)

30 
	#PROM_ADDR
 0xffd00000

	)

31 
	#PROM_FILENAME
 "›íbios-•¨c32"

	)

32 
	#PHYS_JJ_EEPROM
 0x71200000

	)

33 
	#PHYS_JJ_IDPROM_OFF
 0x1FD8

	)

34 
	#PHYS_JJ_EEPROM_SIZE
 0x2000

	)

37 
	#PHYS_JJ_IOMMU
 0x10000000

	)

38 
	#PHYS_JJ_TCX_FB
 0x50000000

	)

39 
	#PHYS_JJ_SLAVIO
 0x70000000

	)

40 
	#PHYS_JJ_DMA
 0x78400000

	)

41 
	#PHYS_JJ_ESP
 0x78800000

	)

42 
	#PHYS_JJ_ESP_IRQ
 18

	)

43 
	#PHYS_JJ_LE
 0x78C00000

	)

44 
	#PHYS_JJ_LE_IRQ
 16

	)

45 
	#PHYS_JJ_CLOCK
 0x71D00000

	)

46 
	#PHYS_JJ_CLOCK_IRQ
 7

	)

47 
	#PHYS_JJ_CLOCK1
 0x71D10000

	)

48 
	#PHYS_JJ_CLOCK1_IRQ
 19

	)

49 
	#PHYS_JJ_INTR0
 0x71E00000

	)

50 
	#PHYS_JJ_INTR_G
 0x71E10000

	)

51 
	#PHYS_JJ_MS_KBD
 0x71000000

	)

52 
	#PHYS_JJ_MS_KBD_IRQ
 14

	)

53 
	#PHYS_JJ_SER
 0x71100000

	)

54 
	#PHYS_JJ_SER_IRQ
 15

	)

55 
	#PHYS_JJ_FDC
 0x71400000

	)

56 
	#PHYS_JJ_FLOPPY_IRQ
 22

	)

57 
	#PHYS_JJ_ME_IRQ
 30

	)

58 
	#PHYS_JJ_CS
 0x6c000000

	)

59 
	#PHYS_JJ_CS_IRQ
 5

	)

61 
	#MAX_CPUS
 16

	)

65 
uöt64_t
 
	$˝u_gë_tsc
()

67  
	`qemu_gë_˛ock
(
vm_˛ock
);

68 
	}
}

70 
	$DMA_gë_ch™√l_mode
 (
nch™
)

73 
	}
}

74 
	$DMA_ªad_mem‹y
 (
nch™
, *
buf
, 
pos
, 
size
)

77 
	}
}

78 
	$DMA_wrôe_mem‹y
 (
nch™
, *
buf
, 
pos
, 
size
)

81 
	}
}

82 
	$DMA_hﬁd_DREQ
 (
nch™
Ë{
	}
}

83 
	$DMA_ªÀa£_DREQ
 (
nch™
Ë{
	}
}

84 
	$DMA_scheduÀ
(
nch™
Ë{
	}
}

85 
	$DMA_run
 (Ë{
	}
}

86 
	$DMA_öô
 (
high_∑ge_íabÀ
Ë{
	}
}

87 
	$DMA_ªgi°î_ch™√l
 (
nch™
,

88 
DMA_å™s„r_h™dÀr
 
å™s„r_h™dÀr
,

89 *
›aque
)

91 
	}
}

93 
	$nvøm_£t_w‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
, 
uöt16_t
 
vÆue
)

95 
	`m48t59_wrôe
(
nvøm
, 
addr
++, (
vÆue
 >> 8) & 0xff);

96 
	`m48t59_wrôe
(
nvøm
, 
addr
++, 
vÆue
 & 0xff);

97 
	}
}

99 
	$nvøm_£t_lw‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
, uöt32_à
vÆue
)

101 
	`m48t59_wrôe
(
nvøm
, 
addr
++, 
vÆue
 >> 24);

102 
	`m48t59_wrôe
(
nvøm
, 
addr
++, (
vÆue
 >> 16) & 0xff);

103 
	`m48t59_wrôe
(
nvøm
, 
addr
++, (
vÆue
 >> 8) & 0xff);

104 
	`m48t59_wrôe
(
nvøm
, 
addr
++, 
vÆue
 & 0xff);

105 
	}
}

107 
	$nvøm_£t_°rög
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
,

108 c⁄° *
°r
, 
uöt32_t
 
max
)

110 
i
;

112 
i
 = 0; i < 
max
 && 
°r
[i] != '\0'; i++) {

113 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 
i
, 
°r
[i]);

115 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 
max
 - 1, '\0');

116 
	}
}

118 
m48t59_t
 *
	gnvøm
;

120 
nogøphic
;

122 
	$nvøm_öô
(
m48t59_t
 *
nvøm
, 
uöt8_t
 *
maˇddr
, c⁄° *
cmdlöe
,

123 
boŸ_devi˚
, 
uöt32_t
 
RAM_size
,

124 
uöt32_t
 
kî√l_size
,

125 
width
, 
height
, 
dïth
)

127 
tmp
 = 0;

128 
i
, 
j
;

131 
	`nvøm_£t_°rög
(
nvøm
, 0x00, "QEMU_BIOS", 16);

132 
	`nvøm_£t_lw‹d
(
nvøm
, 0x10, 0x00000001);

134 
	`m48t59_wrôe
(
nvøm
, 0x2D, 
smp_˝us
 & 0xff);

135 
	`m48t59_wrôe
(
nvøm
, 0x2E, 0);

136 
	`m48t59_wrôe
(
nvøm
, 0x2F, 
nogøphic
 & 0xff);

137 
	`nvøm_£t_lw‹d
(
nvøm
, 0x30, 
RAM_size
);

138 
	`m48t59_wrôe
(
nvøm
, 0x34, 
boŸ_devi˚
 & 0xff);

139 
	`nvøm_£t_lw‹d
(
nvøm
, 0x38, 
KERNEL_LOAD_ADDR
);

140 
	`nvøm_£t_lw‹d
(
nvøm
, 0x3C, 
kî√l_size
);

141 i‡(
cmdlöe
) {

142 
	`°r˝y
(
phys_øm_ba£
 + 
CMDLINE_ADDR
, 
cmdlöe
);

143 
	`nvøm_£t_lw‹d
(
nvøm
, 0x40, 
CMDLINE_ADDR
);

144 
	`nvøm_£t_lw‹d
(
nvøm
, 0x44, 
	`°æí
(
cmdlöe
));

147 
	`nvøm_£t_w‹d
(
nvøm
, 0x54, 
width
);

148 
	`nvøm_£t_w‹d
(
nvøm
, 0x56, 
height
);

149 
	`nvøm_£t_w‹d
(
nvøm
, 0x58, 
dïth
);

152 
i
 = 0x1fd8;

153 
	`m48t59_wrôe
(
nvøm
, 
i
++, 0x01);

154 
	`m48t59_wrôe
(
nvøm
, 
i
++, 0x80);

155 
j
 = 0;

156 
	`m48t59_wrôe
(
nvøm
, 
i
++, 
maˇddr
[
j
++]);

157 
	`m48t59_wrôe
(
nvøm
, 
i
++, 
maˇddr
[
j
++]);

158 
	`m48t59_wrôe
(
nvøm
, 
i
++, 
maˇddr
[
j
++]);

159 
	`m48t59_wrôe
(
nvøm
, 
i
++, 
maˇddr
[
j
++]);

160 
	`m48t59_wrôe
(
nvøm
, 
i
++, 
maˇddr
[
j
++]);

161 
	`m48t59_wrôe
(
nvøm
, 
i
, 
maˇddr
[
j
]);

164 
i
 = 0x1fd8; i < 0x1fe7; i++) {

165 
tmp
 ^
	`m48t59_ªad
(
nvøm
, 
i
);

167 
	`m48t59_wrôe
(
nvøm
, 0x1„7, 
tmp
);

168 
	}
}

170 *
	g¶avio_öt˘l
;

172 
	$pic_öfo
()

174 
	`¶avio_pic_öfo
(
¶avio_öt˘l
);

175 
	}
}

177 
	$úq_öfo
()

179 
	`¶avio_úq_öfo
(
¶avio_öt˘l
);

180 
	}
}

182 
	$pic_£t_úq
(
úq
, 
Àvñ
)

184 
	`¶avio_pic_£t_úq
(
¶avio_öt˘l
, 
úq
, 
Àvñ
);

185 
	}
}

187 
	$pic_£t_úq_√w
(*
›aque
, 
úq
, 
Àvñ
)

189 
	`pic_£t_úq
(
úq
, 
Àvñ
);

190 
	}
}

192 
	$pic_£t_úq_˝u
(
úq
, 
Àvñ
, 
˝u
)

194 
	`¶avio_pic_£t_úq_˝u
(
¶avio_öt˘l
, 
úq
, 
Àvñ
, 
˝u
);

195 
	}
}

197 *
	g¶avio_misc
;

199 
	$qemu_sy°em_powîdown
()

201 
	`¶avio_£t_powî_Áû
(
¶avio_misc
, 1);

202 
	}
}

204 
	$maö_˝u_ª£t
(*
›aque
)

206 
CPUSèã
 *
ív
 = 
›aque
;

207 
	`˝u_ª£t
(
ív
);

208 
	}
}

211 
	$sun4m_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

212 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

213 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

214 c⁄° *
öôrd_fûíame
)

216 
CPUSèã
 *
ív
, *
ívs
[
MAX_CPUS
];

217 
buf
[1024];

218 
ªt
, 
löux_boŸ
;

219 
i
;

220 
vøm_size
 = 0x100000, 
¥om_off£t
, 
öôrd_size
, 
kî√l_size
;

221 *
iommu
, *
dma
, *
maö_e•
, *
maö_œn˚
 = 
NULL
;

223 
löux_boŸ
 = (
kî√l_fûíame
 !
NULL
);

226 
i
 = 0; i < 
smp_˝us
; i++) {

227 
ív
 = 
	`˝u_öô
();

228 
ívs
[
i
] = 
ív
;

229 i‡(
i
 != 0)

230 
ív
->
hÆãd
 = 1;

231 
	`ªgi°î_ßvevm
("˝u", 
i
, 3, 
˝u_ßve
, 
˝u_lﬂd
, 
ív
);

232 
	`qemu_ªgi°î_ª£t
(
maö_˝u_ª£t
, 
ív
);

235 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 0);

237 
iommu
 = 
	`iommu_öô
(
PHYS_JJ_IOMMU
);

238 
¶avio_öt˘l
 = 
	`¶avio_öt˘l_öô
(
PHYS_JJ_INTR0
, 
PHYS_JJ_INTR_G
);

239 
i
 = 0; i < 
smp_˝us
; i++) {

240 
	`¶avio_öt˘l_£t_˝u
(
¶avio_öt˘l
, 
i
, 
ívs
[i]);

242 
dma
 = 
	`•¨c32_dma_öô
(
PHYS_JJ_DMA
, 
PHYS_JJ_ESP_IRQ
, 
PHYS_JJ_LE_IRQ
, 
iommu
, 
¶avio_öt˘l
);

244 
	`tcx_öô
(
ds
, 
PHYS_JJ_TCX_FB
, 
phys_øm_ba£
 + 
øm_size
,Ñam_size, 
vøm_size
, 
gøphic_width
, 
gøphic_height
);

245 i‡(
nd_èbÀ
[0].
vœn
) {

246 i‡(
nd_èbÀ
[0].
modñ
 =
NULL


247 || 
	`°rcmp
(
nd_èbÀ
[0].
modñ
, "lance") == 0) {

248 
maö_œn˚
 = 
	`œn˚_öô
(&
nd_èbÀ
[0], 
PHYS_JJ_LE
, 
dma
);

250 
	`Ârötf
(
°dîr
, "qemu: Unsuµ‹ãd NIC: %s\n", 
nd_èbÀ
[0].
modñ
);

251 
	`exô
 (1);

254 
nvøm
 = 
	`m48t59_öô
(0, 
PHYS_JJ_EEPROM
, 0, 
PHYS_JJ_EEPROM_SIZE
, 8);

255 
i
 = 0; i < 
MAX_CPUS
; i++) {

256 
	`¶avio_timî_öô
(
PHYS_JJ_CLOCK
 + 
i
 * 
TARGET_PAGE_SIZE
, 
PHYS_JJ_CLOCK_IRQ
, 0, i);

258 
	`¶avio_timî_öô
(
PHYS_JJ_CLOCK1
, 
PHYS_JJ_CLOCK1_IRQ
, 2, ()-1);

259 
	`¶avio_£rül_ms_kbd_öô
(
PHYS_JJ_MS_KBD
, 
PHYS_JJ_MS_KBD_IRQ
);

262 
	`¶avio_£rül_öô
(
PHYS_JJ_SER
, 
PHYS_JJ_SER_IRQ
, 
£rül_hds
[1], serial_hds[0]);

263 
	`fd˘æ_öô
(
PHYS_JJ_FLOPPY_IRQ
, 0, 1, 
PHYS_JJ_FDC
, 
fd_èbÀ
);

264 
maö_e•
 = 
	`e•_öô
(
bs_èbÀ
, 
PHYS_JJ_ESP
, 
dma
);

266 
i
 = 0; i < 
MAX_DISKS
; i++) {

267 i‡(
bs_èbÀ
[
i
]) {

268 
	`e•_scsi_©èch
(
maö_e•
, 
bs_èbÀ
[
i
], i);

272 
¶avio_misc
 = 
	`¶avio_misc_öô
(
PHYS_JJ_SLAVIO
, 
PHYS_JJ_ME_IRQ
);

273 
	`cs_öô
(
PHYS_JJ_CS
, 
PHYS_JJ_CS_IRQ
, 
¶avio_öt˘l
);

274 
	`•¨c32_dma_£t_ª£t_d©a
(
dma
, 
maö_e•
, 
maö_œn˚
);

276 
¥om_off£t
 = 
øm_size
 + 
vøm_size
;

277 
	`˝u_ªgi°î_physiˇl_mem‹y
(
PROM_ADDR
,

278 (
PROM_SIZE_MAX
 + 
TARGET_PAGE_SIZE
 - 1Ë& 
TARGET_PAGE_MASK
,

279 
¥om_off£t
 | 
IO_MEM_ROM
);

281 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
PROM_FILENAME
);

282 
ªt
 = 
	`lﬂd_ñf
(
buf
, 0, 
NULL
);

283 i‡(
ªt
 < 0) {

284 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoadÖrom '%s'\n",

285 
buf
);

286 
	`exô
(1);

289 
kî√l_size
 = 0;

290 i‡(
löux_boŸ
) {

291 
kî√l_size
 = 
	`lﬂd_ñf
(
kî√l_fûíame
, -0xf0000000, 
NULL
);

292 i‡(
kî√l_size
 < 0)

293 
kî√l_size
 = 
	`lﬂd_aout
(
kî√l_fûíame
, 
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
);

294 i‡(
kî√l_size
 < 0)

295 
kî√l_size
 = 
	`lﬂd_image
(
kî√l_fûíame
, 
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
);

296 i‡(
kî√l_size
 < 0) {

297 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad kernel '%s'\n",

298 
kî√l_fûíame
);

299 
	`exô
(1);

303 
öôrd_size
 = 0;

304 i‡(
öôrd_fûíame
) {

305 
öôrd_size
 = 
	`lﬂd_image
(
öôrd_fûíame
, 
phys_øm_ba£
 + 
INITRD_LOAD_ADDR
);

306 i‡(
öôrd_size
 < 0) {

307 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad initialÑam disk '%s'\n",

308 
öôrd_fûíame
);

309 
	`exô
(1);

312 i‡(
öôrd_size
 > 0) {

313 
i
 = 0; i < 64 * 
TARGET_PAGE_SIZE
; i += TARGET_PAGE_SIZE) {

314 i‡(
	`ldl_øw
(
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
 + 
i
)

316 
	`°l_øw
(
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
 + 
i
 + 16, 
INITRD_LOAD_ADDR
);

317 
	`°l_øw
(
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
 + 
i
 + 20, 
öôrd_size
);

323 
	`nvøm_öô
(
nvøm
, (
uöt8_t
 *)&
nd_èbÀ
[0].
maˇddr
, 
kî√l_cmdlöe
, 
boŸ_devi˚
, 
øm_size
, 
kî√l_size
, 
gøphic_width
, 
gøphic_height
, 
gøphic_dïth
);

324 
	}
}

326 
QEMUMachöe
 
	gsun4m_machöe
 = {

329 
sun4m_öô
,

	@sun4u.c

24 
	~"vl.h
"

25 
	~"m48t59.h
"

27 
	#KERNEL_LOAD_ADDR
 0x00404000

	)

28 
	#CMDLINE_ADDR
 0x003ff000

	)

29 
	#INITRD_LOAD_ADDR
 0x00300000

	)

30 
	#PROM_SIZE_MAX
 (512 * 1024)

	)

31 
	#PROM_ADDR
 0x1fff0000000ULL

	)

32 
	#APB_SPECIAL_BASE
 0x1„00000000ULL

	)

33 
	#APB_MEM_BASE
 0x1ff00000000ULL

	)

34 
	#VGA_BASE
 (
APB_MEM_BASE
 + 0x400000ULL)

	)

35 
	#PROM_FILENAME
 "›íbios-•¨c64"

	)

36 
	#NVRAM_SIZE
 0x2000

	)

40 
uöt64_t
 
	$˝u_gë_tsc
()

42  
	`qemu_gë_˛ock
(
vm_˛ock
);

43 
	}
}

45 
	$DMA_gë_ch™√l_mode
 (
nch™
)

48 
	}
}

49 
	$DMA_ªad_mem‹y
 (
nch™
, *
buf
, 
pos
, 
size
)

52 
	}
}

53 
	$DMA_wrôe_mem‹y
 (
nch™
, *
buf
, 
pos
, 
size
)

56 
	}
}

57 
	$DMA_hﬁd_DREQ
 (
nch™
Ë{
	}
}

58 
	$DMA_ªÀa£_DREQ
 (
nch™
Ë{
	}
}

59 
	$DMA_scheduÀ
(
nch™
Ë{
	}
}

60 
	$DMA_run
 (Ë{
	}
}

61 
	$DMA_öô
 (
high_∑ge_íabÀ
Ë{
	}
}

62 
	$DMA_ªgi°î_ch™√l
 (
nch™
,

63 
DMA_å™s„r_h™dÀr
 
å™s„r_h™dÀr
,

64 *
›aque
)

66 
	}
}

69 
	$NVRAM_£t_byã
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
, 
uöt8_t
 
vÆue
)

71 
	`m48t59_wrôe
(
nvøm
, 
addr
, 
vÆue
);

72 
	}
}

74 
uöt8_t
 
	$NVRAM_gë_byã
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
)

76  
	`m48t59_ªad
(
nvøm
, 
addr
);

77 
	}
}

79 
	$NVRAM_£t_w‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
, 
uöt16_t
 
vÆue
)

81 
	`m48t59_wrôe
(
nvøm
, 
addr
, 
vÆue
 >> 8);

82 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 1, 
vÆue
 & 0xFF);

83 
	}
}

85 
uöt16_t
 
	$NVRAM_gë_w‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
)

87 
uöt16_t
 
tmp
;

89 
tmp
 = 
	`m48t59_ªad
(
nvøm
, 
addr
) << 8;

90 
tmp
 |
	`m48t59_ªad
(
nvøm
, 
addr
 + 1);

92  
tmp
;

93 
	}
}

95 
	$NVRAM_£t_lw‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
, uöt32_à
vÆue
)

97 
	`m48t59_wrôe
(
nvøm
, 
addr
, 
vÆue
 >> 24);

98 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 1, (
vÆue
 >> 16) & 0xFF);

99 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 2, (
vÆue
 >> 8) & 0xFF);

100 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 3, 
vÆue
 & 0xFF);

101 
	}
}

103 
uöt32_t
 
	$NVRAM_gë_lw‹d
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
)

105 
uöt32_t
 
tmp
;

107 
tmp
 = 
	`m48t59_ªad
(
nvøm
, 
addr
) << 24;

108 
tmp
 |
	`m48t59_ªad
(
nvøm
, 
addr
 + 1) << 16;

109 
tmp
 |
	`m48t59_ªad
(
nvøm
, 
addr
 + 2) << 8;

110 
tmp
 |
	`m48t59_ªad
(
nvøm
, 
addr
 + 3);

112  
tmp
;

113 
	}
}

115 
	$NVRAM_£t_°rög
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
addr
,

116 c⁄° *
°r
, 
uöt32_t
 
max
)

118 
i
;

120 
i
 = 0; i < 
max
 && 
°r
[i] != '\0'; i++) {

121 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 
i
, 
°r
[i]);

123 
	`m48t59_wrôe
(
nvøm
, 
addr
 + 
max
 - 1, '\0');

124 
	}
}

126 
	$NVRAM_gë_°rög
 (
m48t59_t
 *
nvøm
, 
uöt8_t
 *
d°
, 
uöt16_t
 
addr
, 
max
)

128 
i
;

130 
	`mem£t
(
d°
, 0, 
max
);

131 
i
 = 0; i < 
max
; i++) {

132 
d°
[
i
] = 
	`NVRAM_gë_byã
(
nvøm
, 
addr
 + i);

133 i‡(
d°
[
i
] == '\0')

137  
i
;

138 
	}
}

140 
uöt16_t
 
	$NVRAM_¸c_upd©e
 (
uöt16_t
 
¥ev
, uöt16_à
vÆue
)

142 
uöt16_t
 
tmp
;

143 
uöt16_t
 
pd
, 
pd1
, 
pd2
;

145 
tmp
 = 
¥ev
 >> 8;

146 
pd
 = 
¥ev
 ^ 
vÆue
;

147 
pd1
 = 
pd
 & 0x000F;

148 
pd2
 = ((
pd
 >> 4Ë& 0x000FË^ 
pd1
;

149 
tmp
 ^(
pd1
 << 3) | (pd1 << 8);

150 
tmp
 ^
pd2
 | (pd2 << 7) | (pd2 << 12);

152  
tmp
;

153 
	}
}

155 
uöt16_t
 
	$NVRAM_compuã_¸c
 (
m48t59_t
 *
nvøm
, 
uöt32_t
 
°¨t
, uöt32_à
cou¡
)

157 
uöt32_t
 
i
;

158 
uöt16_t
 
¸c
 = 0xFFFF;

159 
odd
;

161 
odd
 = 
cou¡
 & 1;

162 
cou¡
 &= ~1;

163 
i
 = 0; i !
cou¡
; i++) {

164 
¸c
 = 
	`NVRAM_¸c_upd©e
(¸c, 
	`NVRAM_gë_w‹d
(
nvøm
, 
°¨t
 + 
i
));

166 i‡(
odd
) {

167 
¸c
 = 
	`NVRAM_¸c_upd©e
(¸c, 
	`NVRAM_gë_byã
(
nvøm
, 
°¨t
 + 
i
) << 8);

170  
¸c
;

171 
	}
}

173 
nogøphic
;

175 
	$sun4u_NVRAM_£t_∑øms
 (
m48t59_t
 *
nvøm
, 
uöt16_t
 
NVRAM_size
,

176 c⁄° *
¨ch
,

177 
uöt32_t
 
RAM_size
, 
boŸ_devi˚
,

178 
uöt32_t
 
kî√l_image
, uöt32_à
kî√l_size
,

179 c⁄° *
cmdlöe
,

180 
uöt32_t
 
öôrd_image
, uöt32_à
öôrd_size
,

181 
uöt32_t
 
NVRAM_image
,

182 
width
, 
height
, 
dïth
)

184 
uöt16_t
 
¸c
;

187 
	`NVRAM_£t_°rög
(
nvøm
, 0x00, "QEMU_BIOS", 16);

188 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x10, 0x00000002);

189 
	`NVRAM_£t_w‹d
(
nvøm
, 0x14, 
NVRAM_size
);

190 
	`NVRAM_£t_°rög
(
nvøm
, 0x20, 
¨ch
, 16);

191 
	`NVRAM_£t_byã
(
nvøm
, 0x2f, 
nogøphic
 & 0xff);

192 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x30, 
RAM_size
);

193 
	`NVRAM_£t_byã
(
nvøm
, 0x34, 
boŸ_devi˚
);

194 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x38, 
kî√l_image
);

195 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x3C, 
kî√l_size
);

196 i‡(
cmdlöe
) {

198 
	`°r˝y
(
phys_øm_ba£
 + 
CMDLINE_ADDR
, 
cmdlöe
);

199 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x40, 
CMDLINE_ADDR
);

200 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x44, 
	`°æí
(
cmdlöe
));

202 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x40, 0);

203 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x44, 0);

205 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x48, 
öôrd_image
);

206 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x4C, 
öôrd_size
);

207 
	`NVRAM_£t_lw‹d
(
nvøm
, 0x50, 
NVRAM_image
);

209 
	`NVRAM_£t_w‹d
(
nvøm
, 0x54, 
width
);

210 
	`NVRAM_£t_w‹d
(
nvøm
, 0x56, 
height
);

211 
	`NVRAM_£t_w‹d
(
nvøm
, 0x58, 
dïth
);

212 
¸c
 = 
	`NVRAM_compuã_¸c
(
nvøm
, 0x00, 0xF8);

213 
	`NVRAM_£t_w‹d
(
nvøm
, 0xFC, 
¸c
);

216 
	}
}

218 
	$pic_öfo
()

220 
	}
}

222 
	$úq_öfo
()

224 
	}
}

226 
	$pic_£t_úq
(
úq
, 
Àvñ
)

228 
	}
}

230 
	$pic_£t_úq_√w
(*
›aque
, 
úq
, 
Àvñ
)

232 
	}
}

234 
	$qemu_sy°em_powîdown
()

236 
	}
}

238 
	$maö_˝u_ª£t
(*
›aque
)

240 
CPUSèã
 *
ív
 = 
›aque
;

241 
	`˝u_ª£t
(
ív
);

242 
	}
}

244 c⁄° 
	gide_ioba£
[2] = { 0x1f0, 0x170 };

245 c⁄° 
	gide_ioba£2
[2] = { 0x3f6, 0x376 };

246 c⁄° 
	gide_úq
[2] = { 14, 15 };

248 c⁄° 
	g£rül_io
[
MAX_SERIAL_PORTS
] = { 0x3f8, 0x2f8, 0x3e8, 0x2e8 };

249 c⁄° 
	g£rül_úq
[
MAX_SERIAL_PORTS
] = { 4, 3, 4, 3 };

251 c⁄° 
	g∑øŒñ_io
[
MAX_PARALLEL_PORTS
] = { 0x378, 0x278, 0x3bc };

252 c⁄° 
	g∑øŒñ_úq
[
MAX_PARALLEL_PORTS
] = { 7, 7, 7 };

254 
fd˘æ_t
 *
	gÊ›py_c⁄åﬁÀr
;

257 
	$sun4u_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

258 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

259 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

260 c⁄° *
öôrd_fûíame
)

262 
CPUSèã
 *
ív
;

263 
buf
[1024];

264 
m48t59_t
 *
nvøm
;

265 
ªt
, 
löux_boŸ
;

266 
i
;

267 
¥om_off£t
, 
öôrd_size
, 
kî√l_size
;

268 
PCIBus
 *
pci_bus
;

270 
löux_boŸ
 = (
kî√l_fûíame
 !
NULL
);

272 
ív
 = 
	`˝u_öô
();

273 
	`ªgi°î_ßvevm
("˝u", 0, 3, 
˝u_ßve
, 
˝u_lﬂd
, 
ív
);

274 
	`qemu_ªgi°î_ª£t
(
maö_˝u_ª£t
, 
ív
);

277 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 0);

279 
¥om_off£t
 = 
øm_size
 + 
vga_øm_size
;

280 
	`˝u_ªgi°î_physiˇl_mem‹y
(
PROM_ADDR
,

281 (
PROM_SIZE_MAX
 + 
TARGET_PAGE_SIZE
Ë& 
TARGET_PAGE_MASK
,

282 
¥om_off£t
 | 
IO_MEM_ROM
);

284 
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
bios_dú
, 
PROM_FILENAME
);

285 
ªt
 = 
	`lﬂd_ñf
(
buf
, 0, 
NULL
);

286 i‡(
ªt
 < 0) {

287 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoadÖrom '%s'\n",

288 
buf
);

289 
	`exô
(1);

292 
kî√l_size
 = 0;

293 
öôrd_size
 = 0;

294 i‡(
löux_boŸ
) {

296 
kî√l_size
 = 
	`lﬂd_ñf
(
kî√l_fûíame
, 0, 
NULL
);

297 i‡(
kî√l_size
 < 0)

298 
kî√l_size
 = 
	`lﬂd_aout
(
kî√l_fûíame
, 
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
);

299 i‡(
kî√l_size
 < 0)

300 
kî√l_size
 = 
	`lﬂd_image
(
kî√l_fûíame
, 
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
);

301 i‡(
kî√l_size
 < 0) {

302 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad kernel '%s'\n",

303 
kî√l_fûíame
);

304 
	`exô
(1);

308 i‡(
öôrd_fûíame
) {

309 
öôrd_size
 = 
	`lﬂd_image
(
öôrd_fûíame
, 
phys_øm_ba£
 + 
INITRD_LOAD_ADDR
);

310 i‡(
öôrd_size
 < 0) {

311 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad initialÑam disk '%s'\n",

312 
öôrd_fûíame
);

313 
	`exô
(1);

316 i‡(
öôrd_size
 > 0) {

317 
i
 = 0; i < 64 * 
TARGET_PAGE_SIZE
; i += TARGET_PAGE_SIZE) {

318 i‡(
	`ldl_øw
(
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
 + 
i
)

320 
	`°l_øw
(
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
 + 
i
 + 16, 
INITRD_LOAD_ADDR
);

321 
	`°l_øw
(
phys_øm_ba£
 + 
KERNEL_LOAD_ADDR
 + 
i
 + 20, 
öôrd_size
);

327 
pci_bus
 = 
	`pci_≠b_öô
(
APB_SPECIAL_BASE
, 
APB_MEM_BASE
, 
NULL
);

328 
iß_mem_ba£
 = 
VGA_BASE
;

329 
	`pci_cúrus_vga_öô
(
pci_bus
, 
ds
, 
phys_øm_ba£
 + 
øm_size
,Ñam_size, 
vga_øm_size
);

331 
i
 = 0; i < 
MAX_SERIAL_PORTS
; i++) {

332 i‡(
£rül_hds
[
i
]) {

333 
	`£rül_öô
(&
pic_£t_úq_√w
, 
NULL
,

334 
£rül_io
[
i
], 
£rül_úq
[i], 
£rül_hds
[i]);

338 
i
 = 0; i < 
MAX_PARALLEL_PORTS
; i++) {

339 i‡(
∑øŒñ_hds
[
i
]) {

340 
	`∑øŒñ_öô
(
∑øŒñ_io
[
i
], 
∑øŒñ_úq
[i], 
∑øŒñ_hds
[i]);

344 
i
 = 0; i < 
nb_nics
; i++) {

345 i‡(!
nd_èbÀ
[
i
].
modñ
)

346 
nd_èbÀ
[
i
].
modñ
 = "ne2k_pci";

347 
	`pci_nic_öô
(
pci_bus
, &
nd_èbÀ
[
i
], -1);

350 
	`pci_cmd646_ide_öô
(
pci_bus
, 
bs_èbÀ
, 1);

351 
	`kbd_öô
();

352 
Ê›py_c⁄åﬁÀr
 = 
	`fd˘æ_öô
(6, 2, 0, 0x3f0, 
fd_èbÀ
);

353 
nvøm
 = 
	`m48t59_öô
(8, 0, 0x0074, 
NVRAM_SIZE
, 59);

354 
	`sun4u_NVRAM_£t_∑øms
(
nvøm
, 
NVRAM_SIZE
, "Sun4u", 
øm_size
, 
boŸ_devi˚
,

355 
KERNEL_LOAD_ADDR
, 
kî√l_size
,

356 
kî√l_cmdlöe
,

357 
INITRD_LOAD_ADDR
, 
öôrd_size
,

360 
gøphic_width
, 
gøphic_height
, 
gøphic_dïth
);

362 
	}
}

364 
QEMUMachöe
 
	gsun4u_machöe
 = {

367 
sun4u_öô
,

	@tc58128.c

1 
	~<as£π.h
>

2 
	~"vl.h
"

4 
	#CE1
 0x0100

	)

5 
	#CE2
 0x0200

	)

6 
	#RE
 0x0400

	)

7 
	#WE
 0x0800

	)

8 
	#ALE
 0x1000

	)

9 
	#CLE
 0x2000

	)

10 
	#RDY1
 0x4000

	)

11 
	#RDY2
 0x8000

	)

12 
	#RDY
(
n
Ë(“Ë=0 ? 
RDY1
 : 
RDY2
)

	)

14 íum { 
	mWAIT
, 
	mREAD1
, 
	mREAD2
, 
	mREAD3
 } 
	t°©e_t
;

17 
uöt8_t
 *
	mÊash_c⁄ã¡s
;

18 
°©e_t
 
	m°©e
;

19 
uöt32_t
 
	maddªss
;

20 
uöt8_t
 
	maddªss_cy˛e
;

21 } 
	ttc58128_dev
;

23 
tc58128_dev
 
	gtc58128_devs
[2];

25 
	#FLASH_SIZE
 (16*1024*1024)

	)

27 
	$öô_dev
(
tc58128_dev
 * 
dev
, *
fûíame
)

29 
ªt
, 
blocks
;

31 
dev
->
°©e
 = 
WAIT
;

32 
dev
->
Êash_c⁄ã¡s
 = 
	`qemu_mÆlocz
(
FLASH_SIZE
);

33 
	`mem£t
(
dev
->
Êash_c⁄ã¡s
, 0xff, 
FLASH_SIZE
);

34 i‡(!
dev
->
Êash_c⁄ã¡s
) {

35 
	`Ârötf
(
°dîr
, "couldÇotálloc memory for flash\n");

36 
	`exô
(1);

38 i‡(
fûíame
) {

40 
ªt
 = 
	`lﬂd_image
(
fûíame
, 
dev
->
Êash_c⁄ã¡s
 + 528 * 32);

41 i‡(
ªt
 < 0) {

42 
	`Ârötf
(
°dîr
, "ªt=%d\n", 
ªt
);

43 
	`Ârötf
(
°dîr
, "qemu: couldÇotÜoad flash image %s\n",

44 
fûíame
);

45 
	`exô
(1);

48 
blocks
 = (
ªt
 + 528 * 32 - 1) / (528 * 32);

49 
dev
->
Êash_c⁄ã¡s
[0] = 
blocks
 & 0xff;

50 
dev
->
Êash_c⁄ã¡s
[1] = (
blocks
 >> 8) & 0xff;

51 
dev
->
Êash_c⁄ã¡s
[2] = (
blocks
 >> 16) & 0xff;

52 
dev
->
Êash_c⁄ã¡s
[3] = (
blocks
 >> 24) & 0xff;

53 
	`Ârötf
(
°dîr
, "lﬂded %d byã†f‹ %†ötÿÊash\n", 
ªt
,

54 
fûíame
);

57 
	}
}

59 
	$h™dÀ_comm™d
(
tc58128_dev
 * 
dev
, 
uöt8_t
 
comm™d
)

61 
comm™d
) {

63 
	`Ârötf
(
°dîr
, "reset flash device\n");

64 
dev
->
°©e
 = 
WAIT
;

67 
	`Ârötf
(
°dîr
, "read mode 1\n");

68 
dev
->
°©e
 = 
READ1
;

69 
dev
->
addªss_cy˛e
 = 0;

72 
	`Ârötf
(
°dîr
, "read mode 2\n");

73 
dev
->
°©e
 = 
READ2
;

74 
dev
->
addªss_cy˛e
 = 0;

77 
	`Ârötf
(
°dîr
, "read mode 3\n");

78 
dev
->
°©e
 = 
READ3
;

79 
dev
->
addªss_cy˛e
 = 0;

82 
	`Ârötf
(
°dîr
, "unknow¿Êash comm™d 0x%02x\n", 
comm™d
);

83 
	`as£π
(0);

85 
	}
}

87 
	$h™dÀ_addªss
(
tc58128_dev
 * 
dev
, 
uöt8_t
 
d©a
)

89 
dev
->
°©e
) {

90 
READ1
:

91 
READ2
:

92 
READ3
:

93 
dev
->
addªss_cy˛e
) {

95 
dev
->
addªss
 = 
d©a
;

96 i‡(
dev
->
°©e
 =
READ2
)

97 
dev
->
addªss
 |= 0x100;

98 i‡(
dev
->
°©e
 =
READ3
)

99 
dev
->
addªss
 |= 0x200;

102 
dev
->
addªss
 +
d©a
 * 528 * 0x100;

105 
dev
->
addªss
 +
d©a
 * 528;

106 
	`Ârötf
(
°dîr
, "addressÖointer in flash: 0x%08x\n",

107 
dev
->
addªss
);

111 
	`as£π
(0);

113 
dev
->
addªss_cy˛e
++;

116 
	`as£π
(0);

118 
	}
}

120 
uöt8_t
 
	$h™dÀ_ªad
(
tc58128_dev
 * 
dev
)

123 i‡(
dev
->
addªss
 % 0x100000 == 0)

124 
	`Ârötf
(
°dîr
, "ªadög fœsháàaddªs†0x%08x\n", 
dev
->
addªss
);

126  
dev
->
Êash_c⁄ã¡s
[dev->
addªss
++];

127 
	}
}

132 
	$tc58128_cb
(
uöt16_t
 
p‹è
, uöt16_à
p‹tb
,

133 
uöt16_t
 * 
≥rùh_pdåa
, uöt16_à* 
≥rùh_p‹èdú
,

134 
uöt16_t
 * 
≥rùh_pdåb
, uöt16_à* 
≥rùh_p‹tbdú
)

136 
dev
;

138 i‡((
p‹è
 & 
CE1
) == 0)

139 
dev
 = 0;

140 i‡((
p‹è
 & 
CE2
) == 0)

141 
dev
 = 1;

145 i‡((
p‹è
 & 
RE
Ë&& (p‹è & 
WE
)) {

147 *
≥rùh_p‹èdú
 &= 0xff00;

148 *
≥rùh_p‹èdú
 |
	`RDY
(
dev
);

149 *
≥rùh_pdåa
 |
	`RDY
(
dev
);

153 i‡(
p‹è
 & 
CLE
) {

155 
	`as£π
((
p‹è
 & 
WE
) == 0);

156 
	`h™dÀ_comm™d
(&
tc58128_devs
[
dev
], 
p‹è
 & 0x00ff);

157 } i‡(
p‹è
 & 
ALE
) {

158 
	`as£π
((
p‹è
 & 
WE
) == 0);

159 
	`h™dÀ_addªss
(&
tc58128_devs
[
dev
], 
p‹è
 & 0x00ff);

160 } i‡((
p‹è
 & 
RE
) == 0) {

161 *
≥rùh_p‹èdú
 |= 0x00ff;

162 *
≥rùh_pdåa
 &= 0xff00;

163 *
≥rùh_pdåa
 |
	`h™dÀ_ªad
(&
tc58128_devs
[
dev
]);

165 
	`as£π
(0);

168 
	}
}

170 
sh7750_io_devi˚
 
	gtc58128
 = {

171 
RE
 | 
WE
,

173 
tc58128_cb


176 
	$tc58128_öô
(
SH7750Sèã
 *
s
, *
z⁄e1
, *
z⁄e2
)

178 
	`öô_dev
(&
tc58128_devs
[0], 
z⁄e1
);

179 
	`öô_dev
(&
tc58128_devs
[1], 
z⁄e2
);

180  
	`sh7750_ªgi°î_io_devi˚
(
s
, &
tc58128
);

181 
	}
}

	@tcx.c

24 
	~"vl.h
"

26 
	#MAXX
 1024

	)

27 
	#MAXY
 768

	)

28 
	#TCX_DAC_NREGS
 16

	)

30 
	sTCXSèã
 {

31 
uöt32_t
 
	maddr
;

32 
Di•œySèã
 *
	mds
;

33 
uöt8_t
 *
	mvøm
;

34 
øm_addr_t
 
	mvøm_off£t
;

35 
uöt16_t
 
	mwidth
, 
	mheight
;

36 
uöt8_t
 
	mr
[256], 
	mg
[256], 
	mb
[256];

37 
uöt32_t
 
	m∑Àâe
[256];

38 
uöt8_t
 
	mdac_ödex
, 
	mdac_°©e
;

39 } 
	tTCXSèã
;

41 
tcx_s¸ìn_dump
(*
›aque
, c⁄° *
fûíame
);

44 
ölöe
 
	$rgb_to_pixñ8
(
r
, 
g
, 
b
)

46  ((
r
 >> 5Ë<< 5Ë| ((
g
 >> 5Ë<< 2Ë| (
b
 >> 6);

47 
	}
}

49 
ölöe
 
	$rgb_to_pixñ15
(
r
, 
g
, 
b
)

51  ((
r
 >> 3Ë<< 10Ë| ((
g
 >> 3Ë<< 5Ë| (
b
 >> 3);

52 
	}
}

54 
ölöe
 
	$rgb_to_pixñ16
(
r
, 
g
, 
b
)

56  ((
r
 >> 3Ë<< 11Ë| ((
g
 >> 2Ë<< 5Ë| (
b
 >> 3);

57 
	}
}

59 
ölöe
 
	$rgb_to_pixñ32
(
r
, 
g
, 
b
)

61  (
r
 << 16Ë| (
g
 << 8Ë| 
b
;

62 
	}
}

64 
	$upd©e_∑Àâe_íåõs
(
TCXSèã
 *
s
, 
°¨t
, 
íd
)

66 
i
;

67 
i
 = 
°¨t
; i < 
íd
; i++) {

68 
s
->
ds
->
dïth
) {

71 
s
->
∑Àâe
[
i
] = 
	`rgb_to_pixñ8
(s->
r
[i], s->
g
[i], s->
b
[i]);

74 
s
->
∑Àâe
[
i
] = 
	`rgb_to_pixñ15
(s->
r
[i], s->
g
[i], s->
b
[i]);

77 
s
->
∑Àâe
[
i
] = 
	`rgb_to_pixñ16
(s->
r
[i], s->
g
[i], s->
b
[i]);

80 
s
->
∑Àâe
[
i
] = 
	`rgb_to_pixñ32
(s->
r
[i], s->
g
[i], s->
b
[i]);

84 
	}
}

86 
	$tcx_døw_löe32
(
TCXSèã
 *
s1
, 
uöt8_t
 *
d
,

87 c⁄° 
uöt8_t
 *
s
, 
width
)

89 
x
;

90 
uöt8_t
 
vÆ
;

91 
uöt32_t
 *
p
 = (uöt32_à*)
d
;

93 
x
 = 0; x < 
width
; x++) {

94 
vÆ
 = *
s
++;

95 *
p
++ = 
s1
->
∑Àâe
[
vÆ
];

97 
	}
}

99 
	$tcx_døw_löe16
(
TCXSèã
 *
s1
, 
uöt8_t
 *
d
,

100 c⁄° 
uöt8_t
 *
s
, 
width
)

102 
x
;

103 
uöt8_t
 
vÆ
;

104 
uöt16_t
 *
p
 = (uöt16_à*)
d
;

106 
x
 = 0; x < 
width
; x++) {

107 
vÆ
 = *
s
++;

108 *
p
++ = 
s1
->
∑Àâe
[
vÆ
];

110 
	}
}

112 
	$tcx_døw_löe8
(
TCXSèã
 *
s1
, 
uöt8_t
 *
d
,

113 c⁄° 
uöt8_t
 *
s
, 
width
)

115 
x
;

116 
uöt8_t
 
vÆ
;

118 
x
 = 0; x < 
width
; x++) {

119 
vÆ
 = *
s
++;

120 *
d
++ = 
s1
->
∑Àâe
[
vÆ
];

122 
	}
}

126 
	$tcx_upd©e_di•œy
(*
›aque
)

128 
TCXSèã
 *
ts
 = 
›aque
;

129 
øm_addr_t
 
∑ge
, 
∑ge_mö
, 
∑ge_max
;

130 
y
, 
y_°¨t
, 
dd
, 
ds
;

131 
uöt8_t
 *
d
, *
s
;

132 (*
f
)(
TCXSèã
 *
s1
, 
uöt8_t
 *
d
, c⁄° uöt8_à*
s
, 
width
);

134 i‡(
ts
->
ds
->
dïth
 == 0)

136 
∑ge
 = 
ts
->
vøm_off£t
;

137 
y_°¨t
 = -1;

138 
∑ge_mö
 = 0xffffffff;

139 
∑ge_max
 = 0;

140 
d
 = 
ts
->
ds
->
d©a
;

141 
s
 = 
ts
->
vøm
;

142 
dd
 = 
ts
->
ds
->
löesize
;

143 
ds
 = 1024;

145 
ts
->
ds
->
dïth
) {

147 
f
 = 
tcx_døw_löe32
;

151 
f
 = 
tcx_døw_löe16
;

155 
f
 = 
tcx_døw_löe8
;

161 
y
 = 0; y < 
ts
->
height
; y +4, 
∑ge
 +
TARGET_PAGE_SIZE
) {

162 i‡(
	`˝u_physiˇl_mem‹y_gë_dúty
(
∑ge
, 
VGA_DIRTY_FLAG
)) {

163 i‡(
y_°¨t
 < 0)

164 
y_°¨t
 = 
y
;

165 i‡(
∑ge
 < 
∑ge_mö
)

166 
∑ge_mö
 = 
∑ge
;

167 i‡(
∑ge
 > 
∑ge_max
)

168 
∑ge_max
 = 
∑ge
;

169 
	`f
(
ts
, 
d
, 
s
,Ås->
width
);

170 
d
 +
dd
;

171 
s
 +
ds
;

172 
	`f
(
ts
, 
d
, 
s
,Ås->
width
);

173 
d
 +
dd
;

174 
s
 +
ds
;

175 
	`f
(
ts
, 
d
, 
s
,Ås->
width
);

176 
d
 +
dd
;

177 
s
 +
ds
;

178 
	`f
(
ts
, 
d
, 
s
,Ås->
width
);

179 
d
 +
dd
;

180 
s
 +
ds
;

182 i‡(
y_°¨t
 >= 0) {

184 
	`dpy_upd©e
(
ts
->
ds
, 0, 
y_°¨t
,

185 
ts
->
width
, 
y
 - 
y_°¨t
);

186 
y_°¨t
 = -1;

188 
d
 +
dd
 * 4;

189 
s
 +
ds
 * 4;

192 i‡(
y_°¨t
 >= 0) {

194 
	`dpy_upd©e
(
ts
->
ds
, 0, 
y_°¨t
,

195 
ts
->
width
, 
y
 - 
y_°¨t
);

198 i‡(
∑ge_mö
 <
∑ge_max
) {

199 
	`˝u_physiˇl_mem‹y_ª£t_dúty
(
∑ge_mö
, 
∑ge_max
 + 
TARGET_PAGE_SIZE
,

200 
VGA_DIRTY_FLAG
);

202 
	}
}

204 
	$tcx_övÆid©e_di•œy
(*
›aque
)

206 
TCXSèã
 *
s
 = 
›aque
;

207 
i
;

209 
i
 = 0; i < 
MAXX
*
MAXY
; i +
TARGET_PAGE_SIZE
) {

210 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
i
);

212 
	}
}

214 
	$tcx_ßve
(
QEMUFûe
 *
f
, *
›aque
)

216 
TCXSèã
 *
s
 = 
›aque
;

218 
	`qemu_put_be32s
(
f
, (
uöt32_t
 *)&
s
->
addr
);

219 
	`qemu_put_be32s
(
f
, (
uöt32_t
 *)&
s
->
vøm
);

220 
	`qemu_put_be16s
(
f
, (
uöt16_t
 *)&
s
->
height
);

221 
	`qemu_put_be16s
(
f
, (
uöt16_t
 *)&
s
->
width
);

222 
	`qemu_put_buf„r
(
f
, 
s
->
r
, 256);

223 
	`qemu_put_buf„r
(
f
, 
s
->
g
, 256);

224 
	`qemu_put_buf„r
(
f
, 
s
->
b
, 256);

225 
	`qemu_put_8s
(
f
, &
s
->
dac_ödex
);

226 
	`qemu_put_8s
(
f
, &
s
->
dac_°©e
);

227 
	}
}

229 
	$tcx_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

231 
TCXSèã
 *
s
 = 
›aque
;

233 i‡(
vîsi⁄_id
 != 1)

234  -
EINVAL
;

236 
	`qemu_gë_be32s
(
f
, (
uöt32_t
 *)&
s
->
addr
);

237 
	`qemu_gë_be32s
(
f
, (
uöt32_t
 *)&
s
->
vøm
);

238 
	`qemu_gë_be16s
(
f
, (
uöt16_t
 *)&
s
->
height
);

239 
	`qemu_gë_be16s
(
f
, (
uöt16_t
 *)&
s
->
width
);

240 
	`qemu_gë_buf„r
(
f
, 
s
->
r
, 256);

241 
	`qemu_gë_buf„r
(
f
, 
s
->
g
, 256);

242 
	`qemu_gë_buf„r
(
f
, 
s
->
b
, 256);

243 
	`qemu_gë_8s
(
f
, &
s
->
dac_ödex
);

244 
	`qemu_gë_8s
(
f
, &
s
->
dac_°©e
);

245 
	`upd©e_∑Àâe_íåõs
(
s
, 0, 256);

247 
	}
}

249 
	$tcx_ª£t
(*
›aque
)

251 
TCXSèã
 *
s
 = 
›aque
;

254 
	`mem£t
(
s
->
r
, 0, 256);

255 
	`mem£t
(
s
->
g
, 0, 256);

256 
	`mem£t
(
s
->
b
, 0, 256);

257 
s
->
r
[255] = s->
g
[255] = s->
b
[255] = 255;

258 
	`upd©e_∑Àâe_íåõs
(
s
, 0, 256);

259 
	`mem£t
(
s
->
vøm
, 0, 
MAXX
*
MAXY
);

260 
	`˝u_physiˇl_mem‹y_ª£t_dúty
(
s
->
vøm_off£t
, s->vøm_off£à+ 
MAXX
*
MAXY
,

261 
VGA_DIRTY_FLAG
);

262 
s
->
dac_ödex
 = 0;

263 
s
->
dac_°©e
 = 0;

264 
	}
}

266 
uöt32_t
 
	$tcx_dac_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

269 
	}
}

271 
	$tcx_dac_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

273 
TCXSèã
 *
s
 = 
›aque
;

274 
uöt32_t
 
ßddr
;

276 
ßddr
 = (
addr
 & (
TCX_DAC_NREGS
 - 1)) >> 2;

277 
ßddr
) {

279 
s
->
dac_ödex
 = 
vÆ
 >> 24;

280 
s
->
dac_°©e
 = 0;

283 
s
->
dac_°©e
) {

285 
s
->
r
[s->
dac_ödex
] = 
vÆ
 >> 24;

286 
	`upd©e_∑Àâe_íåõs
(
s
, s->
dac_ödex
, s->dac_index + 1);

287 
s
->
dac_°©e
++;

290 
s
->
g
[s->
dac_ödex
] = 
vÆ
 >> 24;

291 
	`upd©e_∑Àâe_íåõs
(
s
, s->
dac_ödex
, s->dac_index + 1);

292 
s
->
dac_°©e
++;

295 
s
->
b
[s->
dac_ödex
] = 
vÆ
 >> 24;

296 
	`upd©e_∑Àâe_íåõs
(
s
, s->
dac_ödex
, s->dac_index + 1);

298 
s
->
dac_°©e
 = 0;

306 
	}
}

308 
CPURódMem‹yFunc
 *
	gtcx_dac_ªad
[3] = {

309 
tcx_dac_ªadl
,

310 
tcx_dac_ªadl
,

311 
tcx_dac_ªadl
,

314 
CPUWrôeMem‹yFunc
 *
	gtcx_dac_wrôe
[3] = {

315 
tcx_dac_wrôñ
,

316 
tcx_dac_wrôñ
,

317 
tcx_dac_wrôñ
,

320 
	$tcx_öô
(
Di•œySèã
 *
ds
, 
uöt32_t
 
addr
, 
uöt8_t
 *
vøm_ba£
,

321 
vøm_off£t
, 
vøm_size
, 
width
, 
height
)

323 
TCXSèã
 *
s
;

324 
io_mem‹y
;

326 
s
 = 
	`qemu_mÆlocz
((
TCXSèã
));

327 i‡(!
s
)

329 
s
->
ds
 = ds;

330 
s
->
addr
 =áddr;

331 
s
->
vøm
 = 
vøm_ba£
;

332 
s
->
vøm_off£t
 = vram_offset;

333 
s
->
width
 = width;

334 
s
->
height
 = height;

336 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x800000, 
vøm_size
, 
vøm_off£t
);

337 
io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
tcx_dac_ªad
, 
tcx_dac_wrôe
, 
s
);

338 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
 + 0x200000, 
TCX_DAC_NREGS
, 
io_mem‹y
);

340 
	`gøphic_c⁄sﬁe_öô
(
s
->
ds
, 
tcx_upd©e_di•œy
, 
tcx_övÆid©e_di•œy
,

341 
tcx_s¸ìn_dump
, 
s
);

342 
	`ªgi°î_ßvevm
("tcx", 
addr
, 1, 
tcx_ßve
, 
tcx_lﬂd
, 
s
);

343 
	`qemu_ªgi°î_ª£t
(
tcx_ª£t
, 
s
);

344 
	`tcx_ª£t
(
s
);

345 
	`dpy_ªsize
(
s
->
ds
, 
width
, 
height
);

346 
	}
}

348 
	$tcx_s¸ìn_dump
(*
›aque
, c⁄° *
fûíame
)

350 
TCXSèã
 *
s
 = 
›aque
;

351 
FILE
 *
f
;

352 
uöt8_t
 *
d
, *
d1
, 
v
;

353 
y
, 
x
;

355 
f
 = 
	`f›í
(
fûíame
, "wb");

356 i‡(!
f
)

358 
	`Ârötf
(
f
, "P6\n%d %d\n%d\n", 
s
->
width
, s->
height
, 255);

359 
d1
 = 
s
->
vøm
;

360 
y
 = 0; y < 
s
->
height
; y++) {

361 
d
 = 
d1
;

362 
x
 = 0; x < 
s
->
width
; x++) {

363 
v
 = *
d
;

364 
	`Âutc
(
s
->
r
[
v
], 
f
);

365 
	`Âutc
(
s
->
g
[
v
], 
f
);

366 
	`Âutc
(
s
->
b
[
v
], 
f
);

367 
d
++;

369 
d1
 +
MAXX
;

371 
	`f˛o£
(
f
);

373 
	}
}

	@tpm_tis.c

20 
	~<sys/ty≥s.h
>

21 
	~<sys/°©.h
>

22 
	~<sys/sockë.h
>

23 
	~<sys/un.h
>

24 
	~<f˙é.h
>

25 
	~<î∫o.h
>

26 
	~"vl.h
"

30 
	#TPM_MAX_PKT
 4096

	)

32 
	#VTPM_BAD_INSTANCE
 (
uöt32_t
)0xffffffff

	)

34 
	#TIS_ADDR_BASE
 0xFED40000

	)

37 
	#TPM_REG_ACCESS
 0x00

	)

38 
	#TPM_REG_INT_ENABLE
 0x08

	)

39 
	#TPM_REG_INT_VECTOR
 0x0c

	)

40 
	#TPM_REG_INT_STATUS
 0x10

	)

41 
	#TPM_REG_INTF_CAPABILITY
 0x14

	)

42 
	#TPM_REG_STS
 0x18

	)

43 
	#TPM_REG_DATA_FIFO
 0x24

	)

44 
	#TPM_REG_DID_VID
 0xf00

	)

45 
	#TPM_REG_RID
 0xf04

	)

47 
	#STS_VALID
 (1 << 7)

	)

48 
	#STS_COMMAND_READY
 (1 << 6)

	)

49 
	#STS_TPM_GO
 (1 << 5)

	)

50 
	#STS_DATA_AVAILABLE
 (1 << 4)

	)

51 
	#STS_EXPECT
 (1 << 3)

	)

52 
	#STS_RESPONSE_RETRY
 (1 << 1)

	)

54 
	#ACCESS_TPM_REG_VALID_STS
 (1 << 7)

	)

55 
	#ACCESS_ACTIVE_LOCALITY
 (1 << 5)

	)

56 
	#ACCESS_BEEN_SEIZED
 (1 << 4)

	)

57 
	#ACCESS_SEIZE
 (1 << 3)

	)

58 
	#ACCESS_PENDING_REQUEST
 (1 << 2)

	)

59 
	#ACCESS_REQUEST_USE
 (1 << 1)

	)

60 
	#ACCESS_TPM_ESTABLISHMENT
 (1 << 0)

	)

62 
	#INT_ENABLED
 (1 << 31)

	)

63 
	#INT_DATA_AVAILABLE
 (1 << 0)

	)

64 
	#INT_LOCALITY_CHANGED
 (1 << 2)

	)

65 
	#INT_COMMAND_READY
 (1 << 7)

	)

67 
	#INTERRUPTS_SUPPORTED
 (
INT_LOCALITY_CHANGED
 | \

68 
INT_DATA_AVAILABLE
 | \

69 
INT_COMMAND_READY
)

	)

70 
	#CAPABILITIES_SUPPORTED
 ((1 << 4) | \

71 
INTERRUPTS_SUPPORTED
)

	)

74 
	mSTATE_IDLE
 = 0,

75 
	mSTATE_READY
,

76 
	mSTATE_COMPLETION
,

77 
	mSTATE_EXECUTION
,

78 
	mSTATE_RECEPTION


81 
	#NUM_LOCALITIES
 5

	)

82 
	#NO_LOCALITY
 0xff

	)

84 
	#IS_VALID_LOC
(
x
Ë((xË< 
NUM_LOCALITIES
)

	)

86 
	#TPM_DID
 0x0001

	)

87 
	#TPM_VID
 0x0001

	)

88 
	#TPM_RID
 0x0001

	)

92 
	#FORCE_CLOSE
 0

	)

96 
	sTPMTx
 {

97 
	mfd
[2];

98 } 
	tçmTx
;

100 
	sTPMBuf„r
 {

101 
uöt8_t
 
	mö°™˚
[4];

102 
uöt8_t
 
	mbuf
[
TPM_MAX_PKT
];

103 } 
	t__©åibuã__
((
	t∑cked
)Ë
	tçmBuf„r
;

106 
	sTPMLoˇl
 {

107 
uöt32_t
 
	m°©e
;

108 
uöt8_t
 
	mac˚ss
;

109 
uöt8_t
 
	m°s
;

110 
uöt32_t
 
	möã
;

111 
uöt32_t
 
	möts
;

112 } 
	tçmLoc
;

115 
	sTPMSèã
 {

116 
uöt32_t
 
	moff£t
;

117 
çmBuf„r
 
	mbuf„r
;

118 
uöt8_t
 
	ma˘ive_loc
;

119 
uöt8_t
 
	mab‹tög_lo˘y
;

120 
uöt8_t
 
	m√xt_lo˘y
;

121 
uöt8_t
 
	múq_≥ndög
;

122 
çmLoc
 
	mloc
[
NUM_LOCALITIES
];

123 
QEMUTimî
 *
	mpﬁl_timî
;

124 
SëIRQFunc
 *
	m£t_úq
;

125 *
	múq_›aque
;

126 
	múq
;

127 
	mpﬁl_©ãm±s
;

128 
uöt32_t
 
	mvçm_ö°™˚
;

129 
	mTønsmôœyî
;

130 
çmTx
 
	mçmTx
;

131 } 
	tçmSèã
;

135 
TPM_Síd
(
çmSèã
 *
s
, 
çmBuf„r
 *
buf„r
, 
uöt8_t
 
lo˘y
, *
msg
);

136 
TPM_Re˚ive
(
çmSèã
 *
s
, 
çmBuf„r
 *
buf„r
);

137 
uöt32_t
 
vçm_ö°™˚_‰om_xí°‹e
();

138 
tis_pﬁl_timî
(*
›aque
);

139 
tis_¥ï_√xt_öãºu±
(
çmSèã
 *
s
);

140 
tis_øi£_úq
(
çmSèã
 *
s
, 
uöt8_t
 
lo˘y
, 
uöt32_t
 
úqmask
);

141 
˛o£_vçm_ch™√l
(
çmSèã
 *
s
, 
f‹˚
);

142 
›í_vçm_ch™√l
(
çmSèã
 *
s
);

143 
tis_©ãm±_ª˚ive
(
çmSèã
 *
s
, 
uöt8_t
 
lo˘y
);

146 
¸óã_loˇl_sockë
(
çmSèã
 *
s
, 
uöt32_t
 
vçm_ö°™˚
);

147 
wrôe_loˇl_sockë
(
çmSèã
 *
s
, c⁄° 
çmBuf„r
 *);

148 
ªad_loˇl_sockë
(
çmSèã
 *
s
, 
çmBuf„r
 *);

149 
˛o£_loˇl_sockë
(
çmSèã
 *
s
, 
f‹˚
);

150 
has_ch™√l_loˇl_sockë
(
çmSèã
 *
s
);

151 
	#LOCAL_SOCKET_PATH
 "/v¨/vçm/socks/%d.sockë"

	)

154 
	#NUM_TRANSPORTS
 1

	)

156 
	svTPM_å™smô
 {

157 (*
	m›í_‚
Ë(
çmSèã
 *
	ms
, 
uöt32_t
 
	mvçm_ö°™˚
);

158 (*
	mwrôe_‚
Ë(
çmSèã
 *
	ms
, c⁄° 
	mçmBuf„r
 *);

159 (*
	mªad_‚
Ë(
çmSèã
 *
	ms
, 
	mçmBuf„r
 *);

160 (*
	m˛o£_‚
Ë(
çmSèã
 *
	ms
, );

161 (*
	mhas_ch™√l
Ë(
çmSèã
 *
	ms
);

162 } 
	gvTPMTønsmô
[
NUM_TRANSPORTS
] = {

163 { .
›í_‚
 = 
¸óã_loˇl_sockë
,

164 .
	gwrôe_‚
 = 
wrôe_loˇl_sockë
,

165 .
	gªad_‚
 = 
ªad_loˇl_sockë
,

166 .
	g˛o£_‚
 = 
˛o£_loˇl_sockë
,

167 .
	ghas_ch™√l
 = 
has_ch™√l_loˇl_sockë
,

172 
	#IS_COMM_WITH_VTPM
(
s
) \

173 ((
s
)->
Tønsmôœyî
 >= 0 && \

174 
vTPMTønsmô
[(
s
)->
Tønsmôœyî
].
	`has_ch™√l
(s))

	)

181 
ölöe
 
uöt32_t
 
	$çm_gë_size_‰om_buf„r
(c⁄° 
uöt8_t
 *
buf„r
)

183 
uöt32_t
 
Àn
 = (
buf„r
[4] << 8) + buffer[5];

184  
Àn
;

185 
	}
}

187 
ölöe
 
	$çm_öôülize_ö°™˚
(
çmSèã
 *
s
, 
uöt32_t
 
ö°™˚
)

189 
s
->
buf„r
.
ö°™˚
[0] = (instance >> 24) & 0xff;

190 
s
->
buf„r
.
ö°™˚
[1] = (instance >> 16) & 0xff;

191 
s
->
buf„r
.
ö°™˚
[2] = (instance >> 8) & 0xff;

192 
s
->
buf„r
.
ö°™˚
[3] = (instance >> 0) & 0xff;

193 
	}
}

198 
	$›í_vçm_ch™√l
(
çmSèã
 *
s
)

200 
idx
;

202 
idx
 = 0; idx < 
NUM_TRANSPORTS
; idx++) {

203 i‡(1 =
vTPMTønsmô
[
idx
].
	`›í_‚
(
s
, s->
vçm_ö°™˚
)) {

205 
s
->
Tønsmôœyî
 = 
idx
;

209 
	}
}

214 
ölöe
 
	$˛o£_vçm_ch™√l
(
çmSèã
 *
s
, 
f‹˚
)

216 i‡(1 =
vTPMTønsmô
[
s
->
Tønsmôœyî
].
	`˛o£_‚
(s, 
f‹˚
)) {

217 
s
->
Tønsmôœyî
 = -1;

219 
	}
}

221 
ölöe
 
uöt8_t
 
	$loˇlôy_‰om_addr
(
èrgë_phys_addr_t
 
addr
)

223  (
uöt8_t
)((
addr
 >> 12) & 0x7);

224 
	}
}

235 
	$¸óã_loˇl_sockë
(
çmSèã
 *
s
, 
uöt32_t
 
vçm_ö°™˚
)

237 
suc˚ss
 = 1;

238 i‡(
s
->
çmTx
.
fd
[0] < 0) {

239 
s
->
çmTx
.
fd
[0] = 
	`sockë
(
PF_LOCAL
, 
SOCK_STREAM
, 0);

241 #ifde‡
DEBUG_TPM


242 
	`Ârötf
(
logfûe
," SOCKET FD %dÉºnÿ%d \n", 
s
->
çmTx
.
fd
[0], 
î∫o
 );

244 i‡(
	`has_ch™√l_loˇl_sockë
(
s
)) {

245 
ªt
;

246 
sockaddr_un
 
addr
;

247 
	`mem£t
(&
addr
, 0x0, (addr));

248 
addr
.
sun_Ámûy
 = 
AF_LOCAL
;

249 
	`¢¥ötf
(
addr
.
sun_∑th
, (addr.sun_path)-1,

250 
LOCAL_SOCKET_PATH
, (
uöt32_t
Ë
vçm_ö°™˚
);

251 #ifde‡
DEBUG_TPM


252 
	`Ârötf
(
logfûe
," SOCKET NAME %†\n", 
addr
.
sun_∑th
 );

255 i‡((
ªt
 = 
	`c⁄√˘
(
s
->
çmTx
.
fd
[0], (
sockaddr
 *)&
addr
,

256 (
addr
))) != 0) {

257 
	`˛o£_loˇl_sockë
(
s
, 1);

258 #ifde‡
DEBUG_TPM


259 
	`Ârötf
(
logfûe
," RET %dÉºnÿ%d\n", 
ªt
, 
î∫o
 );

261 
suc˚ss
 = 0;

264 #ifde‡
DEBUG_TPM


265 
	`Ârötf
(
logfûe
,"Öut filedescriptor inÇon-blocking mode "

268 
Êags
 = 
	`f˙é
(
s
->
çmTx
.
fd
[0], 
F_GETFL
);

269 
	`f˙é
(
s
->
çmTx
.
fd
[0], 
F_SETFL
, 
Êags
 | 
O_NONBLOCK
);

271 #ifde‡
DEBUG_TPM


272 i‡(
suc˚ss
)

273 
	`Ârötf
(
logfûe
," Successfully connected usingÜocal socket"

274 "%s.\n",
addr
.
sun_∑th
);

276 
	`Ârötf
(
logfûe
," CouldÇot connectÅoÜocal socket "

277 "%s.\n",
addr
.
sun_∑th
);

280 
suc˚ss
 = 0;

283  
suc˚ss
;

284 
	}
}

292 
	$wrôe_loˇl_sockë
(
çmSèã
 *
s
, c⁄° 
çmBuf„r
 *
buf„r
)

294 
uöt32_t
 
size
 = 
	`çm_gë_size_‰om_buf„r
(
buf„r
->
buf
);

295 
Àn
;

297 
Àn
 = 
	`wrôe
(
s
->
çmTx
.
fd
[0],

298 
buf„r
->
ö°™˚
,

299 (
buf„r
->
ö°™˚
Ë+ 
size
);

300 i‡(
Àn
 =(
buf„r
->
ö°™˚
Ë+ 
size
) {

301  
Àn
;

305 
	}
}

312 
	$ªad_loˇl_sockë
(
çmSèã
 *
s
, 
çmBuf„r
 *
buf„r
)

314 
off
;

315 #ifde‡
DEBUG_TPM


316 
	`Ârötf
(
logfûe
, "Ródög from fd %d\n", 
s
->
çmTx
.
fd
[0]);

318 
off
 = 
	`ªad
(
s
->
çmTx
.
fd
[0],

319 
buf„r
->
ö°™˚
,

320 (
buf„r
->
ö°™˚
)+
TPM_MAX_PKT
);

321 #ifde‡
DEBUG_TPM


322 
	`Ârötf
(
logfûe
, "Ród %d byãs\n", 
off
);

324  
off
;

325 
	}
}

333 
	$˛o£_loˇl_sockë
(
çmSèã
 *
s
, 
f‹˚
)

335 i‡(
f‹˚
) {

336 
	`˛o£
(
s
->
çmTx
.
fd
[0]);

337 #ifde‡
DEBUG_TPM


338 
	`Ârötf
(
logfûe
,"Clo£d c⁄√˘i⁄ wôh fd %d\n",
s
->
çmTx
.
fd
[0]);

340 
s
->
çmTx
.
fd
[0] = -1;

343 #ifde‡
DEBUG_TPM


344 
	`Ârötf
(
logfûe
,"Kìpög c⁄√˘i⁄ wôh fd %d\n",
s
->
çmTx
.
fd
[0]);

347 
	}
}

353 
	$has_ch™√l_loˇl_sockë
(
çmSèã
 *
s
)

355  (
s
->
çmTx
.
fd
[0] > 0);

356 
	}
}

363 
uöt32_t
 
	$çm_d©a_ªad
(
çmSèã
 *
s
, 
uöt8_t
 
lo˘y
)

365 
uöt32_t
 
ªt
, 
Àn
;

368 
	`tis_©ãm±_ª˚ive
(
s
, 
lo˘y
);

370 i‡(
s
->
loc
[
lo˘y
].
°©e
 !
STATE_COMPLETION
) {

374 
Àn
 = 
	`çm_gë_size_‰om_buf„r
(
s
->
buf„r
.
buf
);

375 
ªt
 = 
s
->
buf„r
.
buf
[s->
off£t
++];

376 i‡(
s
->
off£t
 >
Àn
) {

377 
s
->
loc
[
lo˘y
].
°s
 = 
STS_VALID
 ;

378 
s
->
off£t
 = 0;

380 #ifde‡
DEBUG_TPM


381 
	`Ârötf
(
logfûe
,"çm_d©a_ªad byã x%02x [%d]\n",
ªt
,
s
->
off£t
-1);

383  
ªt
;

384 
	}
}

389 
	$tis_øi£_úq
(
çmSèã
 *
s
, 
uöt8_t
 
lo˘y
, 
uöt32_t
 
úqmask
)

391 i‡(!
s
->
úq_≥ndög
 &&

392 (
s
->
loc
[
lo˘y
].
öã
 & 
INT_ENABLED
) &&

393 (
s
->
loc
[
lo˘y
].
öã
 & 
úqmask
)) {

394 i‡((
úqmask
 & 
s
->
loc
[
lo˘y
].
öts
) == 0) {

395 #ifde‡
DEBUG_TPM


396 
	`Ârötf
(
logfûe
,"Raisög IRQ f‹ fœg %08x\n",
úqmask
);

398 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 1);

399 
s
->
úq_≥ndög
 = 1;

400 
s
->
loc
[
lo˘y
].
öts
 |
úqmask
;

403 
	}
}

406 
	$tis_ab‹t
(
çmSèã
 *
s
)

408 
s
->
off£t
 = 0;

409 
s
->
a˘ive_loc
 = s->
√xt_lo˘y
;

415 i‡(
s
->
ab‹tög_lo˘y
 =s->
√xt_lo˘y
) {

416 
s
->
loc
[s->
ab‹tög_lo˘y
].
°©e
 = 
STATE_READY
;

417 
s
->
loc
[s->
ab‹tög_lo˘y
].
°s
 = 
STS_COMMAND_READY
;

418 
	`tis_øi£_úq
(
s
, s->
ab‹tög_lo˘y
, 
INT_COMMAND_READY
);

422 i‡(
s
->
ab‹tög_lo˘y
 !s->
√xt_lo˘y
 && s->√xt_lo˘y !
NO_LOCALITY
) {

423 
s
->
loc
[s->
ab‹tög_lo˘y
].
ac˚ss
 &~
ACCESS_ACTIVE_LOCALITY
;

424 
s
->
loc
[s->
√xt_lo˘y
].
ac˚ss
 |
ACCESS_ACTIVE_LOCALITY
;

425 
	`tis_øi£_úq
(
s
, s->
√xt_lo˘y
, 
INT_LOCALITY_CHANGED
);

428 
s
->
ab‹tög_lo˘y
 = 
NO_LOCALITY
;

430 
	`qemu_dñ_timî
(
s
->
pﬁl_timî
);

431 
	}
}

434 
	$tis_¥ï_ab‹t
(
çmSèã
 *
s
, 
uöt8_t
 
lo˘y
, uöt8_à
√wlo˘y
)

436 
s
->
ab‹tög_lo˘y
 = 
lo˘y
;

437 
s
->
√xt_lo˘y
 = 
√wlo˘y
;

443 i‡(
s
->
loc
[
lo˘y
].
°©e
 =
STATE_EXECUTION
 &&

444 
	`IS_COMM_WITH_VTPM
(
s
)) {

446 
s
->
pﬁl_©ãm±s
 = 0;

447 
	`tis_¥ï_√xt_öãºu±
(
s
);

449 
	`tis_ab‹t
(
s
);

451 
	}
}

457 
	$tis_©ãm±_ª˚ive
(
çmSèã
 *
s
, 
uöt8_t
 
lo˘y
)

466 i‡(!
	`IS_VALID_LOC
(
s
->
ab‹tög_lo˘y
)) {

467 i‡(
s
->
loc
[
lo˘y
].
°©e
 =
STATE_EXECUTION
) {

468 i‡(0 =(
s
->
loc
[
lo˘y
].
°s
 & 
STS_DATA_AVAILABLE
)){

469 i‡(
	`IS_COMM_WITH_VTPM
(
s
)) {

470 
n
 = 
	`TPM_Re˚ive
(
s
, &s->
buf„r
);

471 i‡(
n
 > 0) {

472 
s
->
loc
[
lo˘y
].
°s
 = 
STS_VALID
 | 
STS_DATA_AVAILABLE
;

473 
s
->
loc
[
lo˘y
].
°©e
 = 
STATE_COMPLETION
;

474 
	`˛o£_vçm_ch™√l
(
s
, 
FORCE_CLOSE
);

475 
	`tis_øi£_úq
(
s
, 
lo˘y
, 
INT_DATA_AVAILABLE
);

481 
	}
}

487 
uöt32_t
 
	$tis_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

489 
çmSèã
 *
s
 = (çmSèã *)
›aque
;

490 
uöt16_t
 
off£t
 = 
addr
 & 0xffc;

491 
uöt8_t
 
shi·
 = (
addr
 & 0x3) * 8;

492 
uöt32_t
 
vÆ
 = 0;

493 
uöt8_t
 
lo˘y
 = 
	`loˇlôy_‰om_addr
(
addr
);

495 i‡(
off£t
 =
TPM_REG_ACCESS
) {

496 i‡(
s
->
a˘ive_loc
 =
lo˘y
) {

497 
s
->
loc
[
lo˘y
].
ac˚ss
 |= (1 << 5);

499 
s
->
loc
[
lo˘y
].
ac˚ss
 &= ~(1 << 5);

501 
vÆ
 = 
s
->
loc
[
lo˘y
].
ac˚ss
;

503 i‡(
off£t
 =
TPM_REG_INT_ENABLE
) {

504 
vÆ
 = 
s
->
loc
[
lo˘y
].
öã
;

506 i‡(
off£t
 =
TPM_REG_INT_VECTOR
) {

507 
vÆ
 = 
s
->
úq
;

509 i‡(
off£t
 =
TPM_REG_INT_STATUS
) {

510 
	`tis_©ãm±_ª˚ive
(
s
, 
lo˘y
);

511 
vÆ
 = 
s
->
loc
[
lo˘y
].
öts
;

513 i‡(
off£t
 =
TPM_REG_INTF_CAPABILITY
) {

514 
vÆ
 = 
CAPABILITIES_SUPPORTED
;

516 i‡(
off£t
 =
TPM_REG_STS
) {

517 
	`tis_©ãm±_ª˚ive
(
s
, 
lo˘y
);

518 
vÆ
 = ((
s
->
buf„r
.
buf
Ë- s->
off£t
Ë<< 8 | s->
loc
[
lo˘y
].
°s
;

520 i‡(
off£t
 =
TPM_REG_DATA_FIFO
) {

521 
vÆ
 = 
	`çm_d©a_ªad
(
s
, 
lo˘y
);

523 i‡(
off£t
 =
TPM_REG_DID_VID
) {

524 
vÆ
 = (
TPM_DID
 << 16Ë| 
TPM_VID
;

526 i‡(
off£t
 =
TPM_REG_RID
) {

527 
vÆ
 = 
TPM_RID
;

530 i‡(
shi·
)

531 
vÆ
 >>
shi·
;

533 #ifde‡
DEBUG_TPM


534 
	`Ârötf
(
logfûe
,"Ñead(%08x) = %08x\n",

535 ()
addr
,

536 
vÆ
);

539  
vÆ
;

540 
	}
}

546 
	$tis_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

548 
çmSèã
* 
s
=—pmSèã*)
›aque
;

549 
uöt16_t
 
off
 = 
addr
 & 0xfff;

550 
uöt8_t
 
lo˘y
 = 
	`loˇlôy_‰om_addr
(
addr
);

551 
n
, 
c
;

552 
uöt32_t
 
Àn
;

554 #ifde‡
DEBUG_TPM


555 
	`Ârötf
(
logfûe
,"write(%08x) = %08x\n",

556 ()
addr
,

557 
vÆ
);

560 i‡(
off
 =
TPM_REG_ACCESS
) {

561 i‡(
vÆ
 & 
ACCESS_ACTIVE_LOCALITY
) {

563 i‡(
s
->
a˘ive_loc
 =
lo˘y
) {

564 
uöt8_t
 
√wlo˘y
 = 
NO_LOCALITY
;

565 
s
->
loc
[
lo˘y
].
ac˚ss
 &~(
ACCESS_PENDING_REQUEST
);

567 
c
 = 
NUM_LOCALITIES
 - 1; c >= 0; c--) {

568 i‡(
s
->
loc
[
c
].
ac˚ss
 & 
ACCESS_REQUEST_USE
) {

569 
s
->
loc
[
c
].
ac˚ss
 |
ACCESS_TPM_REG_VALID_STS
;

570 
s
->
loc
[
c
].
ac˚ss
 &~
ACCESS_REQUEST_USE
;

571 
√wlo˘y
 = 
c
;

575 
	`tis_¥ï_ab‹t
(
s
, 
lo˘y
, 
√wlo˘y
);

578 i‡(
vÆ
 & 
ACCESS_BEEN_SEIZED
) {

580 
s
->
loc
[
lo˘y
].
ac˚ss
 &~
ACCESS_BEEN_SEIZED
;

582 i‡(
vÆ
 & 
ACCESS_SEIZE
) {

583 i‡(
lo˘y
 > 
s
->
a˘ive_loc
 && 
	`IS_VALID_LOC
(s->active_loc)) {

584 
s
->
loc
[s->
a˘ive_loc
].
ac˚ss
 |
ACCESS_BEEN_SEIZED
;

585 
s
->
loc
[
lo˘y
].
ac˚ss
 = 
ACCESS_TPM_REG_VALID_STS
;

586 
	`tis_¥ï_ab‹t
(
s
, s->
a˘ive_loc
, 
lo˘y
);

589 i‡(
vÆ
 & 
ACCESS_REQUEST_USE
) {

590 i‡(
	`IS_VALID_LOC
(
s
->
a˘ive_loc
)) {

592 
s
->
loc
[s->
a˘ive_loc
].
ac˚ss
 |
ACCESS_PENDING_REQUEST
;

595 
s
->
loc
[
lo˘y
].
ac˚ss
 |
ACCESS_ACTIVE_LOCALITY
;

596 
s
->
a˘ive_loc
 = 
lo˘y
;

597 
	`tis_øi£_úq
(
s
, 
lo˘y
, 
INT_LOCALITY_CHANGED
);

601 i‡(
off
 =
TPM_REG_INT_ENABLE
) {

602 
s
->
loc
[
lo˘y
].
öã
 = (
vÆ
 & (
INT_ENABLED
 | (0x3 << 3) |

603 
INTERRUPTS_SUPPORTED
));

605 i‡(
off
 =
TPM_REG_INT_STATUS
) {

607 i‡((
vÆ
 & 
INTERRUPTS_SUPPORTED
) &&

608 (
s
->
loc
[
lo˘y
].
öts
 & 
INTERRUPTS_SUPPORTED
)) {

609 
s
->
	`£t_úq
(s->
úq_›aque
, s->
úq
, 0);

610 
s
->
úq_≥ndög
 = 0;

612 
s
->
loc
[
lo˘y
].
öts
 &~(
vÆ
 & 
INTERRUPTS_SUPPORTED
);

614 i‡(
off
 =
TPM_REG_STS
) {

615 i‡(
vÆ
 & 
STS_COMMAND_READY
) {

616 i‡(
s
->
loc
[
lo˘y
].
°©e
 =
STATE_IDLE
) {

617 
s
->
loc
[
lo˘y
].
°s
 = 
STS_COMMAND_READY
;

618 
s
->
loc
[
lo˘y
].
°©e
 = 
STATE_READY
;

619 
	`tis_øi£_úq
(
s
, 
lo˘y
, 
INT_COMMAND_READY
);

620 } i‡(
s
->
loc
[
lo˘y
].
°©e
 =
STATE_COMPLETION
 ||

621 
s
->
loc
[
lo˘y
].
°©e
 =
STATE_EXECUTION
 ||

622 
s
->
loc
[
lo˘y
].
°©e
 =
STATE_RECEPTION
) {

624 
	`tis_¥ï_ab‹t
(
s
, 
lo˘y
,Üocty);

627 i‡(
vÆ
 & 
STS_TPM_GO
) {

628 
n
 = 
	`TPM_Síd
(
s
, &s->
buf„r
, 
lo˘y
, "tpm_data_write");

629 i‡(
n
 > 0) {

631 
s
->
off£t
 = 0;

632 
s
->
loc
[
lo˘y
].
°©e
 = 
STATE_EXECUTION
;

633 i‡(
s
->
loc
[
lo˘y
].
öã
 & (
INT_ENABLED
 | 
INT_DATA_AVAILABLE
)) {

634 
s
->
pﬁl_©ãm±s
 = 0;

635 
	`tis_¥ï_√xt_öãºu±
(
s
);

639 i‡(
vÆ
 & 
STS_RESPONSE_RETRY
) {

640 
s
->
off£t
 = 0;

642 } i‡(
off
 =
TPM_REG_DATA_FIFO
) {

644 i‡(
s
->
loc
[
lo˘y
].
°©e
 =
STATE_IDLE
 ||

645 
s
->
loc
[
lo˘y
].
°©e
 =
STATE_EXECUTION
 ||

646 
s
->
loc
[
lo˘y
].
°©e
 =
STATE_COMPLETION
) {

649 #ifde‡
TPM_DEBUG


650 
	`Ârötf
(
logfûe
,"ByãÅÿ£ndÅÿTPM: %02x\n", 
vÆ
);

652 
s
->
loc
[
lo˘y
].
°©e
 = 
STATE_RECEPTION
;

654 i‡(
s
->
off£t
 < (s->
buf„r
.
buf
))

655 
s
->
buf„r
.
buf
[s->
off£t
++] = (
uöt8_t
)
vÆ
;

657 i‡(
s
->
off£t
 > 5) {

659 
Àn
 = 
	`çm_gë_size_‰om_buf„r
(
s
->
buf„r
.
buf
);

660 i‡(
Àn
 > 
s
->
off£t
) {

661 
s
->
loc
[
lo˘y
].
°s
 = 
STS_EXPECT
 | 
STS_VALID
;

663 
s
->
loc
[
lo˘y
].
°s
 = 
STS_VALID
;

668 
	}
}

678 
	$tis_¥ï_√xt_öãºu±
(
çmSèã
 *
s
)

680 
öt64_t
 
expú©i⁄
;

681 
øã
 = 5;

687 i‡(
s
->
pﬁl_©ãm±s
 < 5) {

688 
øã
 = 20;

689 } i‡(
s
->
pﬁl_©ãm±s
 < 10) {

690 
øã
 = 10;

693 
expú©i⁄
 = 
	`qemu_gë_˛ock
(
vm_˛ock
Ë+ (
ticks_≥r_£c
 / 
øã
);

694 
	`qemu_mod_timî
(
s
->
pﬁl_timî
, 
expú©i⁄
);

695 
s
->
pﬁl_©ãm±s
++;

696 
	}
}

703 
	$tis_pﬁl_timî
(*
›aque
)

705 
çmSèã
* 
s
=—pmSèã*)
›aque
;

706 
uöt8_t
 
lo˘y
 = 
s
->
a˘ive_loc
;

708 i‡(!
	`IS_VALID_LOC
(
lo˘y
) ||

709 (!(
s
->
loc
[
lo˘y
].
öã
 & 
INT_ENABLED
) &&

710 (
s
->
ab‹tög_lo˘y
 !
NO_LOCALITY
)) ||

711 !
	`IS_COMM_WITH_VTPM
(
s
)) {

713 
	`qemu_dñ_timî
(
s
->
pﬁl_timî
);

716 i‡(!
	`IS_COMM_WITH_VTPM
(
s
)) {

717 i‡(
s
->
ab‹tög_lo˘y
 !
NO_LOCALITY
) {

718 
	`tis_ab‹t
(
s
);

723 i‡(
s
->
ab‹tög_lo˘y
 !
NO_LOCALITY
) {

724 
n
 = 
	`TPM_Re˚ive
(
s
, &s->
buf„r
);

725 #ifde‡
DEBUG_TPM


726 
	`Ârötf
(
logfûe
,"Receiving forábort.\n");

728 i‡(
n
 > 0) {

729 
	`˛o£_vçm_ch™√l
(
s
, 
FORCE_CLOSE
);

730 
	`tis_ab‹t
(
s
);

731 #ifde‡
DEBUG_TPM


732 
	`Ârötf
(
logfûe
,"Abort is complete.\n");

735 
	`tis_¥ï_√xt_öãºu±
(
s
);

737 } i‡(
	`IS_VALID_LOC
(
lo˘y
)) {

738 i‡(
s
->
loc
[
lo˘y
].
°©e
 =
STATE_EXECUTION
) {

740 
n
 = 
	`TPM_Re˚ive
(
s
, &s->
buf„r
);

741 i‡(
n
 > 0) {

742 
s
->
loc
[
lo˘y
].
°s
 = 
STS_VALID
 | 
STS_DATA_AVAILABLE
;

743 
s
->
loc
[
lo˘y
].
°©e
 = 
STATE_COMPLETION
;

744 
	`˛o£_vçm_ch™√l
(
s
, 
FORCE_CLOSE
);

745 
	`tis_øi£_úq
(
s
, 
lo˘y
, 
INT_DATA_AVAILABLE
);

748 
	`tis_¥ï_√xt_öãºu±
(
s
);

752 
	}
}

755 
CPURódMem‹yFunc
 *
	gtis_ªad‚
[3]={

756 
tis_mem_ªadl
,

757 
tis_mem_ªadl
,

758 
tis_mem_ªadl


761 
CPUWrôeMem‹yFunc
 *
	gtis_wrôe‚
[3]={

762 
tis_mem_wrôñ
,

763 
tis_mem_wrôñ
,

764 
tis_mem_wrôñ


772 
	$çm_ßve
(
QEMUFûe
* 
f
,* 
›aque
)

774 
çmSèã
* 
s
=—pmSèã*)
›aque
;

775 
uöt8_t
 
lo˘y
 = 
s
->
a˘ive_loc
;

776 
c
;

779 i‡(
s
->
loc
[
lo˘y
].
°©e
 =
STATE_EXECUTION
) {

780 
ª≥©s
 = 30;

781 
ª≥©s
 > 0 &&

782 !(
s
->
loc
[s->
a˘ive_loc
].
°s
 & 
STS_DATA_AVAILABLE
)) {

783 
n
 = 
	`TPM_Re˚ive
(
s
, &s->
buf„r
);

784 i‡(
n
 > 0) {

785 i‡(
	`IS_VALID_LOC
(
s
->
a˘ive_loc
)) {

786 
s
->
loc
[s->
a˘ive_loc
].
°s
 = 
STS_VALID
 | 
STS_DATA_AVAILABLE
;

787 
s
->
loc
[s->
a˘ive_loc
].
°©e
 = 
STATE_COMPLETION
;

788 
	`tis_øi£_úq
(
s
, s->
a˘ive_loc
, 
INT_DATA_AVAILABLE
);

791 
	`˛o£_vçm_ch™√l
(
s
, 1);

794 
	`¶ìp
(1);

798 i‡(
	`IS_COMM_WITH_VTPM
(
s
)) {

799 
	`˛o£_vçm_ch™√l
(
s
, 1);

802 
	`qemu_put_be32s
(
f
,&
s
->
off£t
);

803 
	`qemu_put_buf„r
(
f
, 
s
->
buf„r
.
buf
, 
TPM_MAX_PKT
);

804 
	`qemu_put_8s
(
f
, &
s
->
a˘ive_loc
);

805 
	`qemu_put_8s
(
f
, &
s
->
úq_≥ndög
);

806 
c
 = 0; c < 
NUM_LOCALITIES
; c++) {

807 
	`qemu_put_be32s
(
f
, &
s
->
loc
[
c
].
°©e
);

808 
	`qemu_put_8s
(
f
, &
s
->
loc
[
c
].
ac˚ss
);

809 
	`qemu_put_8s
(
f
, &
s
->
loc
[
c
].
°s
);

810 
	`qemu_put_be32s
(
f
, &
s
->
loc
[
c
].
öã
);

811 
	`qemu_put_be32s
(
f
, &
s
->
loc
[
c
].
öts
);

813 
	}
}

818 
	$çm_lﬂd
(
QEMUFûe
* 
f
,* 
›aque
,
vîsi⁄_id
)

820 
çmSèã
* 
s
=—pmSèã*)
›aque
;

821 
c
;

823 i‡(
vîsi⁄_id
 != 1)

824  -
EINVAL
;

826 
	`qemu_gë_be32s
(
f
,&
s
->
off£t
);

827 
	`qemu_gë_buf„r
(
f
, 
s
->
buf„r
.
buf
, 
TPM_MAX_PKT
);

828 
	`qemu_gë_8s
(
f
, &
s
->
a˘ive_loc
);

829 
	`qemu_gë_8s
(
f
, &
s
->
úq_≥ndög
);

830 
c
 = 0; c < 
NUM_LOCALITIES
; c++) {

831 
	`qemu_gë_be32s
(
f
, &
s
->
loc
[
c
].
°©e
);

832 
	`qemu_gë_8s
(
f
, &
s
->
loc
[
c
].
ac˚ss
);

833 
	`qemu_gë_8s
(
f
, &
s
->
loc
[
c
].
°s
);

834 
	`qemu_gë_be32s
(
f
, &
s
->
loc
[
c
].
öã
);

835 
	`qemu_gë_be32s
(
f
, &
s
->
loc
[
c
].
öts
);

839 
s
->
vçm_ö°™˚
 = 
	`vçm_ö°™˚_‰om_xí°‹e
();

840 i‡(
s
->
vçm_ö°™˚
 =
VTPM_BAD_INSTANCE
)

841  -
EINVAL
;

842 
	`çm_öôülize_ö°™˚
(
s
, s->
vçm_ö°™˚
);

845 
	}
}

848 
	sLPCçmSèã
 {

849 
çmSèã
 
	mçm
;

850 
	mmem
;

851 } 
	tLPCçmSèã
;

857 
	$çm_tis_öô
(
SëIRQFunc
 *
£t_úq
, *
›aque
, 
úq
)

859 
LPCçmSèã
 *
d
;

860 
çmSèã
 *
s
;

861 
c
 = 0;

862 
uöt32_t
 
vçm_ö
;

864 
vçm_ö
 = 
	`vçm_ö°™˚_‰om_xí°‹e
();

866 i‡(
vçm_ö
 =
VTPM_BAD_INSTANCE
)

869 
d
 = 
	`qemu_mÆlocz
((
LPCçmSèã
));

870 
d
->
mem
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
tis_ªad‚
, 
tis_wrôe‚
, d);

872 i‡(
d
->
mem
 == -1) {

876 
	`˝u_ªgi°î_physiˇl_mem‹y
(
TIS_ADDR_BASE
,

877 0x1000 * 
NUM_LOCALITIES
, 
d
->
mem
);

880 
s
 = &
d
->
çm
;

882 
s
->
off£t
 = 0;

883 
s
->
a˘ive_loc
 = 
NO_LOCALITY
;

885 
c
 < 
NUM_LOCALITIES
) {

886 
s
->
loc
[
c
].
ac˚ss
 = (1 << 7);

887 
s
->
loc
[
c
].
°s
 = 0;

888 
s
->
loc
[
c
].
öã
 = (1 << 3);

889 
s
->
loc
[
c
].
öts
 = 0;

890 
s
->
loc
[
c
].
°©e
 = 
STATE_IDLE
;

891 
c
++;

893 
s
->
pﬁl_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
tis_pﬁl_timî
, s);

894 
s
->
£t_úq
 = set_irq;

895 
s
->
úq_›aque
 = 
›aque
;

896 
s
->
úq
 = irq;

897 
s
->
vçm_ö°™˚
 = 
vçm_ö
;

898 
s
->
Tønsmôœyî
 = -1;

899 
s
->
çmTx
.
fd
[0] = -1;

900 
s
->
çmTx
.
fd
[1] = -1;

901 
s
->
ab‹tög_lo˘y
 = 
NO_LOCALITY
;

903 
	`çm_öôülize_ö°™˚
(
s
, s->
vçm_ö°™˚
);

904 
	`mem£t
(
s
->
buf„r
.
buf
,0,(s->buffer.buf));

906 
	`ªgi°î_ßvevm
("çm-tis", 0, 1, 
çm_ßve
, 
çm_lﬂd
, 
s
);

908 
	`›í_vçm_ch™√l
(
s
);

909 
c
 = 0; !
	`IS_COMM_WITH_VTPM
(
s
) && (c < 5); c++) {

910 
	`¶ìp
(1);

911 
	`›í_vçm_ch™√l
(
s
);

913 
	}
}

918 #ifde‡
DEBUG_TPM


919 
	$showBuff
(*
buff
, *
°rög
)

921 
uöt32_t
 
i
, 
Àn
;

923 
Àn
 = 
	`çm_gë_size_‰om_buf„r
(
buff
);

924 
	`Ârötf
(
logfûe
,"%†Àngth = %d\n", 
°rög
, 
Àn
);

925 
i
 = 0; i < 
Àn
; i++) {

926 i‡(
i
 && !(i % 16)) {

927 
	`Ârötf
(
logfûe
,"\n");

929 
	`Ârötf
(
logfûe
,"%.2X ", 
buff
[
i
]);

931 
	`Ârötf
(
logfûe
,"\n");

932 
	}
}

939 c⁄° 
	gçm_Áûuª
[] = {

949 
	$TPM_Síd
(
çmSèã
 *
s
, 
çmBuf„r
 *
buf„r
, 
uöt8_t
 
lo˘y
, *
msg
)

951 
Àn
;

952 
uöt32_t
 
size
 = 
	`çm_gë_size_‰om_buf„r
(
buf„r
->
buf
);

955 i‡–!
	`IS_COMM_WITH_VTPM
(
s
)) {

956 
	`›í_vçm_ch™√l
(
s
);

959 i‡–!
	`IS_COMM_WITH_VTPM
(
s
)) {

960 
èg
 = 
buf„r
->
buf
[1];

963 
	`mem˝y
(
buf„r
->
buf
, 
çm_Áûuª
, (tpm_failure));

964 
buf„r
->
buf
[1] = 
èg
 + 3;

965 i‡(
	`IS_VALID_LOC
(
s
->
a˘ive_loc
)) {

966 
s
->
loc
[s->
a˘ive_loc
].
°s
 = 
STS_DATA_AVAILABLE
 | 
STS_VALID
;

968 #ifde‡
DEBUG_TPM


969 
	`Ârötf
(
logfûe
,"No TPMÑunning!\n");

972  (
buf„r
->
ö°™˚
Ë+ 
size
;

975 #ifde‡
DEBUG_TPM


976 
	`showBuff
(
buf„r
->
buf
, "To TPM");

980 
buf„r
->
ö°™˚
[0] &= 0x1f;

981 
buf„r
->
ö°™˚
[0] |(
lo˘y
 << 5);

983 
Àn
 = 
vTPMTønsmô
[
s
->
Tønsmôœyî
].
	`wrôe_‚
(s, 
buf„r
);

984 i‡(
Àn
 < 0) {

985 
s
->
Tønsmôœyî
 = -1;

987  
Àn
;

988 
	}
}

995 
	$TPM_Re˚ive
(
çmSèã
 *
s
, 
çmBuf„r
 *
buf„r
)

997 
off
;

999 
off
 = 
vTPMTønsmô
[
s
->
Tønsmôœyî
].
	`ªad_‚
(s, 
buf„r
);

1001 i‡(
off
 < 0) {

1006 i‡(
off
 == 0) {

1007 #ifde‡
DEBUG_TPM


1008 
	`Ârötf
(
logfûe
,"TPM GONE?Éºno=%d\n",
î∫o
);

1010 
	`˛o£_vçm_ch™√l
(
s
, 1);

1012 i‡(
	`IS_VALID_LOC
(
s
->
a˘ive_loc
)) {

1013 
s
->
loc
[s->
a˘ive_loc
].
°s
 = 
STS_VALID
 | 
STS_DATA_AVAILABLE
;

1014 
s
->
loc
[s->
a˘ive_loc
].
°©e
 = 
STATE_COMPLETION
;

1015 
	`tis_øi£_úq
(
s
, s->
a˘ive_loc
, 
INT_DATA_AVAILABLE
);

1020 #ifde‡
DEBUG_TPM


1021 i‡(
off
 > (
buf„r
->
ö°™˚
 ) + 6) {

1022 
uöt32_t
 
size
 = 
	`çm_gë_size_‰om_buf„r
(
buf„r
->
buf
);

1023 i‡(
size
 + (
buf„r
->
ö°™˚
Ë!
off
) {

1024 
	`Ârötf
(
logfûe
,"TPM: Packet size is bad! %d != %d\n",

1025 ()(
size
 + (
buf„r
->
ö°™˚
)),

1026 
off
);

1028 
uöt32_t
 
ªt
;

1029 
	`showBuff
(
buf„r
->
buf
, "From TPM");

1030 
ªt
 = (
buf„r
->
buf
[8])*256 + buffer->buf[9];

1031 i‡(
ªt
)

1032 
	`Ârötf
(
logfûe
,"Re˚ivêÁûed wôhÉº‹ %d\n", 
ªt
);

1034 
	`Ârötf
(
logfûe
,"Receive succeeded. GotÑesponse ofÜength %d (=%d)\n",

1035 
size
, 
off
);

1041  
off
;

1042 
	}
}

1049 
	$has_çm_devi˚
()

1051 
ªt
 = 0;

1052 
xs_h™dÀ
 *
h™dÀ
 = 
	`xs_d´m⁄_›í
();

1053 i‡(
h™dÀ
) {

1054 
ªt
 = 
	`xí°‹e_domaö_has_devty≥
(
h™dÀ
, "vtpm");

1055 
	`xs_d´m⁄_˛o£
(
h™dÀ
);

1057  
ªt
;

1058 
	}
}

1065 
uöt32_t
 
	$vçm_ö°™˚_‰om_xí°‹e
()

1067 
num
;

1068 
uöt32_t
 
numbî
 = 
VTPM_BAD_INSTANCE
;

1069 
íd
 = 0;

1070 *
tokí
 = "tok";

1071 
subs¸ibed
 = 0;

1072 
˘r
 = 0;

1073 
fd_£t
 
ªadfds
;

1075 
xs_h™dÀ
 *
h™dÀ
 = 
	`xs_d´m⁄_›í
();

1077 
	`FD_ZERO
(&
ªadfds
);

1079 i‡(
h™dÀ
) {

1080 **
e
 = 
	`xí°‹e_domaö_gë_devi˚s
(
h™dÀ
, "vçm", &
num
);

1081 
fd
 = 
	`xs_fûío
(
h™dÀ
);

1082 
	`FD_SET
(
fd
, &
ªadfds
);

1083 i‡(
e
) {

1085 
timevÆ
 
tv
 = {

1086 .
tv_£c
 = 30,

1087 .
tv_u£c
 = 0,

1090 *
°©us
 = 
	`xí°‹e_ªad_hŸ∂ug_°©us
(
h™dÀ
,

1092 
e
[0]);

1093 i‡(
°©us
) {

1094 i‡(!
	`°rcmp
(
°©us
, "connected")) {

1095 *
ö°
 = 
	`xí°‹e_backíd_ªad_v¨übÀ
(
h™dÀ
,

1097 
e
[0],

1099 i‡(1 !(
	`ssˇnf
(
ö°
,"%d",&
numbî
)))

1100 
numbî
 = 
VTPM_BAD_INSTANCE
;

1101 
	`‰ì
(
ö°
);

1103 
	`Ârötf
(
logfûe
,

1105 
°©us
);

1107 
	`‰ì
(
°©us
);

1108 
íd
 = 1;

1111 
rc
;

1112 
ƒ
;

1113 **
f
;

1115 i‡(!
subs¸ibed
) {

1116 
rc
 = 
	`xí°‹e_subs¸ibe_to_hŸ∂ug_°©us
(
h™dÀ
,

1118 
e
[0],

1119 
tokí
);

1120 i‡(
rc
 != 0)

1122 
subs¸ibed
 = 1;

1124 
rc
 = 
	`£À˘
(
fd
+1, &
ªadfds
, 
NULL
, NULL, &
tv
);

1126 
f
 = 
	`xs_ªad_w©ch
(
h™dÀ
, &
ƒ
);

1127 
˘r
++;

1128 
	`‰ì
(
f
);

1129 i‡(
˘r
 > 2)

1130 
íd
 = 1;

1132 } 
íd
 == 0);

1133 
	`‰ì
(
e
);

1135 i‡(
subs¸ibed
) {

1137 
	`xí°‹e_unsubs¸ibe_‰om_hŸ∂ug_°©us
(
h™dÀ
,

1139 
e
[0],

1140 
tokí
);

1142 
	`xs_d´m⁄_˛o£
(
h™dÀ
);

1144 i‡(
numbî
 =
VTPM_BAD_INSTANCE
)

1145 
	`Ârötf
(
logfûe
, "no valid vtpm instance");

1147 
	`Ârötf
(
logfûe
,"vçm in°™˚:%d\n",
numbî
);

1148  
numbî
;

1149 
	}
}

	@unin_pci.c

24 
	~"vl.h
"

25 
èrgë_phys_addr_t
 
	tpci_addr_t
;

26 
	~"pci_ho°.h
"

28 
PCIHo°Sèã
 
	tUNINSèã
;

30 
	$pci_unö_maö_c⁄fig_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

31 
uöt32_t
 
vÆ
)

33 
UNINSèã
 *
s
 = 
›aque
;

34 
i
;

36 #ifde‡
TARGET_WORDS_BIGENDIAN


37 
vÆ
 = 
	`bsw≠32
(val);

40 
i
 = 11; i < 32; i++) {

41 i‡((
vÆ
 & (1 << 
i
)) != 0)

45 
s
->
c⁄fig_ªg
 = 0x80000000 | (1 << 16Ë| (
vÆ
 & 0x7FCË| (
i
 << 11);

47 
s
->
c⁄fig_ªg
 = 0x80000000 | (0 << 16Ë| (
vÆ
 & 0x7FCË| (
i
 << 11);

49 
	}
}

51 
uöt32_t
 
	$pci_unö_maö_c⁄fig_ªadl
 (*
›aque
,

52 
èrgë_phys_addr_t
 
addr
)

54 
UNINSèã
 *
s
 = 
›aque
;

55 
uöt32_t
 
vÆ
;

56 
dev‚
;

58 
dev‚
 = (
s
->
c⁄fig_ªg
 >> 8) & 0xFF;

59 
vÆ
 = (1 << (
dev‚
 >> 3)Ë| ((dev‚ & 0x07Ë<< 8Ë| (
s
->
c⁄fig_ªg
 & 0xFC);

60 #ifde‡
TARGET_WORDS_BIGENDIAN


61 
vÆ
 = 
	`bsw≠32
(val);

64  
vÆ
;

65 
	}
}

67 
CPUWrôeMem‹yFunc
 *
	gpci_unö_maö_c⁄fig_wrôe
[] = {

68 &
pci_unö_maö_c⁄fig_wrôñ
,

69 &
pci_unö_maö_c⁄fig_wrôñ
,

70 &
pci_unö_maö_c⁄fig_wrôñ
,

73 
CPURódMem‹yFunc
 *
	gpci_unö_maö_c⁄fig_ªad
[] = {

74 &
pci_unö_maö_c⁄fig_ªadl
,

75 &
pci_unö_maö_c⁄fig_ªadl
,

76 &
pci_unö_maö_c⁄fig_ªadl
,

79 
CPUWrôeMem‹yFunc
 *
	gpci_unö_maö_wrôe
[] = {

80 &
pci_ho°_d©a_wrôeb
,

81 &
pci_ho°_d©a_wrôew
,

82 &
pci_ho°_d©a_wrôñ
,

85 
CPURódMem‹yFunc
 *
	gpci_unö_maö_ªad
[] = {

86 &
pci_ho°_d©a_ªadb
,

87 &
pci_ho°_d©a_ªadw
,

88 &
pci_ho°_d©a_ªadl
,

93 
	$pci_unö_c⁄fig_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

94 
uöt32_t
 
vÆ
)

96 
UNINSèã
 *
s
 = 
›aque
;

98 #ifde‡
TARGET_WORDS_BIGENDIAN


99 
vÆ
 = 
	`bsw≠32
(val);

101 
s
->
c⁄fig_ªg
 = 0x80000000 | (
vÆ
 & ~0x00000001);

102 
	}
}

104 
uöt32_t
 
	$pci_unö_c⁄fig_ªadl
 (*
›aque
,

105 
èrgë_phys_addr_t
 
addr
)

107 
UNINSèã
 *
s
 = 
›aque
;

108 
uöt32_t
 
vÆ
;

110 
vÆ
 = (
s
->
c⁄fig_ªg
 | 0x00000001) & ~0x80000000;

111 #ifde‡
TARGET_WORDS_BIGENDIAN


112 
vÆ
 = 
	`bsw≠32
(val);

115  
vÆ
;

116 
	}
}

118 
CPUWrôeMem‹yFunc
 *
	gpci_unö_c⁄fig_wrôe
[] = {

119 &
pci_unö_c⁄fig_wrôñ
,

120 &
pci_unö_c⁄fig_wrôñ
,

121 &
pci_unö_c⁄fig_wrôñ
,

124 
CPURódMem‹yFunc
 *
	gpci_unö_c⁄fig_ªad
[] = {

125 &
pci_unö_c⁄fig_ªadl
,

126 &
pci_unö_c⁄fig_ªadl
,

127 &
pci_unö_c⁄fig_ªadl
,

130 
CPUWrôeMem‹yFunc
 *
	gpci_unö_wrôe
[] = {

131 &
pci_ho°_pci_wrôeb
,

132 &
pci_ho°_pci_wrôew
,

133 &
pci_ho°_pci_wrôñ
,

136 
CPURódMem‹yFunc
 *
	gpci_unö_ªad
[] = {

137 &
pci_ho°_pci_ªadb
,

138 &
pci_ho°_pci_ªadw
,

139 &
pci_ho°_pci_ªadl
,

144 
	$pci_unö_m≠_úq
(
PCIDevi˚
 *
pci_dev
, 
úq_num
)

146  (
úq_num
 + (
pci_dev
->
dev‚
 >> 3)) & 3;

147 
	}
}

149 
	$pci_unö_£t_úq
(*
pic
, 
úq_num
, 
Àvñ
)

151 
	`›ípic_£t_úq
(
pic
, 
úq_num
 + 8, 
Àvñ
);

152 
	}
}

154 
PCIBus
 *
	$pci_pmac_öô
(*
pic
)

156 
UNINSèã
 *
s
;

157 
PCIDevi˚
 *
d
;

158 
pci_mem_c⁄fig
, 
pci_mem_d©a
;

162 
s
 = 
	`qemu_mÆlocz
((
UNINSèã
));

163 
s
->
bus
 = 
	`pci_ªgi°î_bus
(
pci_unö_£t_úq
, 
pci_unö_m≠_úq
,

164 
pic
, 11 << 3, 4);

166 
pci_mem_c⁄fig
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_unö_maö_c⁄fig_ªad
,

167 
pci_unö_maö_c⁄fig_wrôe
, 
s
);

168 
pci_mem_d©a
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_unö_maö_ªad
,

169 
pci_unö_maö_wrôe
, 
s
);

170 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xf2800000, 0x1000, 
pci_mem_c⁄fig
);

171 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xf2c00000, 0x1000, 
pci_mem_d©a
);

172 
d
 = 
	`pci_ªgi°î_devi˚
(
s
->
bus
, "Uni-n‹th maö", (
PCIDevi˚
),

173 11 << 3, 
NULL
, NULL);

174 
d
->
c⁄fig
[0x00] = 0x6b;

175 
d
->
c⁄fig
[0x01] = 0x10;

176 
d
->
c⁄fig
[0x02] = 0x1F;

177 
d
->
c⁄fig
[0x03] = 0x00;

178 
d
->
c⁄fig
[0x08] = 0x00;

179 
d
->
c⁄fig
[0x0A] = 0x00;

180 
d
->
c⁄fig
[0x0B] = 0x06;

181 
d
->
c⁄fig
[0x0C] = 0x08;

182 
d
->
c⁄fig
[0x0D] = 0x10;

183 
d
->
c⁄fig
[0x0E] = 0x00;

184 
d
->
c⁄fig
[0x34] = 0x00;

188 
d
 = 
	`pci_ªgi°î_devi˚
("Uni-n‹th bridge", (
PCIDevi˚
), 0, 13 << 3,

189 
NULL
, NULL);

190 
d
->
c⁄fig
[0x00] = 0x11;

191 
d
->
c⁄fig
[0x01] = 0x10;

192 
d
->
c⁄fig
[0x02] = 0x26;

193 
d
->
c⁄fig
[0x03] = 0x00;

194 
d
->
c⁄fig
[0x08] = 0x05;

195 
d
->
c⁄fig
[0x0A] = 0x04;

196 
d
->
c⁄fig
[0x0B] = 0x06;

197 
d
->
c⁄fig
[0x0C] = 0x08;

198 
d
->
c⁄fig
[0x0D] = 0x20;

199 
d
->
c⁄fig
[0x0E] = 0x01;

201 
d
->
c⁄fig
[0x18] = 0x01;

202 
d
->
c⁄fig
[0x19] = 0x02;

203 
d
->
c⁄fig
[0x1A] = 0x02;

204 
d
->
c⁄fig
[0x1B] = 0x20;

205 
d
->
c⁄fig
[0x1C] = 0x11;

206 
d
->
c⁄fig
[0x1D] = 0x01;

207 
d
->
c⁄fig
[0x20] = 0x00;

208 
d
->
c⁄fig
[0x21] = 0x80;

209 
d
->
c⁄fig
[0x22] = 0x00;

210 
d
->
c⁄fig
[0x23] = 0x80;

211 
d
->
c⁄fig
[0x24] = 0x01;

212 
d
->
c⁄fig
[0x25] = 0x80;

213 
d
->
c⁄fig
[0x26] = 0xF1;

214 
d
->
c⁄fig
[0x27] = 0x7F;

219 
s
 = &
pci_bridge
[1];

220 
pci_mem_c⁄fig
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_unö_c⁄fig_ªad
,

221 
pci_unö_c⁄fig_wrôe
, 
s
);

222 
pci_mem_d©a
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_unö_ªad
,

223 
pci_unö_wrôe
, 
s
);

224 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xf0800000, 0x1000, 
pci_mem_c⁄fig
);

225 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xf0c00000, 0x1000, 
pci_mem_d©a
);

227 
d
 = 
	`pci_ªgi°î_devi˚
("Uni-n‹th AGP", (
PCIDevi˚
), 0, 11 << 3,

228 
NULL
, NULL);

229 
d
->
c⁄fig
[0x00] = 0x6b;

230 
d
->
c⁄fig
[0x01] = 0x10;

231 
d
->
c⁄fig
[0x02] = 0x20;

232 
d
->
c⁄fig
[0x03] = 0x00;

233 
d
->
c⁄fig
[0x08] = 0x00;

234 
d
->
c⁄fig
[0x0A] = 0x00;

235 
d
->
c⁄fig
[0x0B] = 0x06;

236 
d
->
c⁄fig
[0x0C] = 0x08;

237 
d
->
c⁄fig
[0x0D] = 0x10;

238 
d
->
c⁄fig
[0x0E] = 0x00;

244 
s
 = &
pci_bridge
[2];

245 
pci_mem_c⁄fig
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_unö_c⁄fig_ªad
,

246 
pci_unö_c⁄fig_wrôe
, 
s
);

247 
pci_mem_d©a
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_unö_ªad
,

248 
pci_unö_wrôe
, 
s
);

249 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xf4800000, 0x1000, 
pci_mem_c⁄fig
);

250 
	`˝u_ªgi°î_physiˇl_mem‹y
(0xf4c00000, 0x1000, 
pci_mem_d©a
);

252 
d
 = 
	`pci_ªgi°î_devi˚
("Uni-n‹th i¡î«l", (
PCIDevi˚
),

253 3, 11 << 3, 
NULL
, NULL);

254 
d
->
c⁄fig
[0x00] = 0x6b;

255 
d
->
c⁄fig
[0x01] = 0x10;

256 
d
->
c⁄fig
[0x02] = 0x1E;

257 
d
->
c⁄fig
[0x03] = 0x00;

258 
d
->
c⁄fig
[0x08] = 0x00;

259 
d
->
c⁄fig
[0x0A] = 0x00;

260 
d
->
c⁄fig
[0x0B] = 0x06;

261 
d
->
c⁄fig
[0x0C] = 0x08;

262 
d
->
c⁄fig
[0x0D] = 0x10;

263 
d
->
c⁄fig
[0x0E] = 0x00;

264 
d
->
c⁄fig
[0x34] = 0x00;

266  
s
->
bus
;

267 
	}
}

	@usb-hid.c

24 
	~"vl.h
"

27 
	#GET_REPORT
 0xa101

	)

28 
	#GET_IDLE
 0xa102

	)

29 
	#GET_PROTOCOL
 0xa103

	)

30 
	#SET_IDLE
 0x210a

	)

31 
	#SET_PROTOCOL
 0x210b

	)

33 
	#USB_MOUSE
 1

	)

34 
	#USB_TABLET
 2

	)

36 
	sUSBMou£Sèã
 {

37 
USBDevi˚
 
	mdev
;

38 
	mdx
, 
	mdy
, 
	mdz
, 
	mbuâ⁄s_°©e
;

39 
	mx
, 
	my
;

40 
	mköd
;

41 
	mmou£_gøbbed
;

42 
	m°©us_ch™ged
;

43 
QEMUPutMou£E¡ry
 *
	meh_íåy
;

44 } 
	tUSBMou£Sèã
;

47 c⁄° 
uöt8_t
 
	gqemu_mou£_dev_des¸ùt‹
[] = {

67 c⁄° 
uöt8_t
 
	gqemu_mou£_c⁄fig_des¸ùt‹
[] = {

122 c⁄° 
uöt8_t
 
	gqemu_èbÀt_c⁄fig_des¸ùt‹
[] = {

177 c⁄° 
uöt8_t
 
	gqemu_mou£_hid_ªp‹t_des¸ùt‹
[] = {

187 c⁄° 
uöt8_t
 
	gqemu_èbÀt_hid_ªp‹t_des¸ùt‹
[] = {

227 
	gcuºítbuâ⁄
 = 0;

228 
	s_mou£˛ick
 {

229 
	mbuâ⁄_°©e
;

230 
_mou£˛ick
 *
	m√xt
;

231 } 
	tmou£˛ick
;

232 
mou£˛ick
 
	gmou£queue
[20];

233 
mou£˛ick
 *
	ghód
 = 
mou£queue
;

234 
mou£˛ick
 *
	gèû
 = 
mou£queue
;

236 
	$usb_mou£_evít
(*
›aque
,

237 
dx1
, 
dy1
, 
dz1
, 
buâ⁄s_°©e
)

239 
USBMou£Sèã
 *
s
 = 
›aque
;

241 i‡(
s
->
°©us_ch™ged
 == 1){

243 i‡(
buâ⁄s_°©e
 !
cuºítbuâ⁄
 && 
èû
->
√xt
 !
hód
) {

246 
èû
->
buâ⁄_°©e
 = 
buâ⁄s_°©e
;

247 
èû
 =Åaû->
√xt
;

251 
s
->
buâ⁄s_°©e
 = buttons_state;

254 
s
->
dx
 +
dx1
;

255 
s
->
dy
 +
dy1
;

256 
s
->
dz
 +
dz1
;

257 
cuºítbuâ⁄
 = 
buâ⁄s_°©e
;

258 
s
->
°©us_ch™ged
 = 1;

259 
	}
}

261 
	$usb_èbÀt_evít
(*
›aque
,

262 
x
, 
y
, 
dz
, 
buâ⁄s_°©e
)

264 
USBMou£Sèã
 *
s
 = 
›aque
;

266 i‡(
s
->
°©us_ch™ged
 == 1){

268 i‡(
buâ⁄s_°©e
 !
cuºítbuâ⁄
 && 
èû
->
√xt
 !
hód
) {

271 
èû
->
buâ⁄_°©e
 = 
buâ⁄s_°©e
;

272 
èû
 =Åaû->
√xt
;

276 
s
->
buâ⁄s_°©e
 = buttons_state;

279 
s
->
x
 = x;

280 
s
->
y
 = y;

281 
s
->
dz
 += dz;

282 
cuºítbuâ⁄
 = 
buâ⁄s_°©e
;

283 
s
->
°©us_ch™ged
 = 1;

284 
	}
}

286 
ölöe
 
	$öt_˛amp
(
vÆ
, 
vmö
, 
vmax
)

288 i‡(
vÆ
 < 
vmö
)

289  
vmö
;

290 i‡(
vÆ
 > 
vmax
)

291  
vmax
;

293  
vÆ
;

294 
	}
}

296 
	$usb_mou£_pﬁl
(
USBMou£Sèã
 *
s
, 
uöt8_t
 *
buf
, 
Àn
)

298 
dx
, 
dy
, 
dz
, 
b
, 
l
;

300 i‡(!
s
->
mou£_gøbbed
) {

301 
s
->
eh_íåy
 = 
	`qemu_add_mou£_evít_h™dÀr
(
usb_mou£_evít
, s,

303 
s
->
mou£_gøbbed
 = 1;

306 
dx
 = 
	`öt_˛amp
(
s
->dx, -128, 127);

307 
dy
 = 
	`öt_˛amp
(
s
->dy, -128, 127);

308 
dz
 = 
	`öt_˛amp
(
s
->dz, -128, 127);

310 
s
->
dx
 -= dx;

311 
s
->
dy
 -= dy;

312 
s
->
dz
 -= dz;

314 
b
 = 0;

315 i‡(
s
->
buâ⁄s_°©e
 & 
MOUSE_EVENT_LBUTTON
)

316 
b
 |= 0x01;

317 i‡(
s
->
buâ⁄s_°©e
 & 
MOUSE_EVENT_RBUTTON
)

318 
b
 |= 0x02;

319 i‡(
s
->
buâ⁄s_°©e
 & 
MOUSE_EVENT_MBUTTON
)

320 
b
 |= 0x04;

322 
buf
[0] = 
b
;

323 
buf
[1] = 
dx
;

324 
buf
[2] = 
dy
;

325 
l
 = 3;

326 i‡(
Àn
 >= 4) {

327 
buf
[3] = 
dz
;

328 
l
 = 4;

330  
l
;

331 
	}
}

333 
	$usb_èbÀt_pﬁl
(
USBMou£Sèã
 *
s
, 
uöt8_t
 *
buf
, 
Àn
)

335 
dz
, 
b
, 
l
;

337 i‡(!
s
->
mou£_gøbbed
) {

338 
s
->
eh_íåy
 = 
	`qemu_add_mou£_evít_h™dÀr
(
usb_èbÀt_evít
, s,

340 
s
->
mou£_gøbbed
 = 1;

343 
dz
 = 
	`öt_˛amp
(
s
->dz, -128, 127);

344 
s
->
dz
 -= dz;

347 
dz
 = 0 - dz;

348 
b
 = 0;

349 i‡(
s
->
buâ⁄s_°©e
 & 
MOUSE_EVENT_LBUTTON
)

350 
b
 |= 0x01;

351 i‡(
s
->
buâ⁄s_°©e
 & 
MOUSE_EVENT_RBUTTON
)

352 
b
 |= 0x02;

353 i‡(
s
->
buâ⁄s_°©e
 & 
MOUSE_EVENT_MBUTTON
)

354 
b
 |= 0x04;

356 
buf
[0] = 
b
;

357 
buf
[1] = 
s
->
x
 & 0xff;

358 
buf
[2] = 
s
->
x
 >> 8;

359 
buf
[3] = 
s
->
y
 & 0xff;

360 
buf
[4] = 
s
->
y
 >> 8;

361 
buf
[5] = 
dz
;

362 
l
 = 6;

364  
l
;

365 
	}
}

367 
	$usb_mou£_h™dÀ_ª£t
(
USBDevi˚
 *
dev
)

369 
USBMou£Sèã
 *
s
 = (USBMou£Sèã *)
dev
;

371 
s
->
dx
 = 0;

372 
s
->
dy
 = 0;

373 
s
->
dz
 = 0;

374 
s
->
x
 = 0;

375 
s
->
y
 = 0;

376 
s
->
buâ⁄s_°©e
 = 0;

377 
	}
}

379 
	$usb_mou£_h™dÀ_c⁄åﬁ
(
USBDevi˚
 *
dev
, 
ªque°
, 
vÆue
,

380 
ödex
, 
Àngth
, 
uöt8_t
 *
d©a
)

382 
USBMou£Sèã
 *
s
 = (USBMou£Sèã *)
dev
;

383 
ªt
 = 0;

385 
ªque°
) {

386 
Devi˚Reque°
 | 
USB_REQ_GET_STATUS
:

387 
d©a
[0] = (1 << 
USB_DEVICE_SELF_POWERED
) |

388 (
dev
->
ªmŸe_wakeup
 << 
USB_DEVICE_REMOTE_WAKEUP
);

389 
d©a
[1] = 0x00;

390 
ªt
 = 2;

392 
Devi˚OutReque°
 | 
USB_REQ_CLEAR_FEATURE
:

393 i‡(
vÆue
 =
USB_DEVICE_REMOTE_WAKEUP
) {

394 
dev
->
ªmŸe_wakeup
 = 0;

396 
Áû
;

398 
ªt
 = 0;

400 
Devi˚OutReque°
 | 
USB_REQ_SET_FEATURE
:

401 i‡(
vÆue
 =
USB_DEVICE_REMOTE_WAKEUP
) {

402 
dev
->
ªmŸe_wakeup
 = 1;

404 
Áû
;

406 
ªt
 = 0;

408 
Devi˚OutReque°
 | 
USB_REQ_SET_ADDRESS
:

409 
dev
->
addr
 = 
vÆue
;

410 
ªt
 = 0;

412 
Devi˚Reque°
 | 
USB_REQ_GET_DESCRIPTOR
:

413 
vÆue
 >> 8) {

414 
USB_DT_DEVICE
:

415 
	`mem˝y
(
d©a
, 
qemu_mou£_dev_des¸ùt‹
,

416 (
qemu_mou£_dev_des¸ùt‹
));

417 
ªt
 = (
qemu_mou£_dev_des¸ùt‹
);

419 
USB_DT_CONFIG
:

420 i‡(
s
->
köd
 =
USB_MOUSE
) {

421 
	`mem˝y
(
d©a
, 
qemu_mou£_c⁄fig_des¸ùt‹
,

422 (
qemu_mou£_c⁄fig_des¸ùt‹
));

423 
ªt
 = (
qemu_mou£_c⁄fig_des¸ùt‹
);

424 } i‡(
s
->
köd
 =
USB_TABLET
) {

425 
	`mem˝y
(
d©a
, 
qemu_èbÀt_c⁄fig_des¸ùt‹
,

426 (
qemu_èbÀt_c⁄fig_des¸ùt‹
));

427 
ªt
 = (
qemu_èbÀt_c⁄fig_des¸ùt‹
);

430 
USB_DT_STRING
:

431 
vÆue
 & 0xff) {

434 
d©a
[0] = 4;

435 
d©a
[1] = 3;

436 
d©a
[2] = 0x09;

437 
d©a
[3] = 0x04;

438 
ªt
 = 4;

442 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "1");

446 i‡(
s
->
köd
 =
USB_MOUSE
)

447 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "QEMU USB Mouse");

448 i‡(
s
->
köd
 =
USB_TABLET
)

449 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "QEMU USB Tablet");

453 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "QEMU " 
QEMU_VERSION
);

456 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "HID Mouse");

459 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "Endpoint1 Interrupt Pipe");

462 
Áû
;

466 
Áû
;

469 
Devi˚Reque°
 | 
USB_REQ_GET_CONFIGURATION
:

470 
d©a
[0] = 1;

471 
ªt
 = 1;

473 
Devi˚OutReque°
 | 
USB_REQ_SET_CONFIGURATION
:

474 
ªt
 = 0;

476 
Devi˚Reque°
 | 
USB_REQ_GET_INTERFACE
:

477 
d©a
[0] = 0;

478 
ªt
 = 1;

480 
Devi˚OutReque°
 | 
USB_REQ_SET_INTERFACE
:

481 
ªt
 = 0;

484 
I¡îÁ˚Reque°
 | 
USB_REQ_GET_DESCRIPTOR
:

485 
vÆue
 >> 8) {

487 i‡(
s
->
köd
 =
USB_MOUSE
) {

488 
	`mem˝y
(
d©a
, 
qemu_mou£_hid_ªp‹t_des¸ùt‹
,

489 (
qemu_mou£_hid_ªp‹t_des¸ùt‹
));

490 
ªt
 = (
qemu_mou£_hid_ªp‹t_des¸ùt‹
);

491 } i‡(
s
->
köd
 =
USB_TABLET
) {

492 
	`mem˝y
(
d©a
, 
qemu_èbÀt_hid_ªp‹t_des¸ùt‹
,

493 (
qemu_èbÀt_hid_ªp‹t_des¸ùt‹
));

494 
ªt
 = (
qemu_èbÀt_hid_ªp‹t_des¸ùt‹
);

498 
Áû
;

501 
GET_REPORT
:

502 i‡(
s
->
köd
 =
USB_MOUSE
)

503 
ªt
 = 
	`usb_mou£_pﬁl
(
s
, 
d©a
, 
Àngth
);

504 i‡(
s
->
köd
 =
USB_TABLET
)

505 
ªt
 = 
	`usb_èbÀt_pﬁl
(
s
, 
d©a
, 
Àngth
);

507 
SET_IDLE
:

508 
ªt
 = 0;

511 
Áû
:

512 
ªt
 = 
USB_RET_STALL
;

515  
ªt
;

516 
	}
}

518 
	$usb_mou£_h™dÀ_d©a
(
USBDevi˚
 *
dev
, 
USBPackë
 *
p
)

520 
USBMou£Sèã
 *
s
 = (USBMou£Sèã *)
dev
;

521 
ªt
 = 0;

523 
p
->
pid
) {

524 
USB_TOKEN_IN
:

525 i‡(
p
->
devï
 == 1) {

526 i‡(
s
->
köd
 =
USB_MOUSE
)

527 
ªt
 = 
	`usb_mou£_pﬁl
(
s
, 
p
->
d©a
,Ö->
Àn
);

528 i‡(
s
->
köd
 =
USB_TABLET
)

529 
ªt
 = 
	`usb_èbÀt_pﬁl
(
s
, 
p
->
d©a
,Ö->
Àn
);

531 i‡(!
s
->
°©us_ch™ged
) {

532 
ªt
 = 
USB_RET_NAK
;

534 i‡(
hód
 !
èû
) {

535 
s
->
buâ⁄s_°©e
 = 
hód
->
buâ⁄_°©e
;

536 
hód
 = hód->
√xt
;

539 
s
->
°©us_ch™ged
 = 0;

544 
Áû
;

547 
USB_TOKEN_OUT
:

549 
Áû
:

550 
ªt
 = 
USB_RET_STALL
;

553  
ªt
;

554 
	}
}

556 
	$usb_mou£_h™dÀ_de°roy
(
USBDevi˚
 *
dev
)

558 
USBMou£Sèã
 *
s
 = (USBMou£Sèã *)
dev
;

560 
	`qemu_ªmove_mou£_evít_h™dÀr
(
s
->
eh_íåy
);

561 
	`qemu_‰ì
(
s
);

562 
	}
}

564 
	$usb_mou£_ßve
(
QEMUFûe
 *
f
, *
›aque
)

566 
USBMou£Sèã
 *
s
 = (USBMou£Sèã*)
›aque
;

568 
	`qemu_put_be32s
(
f
, &
s
->
dx
);

569 
	`qemu_put_be32s
(
f
, &
s
->
dy
);

570 
	`qemu_put_be32s
(
f
, &
s
->
dz
);

571 
	`qemu_put_be32s
(
f
, &
s
->
buâ⁄s_°©e
);

572 
	`qemu_put_be32s
(
f
, &
s
->
x
);

573 
	`qemu_put_be32s
(
f
, &
s
->
y
);

574 
	`qemu_put_be32s
(
f
, &
s
->
köd
);

575 
	`qemu_put_be32s
(
f
, &
s
->
mou£_gøbbed
);

576 
	`qemu_put_be32s
(
f
, &
s
->
°©us_ch™ged
);

578 
	}
}

580 
	$usb_mou£_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

582 
USBMou£Sèã
 *
s
 = (USBMou£Sèã*)
›aque
;

584 i‡(
vîsi⁄_id
 != 1)

585  -
EINVAL
;

587 
	`qemu_gë_be32s
(
f
, &
s
->
dx
);

588 
	`qemu_gë_be32s
(
f
, &
s
->
dy
);

589 
	`qemu_gë_be32s
(
f
, &
s
->
dz
);

590 
	`qemu_gë_be32s
(
f
, &
s
->
buâ⁄s_°©e
);

591 
	`qemu_gë_be32s
(
f
, &
s
->
x
);

592 
	`qemu_gë_be32s
(
f
, &
s
->
y
);

593 
	`qemu_gë_be32s
(
f
, &
s
->
köd
);

594 
	`qemu_gë_be32s
(
f
, &
s
->
mou£_gøbbed
);

595 
	`qemu_gë_be32s
(
f
, &
s
->
°©us_ch™ged
);

597 i‡–
s
->
köd
 =
USB_TABLET
) {

598 
	`Ârötf
(
logfûe
, "usb_mouse_load:add usb_tablet_event.\n");

599 
	`qemu_add_mou£_evít_h™dÀr
(
usb_èbÀt_evít
, 
s
, 1, "QEMU USB Tablet");

600 } i‡–
s
->
köd
 =
USB_MOUSE
) {

601 
	`Ârötf
(
logfûe
, "usb_mouse_load:add usb_mouse_event.\n");

602 
	`qemu_add_mou£_evít_h™dÀr
(
usb_mou£_evít
, 
s
, 0, "QEMU USB MOUSE");

606 
	}
}

609 
USBDevi˚
 *
	$usb_èbÀt_öô
()

611 
USBMou£Sèã
 *
s
;

612 
i
;

614 
i
 = 0; i < 19; i++) {

615 
mou£queue
[
i
].
buâ⁄_°©e
 = 0;

616 
mou£queue
[
i
].
√xt
 = &(mousequeue[i + 1]);

618 
mou£queue
[
i
].
buâ⁄_°©e
 = 0;

619 
mou£queue
[
i
].
√xt
 = mousequeue;

621 
s
 = 
	`qemu_mÆlocz
((
USBMou£Sèã
));

622 i‡(!
s
)

623  
NULL
;

624 
s
->
dev
.
•ìd
 = 
USB_SPEED_FULL
;

625 
s
->
dev
.
h™dÀ_∑ckë
 = 
usb_gíîic_h™dÀ_∑ckë
;

627 
s
->
dev
.
h™dÀ_ª£t
 = 
usb_mou£_h™dÀ_ª£t
;

628 
s
->
dev
.
h™dÀ_c⁄åﬁ
 = 
usb_mou£_h™dÀ_c⁄åﬁ
;

629 
s
->
dev
.
h™dÀ_d©a
 = 
usb_mou£_h™dÀ_d©a
;

630 
s
->
dev
.
h™dÀ_de°roy
 = 
usb_mou£_h™dÀ_de°roy
;

631 
s
->
köd
 = 
USB_TABLET
;

632 
s
->
°©us_ch™ged
 = 0;

634 
	`p°r˝y
(
s
->
dev
.
dev«me
, (s->dev.devname), "QEMU USB Tablet");

636 
	`ªgi°î_ßvevm
("USBÅabÀàdev", 0, 1, 
usb_mou£_ßve
, 
usb_mou£_lﬂd
, 
s
);

638  (
USBDevi˚
 *)
s
;

639 
	}
}

641 
USBDevi˚
 *
	$usb_mou£_öô
()

643 
USBMou£Sèã
 *
s
;

644 
i
;

646 
i
 = 0; i < 19; i++) {

647 
mou£queue
[
i
].
buâ⁄_°©e
 = 0;

648 
mou£queue
[
i
].
√xt
 = &(mousequeue[i + 1]);

650 
mou£queue
[
i
].
buâ⁄_°©e
 = 0;

651 
mou£queue
[
i
].
√xt
 = mousequeue;

653 
s
 = 
	`qemu_mÆlocz
((
USBMou£Sèã
));

654 i‡(!
s
)

655  
NULL
;

656 
s
->
dev
.
•ìd
 = 
USB_SPEED_FULL
;

657 
s
->
dev
.
h™dÀ_∑ckë
 = 
usb_gíîic_h™dÀ_∑ckë
;

659 
s
->
dev
.
h™dÀ_ª£t
 = 
usb_mou£_h™dÀ_ª£t
;

660 
s
->
dev
.
h™dÀ_c⁄åﬁ
 = 
usb_mou£_h™dÀ_c⁄åﬁ
;

661 
s
->
dev
.
h™dÀ_d©a
 = 
usb_mou£_h™dÀ_d©a
;

662 
s
->
dev
.
h™dÀ_de°roy
 = 
usb_mou£_h™dÀ_de°roy
;

663 
s
->
köd
 = 
USB_MOUSE
;

664 
s
->
°©us_ch™ged
 = 0;

666 
	`p°r˝y
(
s
->
dev
.
dev«me
, (s->dev.devname), "QEMU USB Mouse");

668 
	`ªgi°î_ßvevm
("USB mou£ dev", 0, 1, 
usb_mou£_ßve
, 
usb_mou£_lﬂd
, 
s
);

670  (
USBDevi˚
 *)
s
;

671 
	}
}

	@usb-hub.c

24 
	~"vl.h
"

28 
	#MAX_PORTS
 8

	)

30 
	sUSBHubP‹t
 {

31 
USBP‹t
 
	mp‹t
;

32 
uöt16_t
 
	mwP‹tSètus
;

33 
uöt16_t
 
	mwP‹tCh™ge
;

34 } 
	tUSBHubP‹t
;

36 
	sUSBHubSèã
 {

37 
USBDevi˚
 
	mdev
;

38 
	mnb_p‹ts
;

39 
USBHubP‹t
 
	mp‹ts
[
MAX_PORTS
];

40 } 
	tUSBHubSèã
;

42 
	#CÀ¨HubFótuª
 (0x2000 | 
USB_REQ_CLEAR_FEATURE
)

	)

43 
	#CÀ¨P‹tFótuª
 (0x2300 | 
USB_REQ_CLEAR_FEATURE
)

	)

44 
	#GëHubDes¸ùt‹
 (0xa000 | 
USB_REQ_GET_DESCRIPTOR
)

	)

45 
	#GëHubSètus
 (0xa000 | 
USB_REQ_GET_STATUS
)

	)

46 
	#GëP‹tSètus
 (0xa300 | 
USB_REQ_GET_STATUS
)

	)

47 
	#SëHubFótuª
 (0x2000 | 
USB_REQ_SET_FEATURE
)

	)

48 
	#SëP‹tFótuª
 (0x2300 | 
USB_REQ_SET_FEATURE
)

	)

50 
	#PORT_STAT_CONNECTION
 0x0001

	)

51 
	#PORT_STAT_ENABLE
 0x0002

	)

52 
	#PORT_STAT_SUSPEND
 0x0004

	)

53 
	#PORT_STAT_OVERCURRENT
 0x0008

	)

54 
	#PORT_STAT_RESET
 0x0010

	)

55 
	#PORT_STAT_POWER
 0x0100

	)

56 
	#PORT_STAT_LOW_SPEED
 0x0200

	)

57 
	#PORT_STAT_HIGH_SPEED
 0x0400

	)

58 
	#PORT_STAT_TEST
 0x0800

	)

59 
	#PORT_STAT_INDICATOR
 0x1000

	)

61 
	#PORT_STAT_C_CONNECTION
 0x0001

	)

62 
	#PORT_STAT_C_ENABLE
 0x0002

	)

63 
	#PORT_STAT_C_SUSPEND
 0x0004

	)

64 
	#PORT_STAT_C_OVERCURRENT
 0x0008

	)

65 
	#PORT_STAT_C_RESET
 0x0010

	)

67 
	#PORT_CONNECTION
 0

	)

68 
	#PORT_ENABLE
 1

	)

69 
	#PORT_SUSPEND
 2

	)

70 
	#PORT_OVERCURRENT
 3

	)

71 
	#PORT_RESET
 4

	)

72 
	#PORT_POWER
 8

	)

73 
	#PORT_LOWSPEED
 9

	)

74 
	#PORT_HIGHSPEED
 10

	)

75 
	#PORT_C_CONNECTION
 16

	)

76 
	#PORT_C_ENABLE
 17

	)

77 
	#PORT_C_SUSPEND
 18

	)

78 
	#PORT_C_OVERCURRENT
 19

	)

79 
	#PORT_C_RESET
 20

	)

80 
	#PORT_TEST
 21

	)

81 
	#PORT_INDICATOR
 22

	)

85 c⁄° 
uöt8_t
 
	gqemu_hub_dev_des¸ùt‹
[] = {

106 c⁄° 
uöt8_t
 
	gqemu_hub_c⁄fig_des¸ùt‹
[] = {

153 c⁄° 
uöt8_t
 
	gqemu_hub_hub_des¸ùt‹
[] =

166 
	$usb_hub_©èch
(
USBP‹t
 *
p‹t1
, 
USBDevi˚
 *
dev
)

168 
USBHubSèã
 *
s
 = 
p‹t1
->
›aque
;

169 
USBHubP‹t
 *
p‹t
 = &
s
->
p‹ts
[
p‹t1
->
ödex
];

171 i‡(
dev
) {

172 i‡(
p‹t
->p‹t.
dev
)

173 
	`usb_©èch
(
p‹t1
, 
NULL
);

175 
p‹t
->
wP‹tSètus
 |
PORT_STAT_CONNECTION
;

176 
p‹t
->
wP‹tCh™ge
 |
PORT_STAT_C_CONNECTION
;

177 i‡(
dev
->
•ìd
 =
USB_SPEED_LOW
)

178 
p‹t
->
wP‹tSètus
 |
PORT_STAT_LOW_SPEED
;

180 
p‹t
->
wP‹tSètus
 &~
PORT_STAT_LOW_SPEED
;

181 
p‹t
->p‹t.
dev
 = dev;

183 
	`usb_£nd_msg
(
dev
, 
USB_MSG_ATTACH
);

185 
dev
 = 
p‹t
->port.dev;

186 i‡(
dev
) {

187 
p‹t
->
wP‹tSètus
 &~
PORT_STAT_CONNECTION
;

188 
p‹t
->
wP‹tCh™ge
 |
PORT_STAT_C_CONNECTION
;

189 i‡(
p‹t
->
wP‹tSètus
 & 
PORT_STAT_ENABLE
) {

190 
p‹t
->
wP‹tSètus
 &~
PORT_STAT_ENABLE
;

191 
p‹t
->
wP‹tCh™ge
 |
PORT_STAT_C_ENABLE
;

194 
	`usb_£nd_msg
(
dev
, 
USB_MSG_DETACH
);

195 
p‹t
->p‹t.
dev
 = 
NULL
;

198 
	}
}

200 
	$usb_hub_h™dÀ_ª£t
(
USBDevi˚
 *
dev
)

203 
	}
}

205 
	$usb_hub_h™dÀ_c⁄åﬁ
(
USBDevi˚
 *
dev
, 
ªque°
, 
vÆue
,

206 
ödex
, 
Àngth
, 
uöt8_t
 *
d©a
)

208 
USBHubSèã
 *
s
 = (USBHubSèã *)
dev
;

209 
ªt
;

211 
ªque°
) {

212 
Devi˚Reque°
 | 
USB_REQ_GET_STATUS
:

213 
d©a
[0] = (1 << 
USB_DEVICE_SELF_POWERED
) |

214 (
dev
->
ªmŸe_wakeup
 << 
USB_DEVICE_REMOTE_WAKEUP
);

215 
d©a
[1] = 0x00;

216 
ªt
 = 2;

218 
Devi˚OutReque°
 | 
USB_REQ_CLEAR_FEATURE
:

219 i‡(
vÆue
 =
USB_DEVICE_REMOTE_WAKEUP
) {

220 
dev
->
ªmŸe_wakeup
 = 0;

222 
Áû
;

224 
ªt
 = 0;

226 
EndpoötOutReque°
 | 
USB_REQ_CLEAR_FEATURE
:

227 i‡(
vÆue
 =0 && 
ödex
 != 0x81) {

228 
Áû
;

230 
ªt
 = 0;

232 
Devi˚OutReque°
 | 
USB_REQ_SET_FEATURE
:

233 i‡(
vÆue
 =
USB_DEVICE_REMOTE_WAKEUP
) {

234 
dev
->
ªmŸe_wakeup
 = 1;

236 
Áû
;

238 
ªt
 = 0;

240 
Devi˚OutReque°
 | 
USB_REQ_SET_ADDRESS
:

241 
dev
->
addr
 = 
vÆue
;

242 
ªt
 = 0;

244 
Devi˚Reque°
 | 
USB_REQ_GET_DESCRIPTOR
:

245 
vÆue
 >> 8) {

246 
USB_DT_DEVICE
:

247 
	`mem˝y
(
d©a
, 
qemu_hub_dev_des¸ùt‹
,

248 (
qemu_hub_dev_des¸ùt‹
));

249 
ªt
 = (
qemu_hub_dev_des¸ùt‹
);

251 
USB_DT_CONFIG
:

252 
	`mem˝y
(
d©a
, 
qemu_hub_c⁄fig_des¸ùt‹
,

253 (
qemu_hub_c⁄fig_des¸ùt‹
));

257 
d©a
[22] = (
s
->
nb_p‹ts
 + 1 + 7) / 8;

259 
ªt
 = (
qemu_hub_c⁄fig_des¸ùt‹
);

261 
USB_DT_STRING
:

262 
vÆue
 & 0xff) {

265 
d©a
[0] = 4;

266 
d©a
[1] = 3;

267 
d©a
[2] = 0x09;

268 
d©a
[3] = 0x04;

269 
ªt
 = 4;

273 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "314159");

277 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "QEMU USB Hub");

281 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "QEMU " 
QEMU_VERSION
);

284 
Áû
;

288 
Áû
;

291 
Devi˚Reque°
 | 
USB_REQ_GET_CONFIGURATION
:

292 
d©a
[0] = 1;

293 
ªt
 = 1;

295 
Devi˚OutReque°
 | 
USB_REQ_SET_CONFIGURATION
:

296 
ªt
 = 0;

298 
Devi˚Reque°
 | 
USB_REQ_GET_INTERFACE
:

299 
d©a
[0] = 0;

300 
ªt
 = 1;

302 
Devi˚OutReque°
 | 
USB_REQ_SET_INTERFACE
:

303 
ªt
 = 0;

306 
GëHubSètus
:

307 
d©a
[0] = 0;

308 
d©a
[1] = 0;

309 
d©a
[2] = 0;

310 
d©a
[3] = 0;

311 
ªt
 = 4;

313 
GëP‹tSètus
:

315 
n
 = 
ödex
 - 1;

316 
USBHubP‹t
 *
p‹t
;

317 i‡(
n
 >
s
->
nb_p‹ts
)

318 
Áû
;

319 
p‹t
 = &
s
->
p‹ts
[
n
];

320 
d©a
[0] = 
p‹t
->
wP‹tSètus
;

321 
d©a
[1] = 
p‹t
->
wP‹tSètus
 >> 8;

322 
d©a
[2] = 
p‹t
->
wP‹tCh™ge
;

323 
d©a
[3] = 
p‹t
->
wP‹tCh™ge
 >> 8;

324 
ªt
 = 4;

327 
SëHubFótuª
:

328 
CÀ¨HubFótuª
:

329 i‡(
vÆue
 == 0 || value == 1) {

331 
Áû
;

333 
ªt
 = 0;

335 
SëP‹tFótuª
:

337 
n
 = 
ödex
 - 1;

338 
USBHubP‹t
 *
p‹t
;

339 
USBDevi˚
 *
dev
;

340 i‡(
n
 >
s
->
nb_p‹ts
)

341 
Áû
;

342 
p‹t
 = &
s
->
p‹ts
[
n
];

343 
dev
 = 
p‹t
->port.dev;

344 
vÆue
) {

345 
PORT_SUSPEND
:

346 
p‹t
->
wP‹tSètus
 |
PORT_STAT_SUSPEND
;

348 
PORT_RESET
:

349 i‡(
dev
) {

350 
	`usb_£nd_msg
(
dev
, 
USB_MSG_RESET
);

351 
p‹t
->
wP‹tCh™ge
 |
PORT_STAT_C_RESET
;

353 
p‹t
->
wP‹tSètus
 |
PORT_STAT_ENABLE
;

356 
PORT_POWER
:

359 
Áû
;

361 
ªt
 = 0;

364 
CÀ¨P‹tFótuª
:

366 
n
 = 
ödex
 - 1;

367 
USBHubP‹t
 *
p‹t
;

368 
USBDevi˚
 *
dev
;

369 i‡(
n
 >
s
->
nb_p‹ts
)

370 
Áû
;

371 
p‹t
 = &
s
->
p‹ts
[
n
];

372 
dev
 = 
p‹t
->port.dev;

373 
vÆue
) {

374 
PORT_ENABLE
:

375 
p‹t
->
wP‹tSètus
 &~
PORT_STAT_ENABLE
;

377 
PORT_C_ENABLE
:

378 
p‹t
->
wP‹tCh™ge
 &~
PORT_STAT_C_ENABLE
;

380 
PORT_SUSPEND
:

381 
p‹t
->
wP‹tSètus
 &~
PORT_STAT_SUSPEND
;

383 
PORT_C_SUSPEND
:

384 
p‹t
->
wP‹tCh™ge
 &~
PORT_STAT_C_SUSPEND
;

386 
PORT_C_CONNECTION
:

387 
p‹t
->
wP‹tCh™ge
 &~
PORT_STAT_C_CONNECTION
;

389 
PORT_C_OVERCURRENT
:

390 
p‹t
->
wP‹tCh™ge
 &~
PORT_STAT_C_OVERCURRENT
;

392 
PORT_C_RESET
:

393 
p‹t
->
wP‹tCh™ge
 &~
PORT_STAT_C_RESET
;

396 
Áû
;

398 
ªt
 = 0;

401 
GëHubDes¸ùt‹
:

403 
n
, 
limô
, 
v¨_hub_size
 = 0;

404 
	`mem˝y
(
d©a
, 
qemu_hub_hub_des¸ùt‹
,

405 (
qemu_hub_hub_des¸ùt‹
));

406 
d©a
[2] = 
s
->
nb_p‹ts
;

409 
limô
 = ((
s
->
nb_p‹ts
 + 1 + 7) / 8) + 7;

410 
n
 = 7;Ç < 
limô
;Ç++) {

411 
d©a
[
n
] = 0x00;

412 
v¨_hub_size
++;

416 
limô
 =Üimô + ((
s
->
nb_p‹ts
 + 7) / 8);

417 ;
n
 < 
limô
;Ç++) {

418 
d©a
[
n
] = 0xff;

419 
v¨_hub_size
++;

422 
ªt
 = (
qemu_hub_hub_des¸ùt‹
Ë+ 
v¨_hub_size
;

423 
d©a
[0] = 
ªt
;

427 
Áû
:

428 
ªt
 = 
USB_RET_STALL
;

431  
ªt
;

432 
	}
}

434 
	$usb_hub_h™dÀ_d©a
(
USBDevi˚
 *
dev
, 
USBPackë
 *
p
)

436 
USBHubSèã
 *
s
 = (USBHubSèã *)
dev
;

437 
ªt
;

439 
p
->
pid
) {

440 
USB_TOKEN_IN
:

441 i‡(
p
->
devï
 == 1) {

442 
USBHubP‹t
 *
p‹t
;

443 
°©us
;

444 
i
, 
n
;

445 
n
 = (
s
->
nb_p‹ts
 + 1 + 7) / 8;

446 i‡(
p
->
Àn
 == 1) {

447 
n
 = 1;

448 } i‡(
n
 > 
p
->
Àn
) {

449  
USB_RET_BABBLE
;

451 
°©us
 = 0;

452 
i
 = 0; i < 
s
->
nb_p‹ts
; i++) {

453 
p‹t
 = &
s
->
p‹ts
[
i
];

454 i‡(
p‹t
->
wP‹tCh™ge
)

455 
°©us
 |(1 << (
i
 + 1));

457 i‡(
°©us
 != 0) {

458 
i
 = 0; i < 
n
; i++) {

459 
p
->
d©a
[
i
] = 
°©us
 >> (8 * i);

461 
ªt
 = 
n
;

463 
ªt
 = 
USB_RET_NAK
;

466 
Áû
;

469 
USB_TOKEN_OUT
:

471 
Áû
:

472 
ªt
 = 
USB_RET_STALL
;

475  
ªt
;

476 
	}
}

478 
	$usb_hub_brﬂdˇ°_∑ckë
(
USBHubSèã
 *
s
, 
USBPackë
 *
p
)

480 
USBHubP‹t
 *
p‹t
;

481 
USBDevi˚
 *
dev
;

482 
i
, 
ªt
;

484 
i
 = 0; i < 
s
->
nb_p‹ts
; i++) {

485 
p‹t
 = &
s
->
p‹ts
[
i
];

486 
dev
 = 
p‹t
->port.dev;

487 i‡(
dev
 && (
p‹t
->
wP‹tSètus
 & 
PORT_STAT_ENABLE
)) {

488 
ªt
 = 
dev
->
	`h™dÀ_∑ckë
(dev, 
p
);

489 i‡(
ªt
 !
USB_RET_NODEV
) {

490  
ªt
;

494  
USB_RET_NODEV
;

495 
	}
}

497 
	$usb_hub_h™dÀ_∑ckë
(
USBDevi˚
 *
dev
, 
USBPackë
 *
p
)

499 
USBHubSèã
 *
s
 = (USBHubSèã *)
dev
;

501 #i‡
	`deföed
(
DEBUG
) && 0

502 
	`¥ötf
("usb_hub:Öid=0x%x\n", 
pid
);

504 i‡(
dev
->
°©e
 =
USB_STATE_DEFAULT
 &&

505 
dev
->
addr
 != 0 &&

506 
p
->
devaddr
 !
dev
->
addr
 &&

507 (
p
->
pid
 =
USB_TOKEN_SETUP
 ||

508 
p
->
pid
 =
USB_TOKEN_OUT
 ||

509 
p
->
pid
 =
USB_TOKEN_IN
)) {

511  
	`usb_hub_brﬂdˇ°_∑ckë
(
s
, 
p
);

513  
	`usb_gíîic_h™dÀ_∑ckë
(
dev
, 
p
);

514 
	}
}

516 
	$usb_hub_h™dÀ_de°roy
(
USBDevi˚
 *
dev
)

518 
USBHubSèã
 *
s
 = (USBHubSèã *)
dev
;

520 
	`qemu_‰ì
(
s
);

521 
	}
}

523 
USBDevi˚
 *
	$usb_hub_öô
(
nb_p‹ts
)

525 
USBHubSèã
 *
s
;

526 
USBHubP‹t
 *
p‹t
;

527 
i
;

529 i‡(
nb_p‹ts
 > 
MAX_PORTS
)

530  
NULL
;

531 
s
 = 
	`qemu_mÆlocz
((
USBHubSèã
));

532 i‡(!
s
)

533  
NULL
;

534 
s
->
dev
.
•ìd
 = 
USB_SPEED_FULL
;

535 
s
->
dev
.
h™dÀ_∑ckë
 = 
usb_hub_h™dÀ_∑ckë
;

538 
s
->
dev
.
h™dÀ_ª£t
 = 
usb_hub_h™dÀ_ª£t
;

539 
s
->
dev
.
h™dÀ_c⁄åﬁ
 = 
usb_hub_h™dÀ_c⁄åﬁ
;

540 
s
->
dev
.
h™dÀ_d©a
 = 
usb_hub_h™dÀ_d©a
;

541 
s
->
dev
.
h™dÀ_de°roy
 = 
usb_hub_h™dÀ_de°roy
;

543 
	`p°r˝y
(
s
->
dev
.
dev«me
, (s->dev.devname), "QEMU USB Hub");

545 
s
->
nb_p‹ts
 =Çb_ports;

546 
i
 = 0; i < 
s
->
nb_p‹ts
; i++) {

547 
p‹t
 = &
s
->
p‹ts
[
i
];

548 
	`qemu_ªgi°î_usb_p‹t
(&
p‹t
->p‹t, 
s
, 
i
, 
usb_hub_©èch
);

549 
p‹t
->
wP‹tSètus
 = 
PORT_STAT_POWER
;

550 
p‹t
->
wP‹tCh™ge
 = 0;

552  (
USBDevi˚
 *)
s
;

553 
	}
}

	@usb-msd.c

10 
	~"vl.h
"

14 #ifde‡
DEBUG_MSD


15 
	#DPRINTF
(
fmt
, 
¨gs
...) \

16 dÿ{ 
	`¥ötf
("usb-msd: " 
fmt
 , ##
¨gs
); } 0)

	)

18 
	#DPRINTF
(
fmt
, 
¨gs
...Ëdÿ{} 0)

	)

22 
	#MassSt‹ageRe£t
 0xff

	)

23 
	#GëMaxLun
 0x„

	)

25 
	eUSBMSDMode
 {

26 
	mUSB_MSDM_CBW
,

27 
	mUSB_MSDM_DATAOUT
,

28 
	mUSB_MSDM_DATAIN
,

29 
	mUSB_MSDM_CSW


33 
USBDevi˚
 
	mdev
;

34 
USBMSDMode
 
	mmode
;

35 
uöt32_t
 
	mscsi_Àn
;

36 
uöt8_t
 *
	mscsi_buf
;

37 
uöt32_t
 
	musb_Àn
;

38 
uöt8_t
 *
	musb_buf
;

39 
uöt32_t
 
	md©a_Àn
;

40 
uöt32_t
 
	mªsidue
;

41 
uöt32_t
 
	mèg
;

42 
BlockDrivîSèã
 *
	mbs
;

43 
SCSIDevi˚
 *
	mscsi_dev
;

44 
	mªsu…
;

46 
USBPackë
 *
	m∑ckë
;

47 } 
	tMSDSèã
;

49 
	susb_msd_cbw
 {

50 
uöt32_t
 
	msig
;

51 
uöt32_t
 
	mèg
;

52 
uöt32_t
 
	md©a_Àn
;

53 
uöt8_t
 
	mÊags
;

54 
uöt8_t
 
	mlun
;

55 
uöt8_t
 
	mcmd_Àn
;

56 
uöt8_t
 
	mcmd
[16];

59 
	susb_msd_csw
 {

60 
uöt32_t
 
	msig
;

61 
uöt32_t
 
	mèg
;

62 
uöt32_t
 
	mªsidue
;

63 
uöt8_t
 
	m°©us
;

66 c⁄° 
uöt8_t
 
	gqemu_msd_dev_des¸ùt‹
[] = {

87 c⁄° 
uöt8_t
 
	gqemu_msd_c⁄fig_des¸ùt‹
[] = {

131 
	$usb_msd_c›y_d©a
(
MSDSèã
 *
s
)

133 
uöt32_t
 
Àn
;

134 
Àn
 = 
s
->
usb_Àn
;

135 i‡(
Àn
 > 
s
->
scsi_Àn
)

136 
Àn
 = 
s
->
scsi_Àn
;

137 i‡(
s
->
mode
 =
USB_MSDM_DATAIN
) {

138 
	`mem˝y
(
s
->
usb_buf
, s->
scsi_buf
, 
Àn
);

140 
	`mem˝y
(
s
->
scsi_buf
, s->
usb_buf
, 
Àn
);

142 
s
->
usb_Àn
 -
Àn
;

143 
s
->
scsi_Àn
 -
Àn
;

144 
s
->
usb_buf
 +
Àn
;

145 
s
->
scsi_buf
 +
Àn
;

146 
s
->
d©a_Àn
 -
Àn
;

147 i‡(
s
->
scsi_Àn
 == 0) {

148 i‡(
s
->
mode
 =
USB_MSDM_DATAIN
) {

149 
	`scsi_ªad_d©a
(
s
->
scsi_dev
, s->
èg
);

150 } i‡(
s
->
mode
 =
USB_MSDM_DATAOUT
) {

151 
	`scsi_wrôe_d©a
(
s
->
scsi_dev
, s->
èg
);

154 
	}
}

156 
	$usb_msd_£nd_°©us
(
MSDSèã
 *
s
)

158 
usb_msd_csw
 
csw
;

160 
csw
.
sig
 = 
	`˝u_to_À32
(0x53425355);

161 
csw
.
èg
 = 
	`˝u_to_À32
(
s
->tag);

162 
csw
.
ªsidue
 = 
s
->residue;

163 
csw
.
°©us
 = 
s
->
ªsu…
;

164 
	`mem˝y
(
s
->
usb_buf
, &
csw
, 13);

165 
	}
}

167 
	$usb_msd_comm™d_com∂ëe
(*
›aque
, 
ªas⁄
, 
uöt32_t
 
èg
,

168 
uöt32_t
 
¨g
)

170 
MSDSèã
 *
s
 = (MSDSèã *)
›aque
;

171 
USBPackë
 *
p
 = 
s
->
∑ckë
;

173 i‡(
èg
 !
s
->tag) {

174 
	`Ârötf
(
°dîr
, "usb-msd: U√x≥˘ed SCSI Tag 0x%x\n", 
èg
);

176 i‡(
ªas⁄
 =
SCSI_REASON_DONE
) {

177 
	`DPRINTF
("Comm™d com∂ëê%d\n", 
¨g
);

178 
s
->
ªsidue
 = s->
d©a_Àn
;

179 
s
->
ªsu…
 = 
¨g
 != 0;

180 i‡(
s
->
∑ckë
) {

181 i‡(
s
->
d©a_Àn
 =0 && s->
mode
 =
USB_MSDM_DATAOUT
) {

184 
	`usb_msd_£nd_°©us
(
s
);

185 
s
->
mode
 = 
USB_MSDM_CBW
;

187 i‡(
s
->
d©a_Àn
) {

188 
s
->
d©a_Àn
 -s->
usb_Àn
;

189 i‡(
s
->
mode
 =
USB_MSDM_DATAIN
)

190 
	`mem£t
(
s
->
usb_buf
, 0, s->
usb_Àn
);

191 
s
->
usb_Àn
 = 0;

193 i‡(
s
->
d©a_Àn
 == 0)

194 
s
->
mode
 = 
USB_MSDM_CSW
;

196 
s
->
∑ckë
 = 
NULL
;

197 
	`usb_∑ckë_com∂ëe
(
p
);

198 } i‡(
s
->
d©a_Àn
 == 0) {

199 
s
->
mode
 = 
USB_MSDM_CSW
;

203 
s
->
scsi_Àn
 = 
¨g
;

204 
s
->
scsi_buf
 = 
	`scsi_gë_buf
(s->
scsi_dev
, 
èg
);

205 i‡(
p
) {

206 
	`usb_msd_c›y_d©a
(
s
);

207 i‡(
s
->
usb_Àn
 == 0) {

211 
	`DPRINTF
("Packë com∂ëê%p\n", 
p
);

212 
s
->
∑ckë
 = 
NULL
;

213 
	`usb_∑ckë_com∂ëe
(
p
);

216 
	}
}

218 
	$usb_msd_h™dÀ_ª£t
(
USBDevi˚
 *
dev
)

220 
MSDSèã
 *
s
 = (MSDSèã *)
dev
;

222 
	`DPRINTF
("Reset\n");

223 
s
->
mode
 = 
USB_MSDM_CBW
;

224 
	}
}

226 
	$usb_msd_h™dÀ_c⁄åﬁ
(
USBDevi˚
 *
dev
, 
ªque°
, 
vÆue
,

227 
ödex
, 
Àngth
, 
uöt8_t
 *
d©a
)

229 
MSDSèã
 *
s
 = (MSDSèã *)
dev
;

230 
ªt
 = 0;

232 
ªque°
) {

233 
Devi˚Reque°
 | 
USB_REQ_GET_STATUS
:

234 
d©a
[0] = (1 << 
USB_DEVICE_SELF_POWERED
) |

235 (
dev
->
ªmŸe_wakeup
 << 
USB_DEVICE_REMOTE_WAKEUP
);

236 
d©a
[1] = 0x00;

237 
ªt
 = 2;

239 
Devi˚OutReque°
 | 
USB_REQ_CLEAR_FEATURE
:

240 i‡(
vÆue
 =
USB_DEVICE_REMOTE_WAKEUP
) {

241 
dev
->
ªmŸe_wakeup
 = 0;

243 
Áû
;

245 
ªt
 = 0;

247 
Devi˚OutReque°
 | 
USB_REQ_SET_FEATURE
:

248 i‡(
vÆue
 =
USB_DEVICE_REMOTE_WAKEUP
) {

249 
dev
->
ªmŸe_wakeup
 = 1;

251 
Áû
;

253 
ªt
 = 0;

255 
Devi˚OutReque°
 | 
USB_REQ_SET_ADDRESS
:

256 
dev
->
addr
 = 
vÆue
;

257 
ªt
 = 0;

259 
Devi˚Reque°
 | 
USB_REQ_GET_DESCRIPTOR
:

260 
vÆue
 >> 8) {

261 
USB_DT_DEVICE
:

262 
	`mem˝y
(
d©a
, 
qemu_msd_dev_des¸ùt‹
,

263 (
qemu_msd_dev_des¸ùt‹
));

264 
ªt
 = (
qemu_msd_dev_des¸ùt‹
);

266 
USB_DT_CONFIG
:

267 
	`mem˝y
(
d©a
, 
qemu_msd_c⁄fig_des¸ùt‹
,

268 (
qemu_msd_c⁄fig_des¸ùt‹
));

269 
ªt
 = (
qemu_msd_c⁄fig_des¸ùt‹
);

271 
USB_DT_STRING
:

272 
vÆue
 & 0xff) {

275 
d©a
[0] = 4;

276 
d©a
[1] = 3;

277 
d©a
[2] = 0x09;

278 
d©a
[3] = 0x04;

279 
ªt
 = 4;

283 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "QEMU " 
QEMU_VERSION
);

287 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "QEMU USB HARDDRIVE");

291 
ªt
 = 
	`£t_usb_°rög
(
d©a
, "1");

294 
Áû
;

298 
Áû
;

301 
Devi˚Reque°
 | 
USB_REQ_GET_CONFIGURATION
:

302 
d©a
[0] = 1;

303 
ªt
 = 1;

305 
Devi˚OutReque°
 | 
USB_REQ_SET_CONFIGURATION
:

306 
ªt
 = 0;

308 
Devi˚Reque°
 | 
USB_REQ_GET_INTERFACE
:

309 
d©a
[0] = 0;

310 
ªt
 = 1;

312 
Devi˚OutReque°
 | 
USB_REQ_SET_INTERFACE
:

313 
ªt
 = 0;

315 
EndpoötOutReque°
 | 
USB_REQ_CLEAR_FEATURE
:

316 i‡(
vÆue
 =0 && 
ödex
 != 0x81) {

317 
Áû
;

319 
ªt
 = 0;

322 
MassSt‹ageRe£t
:

324 
s
->
mode
 = 
USB_MSDM_CBW
;

325 
ªt
 = 0;

327 
GëMaxLun
:

328 
d©a
[0] = 0;

329 
ªt
 = 1;

332 
Áû
:

333 
ªt
 = 
USB_RET_STALL
;

336  
ªt
;

337 
	}
}

339 
	$usb_msd_ˇn˚l_io
(
USBPackë
 *
p
, *
›aque
)

341 
MSDSèã
 *
s
 = 
›aque
;

342 
	`scsi_ˇn˚l_io
(
s
->
scsi_dev
, s->
èg
);

343 
s
->
∑ckë
 = 
NULL
;

344 
s
->
scsi_Àn
 = 0;

345 
	}
}

347 
	$usb_msd_h™dÀ_d©a
(
USBDevi˚
 *
dev
, 
USBPackë
 *
p
)

349 
MSDSèã
 *
s
 = (MSDSèã *)
dev
;

350 
ªt
 = 0;

351 
usb_msd_cbw
 
cbw
;

352 
uöt8_t
 
devï
 = 
p
->devep;

353 
uöt8_t
 *
d©a
 = 
p
->data;

354 
Àn
 = 
p
->len;

356 
p
->
pid
) {

357 
USB_TOKEN_OUT
:

358 i‡(
devï
 != 2)

359 
Áû
;

361 
s
->
mode
) {

362 
USB_MSDM_CBW
:

363 i‡(
Àn
 != 31) {

364 
	`Ârötf
(
°dîr
, "usb-msd: Bad CBW size");

365 
Áû
;

367 
	`mem˝y
(&
cbw
, 
d©a
, 31);

368 i‡(
	`À32_to_˝u
(
cbw
.
sig
) != 0x43425355) {

369 
	`Ârötf
(
°dîr
, "usb-msd: Bad signature %08x\n",

370 
	`À32_to_˝u
(
cbw
.
sig
));

371 
Áû
;

373 
	`DPRINTF
("Comm™d o¿LUN %d\n", 
cbw
.
lun
);

374 i‡(
cbw
.
lun
 != 0) {

375 
	`Ârötf
(
°dîr
, "usb-msd: Bad LUN %d\n", 
cbw
.
lun
);

376 
Áû
;

378 
s
->
èg
 = 
	`À32_to_˝u
(
cbw
.tag);

379 
s
->
d©a_Àn
 = 
	`À32_to_˝u
(
cbw
.data_len);

380 i‡(
s
->
d©a_Àn
 == 0) {

381 
s
->
mode
 = 
USB_MSDM_CSW
;

382 } i‡(
cbw
.
Êags
 & 0x80) {

383 
s
->
mode
 = 
USB_MSDM_DATAIN
;

385 
s
->
mode
 = 
USB_MSDM_DATAOUT
;

387 
	`DPRINTF
("CommandÅag 0x%x flags %08xÜen %d data %d\n",

388 
s
->
èg
, 
cbw
.
Êags
, cbw.
cmd_Àn
, s->
d©a_Àn
);

389 
s
->
ªsidue
 = 0;

390 
	`scsi_£nd_comm™d
(
s
->
scsi_dev
, s->
èg
, 
cbw
.
cmd
, 0);

393 i‡(
s
->
ªsidue
 == 0) {

394 i‡(
s
->
mode
 =
USB_MSDM_DATAIN
) {

395 
	`scsi_ªad_d©a
(
s
->
scsi_dev
, s->
èg
);

396 } i‡(
s
->
mode
 =
USB_MSDM_DATAOUT
) {

397 
	`scsi_wrôe_d©a
(
s
->
scsi_dev
, s->
èg
);

400 
ªt
 = 
Àn
;

403 
USB_MSDM_DATAOUT
:

404 
	`DPRINTF
("D©®ouà%d/%d\n", 
Àn
, 
s
->
d©a_Àn
);

405 i‡(
Àn
 > 
s
->
d©a_Àn
)

406 
Áû
;

408 
s
->
usb_buf
 = 
d©a
;

409 
s
->
usb_Àn
 = 
Àn
;

410 i‡(
s
->
scsi_Àn
) {

411 
	`usb_msd_c›y_d©a
(
s
);

413 i‡(
s
->
ªsidue
 && s->
usb_Àn
) {

414 
s
->
d©a_Àn
 -s->
usb_Àn
;

415 i‡(
s
->
d©a_Àn
 == 0)

416 
s
->
mode
 = 
USB_MSDM_CSW
;

417 
s
->
usb_Àn
 = 0;

419 i‡(
s
->
usb_Àn
) {

420 
	`DPRINTF
("De„ºögÖackë %p\n", 
p
);

421 
	`usb_de„r_∑ckë
(
p
, 
usb_msd_ˇn˚l_io
, 
s
);

422 
s
->
∑ckë
 = 
p
;

423 
ªt
 = 
USB_RET_ASYNC
;

425 
ªt
 = 
Àn
;

430 
	`DPRINTF
("U√x≥˘ed wrôê÷í %d)\n", 
Àn
);

431 
Áû
;

435 
USB_TOKEN_IN
:

436 i‡(
devï
 != 1)

437 
Áû
;

439 
s
->
mode
) {

440 
USB_MSDM_DATAOUT
:

441 i‡(
s
->
d©a_Àn
 !0 || 
Àn
 < 13)

442 
Áû
;

444 
	`usb_de„r_∑ckë
(
p
, 
usb_msd_ˇn˚l_io
, 
s
);

445 
s
->
∑ckë
 = 
p
;

446 
ªt
 = 
USB_RET_ASYNC
;

449 
USB_MSDM_CSW
:

450 
	`DPRINTF
("Command status %dÅag 0x%x,Üen %d\n",

451 
s
->
ªsu…
, s->
èg
, 
Àn
);

452 i‡(
Àn
 < 13)

453 
Áû
;

455 
s
->
usb_Àn
 = 
Àn
;

456 
s
->
usb_buf
 = 
d©a
;

457 
	`usb_msd_£nd_°©us
(
s
);

458 
s
->
mode
 = 
USB_MSDM_CBW
;

459 
ªt
 = 13;

462 
USB_MSDM_DATAIN
:

463 
	`DPRINTF
("D©®ö %d/%d\n", 
Àn
, 
s
->
d©a_Àn
);

464 i‡(
Àn
 > 
s
->
d©a_Àn
)

465 
Àn
 = 
s
->
d©a_Àn
;

466 
s
->
usb_buf
 = 
d©a
;

467 
s
->
usb_Àn
 = 
Àn
;

468 i‡(
s
->
scsi_Àn
) {

469 
	`usb_msd_c›y_d©a
(
s
);

471 i‡(
s
->
ªsidue
 && s->
usb_Àn
) {

472 
s
->
d©a_Àn
 -s->
usb_Àn
;

473 
	`mem£t
(
s
->
usb_buf
, 0, s->
usb_Àn
);

474 i‡(
s
->
d©a_Àn
 == 0)

475 
s
->
mode
 = 
USB_MSDM_CSW
;

476 
s
->
usb_Àn
 = 0;

478 i‡(
s
->
usb_Àn
) {

479 
	`DPRINTF
("De„ºögÖackë %p\n", 
p
);

480 
	`usb_de„r_∑ckë
(
p
, 
usb_msd_ˇn˚l_io
, 
s
);

481 
s
->
∑ckë
 = 
p
;

482 
ªt
 = 
USB_RET_ASYNC
;

484 
ªt
 = 
Àn
;

489 
	`DPRINTF
("U√x≥˘edÑód (À¿%d)\n", 
Àn
);

490 
Áû
;

495 
	`DPRINTF
("BadÅoken\n");

496 
Áû
:

497 
ªt
 = 
USB_RET_STALL
;

501  
ªt
;

502 
	}
}

504 
	$usb_msd_h™dÀ_de°roy
(
USBDevi˚
 *
dev
)

506 
MSDSèã
 *
s
 = (MSDSèã *)
dev
;

508 
	`scsi_disk_de°roy
(
s
->
scsi_dev
);

509 
	`bdrv_dñëe
(
s
->
bs
);

510 
	`qemu_‰ì
(
s
);

511 
	}
}

513 
USBDevi˚
 *
	$usb_msd_öô
(c⁄° *
fûíame
)

515 
MSDSèã
 *
s
;

516 
BlockDrivîSèã
 *
bdrv
;

518 
s
 = 
	`qemu_mÆlocz
((
MSDSèã
));

519 i‡(!
s
)

520  
NULL
;

522 
bdrv
 = 
	`bdrv_√w
("usb");

523 i‡(
	`bdrv_›í
(
bdrv
, 
fûíame
, 0) < 0)

524 
Áû
;

525 
s
->
bs
 = 
bdrv
;

527 
s
->
dev
.
•ìd
 = 
USB_SPEED_FULL
;

528 
s
->
dev
.
h™dÀ_∑ckë
 = 
usb_gíîic_h™dÀ_∑ckë
;

530 
s
->
dev
.
h™dÀ_ª£t
 = 
usb_msd_h™dÀ_ª£t
;

531 
s
->
dev
.
h™dÀ_c⁄åﬁ
 = 
usb_msd_h™dÀ_c⁄åﬁ
;

532 
s
->
dev
.
h™dÀ_d©a
 = 
usb_msd_h™dÀ_d©a
;

533 
s
->
dev
.
h™dÀ_de°roy
 = 
usb_msd_h™dÀ_de°roy
;

535 
	`¢¥ötf
(
s
->
dev
.
dev«me
, (s->dev.devname), "QEMU USB MSD(%.16s)",

536 
fûíame
);

538 
s
->
scsi_dev
 = 
	`scsi_disk_öô
(
bdrv
, 0, 
usb_msd_comm™d_com∂ëe
, s);

539 
	`usb_msd_h™dÀ_ª£t
((
USBDevi˚
 *)
s
);

540  (
USBDevi˚
 *)
s
;

541 
Áû
:

542 
	`qemu_‰ì
(
s
);

543  
NULL
;

544 
	}
}

	@usb-ohci.c

29 
	~"vl.h
"

37 #ifde‡
DEBUG_OHCI


38 
	#d¥ötf
 
¥ötf


	)

40 
	#d¥ötf
(...)

	)

45 
	#OHCI_MAX_PORTS
 15

	)

47 
öt64_t
 
	gusb_‰ame_time
;

48 
öt64_t
 
	gusb_bô_time
;

50 
	sOHCIP‹t
 {

51 
USBP‹t
 
	mp‹t
;

52 
uöt32_t
 
	m˘æ
;

53 } 
	tOHCIP‹t
;

56 
PCIDevi˚
 
	mpci_dev
;

57 
èrgë_phys_addr_t
 
	mmem_ba£
;

58 
	mmem
;

59 
	mnum_p‹ts
;

61 
QEMUTimî
 *
	meof_timî
;

62 
öt64_t
 
	msof_time
;

66 
uöt32_t
 
	m˘l
, 
	m°©us
;

67 
uöt32_t
 
	möå_°©us
;

68 
uöt32_t
 
	möå
;

71 
uöt32_t
 
	mhcˇ
;

72 
uöt32_t
 
	m˘æ_hód
, 
	m˘æ_cur
;

73 
uöt32_t
 
	mbulk_hód
, 
	mbulk_cur
;

74 
uöt32_t
 
	m≥r_cur
;

75 
uöt32_t
 
	md⁄e
;

76 
	md⁄e_cou¡
;

79 
uöt32_t
 
	mfsmps
:15;

80 
uöt32_t
 
	mfô
:1;

81 
uöt32_t
 
	mfi
:14;

82 
uöt32_t
 
	m‰t
:1;

83 
uöt16_t
 
	m‰ame_numbî
;

84 
uöt16_t
 
	m∑ddög
;

85 
uöt32_t
 
	mp°¨t
;

86 
uöt32_t
 
	ml°
;

89 
uöt32_t
 
	mrhdesc_a
, 
	mrhdesc_b
;

90 
uöt32_t
 
	mrh°©us
;

91 
OHCIP‹t
 
	mrhp‹t
[
OHCI_MAX_PORTS
];

94 
uöt32_t
 
	mﬁd_˘l
;

95 
USBPackë
 
	musb_∑ckë
;

96 
uöt8_t
 
	musb_buf
[8192];

97 
uöt32_t
 
	masync_td
;

98 
	masync_com∂ëe
;

100 } 
	tOHCISèã
;

103 
	sohci_hcˇ
 {

104 
uöt32_t
 
	möå
[32];

105 
uöt16_t
 
	m‰ame
, 
	m∑d
;

106 
uöt32_t
 
	md⁄e
;

110 
	#OHCI_ED_FA_SHIFT
 0

	)

111 
	#OHCI_ED_FA_MASK
 (0x7f<<
OHCI_ED_FA_SHIFT
)

	)

112 
	#OHCI_ED_EN_SHIFT
 7

	)

113 
	#OHCI_ED_EN_MASK
 (0xf<<
OHCI_ED_EN_SHIFT
)

	)

114 
	#OHCI_ED_D_SHIFT
 11

	)

115 
	#OHCI_ED_D_MASK
 (3<<
OHCI_ED_D_SHIFT
)

	)

116 
	#OHCI_ED_S
 (1<<13)

	)

117 
	#OHCI_ED_K
 (1<<14)

	)

118 
	#OHCI_ED_F
 (1<<15)

	)

119 
	#OHCI_ED_MPS_SHIFT
 7

	)

120 
	#OHCI_ED_MPS_MASK
 (0xf<<
OHCI_ED_FA_SHIFT
)

	)

123 
	#OHCI_ED_H
 1

	)

124 
	#OHCI_ED_C
 2

	)

127 
	#OHCI_TD_R
 (1<<18)

	)

128 
	#OHCI_TD_DP_SHIFT
 19

	)

129 
	#OHCI_TD_DP_MASK
 (3<<
OHCI_TD_DP_SHIFT
)

	)

130 
	#OHCI_TD_DI_SHIFT
 21

	)

131 
	#OHCI_TD_DI_MASK
 (7<<
OHCI_TD_DI_SHIFT
)

	)

132 
	#OHCI_TD_T0
 (1<<24)

	)

133 
	#OHCI_TD_T1
 (1<<24)

	)

134 
	#OHCI_TD_EC_SHIFT
 26

	)

135 
	#OHCI_TD_EC_MASK
 (3<<
OHCI_TD_EC_SHIFT
)

	)

136 
	#OHCI_TD_CC_SHIFT
 28

	)

137 
	#OHCI_TD_CC_MASK
 (0xf<<
OHCI_TD_CC_SHIFT
)

	)

139 
	#OHCI_DPTR_MASK
 0xfffffff0

	)

141 
	#OHCI_BM
(
vÆ
, 
fõld
) \

142 (((
vÆ
Ë& 
OHCI_
##
fõld
##
_MASK
Ë>> OHCI_##fõld##
_SHIFT
)

	)

144 
	#OHCI_SET_BM
(
vÆ
, 
fõld
, 
√wvÆ
) do { \

145 
vÆ
 &~
OHCI_
##
fõld
##
_MASK
; \

146 
vÆ
 |((
√wvÆ
Ë<< 
OHCI_
##
fõld
##
_SHIFT
Ë& OHCI_##fõld##
_MASK
; \

147 } 0)

	)

150 
	sohci_ed
 {

151 
uöt32_t
 
	mÊags
;

152 
uöt32_t
 
	mèû
;

153 
uöt32_t
 
	mhód
;

154 
uöt32_t
 
	m√xt
;

158 
	sohci_td
 {

159 
uöt32_t
 
	mÊags
;

160 
uöt32_t
 
	mcbp
;

161 
uöt32_t
 
	m√xt
;

162 
uöt32_t
 
	mbe
;

165 
	#USB_HZ
 12000000

	)

168 
	#OHCI_CTL_CBSR
 ((1<<0)|(1<<1))

	)

169 
	#OHCI_CTL_PLE
 (1<<2)

	)

170 
	#OHCI_CTL_IE
 (1<<3)

	)

171 
	#OHCI_CTL_CLE
 (1<<4)

	)

172 
	#OHCI_CTL_BLE
 (1<<5)

	)

173 
	#OHCI_CTL_HCFS
 ((1<<6)|(1<<7))

	)

174 
	#OHCI_USB_RESET
 0x00

	)

175 
	#OHCI_USB_RESUME
 0x40

	)

176 
	#OHCI_USB_OPERATIONAL
 0x80

	)

177 
	#OHCI_USB_SUSPEND
 0xc0

	)

178 
	#OHCI_CTL_IR
 (1<<8)

	)

179 
	#OHCI_CTL_RWC
 (1<<9)

	)

180 
	#OHCI_CTL_RWE
 (1<<10)

	)

182 
	#OHCI_STATUS_HCR
 (1<<0)

	)

183 
	#OHCI_STATUS_CLF
 (1<<1)

	)

184 
	#OHCI_STATUS_BLF
 (1<<2)

	)

185 
	#OHCI_STATUS_OCR
 (1<<3)

	)

186 
	#OHCI_STATUS_SOC
 ((1<<6)|(1<<7))

	)

188 
	#OHCI_INTR_SO
 (1<<0Ë

	)

189 
	#OHCI_INTR_WD
 (1<<1Ë

	)

190 
	#OHCI_INTR_SF
 (1<<2Ë

	)

191 
	#OHCI_INTR_RD
 (1<<3Ë

	)

192 
	#OHCI_INTR_UE
 (1<<4Ë

	)

193 
	#OHCI_INTR_FNO
 (1<<5Ë

	)

194 
	#OHCI_INTR_RHSC
 (1<<6Ë

	)

195 
	#OHCI_INTR_OC
 (1<<30Ë

	)

196 
	#OHCI_INTR_MIE
 (1<<31Ë

	)

198 
	#OHCI_HCCA_SIZE
 0x100

	)

199 
	#OHCI_HCCA_MASK
 0xffffff00

	)

201 
	#OHCI_EDPTR_MASK
 0xfffffff0

	)

203 
	#OHCI_FMI_FI
 0x00003fff

	)

204 
	#OHCI_FMI_FSMPS
 0xffff0000

	)

205 
	#OHCI_FMI_FIT
 0x80000000

	)

207 
	#OHCI_FR_RT
 (1<<31)

	)

209 
	#OHCI_LS_THRESH
 0x628

	)

211 
	#OHCI_RHA_RW_MASK
 0x00000000

	)

212 
	#OHCI_RHA_PSM
 (1<<8)

	)

213 
	#OHCI_RHA_NPS
 (1<<9)

	)

214 
	#OHCI_RHA_DT
 (1<<10)

	)

215 
	#OHCI_RHA_OCPM
 (1<<11)

	)

216 
	#OHCI_RHA_NOCP
 (1<<12)

	)

217 
	#OHCI_RHA_POTPGT_MASK
 0xff000000

	)

219 
	#OHCI_RHS_LPS
 (1<<0)

	)

220 
	#OHCI_RHS_OCI
 (1<<1)

	)

221 
	#OHCI_RHS_DRWE
 (1<<15)

	)

222 
	#OHCI_RHS_LPSC
 (1<<16)

	)

223 
	#OHCI_RHS_OCIC
 (1<<17)

	)

224 
	#OHCI_RHS_CRWE
 (1<<31)

	)

226 
	#OHCI_PORT_CCS
 (1<<0)

	)

227 
	#OHCI_PORT_PES
 (1<<1)

	)

228 
	#OHCI_PORT_PSS
 (1<<2)

	)

229 
	#OHCI_PORT_POCI
 (1<<3)

	)

230 
	#OHCI_PORT_PRS
 (1<<4)

	)

231 
	#OHCI_PORT_PPS
 (1<<8)

	)

232 
	#OHCI_PORT_LSDA
 (1<<9)

	)

233 
	#OHCI_PORT_CSC
 (1<<16)

	)

234 
	#OHCI_PORT_PESC
 (1<<17)

	)

235 
	#OHCI_PORT_PSSC
 (1<<18)

	)

236 
	#OHCI_PORT_OCIC
 (1<<19)

	)

237 
	#OHCI_PORT_PRSC
 (1<<20)

	)

238 
	#OHCI_PORT_WTC
 (
OHCI_PORT_CSC
|
OHCI_PORT_PESC
|
OHCI_PORT_PSSC
 \

239 |
OHCI_PORT_OCIC
|
OHCI_PORT_PRSC
)

	)

241 
	#OHCI_TD_DIR_SETUP
 0x0

	)

242 
	#OHCI_TD_DIR_OUT
 0x1

	)

243 
	#OHCI_TD_DIR_IN
 0x2

	)

244 
	#OHCI_TD_DIR_RESERVED
 0x3

	)

246 
	#OHCI_CC_NOERROR
 0x0

	)

247 
	#OHCI_CC_CRC
 0x1

	)

248 
	#OHCI_CC_BITSTUFFING
 0x2

	)

249 
	#OHCI_CC_DATATOGGLEMISMATCH
 0x3

	)

250 
	#OHCI_CC_STALL
 0x4

	)

251 
	#OHCI_CC_DEVICENOTRESPONDING
 0x5

	)

252 
	#OHCI_CC_PIDCHECKFAILURE
 0x6

	)

253 
	#OHCI_CC_UNDEXPETEDPID
 0x7

	)

254 
	#OHCI_CC_DATAOVERRUN
 0x8

	)

255 
	#OHCI_CC_DATAUNDERRUN
 0x9

	)

256 
	#OHCI_CC_BUFFEROVERRUN
 0xc

	)

257 
	#OHCI_CC_BUFFERUNDERRUN
 0xd

	)

260 
ölöe
 
	$ohci_öå_upd©e
(
OHCISèã
 *
ohci
)

262 
Àvñ
 = 0;

264 i‡((
ohci
->
öå
 & 
OHCI_INTR_MIE
) &&

265 (
ohci
->
öå_°©us
 & ohci->
öå
))

266 
Àvñ
 = 1;

268 
	`pci_£t_úq
(&
ohci
->
pci_dev
, 0, 
Àvñ
);

269 
	}
}

272 
ölöe
 
	$ohci_£t_öãºu±
(
OHCISèã
 *
ohci
, 
uöt32_t
 
öå
)

274 
ohci
->
öå_°©us
 |
öå
;

275 
	`ohci_öå_upd©e
(
ohci
);

276 
	}
}

279 
	$ohci_©èch
(
USBP‹t
 *
p‹t1
, 
USBDevi˚
 *
dev
)

281 
OHCISèã
 *
s
 = 
p‹t1
->
›aque
;

282 
OHCIP‹t
 *
p‹t
 = &
s
->
rhp‹t
[
p‹t1
->
ödex
];

283 
uöt32_t
 
ﬁd_°©e
 = 
p‹t
->
˘æ
;

285 i‡(
dev
) {

286 i‡(
p‹t
->p‹t.
dev
) {

287 
	`usb_©èch
(
p‹t1
, 
NULL
);

290 
p‹t
->
˘æ
 |
OHCI_PORT_CCS
 | 
OHCI_PORT_CSC
;

293 i‡(
dev
->
•ìd
 =
USB_SPEED_LOW
)

294 
p‹t
->
˘æ
 |
OHCI_PORT_LSDA
;

296 
p‹t
->
˘æ
 &~
OHCI_PORT_LSDA
;

297 
p‹t
->p‹t.
dev
 = dev;

299 
	`usb_£nd_msg
(
dev
, 
USB_MSG_ATTACH
);

300 
	`d¥ötf
("usb-ohci: AâachedÖ‹à%d\n", 
p‹t1
->
ödex
);

303 i‡(
p‹t
->
˘æ
 & 
OHCI_PORT_CCS
) {

304 
p‹t
->
˘æ
 &~
OHCI_PORT_CCS
;

305 
p‹t
->
˘æ
 |
OHCI_PORT_CSC
;

308 i‡(
p‹t
->
˘æ
 & 
OHCI_PORT_PES
) {

309 
p‹t
->
˘æ
 &~
OHCI_PORT_PES
;

310 
p‹t
->
˘æ
 |
OHCI_PORT_PESC
;

312 
dev
 = 
p‹t
->port.dev;

313 i‡(
dev
) {

315 
	`usb_£nd_msg
(
dev
, 
USB_MSG_DETACH
);

317 
p‹t
->p‹t.
dev
 = 
NULL
;

318 
	`d¥ötf
("usb-ohci: DëachedÖ‹à%d\n", 
p‹t1
->
ödex
);

321 i‡(
ﬁd_°©e
 !
p‹t
->
˘æ
)

322 
	`ohci_£t_öãºu±
(
s
, 
OHCI_INTR_RHSC
);

323 
	}
}

326 
	$ohci_ª£t
(
OHCISèã
 *
ohci
)

328 
OHCIP‹t
 *
p‹t
;

329 
i
;

331 
ohci
->
˘l
 = 0;

332 
ohci
->
ﬁd_˘l
 = 0;

333 
ohci
->
°©us
 = 0;

334 
ohci
->
öå_°©us
 = 0;

335 
ohci
->
öå
 = 
OHCI_INTR_MIE
;

337 
ohci
->
hcˇ
 = 0;

338 
ohci
->
˘æ_hód
 = ohci->
˘æ_cur
 = 0;

339 
ohci
->
bulk_hód
 = ohci->
bulk_cur
 = 0;

340 
ohci
->
≥r_cur
 = 0;

341 
ohci
->
d⁄e
 = 0;

342 
ohci
->
d⁄e_cou¡
 = 7;

347 
ohci
->
fsmps
 = 0x2778;

348 
ohci
->
fi
 = 0x2edf;

349 
ohci
->
fô
 = 0;

350 
ohci
->
‰t
 = 0;

351 
ohci
->
‰ame_numbî
 = 0;

352 
ohci
->
p°¨t
 = 0;

353 
ohci
->
l°
 = 
OHCI_LS_THRESH
;

355 
ohci
->
rhdesc_a
 = 
OHCI_RHA_NPS
 | ohci->
num_p‹ts
;

356 
ohci
->
rhdesc_b
 = 0x0;

357 
ohci
->
rh°©us
 = 0;

359 
i
 = 0; i < 
ohci
->
num_p‹ts
; i++)

361 
p‹t
 = &
ohci
->
rhp‹t
[
i
];

362 
p‹t
->
˘æ
 = 0;

363 i‡(
p‹t
->p‹t.
dev
)

364 
	`ohci_©èch
(&
p‹t
->p‹t,Ö‹t->p‹t.
dev
);

366 i‡(
ohci
->
async_td
) {

367 
	`usb_ˇn˚l_∑ckë
(&
ohci
->
usb_∑ckë
);

368 
ohci
->
async_td
 = 0;

370 
	`d¥ötf
("usb-ohci: Re£à%s\n", 
ohci
->
pci_dev
.
«me
);

371 
	}
}

374 
ölöe
 
	$gë_dw‹ds
(
uöt32_t
 
addr
, uöt32_à*
buf
, 
num
)

376 
i
;

378 
i
 = 0; i < 
num
; i++, 
buf
++, 
addr
 += (*buf)) {

379 
	`˝u_physiˇl_mem‹y_rw
(
addr
, (
uöt8_t
 *)
buf
, (*buf), 0);

380 *
buf
 = 
	`À32_to_˝u
(*buf);

384 
	}
}

387 
ölöe
 
	$put_dw‹ds
(
uöt32_t
 
addr
, uöt32_à*
buf
, 
num
)

389 
i
;

391 
i
 = 0; i < 
num
; i++, 
buf
++, 
addr
 += (*buf)) {

392 
uöt32_t
 
tmp
 = 
	`˝u_to_À32
(*
buf
);

393 
	`˝u_physiˇl_mem‹y_rw
(
addr
, (
uöt8_t
 *)&
tmp
, (tmp), 1);

397 
	}
}

399 
ölöe
 
	$ohci_ªad_ed
(
uöt32_t
 
addr
, 
ohci_ed
 *
ed
)

401  
	`gë_dw‹ds
(
addr
, (
uöt32_t
 *)
ed
, (*ed) >> 2);

402 
	}
}

404 
ölöe
 
	$ohci_ªad_td
(
uöt32_t
 
addr
, 
ohci_td
 *
td
)

406  
	`gë_dw‹ds
(
addr
, (
uöt32_t
 *)
td
, (*td) >> 2);

407 
	}
}

409 
ölöe
 
	$ohci_put_ed
(
uöt32_t
 
addr
, 
ohci_ed
 *
ed
)

411  
	`put_dw‹ds
(
addr
, (
uöt32_t
 *)
ed
, (*ed) >> 2);

412 
	}
}

414 
ölöe
 
	$ohci_put_td
(
uöt32_t
 
addr
, 
ohci_td
 *
td
)

416  
	`put_dw‹ds
(
addr
, (
uöt32_t
 *)
td
, (*td) >> 2);

417 
	}
}

420 
	$ohci_c›y_td
(
ohci_td
 *
td
, 
uöt8_t
 *
buf
, 
Àn
, 
wrôe
)

422 
uöt32_t
 
±r
;

423 
uöt32_t
 
n
;

425 
±r
 = 
td
->
cbp
;

426 
n
 = 0x1000 - (
±r
 & 0xfff);

427 i‡(
n
 > 
Àn
)

428 
n
 = 
Àn
;

429 
	`˝u_physiˇl_mem‹y_rw
(
±r
, 
buf
, 
n
, 
wrôe
);

430 i‡(
n
 =
Àn
)

432 
±r
 = 
td
->
be
 & ~0xfffu;

433 
buf
 +
n
;

434 
	`˝u_physiˇl_mem‹y_rw
(
±r
, 
buf
, 
Àn
 - 
n
, 
wrôe
);

435 
	}
}

437 
ohci_¥o˚ss_li°s
(
OHCISèã
 *
ohci
);

439 
	$ohci_async_com∂ëe_∑ckë
(
USBPackë
 * 
∑ckë
, *
›aque
)

441 
OHCISèã
 *
ohci
 = 
›aque
;

442 #ifde‡
DEBUG_PACKET


443 
	`d¥ötf
("AsyncÖacket complete\n");

445 
ohci
->
async_com∂ëe
 = 1;

446 
	`ohci_¥o˚ss_li°s
(
ohci
);

447 
	}
}

452 
	$ohci_£rvi˚_td
(
OHCISèã
 *
ohci
, 
ohci_ed
 *
ed
)

454 
dú
;

455 
size_t
 
Àn
 = 0;

456 *
°r
 = 
NULL
;

457 
pid
;

458 
ªt
;

459 
i
;

460 
USBDevi˚
 *
dev
;

461 
ohci_td
 
td
;

462 
uöt32_t
 
addr
;

463 
Êag_r
;

464 
com∂ëi⁄
;

466 
addr
 = 
ed
->
hód
 & 
OHCI_DPTR_MASK
;

468 
com∂ëi⁄
 = (
addr
 =
ohci
->
async_td
);

469 i‡(
com∂ëi⁄
 && !
ohci
->
async_com∂ëe
) {

470 #ifde‡
DEBUG_PACKET


471 
	`d¥ötf
("Skippingásync TD\n");

475 i‡(!
	`ohci_ªad_td
(
addr
, &
td
)) {

476 
	`Ârötf
(
°dîr
, "usb-ohci: TDÑódÉº‹áà%x\n", 
addr
);

480 
dú
 = 
	`OHCI_BM
(
ed
->
Êags
, 
ED_D
);

481 
dú
) {

482 
OHCI_TD_DIR_OUT
:

483 
OHCI_TD_DIR_IN
:

487 
dú
 = 
	`OHCI_BM
(
td
.
Êags
, 
TD_DP
);

491 
dú
) {

492 
OHCI_TD_DIR_IN
:

493 
°r
 = "in";

494 
pid
 = 
USB_TOKEN_IN
;

496 
OHCI_TD_DIR_OUT
:

497 
°r
 = "out";

498 
pid
 = 
USB_TOKEN_OUT
;

500 
OHCI_TD_DIR_SETUP
:

501 
°r
 = "setup";

502 
pid
 = 
USB_TOKEN_SETUP
;

505 
	`Ârötf
(
°dîr
, "usb-ohci: Bad direction\n");

508 i‡(
td
.
cbp
 &&Åd.
be
) {

509 i‡((
td
.
cbp
 & 0xfffff000Ë!—d.
be
 & 0xfffff000)) {

510 
Àn
 = (
td
.
be
 & 0xfffË+ 0x1001 - (td.
cbp
 & 0xfff);

512 
Àn
 = (
td
.
be
 -Åd.
cbp
) + 1;

515 i‡(
Àn
 && 
dú
 !
OHCI_TD_DIR_IN
 && !
com∂ëi⁄
) {

516 
	`ohci_c›y_td
(&
td
, 
ohci
->
usb_buf
, 
Àn
, 0);

520 
Êag_r
 = (
td
.
Êags
 & 
OHCI_TD_R
) != 0;

521 #ifde‡
DEBUG_PACKET


522 
	`d¥ötf
(" TD @ 0x%.8x %u bytes %sÑ=%d cbp=0x%.8x be=0x%.8x\n",

523 
addr
, 
Àn
, 
°r
, 
Êag_r
, 
td
.
cbp
,Åd.
be
);

525 i‡(
Àn
 >0 && 
dú
 !
OHCI_TD_DIR_IN
) {

526 
	`d¥ötf
(" data:");

527 
i
 = 0; i < 
Àn
; i++)

528 
	`¥ötf
(" %.2x", 
ohci
->
usb_buf
[
i
]);

529 
	`d¥ötf
("\n");

532 i‡(
com∂ëi⁄
) {

533 
ªt
 = 
ohci
->
usb_∑ckë
.
Àn
;

534 
ohci
->
async_td
 = 0;

535 
ohci
->
async_com∂ëe
 = 0;

537 
ªt
 = 
USB_RET_NODEV
;

538 
i
 = 0; i < 
ohci
->
num_p‹ts
; i++) {

539 
dev
 = 
ohci
->
rhp‹t
[
i
].
p‹t
.dev;

540 i‡((
ohci
->
rhp‹t
[
i
].
˘æ
 & 
OHCI_PORT_PES
) == 0)

543 i‡(
ohci
->
async_td
) {

549 #ifde‡
DEBUG_PACKET


550 
	`d¥ötf
("Too manyÖendingÖackets\n");

554 
ohci
->
usb_∑ckë
.
pid
 =Öid;

555 
ohci
->
usb_∑ckë
.
devaddr
 = 
	`OHCI_BM
(
ed
->
Êags
, 
ED_FA
);

556 
ohci
->
usb_∑ckë
.
devï
 = 
	`OHCI_BM
(
ed
->
Êags
, 
ED_EN
);

557 
ohci
->
usb_∑ckë
.
d©a
 = ohci->
usb_buf
;

558 
ohci
->
usb_∑ckë
.
Àn
 =Üen;

559 
ohci
->
usb_∑ckë
.
com∂ëe_cb
 = 
ohci_async_com∂ëe_∑ckë
;

560 
ohci
->
usb_∑ckë
.
com∂ëe_›aque
 = ohci;

561 
ªt
 = 
dev
->
	`h™dÀ_∑ckë
(dev, &
ohci
->
usb_∑ckë
);

562 i‡(
ªt
 !
USB_RET_NODEV
)

565 #ifde‡
DEBUG_PACKET


566 
	`d¥ötf
("ªt=%d\n", 
ªt
);

568 i‡(
ªt
 =
USB_RET_ASYNC
) {

569 
ohci
->
async_td
 = 
addr
;

573 i‡(
ªt
 >= 0) {

574 i‡(
dú
 =
OHCI_TD_DIR_IN
) {

575 
	`ohci_c›y_td
(&
td
, 
ohci
->
usb_buf
, 
ªt
, 1);

576 #ifde‡
DEBUG_PACKET


577 
	`d¥ötf
(" data:");

578 
i
 = 0; i < 
ªt
; i++)

579 
	`¥ötf
(" %.2x", 
ohci
->
usb_buf
[
i
]);

580 
	`d¥ötf
("\n");

583 
ªt
 = 
Àn
;

588 i‡(
ªt
 =
Àn
 || (
dú
 =
OHCI_TD_DIR_IN
 &&Ñë >0 && 
Êag_r
)) {

590 i‡(
ªt
 =
Àn
) {

591 
td
.
cbp
 = 0;

593 
td
.
cbp
 +
ªt
;

594 i‡((
td
.
cbp
 & 0xfffË+ 
ªt
 > 0xfff) {

595 
td
.
cbp
 &= 0xfff;

596 
td
.
cbp
 |td.
be
 & ~0xfff;

599 
td
.
Êags
 |
OHCI_TD_T1
;

600 
td
.
Êags
 ^
OHCI_TD_T0
;

601 
	`OHCI_SET_BM
(
td
.
Êags
, 
TD_CC
, 
OHCI_CC_NOERROR
);

602 
	`OHCI_SET_BM
(
td
.
Êags
, 
TD_EC
, 0);

604 
ed
->
hód
 &~
OHCI_ED_C
;

605 i‡(
td
.
Êags
 & 
OHCI_TD_T0
)

606 
ed
->
hód
 |
OHCI_ED_C
;

608 i‡(
ªt
 >= 0) {

609 
	`d¥ötf
("usb-ohci: Underrun\n");

610 
	`OHCI_SET_BM
(
td
.
Êags
, 
TD_CC
, 
OHCI_CC_DATAUNDERRUN
);

612 
ªt
) {

613 
USB_RET_NODEV
:

614 
	`OHCI_SET_BM
(
td
.
Êags
, 
TD_CC
, 
OHCI_CC_DEVICENOTRESPONDING
);

615 
USB_RET_NAK
:

616 
	`d¥ötf
("usb-ohci: got NAK\n");

618 
USB_RET_STALL
:

619 
	`d¥ötf
("usb-ohci: got STALL\n");

620 
	`OHCI_SET_BM
(
td
.
Êags
, 
TD_CC
, 
OHCI_CC_STALL
);

622 
USB_RET_BABBLE
:

623 
	`d¥ötf
("usb-ohci: got BABBLE\n");

624 
	`OHCI_SET_BM
(
td
.
Êags
, 
TD_CC
, 
OHCI_CC_DATAOVERRUN
);

627 
	`Ârötf
(
°dîr
, "usb-ohci: Bad devi˚Ñe•⁄£ %d\n", 
ªt
);

628 
	`OHCI_SET_BM
(
td
.
Êags
, 
TD_CC
, 
OHCI_CC_UNDEXPETEDPID
);

629 
	`OHCI_SET_BM
(
td
.
Êags
, 
TD_EC
, 3);

633 
ed
->
hód
 |
OHCI_ED_H
;

637 
ed
->
hód
 &~
OHCI_DPTR_MASK
;

638 
ed
->
hód
 |
td
.
√xt
 & 
OHCI_DPTR_MASK
;

639 
td
.
√xt
 = 
ohci
->
d⁄e
;

640 
ohci
->
d⁄e
 = 
addr
;

641 
i
 = 
	`OHCI_BM
(
td
.
Êags
, 
TD_DI
);

642 i‡(
i
 < 
ohci
->
d⁄e_cou¡
)

643 
ohci
->
d⁄e_cou¡
 = 
i
;

644 
	`ohci_put_td
(
addr
, &
td
);

645  
	`OHCI_BM
(
td
.
Êags
, 
TD_CC
Ë!
OHCI_CC_NOERROR
;

646 
	}
}

649 
	$ohci_£rvi˚_ed_li°
(
OHCISèã
 *
ohci
, 
uöt32_t
 
hód
)

651 
ohci_ed
 
ed
;

652 
uöt32_t
 
√xt_ed
;

653 
uöt32_t
 
cur
;

654 
a˘ive
;

656 
a˘ive
 = 0;

658 i‡(
hód
 == 0)

661 
cur
 = 
hód
; cur; cu∏
√xt_ed
) {

662 i‡(!
	`ohci_ªad_ed
(
cur
, &
ed
)) {

663 
	`Ârötf
(
°dîr
, "usb-ohci: EDÑódÉº‹áà%x\n", 
cur
);

667 
√xt_ed
 = 
ed
.
√xt
 & 
OHCI_DPTR_MASK
;

669 i‡((
ed
.
hód
 & 
OHCI_ED_H
Ë|| (ed.
Êags
 & 
OHCI_ED_K
)) {

670 
uöt32_t
 
addr
;

672 
addr
 = 
ed
.
hód
 & 
OHCI_DPTR_MASK
;

673 i‡(
ohci
->
async_td
 && 
addr
 == ohci->async_td) {

674 
	`usb_ˇn˚l_∑ckë
(&
ohci
->
usb_∑ckë
);

675 
ohci
->
async_td
 = 0;

681 i‡(
ed
.
Êags
 & 
OHCI_ED_F
)

684 (
ed
.
hód
 & 
OHCI_DPTR_MASK
Ë!ed.
èû
) {

685 #ifde‡
DEBUG_PACKET


686 
	`d¥ötf
("ED @ 0x%.8x fa=%uÉn=%u d=%u s=%u k=%u f=%u mps=%u "

687 "h=%u c=%u\¿ hód=0x%.8xÅaûp=0x%.8xÇext=0x%.8x\n", 
cur
,

688 
	`OHCI_BM
(
ed
.
Êags
, 
ED_FA
), OHCI_BM”d.Êags, 
ED_EN
),

689 
	`OHCI_BM
(
ed
.
Êags
, 
ED_D
), (ed.Êag†& 
OHCI_ED_S
)!= 0,

690 (
ed
.
Êags
 & 
OHCI_ED_K
Ë!0, (ed.Êag†& 
OHCI_ED_F
) != 0,

691 
	`OHCI_BM
(
ed
.
Êags
, 
ED_MPS
), (ed.
hód
 & 
OHCI_ED_H
) != 0,

692 (
ed
.
hód
 & 
OHCI_ED_C
Ë!0,Éd.hód & 
OHCI_DPTR_MASK
,

693 
ed
.
èû
 & 
OHCI_DPTR_MASK
,Éd.
√xt
 & OHCI_DPTR_MASK);

695 
a˘ive
 = 1;

697 i‡(
	`ohci_£rvi˚_td
(
ohci
, &
ed
))

701 
	`ohci_put_ed
(
cur
, &
ed
);

704  
a˘ive
;

705 
	}
}

708 
	$ohci_sof
(
OHCISèã
 *
ohci
)

710 
ohci
->
sof_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
);

711 
	`qemu_mod_timî
(
ohci
->
eof_timî
, ohci->
sof_time
 + 
usb_‰ame_time
);

712 
	`ohci_£t_öãºu±
(
ohci
, 
OHCI_INTR_SF
);

713 
	}
}

716 
	$ohci_¥o˚ss_li°s
(
OHCISèã
 *
ohci
)

718 i‡((
ohci
->
˘l
 & 
OHCI_CTL_CLE
Ë&& (ohci->
°©us
 & 
OHCI_STATUS_CLF
)) {

719 i‡(
ohci
->
˘æ_cur
 && ohci->˘æ_cu∏!ohci->
˘æ_hód
)

720 
	`d¥ötf
("usb-ohci: hód %x, cu∏%x\n", 
ohci
->
˘æ_hód
, ohci->
˘æ_cur
);

721 i‡(!
	`ohci_£rvi˚_ed_li°
(
ohci
, ohci->
˘æ_hód
)) {

722 
ohci
->
˘æ_cur
 = 0;

723 
ohci
->
°©us
 &~
OHCI_STATUS_CLF
;

727 i‡((
ohci
->
˘l
 & 
OHCI_CTL_BLE
Ë&& (ohci->
°©us
 & 
OHCI_STATUS_BLF
)) {

728 i‡(!
	`ohci_£rvi˚_ed_li°
(
ohci
, ohci->
bulk_hód
)) {

729 
ohci
->
bulk_cur
 = 0;

730 
ohci
->
°©us
 &~
OHCI_STATUS_BLF
;

733 
	}
}

736 
	$ohci_‰ame_bound¨y
(*
›aque
)

738 
OHCISèã
 *
ohci
 = 
›aque
;

739 
ohci_hcˇ
 
hcˇ
;

741 
	`˝u_physiˇl_mem‹y_rw
(
ohci
->
hcˇ
, (
uöt8_t
 *)&hcca, (hcca), 0);

744 i‡(
ohci
->
˘l
 & 
OHCI_CTL_PLE
) {

745 
n
;

747 
n
 = 
ohci
->
‰ame_numbî
 & 0x1f;

748 
	`ohci_£rvi˚_ed_li°
(
ohci
, 
	`À32_to_˝u
(
hcˇ
.
öå
[
n
]));

752 i‡(
ohci
->
async_td
 &&

753 
ohci
->
ﬁd_˘l
 & (~ohci->
˘l
Ë& (
OHCI_CTL_BLE
 | 
OHCI_CTL_CLE
)) {

754 
	`usb_ˇn˚l_∑ckë
(&
ohci
->
usb_∑ckë
);

755 
ohci
->
async_td
 = 0;

757 
ohci
->
ﬁd_˘l
 = ohci->
˘l
;

758 
	`ohci_¥o˚ss_li°s
(
ohci
);

761 
ohci
->
‰t
 = ohci->
fô
;

764 
ohci
->
‰ame_numbî
 = (ohci->frame_number + 1) & 0xffff;

765 
hcˇ
.
‰ame
 = 
	`˝u_to_À32
(
ohci
->
‰ame_numbî
);

767 i‡(
ohci
->
d⁄e_cou¡
 =0 && !(ohci->
öå_°©us
 & 
OHCI_INTR_WD
)) {

768 i‡(!
ohci
->
d⁄e
)

769 
	`ab‹t
();

770 i‡(
ohci
->
öå
 & ohci->
öå_°©us
)

771 
ohci
->
d⁄e
 |= 1;

772 
hcˇ
.
d⁄e
 = 
	`˝u_to_À32
(
ohci
->done);

773 
ohci
->
d⁄e
 = 0;

774 
ohci
->
d⁄e_cou¡
 = 7;

775 
	`ohci_£t_öãºu±
(
ohci
, 
OHCI_INTR_WD
);

778 i‡(
ohci
->
d⁄e_cou¡
 != 7 && ohci->done_count != 0)

779 
ohci
->
d⁄e_cou¡
--;

782 
	`ohci_sof
(
ohci
);

785 
	`˝u_physiˇl_mem‹y_rw
(
ohci
->
hcˇ
, (
uöt8_t
 *)&hcca, (hcca), 1);

786 
	}
}

791 
	$ohci_bus_°¨t
(
OHCISèã
 *
ohci
)

793 
ohci
->
eof_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
,

794 
ohci_‰ame_bound¨y
,

795 
ohci
);

797 i‡(
ohci
->
eof_timî
 =
NULL
) {

798 
	`Ârötf
(
°dîr
, "usb-ohci: %s: qemu_new_timer failed\n",

799 
ohci
->
pci_dev
.
«me
);

804 
	`d¥ötf
("usb-ohci: %s: USB O≥øti⁄Æ\n", 
ohci
->
pci_dev
.
«me
);

806 
	`ohci_sof
(
ohci
);

809 
	}
}

812 
	$ohci_bus_°›
(
OHCISèã
 *
ohci
)

814 i‡(
ohci
->
eof_timî
)

815 
	`qemu_dñ_timî
(
ohci
->
eof_timî
);

816 
	}
}

822 
	$ohci_p‹t_£t_if_c⁄√˘ed
(
OHCISèã
 *
ohci
, 
i
, 
uöt32_t
 
vÆ
)

824 
ªt
 = 1;

827 i‡(
vÆ
 == 0)

833 i‡(!(
ohci
->
rhp‹t
[
i
].
˘æ
 & 
OHCI_PORT_CCS
)) {

834 
ohci
->
rhp‹t
[
i
].
˘æ
 |
OHCI_PORT_CSC
;

835 i‡(
ohci
->
rh°©us
 & 
OHCI_RHS_DRWE
) {

841 i‡(
ohci
->
rhp‹t
[
i
].
˘æ
 & 
vÆ
)

842 
ªt
 = 0;

845 
ohci
->
rhp‹t
[
i
].
˘æ
 |
vÆ
;

847  
ªt
;

848 
	}
}

851 
	$ohci_£t_‰ame_öãrvÆ
(
OHCISèã
 *
ohci
, 
uöt16_t
 
vÆ
)

853 
vÆ
 &
OHCI_FMI_FI
;

855 i‡(
vÆ
 !
ohci
->
fi
) {

856 
	`d¥ötf
("usb-ohci: %s: FrameInterval = 0x%x (%u)\n",

857 
ohci
->
pci_dev
.
«me
, ohci->
fi
, ohci->fi);

860 
ohci
->
fi
 = 
vÆ
;

861 
	}
}

863 
	$ohci_p‹t_powî
(
OHCISèã
 *
ohci
, 
i
, 
p
)

865 i‡(
p
) {

866 
ohci
->
rhp‹t
[
i
].
˘æ
 |
OHCI_PORT_PPS
;

868 
ohci
->
rhp‹t
[
i
].
˘æ
 &~(
OHCI_PORT_PPS
|

869 
OHCI_PORT_CCS
|

870 
OHCI_PORT_PSS
|

871 
OHCI_PORT_PRS
);

873 
	}
}

876 
	$ohci_£t_˘l
(
OHCISèã
 *
ohci
, 
uöt32_t
 
vÆ
)

878 
uöt32_t
 
ﬁd_°©e
;

879 
uöt32_t
 
√w_°©e
;

881 
ﬁd_°©e
 = 
ohci
->
˘l
 & 
OHCI_CTL_HCFS
;

882 
ohci
->
˘l
 = 
vÆ
;

883 
√w_°©e
 = 
ohci
->
˘l
 & 
OHCI_CTL_HCFS
;

886 i‡(
ﬁd_°©e
 =
√w_°©e
)

889 
√w_°©e
) {

890 
OHCI_USB_OPERATIONAL
:

891 
	`ohci_bus_°¨t
(
ohci
);

893 
OHCI_USB_SUSPEND
:

894 
	`ohci_bus_°›
(
ohci
);

895 
	`d¥ötf
("usb-ohci: %s: USB Su•íded\n", 
ohci
->
pci_dev
.
«me
);

897 
OHCI_USB_RESUME
:

898 
	`d¥ötf
("usb-ohci: %s: USB Resume\n", 
ohci
->
pci_dev
.
«me
);

900 
OHCI_USB_RESET
:

901 
	`d¥ötf
("usb-ohci: %s: USB Re£t\n", 
ohci
->
pci_dev
.
«me
);

904 
	}
}

906 
uöt32_t
 
	$ohci_gë_‰ame_ªmaöög
(
OHCISèã
 *
ohci
)

908 
uöt16_t
 
‰
;

909 
öt64_t
 
tks
;

911 i‡((
ohci
->
˘l
 & 
OHCI_CTL_HCFS
Ë!
OHCI_USB_OPERATIONAL
)

912  (
ohci
->
‰t
 << 31);

917 
tks
 = 
	`qemu_gë_˛ock
(
vm_˛ock
Ë- 
ohci
->
sof_time
;

920 i‡(
tks
 >
usb_‰ame_time
)

921  (
ohci
->
‰t
 << 31);

923 
tks
 = 
	`muldiv64
(1,Åks, 
usb_bô_time
);

924 
‰
 = (
uöt16_t
)(
ohci
->
fi
 - 
tks
);

926  (
ohci
->
‰t
 << 31Ë| 
‰
;

927 
	}
}

931 
	$ohci_£t_hub_°©us
(
OHCISèã
 *
ohci
, 
uöt32_t
 
vÆ
)

933 
uöt32_t
 
ﬁd_°©e
;

935 
ﬁd_°©e
 = 
ohci
->
rh°©us
;

938 i‡(
vÆ
 & 
OHCI_RHS_OCIC
)

939 
ohci
->
rh°©us
 &~
OHCI_RHS_OCIC
;

941 i‡(
vÆ
 & 
OHCI_RHS_LPS
) {

942 
i
;

944 
i
 = 0; i < 
ohci
->
num_p‹ts
; i++)

945 
	`ohci_p‹t_powî
(
ohci
, 
i
, 0);

946 
	`d¥ötf
("usb-ohci:Öowered downállÖorts\n");

949 i‡(
vÆ
 & 
OHCI_RHS_LPSC
) {

950 
i
;

952 
i
 = 0; i < 
ohci
->
num_p‹ts
; i++)

953 
	`ohci_p‹t_powî
(
ohci
, 
i
, 1);

954 
	`d¥ötf
("usb-ohci:Öowered upállÖorts\n");

957 i‡(
vÆ
 & 
OHCI_RHS_DRWE
)

958 
ohci
->
rh°©us
 |
OHCI_RHS_DRWE
;

960 i‡(
vÆ
 & 
OHCI_RHS_CRWE
)

961 
ohci
->
rh°©us
 &~
OHCI_RHS_DRWE
;

963 i‡(
ﬁd_°©e
 !
ohci
->
rh°©us
)

964 
	`ohci_£t_öãºu±
(
ohci
, 
OHCI_INTR_RHSC
);

965 
	}
}

968 
	$ohci_p‹t_£t_°©us
(
OHCISèã
 *
ohci
, 
p‹äum
, 
uöt32_t
 
vÆ
)

970 
uöt32_t
 
ﬁd_°©e
;

971 
OHCIP‹t
 *
p‹t
;

973 
p‹t
 = &
ohci
->
rhp‹t
[
p‹äum
];

974 
ﬁd_°©e
 = 
p‹t
->
˘æ
;

977 i‡(
vÆ
 & 
OHCI_PORT_WTC
)

978 
p‹t
->
˘æ
 &~(
vÆ
 & 
OHCI_PORT_WTC
);

980 i‡(
vÆ
 & 
OHCI_PORT_CCS
)

981 
p‹t
->
˘æ
 &~
OHCI_PORT_PES
;

983 
	`ohci_p‹t_£t_if_c⁄√˘ed
(
ohci
, 
p‹äum
, 
vÆ
 & 
OHCI_PORT_PES
);

985 i‡(
	`ohci_p‹t_£t_if_c⁄√˘ed
(
ohci
, 
p‹äum
, 
vÆ
 & 
OHCI_PORT_PSS
))

986 
	`d¥ötf
("usb-ohci:Ö‹à%d: SUSPEND\n", 
p‹äum
);

988 i‡(
	`ohci_p‹t_£t_if_c⁄√˘ed
(
ohci
, 
p‹äum
, 
vÆ
 & 
OHCI_PORT_PRS
)) {

989 
	`d¥ötf
("usb-ohci:Ö‹à%d: RESET\n", 
p‹äum
);

990 
	`usb_£nd_msg
(
p‹t
->p‹t.
dev
, 
USB_MSG_RESET
);

991 
p‹t
->
˘æ
 &~
OHCI_PORT_PRS
;

993 
p‹t
->
˘æ
 |
OHCI_PORT_PES
 | 
OHCI_PORT_PRSC
;

999 i‡(
vÆ
 & 
OHCI_PORT_LSDA
)

1000 
	`ohci_p‹t_powî
(
ohci
, 
p‹äum
, 0);

1001 i‡(
vÆ
 & 
OHCI_PORT_PPS
)

1002 
	`ohci_p‹t_powî
(
ohci
, 
p‹äum
, 1);

1004 i‡(
ﬁd_°©e
 !
p‹t
->
˘æ
)

1005 
	`ohci_£t_öãºu±
(
ohci
, 
OHCI_INTR_RHSC
);

1008 
	}
}

1010 
uöt32_t
 
	$ohci_mem_ªad
(*
±r
, 
èrgë_phys_addr_t
 
addr
)

1012 
OHCISèã
 *
ohci
 = 
±r
;

1014 
addr
 -
ohci
->
mem_ba£
;

1017 i‡(
addr
 & 3) {

1018 
	`Ârötf
(
°dîr
, "usb-ohci: Mis-alignedÑead\n");

1022 i‡(
addr
 >0x54 &&ádd∏< 0x54 + 
ohci
->
num_p‹ts
 * 4) {

1024  
ohci
->
rhp‹t
[(
addr
 - 0x54Ë>> 2].
˘æ
 | 
OHCI_PORT_PPS
;

1027 
addr
 >> 2) {

1032  
ohci
->
˘l
;

1035  
ohci
->
°©us
;

1038  
ohci
->
öå_°©us
;

1042  
ohci
->
öå
;

1045  
ohci
->
hcˇ
;

1048  
ohci
->
≥r_cur
;

1051  
ohci
->
˘æ_hód
;

1054  
ohci
->
˘æ_cur
;

1057  
ohci
->
bulk_hód
;

1060  
ohci
->
bulk_cur
;

1063  
ohci
->
d⁄e
;

1066  (
ohci
->
fô
 << 31Ë| (ohci->
fsmps
 << 16Ë| (ohci->
fi
);

1069  
	`ohci_gë_‰ame_ªmaöög
(
ohci
);

1072  
ohci
->
‰ame_numbî
;

1075  
ohci
->
p°¨t
;

1078  
ohci
->
l°
;

1081  
ohci
->
rhdesc_a
;

1084  
ohci
->
rhdesc_b
;

1087  
ohci
->
rh°©us
;

1090 
	`Ârötf
(
°dîr
, "ohci_ªad: Bad off£à%x\n", ()
addr
);

1093 
	}
}

1095 
	$ohci_mem_wrôe
(*
±r
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

1097 
OHCISèã
 *
ohci
 = 
±r
;

1099 
addr
 -
ohci
->
mem_ba£
;

1102 i‡(
addr
 & 3) {

1103 
	`Ârötf
(
°dîr
, "usb-ohci: Mis-aligned write\n");

1107 i‡(
addr
 >0x54 &&ádd∏< 0x54 + 
ohci
->
num_p‹ts
 * 4) {

1109 
	`ohci_p‹t_£t_°©us
(
ohci
, (
addr
 - 0x54Ë>> 2, 
vÆ
);

1113 
addr
 >> 2) {

1115 
	`ohci_£t_˘l
(
ohci
, 
vÆ
);

1120 
vÆ
 = (vÆ & ~
OHCI_STATUS_SOC
);

1123 
ohci
->
°©us
 |
vÆ
;

1125 i‡(
ohci
->
°©us
 & 
OHCI_STATUS_HCR
)

1126 
	`ohci_ª£t
(
ohci
);

1130 
ohci
->
öå_°©us
 &~
vÆ
;

1131 
	`ohci_öå_upd©e
(
ohci
);

1135 
ohci
->
öå
 |
vÆ
;

1136 
	`ohci_öå_upd©e
(
ohci
);

1140 
ohci
->
öå
 &~
vÆ
;

1141 
	`ohci_öå_upd©e
(
ohci
);

1145 
ohci
->
hcˇ
 = 
vÆ
 & 
OHCI_HCCA_MASK
;

1149 
ohci
->
˘æ_hód
 = 
vÆ
 & 
OHCI_EDPTR_MASK
;

1153 
ohci
->
˘æ_cur
 = 
vÆ
 & 
OHCI_EDPTR_MASK
;

1157 
ohci
->
bulk_hód
 = 
vÆ
 & 
OHCI_EDPTR_MASK
;

1161 
ohci
->
bulk_cur
 = 
vÆ
 & 
OHCI_EDPTR_MASK
;

1165 
ohci
->
fsmps
 = (
vÆ
 & 
OHCI_FMI_FSMPS
) >> 16;

1166 
ohci
->
fô
 = (
vÆ
 & 
OHCI_FMI_FIT
) >> 31;

1167 
	`ohci_£t_‰ame_öãrvÆ
(
ohci
, 
vÆ
);

1171 
ohci
->
p°¨t
 = 
vÆ
 & 0xffff;

1175 
ohci
->
l°
 = 
vÆ
 & 0xffff;

1179 
ohci
->
rhdesc_a
 &~
OHCI_RHA_RW_MASK
;

1180 
ohci
->
rhdesc_a
 |
vÆ
 & 
OHCI_RHA_RW_MASK
;

1187 
	`ohci_£t_hub_°©us
(
ohci
, 
vÆ
);

1191 
	`Ârötf
(
°dîr
, "ohci_wrôe: Bad off£à%x\n", ()
addr
);

1194 
	}
}

1197 
CPURódMem‹yFunc
 *
	gohci_ªad‚
[3]={

1198 
ohci_mem_ªad
,

1199 
ohci_mem_ªad
,

1200 
ohci_mem_ªad


1204 
CPUWrôeMem‹yFunc
 *
	gohci_wrôe‚
[3]={

1205 
ohci_mem_wrôe
,

1206 
ohci_mem_wrôe
,

1207 
ohci_mem_wrôe


1210 
	$ohci_m≠func
(
PCIDevi˚
 *
pci_dev
, 
i
,

1211 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

1213 
OHCISèã
 *
ohci
 = (OHCISèã *)
pci_dev
;

1214 
ohci
->
mem_ba£
 = 
addr
;

1215 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
size
, 
ohci
->
mem
);

1216 
	}
}

1218 
	$ohci_usb_ßve
(
QEMUFûe
 *
f
, *
›aque
)

1220 
OHCISèã
 *
ohci
 = 
›aque
;

1222 
	`pci_devi˚_ßve
(&
ohci
->
pci_dev
, 
f
);

1223 
	}
}

1225 
	$ohci_usb_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

1227 
OHCISèã
 *
ohci
 = 
›aque
;

1229  
	`pci_devi˚_lﬂd
(&
ohci
->
pci_dev
, 
f
);

1230 
	}
}

1232 
	$usb_ohci_öô
(
PCIBus
 *
bus
, 
num_p‹ts
, 
dev‚
)

1234 
OHCISèã
 *
ohci
;

1235 
vid
 = 0x106b;

1236 
did
 = 0x003f;

1237 
i
;

1240 i‡(
usb_‰ame_time
 == 0) {

1241 #i‡
OHCI_TIME_WARP


1242 
usb_‰ame_time
 = 
ticks_≥r_£c
;

1243 
usb_bô_time
 = 
	`muldiv64
(1, 
ticks_≥r_£c
, 
USB_HZ
/1000);

1245 
usb_‰ame_time
 = 
	`muldiv64
(1, 
ticks_≥r_£c
, 1000);

1246 i‡(
ticks_≥r_£c
 >
USB_HZ
) {

1247 
usb_bô_time
 = 
	`muldiv64
(1, 
ticks_≥r_£c
, 
USB_HZ
);

1249 
usb_bô_time
 = 1;

1252 
	`d¥ötf
("usb-ohci: usb_bit_time=%lli usb_frame_time=%lli\n",

1253 
usb_‰ame_time
, 
usb_bô_time
);

1256 
ohci
 = (
OHCISèã
 *)
	`pci_ªgi°î_devi˚
(
bus
, "OHCI USB", (*ohci),

1257 
dev‚
, 
NULL
, NULL);

1258 i‡(
ohci
 =
NULL
) {

1259 
	`Ârötf
(
°dîr
, "usb-ohci: FailedÅoÑegister PCI device\n");

1263 
ohci
->
pci_dev
.
c⁄fig
[0x00] = 
vid
 & 0xff;

1264 
ohci
->
pci_dev
.
c⁄fig
[0x01] = (
vid
 >> 8) & 0xff;

1265 
ohci
->
pci_dev
.
c⁄fig
[0x02] = 
did
 & 0xff;

1266 
ohci
->
pci_dev
.
c⁄fig
[0x03] = (
did
 >> 8) & 0xff;

1267 
ohci
->
pci_dev
.
c⁄fig
[0x09] = 0x10;

1268 
ohci
->
pci_dev
.
c⁄fig
[0x0a] = 0x3;

1269 
ohci
->
pci_dev
.
c⁄fig
[0x0b] = 0xc;

1270 
ohci
->
pci_dev
.
c⁄fig
[0x3d] = 0x01;

1272 
ohci
->
mem
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
ohci_ªad‚
, 
ohci_wrôe‚
, ohci);

1274 
	`pci_ªgi°î_io_ªgi⁄
((
PCIDevi˚
 *)
ohci
, 0, 256,

1275 
PCI_ADDRESS_SPACE_MEM
, 
ohci_m≠func
);

1277 
ohci
->
num_p‹ts
 =Çum_ports;

1278 
i
 = 0; i < 
num_p‹ts
; i++) {

1279 
	`qemu_ªgi°î_usb_p‹t
(&
ohci
->
rhp‹t
[
i
].
p‹t
, ohci, i, 
ohci_©èch
);

1282 
	`ªgi°î_ßvevm
("OHCI USB", 0, 1, 
ohci_usb_ßve
, 
ohci_usb_lﬂd
, 
ohci
);

1284 
ohci
->
async_td
 = 0;

1285 
	`ohci_ª£t
(
ohci
);

1286 
	}
}

	@usb-uhci.c

24 
	~"vl.h
"

29 
	#UHCI_CMD_GRESET
 (1 << 2)

	)

30 
	#UHCI_CMD_HCRESET
 (1 << 1)

	)

31 
	#UHCI_CMD_RS
 (1 << 0)

	)

33 
	#UHCI_STS_HCHALTED
 (1 << 5)

	)

34 
	#UHCI_STS_HCPERR
 (1 << 4)

	)

35 
	#UHCI_STS_HSERR
 (1 << 3)

	)

36 
	#UHCI_STS_RD
 (1 << 2)

	)

37 
	#UHCI_STS_USBERR
 (1 << 1)

	)

38 
	#UHCI_STS_USBINT
 (1 << 0)

	)

40 
	#TD_CTRL_SPD
 (1 << 29)

	)

41 
	#TD_CTRL_ERROR_SHIFT
 27

	)

42 
	#TD_CTRL_IOS
 (1 << 25)

	)

43 
	#TD_CTRL_IOC
 (1 << 24)

	)

44 
	#TD_CTRL_ACTIVE
 (1 << 23)

	)

45 
	#TD_CTRL_STALL
 (1 << 22)

	)

46 
	#TD_CTRL_BUFFER
 (1 << 21)

	)

47 
	#TD_CTRL_BABBLE
 (1 << 20)

	)

48 
	#TD_CTRL_NAK
 (1 << 19)

	)

49 
	#TD_CTRL_TIMEOUT
 (1 << 18)

	)

50 
	#TD_CTRL_BITSTUFF
 \

51 (1 << 17)

	)

52 
	#TD_CTRL_MASK
 \

53 (
TD_CTRL_BITSTUFF
 | 
TD_CTRL_TIMEOUT
 | 
TD_CTRL_NAK
 \

54 | 
TD_CTRL_BABBLE
 | 
TD_CTRL_BUFFER
 | 
TD_CTRL_STALL
)

	)

56 
	#UHCI_PORT_RESET
 (1 << 9)

	)

57 
	#UHCI_PORT_LSDA
 (1 << 8)

	)

58 
	#UHCI_PORT_ENC
 (1 << 3)

	)

59 
	#UHCI_PORT_EN
 (1 << 2)

	)

60 
	#UHCI_PORT_CSC
 (1 << 1)

	)

61 
	#UHCI_PORT_CCS
 (1 << 0)

	)

63 
	#FRAME_TIMER_FREQ
 1000

	)

65 
	#FRAME_MAX_LOOPS
 100

	)

67 
	#NB_PORTS
 2

	)

69 
	sUHCIP‹t
 {

70 
USBP‹t
 
	mp‹t
;

71 
uöt16_t
 
	m˘æ
;

72 } 
	tUHCIP‹t
;

74 
	sUHCISèã
 {

75 
PCIDevi˚
 
	mdev
;

76 
uöt16_t
 
	mcmd
;

77 
uöt16_t
 
	m°©us
;

78 
uöt16_t
 
	möå
;

79 
uöt16_t
 
	m‰num
;

80 
uöt32_t
 
	mÊ_ba£_addr
;

81 
uöt8_t
 
	msof_timög
;

82 
uöt8_t
 
	m°©us2
;

83 
QEMUTimî
 *
	m‰ame_timî
;

84 
UHCIP‹t
 
	mp‹ts
[
NB_PORTS
];

87 
uöt32_t
 
	m≥ndög_öt_mask
;

94 
uöt32_t
 
	masync_qh
;

95 
USBPackë
 
	musb_∑ckë
;

96 
uöt8_t
 
	musb_buf
[2048];

97 } 
	tUHCISèã
;

99 
	sUHCI_TD
 {

100 
uöt32_t
 
	mlök
;

101 
uöt32_t
 
	m˘æ
;

102 
uöt32_t
 
	mtokí
;

103 
uöt32_t
 
	mbuf„r
;

104 } 
	tUHCI_TD
;

106 
	sUHCI_QH
 {

107 
uöt32_t
 
	mlök
;

108 
uöt32_t
 
	mñ_lök
;

109 } 
	tUHCI_QH
;

111 
uhci_©èch
(
USBP‹t
 *
p‹t1
, 
USBDevi˚
 *
dev
);

113 
	$uhci_upd©e_úq
(
UHCISèã
 *
s
)

115 
Àvñ
;

116 i‡(((
s
->
°©us2
 & 1Ë&& (s->
öå
 & (1 << 2))) ||

117 ((
s
->
°©us2
 & 2Ë&& (s->
öå
 & (1 << 3))) ||

118 ((
s
->
°©us
 & 
UHCI_STS_USBERR
Ë&& (s->
öå
 & (1 << 0))) ||

119 ((
s
->
°©us
 & 
UHCI_STS_RD
Ë&& (s->
öå
 & (1 << 1))) ||

120 (
s
->
°©us
 & 
UHCI_STS_HSERR
) ||

121 (
s
->
°©us
 & 
UHCI_STS_HCPERR
)) {

122 
Àvñ
 = 1;

124 
Àvñ
 = 0;

126 
	`pci_£t_úq
(&
s
->
dev
, 3, 
Àvñ
);

127 
	}
}

129 
	$uhci_ª£t
(
UHCISèã
 *
s
)

131 
uöt8_t
 *
pci_c⁄f
;

132 
i
;

133 
UHCIP‹t
 *
p‹t
;

135 
pci_c⁄f
 = 
s
->
dev
.
c⁄fig
;

137 
pci_c⁄f
[0x6a] = 0x01;

138 
pci_c⁄f
[0x6b] = 0x00;

139 
s
->
cmd
 = 0;

140 
s
->
°©us
 = 0;

141 
s
->
°©us2
 = 0;

142 
s
->
öå
 = 0;

143 
s
->
Ê_ba£_addr
 = 0;

144 
s
->
sof_timög
 = 64;

145 
i
 = 0; i < 
NB_PORTS
; i++) {

146 
p‹t
 = &
s
->
p‹ts
[
i
];

147 
p‹t
->
˘æ
 = 0x0080;

148 i‡(
p‹t
->p‹t.
dev
)

149 
	`uhci_©èch
(&
p‹t
->p‹t,Ö‹t->p‹t.
dev
);

151 
	}
}

153 
	$uhci_i›‹t_wrôeb
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

155 
UHCISèã
 *
s
 = 
›aque
;

157 
addr
 &= 0x1f;

158 
addr
) {

160 
s
->
sof_timög
 = 
vÆ
;

163 
	}
}

165 
uöt32_t
 
	$uhci_i›‹t_ªadb
(*
›aque
, 
uöt32_t
 
addr
)

167 
UHCISèã
 *
s
 = 
›aque
;

168 
uöt32_t
 
vÆ
;

170 
addr
 &= 0x1f;

171 
addr
) {

173 
vÆ
 = 
s
->
sof_timög
;

176 
vÆ
 = 0xff;

179  
vÆ
;

180 
	}
}

182 
	$uhci_i›‹t_wrôew
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

184 
UHCISèã
 *
s
 = 
›aque
;

186 
addr
 &= 0x1f;

187 #ifde‡
DEBUG


188 
	`¥ötf
("uhcòwrôewÖ‹t=0x%04x vÆ=0x%04x\n", 
addr
, 
vÆ
);

190 
addr
) {

192 i‡((
vÆ
 & 
UHCI_CMD_RS
Ë&& !(
s
->
cmd
 & UHCI_CMD_RS)) {

194 
	`qemu_mod_timî
(
s
->
‰ame_timî
, 
	`qemu_gë_˛ock
(
vm_˛ock
));

195 
s
->
°©us
 &~
UHCI_STS_HCHALTED
;

196 } i‡(!(
vÆ
 & 
UHCI_CMD_RS
)) {

197 
s
->
°©us
 |
UHCI_STS_HCHALTED
;

199 i‡(
vÆ
 & 
UHCI_CMD_GRESET
) {

200 
UHCIP‹t
 *
p‹t
;

201 
USBDevi˚
 *
dev
;

202 
i
;

205 
i
 = 0; i < 
NB_PORTS
; i++) {

206 
p‹t
 = &
s
->
p‹ts
[
i
];

207 
dev
 = 
p‹t
->port.dev;

208 i‡(
dev
) {

209 
	`usb_£nd_msg
(
dev
, 
USB_MSG_RESET
);

212 
	`uhci_ª£t
(
s
);

215 i‡(
vÆ
 & 
UHCI_CMD_HCRESET
) {

216 
	`uhci_ª£t
(
s
);

219 
s
->
cmd
 = 
vÆ
;

222 
s
->
°©us
 &~
vÆ
;

225 i‡(
vÆ
 & 
UHCI_STS_USBINT
)

226 
s
->
°©us2
 = 0;

227 
	`uhci_upd©e_úq
(
s
);

230 
s
->
öå
 = 
vÆ
;

231 
	`uhci_upd©e_úq
(
s
);

234 i‡(
s
->
°©us
 & 
UHCI_STS_HCHALTED
)

235 
s
->
‰num
 = 
vÆ
 & 0x7ff;

239 
UHCIP‹t
 *
p‹t
;

240 
USBDevi˚
 *
dev
;

241 
n
;

243 
n
 = (
addr
 >> 1) & 7;

244 i‡(
n
 >
NB_PORTS
)

246 
p‹t
 = &
s
->
p‹ts
[
n
];

247 
dev
 = 
p‹t
->port.dev;

248 i‡(
dev
) {

250 i‡–(
vÆ
 & 
UHCI_PORT_RESET
) &&

251 !(
p‹t
->
˘æ
 & 
UHCI_PORT_RESET
) ) {

252 
	`usb_£nd_msg
(
dev
, 
USB_MSG_RESET
);

255 
p‹t
->
˘æ
 = (p‹t->˘æ & 0x01fbË| (
vÆ
 & ~0x01fb);

257 
p‹t
->
˘æ
 &~(
vÆ
 & 0x000a);

261 
	}
}

263 
uöt32_t
 
	$uhci_i›‹t_ªadw
(*
›aque
, 
uöt32_t
 
addr
)

265 
UHCISèã
 *
s
 = 
›aque
;

266 
uöt32_t
 
vÆ
;

268 
addr
 &= 0x1f;

269 
addr
) {

271 
vÆ
 = 
s
->
cmd
;

274 
vÆ
 = 
s
->
°©us
;

277 
vÆ
 = 
s
->
öå
;

280 
vÆ
 = 
s
->
‰num
;

284 
UHCIP‹t
 *
p‹t
;

285 
n
;

286 
n
 = (
addr
 >> 1) & 7;

287 i‡(
n
 >
NB_PORTS
)

288 
ªad_deÁu…
;

289 
p‹t
 = &
s
->
p‹ts
[
n
];

290 
vÆ
 = 
p‹t
->
˘æ
;

294 
ªad_deÁu…
:

295 
vÆ
 = 0xff7f;

298 #ifde‡
DEBUG


299 
	`¥ötf
("uhcòªadwÖ‹t=0x%04x vÆ=0x%04x\n", 
addr
, 
vÆ
);

301  
vÆ
;

302 
	}
}

304 
	$uhci_i›‹t_wrôñ
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

306 
UHCISèã
 *
s
 = 
›aque
;

308 
addr
 &= 0x1f;

309 #ifde‡
DEBUG


310 
	`¥ötf
("uhcòwrôñÖ‹t=0x%04x vÆ=0x%08x\n", 
addr
, 
vÆ
);

312 
addr
) {

314 
s
->
Ê_ba£_addr
 = 
vÆ
 & ~0xfff;

317 
	}
}

319 
uöt32_t
 
	$uhci_i›‹t_ªadl
(*
›aque
, 
uöt32_t
 
addr
)

321 
UHCISèã
 *
s
 = 
›aque
;

322 
uöt32_t
 
vÆ
;

324 
addr
 &= 0x1f;

325 
addr
) {

327 
vÆ
 = 
s
->
Ê_ba£_addr
;

330 
vÆ
 = 0xffffffff;

333  
vÆ
;

334 
	}
}

336 
	$uhci_©èch
(
USBP‹t
 *
p‹t1
, 
USBDevi˚
 *
dev
)

338 
UHCISèã
 *
s
 = 
p‹t1
->
›aque
;

339 
UHCIP‹t
 *
p‹t
 = &
s
->
p‹ts
[
p‹t1
->
ödex
];

341 i‡(
dev
) {

342 i‡(
p‹t
->p‹t.
dev
) {

343 
	`usb_©èch
(
p‹t1
, 
NULL
);

346 
p‹t
->
˘æ
 |
UHCI_PORT_CCS
 | 
UHCI_PORT_CSC
;

349 i‡(
dev
->
•ìd
 =
USB_SPEED_LOW
)

350 
p‹t
->
˘æ
 |
UHCI_PORT_LSDA
;

352 
p‹t
->
˘æ
 &~
UHCI_PORT_LSDA
;

353 
p‹t
->p‹t.
dev
 = dev;

355 
	`usb_£nd_msg
(
dev
, 
USB_MSG_ATTACH
);

358 i‡(
p‹t
->
˘æ
 & 
UHCI_PORT_CCS
) {

359 
p‹t
->
˘æ
 &~
UHCI_PORT_CCS
;

360 
p‹t
->
˘æ
 |
UHCI_PORT_CSC
;

363 i‡(
p‹t
->
˘æ
 & 
UHCI_PORT_EN
) {

364 
p‹t
->
˘æ
 &~
UHCI_PORT_EN
;

365 
p‹t
->
˘æ
 |
UHCI_PORT_ENC
;

367 
dev
 = 
p‹t
->port.dev;

368 i‡(
dev
) {

370 
	`usb_£nd_msg
(
dev
, 
USB_MSG_DETACH
);

372 
p‹t
->p‹t.
dev
 = 
NULL
;

374 
	}
}

376 
	$uhci_brﬂdˇ°_∑ckë
(
UHCISèã
 *
s
, 
USBPackë
 *
p
)

378 
UHCIP‹t
 *
p‹t
;

379 
USBDevi˚
 *
dev
;

380 
i
, 
ªt
;

382 #ifde‡
DEBUG_PACKET


384 c⁄° *
pid°r
;

385 
p
->
pid
) {

386 
USB_TOKEN_SETUP
: 
pid°r
 = "SETUP"; ;

387 
USB_TOKEN_IN
: 
pid°r
 = "IN"; ;

388 
USB_TOKEN_OUT
: 
pid°r
 = "OUT"; ;

389 : 
pid°r
 = "?"; ;

391 
	`¥ötf
("frame %d:Öid=%sáddr=0x%02xÉp=%dÜen=%d\n",

392 
s
->
‰num
, 
pid°r
, 
p
->
devaddr
,Ö->
devï
,Ö->
Àn
);

393 i‡(
p
->
pid
 !
USB_TOKEN_IN
) {

394 
	`¥ötf
(" data_out=");

395 
i
 = 0; i < 
p
->
Àn
; i++) {

396 
	`¥ötf
(" %02x", 
p
->
d©a
[
i
]);

398 
	`¥ötf
("\n");

402 
i
 = 0; i < 
NB_PORTS
; i++) {

403 
p‹t
 = &
s
->
p‹ts
[
i
];

404 
dev
 = 
p‹t
->port.dev;

405 i‡(
dev
 && (
p‹t
->
˘æ
 & 
UHCI_PORT_EN
)) {

406 
ªt
 = 
dev
->
	`h™dÀ_∑ckë
(dev, 
p
);

407 i‡(
ªt
 !
USB_RET_NODEV
) {

408 #ifde‡
DEBUG_PACKET


409 i‡(
ªt
 =
USB_RET_ASYNC
) {

410 
	`¥ötf
("usb-uhci: AsyncÖacket\n");

412 
	`¥ötf
("Ñë=%d ", 
ªt
);

413 i‡(
p
->
pid
 =
USB_TOKEN_IN
 && 
ªt
 > 0) {

414 
	`¥ötf
("data_in=");

415 
i
 = 0; i < 
ªt
; i++) {

416 
	`¥ötf
(" %02x", 
p
->
d©a
[
i
]);

419 
	`¥ötf
("\n");

422  
ªt
;

426  
USB_RET_NODEV
;

427 
	}
}

429 
uhci_async_com∂ëe_∑ckë
(
USBPackë
 * 
∑ckë
, *
›aque
);

435 
	$uhci_h™dÀ_td
(
UHCISèã
 *
s
, 
UHCI_TD
 *
td
, *
öt_mask
)

437 
uöt8_t
 
pid
;

438 
Àn
, 
max_Àn
, 
îr
, 
ªt
;

440 i‡(!(
td
->
˘æ
 & 
TD_CTRL_ACTIVE
)) {

441 
ªt
 = 1;

442 
out
;

446 
td
->
˘æ
 =Åd->˘æ & (~
TD_CTRL_MASK
);

449 
max_Àn
 = ((
td
->
tokí
 >> 21) + 1) & 0x7ff;

450 
pid
 = 
td
->
tokí
 & 0xff;

451 i‡(
s
->
async_qh
) {

452 
ªt
 = 
s
->
usb_∑ckë
.
Àn
;

453 i‡(
ªt
 >= 0) {

454 
Àn
 = 
ªt
;

455 i‡(
Àn
 > 
max_Àn
) {

456 
Àn
 = 
max_Àn
;

457 
ªt
 = 
USB_RET_BABBLE
;

459 i‡(
Àn
 > 0) {

461 
	`˝u_physiˇl_mem‹y_wrôe
(
td
->
buf„r
, 
s
->
usb_buf
, 
Àn
);

464 
Àn
 = 0;

466 
s
->
async_qh
 = 0;

468 
s
->
usb_∑ckë
.
pid
 =Öid;

469 
s
->
usb_∑ckë
.
devaddr
 = (
td
->
tokí
 >> 8) & 0x7f;

470 
s
->
usb_∑ckë
.
devï
 = (
td
->
tokí
 >> 15) & 0xf;

471 
s
->
usb_∑ckë
.
d©a
 = s->
usb_buf
;

472 
s
->
usb_∑ckë
.
Àn
 = 
max_Àn
;

473 
s
->
usb_∑ckë
.
com∂ëe_cb
 = 
uhci_async_com∂ëe_∑ckë
;

474 
s
->
usb_∑ckë
.
com∂ëe_›aque
 = s;

475 
pid
) {

476 
USB_TOKEN_OUT
:

477 
USB_TOKEN_SETUP
:

478 
	`˝u_physiˇl_mem‹y_ªad
(
td
->
buf„r
, 
s
->
usb_buf
, 
max_Àn
);

479 
ªt
 = 
	`uhci_brﬂdˇ°_∑ckë
(
s
, &s->
usb_∑ckë
);

480 
Àn
 = 
max_Àn
;

482 
USB_TOKEN_IN
:

483 
ªt
 = 
	`uhci_brﬂdˇ°_∑ckë
(
s
, &s->
usb_∑ckë
);

484 i‡(
ªt
 >= 0) {

485 
Àn
 = 
ªt
;

486 i‡(
Àn
 > 
max_Àn
) {

487 
Àn
 = 
max_Àn
;

488 
ªt
 = 
USB_RET_BABBLE
;

490 i‡(
Àn
 > 0) {

492 
	`˝u_physiˇl_mem‹y_wrôe
(
td
->
buf„r
, 
s
->
usb_buf
, 
Àn
);

495 
Àn
 = 0;

500 
s
->
°©us
 |
UHCI_STS_HCPERR
;

501 
	`uhci_upd©e_úq
(
s
);

502 
ªt
 = -1;

503 
out
;

506 i‡(
ªt
 =
USB_RET_ASYNC
) {

507 
ªt
 = 2;

508 
out
;

510 i‡(
td
->
˘æ
 & 
TD_CTRL_IOS
)

511 
td
->
˘æ
 &~
TD_CTRL_ACTIVE
;

512 i‡(
ªt
 >= 0) {

513 
td
->
˘æ
 = (td->˘æ & ~0x7ffË| ((
Àn
 - 1) & 0x7ff);

514 
td
->
˘æ
 &~
TD_CTRL_ACTIVE
;

515 i‡(
pid
 =
USB_TOKEN_IN
 &&

516 (
td
->
˘æ
 & 
TD_CTRL_SPD
) &&

517 
Àn
 < 
max_Àn
) {

518 *
öt_mask
 |= 0x02;

520 
ªt
 = 1;

521 
out
;

524 
ªt
 = 0;

525 
out
;

528 
ªt
) {

530 
USB_RET_NODEV
:

531 
do_timeout
:

532 
td
->
˘æ
 |
TD_CTRL_TIMEOUT
;

533 
îr
 = (
td
->
˘æ
 >> 
TD_CTRL_ERROR_SHIFT
) & 3;

534 i‡(
îr
 != 0) {

535 
îr
--;

536 i‡(
îr
 == 0) {

537 
td
->
˘æ
 &~
TD_CTRL_ACTIVE
;

538 
s
->
°©us
 |
UHCI_STS_USBERR
;

539 
	`uhci_upd©e_úq
(
s
);

542 
td
->
˘æ
 = (td->˘æ & ~(3 << 
TD_CTRL_ERROR_SHIFT
)) |

543 (
îr
 << 
TD_CTRL_ERROR_SHIFT
);

544 
ªt
 = 1;

545 
out
;

546 
USB_RET_NAK
:

547 
td
->
˘æ
 |
TD_CTRL_NAK
;

548 i‡(
pid
 =
USB_TOKEN_SETUP
)

549 
do_timeout
;

550 
ªt
 = 1;

551 
out
;

552 
USB_RET_STALL
:

553 
td
->
˘æ
 |
TD_CTRL_STALL
;

554 
td
->
˘æ
 &~
TD_CTRL_ACTIVE
;

555 
ªt
 = 1;

556 
out
;

557 
USB_RET_BABBLE
:

558 
td
->
˘æ
 |
TD_CTRL_BABBLE
 | 
TD_CTRL_STALL
;

559 
td
->
˘æ
 &~
TD_CTRL_ACTIVE
;

561 
ªt
 = -1;

562 
out
;

566 
out
:

568 i‡((
td
->
˘æ
 & 
TD_CTRL_IOC
Ë&& (!—d->˘æ & 
TD_CTRL_ACTIVE
))) {

569 *
öt_mask
 |= 0x01;

571  
ªt
;

572 
	}
}

574 
	$uhci_async_com∂ëe_∑ckë
(
USBPackë
 * 
∑ckë
, *
›aque
)

576 
UHCISèã
 *
s
 = 
›aque
;

577 
UHCI_QH
 
qh
;

578 
UHCI_TD
 
td
;

579 
uöt32_t
 
lök
;

580 
uöt32_t
 
ﬁd_td_˘æ
;

581 
uöt32_t
 
vÆ
;

582 
ªt
;

584 
lök
 = 
s
->
async_qh
;

585 i‡(!
lök
) {

590 
	`˝u_physiˇl_mem‹y_ªad
(
lök
 & ~0xf, (
uöt8_t
 *)&
qh
, (qh));

591 
	`À32_to_˝us
(&
qh
.
lök
);

592 
	`À32_to_˝us
(&
qh
.
ñ_lök
);

595 
	`˝u_physiˇl_mem‹y_ªad
(
qh
.
ñ_lök
 & ~0xf,

596 (
uöt8_t
 *)&
td
, (td));

597 
	`À32_to_˝us
(&
td
.
lök
);

598 
	`À32_to_˝us
(&
td
.
˘æ
);

599 
	`À32_to_˝us
(&
td
.
tokí
);

600 
	`À32_to_˝us
(&
td
.
buf„r
);

601 
ﬁd_td_˘æ
 = 
td
.
˘æ
;

602 
ªt
 = 
	`uhci_h™dÀ_td
(
s
, &
td
, &s->
≥ndög_öt_mask
);

604 i‡(
ﬁd_td_˘æ
 !
td
.
˘æ
) {

605 
vÆ
 = 
	`˝u_to_À32
(
td
.
˘æ
);

606 
	`˝u_physiˇl_mem‹y_wrôe
((
qh
.
ñ_lök
 & ~0xf) + 4,

607 (c⁄° 
uöt8_t
 *)&
vÆ
,

608 (
vÆ
));

610 i‡(
ªt
 < 0)

612 i‡(
ªt
 == 2) {

613 
s
->
async_qh
 = 
lök
;

615 } i‡(
ªt
 == 0) {

617 
qh
.
ñ_lök
 = 
td
.
lök
;

618 
vÆ
 = 
	`˝u_to_À32
(
qh
.
ñ_lök
);

619 
	`˝u_physiˇl_mem‹y_wrôe
((
lök
 & ~0xf) + 4,

620 (c⁄° 
uöt8_t
 *)&
vÆ
,

621 (
vÆ
));

622 i‡(!(
qh
.
ñ_lök
 & 4))

627 
	}
}

629 
	$uhci_‰ame_timî
(*
›aque
)

631 
UHCISèã
 *
s
 = 
›aque
;

632 
öt64_t
 
expúe_time
;

633 
uöt32_t
 
‰ame_addr
, 
lök
, 
ﬁd_td_˘æ
, 
vÆ
;

634 
öt_mask
, 
˙t
, 
ªt
;

635 
UHCI_TD
 
td
;

636 
UHCI_QH
 
qh
;

637 
uöt32_t
 
ﬁd_async_qh
;

639 i‡(!(
s
->
cmd
 & 
UHCI_CMD_RS
)) {

640 
	`qemu_dñ_timî
(
s
->
‰ame_timî
);

642 
s
->
°©us
 |
UHCI_STS_HCHALTED
;

646 
s
->
‰num
 = (s->frnum + 1) & 0x7ff;

647 i‡(
s
->
≥ndög_öt_mask
) {

648 
s
->
°©us2
 |s->
≥ndög_öt_mask
;

649 
s
->
°©us
 |
UHCI_STS_USBINT
;

650 
	`uhci_upd©e_úq
(
s
);

652 
ﬁd_async_qh
 = 
s
->
async_qh
;

653 
‰ame_addr
 = 
s
->
Ê_ba£_addr
 + ((s->
‰num
 & 0x3ff) << 2);

654 
	`˝u_physiˇl_mem‹y_ªad
(
‰ame_addr
, (
uöt8_t
 *)&
lök
, 4);

655 
	`À32_to_˝us
(&
lök
);

656 
öt_mask
 = 0;

657 
˙t
 = 
FRAME_MAX_LOOPS
;

658 (
lök
 & 1) == 0) {

659 i‡(--
˙t
 == 0)

662 i‡(
lök
 & 2) {

664 i‡(
lök
 =
s
->
async_qh
) {

667 
ﬁd_async_qh
 = 0;

670 
	`˝u_physiˇl_mem‹y_ªad
(
lök
 & ~0xf, (
uöt8_t
 *)&
qh
, (qh));

671 
	`À32_to_˝us
(&
qh
.
lök
);

672 
	`À32_to_˝us
(&
qh
.
ñ_lök
);

673 
dïth_fú°
:

674 i‡(
qh
.
ñ_lök
 & 1) {

676 
lök
 = 
qh
.link;

677 } i‡(
qh
.
ñ_lök
 & 2) {

679 
lök
 = 
qh
.
ñ_lök
;

680 } i‡(
s
->
async_qh
) {

683 
lök
 = 
qh
.link;

686 i‡(--
˙t
 == 0)

688 
	`˝u_physiˇl_mem‹y_ªad
(
qh
.
ñ_lök
 & ~0xf,

689 (
uöt8_t
 *)&
td
, (td));

690 
	`À32_to_˝us
(&
td
.
lök
);

691 
	`À32_to_˝us
(&
td
.
˘æ
);

692 
	`À32_to_˝us
(&
td
.
tokí
);

693 
	`À32_to_˝us
(&
td
.
buf„r
);

694 
ﬁd_td_˘æ
 = 
td
.
˘æ
;

695 
ªt
 = 
	`uhci_h™dÀ_td
(
s
, &
td
, &
öt_mask
);

697 i‡(
ﬁd_td_˘æ
 !
td
.
˘æ
) {

698 
vÆ
 = 
	`˝u_to_À32
(
td
.
˘æ
);

699 
	`˝u_physiˇl_mem‹y_wrôe
((
qh
.
ñ_lök
 & ~0xf) + 4,

700 (c⁄° 
uöt8_t
 *)&
vÆ
,

701 (
vÆ
));

703 i‡(
ªt
 < 0)

705 i‡(
ªt
 == 2) {

706 
s
->
async_qh
 = 
lök
;

707 } i‡(
ªt
 == 0) {

709 
qh
.
ñ_lök
 = 
td
.
lök
;

710 
vÆ
 = 
	`˝u_to_À32
(
qh
.
ñ_lök
);

711 
	`˝u_physiˇl_mem‹y_wrôe
((
lök
 & ~0xf) + 4,

712 (c⁄° 
uöt8_t
 *)&
vÆ
,

713 (
vÆ
));

714 i‡(
qh
.
ñ_lök
 & 4) {

716 
dïth_fú°
;

720 
lök
 = 
qh
.link;

724 
	`˝u_physiˇl_mem‹y_ªad
(
lök
 & ~0xf, (
uöt8_t
 *)&
td
, (td));

725 
	`À32_to_˝us
(&
td
.
lök
);

726 
	`À32_to_˝us
(&
td
.
˘æ
);

727 
	`À32_to_˝us
(&
td
.
tokí
);

728 
	`À32_to_˝us
(&
td
.
buf„r
);

732 i‡(
s
->
async_qh
 == 0) {

733 
ﬁd_td_˘æ
 = 
td
.
˘æ
;

734 
ªt
 = 
	`uhci_h™dÀ_td
(
s
, &
td
, &
öt_mask
);

736 i‡(
ﬁd_td_˘æ
 !
td
.
˘æ
) {

737 
vÆ
 = 
	`˝u_to_À32
(
td
.
˘æ
);

738 
	`˝u_physiˇl_mem‹y_wrôe
((
lök
 & ~0xf) + 4,

739 (c⁄° 
uöt8_t
 *)&
vÆ
,

740 (
vÆ
));

742 i‡(
ªt
 < 0)

744 i‡(
ªt
 == 2) {

747 
	`Ârötf
(
°dîr
, "usb-uhci: UnimplementedásyncÖacket\n");

748 
	`usb_ˇn˚l_∑ckë
(&
s
->
usb_∑ckë
);

751 
lök
 = 
td
.link;

754 
s
->
≥ndög_öt_mask
 = 
öt_mask
;

755 i‡(
ﬁd_async_qh
) {

759 #ifde‡
DEBUG


760 
	`¥ötf
("Discarding USBÖacket\n");

762 
	`usb_ˇn˚l_∑ckë
(&
s
->
usb_∑ckë
);

763 
s
->
async_qh
 = 0;

766 
expúe_time
 = 
	`qemu_gë_˛ock
(
vm_˛ock
) +

767 (
ticks_≥r_£c
 / 
FRAME_TIMER_FREQ
);

768 
	`qemu_mod_timî
(
s
->
‰ame_timî
, 
expúe_time
);

769 
	}
}

771 
	$uhci_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

772 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

774 
UHCISèã
 *
s
 = (UHCISèã *)
pci_dev
;

776 
	`ªgi°î_i›‹t_wrôe
(
addr
, 32, 2, 
uhci_i›‹t_wrôew
, 
s
);

777 
	`ªgi°î_i›‹t_ªad
(
addr
, 32, 2, 
uhci_i›‹t_ªadw
, 
s
);

778 
	`ªgi°î_i›‹t_wrôe
(
addr
, 32, 4, 
uhci_i›‹t_wrôñ
, 
s
);

779 
	`ªgi°î_i›‹t_ªad
(
addr
, 32, 4, 
uhci_i›‹t_ªadl
, 
s
);

780 
	`ªgi°î_i›‹t_wrôe
(
addr
, 32, 1, 
uhci_i›‹t_wrôeb
, 
s
);

781 
	`ªgi°î_i›‹t_ªad
(
addr
, 32, 1, 
uhci_i›‹t_ªadb
, 
s
);

782 
	}
}

784 
	$uhci_usb_ßve
(
QEMUFûe
 *
f
, *
›aque
)

786 
i
;

787 
UHCISèã
 *
s
 = (UHCISèã*)
›aque
;

789 
	`pci_devi˚_ßve
(&
s
->
dev
, 
f
);

791 
	`qemu_put_be16s
(
f
, &
s
->
cmd
);

792 
	`qemu_put_be16s
(
f
, &
s
->
°©us
);

793 
	`qemu_put_be16s
(
f
, &
s
->
öå
);

794 
	`qemu_put_be16s
(
f
, &
s
->
‰num
);

795 
	`qemu_put_be32s
(
f
, &
s
->
Ê_ba£_addr
);

796 
	`qemu_put_8s
(
f
, &
s
->
sof_timög
);

797 
	`qemu_put_8s
(
f
, &
s
->
°©us2
);

799 
i
 = 0; i < 
NB_PORTS
; i++) {

800 
	`qemu_put_be16s
(
f
, &
s
->
p‹ts
[
i
].
˘æ
);

803 
	`qemu_put_timî
(
f
, 
s
->
‰ame_timî
);

804 
	}
}

806 
	$uhci_usb_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

808 
i
;

809 
UHCISèã
 *
s
 = (UHCISèã*)
›aque
;

811 i‡(
vîsi⁄_id
 != 1)

812  -
EINVAL
;

814 
i
 = 
	`pci_devi˚_lﬂd
(&
s
->
dev
, 
f
);

815 i‡(
i
 < 0)

816  
i
;

818 
	`qemu_gë_be16s
(
f
, &
s
->
cmd
);

819 
	`qemu_gë_be16s
(
f
, &
s
->
°©us
);

820 
	`qemu_gë_be16s
(
f
, &
s
->
öå
);

821 
	`qemu_gë_be16s
(
f
, &
s
->
‰num
);

822 
	`qemu_gë_be32s
(
f
, &
s
->
Ê_ba£_addr
);

823 
	`qemu_gë_8s
(
f
, &
s
->
sof_timög
);

824 
	`qemu_gë_8s
(
f
, &
s
->
°©us2
);

826 
i
 = 0; i < 
NB_PORTS
; i++) {

827 
	`qemu_gë_be16s
(
f
, &
s
->
p‹ts
[
i
].
˘æ
);

830 
	`qemu_gë_timî
(
f
, 
s
->
‰ame_timî
);

833 
	}
}

835 
	$usb_uhci_öô
(
PCIBus
 *
bus
, 
dev‚
)

837 
UHCISèã
 *
s
;

838 
uöt8_t
 *
pci_c⁄f
;

839 
i
;

841 
s
 = (
UHCISèã
 *)
	`pci_ªgi°î_devi˚
(
bus
,

842 "USB-UHCI", (
UHCISèã
),

843 
dev‚
, 
NULL
, NULL);

844 
pci_c⁄f
 = 
s
->
dev
.
c⁄fig
;

845 
pci_c⁄f
[0x00] = 0x86;

846 
pci_c⁄f
[0x01] = 0x80;

847 
pci_c⁄f
[0x02] = 0x20;

848 
pci_c⁄f
[0x03] = 0x70;

849 
pci_c⁄f
[0x08] = 0x01;

850 
pci_c⁄f
[0x09] = 0x00;

851 
pci_c⁄f
[0x0a] = 0x03;

852 
pci_c⁄f
[0x0b] = 0x0c;

853 
pci_c⁄f
[0x0e] = 0x00;

854 
pci_c⁄f
[0x3d] = 4;

855 
pci_c⁄f
[0x60] = 0x10;

856 
pci_c⁄f
[0x2c] =Öci_conf[0x00];

857 
pci_c⁄f
[0x2d] =Öci_conf[0x01];

859 
i
 = 0; i < 
NB_PORTS
; i++) {

860 
	`qemu_ªgi°î_usb_p‹t
(&
s
->
p‹ts
[
i
].
p‹t
, s, i, 
uhci_©èch
);

862 
s
->
‰ame_timî
 = 
	`qemu_√w_timî
(
vm_˛ock
, 
uhci_‰ame_timî
, s);

864 
	`uhci_ª£t
(
s
);

868 
	`pci_ªgi°î_io_ªgi⁄
(&
s
->
dev
, 4, 0x20,

869 
PCI_ADDRESS_SPACE_IO
, 
uhci_m≠
);

871 
	`ªgi°î_ßvevm
("UHCI usb c⁄åﬁÀr", 0, 1, 
uhci_usb_ßve
, 
uhci_usb_lﬂd
, 
s
);

872 
	}
}

	@usb.c

24 
	~"vl.h
"

26 
	$usb_©èch
(
USBP‹t
 *
p‹t
, 
USBDevi˚
 *
dev
)

28 
p‹t
->
	`©èch
’‹t, 
dev
);

29 
	}
}

37 
	#SETUP_STATE_IDLE
 0

	)

38 
	#SETUP_STATE_DATA
 1

	)

39 
	#SETUP_STATE_ACK
 2

	)

41 
	$usb_gíîic_h™dÀ_∑ckë
(
USBDevi˚
 *
s
, 
USBPackë
 *
p
)

43 
l
, 
ªt
 = 0;

44 
Àn
 = 
p
->len;

45 
uöt8_t
 *
d©a
 = 
p
->data;

47 
p
->
pid
) {

48 
USB_MSG_ATTACH
:

49 
s
->
°©e
 = 
USB_STATE_ATTACHED
;

51 
USB_MSG_DETACH
:

52 
s
->
°©e
 = 
USB_STATE_NOTATTACHED
;

54 
USB_MSG_RESET
:

55 
s
->
ªmŸe_wakeup
 = 0;

56 
s
->
addr
 = 0;

57 
s
->
°©e
 = 
USB_STATE_DEFAULT
;

58 
s
->
	`h™dÀ_ª£t
(s);

60 
USB_TOKEN_SETUP
:

61 i‡(
s
->
°©e
 < 
USB_STATE_DEFAULT
 || 
p
->
devaddr
 !s->
addr
)

62  
USB_RET_NODEV
;

63 i‡(
Àn
 != 8)

64 
Áû
;

65 
	`mem˝y
(
s
->
£tup_buf
, 
d©a
, 8);

66 
s
->
£tup_Àn
 = (s->
£tup_buf
[7] << 8) | s->setup_buf[6];

67 
s
->
£tup_ödex
 = 0;

68 i‡(
s
->
£tup_buf
[0] & 
USB_DIR_IN
) {

69 
ªt
 = 
s
->
	`h™dÀ_c⁄åﬁ
(s,

70 (
s
->
£tup_buf
[0] << 8) | s->setup_buf[1],

71 (
s
->
£tup_buf
[3] << 8) | s->setup_buf[2],

72 (
s
->
£tup_buf
[5] << 8) | s->setup_buf[4],

73 
s
->
£tup_Àn
,

74 
s
->
d©a_buf
);

75 i‡(
ªt
 < 0)

76  
ªt
;

77 i‡(
ªt
 < 
s
->
£tup_Àn
)

78 
s
->
£tup_Àn
 = 
ªt
;

79 
s
->
£tup_°©e
 = 
SETUP_STATE_DATA
;

81 i‡(
s
->
£tup_Àn
 == 0)

82 
s
->
£tup_°©e
 = 
SETUP_STATE_ACK
;

84 
s
->
£tup_°©e
 = 
SETUP_STATE_DATA
;

87 
USB_TOKEN_IN
:

88 i‡(
s
->
°©e
 < 
USB_STATE_DEFAULT
 || 
p
->
devaddr
 !s->
addr
)

89  
USB_RET_NODEV
;

90 
p
->
devï
) {

92 
s
->
£tup_°©e
) {

93 
SETUP_STATE_ACK
:

94 i‡(!(
s
->
£tup_buf
[0] & 
USB_DIR_IN
)) {

95 
s
->
£tup_°©e
 = 
SETUP_STATE_IDLE
;

96 
ªt
 = 
s
->
	`h™dÀ_c⁄åﬁ
(s,

97 (
s
->
£tup_buf
[0] << 8) | s->setup_buf[1],

98 (
s
->
£tup_buf
[3] << 8) | s->setup_buf[2],

99 (
s
->
£tup_buf
[5] << 8) | s->setup_buf[4],

100 
s
->
£tup_Àn
,

101 
s
->
d©a_buf
);

102 i‡(
ªt
 > 0)

103 
ªt
 = 0;

108 
SETUP_STATE_DATA
:

109 i‡(
s
->
£tup_buf
[0] & 
USB_DIR_IN
) {

110 
l
 = 
s
->
£tup_Àn
 - s->
£tup_ödex
;

111 i‡(
l
 > 
Àn
)

112 
l
 = 
Àn
;

113 
	`mem˝y
(
d©a
, 
s
->
d©a_buf
 + s->
£tup_ödex
, 
l
);

114 
s
->
£tup_ödex
 +
l
;

115 i‡(
s
->
£tup_ödex
 >s->
£tup_Àn
)

116 
s
->
£tup_°©e
 = 
SETUP_STATE_ACK
;

117 
ªt
 = 
l
;

119 
s
->
£tup_°©e
 = 
SETUP_STATE_IDLE
;

120 
Áû
;

124 
Áû
;

128 
ªt
 = 
s
->
	`h™dÀ_d©a
(s, 
p
);

132 
USB_TOKEN_OUT
:

133 i‡(
s
->
°©e
 < 
USB_STATE_DEFAULT
 || 
p
->
devaddr
 !s->
addr
)

134  
USB_RET_NODEV
;

135 
p
->
devï
) {

137 
s
->
£tup_°©e
) {

138 
SETUP_STATE_ACK
:

139 i‡(
s
->
£tup_buf
[0] & 
USB_DIR_IN
) {

140 
s
->
£tup_°©e
 = 
SETUP_STATE_IDLE
;

146 
SETUP_STATE_DATA
:

147 i‡(!(
s
->
£tup_buf
[0] & 
USB_DIR_IN
)) {

148 
l
 = 
s
->
£tup_Àn
 - s->
£tup_ödex
;

149 i‡(
l
 > 
Àn
)

150 
l
 = 
Àn
;

151 
	`mem˝y
(
s
->
d©a_buf
 + s->
£tup_ödex
, 
d©a
, 
l
);

152 
s
->
£tup_ödex
 +
l
;

153 i‡(
s
->
£tup_ödex
 >s->
£tup_Àn
)

154 
s
->
£tup_°©e
 = 
SETUP_STATE_ACK
;

155 
ªt
 = 
l
;

157 
s
->
£tup_°©e
 = 
SETUP_STATE_IDLE
;

158 
Áû
;

162 
Áû
;

166 
ªt
 = 
s
->
	`h™dÀ_d©a
(s, 
p
);

171 
Áû
:

172 
ªt
 = 
USB_RET_STALL
;

175  
ªt
;

176 
	}
}

179 
	$£t_usb_°rög
(
uöt8_t
 *
buf
, c⁄° *
°r
)

181 
Àn
, 
i
;

182 
uöt8_t
 *
q
;

184 
q
 = 
buf
;

185 
Àn
 = 
	`°æí
(
°r
);

186 *
q
++ = 2 * 
Àn
 + 2;

187 *
q
++ = 3;

188 
i
 = 0; i < 
Àn
; i++) {

189 *
q
++ = 
°r
[
i
];

190 *
q
++ = 0;

192  
q
 - 
buf
;

193 
	}
}

196 
	$usb_£nd_msg
(
USBDevi˚
 *
dev
, 
msg
)

198 
USBPackë
 
p
;

199 
	`mem£t
(&
p
, 0, (p));

200 
p
.
pid
 = 
msg
;

201 
dev
->
	`h™dÀ_∑ckë
(dev, &
p
);

202 
	}
}

204 
	$gíîic_usb_ßve
(
QEMUFûe
* 
f
, *
›aque
)

206 
USBDevi˚
 *
s
 = (USBDevi˚*)
›aque
;

208 
	`qemu_put_be32s
(
f
, &
s
->
•ìd
);

209 
	`qemu_put_8s
(
f
, &
s
->
addr
);

210 
	`qemu_put_be32s
(
f
, &
s
->
°©e
);

212 
	`qemu_put_buf„r
(
f
, 
s
->
£tup_buf
, 8);

213 
	`qemu_put_buf„r
(
f
, 
s
->
d©a_buf
, 1024);

215 
	`qemu_put_be32s
(
f
, &
s
->
ªmŸe_wakeup
);

216 
	`qemu_put_be32s
(
f
, &
s
->
£tup_°©e
);

217 
	`qemu_put_be32s
(
f
, &
s
->
£tup_Àn
);

218 
	`qemu_put_be32s
(
f
, &
s
->
£tup_ödex
);

220 
	}
}

222 
	$gíîic_usb_lﬂd
(
QEMUFûe
* 
f
, *
›aque
, 
vîsi⁄_id
)

224 
USBDevi˚
 *
s
 = (USBDevi˚*)
›aque
;

226 i‡(
vîsi⁄_id
 != 1)

227  -
EINVAL
;

229 
	`qemu_gë_be32s
(
f
, &
s
->
•ìd
);

230 
	`qemu_gë_8s
(
f
, &
s
->
addr
);

231 
	`qemu_gë_be32s
(
f
, &
s
->
°©e
);

233 
	`qemu_gë_buf„r
(
f
, 
s
->
£tup_buf
, 8);

234 
	`qemu_gë_buf„r
(
f
, 
s
->
d©a_buf
, 1024);

236 
	`qemu_gë_be32s
(
f
, &
s
->
ªmŸe_wakeup
);

237 
	`qemu_gë_be32s
(
f
, &
s
->
£tup_°©e
);

238 
	`qemu_gë_be32s
(
f
, &
s
->
£tup_Àn
);

239 
	`qemu_gë_be32s
(
f
, &
s
->
£tup_ödex
);

242 
	}
}

	@usb.h

24 
	#USB_TOKEN_SETUP
 0x2d

	)

25 
	#USB_TOKEN_IN
 0x69

	)

26 
	#USB_TOKEN_OUT
 0xe1

	)

29 
	#USB_MSG_ATTACH
 0x100

	)

30 
	#USB_MSG_DETACH
 0x101

	)

31 
	#USB_MSG_RESET
 0x102

	)

33 
	#USB_RET_NODEV
 (-1)

	)

34 
	#USB_RET_NAK
 (-2)

	)

35 
	#USB_RET_STALL
 (-3)

	)

36 
	#USB_RET_BABBLE
 (-4)

	)

37 
	#USB_RET_ASYNC
 (-5)

	)

39 
	#USB_SPEED_LOW
 0

	)

40 
	#USB_SPEED_FULL
 1

	)

41 
	#USB_SPEED_HIGH
 2

	)

43 
	#USB_STATE_NOTATTACHED
 0

	)

44 
	#USB_STATE_ATTACHED
 1

	)

46 
	#USB_STATE_DEFAULT
 3

	)

49 
	#USB_STATE_SUSPENDED
 6

	)

51 
	#USB_CLASS_AUDIO
 1

	)

52 
	#USB_CLASS_COMM
 2

	)

53 
	#USB_CLASS_HID
 3

	)

54 
	#USB_CLASS_PHYSICAL
 5

	)

55 
	#USB_CLASS_STILL_IMAGE
 6

	)

56 
	#USB_CLASS_PRINTER
 7

	)

57 
	#USB_CLASS_MASS_STORAGE
 8

	)

58 
	#USB_CLASS_HUB
 9

	)

59 
	#USB_CLASS_CDC_DATA
 0x0a

	)

60 
	#USB_CLASS_CSCID
 0x0b

	)

61 
	#USB_CLASS_CONTENT_SEC
 0x0d

	)

62 
	#USB_CLASS_APP_SPEC
 0x„

	)

63 
	#USB_CLASS_VENDOR_SPEC
 0xff

	)

65 
	#USB_DIR_OUT
 0

	)

66 
	#USB_DIR_IN
 0x80

	)

68 
	#USB_TYPE_MASK
 (0x03 << 5)

	)

69 
	#USB_TYPE_STANDARD
 (0x00 << 5)

	)

70 
	#USB_TYPE_CLASS
 (0x01 << 5)

	)

71 
	#USB_TYPE_VENDOR
 (0x02 << 5)

	)

72 
	#USB_TYPE_RESERVED
 (0x03 << 5)

	)

74 
	#USB_RECIP_MASK
 0x1f

	)

75 
	#USB_RECIP_DEVICE
 0x00

	)

76 
	#USB_RECIP_INTERFACE
 0x01

	)

77 
	#USB_RECIP_ENDPOINT
 0x02

	)

78 
	#USB_RECIP_OTHER
 0x03

	)

80 
	#Devi˚Reque°
 ((
USB_DIR_IN
|
USB_TYPE_STANDARD
|
USB_RECIP_DEVICE
)<<8)

	)

81 
	#Devi˚OutReque°
 ((
USB_DIR_OUT
|
USB_TYPE_STANDARD
|
USB_RECIP_DEVICE
)<<8)

	)

82 
	#I¡îÁ˚Reque°
 \

83 ((
USB_DIR_IN
|
USB_TYPE_STANDARD
|
USB_RECIP_INTERFACE
)<<8)

	)

84 
	#I¡îÁ˚OutReque°
 \

85 ((
USB_DIR_OUT
|
USB_TYPE_STANDARD
|
USB_RECIP_INTERFACE
)<<8)

	)

86 
	#EndpoötReque°
 ((
USB_DIR_IN
|
USB_TYPE_STANDARD
|
USB_RECIP_ENDPOINT
)<<8)

	)

87 
	#EndpoötOutReque°
 \

88 ((
USB_DIR_OUT
|
USB_TYPE_STANDARD
|
USB_RECIP_ENDPOINT
)<<8)

	)

90 
	#USB_REQ_GET_STATUS
 0x00

	)

91 
	#USB_REQ_CLEAR_FEATURE
 0x01

	)

92 
	#USB_REQ_SET_FEATURE
 0x03

	)

93 
	#USB_REQ_SET_ADDRESS
 0x05

	)

94 
	#USB_REQ_GET_DESCRIPTOR
 0x06

	)

95 
	#USB_REQ_SET_DESCRIPTOR
 0x07

	)

96 
	#USB_REQ_GET_CONFIGURATION
 0x08

	)

97 
	#USB_REQ_SET_CONFIGURATION
 0x09

	)

98 
	#USB_REQ_GET_INTERFACE
 0x0A

	)

99 
	#USB_REQ_SET_INTERFACE
 0x0B

	)

100 
	#USB_REQ_SYNCH_FRAME
 0x0C

	)

102 
	#USB_DEVICE_SELF_POWERED
 0

	)

103 
	#USB_DEVICE_REMOTE_WAKEUP
 1

	)

105 
	#USB_DT_DEVICE
 0x01

	)

106 
	#USB_DT_CONFIG
 0x02

	)

107 
	#USB_DT_STRING
 0x03

	)

108 
	#USB_DT_INTERFACE
 0x04

	)

109 
	#USB_DT_ENDPOINT
 0x05

	)

111 
USBP‹t
 
	tUSBP‹t
;

112 
USBDevi˚
 
	tUSBDevi˚
;

113 
USBPackë
 
	tUSBPackë
;

116 
	sUSBDevi˚
 {

117 *
	m›aque
;

118 (*
	mh™dÀ_∑ckë
)(
USBDevi˚
 *
	mdev
, 
USBPackë
 *
	mp
);

119 (*
	mh™dÀ_de°roy
)(
USBDevi˚
 *
	mdev
);

121 
	m•ìd
;

126 (*
	mh™dÀ_ª£t
)(
USBDevi˚
 *
	mdev
);

127 (*
	mh™dÀ_c⁄åﬁ
)(
USBDevi˚
 *
	mdev
, 
	mªque°
, 
	mvÆue
,

128 
	mödex
, 
	mÀngth
, 
uöt8_t
 *
	md©a
);

129 (*
	mh™dÀ_d©a
)(
USBDevi˚
 *
	mdev
, 
USBPackë
 *
	mp
);

130 
uöt8_t
 
	maddr
;

131 
	mdev«me
[32];

133 
	m°©e
;

134 
uöt8_t
 
	m£tup_buf
[8];

135 
uöt8_t
 
	md©a_buf
[1024];

136 
	mªmŸe_wakeup
;

137 
	m£tup_°©e
;

138 
	m£tup_Àn
;

139 
	m£tup_ödex
;

142 (*
	tusb_©èch‚
)(
	tUSBP‹t
 *
	tp‹t
, 
	tUSBDevi˚
 *
	tdev
);

145 
	sUSBP‹t
 {

146 
USBDevi˚
 *
dev
;

147 
usb_©èch‚
 
©èch
;

148 *
›aque
;

149 
ödex
;

150 
USBP‹t
 *
√xt
;

153 
	tUSBCÆlback
(
	tUSBPackë
 * 
	t∑ckë
, *
	t›aque
);

156 
	sUSBPackë
 {

158 
pid
;

159 
uöt8_t
 
devaddr
;

160 
uöt8_t
 
devï
;

161 
uöt8_t
 *
d©a
;

162 
Àn
;

164 
USBCÆlback
 *
com∂ëe_cb
;

165 *
com∂ëe_›aque
;

166 
USBCÆlback
 *
ˇn˚l_cb
;

167 * *
ˇn˚l_›aque
;

173 
ölöe
 
	$usb_de„r_∑ckë
(
USBPackë
 *
p
, 
USBCÆlback
 *
ˇn˚l
,

174 * 
›aque
)

176 
p
->
ˇn˚l_cb
 = 
ˇn˚l
;

177 
p
->
ˇn˚l_›aque
 = 
›aque
;

178 
	}
}

183 
ölöe
 
	$usb_∑ckë_com∂ëe
(
USBPackë
 *
p
)

185 
p
->
	`com∂ëe_cb
’,Ö->
com∂ëe_›aque
);

186 
	}
}

190 
ölöe
 
	$usb_ˇn˚l_∑ckë
(
USBPackë
 * 
p
)

192 
p
->
	`ˇn˚l_cb
’,Ö->
ˇn˚l_›aque
);

193 
	}
}

195 
usb_©èch
(
USBP‹t
 *
p‹t
, 
USBDevi˚
 *
dev
);

196 
usb_gíîic_h™dÀ_∑ckë
(
USBDevi˚
 *
s
, 
USBPackë
 *
p
);

197 
£t_usb_°rög
(
uöt8_t
 *
buf
, c⁄° *
°r
);

198 
usb_£nd_msg
(
USBDevi˚
 *
dev
, 
msg
);

200 
usb_∑ckë_com∂ëe
(
USBPackë
 *
p
);

203 
USBDevi˚
 *
usb_hub_öô
(
nb_p‹ts
);

206 
usb_uhci_öô
(
PCIBus
 *
bus
, 
dev‚
);

209 
usb_ohci_öô
(
PCIBus
 *
bus
, 
num_p‹ts
, 
dev‚
);

212 
USBDevi˚
 *
usb_ho°_devi˚_›í
(c⁄° *
dev«me
);

213 
usb_ho°_öfo
();

216 
USBDevi˚
 *
usb_mou£_öô
();

217 
USBDevi˚
 *
usb_èbÀt_öô
();

220 
USBDevi˚
 *
usb_msd_öô
(c⁄° *
fûíame
);

223 
gíîic_usb_ßve
(
QEMUFûe
* 
f
, *
›aque
);

224 
gíîic_usb_lﬂd
(
QEMUFûe
* 
f
, *
›aque
, 
vîsi⁄_id
);

	@versatile_pci.c

10 
	~"vl.h
"

12 
ölöe
 
uöt32_t
 
	$vpb_pci_c⁄fig_addr
(
èrgë_phys_addr_t
 
addr
)

14  
addr
 & 0xffffff;

15 
	}
}

17 
	$pci_vpb_c⁄fig_wrôeb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

18 
uöt32_t
 
vÆ
)

20 
	`pci_d©a_wrôe
(
›aque
, 
	`vpb_pci_c⁄fig_addr
 (
addr
), 
vÆ
, 1);

21 
	}
}

23 
	$pci_vpb_c⁄fig_wrôew
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

24 
uöt32_t
 
vÆ
)

26 #ifde‡
TARGET_WORDS_BIGENDIAN


27 
vÆ
 = 
	`bsw≠16
(val);

29 
	`pci_d©a_wrôe
(
›aque
, 
	`vpb_pci_c⁄fig_addr
 (
addr
), 
vÆ
, 2);

30 
	}
}

32 
	$pci_vpb_c⁄fig_wrôñ
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
,

33 
uöt32_t
 
vÆ
)

35 #ifde‡
TARGET_WORDS_BIGENDIAN


36 
vÆ
 = 
	`bsw≠32
(val);

38 
	`pci_d©a_wrôe
(
›aque
, 
	`vpb_pci_c⁄fig_addr
 (
addr
), 
vÆ
, 4);

39 
	}
}

41 
uöt32_t
 
	$pci_vpb_c⁄fig_ªadb
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

43 
uöt32_t
 
vÆ
;

44 
vÆ
 = 
	`pci_d©a_ªad
(
›aque
, 
	`vpb_pci_c⁄fig_addr
 (
addr
), 1);

45  
vÆ
;

46 
	}
}

48 
uöt32_t
 
	$pci_vpb_c⁄fig_ªadw
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

50 
uöt32_t
 
vÆ
;

51 
vÆ
 = 
	`pci_d©a_ªad
(
›aque
, 
	`vpb_pci_c⁄fig_addr
 (
addr
), 2);

52 #ifde‡
TARGET_WORDS_BIGENDIAN


53 
vÆ
 = 
	`bsw≠16
(val);

55  
vÆ
;

56 
	}
}

58 
uöt32_t
 
	$pci_vpb_c⁄fig_ªadl
 (*
›aque
, 
èrgë_phys_addr_t
 
addr
)

60 
uöt32_t
 
vÆ
;

61 
vÆ
 = 
	`pci_d©a_ªad
(
›aque
, 
	`vpb_pci_c⁄fig_addr
 (
addr
), 4);

62 #ifde‡
TARGET_WORDS_BIGENDIAN


63 
vÆ
 = 
	`bsw≠32
(val);

65  
vÆ
;

66 
	}
}

68 
CPUWrôeMem‹yFunc
 *
	gpci_vpb_c⁄fig_wrôe
[] = {

69 &
pci_vpb_c⁄fig_wrôeb
,

70 &
pci_vpb_c⁄fig_wrôew
,

71 &
pci_vpb_c⁄fig_wrôñ
,

74 
CPURódMem‹yFunc
 *
	gpci_vpb_c⁄fig_ªad
[] = {

75 &
pci_vpb_c⁄fig_ªadb
,

76 &
pci_vpb_c⁄fig_ªadw
,

77 &
pci_vpb_c⁄fig_ªadl
,

80 
	gpci_vpb_úq
;

82 
	$pci_vpb_m≠_úq
(
PCIDevi˚
 *
d
, 
úq_num
)

84  
úq_num
;

85 
	}
}

87 
	$pci_vpb_£t_úq
(*
pic
, 
úq_num
, 
Àvñ
)

89 
	`pic_£t_úq_√w
(
pic
, 
pci_vpb_úq
 + 
úq_num
, 
Àvñ
);

90 
	}
}

92 
PCIBus
 *
	$pci_vpb_öô
(*
pic
, 
úq
, 
ªÆvõw
)

94 
PCIBus
 *
s
;

95 
PCIDevi˚
 *
d
;

96 
mem_c⁄fig
;

97 
uöt32_t
 
ba£
;

98 c⁄° * 
«me
;

100 
pci_vpb_úq
 = 
úq
;

101 i‡(
ªÆvõw
) {

102 
ba£
 = 0x60000000;

103 
«me
 = "RealView EB PCI Controller";

105 
ba£
 = 0x40000000;

106 
«me
 = "Versatile/PB PCI Controller";

108 
s
 = 
	`pci_ªgi°î_bus
(
pci_vpb_£t_úq
, 
pci_vpb_m≠_úq
, 
pic
, 11 << 3, 4);

111 
mem_c⁄fig
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
pci_vpb_c⁄fig_ªad
,

112 
pci_vpb_c⁄fig_wrôe
, 
s
);

114 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x01000000, 0x1000000, 
mem_c⁄fig
);

116 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
 + 0x02000000, 0x1000000, 
mem_c⁄fig
);

118 
d
 = 
	`pci_ªgi°î_devi˚
(
s
, 
«me
, (
PCIDevi˚
), -1, 
NULL
, NULL);

120 i‡(
ªÆvõw
) {

122 
	`iß_mmio_öô
(
ba£
 + 0x03000000, 0x00100000);

125 
d
->
c⁄fig
[0x00] = 0xee;

126 
d
->
c⁄fig
[0x01] = 0x10;

128 
d
->
c⁄fig
[0x02] = 0x00;

129 
d
->
c⁄fig
[0x03] = 0x03;

130 
d
->
c⁄fig
[0x04] = 0x00;

131 
d
->
c⁄fig
[0x05] = 0x00;

132 
d
->
c⁄fig
[0x06] = 0x20;

133 
d
->
c⁄fig
[0x07] = 0x02;

134 
d
->
c⁄fig
[0x08] = 0x00;

135 
d
->
c⁄fig
[0x09] = 0x00;

136 
d
->
c⁄fig
[0x0A] = 0x40;

137 
d
->
c⁄fig
[0x0B] = 0x0b;

138 
d
->
c⁄fig
[0x0D] = 0x10;

140  
s
;

141 
	}
}

	@versatilepb.c

10 
	~"vl.h
"

11 
	~"¨m_pic.h
"

15 
	svpb_sic_°©e


17 
¨m_pic_h™dÀr
 
	mh™dÀr
;

18 
uöt32_t
 
	mba£
;

19 
uöt32_t
 
	mÀvñ
;

20 
uöt32_t
 
	mmask
;

21 
uöt32_t
 
	mpic_íabÀ
;

22 *
	m∑ª¡
;

23 
	múq
;

24 } 
	tvpb_sic_°©e
;

26 
	$vpb_sic_upd©e
(
vpb_sic_°©e
 *
s
)

28 
uöt32_t
 
Êags
;

30 
Êags
 = 
s
->
Àvñ
 & s->
mask
;

31 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, s->
úq
, 
Êags
 != 0);

32 
	}
}

34 
	$vpb_sic_upd©e_pic
(
vpb_sic_°©e
 *
s
)

36 
i
;

37 
uöt32_t
 
mask
;

39 
i
 = 21; i <= 30; i++) {

40 
mask
 = 1u << 
i
;

41 i‡(!(
s
->
pic_íabÀ
 & 
mask
))

43 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, 
i
, (s->
Àvñ
 & 
mask
) != 0);

45 
	}
}

47 
	$vpb_sic_£t_úq
(*
›aque
, 
úq
, 
Àvñ
)

49 
vpb_sic_°©e
 *
s
 = (vpb_sic_°©ê*)
›aque
;

50 i‡(
Àvñ
)

51 
s
->
Àvñ
 |1u << 
úq
;

53 
s
->
Àvñ
 &~(1u << 
úq
);

54 i‡(
s
->
pic_íabÀ
 & (1u << 
úq
))

55 
	`pic_£t_úq_√w
(
s
->
∑ª¡
, 
úq
, 
Àvñ
);

56 
	`vpb_sic_upd©e
(
s
);

57 
	}
}

59 
uöt32_t
 
	$vpb_sic_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
)

61 
vpb_sic_°©e
 *
s
 = (vpb_sic_°©ê*)
›aque
;

63 
off£t
 -
s
->
ba£
;

64 
off£t
 >> 2) {

66  
s
->
Àvñ
 & s->
mask
;

68  
s
->
Àvñ
;

70  
s
->
mask
;

72  
s
->
Àvñ
 & 1;

74  
s
->
pic_íabÀ
;

76 
	`¥ötf
 ("vpb_sic_ªad: BadÑegi°î off£à0x%x\n", ()
off£t
);

79 
	}
}

81 
	$vpb_sic_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
off£t
,

82 
uöt32_t
 
vÆue
)

84 
vpb_sic_°©e
 *
s
 = (vpb_sic_°©ê*)
›aque
;

85 
off£t
 -
s
->
ba£
;

87 
off£t
 >> 2) {

89 
s
->
mask
 |
vÆue
;

92 
s
->
mask
 &~
vÆue
;

95 i‡(
vÆue
)

96 
s
->
mask
 |= 1;

99 i‡(
vÆue
)

100 
s
->
mask
 &= ~1u;

103 
s
->
pic_íabÀ
 |(
vÆue
 & 0x7fe00000);

104 
	`vpb_sic_upd©e_pic
(
s
);

107 
s
->
pic_íabÀ
 &~
vÆue
;

108 
	`vpb_sic_upd©e_pic
(
s
);

111 
	`¥ötf
 ("vpb_sic_wrôe: BadÑegi°î off£à0x%x\n", ()
off£t
);

114 
	`vpb_sic_upd©e
(
s
);

115 
	}
}

117 
CPURódMem‹yFunc
 *
	gvpb_sic_ªad‚
[] = {

118 
vpb_sic_ªad
,

119 
vpb_sic_ªad
,

120 
vpb_sic_ªad


123 
CPUWrôeMem‹yFunc
 *
	gvpb_sic_wrôe‚
[] = {

124 
vpb_sic_wrôe
,

125 
vpb_sic_wrôe
,

126 
vpb_sic_wrôe


129 
vpb_sic_°©e
 *
	$vpb_sic_öô
(
uöt32_t
 
ba£
, *
∑ª¡
, 
úq
)

131 
vpb_sic_°©e
 *
s
;

132 
iomemty≥
;

134 
s
 = (
vpb_sic_°©e
 *)
	`qemu_mÆlocz
((vpb_sic_state));

135 i‡(!
s
)

136  
NULL
;

137 
s
->
h™dÀr
 = 
vpb_sic_£t_úq
;

138 
s
->
ba£
 = base;

139 
s
->
∑ª¡
 =Öarent;

140 
s
->
úq
 = irq;

141 
iomemty≥
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
vpb_sic_ªad‚
,

142 
vpb_sic_wrôe‚
, 
s
);

143 
	`˝u_ªgi°î_physiˇl_mem‹y
(
ba£
, 0x00000fff, 
iomemty≥
);

145  
s
;

146 
	}
}

154 
	$vîßtûe_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

155 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

156 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

157 c⁄° *
öôrd_fûíame
, 
bﬂrd_id
)

159 
CPUSèã
 *
ív
;

160 *
pic
;

161 *
sic
;

162 *
scsi_hba
;

163 
PCIBus
 *
pci_bus
;

164 
NICInfo
 *
nd
;

165 
n
;

166 
d⁄e_smc
 = 0;

168 
ív
 = 
	`˝u_öô
();

169 
	`˝u_¨m_£t_modñ
(
ív
, 
ARM_CPUID_ARM926
);

172 
	`˝u_ªgi°î_physiˇl_mem‹y
(0, 
øm_size
, 
IO_MEM_RAM
);

174 
	`¨m_sys˘l_öô
(0x10000000, 0x41007004);

175 
pic
 = 
	`¨m_pic_öô_˝u
(
ív
);

176 
pic
 = 
	`∂190_öô
(0x10140000,Öic, 
ARM_PIC_CPU_IRQ
, 
ARM_PIC_CPU_FIQ
);

177 
sic
 = 
	`vpb_sic_öô
(0x10003000, 
pic
, 31);

178 
	`∂050_öô
(0x10006000, 
sic
, 3, 0);

179 
	`∂050_öô
(0x10007000, 
sic
, 4, 1);

181 
pci_bus
 = 
	`pci_vpb_öô
(
sic
, 27, 0);

184 
n
 = 0;Ç < 
nb_nics
;Ç++) {

185 
nd
 = &
nd_èbÀ
[
n
];

186 i‡(!
nd
->
modñ
)

187 
nd
->
modñ
 = 
d⁄e_smc
 ? "rtl8139" : "smc91c111";

188 i‡(
	`°rcmp
(
nd
->
modñ
, "smc91c111") == 0) {

189 
	`smc91c111_öô
(
nd
, 0x10010000, 
sic
, 25);

191 
	`pci_nic_öô
(
pci_bus
, 
nd
, -1);

194 i‡(
usb_íabÀd
) {

195 
	`usb_ohci_öô
(
pci_bus
, 3, -1);

197 
scsi_hba
 = 
	`lsi_scsi_öô
(
pci_bus
, -1);

198 
n
 = 0;Ç < 
MAX_DISKS
;Ç++) {

199 i‡(
bs_èbÀ
[
n
]) {

200 
	`lsi_scsi_©èch
(
scsi_hba
, 
bs_èbÀ
[
n
],Ç);

204 
	`∂011_öô
(0x101f1000, 
pic
, 12, 
£rül_hds
[0]);

205 
	`∂011_öô
(0x101f2000, 
pic
, 13, 
£rül_hds
[1]);

206 
	`∂011_öô
(0x101f3000, 
pic
, 14, 
£rül_hds
[2]);

207 
	`∂011_öô
(0x10009000, 
sic
, 6, 
£rül_hds
[3]);

209 
	`∂080_öô
(0x10130000, 
pic
, 17, 8);

210 
	`•804_öô
(0x101e2000, 
pic
, 4);

211 
	`•804_öô
(0x101e3000, 
pic
, 5);

215 
	`∂110_öô
(
ds
, 0x10120000, 
pic
, 16, 1);

253 
	`¨m_lﬂd_kî√l
(
ív
, 
øm_size
, 
kî√l_fûíame
, 
kî√l_cmdlöe
,

254 
öôrd_fûíame
, 
bﬂrd_id
);

255 
	}
}

257 
	$vpb_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

258 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

259 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

260 c⁄° *
öôrd_fûíame
)

262 
	`vîßtûe_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

263 
ds
, 
fd_fûíame
, 
¢≠shŸ
,

264 
kî√l_fûíame
, 
kî√l_cmdlöe
,

265 
öôrd_fûíame
, 0x183);

266 
	}
}

268 
	$vab_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

269 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
, 
¢≠shŸ
,

270 c⁄° *
kî√l_fûíame
, c⁄° *
kî√l_cmdlöe
,

271 c⁄° *
öôrd_fûíame
)

273 
	`vîßtûe_öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
,

274 
ds
, 
fd_fûíame
, 
¢≠shŸ
,

275 
kî√l_fûíame
, 
kî√l_cmdlöe
,

276 
öôrd_fûíame
, 0x25e);

277 
	}
}

279 
QEMUMachöe
 
	gvîßtûïb_machöe
 = {

282 
vpb_öô
,

285 
QEMUMachöe
 
	gvîßtûób_machöe
 = {

288 
vab_öô
,

	@vga.c

24 
	~"vl.h
"

25 
	~"vga_öt.h
"

34 c⁄° 
uöt8_t
 
	g§_mask
[8] = {

35 (
uöt8_t
)~0xfc,

36 (
uöt8_t
)~0xc2,

37 (
uöt8_t
)~0xf0,

38 (
uöt8_t
)~0xc0,

39 (
uöt8_t
)~0xf1,

40 (
uöt8_t
)~0xff,

41 (
uöt8_t
)~0xff,

42 (
uöt8_t
)~0x00,

45 c⁄° 
uöt8_t
 
	ggr_mask
[16] = {

46 (
uöt8_t
)~0xf0,

47 (
uöt8_t
)~0xf0,

48 (
uöt8_t
)~0xf0,

49 (
uöt8_t
)~0xe0,

50 (
uöt8_t
)~0xfc,

51 (
uöt8_t
)~0x84,

52 (
uöt8_t
)~0xf0,

53 (
uöt8_t
)~0xf0,

54 (
uöt8_t
)~0x00,

55 (
uöt8_t
)~0xff,

56 (
uöt8_t
)~0xff,

57 (
uöt8_t
)~0xff,

58 (
uöt8_t
)~0xff,

59 (
uöt8_t
)~0xff,

60 (
uöt8_t
)~0xff,

61 (
uöt8_t
)~0xff,

64 
	#cbsw≠_32
(
__x
) \

65 ((
uöt32_t
)( \

66 (((
uöt32_t
)(
__x
) & (uint32_t)0x000000ffUL) << 24) | \

67 (((
uöt32_t
)(
__x
) & (uint32_t)0x0000ff00UL) << 8) | \

68 (((
uöt32_t
)(
__x
) & (uint32_t)0x00ff0000UL) >> 8) | \

69 (((
uöt32_t
)(
__x
Ë& (uöt32_t)0xff000000ULË>> 24Ë))

	)

71 #ifde‡
WORDS_BIGENDIAN


72 
	#PAT
(
x
Ë
	`cbsw≠_32
(x)

	)

74 
	#PAT
(
x
Ë(x)

	)

77 #ifde‡
WORDS_BIGENDIAN


78 
	#BIG
 1

	)

80 
	#BIG
 0

	)

83 #ifde‡
WORDS_BIGENDIAN


84 
	#GET_PLANE
(
d©a
, 
p
Ë(((d©aË>> (24 - (pË* 8)Ë& 0xff)

	)

86 
	#GET_PLANE
(
d©a
, 
p
Ë(((d©aË>> (’Ë* 8)Ë& 0xff)

	)

89 c⁄° 
uöt32_t
 
	gmask16
[16] = {

90 
PAT
(0x00000000),

91 
PAT
(0x000000ff),

92 
PAT
(0x0000ff00),

93 
PAT
(0x0000ffff),

94 
PAT
(0x00ff0000),

95 
PAT
(0x00ff00ff),

96 
PAT
(0x00ffff00),

97 
PAT
(0x00ffffff),

98 
PAT
(0xff000000),

99 
PAT
(0xff0000ff),

100 
PAT
(0xff00ff00),

101 
PAT
(0xff00ffff),

102 
PAT
(0xffff0000),

103 
PAT
(0xffff00ff),

104 
PAT
(0xffffff00),

105 
PAT
(0xffffffff),

108 #unde‡
PAT


110 #ifde‡
WORDS_BIGENDIAN


111 
	#PAT
(
x
Ë(x)

	)

113 
	#PAT
(
x
Ë
	`cbsw≠_32
(x)

	)

116 c⁄° 
uöt32_t
 
	gdmask16
[16] = {

117 
PAT
(0x00000000),

118 
PAT
(0x000000ff),

119 
PAT
(0x0000ff00),

120 
PAT
(0x0000ffff),

121 
PAT
(0x00ff0000),

122 
PAT
(0x00ff00ff),

123 
PAT
(0x00ffff00),

124 
PAT
(0x00ffffff),

125 
PAT
(0xff000000),

126 
PAT
(0xff0000ff),

127 
PAT
(0xff00ff00),

128 
PAT
(0xff00ffff),

129 
PAT
(0xffff0000),

130 
PAT
(0xffff00ff),

131 
PAT
(0xffffff00),

132 
PAT
(0xffffffff),

135 c⁄° 
uöt32_t
 
	gdmask4
[4] = {

136 
PAT
(0x00000000),

137 
PAT
(0x0000ffff),

138 
PAT
(0xffff0000),

139 
PAT
(0xffffffff),

142 
uöt32_t
 
	gex∑nd4
[256];

143 
uöt16_t
 
	gex∑nd2
[256];

144 
uöt8_t
 
	gex∑nd4to8
[16];

146 
vga_s¸ìn_dump
(*
›aque
, c⁄° *
fûíame
);

148 
uöt32_t
 
	$vga_i›‹t_ªad
(*
›aque
, 
uöt32_t
 
addr
)

150 
VGASèã
 *
s
 = 
›aque
;

151 
vÆ
, 
ödex
;

154 i‡((
addr
 >0x3b0 &&ádd∏<0x3b‡&& (
s
->
m§
 & 
MSR_COLOR_EMULATION
)) ||

155 (
addr
 >0x3d0 &&ádd∏<0x3d‡&& !(
s
->
m§
 & 
MSR_COLOR_EMULATION
))) {

156 
vÆ
 = 0xff;

158 
addr
) {

160 i‡(
s
->
¨_Êù_Ê›
 == 0) {

161 
vÆ
 = 
s
->
¨_ödex
;

163 
vÆ
 = 0;

167 
ödex
 = 
s
->
¨_ödex
 & 0x1f;

168 i‡(
ödex
 < 21)

169 
vÆ
 = 
s
->
¨
[
ödex
];

171 
vÆ
 = 0;

174 
vÆ
 = 
s
->
°00
;

177 
vÆ
 = 
s
->
§_ödex
;

180 
vÆ
 = 
s
->
§
[s->
§_ödex
];

181 #ifde‡
DEBUG_VGA_REG


182 
	`¥ötf
("vga:Ñód SR%x = 0x%02x\n", 
s
->
§_ödex
, 
vÆ
);

186 
vÆ
 = 
s
->
dac_°©e
;

189 
vÆ
 = 
s
->
dac_wrôe_ödex
;

192 
vÆ
 = 
s
->
∑Àâe
[s->
dac_ªad_ödex
 * 3 + s->
dac_sub_ödex
];

193 i‡(++
s
->
dac_sub_ödex
 == 3) {

194 
s
->
dac_sub_ödex
 = 0;

195 
s
->
dac_ªad_ödex
++;

199 
vÆ
 = 
s
->
f¸
;

202 
vÆ
 = 
s
->
m§
;

205 
vÆ
 = 
s
->
gr_ödex
;

208 
vÆ
 = 
s
->
gr
[s->
gr_ödex
];

209 #ifde‡
DEBUG_VGA_REG


210 
	`¥ötf
("vga:Ñód GR%x = 0x%02x\n", 
s
->
gr_ödex
, 
vÆ
);

215 
vÆ
 = 
s
->
¸_ödex
;

219 
vÆ
 = 
s
->
¸
[s->
¸_ödex
];

220 #ifde‡
DEBUG_VGA_REG


221 
	`¥ötf
("vga:Ñód CR%x = 0x%02x\n", 
s
->
¸_ödex
, 
vÆ
);

227 
s
->
°01
 ^
ST01_V_RETRACE
 | 
ST01_DISP_ENABLE
;

228 
vÆ
 = 
s
->
°01
;

229 
s
->
¨_Êù_Ê›
 = 0;

232 
vÆ
 = 0x00;

236 #i‡
	`deföed
(
DEBUG_VGA
)

237 
	`¥ötf
("VGA:Ñódáddr=0x%04x d©a=0x%02x\n", 
addr
, 
vÆ
);

239  
vÆ
;

240 
	}
}

242 
	$vga_i›‹t_wrôe
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

244 
VGASèã
 *
s
 = 
›aque
;

245 
ödex
;

248 i‡((
addr
 >0x3b0 &&ádd∏<0x3b‡&& (
s
->
m§
 & 
MSR_COLOR_EMULATION
)) ||

249 (
addr
 >0x3d0 &&ádd∏<0x3d‡&& !(
s
->
m§
 & 
MSR_COLOR_EMULATION
)))

252 #ifde‡
DEBUG_VGA


253 
	`¥ötf
("VGA: wrôêaddr=0x%04x d©a=0x%02x\n", 
addr
, 
vÆ
);

256 
addr
) {

258 i‡(
s
->
¨_Êù_Ê›
 == 0) {

259 
vÆ
 &= 0x3f;

260 
s
->
¨_ödex
 = 
vÆ
;

262 
ödex
 = 
s
->
¨_ödex
 & 0x1f;

263 
ödex
) {

265 
s
->
¨
[
ödex
] = 
vÆ
 & 0x3f;

268 
s
->
¨
[
ödex
] = 
vÆ
 & ~0x10;

271 
s
->
¨
[
ödex
] = 
vÆ
;

274 
s
->
¨
[
ödex
] = 
vÆ
 & ~0xc0;

277 
s
->
¨
[
ödex
] = 
vÆ
 & ~0xf0;

280 
s
->
¨
[
ödex
] = 
vÆ
 & ~0xf0;

286 
s
->
¨_Êù_Ê›
 ^= 1;

289 
s
->
m§
 = 
vÆ
 & ~0x10;

292 
s
->
§_ödex
 = 
vÆ
 & 7;

295 #ifde‡
DEBUG_VGA_REG


296 
	`¥ötf
("vga: wrôêSR%x = 0x%02x\n", 
s
->
§_ödex
, 
vÆ
);

298 
s
->
§
[s->
§_ödex
] = 
vÆ
 & 
§_mask
[s->sr_index];

301 
s
->
dac_ªad_ödex
 = 
vÆ
;

302 
s
->
dac_sub_ödex
 = 0;

303 
s
->
dac_°©e
 = 3;

306 
s
->
dac_wrôe_ödex
 = 
vÆ
;

307 
s
->
dac_sub_ödex
 = 0;

308 
s
->
dac_°©e
 = 0;

311 
s
->
dac_ˇche
[s->
dac_sub_ödex
] = 
vÆ
;

312 i‡(++
s
->
dac_sub_ödex
 == 3) {

313 
	`mem˝y
(&
s
->
∑Àâe
[s->
dac_wrôe_ödex
 * 3], s->
dac_ˇche
, 3);

314 
s
->
dac_sub_ödex
 = 0;

315 
s
->
dac_wrôe_ödex
++;

319 
s
->
gr_ödex
 = 
vÆ
 & 0x0f;

322 #ifde‡
DEBUG_VGA_REG


323 
	`¥ötf
("vga: wrôêGR%x = 0x%02x\n", 
s
->
gr_ödex
, 
vÆ
);

325 
s
->
gr
[s->
gr_ödex
] = 
vÆ
 & 
gr_mask
[s->gr_index];

329 
s
->
¸_ödex
 = 
vÆ
;

333 #ifde‡
DEBUG_VGA_REG


334 
	`¥ötf
("vga: wrôêCR%x = 0x%02x\n", 
s
->
¸_ödex
, 
vÆ
);

337 i‡((
s
->
¸
[0x11] & 0x80Ë&& s->
¸_ödex
 <= 7) {

339 i‡(
s
->
¸_ödex
 == 7)

340 
s
->
¸
[7] = (s->¸[7] & ~0x10Ë| (
vÆ
 & 0x10);

343 
s
->
¸_ödex
) {

350 
s
->
¸
[s->
¸_ödex
] = 
vÆ
;

353 
s
->
¸
[s->
¸_ödex
] = 
vÆ
;

359 
s
->
f¸
 = 
vÆ
 & 0x10;

362 
	}
}

364 #ifde‡
CONFIG_BOCHS_VBE


365 
uöt32_t
 
	$vbe_i›‹t_ªad_ödex
(*
›aque
, 
uöt32_t
 
addr
)

367 
VGASèã
 *
s
 = 
›aque
;

368 
uöt32_t
 
vÆ
;

369 
vÆ
 = 
s
->
vbe_ödex
;

370  
vÆ
;

371 
	}
}

373 
uöt32_t
 
	$vbe_i›‹t_ªad_d©a
(*
›aque
, 
uöt32_t
 
addr
)

375 
VGASèã
 *
s
 = 
›aque
;

376 
uöt32_t
 
vÆ
;

378 i‡(
s
->
vbe_ödex
 <
VBE_DISPI_INDEX_NB
) {

379 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_ENABLE
] & 
VBE_DISPI_GETCAPS
) {

380 
s
->
vbe_ödex
) {

382 
VBE_DISPI_INDEX_XRES
:

383 
vÆ
 = 
VBE_DISPI_MAX_XRES
;

385 
VBE_DISPI_INDEX_YRES
:

386 
vÆ
 = 
VBE_DISPI_MAX_YRES
;

388 
VBE_DISPI_INDEX_BPP
:

389 
vÆ
 = 
VBE_DISPI_MAX_BPP
;

392 
vÆ
 = 
s
->
vbe_ªgs
[s->
vbe_ödex
];

396 
vÆ
 = 
s
->
vbe_ªgs
[s->
vbe_ödex
];

399 
vÆ
 = 0;

401 #ifde‡
DEBUG_BOCHS_VBE


402 
	`¥ötf
("VBE:Ñód index=0x%x vÆ=0x%x\n", 
s
->
vbe_ödex
, 
vÆ
);

404  
vÆ
;

405 
	}
}

407 
	$vbe_i›‹t_wrôe_ödex
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

409 
VGASèã
 *
s
 = 
›aque
;

410 
s
->
vbe_ödex
 = 
vÆ
;

411 
	}
}

413 
	$vbe_i›‹t_wrôe_d©a
(*
›aque
, 
uöt32_t
 
addr
, uöt32_à
vÆ
)

415 
VGASèã
 *
s
 = 
›aque
;

417 i‡(
s
->
vbe_ödex
 <
VBE_DISPI_INDEX_NB
) {

418 #ifde‡
DEBUG_BOCHS_VBE


419 
	`¥ötf
("VBE: wrôêödex=0x%x vÆ=0x%x\n", 
s
->
vbe_ödex
, 
vÆ
);

421 
s
->
vbe_ödex
) {

422 
VBE_DISPI_INDEX_ID
:

423 i‡(
vÆ
 =
VBE_DISPI_ID0
 ||

424 
vÆ
 =
VBE_DISPI_ID1
 ||

425 
vÆ
 =
VBE_DISPI_ID2
 ||

426 
vÆ
 =
VBE_DISPI_ID3
 ||

427 
vÆ
 =
VBE_DISPI_ID4
) {

428 
s
->
vbe_ªgs
[s->
vbe_ödex
] = 
vÆ
;

431 
VBE_DISPI_INDEX_XRES
:

432 i‡((
vÆ
 <
VBE_DISPI_MAX_XRES
) && ((val & 7) == 0)) {

433 
s
->
vbe_ªgs
[s->
vbe_ödex
] = 
vÆ
;

436 
VBE_DISPI_INDEX_YRES
:

437 i‡(
vÆ
 <
VBE_DISPI_MAX_YRES
) {

438 
s
->
vbe_ªgs
[s->
vbe_ödex
] = 
vÆ
;

441 
VBE_DISPI_INDEX_BPP
:

442 i‡(
vÆ
 == 0)

443 
vÆ
 = 8;

444 i‡(
vÆ
 == 4 || val == 8 || val == 15 ||

445 
vÆ
 == 16 || val == 24 || val == 32) {

446 
s
->
vbe_ªgs
[s->
vbe_ödex
] = 
vÆ
;

449 
VBE_DISPI_INDEX_BANK
:

450 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
] == 4) {

451 
vÆ
 &(
s
->
vbe_b™k_mask
 >> 2);

453 
vÆ
 &
s
->
vbe_b™k_mask
;

455 
s
->
vbe_ªgs
[s->
vbe_ödex
] = 
vÆ
;

456 
s
->
b™k_off£t
 = (
vÆ
 << 16);

458 
VBE_DISPI_INDEX_ENABLE
:

459 i‡((
vÆ
 & 
VBE_DISPI_ENABLED
) &&

460 !(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_ENABLE
] & 
VBE_DISPI_ENABLED
)) {

461 
h
, 
shi·_c⁄åﬁ
;

463 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_VIRT_WIDTH
] =

464 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_XRES
];

465 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_VIRT_HEIGHT
] =

466 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_YRES
];

467 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_X_OFFSET
] = 0;

468 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_Y_OFFSET
] = 0;

470 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
] == 4)

471 
s
->
vbe_löe_off£t
 = s->
vbe_ªgs
[
VBE_DISPI_INDEX_XRES
] >> 1;

473 
s
->
vbe_löe_off£t
 = s->
vbe_ªgs
[
VBE_DISPI_INDEX_XRES
] *

474 ((
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
] + 7) >> 3);

475 
s
->
vbe_°¨t_addr
 = 0;

478 i‡(!(
vÆ
 & 
VBE_DISPI_NOCLEARMEM
)) {

479 
	`mem£t
(
s
->
vøm_±r
, 0,

480 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_YRES
] * s->
vbe_löe_off£t
);

485 
s
->
gr
[0x06] = (s->gr[0x06] & ~0x0c) | 0x05;

486 
s
->
¸
[0x17] |= 3;

487 
s
->
¸
[0x13] = s->
vbe_löe_off£t
 >> 3;

489 
s
->
¸
[0x01] = (s->
vbe_ªgs
[
VBE_DISPI_INDEX_XRES
] >> 3) - 1;

491 
h
 = 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_YRES
] - 1;

492 
s
->
¸
[0x12] = 
h
;

493 
s
->
¸
[0x07] = (s->cr[0x07] & ~0x42) |

494 ((
h
 >> 7) & 0x02) | ((h >> 3) & 0x40);

496 
s
->
¸
[0x18] = 0xff;

497 
s
->
¸
[0x07] |= 0x10;

498 
s
->
¸
[0x09] |= 0x40;

500 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
] == 4) {

501 
shi·_c⁄åﬁ
 = 0;

502 
s
->
§
[0x01] &= ~8;

504 
shi·_c⁄åﬁ
 = 2;

505 
s
->
§
[4] |= 0x08;

506 
s
->
§
[2] |= 0x0f;

508 
s
->
gr
[0x05] = (s->gr[0x05] & ~0x60Ë| (
shi·_c⁄åﬁ
 << 5);

509 
s
->
¸
[0x09] &= ~0x9f;

512 
s
->
b™k_off£t
 = 0;

514 
s
->
dac_8bô
 = (
vÆ
 & 
VBE_DISPI_8BIT_DAC
) > 0;

515 
s
->
vbe_ªgs
[s->
vbe_ödex
] = 
vÆ
;

517 
VBE_DISPI_INDEX_VIRT_WIDTH
:

519 
w
, 
h
, 
löe_off£t
;

521 i‡(
vÆ
 < 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_XRES
])

523 
w
 = 
vÆ
;

524 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
] == 4)

525 
löe_off£t
 = 
w
 >> 1;

527 
löe_off£t
 = 
w
 * ((
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
] + 7) >> 3);

528 
h
 = 
s
->
vøm_size
 / 
löe_off£t
;

530 i‡(
h
 < 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_YRES
])

532 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_VIRT_WIDTH
] = 
w
;

533 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_VIRT_HEIGHT
] = 
h
;

534 
s
->
vbe_löe_off£t
 = 
löe_off£t
;

537 
VBE_DISPI_INDEX_X_OFFSET
:

538 
VBE_DISPI_INDEX_Y_OFFSET
:

540 
x
;

541 
s
->
vbe_ªgs
[s->
vbe_ödex
] = 
vÆ
;

542 
s
->
vbe_°¨t_addr
 = s->
vbe_löe_off£t
 * s->
vbe_ªgs
[
VBE_DISPI_INDEX_Y_OFFSET
];

543 
x
 = 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_X_OFFSET
];

544 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
] == 4)

545 
s
->
vbe_°¨t_addr
 +
x
 >> 1;

547 
s
->
vbe_°¨t_addr
 +
x
 * ((s->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
] + 7) >> 3);

548 
s
->
vbe_°¨t_addr
 >>= 2;

555 
	}
}

559 
uöt32_t
 
	$vga_mem_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

561 
VGASèã
 *
s
 = 
›aque
;

562 
mem‹y_m≠_mode
, 
∂™e
;

563 
uöt32_t
 
ªt
;

566 
mem‹y_m≠_mode
 = (
s
->
gr
[6] >> 2) & 3;

567 
addr
 &= 0x1ffff;

568 
mem‹y_m≠_mode
) {

572 i‡(
addr
 >= 0x10000)

574 
addr
 +
s
->
b™k_off£t
;

577 
addr
 -= 0x10000;

578 i‡(
addr
 >= 0x8000)

583 
addr
 -= 0x18000;

584 i‡(
addr
 >= 0x8000)

589 i‡(
s
->
§
[4] & 0x08) {

591 
ªt
 = 
s
->
vøm_±r
[
addr
];

592 } i‡(
s
->
gr
[5] & 0x10) {

594 
∂™e
 = (
s
->
gr
[4] & 2Ë| (
addr
 & 1);

595 
ªt
 = 
s
->
vøm_±r
[((
addr
 & ~1Ë<< 1Ë| 
∂™e
];

598 
s
->
œtch
 = ((
uöt32_t
 *)s->
vøm_±r
)[
addr
];

600 i‡(!(
s
->
gr
[5] & 0x08)) {

602 
∂™e
 = 
s
->
gr
[4];

603 
ªt
 = 
	`GET_PLANE
(
s
->
œtch
, 
∂™e
);

606 
ªt
 = (
s
->
œtch
 ^ 
mask16
[s->
gr
[2]]) & mask16[s->gr[7]];

607 
ªt
 |=Ñet >> 16;

608 
ªt
 |=Ñet >> 8;

609 
ªt
 = (~ret) & 0xff;

612  
ªt
;

613 
	}
}

615 
uöt32_t
 
	$vga_mem_ªadw
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

617 
uöt32_t
 
v
;

618 #ifde‡
TARGET_WORDS_BIGENDIAN


619 
v
 = 
	`vga_mem_ªadb
(
›aque
, 
addr
) << 8;

620 
v
 |
	`vga_mem_ªadb
(
›aque
, 
addr
 + 1);

622 
v
 = 
	`vga_mem_ªadb
(
›aque
, 
addr
);

623 
v
 |
	`vga_mem_ªadb
(
›aque
, 
addr
 + 1) << 8;

625  
v
;

626 
	}
}

628 
uöt32_t
 
	$vga_mem_ªadl
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

630 
uöt32_t
 
v
;

631 #ifde‡
TARGET_WORDS_BIGENDIAN


632 
v
 = 
	`vga_mem_ªadb
(
›aque
, 
addr
) << 24;

633 
v
 |
	`vga_mem_ªadb
(
›aque
, 
addr
 + 1) << 16;

634 
v
 |
	`vga_mem_ªadb
(
›aque
, 
addr
 + 2) << 8;

635 
v
 |
	`vga_mem_ªadb
(
›aque
, 
addr
 + 3);

637 
v
 = 
	`vga_mem_ªadb
(
›aque
, 
addr
);

638 
v
 |
	`vga_mem_ªadb
(
›aque
, 
addr
 + 1) << 8;

639 
v
 |
	`vga_mem_ªadb
(
›aque
, 
addr
 + 2) << 16;

640 
v
 |
	`vga_mem_ªadb
(
›aque
, 
addr
 + 3) << 24;

642  
v
;

643 
	}
}

646 
	$vga_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

648 
VGASèã
 *
s
 = 
›aque
;

649 
mem‹y_m≠_mode
, 
∂™e
, 
wrôe_mode
, 
b
, 
func_£À˘
, 
mask
;

650 
uöt32_t
 
wrôe_mask
, 
bô_mask
, 
£t_mask
;

652 #ifde‡
DEBUG_VGA_MEM


653 
	`¥ötf
("vga: [0x%x] = 0x%02x\n", 
addr
, 
vÆ
);

656 
mem‹y_m≠_mode
 = (
s
->
gr
[6] >> 2) & 3;

657 
addr
 &= 0x1ffff;

658 
mem‹y_m≠_mode
) {

662 i‡(
addr
 >= 0x10000)

664 
addr
 +
s
->
b™k_off£t
;

667 
addr
 -= 0x10000;

668 i‡(
addr
 >= 0x8000)

673 
addr
 -= 0x18000;

674 i‡(
addr
 >= 0x8000)

679 i‡(
s
->
§
[4] & 0x08) {

681 
∂™e
 = 
addr
 & 3;

682 
mask
 = (1 << 
∂™e
);

683 i‡(
s
->
§
[2] & 
mask
) {

684 
s
->
vøm_±r
[
addr
] = 
vÆ
;

685 #ifde‡
DEBUG_VGA_MEM


686 
	`¥ötf
("vga: chaö4: [0x%x]\n", 
addr
);

688 
s
->
∂™e_upd©ed
 |
mask
;

689 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
addr
);

691 } i‡(
s
->
gr
[5] & 0x10) {

693 
∂™e
 = (
s
->
gr
[4] & 2Ë| (
addr
 & 1);

694 
mask
 = (1 << 
∂™e
);

695 i‡(
s
->
§
[2] & 
mask
) {

696 
addr
 = (◊dd∏& ~1Ë<< 1Ë| 
∂™e
;

697 
s
->
vøm_±r
[
addr
] = 
vÆ
;

698 #ifde‡
DEBUG_VGA_MEM


699 
	`¥ötf
("vga: odd/eví: [0x%x]\n", 
addr
);

701 
s
->
∂™e_upd©ed
 |
mask
;

702 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
addr
);

706 
wrôe_mode
 = 
s
->
gr
[5] & 3;

707 
wrôe_mode
) {

711 
b
 = 
s
->
gr
[3] & 7;

712 
vÆ
 = ((vÆ >> 
b
) | (val << (8 - b))) & 0xff;

713 
vÆ
 |= val << 8;

714 
vÆ
 |= val << 16;

717 
£t_mask
 = 
mask16
[
s
->
gr
[1]];

718 
vÆ
 = (vÆ & ~
£t_mask
Ë| (
mask16
[
s
->
gr
[0]] & set_mask);

719 
bô_mask
 = 
s
->
gr
[8];

722 
vÆ
 = 
s
->
œtch
;

723 
do_wrôe
;

725 
vÆ
 = 
mask16
[val & 0x0f];

726 
bô_mask
 = 
s
->
gr
[8];

730 
b
 = 
s
->
gr
[3] & 7;

731 
vÆ
 = (vÆ >> 
b
) | (val << (8 - b));

733 
bô_mask
 = 
s
->
gr
[8] & 
vÆ
;

734 
vÆ
 = 
mask16
[
s
->
gr
[0]];

739 
func_£À˘
 = 
s
->
gr
[3] >> 3;

740 
func_£À˘
) {

747 
vÆ
 &
s
->
œtch
;

751 
vÆ
 |
s
->
œtch
;

755 
vÆ
 ^
s
->
œtch
;

760 
bô_mask
 |= bit_mask << 8;

761 
bô_mask
 |= bit_mask << 16;

762 
vÆ
 = (vÆ & 
bô_mask
Ë| (
s
->
œtch
 & ~bit_mask);

764 
do_wrôe
:

766 
mask
 = 
s
->
§
[2];

767 
s
->
∂™e_upd©ed
 |
mask
;

768 
wrôe_mask
 = 
mask16
[
mask
];

769 ((
uöt32_t
 *)
s
->
vøm_±r
)[
addr
] =

770 (((
uöt32_t
 *)
s
->
vøm_±r
)[
addr
] & ~
wrôe_mask
) |

771 (
vÆ
 & 
wrôe_mask
);

772 #ifde‡
DEBUG_VGA_MEM


773 
	`¥ötf
("vga:Üatch: [0x%x] mask=0x%08x val=0x%08x\n",

774 
addr
 * 4, 
wrôe_mask
, 
vÆ
);

776 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + (
addr
 << 2));

778 
	}
}

780 
	$vga_mem_wrôew
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

782 #ifde‡
TARGET_WORDS_BIGENDIAN


783 
	`vga_mem_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 8) & 0xff);

784 
	`vga_mem_wrôeb
(
›aque
, 
addr
 + 1, 
vÆ
 & 0xff);

786 
	`vga_mem_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

787 
	`vga_mem_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

789 
	}
}

791 
	$vga_mem_wrôñ
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
)

793 #ifde‡
TARGET_WORDS_BIGENDIAN


794 
	`vga_mem_wrôeb
(
›aque
, 
addr
, (
vÆ
 >> 24) & 0xff);

795 
	`vga_mem_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 16) & 0xff);

796 
	`vga_mem_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 8) & 0xff);

797 
	`vga_mem_wrôeb
(
›aque
, 
addr
 + 3, 
vÆ
 & 0xff);

799 
	`vga_mem_wrôeb
(
›aque
, 
addr
, 
vÆ
 & 0xff);

800 
	`vga_mem_wrôeb
(
›aque
, 
addr
 + 1, (
vÆ
 >> 8) & 0xff);

801 
	`vga_mem_wrôeb
(
›aque
, 
addr
 + 2, (
vÆ
 >> 16) & 0xff);

802 
	`vga_mem_wrôeb
(
›aque
, 
addr
 + 3, (
vÆ
 >> 24) & 0xff);

804 
	}
}

806 
	tvga_døw_glyph8_func
(
	tuöt8_t
 *
	td
, 
	tlöesize
,

807 c⁄° 
	tuöt8_t
 *
	tf⁄t_±r
, 
	th
,

808 
	tuöt32_t
 
	tfgcﬁ
, uöt32_à
	tbgcﬁ
);

809 
	tvga_døw_glyph9_func
(
	tuöt8_t
 *
	td
, 
	tlöesize
,

810 c⁄° 
	tuöt8_t
 *
	tf⁄t_±r
, 
	th
,

811 
	tuöt32_t
 
	tfgcﬁ
, uöt32_à
	tbgcﬁ
, 
	tdup9
);

812 
	tvga_døw_löe_func
(
	tVGASèã
 *
	ts1
, 
	tuöt8_t
 *
	td
,

813 c⁄° 
	tuöt8_t
 *
	ts
, 
	twidth
);

815 
ölöe
 
	$rgb_to_pixñ8
(
r
, 
g
, 
b
)

817  ((
r
 >> 5Ë<< 5Ë| ((
g
 >> 5Ë<< 2Ë| (
b
 >> 6);

818 
	}
}

820 
ölöe
 
	$rgb_to_pixñ15
(
r
, 
g
, 
b
)

822  ((
r
 >> 3Ë<< 10Ë| ((
g
 >> 3Ë<< 5Ë| (
b
 >> 3);

823 
	}
}

825 
ölöe
 
	$rgb_to_pixñ16
(
r
, 
g
, 
b
)

827  ((
r
 >> 3Ë<< 11Ë| ((
g
 >> 2Ë<< 5Ë| (
b
 >> 3);

828 
	}
}

830 
ölöe
 
	$rgb_to_pixñ32
(
r
, 
g
, 
b
)

832  (
r
 << 16Ë| (
g
 << 8Ë| 
b
;

833 
	}
}

835 
ölöe
 
	$rgb_to_pixñ32bgr
(
r
, 
g
, 
b
)

837  (
b
 << 16Ë| (
g
 << 8Ë| 
r
;

838 
	}
}

840 
	#DEPTH
 8

	)

841 
	~"vga_ãm∂©e.h
"

843 
	#DEPTH
 15

	)

844 
	~"vga_ãm∂©e.h
"

846 
	#DEPTH
 16

	)

847 
	~"vga_ãm∂©e.h
"

849 
	#DEPTH
 32

	)

850 
	~"vga_ãm∂©e.h
"

852 
	#BGR_FORMAT


	)

853 
	#DEPTH
 32

	)

854 
	~"vga_ãm∂©e.h
"

856 
	$rgb_to_pixñ8_dup
(
r
, 
g
, 
b
)

858 
cﬁ
;

859 
cﬁ
 = 
	`rgb_to_pixñ8
(
r
, 
g
, 
b
);

860 
cﬁ
 |= col << 8;

861 
cﬁ
 |= col << 16;

862  
cﬁ
;

863 
	}
}

865 
	$rgb_to_pixñ15_dup
(
r
, 
g
, 
b
)

867 
cﬁ
;

868 
cﬁ
 = 
	`rgb_to_pixñ15
(
r
, 
g
, 
b
);

869 
cﬁ
 |= col << 16;

870  
cﬁ
;

871 
	}
}

873 
	$rgb_to_pixñ16_dup
(
r
, 
g
, 
b
)

875 
cﬁ
;

876 
cﬁ
 = 
	`rgb_to_pixñ16
(
r
, 
g
, 
b
);

877 
cﬁ
 |= col << 16;

878  
cﬁ
;

879 
	}
}

881 
	$rgb_to_pixñ32_dup
(
r
, 
g
, 
b
)

883 
cﬁ
;

884 
cﬁ
 = 
	`rgb_to_pixñ32
(
r
, 
g
, 
b
);

885  
cﬁ
;

886 
	}
}

888 
	$rgb_to_pixñ32bgr_dup
(
r
, 
g
, 
b
)

890 
cﬁ
;

891 
cﬁ
 = 
	`rgb_to_pixñ32bgr
(
r
, 
g
, 
b
);

892  
cﬁ
;

893 
	}
}

896 
	$upd©e_∑Àâe16
(
VGASèã
 *
s
)

898 
fuŒ_upd©e
, 
i
;

899 
uöt32_t
 
v
, 
cﬁ
, *
∑Àâe
;

901 
fuŒ_upd©e
 = 0;

902 
∑Àâe
 = 
s
->
œ°_∑Àâe
;

903 
i
 = 0; i < 16; i++) {

904 
v
 = 
s
->
¨
[
i
];

905 i‡(
s
->
¨
[0x10] & 0x80)

906 
v
 = ((
s
->
¨
[0x14] & 0xf) << 4) | (v & 0xf);

908 
v
 = ((
s
->
¨
[0x14] & 0xc) << 4) | (v & 0x3f);

909 
v
 = v * 3;

910 
cﬁ
 = 
s
->
	`rgb_to_pixñ
(
	`c6_to_8
(s->
∑Àâe
[
v
]),

911 
	`c6_to_8
(
s
->
∑Àâe
[
v
 + 1]),

912 
	`c6_to_8
(
s
->
∑Àâe
[
v
 + 2]));

913 i‡(
cﬁ
 !
∑Àâe
[
i
]) {

914 
fuŒ_upd©e
 = 1;

915 
∑Àâe
[
i
] = 
cﬁ
;

918  
fuŒ_upd©e
;

919 
	}
}

922 
	$upd©e_∑Àâe256
(
VGASèã
 *
s
)

924 
fuŒ_upd©e
, 
i
;

925 
uöt32_t
 
v
, 
cﬁ
, *
∑Àâe
;

927 
fuŒ_upd©e
 = 0;

928 
∑Àâe
 = 
s
->
œ°_∑Àâe
;

929 
v
 = 0;

930 
i
 = 0; i < 256; i++) {

931 i‡(
s
->
dac_8bô
) {

932 
cﬁ
 = 
s
->
	`rgb_to_pixñ
(s->
∑Àâe
[
v
],

933 
s
->
∑Àâe
[
v
 + 1],

934 
s
->
∑Àâe
[
v
 + 2]);

936 
cﬁ
 = 
s
->
	`rgb_to_pixñ
(
	`c6_to_8
(s->
∑Àâe
[
v
]),

937 
	`c6_to_8
(
s
->
∑Àâe
[
v
 + 1]),

938 
	`c6_to_8
(
s
->
∑Àâe
[
v
 + 2]));

940 i‡(
cﬁ
 !
∑Àâe
[
i
]) {

941 
fuŒ_upd©e
 = 1;

942 
∑Àâe
[
i
] = 
cﬁ
;

944 
v
 += 3;

946  
fuŒ_upd©e
;

947 
	}
}

949 
	$vga_gë_off£ts
(
VGASèã
 *
s
,

950 
uöt32_t
 *
∂öe_off£t
,

951 
uöt32_t
 *
p°¨t_addr
,

952 
uöt32_t
 *
∂öe_com∑ª
)

954 
uöt32_t
 
°¨t_addr
, 
löe_off£t
, 
löe_com∑ª
;

955 #ifde‡
CONFIG_BOCHS_VBE


956 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_ENABLE
] & 
VBE_DISPI_ENABLED
) {

957 
löe_off£t
 = 
s
->
vbe_löe_off£t
;

958 
°¨t_addr
 = 
s
->
vbe_°¨t_addr
;

959 
löe_com∑ª
 = 65535;

964 
löe_off£t
 = 
s
->
¸
[0x13];

965 
löe_off£t
 <<= 3;

968 
°¨t_addr
 = 
s
->
¸
[0x0d] | (s->cr[0x0c] << 8);

971 
löe_com∑ª
 = 
s
->
¸
[0x18] |

972 ((
s
->
¸
[0x07] & 0x10) << 4) |

973 ((
s
->
¸
[0x09] & 0x40) << 3);

975 *
∂öe_off£t
 = 
löe_off£t
;

976 *
p°¨t_addr
 = 
°¨t_addr
;

977 *
∂öe_com∑ª
 = 
löe_com∑ª
;

978 
	}
}

981 
	$upd©e_basic_∑øms
(
VGASèã
 *
s
)

983 
fuŒ_upd©e
;

984 
uöt32_t
 
°¨t_addr
, 
löe_off£t
, 
löe_com∑ª
;

986 
fuŒ_upd©e
 = 0;

988 
s
->
	`gë_off£ts
(s, &
löe_off£t
, &
°¨t_addr
, &
löe_com∑ª
);

990 i‡(
löe_off£t
 !
s
->line_offset ||

991 
°¨t_addr
 !
s
->start_addr ||

992 
löe_com∑ª
 !
s
->line_compare) {

993 
s
->
löe_off£t
 =Üine_offset;

994 
s
->
°¨t_addr
 = start_addr;

995 
s
->
löe_com∑ª
 =Üine_compare;

996 
fuŒ_upd©e
 = 1;

998  
fuŒ_upd©e
;

999 
	}
}

1001 
	#NB_DEPTHS
 5

	)

1003 
ölöe
 
	$gë_dïth_ödex
(
Di•œySèã
 *
s
)

1005 
s
->
dïth
) {

1014 i‡(
s
->
bgr
)

1019 
	}
}

1021 
vga_døw_glyph8_func
 *
	gvga_døw_glyph8_èbÀ
[
NB_DEPTHS
] = {

1022 
vga_døw_glyph8_8
,

1023 
vga_døw_glyph8_16
,

1024 
vga_døw_glyph8_16
,

1025 
vga_døw_glyph8_32
,

1026 
vga_døw_glyph8_32
,

1029 
vga_døw_glyph8_func
 *
	gvga_døw_glyph16_èbÀ
[
NB_DEPTHS
] = {

1030 
vga_døw_glyph16_8
,

1031 
vga_døw_glyph16_16
,

1032 
vga_døw_glyph16_16
,

1033 
vga_døw_glyph16_32
,

1034 
vga_døw_glyph16_32
,

1037 
vga_døw_glyph9_func
 *
	gvga_døw_glyph9_èbÀ
[
NB_DEPTHS
] = {

1038 
vga_døw_glyph9_8
,

1039 
vga_døw_glyph9_16
,

1040 
vga_døw_glyph9_16
,

1041 
vga_døw_glyph9_32
,

1042 
vga_døw_glyph9_32
,

1045 c⁄° 
uöt8_t
 
	gcurs‹_glyph
[32 * 4] = {

1072 
	$vga_døw_ãxt
(
VGASèã
 *
s
, 
fuŒ_upd©e
)

1074 
cx
, 
cy
, 
cheight
, 
cw
, 
ch
, 
ˇâr
, 
height
, 
width
, 
ch_©å
;

1075 
cx_mö
, 
cx_max
, 
löesize
, 
x_ö¸
;

1076 
uöt32_t
 
off£t
, 
fgcﬁ
, 
bgcﬁ
, 
v
, 
curs‹_off£t
;

1077 
uöt8_t
 *
d1
, *
d
, *
§c
, *
s1
, *
de°
, *
curs‹_±r
;

1078 c⁄° 
uöt8_t
 *
f⁄t_±r
, *
f⁄t_ba£
[2];

1079 
dup9
, 
löe_off£t
, 
dïth_ödex
;

1080 
uöt32_t
 *
∑Àâe
;

1081 
uöt32_t
 *
ch_©å_±r
;

1082 
vga_døw_glyph8_func
 *
vga_døw_glyph8
;

1083 
vga_døw_glyph9_func
 *
vga_døw_glyph9
;

1085 
fuŒ_upd©e
 |
	`upd©e_∑Àâe16
(
s
);

1086 
∑Àâe
 = 
s
->
œ°_∑Àâe
;

1089 
v
 = 
s
->
§
[3];

1090 
off£t
 = (((
v
 >> 4) & 1) | ((v << 1) & 6)) * 8192 * 4 + 2;

1091 i‡(
off£t
 !
s
->
f⁄t_off£ts
[0]) {

1092 
s
->
f⁄t_off£ts
[0] = 
off£t
;

1093 
fuŒ_upd©e
 = 1;

1095 
f⁄t_ba£
[0] = 
s
->
vøm_±r
 + 
off£t
;

1097 
off£t
 = (((
v
 >> 5) & 1) | ((v >> 1) & 6)) * 8192 * 4 + 2;

1098 
f⁄t_ba£
[1] = 
s
->
vøm_±r
 + 
off£t
;

1099 i‡(
off£t
 !
s
->
f⁄t_off£ts
[1]) {

1100 
s
->
f⁄t_off£ts
[1] = 
off£t
;

1101 
fuŒ_upd©e
 = 1;

1103 i‡(
s
->
∂™e_upd©ed
 & (1 << 2)) {

1106 
s
->
∂™e_upd©ed
 = 0;

1107 
fuŒ_upd©e
 = 1;

1109 
fuŒ_upd©e
 |
	`upd©e_basic_∑øms
(
s
);

1111 
löe_off£t
 = 
s
->line_offset;

1112 
s1
 = 
s
->
vøm_±r
 + (s->
°¨t_addr
 * 4);

1115 
cheight
 = (
s
->
¸
[9] & 0x1f) + 1;

1116 
cw
 = 8;

1117 i‡(!(
s
->
§
[1] & 0x01))

1118 
cw
 = 9;

1119 i‡(
s
->
§
[1] & 0x08)

1120 
cw
 = 16;

1121 
x_ö¸
 = 
cw
 * ((
s
->
ds
->
dïth
 + 7) >> 3);

1122 
width
 = (
s
->
¸
[0x01] + 1);

1123 i‡(
s
->
¸
[0x06] == 100) {

1125 
height
 = 100;

1127 
height
 = 
s
->
¸
[0x12] |

1128 ((
s
->
¸
[0x07] & 0x02) << 7) |

1129 ((
s
->
¸
[0x07] & 0x40) << 3);

1130 
height
 = (heighà+ 1Ë/ 
cheight
;

1132 i‡((
height
 * 
width
Ë> 
CH_ATTR_SIZE
) {

1137 i‡(
width
 !
s
->
œ°_width
 || 
height
 !s->
œ°_height
 ||

1138 
cw
 !
s
->
œ°_cw
 || 
cheight
 !s->
œ°_ch
) {

1139 
s
->
œ°_s¸_width
 = 
width
 * 
cw
;

1140 
s
->
œ°_s¸_height
 = 
height
 * 
cheight
;

1141 
	`dpy_ªsize
(
s
->
ds
, s->
œ°_s¸_width
, s->
œ°_s¸_height
);

1142 
s
->
œ°_width
 = 
width
;

1143 
s
->
œ°_height
 = 
height
;

1144 
s
->
œ°_ch
 = 
cheight
;

1145 
s
->
œ°_cw
 = 
cw
;

1146 
fuŒ_upd©e
 = 1;

1148 
curs‹_off£t
 = ((
s
->
¸
[0x0e] << 8Ë| s->¸[0x0f]Ë- s->
°¨t_addr
;

1149 i‡(
curs‹_off£t
 !
s
->cursor_offset ||

1150 
s
->
¸
[0xa] !s->
curs‹_°¨t
 ||

1151 
s
->
¸
[0xb] !s->
curs‹_íd
) {

1154 i‡(
s
->
curs‹_off£t
 < 
CH_ATTR_SIZE
)

1155 
s
->
œ°_ch_©å
[s->
curs‹_off£t
] = -1;

1156 i‡(
curs‹_off£t
 < 
CH_ATTR_SIZE
)

1157 
s
->
œ°_ch_©å
[
curs‹_off£t
] = -1;

1158 
s
->
curs‹_off£t
 = cursor_offset;

1159 
s
->
curs‹_°¨t
 = s->
¸
[0xa];

1160 
s
->
curs‹_íd
 = s->
¸
[0xb];

1162 
curs‹_±r
 = 
s
->
vøm_±r
 + (s->
°¨t_addr
 + 
curs‹_off£t
) * 4;

1164 
dïth_ödex
 = 
	`gë_dïth_ödex
(
s
->
ds
);

1165 i‡(
cw
 == 16)

1166 
vga_døw_glyph8
 = 
vga_døw_glyph16_èbÀ
[
dïth_ödex
];

1168 
vga_døw_glyph8
 = 
vga_døw_glyph8_èbÀ
[
dïth_ödex
];

1169 
vga_døw_glyph9
 = 
vga_døw_glyph9_èbÀ
[
dïth_ödex
];

1171 
de°
 = 
s
->
ds
->
d©a
;

1172 
löesize
 = 
s
->
ds
->linesize;

1173 
ch_©å_±r
 = 
s
->
œ°_ch_©å
;

1174 
cy
 = 0; cy < 
height
; cy++) {

1175 
d1
 = 
de°
;

1176 
§c
 = 
s1
;

1177 
cx_mö
 = 
width
;

1178 
cx_max
 = -1;

1179 
cx
 = 0; cx < 
width
; cx++) {

1180 
ch_©å
 = *(
uöt16_t
 *)
§c
;

1181 i‡(
fuŒ_upd©e
 || 
ch_©å
 !*
ch_©å_±r
) {

1182 i‡(
cx
 < 
cx_mö
)

1183 
cx_mö
 = 
cx
;

1184 i‡(
cx
 > 
cx_max
)

1185 
cx_max
 = 
cx
;

1186 *
ch_©å_±r
 = 
ch_©å
;

1187 #ifde‡
WORDS_BIGENDIAN


1188 
ch
 = 
ch_©å
 >> 8;

1189 
ˇâr
 = 
ch_©å
 & 0xff;

1191 
ch
 = 
ch_©å
 & 0xff;

1192 
ˇâr
 = 
ch_©å
 >> 8;

1194 
f⁄t_±r
 = 
f⁄t_ba£
[(
ˇâr
 >> 3) & 1];

1195 
f⁄t_±r
 +32 * 4 * 
ch
;

1196 
bgcﬁ
 = 
∑Àâe
[
ˇâr
 >> 4];

1197 
fgcﬁ
 = 
∑Àâe
[
ˇâr
 & 0x0f];

1198 i‡(
cw
 != 9) {

1199 
	`vga_døw_glyph8
(
d1
, 
löesize
,

1200 
f⁄t_±r
, 
cheight
, 
fgcﬁ
, 
bgcﬁ
);

1202 
dup9
 = 0;

1203 i‡(
ch
 >0xb0 && ch <0xd‡&& (
s
->
¨
[0x10] & 0x04))

1204 
dup9
 = 1;

1205 
	`vga_døw_glyph9
(
d1
, 
löesize
,

1206 
f⁄t_±r
, 
cheight
, 
fgcﬁ
, 
bgcﬁ
, 
dup9
);

1208 i‡(
§c
 =
curs‹_±r
 &&

1209 !(
s
->
¸
[0x0a] & 0x20)) {

1210 
löe_°¨t
, 
löe_œ°
, 
h
;

1212 
löe_°¨t
 = 
s
->
¸
[0x0a] & 0x1f;

1213 
löe_œ°
 = 
s
->
¸
[0x0b] & 0x1f;

1215 i‡(
löe_œ°
 > 
cheight
 - 1)

1216 
löe_œ°
 = 
cheight
 - 1;

1217 i‡(
löe_œ°
 >
löe_°¨t
 &&Üöe_°¨à< 
cheight
) {

1218 
h
 = 
löe_œ°
 - 
löe_°¨t
 + 1;

1219 
d
 = 
d1
 + 
löesize
 * 
löe_°¨t
;

1220 i‡(
cw
 != 9) {

1221 
	`vga_døw_glyph8
(
d
, 
löesize
,

1222 
curs‹_glyph
, 
h
, 
fgcﬁ
, 
bgcﬁ
);

1224 
	`vga_døw_glyph9
(
d
, 
löesize
,

1225 
curs‹_glyph
, 
h
, 
fgcﬁ
, 
bgcﬁ
, 1);

1230 
d1
 +
x_ö¸
;

1231 
§c
 += 4;

1232 
ch_©å_±r
++;

1234 i‡(
cx_max
 != -1) {

1235 
	`dpy_upd©e
(
s
->
ds
, 
cx_mö
 * 
cw
, 
cy
 * 
cheight
,

1236 (
cx_max
 - 
cx_mö
 + 1Ë* 
cw
, 
cheight
);

1238 
de°
 +
löesize
 * 
cheight
;

1239 
s1
 +
löe_off£t
;

1241 
	}
}

1244 
	mVGA_DRAW_LINE2
,

1245 
	mVGA_DRAW_LINE2D2
,

1246 
	mVGA_DRAW_LINE4
,

1247 
	mVGA_DRAW_LINE4D2
,

1248 
	mVGA_DRAW_LINE8D2
,

1249 
	mVGA_DRAW_LINE8
,

1250 
	mVGA_DRAW_LINE15
,

1251 
	mVGA_DRAW_LINE16
,

1252 
	mVGA_DRAW_LINE24
,

1253 
	mVGA_DRAW_LINE32
,

1254 
	mVGA_DRAW_LINE_NB
,

1257 
vga_døw_löe_func
 *
	gvga_døw_löe_èbÀ
[
NB_DEPTHS
 * 
VGA_DRAW_LINE_NB
] = {

1258 
vga_døw_löe2_8
,

1259 
vga_døw_löe2_16
,

1260 
vga_døw_löe2_16
,

1261 
vga_døw_löe2_32
,

1262 
vga_døw_löe2_32
,

1264 
vga_døw_löe2d2_8
,

1265 
vga_døw_löe2d2_16
,

1266 
vga_døw_löe2d2_16
,

1267 
vga_døw_löe2d2_32
,

1268 
vga_døw_löe2d2_32
,

1270 
vga_døw_löe4_8
,

1271 
vga_døw_löe4_16
,

1272 
vga_døw_löe4_16
,

1273 
vga_døw_löe4_32
,

1274 
vga_døw_löe4_32
,

1276 
vga_døw_löe4d2_8
,

1277 
vga_døw_löe4d2_16
,

1278 
vga_døw_löe4d2_16
,

1279 
vga_døw_löe4d2_32
,

1280 
vga_døw_löe4d2_32
,

1282 
vga_døw_löe8d2_8
,

1283 
vga_døw_löe8d2_16
,

1284 
vga_døw_löe8d2_16
,

1285 
vga_døw_löe8d2_32
,

1286 
vga_døw_löe8d2_32
,

1288 
vga_døw_löe8_8
,

1289 
vga_døw_löe8_16
,

1290 
vga_døw_löe8_16
,

1291 
vga_døw_löe8_32
,

1292 
vga_døw_löe8_32
,

1294 
vga_døw_löe15_8
,

1295 
vga_døw_löe15_15
,

1296 
vga_døw_löe15_16
,

1297 
vga_døw_löe15_32
,

1298 
vga_døw_löe15_32bgr
,

1300 
vga_døw_löe16_8
,

1301 
vga_døw_löe16_15
,

1302 
vga_døw_löe16_16
,

1303 
vga_døw_löe16_32
,

1304 
vga_døw_löe16_32bgr
,

1306 
vga_døw_löe24_8
,

1307 
vga_døw_löe24_15
,

1308 
vga_døw_löe24_16
,

1309 
vga_døw_löe24_32
,

1310 
vga_døw_löe24_32bgr
,

1312 
vga_døw_löe32_8
,

1313 
vga_døw_löe32_15
,

1314 
vga_døw_löe32_16
,

1315 
vga_døw_löe32_32
,

1316 
vga_døw_löe32_32bgr
,

1319 
	trgb_to_pixñ_dup_func
(
	tr
, 
	tg
, 
	tb
);

1321 
rgb_to_pixñ_dup_func
 *
	grgb_to_pixñ_dup_èbÀ
[
NB_DEPTHS
] = {

1322 
rgb_to_pixñ8_dup
,

1323 
rgb_to_pixñ15_dup
,

1324 
rgb_to_pixñ16_dup
,

1325 
rgb_to_pixñ32_dup
,

1326 
rgb_to_pixñ32bgr_dup
,

1329 
	$vga_gë_bµ
(
VGASèã
 *
s
)

1331 
ªt
;

1332 #ifde‡
CONFIG_BOCHS_VBE


1333 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_ENABLE
] & 
VBE_DISPI_ENABLED
) {

1334 
ªt
 = 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_BPP
];

1338 
ªt
 = 0;

1340  
ªt
;

1341 
	}
}

1343 
	$vga_gë_ªsﬁuti⁄
(
VGASèã
 *
s
, *
pwidth
, *
pheight
)

1345 
width
, 
height
;

1347 #ifde‡
CONFIG_BOCHS_VBE


1348 i‡(
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_ENABLE
] & 
VBE_DISPI_ENABLED
) {

1349 
width
 = 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_XRES
];

1350 
height
 = 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_YRES
];

1354 
width
 = (
s
->
¸
[0x01] + 1) * 8;

1355 
height
 = 
s
->
¸
[0x12] |

1356 ((
s
->
¸
[0x07] & 0x02) << 7) |

1357 ((
s
->
¸
[0x07] & 0x40) << 3);

1358 
height
 = (height + 1);

1360 *
pwidth
 = 
width
;

1361 *
pheight
 = 
height
;

1362 
	}
}

1364 
	$vga_övÆid©e_sˇ∆öes
(
VGASèã
 *
s
, 
y1
, 
y2
)

1366 
y
;

1367 i‡(
y1
 >
VGA_MAX_HEIGHT
)

1369 i‡(
y2
 >
VGA_MAX_HEIGHT
)

1370 
y2
 = 
VGA_MAX_HEIGHT
;

1371 
y
 = 
y1
; y < 
y2
; y++) {

1372 
s
->
övÆid©ed_y_èbÀ
[
y
 >> 5] |= 1 << (y & 0x1f);

1374 
	}
}

1376 
ölöe
 
	$cmp_vøm
(
VGASèã
 *
s
, 
off£t
, 
n
)

1378 *
vp
, *
•
;

1380 i‡(
s
->
vøm_shadow
 =
NULL
)

1382 
vp
 = (*)(
s
->
vøm_±r
 + 
off£t
);

1383 
•
 = (*)(
s
->
vøm_shadow
 + 
off£t
);

1384 (
n
 -(*
vp
)) >= 0) {

1385 i‡(*
vp
++ !*
•
++) {

1386 
	`mem˝y
(
•
 - 1, 
vp
 - 1, 
n
 + (*vp));

1391 
	}
}

1393 #ifde‡
USE_SSE2


1395 
	~<sig«l.h
>

1396 
	~<£tjmp.h
>

1397 
	~<emmöåö.h
>

1399 
	gs£2_ok
 = 1;

1401 
ölöe
 
	$˝uid_edx
(
›
)

1403 
óx
, 
edx
;

1405 #ifde‡
__x86_64__


1406 
	#__bx
 "rbx"

	)

1408 
	#__bx
 "ebx"

	)

1410 
	`__asm__
("push %%"
__bx
"; cpuid;Öop %%"__bx

1411 : "˜" (
óx
), "=d" (
edx
)

1412 : "0" (
›
)

1414 #unde‡
__bx


1416  
edx
;

1417 
	}
}

1419 
jmp_buf
 
	gs£_jbuf
;

1421 
	$öå
(
sig
)

1423 
s£2_ok
 = 0;

1424 
	`l⁄gjmp
(
s£_jbuf
, 1);

1425 
	}
}

1427 
	$check_s£2
()

1430 i‡((
	`˝uid_edx
(1) & 0x4000000) == 0) {

1431 
s£2_ok
 = 0;

1436 
	`sig«l
(
SIGILL
, 
öå
);

1437 i‡(
	`£tjmp
(
s£_jbuf
) == 0)

1438 
	`__asm__
("xorps %xmm0,%xmm0\n");

1439 
	}
}

1441 
	$vøm_dúty
(
VGASèã
 *
s
, 
off£t
, 
n
)

1443 
__m128i
 *
•
, *
vp
;

1445 i‡(
s
->
vøm_shadow
 =
NULL
)

1447 i‡(
s£2_ok
 == 0)

1448  
	`cmp_vøm
(
s
, 
off£t
, 
n
);

1449 
vp
 = (
__m128i
 *)(
s
->
vøm_±r
 + 
off£t
);

1450 
•
 = (
__m128i
 *)(
s
->
vøm_shadow
 + 
off£t
);

1451 (
n
 -(*
vp
)) >= 0) {

1452 i‡(
	`_mm_movemask_ïi8
(
	`_mm_cm≥q_ïi8
(*
•
, *
vp
)) != 0xffff) {

1453 
n
 >= 0) {

1454 
	`_mm_°‹e_si128
(
•
++, 
	`_mm_lﬂd_si128
(
vp
++));

1455 
n
 -(*
vp
);

1459 
•
++;

1460 
vp
++;

1463 
	}
}

1465 
	$vøm_dúty
(
VGASèã
 *
s
, 
off£t
, 
n
)

1467  
	`cmp_vøm
(
s
, 
off£t
, 
n
);

1468 
	}
}

1470 
	$check_s£2
()

1472 
	}
}

1478 
	$vga_døw_gøphic
(
VGASèã
 *
s
, 
fuŒ_upd©e
)

1480 
y1
, 
y
, 
upd©e
, 
löesize
, 
y_°¨t
, 
doubÀ_sˇn
, 
mask
;

1481 
width
, 
height
, 
shi·_c⁄åﬁ
, 
löe_off£t
, 
bwidth
;

1482 
øm_addr_t
 
∑ge0
, 
∑ge1
;

1483 
di•_width
, 
mu…i_sˇn
, 
mu…i_run
;

1484 
uöt8_t
 *
d
;

1485 
uöt32_t
 
v
, 
addr1
, 
addr
;

1486 
vga_døw_löe_func
 *
vga_døw_löe
;

1487 
øm_addr_t
 
∑ge_mö
, 
∑ge_max
;

1489 
fuŒ_upd©e
 |
	`upd©e_basic_∑øms
(
s
);

1491 
s
->
	`gë_ªsﬁuti⁄
(s, &
width
, &
height
);

1492 
di•_width
 = 
width
;

1494 
shi·_c⁄åﬁ
 = (
s
->
gr
[0x05] >> 5) & 3;

1495 
doubÀ_sˇn
 = (
s
->
¸
[0x09] >> 7);

1496 i‡(
shi·_c⁄åﬁ
 != 1) {

1497 
mu…i_sˇn
 = (((
s
->
¸
[0x09] & 0x1fË+ 1Ë<< 
doubÀ_sˇn
) - 1;

1501 
mu…i_sˇn
 = 
doubÀ_sˇn
;

1503 
mu…i_run
 = 
mu…i_sˇn
;

1504 i‡(
shi·_c⁄åﬁ
 !
s
->shift_control ||

1505 
doubÀ_sˇn
 !
s
->double_scan) {

1506 
fuŒ_upd©e
 = 1;

1507 
s
->
shi·_c⁄åﬁ
 = shift_control;

1508 
s
->
doubÀ_sˇn
 = double_scan;

1511 i‡(
shi·_c⁄åﬁ
 == 0) {

1512 
fuŒ_upd©e
 |
	`upd©e_∑Àâe16
(
s
);

1513 i‡(
s
->
§
[0x01] & 8) {

1514 
v
 = 
VGA_DRAW_LINE4D2
;

1515 
di•_width
 <<= 1;

1517 
v
 = 
VGA_DRAW_LINE4
;

1519 } i‡(
shi·_c⁄åﬁ
 == 1) {

1520 
fuŒ_upd©e
 |
	`upd©e_∑Àâe16
(
s
);

1521 i‡(
s
->
§
[0x01] & 8) {

1522 
v
 = 
VGA_DRAW_LINE2D2
;

1523 
di•_width
 <<= 1;

1525 
v
 = 
VGA_DRAW_LINE2
;

1528 
s
->
	`gë_bµ
(s)) {

1531 
fuŒ_upd©e
 |
	`upd©e_∑Àâe256
(
s
);

1532 
v
 = 
VGA_DRAW_LINE8D2
;

1535 
fuŒ_upd©e
 |
	`upd©e_∑Àâe256
(
s
);

1536 
v
 = 
VGA_DRAW_LINE8
;

1539 
v
 = 
VGA_DRAW_LINE15
;

1542 
v
 = 
VGA_DRAW_LINE16
;

1545 
v
 = 
VGA_DRAW_LINE24
;

1548 
v
 = 
VGA_DRAW_LINE32
;

1552 
vga_døw_löe
 = 
vga_døw_löe_èbÀ
[
v
 * 
NB_DEPTHS
 + 
	`gë_dïth_ödex
(
s
->
ds
)];

1554 i‡(
di•_width
 !
s
->
œ°_width
 ||

1555 
height
 !
s
->
œ°_height
) {

1556 
	`dpy_ªsize
(
s
->
ds
, 
di•_width
, 
height
);

1557 
s
->
œ°_s¸_width
 = 
di•_width
;

1558 
s
->
œ°_s¸_height
 = 
height
;

1559 
s
->
œ°_width
 = 
di•_width
;

1560 
s
->
œ°_height
 = 
height
;

1561 
fuŒ_upd©e
 = 1;

1563 i‡(
s
->
curs‹_övÆid©e
)

1564 
s
->
	`curs‹_övÆid©e
(s);

1566 
löe_off£t
 = 
s
->line_offset;

1568 
	`¥ötf
("w=%d h=%d v=%dÜine_offset=%d cr[0x09]=0x%02x cr[0x17]=0x%02xÜinecmp=%d sr[0x01]=0x%02x\n",

1569 
width
, 
height
, 
v
, 
löe_off£t
, 
s
->
¸
[9], s->¸[0x17], s->
löe_com∑ª
, s->
§
[0x01]);

1572 
y
 = 0; y < 
s
->
vøm_size
; y +
TARGET_PAGE_SIZE
)

1573 i‡(
	`vøm_dúty
(
s
, 
y
, 
TARGET_PAGE_SIZE
))

1574 
	`˝u_physiˇl_mem‹y_£t_dúty
(
s
->
vøm_off£t
 + 
y
);

1576 
addr1
 = (
s
->
°¨t_addr
 * 4);

1577 
bwidth
 = 
width
 * 4;

1578 
y_°¨t
 = -1;

1579 
∑ge_mö
 = 0;

1580 
∑ge_max
 = 0;

1581 
d
 = 
s
->
ds
->
d©a
;

1582 
löesize
 = 
s
->
ds
->linesize;

1583 
y1
 = 0;

1584 
y
 = 0; y < 
height
; y++) {

1585 
addr
 = 
addr1
;

1586 i‡(!(
s
->
¸
[0x17] & 1)) {

1587 
shi·
;

1589 
shi·
 = 14 + ((
s
->
¸
[0x17] >> 6) & 1);

1590 
addr
 = (add∏& ~(1 << 
shi·
)Ë| ((
y1
 & 1) << shift);

1592 i‡(!(
s
->
¸
[0x17] & 2)) {

1593 
addr
 = (add∏& ~0x8000Ë| ((
y1
 & 2) << 14);

1595 
∑ge0
 = 
s
->
vøm_off£t
 + (
addr
 & 
TARGET_PAGE_MASK
);

1596 
∑ge1
 = 
s
->
vøm_off£t
 + ((
addr
 + 
bwidth
 - 1Ë& 
TARGET_PAGE_MASK
);

1597 
upd©e
 = 
fuŒ_upd©e
 |

1598 
	`˝u_physiˇl_mem‹y_gë_dúty
(
∑ge0
, 
VGA_DIRTY_FLAG
) |

1599 
	`˝u_physiˇl_mem‹y_gë_dúty
(
∑ge1
, 
VGA_DIRTY_FLAG
);

1600 i‡((
∑ge1
 - 
∑ge0
Ë> 
TARGET_PAGE_SIZE
) {

1602 
upd©e
 |
	`˝u_physiˇl_mem‹y_gë_dúty
(
∑ge0
 + 
TARGET_PAGE_SIZE
,

1603 
VGA_DIRTY_FLAG
);

1606 
upd©e
 |(
s
->
övÆid©ed_y_èbÀ
[
y
 >> 5] >> (y & 0x1f)) & 1;

1607 i‡(
upd©e
) {

1608 i‡(
y_°¨t
 < 0)

1609 
y_°¨t
 = 
y
;

1610 i‡(
∑ge_mö
 =0 || 
∑ge0
 <Öage_min)

1611 
∑ge_mö
 = 
∑ge0
;

1612 i‡(
∑ge_max
 =0 || 
∑ge1
 >Öage_max)

1613 
∑ge_max
 = 
∑ge1
;

1614 
	`vga_døw_löe
(
s
, 
d
, s->
vøm_±r
 + 
addr
, 
width
);

1615 i‡(
s
->
curs‹_døw_löe
)

1616 
s
->
	`curs‹_døw_löe
(s, 
d
, 
y
);

1618 i‡(
y_°¨t
 >= 0) {

1620 
	`dpy_upd©e
(
s
->
ds
, 0, 
y_°¨t
,

1621 
di•_width
, 
y
 - 
y_°¨t
);

1622 
y_°¨t
 = -1;

1625 i‡(!
mu…i_run
) {

1626 
mask
 = (
s
->
¸
[0x17] & 3) ^ 3;

1627 i‡((
y1
 & 
mask
) == mask)

1628 
addr1
 +
löe_off£t
;

1629 
y1
++;

1630 
mu…i_run
 = 
mu…i_sˇn
;

1632 
mu…i_run
--;

1635 i‡(
y
 =
s
->
löe_com∑ª
)

1636 
addr1
 = 0;

1637 
d
 +
löesize
;

1639 i‡(
y_°¨t
 >= 0) {

1641 
	`dpy_upd©e
(
s
->
ds
, 0, 
y_°¨t
,

1642 
di•_width
, 
y
 - 
y_°¨t
);

1645 i‡(
∑ge_max
 != -1) {

1646 
	`˝u_physiˇl_mem‹y_ª£t_dúty
(
∑ge_mö
, 
∑ge_max
 + 
TARGET_PAGE_SIZE
,

1647 
VGA_DIRTY_FLAG
);

1649 
	`mem£t
(
s
->
övÆid©ed_y_èbÀ
, 0, ((
height
 + 31) >> 5) * 4);

1650 
	}
}

1652 
	$vga_døw_bœnk
(
VGASèã
 *
s
, 
fuŒ_upd©e
)

1654 
i
, 
w
, 
vÆ
;

1655 
uöt8_t
 *
d
;

1657 i‡(!
fuŒ_upd©e
)

1659 i‡(
s
->
œ°_s¸_width
 <0 || s->
œ°_s¸_height
 <= 0)

1661 i‡(
s
->
ds
->
dïth
 == 8)

1662 
vÆ
 = 
s
->
	`rgb_to_pixñ
(0, 0, 0);

1664 
vÆ
 = 0;

1665 
w
 = 
s
->
œ°_s¸_width
 * ((s->
ds
->
dïth
 + 7) >> 3);

1666 
d
 = 
s
->
ds
->
d©a
;

1667 
i
 = 0; i < 
s
->
œ°_s¸_height
; i++) {

1668 
	`mem£t
(
d
, 
vÆ
, 
w
);

1669 
d
 +
s
->
ds
->
löesize
;

1671 
	`dpy_upd©e
(
s
->
ds
, 0, 0,

1672 
s
->
œ°_s¸_width
, s->
œ°_s¸_height
);

1673 
	}
}

1675 
	#GMODE_TEXT
 0

	)

1676 
	#GMODE_GRAPH
 1

	)

1677 
	#GMODE_BLANK
 2

	)

1679 
	$vga_upd©e_di•œy
(*
›aque
)

1681 
VGASèã
 *
s
 = (VGASèã *)
›aque
;

1682 
fuŒ_upd©e
, 
gøphic_mode
;

1684 i‡(
s
->
ds
->
dïth
 == 0) {

1687 
s
->
rgb_to_pixñ
 =

1688 
rgb_to_pixñ_dup_èbÀ
[
	`gë_dïth_ödex
(
s
->
ds
)];

1690 
fuŒ_upd©e
 = 0;

1691 i‡(!(
s
->
¨_ödex
 & 0x20)) {

1692 
gøphic_mode
 = 
GMODE_BLANK
;

1694 
gøphic_mode
 = 
s
->
gr
[6] & 1;

1696 i‡(
gøphic_mode
 !
s
->graphic_mode) {

1697 
s
->
gøphic_mode
 = graphic_mode;

1698 
fuŒ_upd©e
 = 1;

1700 
gøphic_mode
) {

1701 
GMODE_TEXT
:

1702 
	`vga_døw_ãxt
(
s
, 
fuŒ_upd©e
);

1704 
GMODE_GRAPH
:

1705 
	`vga_døw_gøphic
(
s
, 
fuŒ_upd©e
);

1707 
GMODE_BLANK
:

1709 
	`vga_døw_bœnk
(
s
, 
fuŒ_upd©e
);

1713 
	}
}

1716 
	$vga_övÆid©e_di•œy
(*
›aque
)

1718 
VGASèã
 *
s
 = (VGASèã *)
›aque
;

1720 
s
->
œ°_width
 = -1;

1721 
s
->
œ°_height
 = -1;

1722 
	}
}

1724 
	$vga_ª£t
(
VGASèã
 *
s
)

1726 
	`mem£t
(
s
, 0, (
VGASèã
));

1727 
s
->
gøphic_mode
 = -1;

1728 
	}
}

1730 
CPURódMem‹yFunc
 *
	gvga_mem_ªad
[3] = {

1731 
vga_mem_ªadb
,

1732 
vga_mem_ªadw
,

1733 
vga_mem_ªadl
,

1736 
CPUWrôeMem‹yFunc
 *
	gvga_mem_wrôe
[3] = {

1737 
vga_mem_wrôeb
,

1738 
vga_mem_wrôew
,

1739 
vga_mem_wrôñ
,

1742 
	$vga_ßve
(
QEMUFûe
 *
f
, *
›aque
)

1744 
VGASèã
 *
s
 = 
›aque
;

1745 
uöt32_t
 
vøm_size
;

1746 #ifde‡
CONFIG_BOCHS_VBE


1747 
i
;

1750 i‡(
s
->
pci_dev
)

1751 
	`pci_devi˚_ßve
(
s
->
pci_dev
, 
f
);

1753 
	`qemu_put_be32s
(
f
, &
s
->
œtch
);

1754 
	`qemu_put_8s
(
f
, &
s
->
§_ödex
);

1755 
	`qemu_put_buf„r
(
f
, 
s
->
§
, 8);

1756 
	`qemu_put_8s
(
f
, &
s
->
gr_ödex
);

1757 
	`qemu_put_buf„r
(
f
, 
s
->
gr
, 16);

1758 
	`qemu_put_8s
(
f
, &
s
->
¨_ödex
);

1759 
	`qemu_put_buf„r
(
f
, 
s
->
¨
, 21);

1760 
	`qemu_put_be32s
(
f
, &
s
->
¨_Êù_Ê›
);

1761 
	`qemu_put_8s
(
f
, &
s
->
¸_ödex
);

1762 
	`qemu_put_buf„r
(
f
, 
s
->
¸
, 256);

1763 
	`qemu_put_8s
(
f
, &
s
->
m§
);

1764 
	`qemu_put_8s
(
f
, &
s
->
f¸
);

1765 
	`qemu_put_8s
(
f
, &
s
->
°00
);

1766 
	`qemu_put_8s
(
f
, &
s
->
°01
);

1768 
	`qemu_put_8s
(
f
, &
s
->
dac_°©e
);

1769 
	`qemu_put_8s
(
f
, &
s
->
dac_sub_ödex
);

1770 
	`qemu_put_8s
(
f
, &
s
->
dac_ªad_ödex
);

1771 
	`qemu_put_8s
(
f
, &
s
->
dac_wrôe_ödex
);

1772 
	`qemu_put_buf„r
(
f
, 
s
->
dac_ˇche
, 3);

1773 
	`qemu_put_buf„r
(
f
, 
s
->
∑Àâe
, 768);

1775 
	`qemu_put_be32s
(
f
, &
s
->
b™k_off£t
);

1776 #ifde‡
CONFIG_BOCHS_VBE


1777 
	`qemu_put_byã
(
f
, 1);

1778 
	`qemu_put_be16s
(
f
, &
s
->
vbe_ödex
);

1779 
i
 = 0; i < 
VBE_DISPI_INDEX_NB
; i++)

1780 
	`qemu_put_be16s
(
f
, &
s
->
vbe_ªgs
[
i
]);

1781 
	`qemu_put_be32s
(
f
, &
s
->
vbe_°¨t_addr
);

1782 
	`qemu_put_be32s
(
f
, &
s
->
vbe_löe_off£t
);

1783 
	`qemu_put_be32s
(
f
, &
s
->
vbe_b™k_mask
);

1785 
	`qemu_put_byã
(
f
, 0);

1787 
vøm_size
 = 
s
->vram_size;

1788 
	`qemu_put_be32s
(
f
, &
vøm_size
);

1789 
	`qemu_put_buf„r
(
f
, 
s
->
vøm_±r
, s->
vøm_size
);

1790 
	}
}

1792 
	$vga_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

1794 
VGASèã
 *
s
 = 
›aque
;

1795 
is_vbe
, 
ªt
;

1796 
uöt32_t
 
vøm_size
;

1797 #ifde‡
CONFIG_BOCHS_VBE


1798 
i
;

1801 i‡(
vîsi⁄_id
 > 3)

1802  -
EINVAL
;

1804 i‡(
s
->
pci_dev
 && 
vîsi⁄_id
 >= 2) {

1805 
ªt
 = 
	`pci_devi˚_lﬂd
(
s
->
pci_dev
, 
f
);

1806 i‡(
ªt
 < 0)

1807  
ªt
;

1810 
	`qemu_gë_be32s
(
f
, &
s
->
œtch
);

1811 
	`qemu_gë_8s
(
f
, &
s
->
§_ödex
);

1812 
	`qemu_gë_buf„r
(
f
, 
s
->
§
, 8);

1813 
	`qemu_gë_8s
(
f
, &
s
->
gr_ödex
);

1814 
	`qemu_gë_buf„r
(
f
, 
s
->
gr
, 16);

1815 
	`qemu_gë_8s
(
f
, &
s
->
¨_ödex
);

1816 
	`qemu_gë_buf„r
(
f
, 
s
->
¨
, 21);

1817 
	`qemu_gë_be32s
(
f
, &
s
->
¨_Êù_Ê›
);

1818 
	`qemu_gë_8s
(
f
, &
s
->
¸_ödex
);

1819 
	`qemu_gë_buf„r
(
f
, 
s
->
¸
, 256);

1820 
	`qemu_gë_8s
(
f
, &
s
->
m§
);

1821 
	`qemu_gë_8s
(
f
, &
s
->
f¸
);

1822 
	`qemu_gë_8s
(
f
, &
s
->
°00
);

1823 
	`qemu_gë_8s
(
f
, &
s
->
°01
);

1825 
	`qemu_gë_8s
(
f
, &
s
->
dac_°©e
);

1826 
	`qemu_gë_8s
(
f
, &
s
->
dac_sub_ödex
);

1827 
	`qemu_gë_8s
(
f
, &
s
->
dac_ªad_ödex
);

1828 
	`qemu_gë_8s
(
f
, &
s
->
dac_wrôe_ödex
);

1829 
	`qemu_gë_buf„r
(
f
, 
s
->
dac_ˇche
, 3);

1830 
	`qemu_gë_buf„r
(
f
, 
s
->
∑Àâe
, 768);

1832 
	`qemu_gë_be32s
(
f
, &
s
->
b™k_off£t
);

1833 
is_vbe
 = 
	`qemu_gë_byã
(
f
);

1834 #ifde‡
CONFIG_BOCHS_VBE


1835 i‡(!
is_vbe
)

1836  -
EINVAL
;

1837 
	`qemu_gë_be16s
(
f
, &
s
->
vbe_ödex
);

1838 
i
 = 0; i < 
VBE_DISPI_INDEX_NB
; i++)

1839 
	`qemu_gë_be16s
(
f
, &
s
->
vbe_ªgs
[
i
]);

1840 
	`qemu_gë_be32s
(
f
, &
s
->
vbe_°¨t_addr
);

1841 
	`qemu_gë_be32s
(
f
, &
s
->
vbe_löe_off£t
);

1842 
	`qemu_gë_be32s
(
f
, &
s
->
vbe_b™k_mask
);

1844 i‡(
is_vbe
)

1845  -
EINVAL
;

1847 i‡(
vîsi⁄_id
 >= 3) {

1849 
	`qemu_gë_be32s
(
f
, &
vøm_size
);

1850 i‡(
vøm_size
 !
s
->vram_size)

1851  -
EINVAL
;

1852 
	`qemu_gë_buf„r
(
f
, 
s
->
vøm_±r
, s->
vøm_size
);

1856 
s
->
gøphic_mode
 = -1;

1858 
	}
}

1860 
	sPCIVGASèã
 {

1861 
PCIDevi˚
 
	mdev
;

1862 
VGASèã
 
	mvga_°©e
;

1863 } 
	tPCIVGASèã
;

1865 
	$vga_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

1866 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

1868 
PCIVGASèã
 *
d
 = (PCIVGASèã *)
pci_dev
;

1869 
VGASèã
 *
s
 = &
d
->
vga_°©e
;

1870 i‡(
ªgi⁄_num
 =
PCI_ROM_SLOT
) {

1871 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
s
->
bios_size
, s->
bios_off£t
);

1873 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 
s
->
vøm_size
, s->
vøm_off£t
);

1875 
	}
}

1878 
	$vga_bios_öô
(
VGASèã
 *
s
)

1880 
uöt8_t
 
∑Àâe_modñ
[192] = {

1907 
s
->
œtch
 = 0;

1909 
s
->
§_ödex
 = 3;

1910 
s
->
§
[0] = 3;

1911 
s
->
§
[1] = 0;

1912 
s
->
§
[2] = 3;

1913 
s
->
§
[3] = 0;

1914 
s
->
§
[4] = 2;

1915 
s
->
§
[5] = 0;

1916 
s
->
§
[6] = 0;

1917 
s
->
§
[7] = 0;

1919 
s
->
gr_ödex
 = 5;

1920 
s
->
gr
[0] = 0;

1921 
s
->
gr
[1] = 0;

1922 
s
->
gr
[2] = 0;

1923 
s
->
gr
[3] = 0;

1924 
s
->
gr
[4] = 0;

1925 
s
->
gr
[5] = 16;

1926 
s
->
gr
[6] = 14;

1927 
s
->
gr
[7] = 15;

1928 
s
->
gr
[8] = 255;

1931 
s
->
¨_ödex
 = 32;

1932 
s
->
¨
[0] = 0;

1933 
s
->
¨
[1] = 1;

1934 
s
->
¨
[2] = 2;

1935 
s
->
¨
[3] = 3;

1936 
s
->
¨
[4] = 4;

1937 
s
->
¨
[5] = 5;

1938 
s
->
¨
[6] = 6;

1939 
s
->
¨
[7] = 7;

1940 
s
->
¨
[8] = 8;

1941 
s
->
¨
[9] = 9;

1942 
s
->
¨
[10] = 10;

1943 
s
->
¨
[11] = 11;

1944 
s
->
¨
[12] = 12;

1945 
s
->
¨
[13] = 13;

1946 
s
->
¨
[14] = 14;

1947 
s
->
¨
[15] = 15;

1948 
s
->
¨
[16] = 12;

1949 
s
->
¨
[17] = 0;

1950 
s
->
¨
[18] = 15;

1951 
s
->
¨
[19] = 8;

1952 
s
->
¨
[20] = 0;

1954 
s
->
¨_Êù_Ê›
 = 1;

1956 
s
->
¸_ödex
 = 15;

1957 
s
->
¸
[0] = 95;

1958 
s
->
¸
[1] = 79;

1959 
s
->
¸
[2] = 80;

1960 
s
->
¸
[3] = 130;

1961 
s
->
¸
[4] = 85;

1962 
s
->
¸
[5] = 129;

1963 
s
->
¸
[6] = 191;

1964 
s
->
¸
[7] = 31;

1965 
s
->
¸
[8] = 0;

1966 
s
->
¸
[9] = 79;

1967 
s
->
¸
[10] = 14;

1968 
s
->
¸
[11] = 15;

1969 
s
->
¸
[12] = 0;

1970 
s
->
¸
[13] = 0;

1971 
s
->
¸
[14] = 5;

1972 
s
->
¸
[15] = 160;

1973 
s
->
¸
[16] = 156;

1974 
s
->
¸
[17] = 142;

1975 
s
->
¸
[18] = 143;

1976 
s
->
¸
[19] = 40;

1977 
s
->
¸
[20] = 31;

1978 
s
->
¸
[21] = 150;

1979 
s
->
¸
[22] = 185;

1980 
s
->
¸
[23] = 163;

1981 
s
->
¸
[24] = 255;

1983 
s
->
m§
 = 103;

1984 
s
->
f¸
 = 0;

1985 
s
->
°00
 = 0;

1986 
s
->
°01
 = 0;

1990 
s
->
dac_°©e
 = 0;

1991 
s
->
dac_sub_ödex
 = 0;

1992 
s
->
dac_ªad_ödex
 = 0;

1993 
s
->
dac_wrôe_ödex
 = 16;

1994 
s
->
dac_ˇche
[0] = 255;

1995 
s
->
dac_ˇche
[1] = 255;

1996 
s
->
dac_ˇche
[2] = 255;

1999 
	`mem˝y
(
s
->
∑Àâe
, 
∑Àâe_modñ
, 192);

2001 
s
->
b™k_off£t
 = 0;

2002 
s
->
gøphic_mode
 = -1;

2005 
	}
}

2008 
	$vga_comm⁄_öô
(
VGASèã
 *
s
, 
Di•œySèã
 *
ds
, 
uöt8_t
 *
vga_øm_ba£
,

2009 
vga_øm_off£t
, 
vga_øm_size
)

2011 
i
, 
j
, 
v
, 
b
;

2013 
i
 = 0;i < 256; i++) {

2014 
v
 = 0;

2015 
j
 = 0; j < 8; j++) {

2016 
v
 |((
i
 >> 
j
) & 1) << (j * 4);

2018 
ex∑nd4
[
i
] = 
v
;

2020 
v
 = 0;

2021 
j
 = 0; j < 4; j++) {

2022 
v
 |((
i
 >> (2 * 
j
)) & 3) << (j * 4);

2024 
ex∑nd2
[
i
] = 
v
;

2026 
i
 = 0; i < 16; i++) {

2027 
v
 = 0;

2028 
j
 = 0; j < 4; j++) {

2029 
b
 = ((
i
 >> 
j
) & 1);

2030 
v
 |
b
 << (2 * 
j
);

2031 
v
 |
b
 << (2 * 
j
 + 1);

2033 
ex∑nd4to8
[
i
] = 
v
;

2036 
	`vga_ª£t
(
s
);

2038 
	`check_s£2
();

2039 
s
->
vøm_shadow
 = 
	`qemu_mÆloc
(
vga_øm_size
+
TARGET_PAGE_SIZE
+1);

2040 i‡(
s
->
vøm_shadow
 =
NULL
)

2041 
	`Ârötf
(
°dîr
, "Cannotállocate %d bytes for VRAM shadow, "

2042 "mou£ wû»bê¶ow\n", 
vga_øm_size
);

2043 
s
->
vøm_shadow
 = (
uöt8_t
 *)(()(s->vøm_shadow + 
TARGET_PAGE_SIZE
 - 1)

2044 & ~(
TARGET_PAGE_SIZE
 - 1));

2047 
s
->
vøm_Æloc
 = 
	`qemu_mÆloc
(
vga_øm_size
 + 15);

2048 
s
->
vøm_±r
 = (
uöt8_t
 *)(()(s->
vøm_Æloc
 + 15) & ~15L);

2050 
s
->
vøm_off£t
 = 
vga_øm_off£t
;

2051 
s
->
vøm_size
 = 
vga_øm_size
;

2052 
s
->
ds
 = ds;

2053 
s
->
gë_bµ
 = 
vga_gë_bµ
;

2054 
s
->
gë_off£ts
 = 
vga_gë_off£ts
;

2055 
s
->
gë_ªsﬁuti⁄
 = 
vga_gë_ªsﬁuti⁄
;

2056 
	`gøphic_c⁄sﬁe_öô
(
s
->
ds
, 
vga_upd©e_di•œy
, 
vga_övÆid©e_di•œy
,

2057 
vga_s¸ìn_dump
, 
s
);

2059 
	`vga_bios_öô
(
s
);

2060 
	}
}

2063 
	$vga_öô
(
VGASèã
 *
s
)

2065 
vga_io_mem‹y
;

2067 
	`ªgi°î_ßvevm
("vga", 0, 3, 
vga_ßve
, 
vga_lﬂd
, 
s
);

2069 
	`ªgi°î_i›‹t_wrôe
(0x3c0, 16, 1, 
vga_i›‹t_wrôe
, 
s
);

2071 
	`ªgi°î_i›‹t_wrôe
(0x3b4, 2, 1, 
vga_i›‹t_wrôe
, 
s
);

2072 
	`ªgi°î_i›‹t_wrôe
(0x3d4, 2, 1, 
vga_i›‹t_wrôe
, 
s
);

2073 
	`ªgi°î_i›‹t_wrôe
(0x3ba, 1, 1, 
vga_i›‹t_wrôe
, 
s
);

2074 
	`ªgi°î_i›‹t_wrôe
(0x3da, 1, 1, 
vga_i›‹t_wrôe
, 
s
);

2076 
	`ªgi°î_i›‹t_ªad
(0x3c0, 16, 1, 
vga_i›‹t_ªad
, 
s
);

2078 
	`ªgi°î_i›‹t_ªad
(0x3b4, 2, 1, 
vga_i›‹t_ªad
, 
s
);

2079 
	`ªgi°î_i›‹t_ªad
(0x3d4, 2, 1, 
vga_i›‹t_ªad
, 
s
);

2080 
	`ªgi°î_i›‹t_ªad
(0x3ba, 1, 1, 
vga_i›‹t_ªad
, 
s
);

2081 
	`ªgi°î_i›‹t_ªad
(0x3da, 1, 1, 
vga_i›‹t_ªad
, 
s
);

2082 
s
->
b™k_off£t
 = 0;

2084 #ifde‡
CONFIG_BOCHS_VBE


2085 
s
->
vbe_ªgs
[
VBE_DISPI_INDEX_ID
] = 
VBE_DISPI_ID0
;

2086 
s
->
vbe_b™k_mask
 = ((s->
vøm_size
 >> 16) - 1);

2087 #i‡
	`deföed
 (
TARGET_I386
)

2088 
	`ªgi°î_i›‹t_ªad
(0x1˚, 1, 2, 
vbe_i›‹t_ªad_ödex
, 
s
);

2089 
	`ªgi°î_i›‹t_ªad
(0x1cf, 1, 2, 
vbe_i›‹t_ªad_d©a
, 
s
);

2091 
	`ªgi°î_i›‹t_wrôe
(0x1˚, 1, 2, 
vbe_i›‹t_wrôe_ödex
, 
s
);

2092 
	`ªgi°î_i›‹t_wrôe
(0x1cf, 1, 2, 
vbe_i›‹t_wrôe_d©a
, 
s
);

2095 
	`ªgi°î_i›‹t_ªad
(0xff80, 1, 2, 
vbe_i›‹t_ªad_ödex
, 
s
);

2096 
	`ªgi°î_i›‹t_ªad
(0xff81, 1, 2, 
vbe_i›‹t_ªad_d©a
, 
s
);

2098 
	`ªgi°î_i›‹t_wrôe
(0xff80, 1, 2, 
vbe_i›‹t_wrôe_ödex
, 
s
);

2099 
	`ªgi°î_i›‹t_wrôe
(0xff81, 1, 2, 
vbe_i›‹t_wrôe_d©a
, 
s
);

2101 
	`ªgi°î_i›‹t_ªad
(0x1˚, 1, 2, 
vbe_i›‹t_ªad_ödex
, 
s
);

2102 
	`ªgi°î_i›‹t_ªad
(0x1d0, 1, 2, 
vbe_i›‹t_ªad_d©a
, 
s
);

2104 
	`ªgi°î_i›‹t_wrôe
(0x1˚, 1, 2, 
vbe_i›‹t_wrôe_ödex
, 
s
);

2105 
	`ªgi°î_i›‹t_wrôe
(0x1d0, 1, 2, 
vbe_i›‹t_wrôe_d©a
, 
s
);

2109 
vga_io_mem‹y
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
vga_mem_ªad
, 
vga_mem_wrôe
, 
s
);

2110 
	`˝u_ªgi°î_physiˇl_mem‹y
(
iß_mem_ba£
 + 0x000a0000, 0x20000,

2111 
vga_io_mem‹y
);

2112 
	}
}

2114 
	$iß_vga_öô
(
Di•œySèã
 *
ds
, 
uöt8_t
 *
vga_øm_ba£
,

2115 
vga_øm_off£t
, 
vga_øm_size
)

2117 
VGASèã
 *
s
;

2119 
s
 = 
	`qemu_mÆlocz
((
VGASèã
));

2120 i‡(!
s
)

2123 
	`vga_comm⁄_öô
(
s
, 
ds
, 
vga_øm_ba£
, 
vga_øm_off£t
, 
vga_øm_size
);

2124 
	`vga_öô
(
s
);

2126 #ifde‡
CONFIG_BOCHS_VBE


2128 
	`˝u_ªgi°î_physiˇl_mem‹y
(
VBE_DISPI_LFB_PHYSICAL_ADDRESS
,

2129 
vga_øm_size
, 
vga_øm_off£t
);

2132 
	}
}

2134 
	$pci_vga_öô
(
PCIBus
 *
bus
, 
Di•œySèã
 *
ds
, 
uöt8_t
 *
vga_øm_ba£
,

2135 
vga_øm_off£t
, 
vga_øm_size
,

2136 
vga_bios_off£t
, 
vga_bios_size
)

2138 
PCIVGASèã
 *
d
;

2139 
VGASèã
 *
s
;

2140 
uöt8_t
 *
pci_c⁄f
;

2142 
d
 = (
PCIVGASèã
 *)
	`pci_ªgi°î_devi˚
(
bus
, "VGA",

2143 (
PCIVGASèã
),

2144 -1, 
NULL
, NULL);

2145 i‡(!
d
)

2147 
s
 = &
d
->
vga_°©e
;

2149 
	`vga_comm⁄_öô
(
s
, 
ds
, 
vga_øm_ba£
, 
vga_øm_off£t
, 
vga_øm_size
);

2150 
	`vga_öô
(
s
);

2151 
s
->
pci_dev
 = &
d
->
dev
;

2153 
pci_c⁄f
 = 
d
->
dev
.
c⁄fig
;

2154 
pci_c⁄f
[0x00] = 0x34;

2155 
pci_c⁄f
[0x01] = 0x12;

2156 
pci_c⁄f
[0x02] = 0x11;

2157 
pci_c⁄f
[0x03] = 0x11;

2158 
pci_c⁄f
[0x0a] = 0x00;

2159 
pci_c⁄f
[0x0b] = 0x03;

2160 
pci_c⁄f
[0x0e] = 0x00;

2163 
	`pci_ªgi°î_io_ªgi⁄
(&
d
->
dev
, 0, 
vga_øm_size
,

2164 
PCI_ADDRESS_SPACE_MEM_PREFETCH
, 
vga_m≠
);

2165 i‡(
vga_bios_size
 != 0) {

2166 
bios_tŸÆ_size
;

2167 
s
->
bios_off£t
 = 
vga_bios_off£t
;

2168 
s
->
bios_size
 = 
vga_bios_size
;

2170 
bios_tŸÆ_size
 = 1;

2171 
bios_tŸÆ_size
 < 
vga_bios_size
)

2172 
bios_tŸÆ_size
 <<= 1;

2173 
	`pci_ªgi°î_io_ªgi⁄
(&
d
->
dev
, 
PCI_ROM_SLOT
, 
bios_tŸÆ_size
,

2174 
PCI_ADDRESS_SPACE_MEM_PREFETCH
, 
vga_m≠
);

2177 
	}
}

2179 *
	$vga_upd©e_vøm
(
VGASèã
 *
s
, *
vga_øm_ba£
, 
vga_øm_size
)

2181 
uöt8_t
 *
ﬁd_poöãr
;

2183 i‡(
s
->
vøm_size
 !
vga_øm_size
) {

2184 
	`Ârötf
(
°dîr
, "No supportÅo change vga_ram_size\n");

2185  
NULL
;

2188 i‡(!
vga_øm_ba£
) {

2189 
vga_øm_ba£
 = 
	`qemu_mÆloc
(
vga_øm_size
 + 
TARGET_PAGE_SIZE
 + 1);

2190 i‡(!
vga_øm_ba£
) {

2191 
	`Ârötf
(
°dîr
, "reallocateÉrror\n");

2192  
NULL
;

2197 
ﬁd_poöãr
 = 
s
->
vøm_Æloc
;

2198 
s
->
vøm_Æloc
 = 
vga_øm_ba£
;

2199 
vga_øm_ba£
 = (
uöt8_t
 *)(()(vga_ram_base + 15) & ~15L);

2200 
	`mem˝y
(
vga_øm_ba£
, 
s
->
vøm_±r
, 
vga_øm_size
);

2201 
s
->
vøm_±r
 = 
vga_øm_ba£
;

2203  
ﬁd_poöãr
;

2204 
	}
}

2209 
	gvga_ßve_w
, 
	gvga_ßve_h
;

2211 
	$vga_ßve_dpy_upd©e
(
Di•œySèã
 *
s
,

2212 
x
, 
y
, 
w
, 
h
)

2214 
	}
}

2216 
	$vga_ßve_dpy_ªsize
(
Di•œySèã
 *
s
, 
w
, 
h
)

2218 
s
->
löesize
 = 
w
 * 4;

2219 
s
->
d©a
 = 
	`qemu_mÆloc
(
h
 * s->
löesize
);

2220 
vga_ßve_w
 = 
w
;

2221 
vga_ßve_h
 = 
h
;

2222 
	}
}

2224 
	$vga_ßve_dpy_ª‰esh
(
Di•œySèã
 *
s
)

2226 
	}
}

2228 
	$µm_ßve
(c⁄° *
fûíame
, 
uöt8_t
 *
d©a
,

2229 
w
, 
h
, 
löesize
)

2231 
FILE
 *
f
;

2232 
uöt8_t
 *
d
, *
d1
;

2233 
v
;

2234 
y
, 
x
;

2236 
f
 = 
	`f›í
(
fûíame
, "wb");

2237 i‡(!
f
)

2239 
	`Ârötf
(
f
, "P6\n%d %d\n%d\n",

2240 
w
, 
h
, 255);

2241 
d1
 = 
d©a
;

2242 
y
 = 0; y < 
h
; y++) {

2243 
d
 = 
d1
;

2244 
x
 = 0; x < 
w
; x++) {

2245 
v
 = *(
uöt32_t
 *)
d
;

2246 
	`Âutc
((
v
 >> 16Ë& 0xff, 
f
);

2247 
	`Âutc
((
v
 >> 8Ë& 0xff, 
f
);

2248 
	`Âutc
((
v
Ë& 0xff, 
f
);

2249 
d
 += 4;

2251 
d1
 +
löesize
;

2253 
	`f˛o£
(
f
);

2255 
	}
}

2259 
	$vga_s¸ìn_dump
(*
›aque
, c⁄° *
fûíame
)

2261 
VGASèã
 *
s
 = (VGASèã *)
›aque
;

2262 
Di•œySèã
 *
ßved_ds
, 
ds1
, *
ds
 = &ds1;

2265 
	`vga_övÆid©e_di•œy
(
s
);

2266 
ßved_ds
 = 
s
->
ds
;

2268 
	`mem£t
(
ds
, 0, (
Di•œySèã
));

2269 
ds
->
dpy_upd©e
 = 
vga_ßve_dpy_upd©e
;

2270 
ds
->
dpy_ªsize
 = 
vga_ßve_dpy_ªsize
;

2271 
ds
->
dpy_ª‰esh
 = 
vga_ßve_dpy_ª‰esh
;

2272 
ds
->
dïth
 = 32;

2274 
s
->
ds
 = ds;

2275 
s
->
gøphic_mode
 = -1;

2276 
	`vga_upd©e_di•œy
(
s
);

2278 i‡(
ds
->
d©a
) {

2279 
	`µm_ßve
(
fûíame
, 
ds
->
d©a
, 
vga_ßve_w
, 
vga_ßve_h
,

2280 
s
->
ds
->
löesize
);

2281 
	`qemu_‰ì
(
ds
->
d©a
);

2283 
s
->
ds
 = 
ßved_ds
;

2284 
	}
}

	@vga_int.h

24 
	#MSR_COLOR_EMULATION
 0x01

	)

25 
	#MSR_PAGE_SELECT
 0x20

	)

27 
	#ST01_V_RETRACE
 0x08

	)

28 
	#ST01_DISP_ENABLE
 0x01

	)

33 
	#VBE_DISPI_MAX_XRES
 1600

	)

34 
	#VBE_DISPI_MAX_YRES
 1200

	)

35 
	#VBE_DISPI_MAX_BPP
 32

	)

37 
	#VBE_DISPI_INDEX_ID
 0x0

	)

38 
	#VBE_DISPI_INDEX_XRES
 0x1

	)

39 
	#VBE_DISPI_INDEX_YRES
 0x2

	)

40 
	#VBE_DISPI_INDEX_BPP
 0x3

	)

41 
	#VBE_DISPI_INDEX_ENABLE
 0x4

	)

42 
	#VBE_DISPI_INDEX_BANK
 0x5

	)

43 
	#VBE_DISPI_INDEX_VIRT_WIDTH
 0x6

	)

44 
	#VBE_DISPI_INDEX_VIRT_HEIGHT
 0x7

	)

45 
	#VBE_DISPI_INDEX_X_OFFSET
 0x8

	)

46 
	#VBE_DISPI_INDEX_Y_OFFSET
 0x9

	)

47 
	#VBE_DISPI_INDEX_NB
 0xa

	)

49 
	#VBE_DISPI_ID0
 0xB0C0

	)

50 
	#VBE_DISPI_ID1
 0xB0C1

	)

51 
	#VBE_DISPI_ID2
 0xB0C2

	)

52 
	#VBE_DISPI_ID3
 0xB0C3

	)

53 
	#VBE_DISPI_ID4
 0xB0C4

	)

55 
	#VBE_DISPI_DISABLED
 0x00

	)

56 
	#VBE_DISPI_ENABLED
 0x01

	)

57 
	#VBE_DISPI_GETCAPS
 0x02

	)

58 
	#VBE_DISPI_8BIT_DAC
 0x20

	)

59 
	#VBE_DISPI_LFB_ENABLED
 0x40

	)

60 
	#VBE_DISPI_NOCLEARMEM
 0x80

	)

62 
	#VBE_DISPI_LFB_PHYSICAL_ADDRESS
 0xE0000000

	)

64 #ifde‡
CONFIG_BOCHS_VBE


66 
	#VGA_STATE_COMMON_BOCHS_VBE
 \

67 
uöt16_t
 
vbe_ödex
; \

68 
uöt16_t
 
vbe_ªgs
[
VBE_DISPI_INDEX_NB
]; \

69 
uöt32_t
 
vbe_°¨t_addr
; \

70 
uöt32_t
 
vbe_löe_off£t
; \

71 
uöt32_t
 
vbe_b™k_mask
;

	)

75 
	#VGA_STATE_COMMON_BOCHS_VBE


	)

79 
	#CH_ATTR_SIZE
 (160 * 100)

	)

80 
	#VGA_MAX_HEIGHT
 2048

	)

82 
	#VGA_STATE_COMMON
 \

83 
uöt8_t
 *
vøm_Æloc
; \

84 
uöt8_t
 *
vøm_±r
; \

85 
uöt8_t
 *
vøm_shadow
; \

86 
vøm_off£t
; \

87 
vøm_size
; \

88 
bios_off£t
; \

89 
bios_size
; \

90 
PCIDevi˚
 *
pci_dev
; \

91 
uöt32_t
 
œtch
; \

92 
uöt8_t
 
§_ödex
; \

93 
uöt8_t
 
§
[256]; \

94 
uöt8_t
 
gr_ödex
; \

95 
uöt8_t
 
gr
[256]; \

96 
uöt8_t
 
¨_ödex
; \

97 
uöt8_t
 
¨
[21]; \

98 
¨_Êù_Ê›
; \

99 
uöt8_t
 
¸_ödex
; \

100 
uöt8_t
 
¸
[256]; \

101 
uöt8_t
 
m§
; \

102 
uöt8_t
 
f¸
; \

103 
uöt8_t
 
°00
; \

104 
uöt8_t
 
°01
; \

105 
uöt8_t
 
dac_°©e
; \

106 
uöt8_t
 
dac_sub_ödex
; \

107 
uöt8_t
 
dac_ªad_ödex
; \

108 
uöt8_t
 
dac_wrôe_ödex
; \

109 
uöt8_t
 
dac_ˇche
[3]; \

110 
dac_8bô
; \

111 
uöt8_t
 
∑Àâe
[768]; \

112 
öt32_t
 
b™k_off£t
; \

113 (*
gë_bµ
)(
VGASèã
 *
s
); \

114 (*
gë_off£ts
)(
VGASèã
 *
s
, \

115 
uöt32_t
 *
∂öe_off£t
, \

116 
uöt32_t
 *
p°¨t_addr
, \

117 
uöt32_t
 *
∂öe_com∑ª
); \

118 (*
gë_ªsﬁuti⁄
)(
VGASèã
 *
s
, \

119 *
pwidth
, \

120 *
pheight
); \

121 
VGA_STATE_COMMON_BOCHS_VBE
 \

123 
Di•œySèã
 *
ds
; \

124 
uöt32_t
 
f⁄t_off£ts
[2]; \

125 
gøphic_mode
; \

126 
uöt8_t
 
shi·_c⁄åﬁ
; \

127 
uöt8_t
 
doubÀ_sˇn
; \

128 
uöt32_t
 
löe_off£t
; \

129 
uöt32_t
 
löe_com∑ª
; \

130 
uöt32_t
 
°¨t_addr
; \

131 
uöt32_t
 
∂™e_upd©ed
; \

132 
uöt8_t
 
œ°_cw
, 
œ°_ch
; \

133 
uöt32_t
 
œ°_width
, 
œ°_height
; \

134 
uöt32_t
 
œ°_s¸_width
, 
œ°_s¸_height
; \

135 
uöt8_t
 
curs‹_°¨t
, 
curs‹_íd
; \

136 
uöt32_t
 
curs‹_off£t
; \

137 (*
rgb_to_pixñ
)(
r
, \

138 
g
, 
b
); \

140 
uöt32_t
 
övÆid©ed_y_èbÀ
[
VGA_MAX_HEIGHT
 / 32]; \

141 (*
curs‹_övÆid©e
)(
VGASèã
 *
s
); \

142 (*
curs‹_døw_löe
)(
VGASèã
 *
s
, 
uöt8_t
 *
d
, 
y
); \

144 
uöt32_t
 
œ°_∑Àâe
[256]; \

145 
uöt32_t
 
œ°_ch_©å
[
CH_ATTR_SIZE
];

	)

148 
	sVGASèã
 {

149 
	mVGA_STATE_COMMON


150 } 
	tVGASèã
;

152 
ölöe
 
	$c6_to_8
(
v
)

154 
b
;

155 
v
 &= 0x3f;

156 
b
 = 
v
 & 1;

157  (
v
 << 2Ë| (
b
 << 1) | b;

158 
	}
}

160 
vga_comm⁄_öô
(
VGASèã
 *
s
, 
Di•œySèã
 *
ds
, 
uöt8_t
 *
vga_øm_ba£
,

161 
vga_øm_off£t
, 
vga_øm_size
);

162 
uöt32_t
 
vga_mem_ªadb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
);

163 
vga_mem_wrôeb
(*
›aque
, 
èrgë_phys_addr_t
 
addr
, 
uöt32_t
 
vÆ
);

164 
vga_övÆid©e_sˇ∆öes
(
VGASèã
 *
s
, 
y1
, 
y2
);

166 
vga_døw_curs‹_löe_8
(
uöt8_t
 *
d1
, c⁄° uöt8_à*
§c1
,

167 
poff£t
, 
w
,

168 
cﬁ‹0
, 
cﬁ‹1
,

169 
cﬁ‹_x‹
);

170 
vga_døw_curs‹_löe_16
(
uöt8_t
 *
d1
, c⁄° uöt8_à*
§c1
,

171 
poff£t
, 
w
,

172 
cﬁ‹0
, 
cﬁ‹1
,

173 
cﬁ‹_x‹
);

174 
vga_døw_curs‹_löe_32
(
uöt8_t
 *
d1
, c⁄° uöt8_à*
§c1
,

175 
poff£t
, 
w
,

176 
cﬁ‹0
, 
cﬁ‹1
,

177 
cﬁ‹_x‹
);

179 *
vga_upd©e_vøm
(
VGASèã
 *
s
, *
vga_øm_ba£
, 
vga_øm_size
);

180 c⁄° 
uöt8_t
 
§_mask
[8];

181 c⁄° 
uöt8_t
 
gr_mask
[16];

	@vga_template.h

25 #i‡
DEPTH
 == 8

26 
	#BPP
 1

	)

27 
	#PIXEL_TYPE
 
uöt8_t


	)

28 #ñi‡
DEPTH
 == 15 || DEPTH == 16

29 
	#BPP
 2

	)

30 
	#PIXEL_TYPE
 
uöt16_t


	)

31 #ñi‡
DEPTH
 == 32

32 
	#BPP
 4

	)

33 
	#PIXEL_TYPE
 
uöt32_t


	)

35 #îr‹ 
unsuµ‹t
 
dïth


38 #ifde‡
BGR_FORMAT


39 
	#PIXEL_NAME
 
	`glue
(
DEPTH
, 
bgr
)

	)

41 
	#PIXEL_NAME
 
DEPTH


	)

44 #i‡
DEPTH
 !15 && !
deföed
(
BGR_FORMAT
)

46 
ölöe
 
	$glue
(
vga_døw_glyph_löe_
, 
DEPTH
)(
uöt8_t
 *
d
,

47 
uöt32_t
 
f⁄t_d©a
,

48 
uöt32_t
 
x‹cﬁ
,

49 
uöt32_t
 
bgcﬁ
)

51 #i‡
BPP
 == 1

52 ((
uöt32_t
 *)
d
)[0] = (
dmask16
[(
f⁄t_d©a
 >> 4)] & 
x‹cﬁ
Ë^ 
bgcﬁ
;

53 ((
uöt32_t
 *)
d
)[1] = (
dmask16
[(
f⁄t_d©a
 >> 0Ë& 0xf] & 
x‹cﬁ
Ë^ 
bgcﬁ
;

54 #ñi‡
BPP
 == 2

55 ((
uöt32_t
 *)
d
)[0] = (
dmask4
[(
f⁄t_d©a
 >> 6)] & 
x‹cﬁ
Ë^ 
bgcﬁ
;

56 ((
uöt32_t
 *)
d
)[1] = (
dmask4
[(
f⁄t_d©a
 >> 4Ë& 3] & 
x‹cﬁ
Ë^ 
bgcﬁ
;

57 ((
uöt32_t
 *)
d
)[2] = (
dmask4
[(
f⁄t_d©a
 >> 2Ë& 3] & 
x‹cﬁ
Ë^ 
bgcﬁ
;

58 ((
uöt32_t
 *)
d
)[3] = (
dmask4
[(
f⁄t_d©a
 >> 0Ë& 3] & 
x‹cﬁ
Ë^ 
bgcﬁ
;

60 ((
uöt32_t
 *)
d
)[0] = (-((
f⁄t_d©a
 >> 7)Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

61 ((
uöt32_t
 *)
d
)[1] = (-((
f⁄t_d©a
 >> 6Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

62 ((
uöt32_t
 *)
d
)[2] = (-((
f⁄t_d©a
 >> 5Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

63 ((
uöt32_t
 *)
d
)[3] = (-((
f⁄t_d©a
 >> 4Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

64 ((
uöt32_t
 *)
d
)[4] = (-((
f⁄t_d©a
 >> 3Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

65 ((
uöt32_t
 *)
d
)[5] = (-((
f⁄t_d©a
 >> 2Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

66 ((
uöt32_t
 *)
d
)[6] = (-((
f⁄t_d©a
 >> 1Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

67 ((
uöt32_t
 *)
d
)[7] = (-((
f⁄t_d©a
 >> 0Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

69 
	}
}

71 
	$glue
(
vga_døw_glyph8_
, 
DEPTH
)(
uöt8_t
 *
d
, 
löesize
,

72 c⁄° 
uöt8_t
 *
f⁄t_±r
, 
h
,

73 
uöt32_t
 
fgcﬁ
, uöt32_à
bgcﬁ
)

75 
uöt32_t
 
f⁄t_d©a
, 
x‹cﬁ
;

77 
x‹cﬁ
 = 
bgcﬁ
 ^ 
fgcﬁ
;

79 
f⁄t_d©a
 = 
f⁄t_±r
[0];

80 
	`glue
(
vga_døw_glyph_löe_
, 
DEPTH
)(
d
, 
f⁄t_d©a
, 
x‹cﬁ
, 
bgcﬁ
);

81 
f⁄t_±r
 += 4;

82 
d
 +
löesize
;

83 } --
h
);

84 
	}
}

86 
	$glue
(
vga_døw_glyph16_
, 
DEPTH
)(
uöt8_t
 *
d
, 
löesize
,

87 c⁄° 
uöt8_t
 *
f⁄t_±r
, 
h
,

88 
uöt32_t
 
fgcﬁ
, uöt32_à
bgcﬁ
)

90 
uöt32_t
 
f⁄t_d©a
, 
x‹cﬁ
;

92 
x‹cﬁ
 = 
bgcﬁ
 ^ 
fgcﬁ
;

94 
f⁄t_d©a
 = 
f⁄t_±r
[0];

95 
	`glue
(
vga_døw_glyph_löe_
, 
DEPTH
)(
d
,

96 
ex∑nd4to8
[
f⁄t_d©a
 >> 4],

97 
x‹cﬁ
, 
bgcﬁ
);

98 
	`glue
(
vga_døw_glyph_löe_
, 
DEPTH
)(
d
 + 8 * 
BPP
,

99 
ex∑nd4to8
[
f⁄t_d©a
 & 0x0f],

100 
x‹cﬁ
, 
bgcﬁ
);

101 
f⁄t_±r
 += 4;

102 
d
 +
löesize
;

103 } --
h
);

104 
	}
}

106 
	$glue
(
vga_døw_glyph9_
, 
DEPTH
)(
uöt8_t
 *
d
, 
löesize
,

107 c⁄° 
uöt8_t
 *
f⁄t_±r
, 
h
,

108 
uöt32_t
 
fgcﬁ
, uöt32_à
bgcﬁ
, 
dup9
)

110 
uöt32_t
 
f⁄t_d©a
, 
x‹cﬁ
, 
v
;

112 
x‹cﬁ
 = 
bgcﬁ
 ^ 
fgcﬁ
;

114 
f⁄t_d©a
 = 
f⁄t_±r
[0];

115 #i‡
BPP
 == 1

116 
	`˝u_to_32wu
((
uöt32_t
 *)
d
, (
dmask16
[(
f⁄t_d©a
 >> 4)] & 
x‹cﬁ
Ë^ 
bgcﬁ
);

117 
v
 = (
dmask16
[(
f⁄t_d©a
 >> 0Ë& 0xf] & 
x‹cﬁ
Ë^ 
bgcﬁ
;

118 
	`˝u_to_32wu
(((
uöt32_t
 *)
d
)+1, 
v
);

119 i‡(
dup9
)

120 ((
uöt8_t
 *)
d
)[8] = 
v
 >> (24 * (1 - 
BIG
));

122 ((
uöt8_t
 *)
d
)[8] = 
bgcﬁ
;

124 #ñi‡
BPP
 == 2

125 
	`˝u_to_32wu
(((
uöt32_t
 *)
d
)+0, (
dmask4
[(
f⁄t_d©a
 >> 6)] & 
x‹cﬁ
Ë^ 
bgcﬁ
);

126 
	`˝u_to_32wu
(((
uöt32_t
 *)
d
)+1, (
dmask4
[(
f⁄t_d©a
 >> 4Ë& 3] & 
x‹cﬁ
Ë^ 
bgcﬁ
);

127 
	`˝u_to_32wu
(((
uöt32_t
 *)
d
)+2, (
dmask4
[(
f⁄t_d©a
 >> 2Ë& 3] & 
x‹cﬁ
Ë^ 
bgcﬁ
);

128 
v
 = (
dmask4
[(
f⁄t_d©a
 >> 0Ë& 3] & 
x‹cﬁ
Ë^ 
bgcﬁ
;

129 
	`˝u_to_32wu
(((
uöt32_t
 *)
d
)+3, 
v
);

130 i‡(
dup9
)

131 ((
uöt16_t
 *)
d
)[8] = 
v
 >> (16 * (1 - 
BIG
));

133 ((
uöt16_t
 *)
d
)[8] = 
bgcﬁ
;

135 ((
uöt32_t
 *)
d
)[0] = (-((
f⁄t_d©a
 >> 7)Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

136 ((
uöt32_t
 *)
d
)[1] = (-((
f⁄t_d©a
 >> 6Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

137 ((
uöt32_t
 *)
d
)[2] = (-((
f⁄t_d©a
 >> 5Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

138 ((
uöt32_t
 *)
d
)[3] = (-((
f⁄t_d©a
 >> 4Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

139 ((
uöt32_t
 *)
d
)[4] = (-((
f⁄t_d©a
 >> 3Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

140 ((
uöt32_t
 *)
d
)[5] = (-((
f⁄t_d©a
 >> 2Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

141 ((
uöt32_t
 *)
d
)[6] = (-((
f⁄t_d©a
 >> 1Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

142 
v
 = (-((
f⁄t_d©a
 >> 0Ë& 1Ë& 
x‹cﬁ
Ë^ 
bgcﬁ
;

143 ((
uöt32_t
 *)
d
)[7] = 
v
;

144 i‡(
dup9
)

145 ((
uöt32_t
 *)
d
)[8] = 
v
;

147 ((
uöt32_t
 *)
d
)[8] = 
bgcﬁ
;

149 
f⁄t_±r
 += 4;

150 
d
 +
löesize
;

151 } --
h
);

152 
	}
}

157 
	$glue
(
vga_døw_löe2_
, 
DEPTH
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

158 c⁄° 
uöt8_t
 *
s
, 
width
)

160 
uöt32_t
 
∂™e_mask
, *
∑Àâe
, 
d©a
, 
v
;

161 
x
;

163 
∑Àâe
 = 
s1
->
œ°_∑Àâe
;

164 
∂™e_mask
 = 
mask16
[
s1
->
¨
[0x12] & 0xf];

165 
width
 >>= 3;

166 
x
 = 0; x < 
width
; x++) {

167 
d©a
 = ((
uöt32_t
 *)
s
)[0];

168 
d©a
 &
∂™e_mask
;

169 
v
 = 
ex∑nd2
[
	`GET_PLANE
(
d©a
, 0)];

170 
v
 |
ex∑nd2
[
	`GET_PLANE
(
d©a
, 2)] << 2;

171 ((
PIXEL_TYPE
 *)
d
)[0] = 
∑Àâe
[
v
 >> 12];

172 ((
PIXEL_TYPE
 *)
d
)[1] = 
∑Àâe
[(
v
 >> 8) & 0xf];

173 ((
PIXEL_TYPE
 *)
d
)[2] = 
∑Àâe
[(
v
 >> 4) & 0xf];

174 ((
PIXEL_TYPE
 *)
d
)[3] = 
∑Àâe
[(
v
 >> 0) & 0xf];

176 
v
 = 
ex∑nd2
[
	`GET_PLANE
(
d©a
, 1)];

177 
v
 |
ex∑nd2
[
	`GET_PLANE
(
d©a
, 3)] << 2;

178 ((
PIXEL_TYPE
 *)
d
)[4] = 
∑Àâe
[
v
 >> 12];

179 ((
PIXEL_TYPE
 *)
d
)[5] = 
∑Àâe
[(
v
 >> 8) & 0xf];

180 ((
PIXEL_TYPE
 *)
d
)[6] = 
∑Àâe
[(
v
 >> 4) & 0xf];

181 ((
PIXEL_TYPE
 *)
d
)[7] = 
∑Àâe
[(
v
 >> 0) & 0xf];

182 
d
 +
BPP
 * 8;

183 
s
 += 4;

185 
	}
}

187 #i‡
BPP
 == 1

188 
	#PUT_PIXEL2
(
d
, 
n
, 
v
Ë((
uöt16_t
 *)d)[“)] = (v)

	)

189 #ñi‡
BPP
 == 2

190 
	#PUT_PIXEL2
(
d
, 
n
, 
v
Ë((
uöt32_t
 *)d)[“)] = (v)

	)

192 
	#PUT_PIXEL2
(
d
, 
n
, 
v
) \

193 ((
uöt32_t
 *)
d
)[2*(
n
)] = ((uöt32_à*)d)[2*“)+1] = (
v
)

	)

199 
	$glue
(
vga_døw_löe2d2_
, 
DEPTH
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

200 c⁄° 
uöt8_t
 *
s
, 
width
)

202 
uöt32_t
 
∂™e_mask
, *
∑Àâe
, 
d©a
, 
v
;

203 
x
;

205 
∑Àâe
 = 
s1
->
œ°_∑Àâe
;

206 
∂™e_mask
 = 
mask16
[
s1
->
¨
[0x12] & 0xf];

207 
width
 >>= 3;

208 
x
 = 0; x < 
width
; x++) {

209 
d©a
 = ((
uöt32_t
 *)
s
)[0];

210 
d©a
 &
∂™e_mask
;

211 
v
 = 
ex∑nd2
[
	`GET_PLANE
(
d©a
, 0)];

212 
v
 |
ex∑nd2
[
	`GET_PLANE
(
d©a
, 2)] << 2;

213 
	`PUT_PIXEL2
(
d
, 0, 
∑Àâe
[
v
 >> 12]);

214 
	`PUT_PIXEL2
(
d
, 1, 
∑Àâe
[(
v
 >> 8) & 0xf]);

215 
	`PUT_PIXEL2
(
d
, 2, 
∑Àâe
[(
v
 >> 4) & 0xf]);

216 
	`PUT_PIXEL2
(
d
, 3, 
∑Àâe
[(
v
 >> 0) & 0xf]);

218 
v
 = 
ex∑nd2
[
	`GET_PLANE
(
d©a
, 1)];

219 
v
 |
ex∑nd2
[
	`GET_PLANE
(
d©a
, 3)] << 2;

220 
	`PUT_PIXEL2
(
d
, 4, 
∑Àâe
[
v
 >> 12]);

221 
	`PUT_PIXEL2
(
d
, 5, 
∑Àâe
[(
v
 >> 8) & 0xf]);

222 
	`PUT_PIXEL2
(
d
, 6, 
∑Àâe
[(
v
 >> 4) & 0xf]);

223 
	`PUT_PIXEL2
(
d
, 7, 
∑Àâe
[(
v
 >> 0) & 0xf]);

224 
d
 +
BPP
 * 16;

225 
s
 += 4;

227 
	}
}

232 
	$glue
(
vga_døw_löe4_
, 
DEPTH
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

233 c⁄° 
uöt8_t
 *
s
, 
width
)

235 
uöt32_t
 
∂™e_mask
, 
d©a
, 
v
, *
∑Àâe
;

236 
x
;

238 
∑Àâe
 = 
s1
->
œ°_∑Àâe
;

239 
∂™e_mask
 = 
mask16
[
s1
->
¨
[0x12] & 0xf];

240 
width
 >>= 3;

241 
x
 = 0; x < 
width
; x++) {

242 
d©a
 = ((
uöt32_t
 *)
s
)[0];

243 
d©a
 &
∂™e_mask
;

244 
v
 = 
ex∑nd4
[
	`GET_PLANE
(
d©a
, 0)];

245 
v
 |
ex∑nd4
[
	`GET_PLANE
(
d©a
, 1)] << 1;

246 
v
 |
ex∑nd4
[
	`GET_PLANE
(
d©a
, 2)] << 2;

247 
v
 |
ex∑nd4
[
	`GET_PLANE
(
d©a
, 3)] << 3;

248 ((
PIXEL_TYPE
 *)
d
)[0] = 
∑Àâe
[
v
 >> 28];

249 ((
PIXEL_TYPE
 *)
d
)[1] = 
∑Àâe
[(
v
 >> 24) & 0xf];

250 ((
PIXEL_TYPE
 *)
d
)[2] = 
∑Àâe
[(
v
 >> 20) & 0xf];

251 ((
PIXEL_TYPE
 *)
d
)[3] = 
∑Àâe
[(
v
 >> 16) & 0xf];

252 ((
PIXEL_TYPE
 *)
d
)[4] = 
∑Àâe
[(
v
 >> 12) & 0xf];

253 ((
PIXEL_TYPE
 *)
d
)[5] = 
∑Àâe
[(
v
 >> 8) & 0xf];

254 ((
PIXEL_TYPE
 *)
d
)[6] = 
∑Àâe
[(
v
 >> 4) & 0xf];

255 ((
PIXEL_TYPE
 *)
d
)[7] = 
∑Àâe
[(
v
 >> 0) & 0xf];

256 
d
 +
BPP
 * 8;

257 
s
 += 4;

259 
	}
}

264 
	$glue
(
vga_døw_löe4d2_
, 
DEPTH
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

265 c⁄° 
uöt8_t
 *
s
, 
width
)

267 
uöt32_t
 
∂™e_mask
, 
d©a
, 
v
, *
∑Àâe
;

268 
x
;

270 
∑Àâe
 = 
s1
->
œ°_∑Àâe
;

271 
∂™e_mask
 = 
mask16
[
s1
->
¨
[0x12] & 0xf];

272 
width
 >>= 3;

273 
x
 = 0; x < 
width
; x++) {

274 
d©a
 = ((
uöt32_t
 *)
s
)[0];

275 
d©a
 &
∂™e_mask
;

276 
v
 = 
ex∑nd4
[
	`GET_PLANE
(
d©a
, 0)];

277 
v
 |
ex∑nd4
[
	`GET_PLANE
(
d©a
, 1)] << 1;

278 
v
 |
ex∑nd4
[
	`GET_PLANE
(
d©a
, 2)] << 2;

279 
v
 |
ex∑nd4
[
	`GET_PLANE
(
d©a
, 3)] << 3;

280 
	`PUT_PIXEL2
(
d
, 0, 
∑Àâe
[
v
 >> 28]);

281 
	`PUT_PIXEL2
(
d
, 1, 
∑Àâe
[(
v
 >> 24) & 0xf]);

282 
	`PUT_PIXEL2
(
d
, 2, 
∑Àâe
[(
v
 >> 20) & 0xf]);

283 
	`PUT_PIXEL2
(
d
, 3, 
∑Àâe
[(
v
 >> 16) & 0xf]);

284 
	`PUT_PIXEL2
(
d
, 4, 
∑Àâe
[(
v
 >> 12) & 0xf]);

285 
	`PUT_PIXEL2
(
d
, 5, 
∑Àâe
[(
v
 >> 8) & 0xf]);

286 
	`PUT_PIXEL2
(
d
, 6, 
∑Àâe
[(
v
 >> 4) & 0xf]);

287 
	`PUT_PIXEL2
(
d
, 7, 
∑Àâe
[(
v
 >> 0) & 0xf]);

288 
d
 +
BPP
 * 16;

289 
s
 += 4;

291 
	}
}

298 
	$glue
(
vga_døw_löe8d2_
, 
DEPTH
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

299 c⁄° 
uöt8_t
 *
s
, 
width
)

301 
uöt32_t
 *
∑Àâe
;

302 
x
;

304 
∑Àâe
 = 
s1
->
œ°_∑Àâe
;

305 
width
 >>= 3;

306 
x
 = 0; x < 
width
; x++) {

307 
	`PUT_PIXEL2
(
d
, 0, 
∑Àâe
[
s
[0]]);

308 
	`PUT_PIXEL2
(
d
, 1, 
∑Àâe
[
s
[1]]);

309 
	`PUT_PIXEL2
(
d
, 2, 
∑Àâe
[
s
[2]]);

310 
	`PUT_PIXEL2
(
d
, 3, 
∑Àâe
[
s
[3]]);

311 
d
 +
BPP
 * 8;

312 
s
 += 4;

314 
	}
}

321 
	$glue
(
vga_døw_löe8_
, 
DEPTH
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

322 c⁄° 
uöt8_t
 *
s
, 
width
)

324 
uöt32_t
 *
∑Àâe
;

325 
x
;

327 
∑Àâe
 = 
s1
->
œ°_∑Àâe
;

328 
width
 >>= 3;

329 
x
 = 0; x < 
width
; x++) {

330 ((
PIXEL_TYPE
 *)
d
)[0] = 
∑Àâe
[
s
[0]];

331 ((
PIXEL_TYPE
 *)
d
)[1] = 
∑Àâe
[
s
[1]];

332 ((
PIXEL_TYPE
 *)
d
)[2] = 
∑Àâe
[
s
[2]];

333 ((
PIXEL_TYPE
 *)
d
)[3] = 
∑Àâe
[
s
[3]];

334 ((
PIXEL_TYPE
 *)
d
)[4] = 
∑Àâe
[
s
[4]];

335 ((
PIXEL_TYPE
 *)
d
)[5] = 
∑Àâe
[
s
[5]];

336 ((
PIXEL_TYPE
 *)
d
)[6] = 
∑Àâe
[
s
[6]];

337 ((
PIXEL_TYPE
 *)
d
)[7] = 
∑Àâe
[
s
[7]];

338 
d
 +
BPP
 * 8;

339 
s
 += 8;

341 
	}
}

343 
	$glue
(
vga_døw_curs‹_löe_
, 
DEPTH
)(
uöt8_t
 *
d1
,

344 c⁄° 
uöt8_t
 *
§c1
,

345 
poff£t
, 
w
,

346 
cﬁ‹0
,

347 
cﬁ‹1
,

348 
cﬁ‹_x‹
)

350 c⁄° 
uöt8_t
 *
∂™e0
, *
∂™e1
;

351 
x
, 
b0
, 
b1
;

352 
uöt8_t
 *
d
;

354 
d
 = 
d1
;

355 
∂™e0
 = 
§c1
;

356 
∂™e1
 = 
§c1
 + 
poff£t
;

357 
x
 = 0; x < 
w
; x++) {

358 
b0
 = (
∂™e0
[
x
 >> 3] >> (7 - (x & 7))) & 1;

359 
b1
 = (
∂™e1
[
x
 >> 3] >> (7 - (x & 7))) & 1;

360 #i‡
DEPTH
 == 8

361 
b0
 | (
b1
 << 1)) {

365 
d
[0] ^
cﬁ‹_x‹
;

368 
d
[0] = 
cﬁ‹0
;

371 
d
[0] = 
cﬁ‹1
;

374 #ñi‡
DEPTH
 == 16

375 
b0
 | (
b1
 << 1)) {

379 ((
uöt16_t
 *)
d
)[0] ^
cﬁ‹_x‹
;

382 ((
uöt16_t
 *)
d
)[0] = 
cﬁ‹0
;

385 ((
uöt16_t
 *)
d
)[0] = 
cﬁ‹1
;

388 #ñi‡
DEPTH
 == 32

389 
b0
 | (
b1
 << 1)) {

393 ((
uöt32_t
 *)
d
)[0] ^
cﬁ‹_x‹
;

396 ((
uöt32_t
 *)
d
)[0] = 
cﬁ‹0
;

399 ((
uöt32_t
 *)
d
)[0] = 
cﬁ‹1
;

403 #îr‹ 
unsuµ‹ãd
 
dïth


405 
d
 +
BPP
;

407 
	}
}

417 
	$glue
(
vga_døw_löe15_
, 
PIXEL_NAME
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

418 c⁄° 
uöt8_t
 *
s
, 
width
)

420 #i‡
DEPTH
 =15 && 
	`deföed
(
WORDS_BIGENDIAN
Ë=deföed(
TARGET_WORDS_BIGENDIAN
)

421 
	`mem˝y
(
d
, 
s
, 
width
 * 2);

423 
w
;

424 
uöt32_t
 
v
, 
r
, 
g
, 
b
;

426 
w
 = 
width
;

428 
v
 = 
	`lduw_øw
((*)
s
);

429 
r
 = (
v
 >> 7) & 0xf8;

430 
g
 = (
v
 >> 2) & 0xf8;

431 
b
 = (
v
 << 3) & 0xf8;

432 ((
PIXEL_TYPE
 *)
d
)[0] = 
	`glue
(
rgb_to_pixñ
, 
PIXEL_NAME
)(
r
, 
g
, 
b
);

433 
s
 += 2;

434 
d
 +
BPP
;

435 } --
w
 != 0);

437 
	}
}

442 
	$glue
(
vga_døw_löe16_
, 
PIXEL_NAME
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

443 c⁄° 
uöt8_t
 *
s
, 
width
)

445 #i‡
DEPTH
 =16 && 
	`deföed
(
WORDS_BIGENDIAN
Ë=deföed(
TARGET_WORDS_BIGENDIAN
)

446 
	`mem˝y
(
d
, 
s
, 
width
 * 2);

448 
w
;

449 
uöt32_t
 
v
, 
r
, 
g
, 
b
;

451 
w
 = 
width
;

453 
v
 = 
	`lduw_øw
((*)
s
);

454 
r
 = (
v
 >> 8) & 0xf8;

455 
g
 = (
v
 >> 3) & 0xfc;

456 
b
 = (
v
 << 3) & 0xf8;

457 ((
PIXEL_TYPE
 *)
d
)[0] = 
	`glue
(
rgb_to_pixñ
, 
PIXEL_NAME
)(
r
, 
g
, 
b
);

458 
s
 += 2;

459 
d
 +
BPP
;

460 } --
w
 != 0);

462 
	}
}

467 
	$glue
(
vga_døw_löe24_
, 
PIXEL_NAME
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

468 c⁄° 
uöt8_t
 *
s
, 
width
)

470 
w
;

471 
uöt32_t
 
r
, 
g
, 
b
;

473 
w
 = 
width
;

475 #i‡
	`deföed
(
TARGET_WORDS_BIGENDIAN
)

476 
r
 = 
s
[0];

477 
g
 = 
s
[1];

478 
b
 = 
s
[2];

480 
b
 = 
s
[0];

481 
g
 = 
s
[1];

482 
r
 = 
s
[2];

484 ((
PIXEL_TYPE
 *)
d
)[0] = 
	`glue
(
rgb_to_pixñ
, 
PIXEL_NAME
)(
r
, 
g
, 
b
);

485 
s
 += 3;

486 
d
 +
BPP
;

487 } --
w
 != 0);

488 
	}
}

493 
	$glue
(
vga_døw_löe32_
, 
PIXEL_NAME
)(
VGASèã
 *
s1
, 
uöt8_t
 *
d
,

494 c⁄° 
uöt8_t
 *
s
, 
width
)

496 #i‡
DEPTH
 =32 && 
	`deföed
(
WORDS_BIGENDIAN
Ë=deföed(
TARGET_WORDS_BIGENDIAN
Ë&& !deföed(
BGR_FORMAT
)

497 
	`mem˝y
(
d
, 
s
, 
width
 * 4);

499 
w
;

500 
uöt32_t
 
r
, 
g
, 
b
;

502 
w
 = 
width
;

504 #i‡
	`deföed
(
TARGET_WORDS_BIGENDIAN
)

505 
r
 = 
s
[1];

506 
g
 = 
s
[2];

507 
b
 = 
s
[3];

509 
b
 = 
s
[0];

510 
g
 = 
s
[1];

511 
r
 = 
s
[2];

513 ((
PIXEL_TYPE
 *)
d
)[0] = 
	`glue
(
rgb_to_pixñ
, 
PIXEL_NAME
)(
r
, 
g
, 
b
);

514 
s
 += 4;

515 
d
 +
BPP
;

516 } --
w
 != 0);

518 
	}
}

520 #unde‡
PUT_PIXEL2


521 #unde‡
DEPTH


522 #unde‡
BPP


523 #unde‡
PIXEL_TYPE


524 #unde‡
PIXEL_NAME


525 #unde‡
BGR_FORMAT


	@xen_console.c

23 
	~<mÆloc.h
>

24 
	~<°dlib.h
>

25 
	~<î∫o.h
>

26 
	~<°rög.h
>

27 
	~<sys/£À˘.h
>

28 
	~<f˙é.h
>

29 
	~<uni°d.h
>

30 
	~<ãrmios.h
>

31 
	~<°d¨g.h
>

32 
	~<sys/mm™.h
>

33 
	~<xs.h
>

34 
	~<xí/io/c⁄sﬁe.h
>

35 
	~<xí˘æ.h
>

37 
	~"vl.h
"

39 
	~"xí_c⁄sﬁe.h
"

41 
	#dﬁog
(
vÆ
, 
fmt
, ...Ë
	`Ârötf
(
°dîr
, fmà"\n", ## 
__VA_ARGS__
)

	)

43 
	sbuf„r


45 
uöt8_t
 *
	md©a
;

46 
size_t
 
	mc⁄sumed
;

47 
size_t
 
	msize
;

48 
size_t
 
	mˇ∑côy
;

49 
size_t
 
	mmax_ˇ∑côy
;

52 
	sdomaö


54 
	mdomid
;

55 
buf„r
 
	mbuf„r
;

57 *
	mc⁄•©h
;

58 *
	m£rüÕ©h
;

59 
	mu£_c⁄sﬁï©h
;

60 
	mrög_ªf
;

61 
evtchn_p‹t_t
 
	mloˇl_p‹t
;

62 
evtchn_p‹t_t
 
	mªmŸe_p‹t
;

63 
	mx˚_h™dÀ
;

64 
xs_h™dÀ
 *
	mxsh
;

65 
xíc⁄s_öãrÁ˚
 *
	möãrÁ˚
;

66 
Ch¨DrivîSèã
 *
	mchr
;

70 
	$buf„r_≠≥nd
(
domaö
 *
dom
)

72 
buf„r
 *buf„∏&
dom
->buffer;

73 
XENCONS_RING_IDX
 
c⁄s
, 
¥od
, 
size
;

74 
xíc⁄s_öãrÁ˚
 *
ötf
 = 
dom
->
öãrÁ˚
;

76 
c⁄s
 = 
ötf
->
out_c⁄s
;

77 
¥od
 = 
ötf
->
out_¥od
;

78 
	`mb
();

80 
size
 = 
¥od
 - 
c⁄s
;

81 i‡((
size
 =0Ë|| (sizê> (
ötf
->
out
)))

84 i‡((
buf„r
->
ˇ∑côy
 - buf„r->
size
) < size) {

85 
buf„r
->
ˇ∑côy
 +(
size
 + 1024);

86 
buf„r
->
d©a
 = 
	`ªÆloc
(buf„r->d©a, buf„r->
ˇ∑côy
);

87 i‡(
buf„r
->
d©a
 =
NULL
) {

88 
	`dﬁog
(
LOG_ERR
, "Memoryállocation failed");

89 
	`exô
(
ENOMEM
);

93 
c⁄s
 !
¥od
)

94 
buf„r
->
d©a
[buf„r->
size
++] = 
ötf
->
out
[

95 
	`MASK_XENCONS_IDX
(
c⁄s
++, 
ötf
->
out
)];

97 
	`mb
();

98 
ötf
->
out_c⁄s
 = 
c⁄s
;

99 
	`xc_evtchn_nŸify
(
dom
->
x˚_h™dÀ
, dom->
loˇl_p‹t
);

101 i‡(
buf„r
->
max_ˇ∑côy
 &&

102 
buf„r
->
size
 > buf„r->
max_ˇ∑côy
) {

105 
size_t
 
ovî
 = 
buf„r
->
size
 - buf„r->
max_ˇ∑côy
;

106 
uöt8_t
 *
maxpos
 = 
buf„r
->
d©a
 + buf„r->
max_ˇ∑côy
;

108 
	`memmove
(
maxpos
 - 
ovî
, maxpos, over);

109 
buf„r
->
d©a
 = 
	`ªÆloc
(buf„r->d©a, buf„r->
max_ˇ∑côy
);

110 
buf„r
->
size
 = buf„r->
ˇ∑côy
 = buf„r->
max_ˇ∑côy
;

112 i‡(
buf„r
->
c⁄sumed
 > buf„r->
max_ˇ∑côy
 - 
ovî
)

113 
buf„r
->
c⁄sumed
 = buf„r->
max_ˇ∑côy
 - 
ovî
;

115 
	}
}

117 
	$buf„r_adv™˚
(
buf„r
 *buf„r, 
size_t
 
Àn
)

119 
buf„r
->
c⁄sumed
 +
Àn
;

120 i‡(
buf„r
->
c⁄sumed
 =buf„r->
size
) {

121 
buf„r
->
c⁄sumed
 = 0;

122 
buf„r
->
size
 = 0;

124 
	}
}

127 
	$xs_g©hî
(
xs_h™dÀ
 *
xs
, c⁄° *
dú
, ...)

129 
va_li°
 
≠
;

130 c⁄° *
«me
;

131 *
∑th
;

132 
ªt
 = 0;

134 
	`va_°¨t
(
≠
, 
dú
);

135 
ªt
 =0 && (
«me
 = 
	`va_¨g
(
≠
, *)Ë!
NULL
) {

136 c⁄° *
fmt
 = 
	`va_¨g
(
≠
, *);

137 *
ªsu…
 = 
	`va_¨g
(
≠
, *);

138 *
p
;

140 i‡(
	`a•rötf
(&
∑th
, "%s/%s", 
dú
, 
«me
) == -1) {

141 
ªt
 = 
ENOMEM
;

144 
p
 = 
	`xs_ªad
(
xs
, 
XBT_NULL
, 
∑th
, 
NULL
);

145 
	`‰ì
(
∑th
);

146 i‡(
p
 =
NULL
) {

147 
ªt
 = 
ENOENT
;

150 i‡(
fmt
) {

151 i‡(
	`ssˇnf
(
p
, 
fmt
, 
ªsu…
) == 0)

152 
ªt
 = 
EINVAL
;

153 
	`‰ì
(
p
);

155 *(**)
ªsu…
 = 
p
;

157 
	`va_íd
(
≠
);

158  
ªt
;

159 
	}
}

161 
	$domaö_¸óã_rög
(
domaö
 *
dom
)

163 
îr
, 
ªmŸe_p‹t
, 
rög_ªf
, 
rc
;

165 
îr
 = 
	`xs_g©hî
(
dom
->
xsh
, dom->
£rüÕ©h
,

166 "rög-ªf", "%u", &
rög_ªf
,

167 "p‹t", "%i", &
ªmŸe_p‹t
,

168 
NULL
);

169 i‡(
îr
) {

170 
îr
 = 
	`xs_g©hî
(
dom
->
xsh
, dom->
c⁄•©h
,

171 "rög-ªf", "%u", &
rög_ªf
,

172 "p‹t", "%i", &
ªmŸe_p‹t
,

173 
NULL
);

174 i‡(
îr
) {

175 
	`Ârötf
(
°dîr
, "Console: failedÅo findÑing-ref/port yet\n");

176 
out
;

178 
dom
->
u£_c⁄sﬁï©h
 = 1;

180 
dom
->
u£_c⁄sﬁï©h
 = 0;

181 
	`Ârötf
(
°dîr
, "C⁄sﬁe: gŸÑög-ª‡%dÖ‹à%d\n", 
rög_ªf
, 
ªmŸe_p‹t
);

183 i‡((
rög_ªf
 =
dom
->rög_ªfË&& (
ªmŸe_p‹t
 == dom->remote_port))

184 
out
;

186 i‡(
rög_ªf
 !
dom
->ring_ref) {

187 i‡(
dom
->
öãrÁ˚
 !
NULL
)

188 
	`munm≠
(
dom
->
öãrÁ˚
, 
	`gë∑gesize
());

189 
dom
->
öãrÁ˚
 = 
	`xc_m≠_f‹eign_ønge
(

190 
xc_h™dÀ
, 
dom
->
domid
, 
	`gë∑gesize
(),

191 
PROT_READ
|
PROT_WRITE
,

192 ()
rög_ªf
);

193 i‡(
dom
->
öãrÁ˚
 =
NULL
) {

194 
îr
 = 
î∫o
;

195 
out
;

197 
dom
->
rög_ªf
 =Ñing_ref;

200 
dom
->
loˇl_p‹t
 = -1;

201 
dom
->
ªmŸe_p‹t
 = -1;

203 
dom
->
x˚_h™dÀ
 = 
	`xc_evtchn_›í
();

204 i‡(
dom
->
x˚_h™dÀ
 == -1) {

205 
îr
 = 
î∫o
;

206 
out
;

209 
rc
 = 
	`xc_evtchn_böd_öãrdomaö
(
dom
->
x˚_h™dÀ
,

210 
dom
->
domid
, 
ªmŸe_p‹t
);

212 i‡(
rc
 == -1) {

213 
îr
 = 
î∫o
;

214 
	`xc_evtchn_˛o£
(
dom
->
x˚_h™dÀ
);

215 
dom
->
x˚_h™dÀ
 = -1;

216 
out
;

218 
dom
->
loˇl_p‹t
 = 
rc
;

219 
dom
->
ªmŸe_p‹t
 =Ñemote_port;

221 
out
:

222  
îr
;

223 
	}
}

226 
domaö
 *
	$¸óã_domaö
(
domid
, 
Ch¨DrivîSèã
 *
chr
)

228 
domaö
 *
dom
;

229 *
s
;

231 
dom
 = (
domaö
 *)
	`mÆloc
((domain));

232 i‡(
dom
 =
NULL
) {

233 
	`dﬁog
(
LOG_ERR
, "Out of memory %s:%s():L%d",

234 
__FILE__
, 
__FUNCTION__
, 
__LINE__
);

235 
	`exô
(
ENOMEM
);

238 
dom
->
domid
 = domid;

239 
dom
->
chr
 = chr;

241 
dom
->
xsh
 = 
	`xs_d´m⁄_›í
();

242 i‡(
dom
->
xsh
 =
NULL
) {

243 
	`Ârötf
(
logfûe
, "CouldÇot contact xenstore for console watch\n");

244 
out
;

247 
dom
->
£rüÕ©h
 = 
	`xs_gë_domaö_∑th
(dom->
xsh
, dom->
domid
);

248 
s
 = 
	`ªÆloc
(
dom
->
£rüÕ©h
, 
	`°æí
(dom->serialpath) +

249 
	`°æí
("/serial/0") + 1);

250 i‡(
s
 =
NULL
)

251 
out
;

252 
dom
->
£rüÕ©h
 = 
s
;

253 
	`°rˇt
(
dom
->
£rüÕ©h
, "/serial/0");

255 
dom
->
c⁄•©h
 = 
	`xs_gë_domaö_∑th
(dom->
xsh
, dom->
domid
);

256 
s
 = 
	`ªÆloc
(
dom
->
c⁄•©h
, 
	`°æí
(dom->conspath) +

257 
	`°æí
("/console") + 1);

258 i‡(
s
 =
NULL
)

259 
out
;

260 
dom
->
c⁄•©h
 = 
s
;

261 
	`°rˇt
(
dom
->
c⁄•©h
, "/console");

263 
dom
->
buf„r
.
d©a
 = 0;

264 
dom
->
buf„r
.
c⁄sumed
 = 0;

265 
dom
->
buf„r
.
size
 = 0;

266 
dom
->
buf„r
.
ˇ∑côy
 = 0;

267 
dom
->
buf„r
.
max_ˇ∑côy
 = 0;

269 
dom
->
rög_ªf
 = -1;

270 
dom
->
loˇl_p‹t
 = -1;

271 
dom
->
ªmŸe_p‹t
 = -1;

272 
dom
->
öãrÁ˚
 = 
NULL
;

273 
dom
->
x˚_h™dÀ
 = -1;

276  
dom
;

277 
out
:

278 
	`‰ì
(
dom
->
£rüÕ©h
);

279 
	`‰ì
(
dom
->
c⁄•©h
);

280 
	`‰ì
(
dom
);

281  
NULL
;

282 
	}
}

285 
	$rög_‰ì_byãs
(
domaö
 *
dom
)

287 
xíc⁄s_öãrÁ˚
 *
ötf
 = 
dom
->
öãrÁ˚
;

288 
XENCONS_RING_IDX
 
c⁄s
, 
¥od
, 
•a˚
;

290 
c⁄s
 = 
ötf
->
ö_c⁄s
;

291 
¥od
 = 
ötf
->
ö_¥od
;

292 
	`mb
();

294 
•a˚
 = 
¥od
 - 
c⁄s
;

295 i‡(
•a˚
 > (
ötf
->
ö
))

298  ((
ötf
->
ö
Ë- 
•a˚
);

299 
	}
}

301 
	$xíc⁄s_ˇn_ª˚ive
(*
›aque
)

303 
domaö
 *
dom
 = (domaö *)
›aque
;

305  
	`rög_‰ì_byãs
(
dom
);

306 
	}
}

308 
	$xíc⁄s_ª˚ive
(*
›aque
, c⁄° 
uöt8_t
 *
buf
, 
Àn
)

310 
domaö
 *
dom
 = (domaö *)
›aque
;

311 
i
, 
max
;

312 
xíc⁄s_öãrÁ˚
 *
ötf
 = 
dom
->
öãrÁ˚
;

313 
XENCONS_RING_IDX
 
¥od
;

315 
max
 = 
	`rög_‰ì_byãs
(
dom
);

317 i‡(
max
 < 
Àn
)

318 
Àn
 = 
max
;

320 
¥od
 = 
ötf
->
ö_¥od
;

321 
i
 = 0; i < 
Àn
; i++) {

322 
ötf
->
ö
[
	`MASK_XENCONS_IDX
(
¥od
++, intf->in)] =

323 
buf
[
i
];

325 
	`wmb
();

326 
ötf
->
ö_¥od
 = 
¥od
;

327 
	`xc_evtchn_nŸify
(
dom
->
x˚_h™dÀ
, dom->
loˇl_p‹t
);

328 
	}
}

330 
	$xíc⁄s_£nd
(
domaö
 *
dom
)

332 
ssize_t
 
Àn
;

333 
Àn
 = 
	`qemu_chr_wrôe
(
dom
->
chr
, dom->
buf„r
.
d©a
 + dom->buf„r.
c⁄sumed
,

334 
dom
->
buf„r
.
size
 - dom->buf„r.
c⁄sumed
);

335 i‡(
Àn
 < 1) {

345 
	`buf„r_adv™˚
(&
dom
->
buf„r
, 
Àn
);

347 
	}
}

349 
	$xíc⁄s_rög_ªad
(*
›aque
)

351 
evtchn_p‹t_t
 
p‹t
;

352 
domaö
 *
dom
 = (domaö *)
›aque
;

354 i‡((
p‹t
 = 
	`xc_evtchn_≥ndög
(
dom
->
x˚_h™dÀ
)) == -1)

357 
	`buf„r_≠≥nd
(
dom
);

359 ()
	`xc_evtchn_unmask
(
dom
->
x˚_h™dÀ
, 
p‹t
);

361 i‡(
dom
->
buf„r
.
size
 - dom->buf„r.
c⁄sumed
)

362 
	`xíc⁄s_£nd
(
dom
);

363 
	}
}

365 
	$xíc⁄s_°¨tup
(*
›aque
)

367 
domaö
 *
dom
 = (domaö *)
›aque
;

368 
dummy
;

369 **
vec
;

370 
îr
;

371 
vec
 = 
	`xs_ªad_w©ch
(
dom
->
xsh
, &
dummy
);

372 i‡(
vec
)

373 
	`‰ì
(
vec
);

374 
	`Ârötf
(
°dîr
, "Console: got watch\n");

375 
îr
 = 
	`domaö_¸óã_rög
(
dom
);

376 i‡(
îr
)

379 
	`xs_unw©ch
(
dom
->
xsh
, dom->
c⁄•©h
, "");

380 
	`xs_unw©ch
(
dom
->
xsh
, dom->
£rüÕ©h
, "");

381 
	`qemu_£t_fd_h™dÀr2
(
	`xs_fûío
(
dom
->
xsh
), 
NULL
, NULL, NULL, NULL);

383 
	`Ârötf
(
°dîr
, "Console: connectedÅo guest frontend\n");

384 i‡(
	`qemu_£t_fd_h™dÀr2
(
	`xc_evtchn_fd
(
dom
->
x˚_h™dÀ
), 
NULL
, 
xíc⁄s_rög_ªad
, NULL, dom) < 0)

387 
	`qemu_chr_add_h™dÀrs
(
dom
->
chr
, 
xíc⁄s_ˇn_ª˚ive
, 
xíc⁄s_ª˚ive
,

388 
NULL
, 
dom
);

389 
	}
}

392 
	$xíc⁄s_öô
(
domid
, 
Ch¨DrivîSèã
 *
chr
)

394 
domaö
 *
dom
 = 
	`¸óã_domaö
(
domid
, 
chr
);

396 i‡(!
dom
)

400 i‡(!(
	`xs_w©ch
(
dom
->
xsh
, dom->
c⁄•©h
, ""))) {

401 
	`Ârötf
(
°dîr
, "U«bÀÅÿw©ch c⁄sﬁê%s\n", 
dom
->
c⁄•©h
);

402 
Áû
;

404 i‡(!(
	`xs_w©ch
(
dom
->
xsh
, dom->
£rüÕ©h
, ""))) {

405 
	`Ârötf
(
°dîr
, "U«bÀÅÿw©ch c⁄sﬁê%s\n", 
dom
->
c⁄•©h
);

406 
	`xs_unw©ch
(
dom
->
xsh
, dom->
c⁄•©h
, "");

407 
Áû
;

409 
	`qemu_£t_fd_h™dÀr2
(
	`xs_fûío
(
dom
->
xsh
), 
NULL
, 
xíc⁄s_°¨tup
, NULL, dom);

410 
	`Ârötf
(
°dîr
, "Console:Örepared domain, waiting forÑingrefát %s or %s\n",

411 
dom
->
c⁄•©h
, dom->
£rüÕ©h
);

415 
Áû
:

416 
	`xs_d´m⁄_˛o£
(
dom
->
xsh
);

417 
	`‰ì
(
dom
->
£rüÕ©h
);

418 
	`‰ì
(
dom
->
c⁄•©h
);

419 
	`‰ì
(
dom
);

421 
	}
}

	@xen_console.h

23 
	~"vl.h
"

25 
xíc⁄s_öô
(
domid
, 
Ch¨DrivîSèã
 *
chr
);

	@xen_machine_fv.c

26 
	~"vl.h
"

27 
	~<xí/hvm/∑øms.h
>

28 
	~<sys/mm™.h
>

30 #i‡
deföed
(
MAPCACHE
)

32 #i‡
deföed
(
__i386__
)

33 
	#MAX_MCACHE_SIZE
 0x40000000

	)

34 
	#MCACHE_BUCKET_SHIFT
 16

	)

35 #ñi‡
deföed
(
__x86_64__
)

36 
	#MAX_MCACHE_SIZE
 0x1000000000

	)

37 
	#MCACHE_BUCKET_SHIFT
 20

	)

40 
	#MCACHE_BUCKET_SIZE
 (1UL << 
MCACHE_BUCKET_SHIFT
)

	)

42 
	#BITS_PER_LONG
 (()*8)

	)

43 
	#BITS_TO_LONGS
(
bôs
) \

44 (((
bôs
)+
BITS_PER_LONG
-1)/BITS_PER_LONG)

	)

45 
	#DECLARE_BITMAP
(
«me
,
bôs
) \

46 
«me
[
	`BITS_TO_LONGS
(
bôs
)]

	)

47 
	#ã°_bô
(
bô
,
m≠
) \

48 (!!((
m≠
)[(
bô
)/
BITS_PER_LONG
] & (1UL << ((bô)%BITS_PER_LONG))))

	)

50 
	sm≠_ˇche
 {

51 
	m∑ddr_ödex
;

52 
uöt8_t
 *
	mvaddr_ba£
;

53 
DECLARE_BITMAP
(
vÆid_m≠pög
, 
MCACHE_BUCKET_SIZE
>>
XC_PAGE_SHIFT
);

56 
m≠_ˇche
 *
	gm≠ˇche_íåy
;

57 
	gƒ_buckës
;

60 
	gœ°_addªss_ödex
 = ~0UL;

61 
uöt8_t
 *
	gœ°_addªss_vaddr
;

63 
	$qemu_m≠_ˇche_öô
()

65 
size
;

67 
ƒ_buckës
 = (((
MAX_MCACHE_SIZE
 >> 
XC_PAGE_SHIFT
) +

68 (1UL << (
MCACHE_BUCKET_SHIFT
 - 
XC_PAGE_SHIFT
)) - 1) >>

69 (
MCACHE_BUCKET_SHIFT
 - 
XC_PAGE_SHIFT
));

76 
size
 = 
ƒ_buckës
 * (
m≠_ˇche
);

77 
size
 = (sizê+ 
XC_PAGE_SIZE
 - 1) & ~(XC_PAGE_SIZE - 1);

78 
	`Ârötf
(
logfûe
, "qemu_m≠_ˇche_öôÇr_buckë†%lx sizê%lu\n", 
ƒ_buckës
, 
size
);

79 
m≠ˇche_íåy
 = 
	`mm≠
(
NULL
, 
size
, 
PROT_READ
|
PROT_WRITE
,

80 
MAP_SHARED
|
MAP_ANON
, -1, 0);

81 i‡(
m≠ˇche_íåy
 =
MAP_FAILED
) {

82 
î∫o
 = 
ENOMEM
;

87 
	}
}

89 
	$qemu_ªm≠_buckë
(
m≠_ˇche
 *
íåy
,

90 
addªss_ödex
)

92 
uöt8_t
 *
vaddr_ba£
;

93 
p‚s
[
MCACHE_BUCKET_SIZE
 >> 
XC_PAGE_SHIFT
];

94 
i
, 
j
;

96 i‡(
íåy
->
vaddr_ba£
 !
NULL
) {

97 
î∫o
 = 
	`munm≠
(
íåy
->
vaddr_ba£
, 
MCACHE_BUCKET_SIZE
);

98 i‡(
î∫o
) {

99 
	`Ârötf
(
logfûe
, "unm≠ faû†%d\n", 
î∫o
);

100 
	`exô
(-1);

104 
i
 = 0; i < 
MCACHE_BUCKET_SIZE
 >> 
XC_PAGE_SHIFT
; i++)

105 
p‚s
[
i
] = (
addªss_ödex
 << (
MCACHE_BUCKET_SHIFT
-
XC_PAGE_SHIFT
)) + i;

107 
vaddr_ba£
 = 
	`xc_m≠_f‹eign_b©ch
(
xc_h™dÀ
, 
domid
, 
PROT_READ
|
PROT_WRITE
,

108 
p‚s
, 
MCACHE_BUCKET_SIZE
 >> 
XC_PAGE_SHIFT
);

109 i‡(
vaddr_ba£
 =
NULL
) {

110 
	`Ârötf
(
logfûe
, "xc_m≠_f‹eign_b©chÉº‹ %d\n", 
î∫o
);

111 
	`exô
(-1);

114 
íåy
->
vaddr_ba£
 = vaddr_base;

115 
íåy
->
∑ddr_ödex
 = 
addªss_ödex
;

117 
i
 = 0; i < 
MCACHE_BUCKET_SIZE
 >> 
XC_PAGE_SHIFT
; i +
BITS_PER_LONG
) {

118 
w‹d
 = 0;

119 
j
 = ((
i
 + 
BITS_PER_LONG
Ë> (
MCACHE_BUCKET_SIZE
 >> 
XC_PAGE_SHIFT
)) ?

120 (
MCACHE_BUCKET_SIZE
 >> 
XC_PAGE_SHIFT
Ë% 
BITS_PER_LONG
 : BITS_PER_LONG;

121 
j
 > 0)

122 
w‹d
 = (w‹d << 1Ë| (((
p‚s
[
i
 + --
j
] >> 28) & 0xf) != 0xf);

123 
íåy
->
vÆid_m≠pög
[
i
 / 
BITS_PER_LONG
] = 
w‹d
;

125 
	}
}

127 
uöt8_t
 *
	$qemu_m≠_ˇche
(
èrgë_phys_addr_t
 
phys_addr
)

129 
m≠_ˇche
 *
íåy
;

130 
addªss_ödex
 = 
phys_addr
 >> 
MCACHE_BUCKET_SHIFT
;

131 
addªss_off£t
 = 
phys_addr
 & (
MCACHE_BUCKET_SIZE
-1);

133 i‡(
addªss_ödex
 =
œ°_addªss_ödex
)

134  
œ°_addªss_vaddr
 + 
addªss_off£t
;

136 
íåy
 = &
m≠ˇche_íåy
[
addªss_ödex
 % 
ƒ_buckës
];

138 i‡(
íåy
->
vaddr_ba£
 =
NULL
 ||É¡ry->
∑ddr_ödex
 !
addªss_ödex
 ||

139 !
	`ã°_bô
(
addªss_off£t
>>
XC_PAGE_SHIFT
, 
íåy
->
vÆid_m≠pög
))

140 
	`qemu_ªm≠_buckë
(
íåy
, 
addªss_ödex
);

142 i‡(!
	`ã°_bô
(
addªss_off£t
>>
XC_PAGE_SHIFT
, 
íåy
->
vÆid_m≠pög
))

143  
NULL
;

145 
œ°_addªss_ödex
 = 
addªss_ödex
;

146 
œ°_addªss_vaddr
 = 
íåy
->
vaddr_ba£
;

148  
œ°_addªss_vaddr
 + 
addªss_off£t
;

149 
	}
}

151 
	$qemu_övÆid©e_m≠_ˇche
()

153 
i
;

155 
	`m≠ˇche_lock
();

157 
i
 = 0; i < 
ƒ_buckës
; i++) {

158 
m≠_ˇche
 *
íåy
 = &
m≠ˇche_íåy
[
i
];

160 i‡(
íåy
->
vaddr_ba£
 =
NULL
)

163 
î∫o
 = 
	`munm≠
(
íåy
->
vaddr_ba£
, 
MCACHE_BUCKET_SIZE
);

164 i‡(
î∫o
) {

165 
	`Ârötf
(
logfûe
, "unm≠ faû†%d\n", 
î∫o
);

166 
	`exô
(-1);

169 
íåy
->
∑ddr_ödex
 = 0;

170 
íåy
->
vaddr_ba£
 = 
NULL
;

173 
œ°_addªss_ödex
 = ~0UL;

174 
œ°_addªss_vaddr
 = 
NULL
;

176 
	`m≠ˇche_u∆ock
();

177 
	}
}

182 
	$xí_öô_fv
(
uöt64_t
 
øm_size
, 
vga_øm_size
, *
boŸ_devi˚
,

183 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
,

184 
¢≠shŸ
,

185 c⁄° *
kî√l_fûíame
,

186 c⁄° *
kî√l_cmdlöe
,

187 c⁄° *
öôrd_fûíame
,

188 c⁄° *
dúe˘_pci
)

190 
i‹eq_p‚
;

191 *
sh¨ed_∑ge
;

192 *
buf„ªd_io_∑ge
;

193 #ifde‡
__ü64__


194 
ƒ_∑ges
;

195 
xí_p‚_t
 *
∑ge_¨øy
;

196 *
buf„ªd_pio_∑ge
;

197 
i
;

200 #i‡
	`deföed
(
__i386__
Ë|| deföed(
__x86_64__
)

202 i‡(
	`qemu_m≠_ˇche_öô
()) {

203 
	`Ârötf
(
logfûe
, "qemu_m≠_ˇche_öôÑëu∫ed:Éº‹ %d\n", 
î∫o
);

204 
	`exô
(-1);

208 
	`xc_gë_hvm_∑øm
(
xc_h™dÀ
, 
domid
, 
HVM_PARAM_IOREQ_PFN
, &
i‹eq_p‚
);

209 
	`Ârötf
(
logfûe
, "sh¨edÖagê©Ö‚ %lx\n", 
i‹eq_p‚
);

210 
sh¨ed_∑ge
 = 
	`xc_m≠_f‹eign_ønge
(
xc_h™dÀ
, 
domid
, 
XC_PAGE_SIZE
,

211 
PROT_READ
|
PROT_WRITE
, 
i‹eq_p‚
);

212 i‡(
sh¨ed_∑ge
 =
NULL
) {

213 
	`Ârötf
(
logfûe
, "m≠ sh¨ed IOÖagêªtu∫edÉº‹ %d\n", 
î∫o
);

214 
	`exô
(-1);

217 
	`xc_gë_hvm_∑øm
(
xc_h™dÀ
, 
domid
, 
HVM_PARAM_BUFIOREQ_PFN
, &
i‹eq_p‚
);

218 
	`Ârötf
(
logfûe
, "buf„ªd iÿ∑gê©Ö‚ %lx\n", 
i‹eq_p‚
);

219 
buf„ªd_io_∑ge
 = 
	`xc_m≠_f‹eign_ønge
(
xc_h™dÀ
, 
domid
, 
XC_PAGE_SIZE
,

220 
PROT_READ
|
PROT_WRITE
, 
i‹eq_p‚
);

221 i‡(
buf„ªd_io_∑ge
 =
NULL
) {

222 
	`Ârötf
(
logfûe
, "m≠ buf„ªd IOÖagêªtu∫edÉº‹ %d\n", 
î∫o
);

223 
	`exô
(-1);

226 #i‡
	`deföed
(
__ü64__
)

227 
	`xc_gë_hvm_∑øm
(
xc_h™dÀ
, 
domid
, 
HVM_PARAM_BUFPIOREQ_PFN
, &
i‹eq_p‚
);

228 
	`Ârötf
(
logfûe
, "buf„ªdÖiÿ∑gê©Ö‚ %lx\n", 
i‹eq_p‚
);

229 
buf„ªd_pio_∑ge
 = 
	`xc_m≠_f‹eign_ønge
(
xc_h™dÀ
, 
domid
, 
XC_PAGE_SIZE
,

230 
PROT_READ
|
PROT_WRITE
, 
i‹eq_p‚
);

231 i‡(
buf„ªd_pio_∑ge
 =
NULL
) {

232 
	`Ârötf
(
logfûe
, "m≠ buf„ªd PIOÖagêªtu∫edÉº‹ %d\n", 
î∫o
);

233 
	`exô
(-1);

236 
ƒ_∑ges
 = 
øm_size
 / 
XC_PAGE_SIZE
;

238 
∑ge_¨øy
 = (
xí_p‚_t
 *)
	`mÆloc
(
ƒ_∑ges
 * (xen_pfn_t));

239 i‡(
∑ge_¨øy
 =
NULL
) {

240 
	`Ârötf
(
logfûe
, "mÆlo¯ªtu∫edÉº‹ %d\n", 
î∫o
);

241 
	`exô
(-1);

244 
i
 = 0; i < 
ƒ_∑ges
; i++)

245 
∑ge_¨øy
[
i
] = i;

249 i‡(
øm_size
 > 
MMIO_START
) {

250 
i
 = 0 ; i < (
MEM_G
 >> 
XC_PAGE_SHIFT
); i++)

251 
∑ge_¨øy
[(
MMIO_START
 >> 
XC_PAGE_SHIFT
Ë+ 
i
] =

252 (
STORE_PAGE_START
 >> 
XC_PAGE_SHIFT
);

255 
phys_øm_ba£
 = 
	`xc_m≠_f‹eign_b©ch
(
xc_h™dÀ
, 
domid
,

256 
PROT_READ
|
PROT_WRITE
,

257 
∑ge_¨øy
, 
ƒ_∑ges
);

258 i‡(
phys_øm_ba£
 == 0) {

259 
	`Ârötf
(
logfûe
, "xc_m≠_f‹eign_b©chÑëu∫edÉº‹ %d\n", 
î∫o
);

260 
	`exô
(-1);

262 
	`‰ì
(
∑ge_¨øy
);

265 
	`timeoff£t_gë
();

268 
pc_machöe
.
	`öô
(
øm_size
, 
vga_øm_size
, 
boŸ_devi˚
, 
ds
, 
fd_fûíame
,

269 
¢≠shŸ
, 
kî√l_fûíame
, 
kî√l_cmdlöe
, 
öôrd_fûíame
,

270 
dúe˘_pci
);

271 
	}
}

273 
QEMUMachöe
 
	gxífv_machöe
 = {

276 
xí_öô_fv
,

	@xen_machine_pv.c

25 
	~"vl.h
"

26 
	~"xí_c⁄sﬁe.h
"

27 
	~"xífb.h
"

33 
	$xí_öô_pv
(
uöt64_t
 
øm_size
, 
vga_øm_size
, *
boŸ_devi˚
,

34 
Di•œySèã
 *
ds
, c⁄° **
fd_fûíame
,

35 
¢≠shŸ
,

36 c⁄° *
kî√l_fûíame
,

37 c⁄° *
kî√l_cmdlöe
,

38 c⁄° *
öôrd_fûíame
,

39 c⁄° *
dúe˘_pci
)

41 
xífb
 *xenfb;

42 
domid
;

45 i‡(
£rül_hds
[0]) {

46 i‡(
	`xíc⁄s_öô
(
domid
, 
£rül_hds
[0]) < 0) {

47 
	`Ârötf
(
°dîr
, "CouldÇot connectÅo domain console\n");

48 
	`exô
(1);

53 
xífb
 = 
	`xífb_√w
(
domid
, 
ds
);

54 i‡(
xífb
 =
NULL
) {

55 
	`Ârötf
(
°dîr
, "CouldÇot create framebuffer (%s)\n",

56 
	`°ªº‹
(
î∫o
));

57 
	`exô
(1);

59 
	}
}

61 
QEMUMachöe
 
	gxípv_machöe
 = {

64 
xí_öô_pv
,

	@xen_platform.c

25 
	~"vl.h
"

27 
	~<xígue°.h
>

29 
FILE
 *
logfûe
;

31 
	$∂©f‹m_i›‹t_m≠
(
PCIDevi˚
 *
pci_dev
, 
ªgi⁄_num
,

32 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

35 
	}
}

37 
uöt32_t
 
	$∂©f‹m_mmio_ªad
(*
›aque
, 
èrgë_phys_addr_t
 
addr
)

39 
w¨nögs
 = 0;

40 i‡(
w¨nögs
 < 5) {

41 
	`Ârötf
(
logfûe
, "Warning:áttemptedÑead fromÖhysicaláddress "

42 "0x%"
PRIx64
" i¿xíÖœtf‹m mmiÿ•a˚\n", (
uöt64_t
)
addr
);

43 
w¨nögs
++;

46 
	}
}

48 
	$∂©f‹m_mmio_wrôe
(*
›aque
, 
èrgë_phys_addr_t
 
addr
,

49 
uöt32_t
 
vÆ
)

51 
w¨nögs
 = 0;

52 i‡(
w¨nögs
 < 5) {

53 
	`Ârötf
(
logfûe
, "Warning:áttempted write of 0x%xÅoÖhysical "

54 "addªs†0x%"
PRIx64
" in xenÖlatform mmio space\n",

55 
vÆ
, (
uöt64_t
)
addr
);

56 
w¨nögs
++;

59 
	}
}

61 
CPURódMem‹yFunc
 *
	g∂©f‹m_mmio_ªad_funcs
[3] = {

62 
∂©f‹m_mmio_ªad
,

63 
∂©f‹m_mmio_ªad
,

64 
∂©f‹m_mmio_ªad
,

67 
CPUWrôeMem‹yFunc
 *
	g∂©f‹m_mmio_wrôe_funcs
[3] = {

68 
∂©f‹m_mmio_wrôe
,

69 
∂©f‹m_mmio_wrôe
,

70 
∂©f‹m_mmio_wrôe
,

73 
	$∂©f‹m_mmio_m≠
(
PCIDevi˚
 *
d
, 
ªgi⁄_num
,

74 
uöt32_t
 
addr
, uöt32_à
size
, 
ty≥
)

76 
mmio_io_addr
;

78 
mmio_io_addr
 = 
	`˝u_ªgi°î_io_mem‹y
(0, 
∂©f‹m_mmio_ªad_funcs
,

79 
∂©f‹m_mmio_wrôe_funcs
, 
NULL
);

81 
	`˝u_ªgi°î_physiˇl_mem‹y
(
addr
, 0x1000000, 
mmio_io_addr
);

82 
	}
}

84 
	spci_c⁄fig_hódî
 {

85 
uöt16_t
 
	mvíd‹_id
;

86 
uöt16_t
 
	mdevi˚_id
;

87 
uöt16_t
 
	mcomm™d
;

88 
uöt16_t
 
	m°©us
;

89 
uöt8_t
 
	mªvisi⁄
;

90 
uöt8_t
 
	m≠i
;

91 
uöt8_t
 
	msub˛ass
;

92 
uöt8_t
 
	m˛ass
;

93 
uöt8_t
 
	mˇche_löe_size
;

94 
uöt8_t
 
	mœãncy_timî
;

95 
uöt8_t
 
	mhódî_ty≥
;

96 
uöt8_t
 
	mbi°
;

97 
uöt32_t
 
	mba£_addªss_ªgs
[6];

98 
uöt32_t
 
	mª£rved1
;

99 
uöt16_t
 
	msubsy°em_víd‹_id
;

100 
uöt16_t
 
	msubsy°em_id
;

101 
uöt32_t
 
	mrom_addr
;

102 
uöt32_t
 
	mª£rved3
;

103 
uöt32_t
 
	mª£rved4
;

104 
uöt8_t
 
	möãºu±_löe
;

105 
uöt8_t
 
	möãºu±_pö
;

106 
uöt8_t
 
	mmö_g¡
;

107 
uöt8_t
 
	mmax_œt
;

110 
	$xí_pci_ßve
(
QEMUFûe
 *
f
, *
›aque
)

112 
PCIDevi˚
 *
d
 = 
›aque
;

114 
	`pci_devi˚_ßve
(
d
, 
f
);

115 
	}
}

117 
	$xí_pci_lﬂd
(
QEMUFûe
 *
f
, *
›aque
, 
vîsi⁄_id
)

119 
PCIDevi˚
 *
d
 = 
›aque
;

121 i‡(
vîsi⁄_id
 != 1)

122  -
EINVAL
;

124  
	`pci_devi˚_lﬂd
(
d
, 
f
);

125 
	}
}

127 
	$pci_xí_∂©f‹m_öô
(
PCIBus
 *
bus
)

129 
PCIDevi˚
 *
d
;

130 
pci_c⁄fig_hódî
 *
pch
;

132 
	`¥ötf
("Register xenÖlatform.\n");

133 
d
 = 
	`pci_ªgi°î_devi˚
(
bus
, "xí-∂©f‹m", (
PCIDevi˚
), -1, 
NULL
,

134 
NULL
);

135 
pch
 = (
pci_c⁄fig_hódî
 *)
d
->
c⁄fig
;

136 
pch
->
víd‹_id
 = 0x5853;

137 
pch
->
devi˚_id
 = 0x0001;

138 
pch
->
comm™d
 = 3;

139 
pch
->
ªvisi⁄
 = 1;

140 
pch
->
≠i
 = 0;

141 
pch
->
sub˛ass
 = 0x80;

142 
pch
->
˛ass
 = 0xff;

143 
pch
->
hódî_ty≥
 = 0;

144 
pch
->
öãºu±_pö
 = 1;

148 
pch
->
subsy°em_víd‹_id
 =Öch->
víd‹_id
;

149 
pch
->
subsy°em_id
 = 0x0001;

151 
	`pci_ªgi°î_io_ªgi⁄
(
d
, 0, 0x100, 
PCI_ADDRESS_SPACE_IO
,

152 
∂©f‹m_i›‹t_m≠
);

155 
	`pci_ªgi°î_io_ªgi⁄
(
d
, 1, 0x1000000, 
PCI_ADDRESS_SPACE_MEM_PREFETCH
,

156 
∂©f‹m_mmio_m≠
);

158 
	`ªgi°î_ßvevm
("∂©f‹m", 0, 1, 
xí_pci_ßve
, 
xí_pci_lﬂd
, 
d
);

159 
	`¥ötf
("DoneÑegisterÖlatform.\n");

160 
	}
}

	@xenfb.c

1 
	~<°d¨g.h
>

2 
	~<°dlib.h
>

3 
	~<sys/ty≥s.h
>

4 
	~<f˙é.h
>

5 
	~<uni°d.h
>

6 
	~<xí˘æ.h
>

7 
	~<xí/io/xíbus.h
>

8 
	~<xí/io/fbif.h
>

9 
	~<xí/io/kbdif.h
>

10 
	~<xí/io/¥Ÿocﬁs.h
>

11 
	~<°dboﬁ.h
>

12 
	~<xí/evít_ch™√l.h
>

13 
	~<sys/mm™.h
>

14 
	~<î∫o.h
>

15 
	~<°dio.h
>

16 
	~<°rög.h
>

17 
	~<time.h
>

18 
	~<xs.h
>

20 
	~"xífb.h
"

22 #i‚de‡
BTN_LEFT


23 
	#BTN_LEFT
 0x110

	)

28 
	gxífb
;

30 
	sxífb_devi˚
 {

31 c⁄° *
	mdevi˚ty≥
;

32 
	mnodíame
[64];

33 
	mŸhîíd
[64];

34 
	mŸhîíd_id
;

35 
xíbus_°©e
 
	m°©e
;

36 *
	m∑ge
;

37 
evtchn_p‹t_t
 
	mp‹t
;

38 
xífb
 *
	mxífb
;

41 
	sxífb
 {

42 
Di•œySèã
 *
	mds
;

43 
	mevt_xch
;

44 
	mxc
;

45 
xs_h™dÀ
 *
	mxsh
;

46 
xífb_devi˚
 
	mfb
, 
	mkbd
;

47 *
	mpixñs
;

48 
size_t
 
	mfb_Àn
;

49 
	mrow_°ride
;

50 
	mdïth
;

51 
	mwidth
;

52 
	mheight
;

53 
	mabs_poöãr_w™ãd
;

54 
	mbuâ⁄_°©e
;

55 
	m¥Ÿocﬁ
[64];

59 
xífb_waô_f‹_‰⁄ãnd
(
xífb_devi˚
 *
dev
, 
IOH™dÀr
 *
h™dÀr
);

60 
xífb_waô_f‹_backíd
(
xífb_devi˚
 *
dev
, 
IOH™dÀr
 *
h™dÀr
);

61 
xífb_backíd_¸óãd_kbd
(*
›aque
);

62 
xífb_backíd_¸óãd_fb
(*
›aque
);

63 
xífb_‰⁄ãnd_öôülized_kbd
(*
›aque
);

64 
xífb_‰⁄ãnd_öôülized_fb
(*
›aque
);

65 
xífb_‰⁄ãnd_c⁄√˘ed_kbd
(*
›aque
);

68 
xífb_‰⁄ãnd_c⁄√˘ed
(
xífb_devi˚
 *
dev
);

69 
xífb_‰⁄ãnd_öôülized
(
xífb_devi˚
 *
dev
);

70 
xífb_backíd_¸óãd
(
xífb_devi˚
 *
dev
);

73 
xífb_key_evít
(*
›aque
, 
keycode
);

74 
xífb_mou£_evít
(*
›aque
,

75 
dx
, 
dy
, 
dz
, 
buâ⁄_°©e
);

76 
xífb_gue°_c›y
(
xífb
 *xífb, 
x
, 
y
, 
w
, 
h
);

77 
xífb_upd©e
(*
›aque
);

78 
xífb_övÆid©e
(*
›aque
);

79 
xífb_s¸ìn_dump
(*
›aque
, c⁄° *
«me
);

80 
xífb_ªgi°î_c⁄sﬁe
(
xífb
 *xenfb);

87 c⁄° 
	g©kbd_£t2_keycode
[512] = {

109 c⁄° 
	g©kbd_unxœã_èbÀ
[128] = {

122 
	gsˇncode2löux
[512];

124 
	$xífb_xs_sˇnf1
(
xs_h™dÀ
 *
xsh
,

125 c⁄° *
dú
, c⁄° *
node
,

126 c⁄° *
fmt
, *
de°
)

128 
buf
[1024];

129 *
p
;

130 
ªt
;

132 i‡(
	`¢¥ötf
(
buf
, (buf), "%s/%s", 
dú
, 
node
) >= (buf)) {

133 
î∫o
 = 
ENOENT
;

136 
p
 = 
	`xs_ªad
(
xsh
, 
XBT_NULL
, 
buf
, 
NULL
);

137 i‡(!
p
) {

138 
î∫o
 = 
ENOENT
;

141 
ªt
 = 
	`ssˇnf
(
p
, 
fmt
, 
de°
);

142 
	`‰ì
(
p
);

143 i‡(
ªt
 != 1) {

144 
î∫o
 = 
EDOM
;

147  
ªt
;

148 
	}
}

150 
	$xífb_xs_¥ötf
(
xs_h™dÀ
 *
xsh
,

151 c⁄° *
dú
, c⁄° *
node
, *
fmt
, ...)

153 
va_li°
 
≠
;

154 
key
[1024];

155 
vÆ
[1024];

156 
n
;

158 i‡(
	`¢¥ötf
(
key
, (key), "%s/%s", 
dú
, 
node
) >= (key)) {

159 
î∫o
 = 
ENOENT
;

163 
	`va_°¨t
(
≠
, 
fmt
);

164 
n
 = 
	`v¢¥ötf
(
vÆ
, (vÆ), 
fmt
, 
≠
);

165 
	`va_íd
(
≠
);

166 i‡(
n
 >(
vÆ
)) {

167 
î∫o
 = 
ENOSPC
;

171 i‡(!
	`xs_wrôe
(
xsh
, 
XBT_NULL
, 
key
, 
vÆ
, 
n
))

174 
	}
}

176 
	$xífb_devi˚_öô
(
xífb_devi˚
 *
dev
,

177 c⁄° *
ty≥
,

178 
xífb
 *xenfb)

180 
dev
->
devi˚ty≥
 = 
ty≥
;

181 
dev
->
Ÿhîíd_id
 = -1;

182 
dev
->
p‹t
 = -1;

183 
dev
->
xífb
 = xenfb;

184 
	}
}

186 *
	$xífb_∑th_ö_dom
(
xs_h™dÀ
 *
xsh
,

187 *
buf
, 
size_t
 
size
,

188 
domid
, c⁄° *
fmt
, ...)

190 
va_li°
 
≠
;

191 *
domp
 = 
	`xs_gë_domaö_∑th
(
xsh
, 
domid
);

192 
n
;

194 i‡(
domp
 =
NULL
)

195  
NULL
;

197 
n
 = 
	`¢¥ötf
(
buf
, 
size
, "%s/", 
domp
);

198 
	`‰ì
(
domp
);

199 i‡(
n
 >
size
)

200  
NULL
;

202 
	`va_°¨t
(
≠
, 
fmt
);

203 
n
 +
	`v¢¥ötf
(
buf
 +Ç, 
size
 -Ç, 
fmt
, 
≠
);

204 
	`va_íd
(
≠
);

205 i‡(
n
 >
size
)

206  
NULL
;

208  
buf
;

209 
	}
}

211 
	$xífb_devi˚_£t_domaö
(
xífb_devi˚
 *
dev
, 
domid
)

213 
dev
->
Ÿhîíd_id
 = 
domid
;

215 i‡(!
	`xífb_∑th_ö_dom
(
dev
->
xífb
->
xsh
,

216 
dev
->
Ÿhîíd
, (dev->otherend),

217 
domid
, "devi˚/%s/0", 
dev
->
devi˚ty≥
)) {

218 
î∫o
 = 
ENOENT
;

221 i‡(!
	`xífb_∑th_ö_dom
(
dev
->
xífb
->
xsh
,

222 
dev
->
nodíame
, (dev->nodename),

223 0, "backíd/%s/%d/0", 
dev
->
devi˚ty≥
, 
domid
)) {

224 
î∫o
 = 
ENOENT
;

229 
	}
}

231 
xífb
 *
	$xífb_√w
(
domid
, 
Di•œySèã
 *
ds
)

233 
xífb
 *xífb = 
	`qemu_mÆloc
((xenfb));

234 
£ºno
;

235 
i
;

237 i‡(
xífb
 =
NULL
)

238  
NULL
;

241 
i
 = 0; i < 128; i++) {

242 
sˇncode2löux
[
i
] = 
©kbd_£t2_keycode
[
©kbd_unxœã_èbÀ
[i]];

243 
sˇncode2löux
[
i
 | 0x80] =

244 
©kbd_£t2_keycode
[
©kbd_unxœã_èbÀ
[
i
] | 0x80];

247 
	`mem£t
(
xífb
, 0, (*xenfb));

248 
xífb
->
evt_xch
 = xífb->
xc
 = -1;

249 
	`xífb_devi˚_öô
(&
xífb
->
fb
, "vfb", xenfb);

250 
	`xífb_devi˚_öô
(&
xífb
->
kbd
, "vkbd", xenfb);

252 
xífb
->
evt_xch
 = 
	`xc_evtchn_›í
();

253 i‡(
xífb
->
evt_xch
 == -1)

254 
Áû
;

256 
xífb
->
xc
 = 
	`xc_öãrÁ˚_›í
();

257 i‡(
xífb
->
xc
 == -1)

258 
Áû
;

260 
xífb
->
xsh
 = 
	`xs_d´m⁄_›í
();

261 i‡(!
xífb
->
xsh
)

262 
Áû
;

264 
xífb
->
ds
 = ds;

265 
	`xífb_devi˚_£t_domaö
(&
xífb
->
fb
, 
domid
);

266 
	`xífb_devi˚_£t_domaö
(&
xífb
->
kbd
, 
domid
);

268 
	`Ârötf
(
°dîr
, "FB: Waiting for KBD backend creation\n");

269 
	`xífb_waô_f‹_backíd
(&
xífb
->
kbd
, 
xífb_backíd_¸óãd_kbd
);

271  
xífb
;

273 
Áû
:

274 
£ºno
 = 
î∫o
;

275 
	`xífb_shutdown
(
xífb
);

276 
î∫o
 = 
£ºno
;

277  
NULL
;

278 
	}
}

281 
xíbus_°©e
 
	$xífb_ªad_°©e
(
xs_h™dÀ
 *
xsh
,

282 c⁄° *
dú
)

284 
ªt
, 
°©e
;

286 
ªt
 = 
	`xífb_xs_sˇnf1
(
xsh
, 
dú
, "°©e", "%d", &
°©e
);

287 i‡(
ªt
 < 0)

288  
XíbusSèãUnknown
;

290 i‡(()
°©e
 > 
XíbusSèãClo£d
)

291 
°©e
 = 
XíbusSèãUnknown
;

292  
°©e
;

293 
	}
}

295 
	$xífb_swôch_°©e
(
xífb_devi˚
 *
dev
,

296 
xíbus_°©e
 
°©e
)

298 
xs_h™dÀ
 *
xsh
 = 
dev
->
xífb
->xsh;

300 i‡(
	`xífb_xs_¥ötf
(
xsh
, 
dev
->
nodíame
, "°©e", "%d", 
°©e
) < 0)

302 
dev
->
°©e
 = state;

304 
	}
}

307 
	$xífb_hŸ∂ug
(
xífb_devi˚
 *
dev
)

309 i‡(
	`xífb_xs_¥ötf
(
dev
->
xífb
->
xsh
, dev->
nodíame
,

313 
	}
}

315 
	$xífb_c›y_m‚s
(
mode
, 
cou¡
, *
d°
, *
§c
)

317 
uöt32_t
 *
§c32
 = 
§c
;

318 
uöt64_t
 *
§c64
 = 
§c
;

319 
i
;

321 
i
 = 0; i < 
cou¡
; i++)

322 
d°
[
i
] = (
mode
 =32Ë? 
§c32
[i] : 
§c64
[i];

323 
	}
}

325 
	$xífb_m≠_fb
(
xífb
 *xífb, 
domid
)

327 
xífb_∑ge
 *
∑ge
 = 
xífb
->
fb
.page;

328 
n_fbm‚s
;

329 
n_fbdús
;

330 *
pgm‚s
 = 
NULL
;

331 *
fbm‚s
 = 
NULL
;

332 *
m≠
, *
pd
;

333 
mode
, 
ªt
 = -1;

336 
pd
 = 
∑ge
->pd;

337 
mode
 = () * 8;

339 i‡(0 =
	`°æí
(
xífb
->
¥Ÿocﬁ
)) {

349 
uöt32_t
 *
±r32
 = 
NULL
;

350 
uöt32_t
 *
±r64
 = 
NULL
;

351 #i‡
	`deföed
(
__i386__
)

352 
±r32
 = (*)
∑ge
->
pd
;

353 
±r64
 = ((*)
∑ge
->
pd
) + 4;

354 #ñi‡
	`deföed
(
__x86_64__
)

355 
±r32
 = ((*)
∑ge
->
pd
) - 4;

356 
±r64
 = (*)
∑ge
->
pd
;

358 i‡(
±r32
) {

359 i‡(0 =
±r32
[1]) {

360 
mode
 = 32;

361 
pd
 = 
±r32
;

363 
mode
 = 64;

364 
pd
 = 
±r64
;

367 #i‡
	`deföed
(
__x86_64__
)

368 } i‡(0 =
	`°rcmp
(
xífb
->
¥Ÿocﬁ
, 
XEN_IO_PROTO_ABI_X86_32
)) {

370 
mode
 = 32;

371 
pd
 = ((*)
∑ge
->pd) - 4;

372 #ñi‡
	`deföed
(
__i386__
)

373 } i‡(0 =
	`°rcmp
(
xífb
->
¥Ÿocﬁ
, 
XEN_IO_PROTO_ABI_X86_64
)) {

375 
mode
 = 64;

376 
pd
 = ((*)
∑ge
->pd) + 4;

380 
n_fbm‚s
 = (
xífb
->
fb_Àn
 + (
XC_PAGE_SIZE
 - 1)) / XC_PAGE_SIZE;

381 
n_fbdús
 = 
n_fbm‚s
 * 
mode
 / 8;

382 
n_fbdús
 = (n_fbdú†+ (
XC_PAGE_SIZE
 - 1)) / XC_PAGE_SIZE;

384 
pgm‚s
 = 
	`mÆloc
((Ë* 
n_fbdús
);

385 
fbm‚s
 = 
	`mÆloc
((Ë* 
n_fbm‚s
);

386 i‡(!
pgm‚s
 || !
fbm‚s
)

387 
out
;

389 
	`xífb_c›y_m‚s
(
mode
, 
n_fbdús
, 
pgm‚s
, 
pd
);

390 
m≠
 = 
	`xc_m≠_f‹eign_∑ges
(
xífb
->
xc
, 
domid
,

391 
PROT_READ
, 
pgm‚s
, 
n_fbdús
);

392 i‡(
m≠
 =
NULL
)

393 
out
;

394 
	`xífb_c›y_m‚s
(
mode
, 
n_fbm‚s
, 
fbm‚s
, 
m≠
);

395 
	`munm≠
(
m≠
, 
n_fbdús
 * 
XC_PAGE_SIZE
);

397 
xífb
->
pixñs
 = 
	`xc_m≠_f‹eign_∑ges
(xífb->
xc
, 
domid
,

398 
PROT_READ
 | 
PROT_WRITE
, 
fbm‚s
, 
n_fbm‚s
);

399 i‡(
xífb
->
pixñs
 =
NULL
)

400 
out
;

402 
ªt
 = 0;

404 
out
:

405 i‡(
pgm‚s
)

406 
	`‰ì
(
pgm‚s
);

407 i‡(
fbm‚s
)

408 
	`‰ì
(
fbm‚s
);

409  
ªt
;

410 
	}
}

412 
	$xífb_böd
(
xífb_devi˚
 *
dev
)

414 
xífb
 *xífb = 
dev
->xenfb;

415 
m‚
;

416 
evtchn_p‹t_t
 
evtchn
;

418 i‡(
	`xífb_xs_sˇnf1
(
xífb
->
xsh
, 
dev
->
Ÿhîíd
, "page-ref", "%lu",

419 &
m‚
) < 0)

421 i‡(
	`xífb_xs_sˇnf1
(
xífb
->
xsh
, 
dev
->
Ÿhîíd
, "event-channel", "%u",

422 &
evtchn
) < 0)

425 
dev
->
p‹t
 = 
	`xc_evtchn_böd_öãrdomaö
(
xífb
->
evt_xch
,

426 
dev
->
Ÿhîíd_id
, 
evtchn
);

427 i‡(
dev
->
p‹t
 == -1)

430 
dev
->
∑ge
 = 
	`xc_m≠_f‹eign_ønge
(
xífb
->
xc
, dev->
Ÿhîíd_id
,

431 
XC_PAGE_SIZE
, 
PROT_READ
 | 
PROT_WRITE
, 
m‚
);

432 i‡(
dev
->
∑ge
 =
NULL
)

436 
	}
}

438 
	$xífb_unböd
(
xífb_devi˚
 *
dev
)

440 i‡(
dev
->
∑ge
) {

441 
	`munm≠
(
dev
->
∑ge
, 
XC_PAGE_SIZE
);

442 
dev
->
∑ge
 = 
NULL
;

444 i‡(
dev
->
p‹t
 >= 0) {

445 
	`xc_evtchn_unböd
(
dev
->
xífb
->
evt_xch
, dev->
p‹t
);

446 
dev
->
p‹t
 = -1;

448 
	}
}

451 
	$xífb_dëach_dom
(
xífb
 *xenfb)

453 
	`xífb_unböd
(&
xífb
->
fb
);

454 
	`xífb_unböd
(&
xífb
->
kbd
);

455 i‡(
xífb
->
pixñs
) {

456 
	`munm≠
(
xífb
->
pixñs
, xífb->
fb_Àn
);

457 
xífb
->
pixñs
 = 
NULL
;

459 
	}
}

463 
	$xífb_shutdown
(
xífb
 *xenfb)

465 
	`Ârötf
(
°dîr
, "FB: Shutting down backend\n");

466 
	`xs_rm
(
xífb
->
xsh
, 
XBT_NULL
, xífb->
fb
.
nodíame
);

467 
	`xs_rm
(
xífb
->
xsh
, 
XBT_NULL
, xífb->
kbd
.
nodíame
);

469 
	`xífb_dëach_dom
(
xífb
);

470 i‡(
xífb
->
xc
 >= 0)

471 
	`xc_öãrÁ˚_˛o£
(
xífb
->
xc
);

472 i‡(
xífb
->
evt_xch
 >= 0)

473 
	`xc_evtchn_˛o£
(
xífb
->
evt_xch
);

474 i‡(
xífb
->
xsh
)

475 
	`xs_d´m⁄_˛o£
(
xífb
->
xsh
);

476 
	`‰ì
(
xífb
);

477 
	}
}

480 
	$xífb_⁄_fb_evít
(
xífb
 *xenfb)

482 
uöt32_t
 
¥od
, 
c⁄s
;

483 
xífb_∑ge
 *
∑ge
 = 
xífb
->
fb
.page;

485 
¥od
 = 
∑ge
->
out_¥od
;

486 i‡(
¥od
 =
∑ge
->
out_c⁄s
)

488 
	`rmb
();

489 
c⁄s
 = 
∑ge
->
out_c⁄s
; c⁄†!
¥od
; cons++) {

490 
xífb_out_evít
 *
evít
 = &
	`XENFB_OUT_RING_REF
(
∑ge
, 
c⁄s
);

491 
x
, 
y
, 
w
, 
h
;

493 
evít
->
ty≥
) {

494 
XENFB_TYPE_UPDATE
:

495 
x
 = 
	`MAX
(
evít
->
upd©e
.x, 0);

496 
y
 = 
	`MAX
(
evít
->
upd©e
.y, 0);

497 
w
 = 
	`MIN
(
evít
->
upd©e
.
width
, 
xífb
->width - 
x
);

498 
h
 = 
	`MIN
(
evít
->
upd©e
.
height
, 
xífb
->heighà- 
y
);

499 i‡(
w
 < 0 || 
h
 < 0) {

500 
	`Ârötf
(
°dîr
, "%s bogus update ignored\n",

501 
xífb
->
fb
.
nodíame
);

504 i‡(
x
 !
evít
->
upd©e
.x || 
y
 !=Évent->update.y

505 || 
w
 !
evít
->
upd©e
.
width


506 || 
h
 !
evít
->
upd©e
.
height
) {

507 
	`Ârötf
(
°dîr
, "%s bogus update clipped\n",

508 
xífb
->
fb
.
nodíame
);

511 
	`xífb_gue°_c›y
(
xífb
, 
x
, 
y
, 
w
, 
h
);

515 
	`mb
();

516 
∑ge
->
out_c⁄s
 = 
c⁄s
;

517 
	`xc_evtchn_nŸify
(
xífb
->
evt_xch
, xífb->
fb
.
p‹t
);

518 
	}
}

520 
	$xífb_⁄_kbd_evít
(
xífb
 *xenfb)

522 
xíkbd_∑ge
 *
∑ge
 = 
xífb
->
kbd
.page;

525 i‡(
∑ge
->
out_¥od
 =∑ge->
out_c⁄s
)

527 
∑ge
->
out_c⁄s
 =Öage->
out_¥od
;

528 
	`xc_evtchn_nŸify
(
xífb
->
evt_xch
, xífb->
kbd
.
p‹t
);

529 
	}
}

531 
	$xífb_⁄_°©e_ch™ge
(
xífb_devi˚
 *
dev
)

533 
xíbus_°©e
 
°©e
;

535 
°©e
 = 
	`xífb_ªad_°©e
(
dev
->
xífb
->
xsh
, dev->
Ÿhîíd
);

537 
°©e
) {

538 
XíbusSèãUnknown
:

543 
XíbusSèãInôülisög
:

544 
XíbusSèãInôWaô
:

545 
XíbusSèãInôüli£d
:

546 
XíbusSèãC⁄√˘ed
:

548 
XíbusSèãClosög
:

549 
	`xífb_unböd
(
dev
);

550 
	`xífb_swôch_°©e
(
dev
, 
°©e
);

552 
XíbusSèãClo£d
:

553 
	`xífb_swôch_°©e
(
dev
, 
°©e
);

556 
	}
}

559 
	$xífb_kbd_evít
(
xífb
 *xenfb,

560 
xíkbd_ö_evít
 *
evít
)

562 
uöt32_t
 
¥od
;

563 
xíkbd_∑ge
 *
∑ge
 = 
xífb
->
kbd
.page;

565 i‡(
xífb
->
kbd
.
°©e
 !
XíbusSèãC⁄√˘ed
)

568 
¥od
 = 
∑ge
->
ö_¥od
;

569 i‡(
¥od
 - 
∑ge
->
ö_c⁄s
 =
XENKBD_IN_RING_LEN
) {

570 
î∫o
 = 
EAGAIN
;

574 
	`mb
();

575 
	`XENKBD_IN_RING_REF
(
∑ge
, 
¥od
Ë*
evít
;

576 
	`wmb
();

577 
∑ge
->
ö_¥od
 = 
¥od
 + 1;

578  
	`xc_evtchn_nŸify
(
xífb
->
evt_xch
, xífb->
kbd
.
p‹t
);

579 
	}
}

582 
	$xífb_£nd_key
(
xífb
 *xífb, 
boﬁ
 
down
, 
keycode
)

584 
xíkbd_ö_evít
 
evít
;

586 
	`mem£t
(&
evít
, 0, 
XENKBD_IN_EVENT_SIZE
);

587 
evít
.
ty≥
 = 
XENKBD_TYPE_KEY
;

588 
evít
.
key
.
¥es£d
 = 
down
 ? 1 : 0;

589 
evít
.
key
.
keycode
 = keycode;

591  
	`xífb_kbd_evít
(
xífb
, &
evít
);

592 
	}
}

595 
	$xífb_£nd_mŸi⁄
(
xífb
 *xífb, 
ªl_x
, 
ªl_y
, 
ªl_z
)

597 
xíkbd_ö_evít
 
evít
;

599 
	`mem£t
(&
evít
, 0, 
XENKBD_IN_EVENT_SIZE
);

600 
evít
.
ty≥
 = 
XENKBD_TYPE_MOTION
;

601 
evít
.
mŸi⁄
.
ªl_x
 =Ñel_x;

602 
evít
.
mŸi⁄
.
ªl_y
 =Ñel_y;

603 
evít
.
mŸi⁄
.
ªl_z
 =Ñel_z;

605  
	`xífb_kbd_evít
(
xífb
, &
evít
);

606 
	}
}

609 
	$xífb_£nd_posôi⁄
(
xífb
 *xífb, 
abs_x
, 
abs_y
, 
abs_z
)

611 
xíkbd_ö_evít
 
evít
;

613 
	`mem£t
(&
evít
, 0, 
XENKBD_IN_EVENT_SIZE
);

614 
evít
.
ty≥
 = 
XENKBD_TYPE_POS
;

615 
evít
.
pos
.
abs_x
 =ábs_x;

616 
evít
.
pos
.
abs_y
 =ábs_y;

617 
evít
.
pos
.
abs_z
 =ábs_z;

619  
	`xífb_kbd_evít
(
xífb
, &
evít
);

620 
	}
}

623 
	$xífb_di•©ch_ch™√l
(*
›aque
)

625 
xífb
 *xífb = (xífb *)
›aque
;

626 
evtchn_p‹t_t
 
p‹t
;

627 
p‹t
 = 
	`xc_evtchn_≥ndög
(
xífb
->
evt_xch
);

628 i‡(
p‹t
 == -1) {

629 
	`xífb_shutdown
(
xífb
);

630 
	`exô
(1);

633 i‡(
p‹t
 =
xífb
->
fb
.port)

634 
	`xífb_⁄_fb_evít
(
xífb
);

635 i‡(
p‹t
 =
xífb
->
kbd
.port)

636 
	`xífb_⁄_kbd_evít
(
xífb
);

638 i‡(
	`xc_evtchn_unmask
(
xífb
->
evt_xch
, 
p‹t
) == -1) {

639 
	`xífb_shutdown
(
xífb
);

640 
	`exô
(1);

642 
	}
}

645 
	$xífb_di•©ch_°‹e
(*
›aque
)

647 
xífb
 *xífb = (xífb *)
›aque
;

648 
dummy
;

649 **
vec
;

650 
r
;

652 
vec
 = 
	`xs_ªad_w©ch
(
xífb
->
xsh
, &
dummy
);

653 
	`‰ì
(
vec
);

654 
r
 = 
	`xífb_⁄_°©e_ch™ge
(&
xífb
->
fb
);

655 i‡(
r
 == 0)

656 
r
 = 
	`xífb_⁄_°©e_ch™ge
(&
xífb
->
kbd
);

657 i‡(
r
 < 0) {

658 
	`xífb_shutdown
(
xífb
);

659 
	`exô
(1);

661 
	}
}

672 
	$xífb_ªad_‰⁄ãnd_fb_c⁄fig
(
xífb
 *xenfb) {

673 
xífb_∑ge
 *
fb_∑ge
;

674 
vÆ
;

676 i‡(
	`xífb_xs_sˇnf1
(
xífb
->
xsh
, xífb->
fb
.
Ÿhîíd
, "feature-update",

677 "%d", &
vÆ
) < 0)

678 
vÆ
 = 0;

679 i‡(!
vÆ
) {

680 
	`Ârötf
(
°dîr
, "feature-updateÇot supported\n");

681 
î∫o
 = 
ENOTSUP
;

684 i‡(
	`xífb_xs_sˇnf1
(
xífb
->
xsh
, xífb->
fb
.
Ÿhîíd
, "protocol", "%63s",

685 
xífb
->
¥Ÿocﬁ
) < 0)

686 
xífb
->
¥Ÿocﬁ
[0] = '\0';

687 
	`xífb_xs_¥ötf
(
xífb
->
xsh
, xífb->
fb
.
nodíame
, "request-update", "1");

690 
fb_∑ge
 = 
xífb
->
fb
.
∑ge
;

691 
xífb
->
dïth
 = 
fb_∑ge
->depth;

692 
xífb
->
width
 = 
fb_∑ge
->width;

693 
xífb
->
height
 = 
fb_∑ge
->height;

695 
xífb
->
fb_Àn
 = 
fb_∑ge
->
mem_Àngth
;

696 
xífb
->
row_°ride
 = 
fb_∑ge
->
löe_Àngth
;

697 
	`Ârötf
(
°dîr
, "Framebuffer depth %d width %d height %dÜine %d\n",

698 
fb_∑ge
->
dïth
, fb_∑ge->
width
, fb_∑ge->
height
, fb_∑ge->
löe_Àngth
);

699 i‡(
	`xífb_m≠_fb
(
xífb
, xífb->
fb
.
Ÿhîíd_id
) < 0)

702 i‡(
	`xífb_swôch_°©e
(&
xífb
->
fb
, 
XíbusSèãC⁄√˘ed
))

704 i‡(
	`xífb_swôch_°©e
(&
xífb
->
kbd
, 
XíbusSèãC⁄√˘ed
))

708 
	}
}

711 
	$xífb_ªad_‰⁄ãnd_kbd_c⁄fig
(
xífb
 *xenfb)

713 
vÆ
;

715 i‡(
	`xífb_xs_sˇnf1
(
xífb
->
xsh
, xífb->
kbd
.
Ÿhîíd
, "request-abs-pointer",

716 "%d", &
vÆ
) < 0)

717 
vÆ
 = 0;

718 
xífb
->
abs_poöãr_w™ãd
 = 
vÆ
;

721 
	}
}

732 
	$xífb_waô_f‹_‰⁄ãnd
(
xífb_devi˚
 *
dev
, 
IOH™dÀr
 *
h™dÀr
)

734 
	`Ârötf
(
°dîr
, "Doög fr⁄ãnd w©ch o¿%s\n", 
dev
->
Ÿhîíd
);

735 i‡(!
	`xs_w©ch
(
dev
->
xífb
->
xsh
, dev->
Ÿhîíd
, "")) {

736 
	`Ârötf
(
°dîr
, "Watch for dev failed\n");

740 i‡(
	`qemu_£t_fd_h™dÀr2
(
	`xs_fûío
(
dev
->
xífb
->
xsh
), 
NULL
, 
h™dÀr
, NULL, dev) < 0)

744 
	}
}

748 
	$xífb_waô_f‹_backíd
(
xífb_devi˚
 *
dev
, 
IOH™dÀr
 *
h™dÀr
)

750 
	`Ârötf
(
°dîr
, "Doög backíd w©ch o¿%s\n", 
dev
->
nodíame
);

751 i‡(!
	`xs_w©ch
(
dev
->
xífb
->
xsh
, dev->
nodíame
, "")) {

752 
	`Ârötf
(
°dîr
, "Watch for dev failed\n");

756 i‡(
	`qemu_£t_fd_h™dÀr2
(
	`xs_fûío
(
dev
->
xífb
->
xsh
), 
NULL
, 
h™dÀr
, NULL, dev) < 0)

760 
	}
}

764 
	$xífb_backíd_¸óãd_kbd
(*
›aque
)

766 
xífb_devi˚
 *
dev
 = (xífb_devi˚ *)
›aque
;

767 
ªt
 = 
	`xífb_backíd_¸óãd
(
dev
);

768 i‡(
ªt
 < 0) {

769 
	`xífb_shutdown
(
dev
->
xífb
);

770 
	`exô
(1);

772 i‡(
ªt
)

775 i‡(
	`xífb_xs_¥ötf
(
dev
->
xífb
->
xsh
, dev->
nodíame
, "feature-abs-pointer", "1")) {

776 
	`xífb_shutdown
(
dev
->
xífb
);

777 
	`exô
(1);

780 
	`Ârötf
(
°dîr
, "FB: Waiting for FB backend creation\n");

781 
	`xífb_waô_f‹_backíd
(&
dev
->
xífb
->
fb
, 
xífb_backíd_¸óãd_fb
);

782 
	}
}

786 
	$xífb_backíd_¸óãd_fb
(*
›aque
)

788 
xífb_devi˚
 *
dev
 = (xífb_devi˚ *)
›aque
;

789 
ªt
 = 
	`xífb_backíd_¸óãd
(
dev
);

790 i‡(
ªt
 < 0) {

791 
	`xífb_shutdown
(
dev
->
xífb
);

792 
	`exô
(1);

794 i‡(
ªt
)

797 
	`Ârötf
(
°dîr
, "FB: Waiting for KBD frontend initialization\n");

798 
	`xífb_waô_f‹_‰⁄ãnd
(&
dev
->
xífb
->
kbd
, 
xífb_‰⁄ãnd_öôülized_kbd
);

799 
	}
}

803 
	$xífb_‰⁄ãnd_öôülized_kbd
(*
›aque
)

805 
xífb_devi˚
 *
dev
 = (xífb_devi˚ *)
›aque
;

806 
ªt
 = 
	`xífb_‰⁄ãnd_öôülized
(
dev
);

807 i‡(
ªt
 < 0) {

808 
	`xífb_shutdown
(
dev
->
xífb
);

809 
	`exô
(1);

811 i‡(
ªt
)

815 
	`Ârötf
(
°dîr
, "FB: Waiting for FB frontend initialization\n");

816 
	`xífb_waô_f‹_‰⁄ãnd
(&
dev
->
xífb
->
fb
, 
xífb_‰⁄ãnd_öôülized_fb
);

817 
	}
}

821 
	$xífb_‰⁄ãnd_öôülized_fb
(*
›aque
)

823 
xífb_devi˚
 *
dev
 = (xífb_devi˚ *)
›aque
;

824 
ªt
 = 
	`xífb_‰⁄ãnd_öôülized
(
dev
);

825 i‡(
ªt
 < 0) {

826 
	`xífb_shutdown
(
dev
->
xífb
);

827 
	`exô
(1);

829 i‡(
ªt
)

833 i‡(
	`xífb_ªad_‰⁄ãnd_fb_c⁄fig
(
dev
->
xífb
)) {

834 
	`xífb_shutdown
(
dev
->
xífb
);

835 
	`exô
(1);

838 
	`Ârötf
(
°dîr
, "FB: Waiting for KBD frontend connection\n");

839 
	`xífb_waô_f‹_‰⁄ãnd
(&
dev
->
xífb
->
kbd
, 
xífb_‰⁄ãnd_c⁄√˘ed_kbd
);

840 
	}
}

844 
	$xífb_‰⁄ãnd_c⁄√˘ed_kbd
(*
›aque
)

846 
xífb_devi˚
 *
dev
 = (xífb_devi˚ *)
›aque
;

847 
ªt
 = 
	`xífb_‰⁄ãnd_c⁄√˘ed
(
dev
);

848 i‡(
ªt
 < 0) {

849 
	`xífb_shutdown
(
dev
->
xífb
);

850 
	`exô
(1);

852 i‡(
ªt
)

855 i‡(
	`xífb_ªad_‰⁄ãnd_kbd_c⁄fig
(
dev
->
xífb
) < 0) {

856 
	`xífb_shutdown
(
dev
->
xífb
);

857 
	`exô
(1);

860 
	`xífb_ªgi°î_c⁄sﬁe
(
dev
->
xífb
);

861 
	}
}

871 
	$xífb_‰⁄ãnd_c⁄√˘ed
(
xífb_devi˚
 *
dev
)

873 
°©e
;

874 
dummy
;

875 **
vec
;

876 
vec
 = 
	`xs_ªad_w©ch
(
dev
->
xífb
->
xsh
, &
dummy
);

877 i‡(!
vec
)

879 
	`‰ì
(
vec
);

881 
°©e
 = 
	`xífb_ªad_°©e
(
dev
->
xífb
->
xsh
, dev->
Ÿhîíd
);

882 i‡(!((1 <<
°©e
Ë& ((1 << 
XíbusSèãUnknown
) |

883 (1 << 
XíbusSèãC⁄√˘ed
)))) {

884 
	`Ârötf
(
°dîr
, "FB: Carry on waiting\n");

891 
°©e
) {

892 
XíbusSèãC⁄√˘ed
:

898 
	}
}

902 
	$xífb_‰⁄ãnd_öôülized
(
xífb_devi˚
 *
dev
)

904 
°©e
;

905 
dummy
;

906 **
vec
;

907 
vec
 = 
	`xs_ªad_w©ch
(
dev
->
xífb
->
xsh
, &
dummy
);

908 i‡(!
vec
)

910 
	`‰ì
(
vec
);

912 
°©e
 = 
	`xífb_ªad_°©e
(
dev
->
xífb
->
xsh
, dev->
Ÿhîíd
);

914 i‡(!((1 << 
°©e
Ë& ((1 << 
XíbusSèãUnknown
)

915 | (1 << 
XíbusSèãInôüli£d
)

917 | (1 << 
XíbusSèãC⁄√˘ed
)

920 
	`Ârötf
(
°dîr
, "FB: Carry on waiting\n");

924 
	`xs_unw©ch
(
dev
->
xífb
->
xsh
, dev->
Ÿhîíd
, "");

926 
°©e
) {

928 
XíbusSèãC⁄√˘ed
:

929 
	`¥ötf
("Fudgög sèãÅÿ%d\n", 
XíbusSèãInôüli£d
);

931 
XíbusSèãInôüli£d
:

937 i‡(
	`xífb_böd
(
dev
) < 0)

941 
	}
}

944 
	$xífb_backíd_¸óãd
(
xífb_devi˚
 *
dev
)

946 
°©e
;

947 
dummy
;

948 **
vec
;

949 
vec
 = 
	`xs_ªad_w©ch
(
dev
->
xífb
->
xsh
, &
dummy
);

950 i‡(!
vec
)

952 
	`‰ì
(
vec
);

954 
°©e
 = 
	`xífb_ªad_°©e
(
dev
->
xífb
->
xsh
, dev->
nodíame
);

956 i‡(!((1 <<
°©e
Ë& ((1 << 
XíbusSèãUnknown
)

957 | (1 << 
XíbusSèãInôülisög
)

958 | (1 << 
XíbusSèãClo£d
)

960 | (1 << 
XíbusSèãInôWaô
)

961 | (1 << 
XíbusSèãC⁄√˘ed
)

962 | (1 << 
XíbusSèãClosög
)

965 
	`Ârötf
(
°dîr
, "FB: Carry on waiting\n");

969 
	`xs_unw©ch
(
dev
->
xífb
->
xsh
, dev->
nodíame
, "");

971 
°©e
) {

973 
XíbusSèãInôWaô
:

974 
XíbusSèãC⁄√˘ed
:

975 
	`¥ötf
("Fudgög sèãÅÿ%d\n", 
XíbusSèãInôülisög
);

977 
XíbusSèãInôülisög
:

978 
XíbusSèãClosög
:

979 
XíbusSèãClo£d
:

982 
	`Ârötf
(
°dîr
, "Wr⁄g sèã %d\n", 
°©e
);

985 
	`xífb_swôch_°©e
(
dev
, 
XíbusSèãInôWaô
);

986 i‡(
	`xífb_hŸ∂ug
(
dev
) < 0)

990 
	}
}

1013 
	$xífb_key_evít
(*
›aque
, 
sˇncode
)

1015 
exãnded
 = 0;

1016 
down
 = 1;

1017 i‡(
sˇncode
 == 0xe0) {

1018 
exãnded
 = 1;

1020 } i‡(
sˇncode
 & 0x80) {

1021 
sˇncode
 &= 0x7f;

1022 
down
 = 0;

1024 i‡(
exãnded
) {

1025 
sˇncode
 |= 0x80;

1026 
exãnded
 = 0;

1028 
	`xífb_£nd_key
(
›aque
, 
down
, 
sˇncode2löux
[
sˇncode
]);

1029 
	}
}

1040 
	$xífb_mou£_evít
(*
›aque
,

1041 
dx
, 
dy
, 
dz
, 
buâ⁄_°©e
)

1043 
i
;

1044 
xífb
 *xífb = 
›aque
;

1045 i‡(
xífb
->
abs_poöãr_w™ãd
)

1046 
	`xífb_£nd_posôi⁄
(
xífb
,

1047 
dx
 * (
xífb
->
ds
->
width
 - 1) / 0x7fff,

1048 
dy
 * (
xífb
->
ds
->
height
 - 1) / 0x7fff,

1049 
dz
);

1051 
	`xífb_£nd_mŸi⁄
(
xífb
, 
dx
, 
dy
, 
dz
);

1053 
i
 = 0 ; i < 8 ; i++) {

1054 
œ°Down
 = 
xífb
->
buâ⁄_°©e
 & (1 << 
i
);

1055 
down
 = 
buâ⁄_°©e
 & (1 << 
i
);

1056 i‡(
down
 =
œ°Down
)

1059 i‡(
	`xífb_£nd_key
(
xífb
, 
down
, 
BTN_LEFT
+
i
) < 0)

1062 
xífb
->
buâ⁄_°©e
 = button_state;

1063 
	}
}

1066 
	#BLT
(
SRC_T
,
DST_T
,
RLS
,
GLS
,
BLS
,
RRS
,
GRS
,
BRS
,
RM
,
GM
,
BM
) \

1067 
löe
 = 
y
 ;Üöê< 
h
 ;Üine++) { \

1068 
SRC_T
 *
§c
 = (SRC_T *)(
xífb
->
pixñs
 \

1069 + (
löe
 * 
xífb
->
row_°ride
) \

1070 + (
x
 * 
xífb
->
dïth
 / 8)); \

1071 
DST_T
 *
d°
 = (DST_T *)(
xífb
->
ds
->
d©a
 \

1072 + (
löe
 * 
xífb
->
ds
->
löesize
) \

1073 + (
x
 * 
xífb
->
ds
->
dïth
 / 8)); \

1074 
cﬁ
; \

1075 
cﬁ
 = 
x
 ; cﬁ < 
w
 ; col++) { \

1076 *
d°
 = (((*
§c
 >> 
RRS
Ë& 
RM
Ë<< 
RLS
) | \

1077 (((*
§c
 >> 
GRS
Ë& 
GM
Ë<< 
GLS
) | \

1078 (((*
§c
 >> 
GRS
Ë& 
BM
Ë<< 
BLS
); \

1079 
§c
++; \

1080 
d°
++; \

1082 }

	)

1090 
	$xífb_gue°_c›y
(
xífb
 *xífb, 
x
, 
y
, 
w
, 
h
)

1092 
löe
;

1094 i‡(
xífb
->
dïth
 =xífb->
ds
->depth) {

1095 
löe
 = 
y
 ;Üöê< (y+
h
) ;Üine++) {

1096 
	`mem˝y
(
xífb
->
ds
->
d©a
 + (
löe
 * xífb->ds->
löesize
Ë+ (
x
 * xífb->ds->
dïth
 / 8),

1097 
xífb
->
pixñs
 + (
löe
 * xífb->
row_°ride
Ë+ (
x
 * xífb->
dïth
 / 8),

1098 
w
 * 
xífb
->
dïth
 / 8);

1101 i‡(
xífb
->
dïth
 == 8) {

1103 i‡(
xífb
->
ds
->
dïth
 == 16) {

1104 
	`BLT
(
uöt8_t
, 
uöt16_t
, 5, 2, 0, 11, 5, 0, 7, 7, 3);

1105 } i‡(
xífb
->
ds
->
dïth
 == 32) {

1106 
	`BLT
(
uöt8_t
, 
uöt32_t
, 5, 2, 0, 16, 8, 0, 7, 7, 3);

1108 } i‡(
xífb
->
dïth
 == 16) {

1110 i‡(
xífb
->
ds
->
dïth
 == 8) {

1111 
	`BLT
(
uöt16_t
, 
uöt8_t
, 11, 5, 0, 5, 2, 0, 31, 63, 31);

1112 } i‡(
xífb
->
ds
->
dïth
 == 32) {

1113 
	`BLT
(
uöt16_t
, 
uöt32_t
, 11, 5, 0, 16, 8, 0, 31, 63, 31);

1115 } i‡(
xífb
->
dïth
 == 32) {

1117 i‡(
xífb
->
ds
->
dïth
 == 8) {

1118 
	`BLT
(
uöt32_t
, 
uöt8_t
, 16, 8, 0, 5, 2, 0, 255, 255, 255);

1119 } i‡(
xífb
->
ds
->
dïth
 == 16) {

1120 
	`BLT
(
uöt32_t
, 
uöt16_t
, 16, 8, 0, 11, 5, 0, 255, 255, 255);

1124 
	`dpy_upd©e
(
xífb
->
ds
, 
x
, 
y
, 
w
, 
h
);

1125 
	}
}

1129 
	$xífb_upd©e
(*
›aque
)

1131 
xífb
 *xífb = 
›aque
;

1132 
	`xífb_gue°_c›y
(
xífb
, 0, 0, xífb->
width
, xífb->
height
);

1133 
	}
}

1136 
	$xífb_övÆid©e
(*
›aque
)

1138 
xífb
 *xífb = 
›aque
;

1139 
	`xífb_gue°_c›y
(
xífb
, 0, 0, xífb->
width
, xífb->
height
);

1140 
	}
}

1143 
	$xífb_s¸ìn_dump
(*
›aque
, c⁄° *
«me
Ë{ 
	}
}

1148 
	$xífb_ªgi°î_c⁄sﬁe
(
xífb
 *xenfb) {

1150 
	`qemu_add_kbd_evít_h™dÀr
(
xífb_key_evít
, 
xífb
);

1151 
	`qemu_add_mou£_evít_h™dÀr
(
xífb_mou£_evít
, 
xífb
,

1152 
xífb
->
abs_poöãr_w™ãd
,

1156 
	`gøphic_c⁄sﬁe_öô
(
xífb
->
ds
,

1157 
xífb_upd©e
,

1158 
xífb_övÆid©e
,

1159 
xífb_s¸ìn_dump
,

1160 
xífb
);

1161 
	`dpy_ªsize
(
xífb
->
ds
, xífb->
width
, xífb->
height
);

1163 i‡(
	`qemu_£t_fd_h™dÀr2
(
	`xc_evtchn_fd
(
xífb
->
evt_xch
), 
NULL
, 
xífb_di•©ch_ch™√l
, NULL, xenfb) < 0)

1165 i‡(
	`qemu_£t_fd_h™dÀr2
(
	`xs_fûío
(
xífb
->
xsh
), 
NULL
, 
xífb_di•©ch_°‹e
, NULL, xenfb) < 0)

1168 
	`Ârötf
(
°dîr
, "Xen FramebufferÑegistered\n");

1170 
	}
}

	@xenfb.h

1 #i‚de‡
_XENFB_H_


2 
	#_XENFB_H_


	)

4 
	~"vl.h
"

5 
	~<°dboﬁ.h
>

6 
	~<sys/ty≥s.h
>

8 
	gxífb
;

10 
xífb
 *
xífb_√w
(
domid
, 
Di•œySèã
 *
ds
);

11 
xífb_shutdown
(
xífb
 *xenfb);

	@/usr/include/assert.h

24 #ifdef 
_ASSERT_H


26 #unde‡
_ASSERT_H


27 #unde‡
as£π


28 #unde‡
__ASSERT_VOID_CAST


30 #ifdef 
__USE_GNU


31 #unde‡
as£π_≥º‹


36 
	#_ASSERT_H
 1

	)

37 
	~<„©uªs.h
>

39 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,95)

40 
	#__ASSERT_VOID_CAST
 
°©ic_ˇ°
<>

	)

42 
	#__ASSERT_VOID_CAST
 ()

	)

50 #ifdef 
NDEBUG


52 
	#as£π
(
ex¥
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

60 #ifdef 
__USE_GNU


61 
	#as£π_≥º‹
(
î∫um
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

66 
__BEGIN_DECLS


69 
	$__as£π_Áû
 (
__c⁄°
 *
__as£πi⁄
, __c⁄° *
__fûe
,

70 
__löe
, 
__c⁄°
 *
__fun˘i⁄
)

71 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

74 
	$__as£π_≥º‹_Áû
 (
__î∫um
, 
__c⁄°
 *
__fûe
,

75 
__löe
,

76 
__c⁄°
 *
__fun˘i⁄
)

77 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

82 
	$__as£π
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
, 
__löe
)

83 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

86 
__END_DECLS


88 
	#as£π
(
ex¥
) \

89 ((
ex¥
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£π_Áû
 (
	`__STRING
(
ex¥
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£π_≥º‹
(
î∫um
) \

95 (!(
î∫um
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£π_≥º‹_Áû
 ((
î∫um
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #i‡
deföed
 
__˝lu•lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((
__c⁄°
 *Ë0)

	)

	@/usr/include/errno.h

23 #i‚def 
_ERRNO_H


27 #i‚def 
__√ed_Em©h


28 
	#_ERRNO_H
 1

	)

29 
	~<„©uªs.h
>

32 
	g__BEGIN_DECLS


36 
	~<bôs/î∫o.h
>

37 #unde‡
__√ed_Em©h


39 #ifdef 
_ERRNO_H


46 #i‚def 
î∫o


47 
î∫o
;

50 #ifde‡
__USE_GNU


55 *
¥ogøm_övoˇti⁄_«me
, *
¥ogøm_övoˇti⁄_sh‹t_«me
;

59 
	g__END_DECLS


67 #i‡
deföed
 
__USE_GNU
 || deföed 
__√ed_îr‹_t


68 #i‚de‡
__îr‹_t_deföed


69 
	tîr‹_t
;

70 
	#__îr‹_t_deföed
 1

	)

72 #unde‡
__√ed_îr‹_t


	@/usr/include/fcntl.h

24 #i‚def 
_FCNTL_H


25 
	#_FCNTL_H
 1

	)

27 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


34 
	~<bôs/f˙é.h
>

37 #ifde‡
__USE_XOPEN


38 
	~<sys/°©.h
>

41 #ifdef 
__USE_MISC


42 #i‚de‡
R_OK


45 
	#R_OK
 4

	)

46 
	#W_OK
 2

	)

47 
	#X_OK
 1

	)

48 
	#F_OK
 0

	)

53 #ifde‡
__USE_XOPEN


54 
	#SEEK_SET
 0

	)

55 
	#SEEK_CUR
 1

	)

56 
	#SEEK_END
 2

	)

59 #ifde‡
__USE_ATFILE


60 
	#AT_FDCWD
 -100

	)

63 
	#AT_SYMLINK_NOFOLLOW
 0x100

	)

64 
	#AT_REMOVEDIR
 0x200

	)

66 
	#AT_SYMLINK_FOLLOW
 0x400

	)

67 
	#AT_EACCESS
 0x200

	)

76 
f˙é
 (
__fd
, 
__cmd
, ...);

84 #i‚de‡
__USE_FILE_OFFSET64


85 
	$›í
 (
__c⁄°
 *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

87 #ifde‡
__REDIRECT


88 
	`__REDIRECT
 (
›í
, (
__c⁄°
 *
__fûe
, 
__oÊag
, ...), 
›í64
)

89 
	`__n⁄nuŒ
 ((1));

91 
	#›í
 
›í64


	)

94 #ifde‡
__USE_LARGEFILE64


95 
	$›í64
 (
__c⁄°
 *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

98 #ifde‡
__USE_ATFILE


108 #i‚de‡
__USE_FILE_OFFSET64


109 
	$›í©
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__oÊag
, ...)

110 
	`__n⁄nuŒ
 ((2));

112 #ifde‡
__REDIRECT


113 
	`__REDIRECT
 (
›í©
, (
__fd
, 
__c⁄°
 *
__fûe
, 
__oÊag
,

114 ...), 
›í©64
Ë
	`__n⁄nuŒ
 ((2));

116 
	#›í©
 
›í©64


	)

120 
	$›í©64
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__oÊag
, ...)

121 
	`__n⁄nuŒ
 ((2));

129 #i‚de‡
__USE_FILE_OFFSET64


130 
	$¸ót
 (
__c⁄°
 *
__fûe
, 
__mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

132 #ifde‡
__REDIRECT


133 
	`__REDIRECT
 (
¸ót
, (
__c⁄°
 *
__fûe
, 
__mode_t
 
__mode
),

134 
¸ót64
Ë
	`__n⁄nuŒ
 ((1));

136 
	#¸ót
 
¸ót64


	)

139 #ifde‡
__USE_LARGEFILE64


140 
	$¸ót64
 (
__c⁄°
 *
__fûe
, 
__mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

143 #i‡!
deföed
 
F_LOCK
 && (deföed 
__USE_MISC
 || (deföed 
__USE_XOPEN_EXTENDED
 \

144 && !
deföed
 
__USE_POSIX
))

153 
	#F_ULOCK
 0

	)

154 
	#F_LOCK
 1

	)

155 
	#F_TLOCK
 2

	)

156 
	#F_TEST
 3

	)

158 #i‚de‡
__USE_FILE_OFFSET64


159 
	`lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
);

161 #ifde‡
__REDIRECT


162 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
), 
lockf64
);

164 
	#lockf
 
lockf64


	)

167 #ifde‡
__USE_LARGEFILE64


168 
	`lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
);

172 #ifde‡
__USE_XOPEN2K


175 #i‚de‡
__USE_FILE_OFFSET64


176 
	$posix_Ádvi£
 (
__fd
, 
__off_t
 
__off£t
, __off_à
__Àn
,

177 
__advi£
Ë
__THROW
;

179 #ifde‡
__REDIRECT_NTH


180 
	`__REDIRECT_NTH
 (
posix_Ádvi£
, (
__fd
, 
__off64_t
 
__off£t
,

181 
__off64_t
 
__Àn
, 
__advi£
),

182 
posix_Ádvi£64
);

184 
	#posix_Ádvi£
 
posix_Ádvi£64


	)

187 #ifde‡
__USE_LARGEFILE64


188 
	$posix_Ádvi£64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_à
__Àn
,

189 
__advi£
Ë
__THROW
;

197 #i‚de‡
__USE_FILE_OFFSET64


198 
	`posix_ÁŒoˇã
 (
__fd
, 
__off_t
 
__off£t
, __off_à
__Àn
);

200 #ifde‡
__REDIRECT


201 
	`__REDIRECT
 (
posix_ÁŒoˇã
, (
__fd
, 
__off64_t
 
__off£t
,

202 
__off64_t
 
__Àn
),

203 
posix_ÁŒoˇã64
);

205 
	#posix_ÁŒoˇã
 
posix_ÁŒoˇã64


	)

208 #ifde‡
__USE_LARGEFILE64


209 
	`posix_ÁŒoˇã64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_à
__Àn
);

215 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe
 \

216 && 
deföed
 
__va_¨g_∑ck_Àn


217 
	~<bôs/f˙é2.h
>

220 
__END_DECLS


	@/usr/include/malloc.h

21 #i‚de‡
_MALLOC_H


22 
	#_MALLOC_H
 1

	)

24 
	~<„©uªs.h
>

25 
	~<°ddef.h
>

26 
	#__mÆloc_±r_t
 *

	)

29 
	#__mÆloc_size_t
 
size_t


	)

30 
	#__mÆloc_±rdiff_t
 
±rdiff_t


	)

32 #ifde‡
__GNUC__


34 
	#__MALLOC_P
(
¨gs
Ë¨g†
__THROW


	)

37 
	#__MALLOC_PMT
(
¨gs
Ë
	)
args

41 
	#__MALLOC_P
(
¨gs
Ë
	)
args

42 
	#__MALLOC_PMT
(
¨gs
Ë
	)
args

47 
__BEGIN_DECLS


50 *
mÆloc
 
__MALLOC_P
 ((
size_t
 
__size
)Ë
__©åibuã_mÆloc__
 
__wur
;

53 *
ˇŒoc
 
__MALLOC_P
 ((
size_t
 
__nmemb
, size_à
__size
))

54 
__©åibuã_mÆloc__
 
__wur
;

61 *
ªÆloc
 
__MALLOC_P
 ((*
__±r
, 
size_t
 
__size
))

62 
__©åibuã_w¨n_unu£d_ªsu…__
;

65 
‰ì
 
__MALLOC_P
 ((*
__±r
));

68 
c‰ì
 
__MALLOC_P
 ((*
__±r
));

71 *
memÆign
 
__MALLOC_P
 ((
size_t
 
__Æignmít
, size_à
__size
))

72 
__©åibuã_mÆloc__
 
__wur
;

75 *
vÆloc
 
__MALLOC_P
 ((
size_t
 
__size
))

76 
__©åibuã_mÆloc__
 
__wur
;

80 * 
pvÆloc
 
__MALLOC_P
 ((
size_t
 
__size
))

81 
__©åibuã_mÆloc__
 
__wur
;

85 *(*
__m‹ec‹e
Ë
__MALLOC_PMT
 ((
±rdiff_t
 
__size
));

88 *
__deÁu…_m‹ec‹e
 
__MALLOC_P
 ((
±rdiff_t
 
__size
))

89 
__©åibuã_mÆloc__
;

93 
	smÆlöfo
 {

94 
	m¨ía
;

95 
	m‹dblks
;

96 
	msmblks
;

97 
	mhblks
;

98 
	mhblkhd
;

99 
	musmblks
;

100 
	mfsmblks
;

101 
	mu‹dblks
;

102 
	mf‹dblks
;

103 
	mkìpco°
;

107 
mÆlöfo
 mÆlöfÿ
__MALLOC_P
 (());

110 #i‚de‡
M_MXFAST


111 
	#M_MXFAST
 1

	)

113 #i‚de‡
M_NLBLKS


114 
	#M_NLBLKS
 2

	)

116 #i‚de‡
M_GRAIN


117 
	#M_GRAIN
 3

	)

119 #i‚de‡
M_KEEP


120 
	#M_KEEP
 4

	)

124 
	#M_TRIM_THRESHOLD
 -1

	)

125 
	#M_TOP_PAD
 -2

	)

126 
	#M_MMAP_THRESHOLD
 -3

	)

127 
	#M_MMAP_MAX
 -4

	)

128 
	#M_CHECK_ACTION
 -5

	)

129 
	#M_PERTURB
 -6

	)

132 
mÆl›t
 
__MALLOC_P
 ((
__∑øm
, 
__vÆ
));

136 
mÆloc_åim
 
__MALLOC_P
 ((
size_t
 
__∑d
));

140 
size_t
 
mÆloc_ußbÀ_size
 
__MALLOC_P
 ((*
__±r
));

143 
mÆloc_°©s
 
__MALLOC_P
 (());

146 *
mÆloc_gë_°©e
 
__MALLOC_P
 (());

150 
mÆloc_£t_°©e
 
__MALLOC_P
 ((*
__±r
));

155 (*
__mÆloc_öôülize_hook
Ë
	`__MALLOC_PMT
 (());

157 (*
__‰ì_hook
Ë
	`__MALLOC_PMT
 ((*
__±r
,

158 
__c⁄°
 
__mÆloc_±r_t
));

159 *(*
__mÆloc_hook
Ë
	`__MALLOC_PMT
 ((
size_t
 
__size
,

160 
__c⁄°
 
__mÆloc_±r_t
));

161 *(*
__ªÆloc_hook
Ë
	`__MALLOC_PMT
 ((*
__±r
, 
size_t
 
__size
,

162 
__c⁄°
 
__mÆloc_±r_t
));

163 *(*
__memÆign_hook
Ë
	`__MALLOC_PMT
 ((
size_t
 
__Æignmít
,

164 
size_t
 
__size
,

165 
__c⁄°
 
__mÆloc_±r_t
));

166 (*
__a·î_m‹ec‹e_hook
Ë
	`__MALLOC_PMT
 (());

169 
__mÆloc_check_öô
 
	`__MALLOC_P
 (());

172 
__END_DECLS


	@/usr/include/math.h

25 #i‚def 
_MATH_H


26 
	#_MATH_H
 1

	)

28 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


34 
	~<bôs/huge_vÆ.h
>

35 #ifde‡
__USE_ISOC99


36 
	~<bôs/huge_vÆf.h
>

37 
	~<bôs/huge_vÆl.h
>

40 
	~<bôs/öf.h
>

43 
	~<bôs/«n.h
>

47 
	~<bôs/m©hdef.h
>

54 
	#__MATHCALL
(
fun˘i⁄
,
suffix
, 
¨gs
) \

55 
	`__MATHDECL
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
)

	)

56 
	#__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

57 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
); \

58 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
)

	)

59 
	#__MATHCALLX
(
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

60 
	`__MATHDECLX
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
)

	)

61 
	#__MATHDECLX
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

62 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
); \

63 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
)

	)

64 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

65 
ty≥
 
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
Ë
¨gs
 
__THROW


	)

67 
	#_MdoubÀ_
 

	)

68 
	#__MATH_PRECNAME
(
«me
,
r
Ë
	`__CONCAT
“ame,r)

	)

69 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

70 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

71 
	~<bôs/m©hˇŒs.h
>

72 #unde‡
_MdoubÀ_


73 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


74 #unde‡
_MdoubÀ_END_NAMESPACE


75 #unde‡
__MATH_PRECNAME


77 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


83 #i‚de‡
_MÊﬂt_


84 
	#_MÊﬂt_
 

	)

86 
	#_MdoubÀ_
 
_MÊﬂt_


	)

87 #ifde‡
__STDC__


88 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f
##
	)
r

90 
	#__MATH_PRECNAME
(
«me
,
r
Ë«mê
f
 
	)
r

92 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

93 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

94 
	~<bôs/m©hˇŒs.h
>

95 #unde‡
_MdoubÀ_


96 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


97 #unde‡
_MdoubÀ_END_NAMESPACE


98 #unde‡
__MATH_PRECNAME


100 #i‡(
__STDC__
 - 0 || 
__GNUC__
 - 0) \

101 && (!
deföed
 
__NO_LONG_DOUBLE_MATH
 || deföed 
__LDBL_COMPAT
)

102 #ifde‡
__LDBL_COMPAT


104 #ifde‡
__USE_ISOC99


105 
	$__∆dbl_√xâow¨df
 (
__x
, 
__y
)

106 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

107 #ifde‡
__REDIRECT_NTH


108 
	`__REDIRECT_NTH
 (
√xâow¨df
, (
__x
, 
__y
),

109 
__∆dbl_√xâow¨df
)

110 
	`__©åibuã__
 ((
__c⁄°__
));

111 
	`__REDIRECT_NTH
 (
√xâow¨d
, (
__x
, 
__y
),

112 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

113 
	`__REDIRECT_NTH
 (
√xâow¨dl
,

114 (
__x
, 
__y
),

115 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

122 #unde‡
__MATHDECL_1


123 
	#__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
Æüs
) \

124 
ty≥
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
), \

125 
¨gs
, 
Æüs
)

	)

126 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

127 
	`__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
	`__CONCAT
(fun˘i⁄,suffix))

	)

130 #i‚de‡
_Ml⁄g_doubÀ_


131 
	#_Ml⁄g_doubÀ_
 

	)

133 
	#_MdoubÀ_
 
_Ml⁄g_doubÀ_


	)

134 #ifde‡
__STDC__


135 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
l
##
	)
r

137 
	#__MATH_PRECNAME
(
«me
,
r
Ë«mê
l
 
	)
r

139 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

140 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

141 
	~<bôs/m©hˇŒs.h
>

142 #unde‡
_MdoubÀ_


143 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


144 #unde‡
_MdoubÀ_END_NAMESPACE


145 #unde‡
__MATH_PRECNAME


150 #unde‡
__MATHDECL_1


151 #unde‡
__MATHDECL


152 #unde‡
__MATHCALL


155 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


157 
signgam
;

162 #ifde‡
__USE_ISOC99


200 
FP_NAN
,

201 
	#FP_NAN
 
FP_NAN


	)

202 
FP_INFINITE
,

203 
	#FP_INFINITE
 
FP_INFINITE


	)

204 
FP_ZERO
,

205 
	#FP_ZERO
 
FP_ZERO


	)

206 
FP_SUBNORMAL
,

207 
	#FP_SUBNORMAL
 
FP_SUBNORMAL


	)

208 
FP_NORMAL


209 
	#FP_NORMAL
 
FP_NORMAL


	)

213 #ifde‡
__NO_LONG_DOUBLE_MATH


214 
	#Â˛assify
(
x
) \

215 ( (
x
Ë= (Ë? 
	`__Â˛assifyf
 (xË: 
	`__Â˛assify
 (x))

	)

217 
	#Â˛assify
(
x
) \

218 ( (
x
) ==  () \

219 ? 
	`__Â˛assifyf
 (
x
) \

220 :  (
x
) ==  () \

221 ? 
	`__Â˛assify
 (
x
Ë: 
	`__Â˛assifyl
 (x))

	)

225 #ifde‡
__NO_LONG_DOUBLE_MATH


226 
	#signbô
(
x
) \

227 ( (
x
Ë= (Ë? 
	`__signbôf
 (xË: 
	`__signbô
 (x))

	)

229 
	#signbô
(
x
) \

230 ( (
x
) ==  () \

231 ? 
	`__signbôf
 (
x
) \

232 :  (
x
) ==  () \

233 ? 
	`__signbô
 (
x
Ë: 
	`__signbôl
 (x))

	)

237 #ifde‡
__NO_LONG_DOUBLE_MATH


238 
	#isföôe
(
x
) \

239 ( (
x
Ë= (Ë? 
	`__föôef
 (xË: 
	`__föôe
 (x))

	)

241 
	#isföôe
(
x
) \

242 ( (
x
) ==  () \

243 ? 
	`__föôef
 (
x
) \

244 :  (
x
) ==  () \

245 ? 
	`__föôe
 (
x
Ë: 
	`__föôñ
 (x))

	)

249 
	#i¢‹mÆ
(
x
Ë(
	`Â˛assify
 (xË=
FP_NORMAL
)

	)

253 #ifde‡
__NO_LONG_DOUBLE_MATH


254 
	#i¢™
(
x
) \

255 ( (
x
Ë= (Ë? 
	`__i¢™f
 (xË: 
	`__i¢™
 (x))

	)

257 
	#i¢™
(
x
) \

258 ( (
x
) ==  () \

259 ? 
	`__i¢™f
 (
x
) \

260 :  (
x
) ==  () \

261 ? 
	`__i¢™
 (
x
Ë: 
	`__i¢™l
 (x))

	)

265 #ifde‡
__NO_LONG_DOUBLE_MATH


266 
	#isöf
(
x
) \

267 ( (
x
Ë= (Ë? 
	`__isöff
 (xË: 
	`__isöf
 (x))

	)

269 
	#isöf
(
x
) \

270 ( (
x
) ==  () \

271 ? 
	`__isöff
 (
x
) \

272 :  (
x
) ==  () \

273 ? 
	`__isöf
 (
x
Ë: 
	`__isöÊ
 (x))

	)

277 
	#MATH_ERRNO
 1

	)

278 
	#MATH_ERREXCEPT
 2

	)

282 #ifdef 
__USE_MISC


286 
_IEEE_
 = -1,

287 
_SVID_
,

288 
_XOPEN_
,

289 
_POSIX_
,

290 
_ISOC_


291 } 
	t_LIB_VERSION_TYPE
;

296 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

300 #ifde‡
__USE_SVID


306 #ifde‡
__˝lu•lus


307 
__ex˚±i⁄


309 
ex˚±i⁄


312 
ty≥
;

313 *
«me
;

314 
¨g1
;

315 
¨g2
;

316 
ªtvÆ
;

317 
	}
};

319 #ifde‡
__˝lu•lus


320 
	$m©hîr
 (
__ex˚±i⁄
 *
__exc
Ë
	`throw
 ();

322 
	`m©hîr
 (
ex˚±i⁄
 *
__exc
);

325 
	#X_TLOSS
 1.41484755040568800000e+16

	)

328 
	#DOMAIN
 1

	)

329 
	#SING
 2

	)

330 
	#OVERFLOW
 3

	)

331 
	#UNDERFLOW
 4

	)

332 
	#TLOSS
 5

	)

333 
	#PLOSS
 6

	)

336 
	#HUGE
 3.40282347e+38F

	)

340 #ifde‡
__USE_XOPEN


342 
	#MAXFLOAT
 3.40282347e+38F

	)

349 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN


350 
	#M_E
 2.7182818284590452354

	)

351 
	#M_LOG2E
 1.4426950408889634074

	)

352 
	#M_LOG10E
 0.43429448190325182765

	)

353 
	#M_LN2
 0.69314718055994530942

	)

354 
	#M_LN10
 2.30258509299404568402

	)

355 
	#M_PI
 3.14159265358979323846

	)

356 
	#M_PI_2
 1.57079632679489661923

	)

357 
	#M_PI_4
 0.78539816339744830962

	)

358 
	#M_1_PI
 0.31830988618379067154

	)

359 
	#M_2_PI
 0.63661977236758134308

	)

360 
	#M_2_SQRTPI
 1.12837916709551257390

	)

361 
	#M_SQRT2
 1.41421356237309504880

	)

362 
	#M_SQRT1_2
 0.70710678118654752440

	)

368 #ifde‡
__USE_GNU


369 
	#M_El
 2.7182818284590452353602874713526625L

	)

370 
	#M_LOG2El
 1.4426950408889634073599246810018921L

	)

371 
	#M_LOG10El
 0.4342944819032518276511289189166051L

	)

372 
	#M_LN2l
 0.6931471805599453094172321214581766L

	)

373 
	#M_LN10l
 2.3025850929940456840179914546843642L

	)

374 
	#M_PIl
 3.1415926535897932384626433832795029L

	)

375 
	#M_PI_2l
 1.5707963267948966192313216916397514L

	)

376 
	#M_PI_4l
 0.7853981633974483096156608458198757L

	)

377 
	#M_1_PIl
 0.3183098861837906715377675267450287L

	)

378 
	#M_2_PIl
 0.6366197723675813430755350534900574L

	)

379 
	#M_2_SQRTPIl
 1.1283791670955125738961589031215452L

	)

380 
	#M_SQRT2l
 1.4142135623730950488016887242096981L

	)

381 
	#M_SQRT1_2l
 0.7071067811865475244008443621048490L

	)

388 #i‡
deföed
 
__STRICT_ANSI__
 && !deföed 
__NO_MATH_INLINES


389 
	#__NO_MATH_INLINES
 1

	)

392 #i‡
deföed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

399 
	#isgª©î
(
x
, 
y
Ë
	`__buûtö_isgª©î
(x, y)

	)

400 
	#isgª©îequÆ
(
x
, 
y
Ë
	`__buûtö_isgª©îequÆ
(x, y)

	)

401 
	#i¶ess
(
x
, 
y
Ë
	`__buûtö_i¶ess
(x, y)

	)

402 
	#i¶es£quÆ
(
x
, 
y
Ë
	`__buûtö_i¶es£quÆ
(x, y)

	)

403 
	#i¶essgª©î
(
x
, 
y
Ë
	`__buûtö_i¶essgª©î
(x, y)

	)

404 
	#isun‹dîed
(
u
, 
v
Ë
	`__buûtö_isun‹dîed
(u, v)

	)

408 #ifde‡
__USE_EXTERN_INLINES


409 
	~<bôs/m©hölöe.h
>

412 #ifde‡
__USE_ISOC99


416 #i‚de‡
isgª©î


417 
	#isgª©î
(
x
, 
y
) \

418 (
__exãnsi⁄__
 \

419 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

420 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x > __y; 
	}
}))

	)

424 #i‚de‡
isgª©îequÆ


425 
	#isgª©îequÆ
(
x
, 
y
) \

426 (
__exãnsi⁄__
 \

427 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

428 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x >__y; }))

	)

432 #i‚de‡
i¶ess


433 
	#i¶ess
(
x
, 
y
) \

434 (
__exãnsi⁄__
 \

435 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

436 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x < __y; }))

	)

440 #i‚de‡
i¶es£quÆ


441 
	#i¶es£quÆ
(
x
, 
y
) \

442 (
__exãnsi⁄__
 \

443 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

444 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x <__y; }))

	)

448 #i‚de‡
i¶essgª©î


449 
	#i¶essgª©î
(
x
, 
y
) \

450 (
__exãnsi⁄__
 \

451 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

452 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& (__x < __y || __y < __x); }))

	)

456 #i‚de‡
isun‹dîed


457 
	#isun‹dîed
(
u
, 
v
) \

458 (
__exãnsi⁄__
 \

459 ({ 
	`__ty≥of__
(
u
Ë
__u
 = (u); __ty≥of__(
v
Ë
__v
 = (v); \

460 
	`Â˛assify
 (
__u
Ë=
FP_NAN
 || fp˛assify (
__v
Ë=FP_NAN; }))

	)

465 
	g__END_DECLS


	@/usr/include/setjmp.h

23 #i‚def 
_SETJMP_H


24 
	#_SETJMP_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


30 
	~<bôs/£tjmp.h
>

31 
	~<bôs/sig£t.h
>

35 
	s__jmp_buf_èg


41 
__jmp_buf
 
	m__jmpbuf
;

42 
	m__mask_was_ßved
;

43 
__sig£t_t
 
	m__ßved_mask
;

47 
__BEGIN_NAMESPACE_STD


49 
__jmp_buf_èg
 
	tjmp_buf
[1];

53 
	$£tjmp
 (
jmp_buf
 
__ív
Ë
__THROW
;

55 
__END_NAMESPACE_STD


60 
	$__sig£tjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__ßvemask
Ë
__THROW
;

62 #i‚def 
__FAVOR_BSD


65 
	$_£tjmp
 (
__jmp_buf_èg
 
__ív
[1]Ë
__THROW
;

69 
	#£tjmp
(
ív
Ë
	`_£tjmp
 (ív)

	)

74 
	#£tjmp
(
ív
Ë
	`£tjmp
 (ív)

	)

78 
__BEGIN_NAMESPACE_STD


82 
	$l⁄gjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__vÆ
)

83 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

85 
__END_NAMESPACE_STD


87 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN


91 
	$_l⁄gjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__vÆ
)

92 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

96 #ifdef 
__USE_POSIX


100 
__jmp_buf_èg
 
	tsigjmp_buf
[1];

104 
	#sig£tjmp
(
ív
, 
ßvemask
Ë
	`__sig£tjmp
 (ív, savemask)

	)

110 
	$sigl⁄gjmp
 (
sigjmp_buf
 
__ív
, 
__vÆ
)

111 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

114 
__END_DECLS


	@/usr/include/signal.h

23 #i‚def 
_SIGNAL_H


25 #i‡!
deföed
 
__√ed_sig_©omic_t
 && !deföed 
__√ed_sig£t_t


26 
	#_SIGNAL_H


	)

29 
	~<„©uªs.h
>

31 
	g__BEGIN_DECLS


33 
	~<bôs/sig£t.h
>

37 #i‡
deföed
 
__√ed_sig_©omic_t
 || deföed 
_SIGNAL_H


38 #i‚de‡
__sig_©omic_t_deföed


39 
	#__sig_©omic_t_deföed


	)

40 
__BEGIN_NAMESPACE_STD


41 
__sig_©omic_t
 
	tsig_©omic_t
;

42 
	g__END_NAMESPACE_STD


44 #unde‡
__√ed_sig_©omic_t


47 #i‡
deföed
 
__√ed_sig£t_t
 || (deföed 
_SIGNAL_H
 && deföed 
__USE_POSIX
)

48 #i‚de‡
__sig£t_t_deföed


49 
	#__sig£t_t_deföed


	)

50 
__sig£t_t
 
	tsig£t_t
;

52 #unde‡
__√ed_sig£t_t


55 #ifde‡
_SIGNAL_H


57 
	~<bôs/ty≥s.h
>

58 
	~<bôs/signum.h
>

60 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


61 #i‚de‡
__pid_t_deföed


62 
__pid_t
 
	tpid_t
;

63 
	#__pid_t_deföed


	)

65 #ifde‡
__USE_XOPEN


67 #i‚de‡
__uid_t_deföed


68 
__uid_t
 
	tuid_t
;

69 
	#__uid_t_deföed


	)

75 (*
	t__sigh™dÀr_t
) ();

80 
__sigh™dÀr_t
 
	$__sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

81 
__THROW
;

82 #ifde‡
__USE_GNU


83 
__sigh™dÀr_t
 
	$sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

84 
__THROW
;

90 
__BEGIN_NAMESPACE_STD


91 #ifde‡
__USE_BSD


92 
__sigh™dÀr_t
 
	$sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

93 
__THROW
;

96 #ifde‡
__REDIRECT_NTH


97 
__sigh™dÀr_t
 
	`__REDIRECT_NTH
 (
sig«l
,

98 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
),

99 
__sysv_sig«l
);

101 
	#sig«l
 
__sysv_sig«l


	)

104 
__END_NAMESPACE_STD


106 #ifde‡
__USE_XOPEN


109 
__sigh™dÀr_t
 
	$bsd_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

110 
__THROW
;

116 #ifde‡
__USE_POSIX


117 
	$kûl
 (
__pid_t
 
__pid
, 
__sig
Ë
__THROW
;

120 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


124 
	$kûÕg
 (
__pid_t
 
__pgΩ
, 
__sig
Ë
__THROW
;

127 
__BEGIN_NAMESPACE_STD


129 
	$øi£
 (
__sig
Ë
__THROW
;

130 
__END_NAMESPACE_STD


132 #ifde‡
__USE_SVID


134 
__sigh™dÀr_t
 
	$ssig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

135 
__THROW
;

136 
	$gsig«l
 (
__sig
Ë
__THROW
;

139 #ifde‡
__USE_MISC


141 
	`psig«l
 (
__sig
, 
__c⁄°
 *
__s
);

153 
	`__sig∑u£
 (
__sig_‹_mask
, 
__is_sig
);

155 #ifde‡
__FAVOR_BSD


158 
	$sig∑u£
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

160 #ifde‡
__USE_XOPEN


161 #ifde‡
__GNUC__


162 
	$sig∑u£
 (
__sig
Ë
	`__asm__
 ("__xpg_sigpause");

165 
	#sig∑u£
(
sig
Ë
	`__sig∑u£
 ((sig), 1)

	)

171 #ifde‡
__USE_BSD


178 
	#sigmask
(
sig
Ë
	`__sigmask
(sig)

	)

181 
	$sigblock
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

184 
	$sig£tmask
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

187 
	$siggëmask
 (Ë
__THROW
 
__©åibuã_dïªˇãd__
;

191 #ifde‡
__USE_MISC


192 
	#NSIG
 
_NSIG


	)

195 #ifde‡
__USE_GNU


196 
__sigh™dÀr_t
 
	tsigh™dÀr_t
;

200 #ifde‡
__USE_BSD


201 
__sigh™dÀr_t
 
	tsig_t
;

204 #ifde‡
__USE_POSIX


206 #ifde‡
__USE_POSIX199309


208 
	#__√ed_time•ec


	)

209 
	~<time.h
>

212 
	~<bôs/sigöfo.h
>

216 
	$sigem±y£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

219 
	$sigfûl£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

222 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

225 
	$sigdñ£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

228 
	$sigismembî
 (
__c⁄°
 
sig£t_t
 *
__£t
, 
__signo
)

229 
__THROW
 
	`__n⁄nuŒ
 ((1));

231 #ifde‡
__USE_GNU


233 
	$sigi£m±y£t
 (
__c⁄°
 
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

236 
	$sig™d£t
 (
sig£t_t
 *
__£t
, 
__c⁄°
 sig£t_à*
__À·
,

237 
__c⁄°
 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

240 
	$sig‹£t
 (
sig£t_t
 *
__£t
, 
__c⁄°
 sig£t_à*
__À·
,

241 
__c⁄°
 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

246 
	~<bôs/siga˘i⁄.h
>

249 
	$sig¥ocmask
 (
__how
, 
__c⁄°
 
sig£t_t
 *
__ª°ri˘
 
__£t
,

250 
sig£t_t
 *
__ª°ri˘
 
__o£t
Ë
__THROW
;

257 
	$sigsu•íd
 (
__c⁄°
 
sig£t_t
 *
__£t
Ë
	`__n⁄nuŒ
 ((1));

260 
	$siga˘i⁄
 (
__sig
, 
__c⁄°
 
siga˘i⁄
 *
__ª°ri˘
 
__a˘
,

261 
siga˘i⁄
 *
__ª°ri˘
 
__ﬂ˘
Ë
__THROW
;

264 
	$sig≥ndög
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

271 
	$sigwaô
 (
__c⁄°
 
sig£t_t
 *
__ª°ri˘
 
__£t
, *__ª°ri˘ 
__sig
)

272 
	`__n⁄nuŒ
 ((1, 2));

274 #ifde‡
__USE_POSIX199309


279 
	$sigwaôöfo
 (
__c⁄°
 
sig£t_t
 *
__ª°ri˘
 
__£t
,

280 
sigöfo_t
 *
__ª°ri˘
 
__öfo
Ë
	`__n⁄nuŒ
 ((1));

287 
	$sigtimedwaô
 (
__c⁄°
 
sig£t_t
 *
__ª°ri˘
 
__£t
,

288 
sigöfo_t
 *
__ª°ri˘
 
__öfo
,

289 
__c⁄°
 
time•ec
 *
__ª°ri˘
 
__timeout
)

290 
	`__n⁄nuŒ
 ((1));

294 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, 
__c⁄°
 
sigvÆ
 
__vÆ
)

295 
__THROW
;

300 #ifde‡
__USE_BSD


304 
__c⁄°
 *__c⁄° 
_sys_sigli°
[
_NSIG
];

305 
__c⁄°
 *__c⁄° 
sys_sigli°
[
_NSIG
];

308 
	ssigvec


310 
__sigh™dÀr_t
 
sv_h™dÀr
;

311 
sv_mask
;

313 
sv_Êags
;

314 
	#sv_⁄°ack
 
sv_Êags


	)

318 
	#SV_ONSTACK
 (1 << 0)

	)

319 
	#SV_INTERRUPT
 (1 << 1)

	)

320 
	#SV_RESETHAND
 (1 << 2)

	)

328 
	$sigvec
 (
__sig
, 
__c⁄°
 
sigvec
 *
__vec
,

329 
sigvec
 *
__ovec
Ë
__THROW
;

333 
	~<bôs/sigc⁄ãxt.h
>

336 
	$sigªtu∫
 (
sigc⁄ãxt
 *
__s˝
Ë
__THROW
;

341 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


342 
	#__√ed_size_t


	)

343 
	~<°ddef.h
>

348 
	$sigöãºu±
 (
__sig
, 
__öãºu±
Ë
__THROW
;

350 
	~<bôs/sig°ack.h
>

351 #ifde‡
__USE_XOPEN


353 
	~<sys/uc⁄ãxt.h
>

359 
	$sig°ack
 (
sig°ack
 *
__ss
, sig°ack *
__oss
)

360 
__THROW
 
__©åibuã_dïªˇãd__
;

364 
	$sigÆt°ack
 (
__c⁄°
 
sigÆt°ack
 *
__ª°ri˘
 
__ss
,

365 
sigÆt°ack
 *
__ª°ri˘
 
__oss
Ë
__THROW
;

369 #ifde‡
__USE_XOPEN_EXTENDED


373 
	$sighﬁd
 (
__sig
Ë
__THROW
;

376 
	$sigªl£
 (
__sig
Ë
__THROW
;

379 
	$sigign‹e
 (
__sig
Ë
__THROW
;

382 
__sigh™dÀr_t
 
	$sig£t
 (
__sig
, 
__sigh™dÀr_t
 
__di•
Ë
__THROW
;

385 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


388 
	~<bôs/±hªadty≥s.h
>

389 
	~<bôs/sigthªad.h
>

396 
	$__libc_cuºít_sigπmö
 (Ë
__THROW
;

398 
	$__libc_cuºít_sigπmax
 (Ë
__THROW
;

402 
__END_DECLS


	@/usr/include/stdio.h

24 #i‚de‡
_STDIO_H


26 #i‡!
deföed
 
__√ed_FILE
 && !deföed 
__√ed___FILE


27 
	#_STDIO_H
 1

	)

28 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


32 
	#__√ed_size_t


	)

33 
	#__√ed_NULL


	)

34 
	~<°ddef.h
>

36 
	~<bôs/ty≥s.h
>

37 
	#__√ed_FILE


	)

38 
	#__√ed___FILE


	)

42 #i‡!
deföed
 
__FILE_deföed
 && deföed 
__√ed_FILE


45 
	g_IO_FILE
;

47 
__BEGIN_NAMESPACE_STD


49 
_IO_FILE
 
	tFILE
;

50 
	g__END_NAMESPACE_STD


51 #i‡
deföed
 
__USE_LARGEFILE64
 || deföed 
__USE_SVID
 || deföed 
__USE_POSIX
 \

52 || 
deföed
 
	g__USE_BSD
 || deföed 
	g__USE_ISOC99
 || deföed 
	g__USE_XOPEN
 \

53 || 
deföed
 
__USE_POSIX2


54 
	$__USING_NAMESPACE_STD
(
FILE
)

57 
	#__FILE_deföed
 1

	)

59 #unde‡
__√ed_FILE


62 #i‡!
deföed
 
____FILE_deföed
 && deföed 
__√ed___FILE


65 
_IO_FILE
 
	t__FILE
;

67 
	#____FILE_deföed
 1

	)

69 #unde‡
__√ed___FILE


72 #ifdef 
_STDIO_H


73 
	#_STDIO_USES_IOSTREAM


	)

75 
	~<libio.h
>

77 #ifde‡
__USE_XOPEN


78 #ifde‡
__GNUC__


79 #i‚de‡
_VA_LIST_DEFINED


80 
_G_va_li°
 
	tva_li°
;

81 
	#_VA_LIST_DEFINED


	)

84 
	~<°d¨g.h
>

89 
__BEGIN_NAMESPACE_STD


90 #i‚de‡
__USE_FILE_OFFSET64


91 
_G_Âos_t
 
	tÂos_t
;

93 
_G_Âos64_t
 
	tÂos_t
;

95 
__END_NAMESPACE_STD


96 #ifde‡
__USE_LARGEFILE64


97 
_G_Âos64_t
 
	tÂos64_t
;

101 
	#_IOFBF
 0

	)

102 
	#_IOLBF
 1

	)

103 
	#_IONBF
 2

	)

107 #i‚de‡
BUFSIZ


108 
	#BUFSIZ
 
_IO_BUFSIZ


	)

114 #i‚de‡
EOF


115 
	#EOF
 (-1)

	)

121 
	#SEEK_SET
 0

	)

122 
	#SEEK_CUR
 1

	)

123 
	#SEEK_END
 2

	)

126 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


128 
	#P_tmpdú
 "/tmp"

	)

141 
	~<bôs/°dio_lim.h
>

145 
_IO_FILE
 *
°dö
;

146 
_IO_FILE
 *
°dout
;

147 
_IO_FILE
 *
°dîr
;

148 #ifde‡
__STDC__


150 
	#°dö
 
°dö


	)

151 
	#°dout
 
°dout


	)

152 
	#°dîr
 
°dîr


	)

155 
__BEGIN_NAMESPACE_STD


157 
	$ªmove
 (
__c⁄°
 *
__fûíame
Ë
__THROW
;

159 
	$ª«me
 (
__c⁄°
 *
__ﬁd
, __c⁄° *
__√w
Ë
__THROW
;

160 
__END_NAMESPACE_STD


162 #ifde‡
__USE_ATFILE


164 
	$ª«mót
 (
__ﬁdfd
, 
__c⁄°
 *
__ﬁd
, 
__√wfd
,

165 
__c⁄°
 *
__√w
Ë
__THROW
;

168 
__BEGIN_NAMESPACE_STD


173 #i‚de‡
__USE_FILE_OFFSET64


174 
FILE
 *
	$tmpfûe
 (Ë
__wur
;

176 #ifde‡
__REDIRECT


177 
FILE
 *
	`__REDIRECT
 (
tmpfûe
, (), 
tmpfûe64
Ë
__wur
;

179 
	#tmpfûe
 
tmpfûe64


	)

183 #ifde‡
__USE_LARGEFILE64


184 
FILE
 *
	$tmpfûe64
 (Ë
__wur
;

188 *
	$tm≤am
 (*
__s
Ë
__THROW
 
__wur
;

189 
__END_NAMESPACE_STD


191 #ifde‡
__USE_MISC


194 *
	$tm≤am_r
 (*
__s
Ë
__THROW
 
__wur
;

198 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


206 *
	$ãm≤am
 (
__c⁄°
 *
__dú
, __c⁄° *
__pfx
)

207 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

211 
__BEGIN_NAMESPACE_STD


216 
	`f˛o£
 (
FILE
 *
__°ªam
);

221 
	`fÊush
 (
FILE
 *
__°ªam
);

222 
__END_NAMESPACE_STD


224 #ifde‡
__USE_MISC


231 
	`fÊush_u∆ocked
 (
FILE
 *
__°ªam
);

234 #ifde‡
__USE_GNU


241 
	`f˛o£Æl
 ();

245 
__BEGIN_NAMESPACE_STD


246 #i‚de‡
__USE_FILE_OFFSET64


251 
FILE
 *
	$f›í
 (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

252 
__c⁄°
 *
__ª°ri˘
 
__modes
Ë
__wur
;

257 
FILE
 *
	$‰e›í
 (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

258 
__c⁄°
 *
__ª°ri˘
 
__modes
,

259 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

261 #ifde‡
__REDIRECT


262 
FILE
 *
	`__REDIRECT
 (
f›í
, (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

263 
__c⁄°
 *
__ª°ri˘
 
__modes
), 
f›í64
)

264 
__wur
;

265 
FILE
 *
	`__REDIRECT
 (
‰e›í
, (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

266 
__c⁄°
 *
__ª°ri˘
 
__modes
,

267 
FILE
 *
__ª°ri˘
 
__°ªam
), 
‰e›í64
)

268 
__wur
;

270 
	#f›í
 
f›í64


	)

271 
	#‰e›í
 
‰e›í64


	)

274 
__END_NAMESPACE_STD


275 #ifde‡
__USE_LARGEFILE64


276 
FILE
 *
	$f›í64
 (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

277 
__c⁄°
 *
__ª°ri˘
 
__modes
Ë
__wur
;

278 
FILE
 *
	$‰e›í64
 (
__c⁄°
 *
__ª°ri˘
 
__fûíame
,

279 
__c⁄°
 *
__ª°ri˘
 
__modes
,

280 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

283 #ifdef 
__USE_POSIX


285 
FILE
 *
	$fd›í
 (
__fd
, 
__c⁄°
 *
__modes
Ë
__THROW
 
__wur
;

288 #ifdef 
__USE_GNU


291 
FILE
 *
	$f›ícookõ
 (*
__ª°ri˘
 
__magic_cookõ
,

292 
__c⁄°
 *
__ª°ri˘
 
__modes
,

293 
_IO_cookõ_io_fun˘i⁄s_t
 
__io_funcs
Ë
__THROW
 
__wur
;

296 
FILE
 *
	$fmem›í
 (*
__s
, 
size_t
 
__Àn
, 
__c⁄°
 *
__modes
)

297 
__THROW
 
__wur
;

302 
FILE
 *
	$›í_mem°ªam
 (**
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
 
__wur
;

306 
__BEGIN_NAMESPACE_STD


309 
	$£tbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
Ë
__THROW
;

313 
	$£tvbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

314 
__modes
, 
size_t
 
__n
Ë
__THROW
;

315 
__END_NAMESPACE_STD


317 #ifdef 
__USE_BSD


320 
	$£tbuf„r
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

321 
size_t
 
__size
Ë
__THROW
;

324 
	$£éöebuf
 (
FILE
 *
__°ªam
Ë
__THROW
;

328 
__BEGIN_NAMESPACE_STD


333 
	`Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

334 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...);

339 
	`¥ötf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...);

341 
	$•rötf
 (*
__ª°ri˘
 
__s
,

342 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

348 
	`vÂrötf
 (
FILE
 *
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__f‹m©
,

349 
_G_va_li°
 
__¨g
);

354 
	`v¥ötf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
);

356 
	$v•rötf
 (*
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__f‹m©
,

357 
_G_va_li°
 
__¨g
Ë
__THROW
;

358 
__END_NAMESPACE_STD


360 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_ISOC99
 || deföed 
__USE_UNIX98


361 
__BEGIN_NAMESPACE_C99


363 
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

364 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...)

365 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

367 
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

368 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

369 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

370 
__END_NAMESPACE_C99


373 #ifde‡
__USE_GNU


376 
	$va•rötf
 (**
__ª°ri˘
 
__±r
, 
__c⁄°
 *__ª°ri˘ 
__f
,

377 
_G_va_li°
 
__¨g
)

378 
__THROW
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 0))Ë
__wur
;

379 
	$__a•rötf
 (**
__ª°ri˘
 
__±r
,

380 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

381 
__THROW
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

382 
	$a•rötf
 (**
__ª°ri˘
 
__±r
,

383 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

384 
__THROW
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

392 
	$vd¥ötf
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fmt
,

393 
_G_va_li°
 
__¨g
)

394 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

395 
	$d¥ötf
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

396 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

400 
__BEGIN_NAMESPACE_STD


405 
	$fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

406 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

411 
	$sˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

413 
	$ssˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

414 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

416 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

417 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

418 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

419 #ifde‡
__REDIRECT


423 
	`__REDIRECT
 (
fsˇnf
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

424 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...),

425 
__isoc99_fsˇnf
Ë
__wur
;

426 
	`__REDIRECT
 (
sˇnf
, (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...),

427 
__isoc99_sˇnf
Ë
__wur
;

428 
	`__REDIRECT
 (
ssˇnf
, (
__c⁄°
 *
__ª°ri˘
 
__s
,

429 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...),

430 
__isoc99_ssˇnf
Ë
__THROW
;

432 
	$__isoc99_fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

433 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

434 
	$__isoc99_sˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

435 
	$__isoc99_ssˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

436 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

437 
	#fsˇnf
 
__isoc99_fsˇnf


	)

438 
	#sˇnf
 
__isoc99_sˇnf


	)

439 
	#ssˇnf
 
__isoc99_ssˇnf


	)

443 
__END_NAMESPACE_STD


445 #ifdef 
__USE_ISOC99


446 
__BEGIN_NAMESPACE_C99


451 
	$vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__f‹m©
,

452 
_G_va_li°
 
__¨g
)

453 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

459 
	$vsˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

460 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

463 
	$vssˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

464 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

465 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

467 #i‡!
deföed
 
__USE_GNU
 \

468 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

469 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

470 #ifde‡
__REDIRECT


474 
	`__REDIRECT
 (
vfsˇnf
,

475 (
FILE
 *
__ª°ri˘
 
__s
,

476 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
),

477 
__isoc99_vfsˇnf
)

478 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

479 
	`__REDIRECT
 (
vsˇnf
, (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

480 
_G_va_li°
 
__¨g
), 
__isoc99_vfsˇnf
)

481 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

482 
	`__REDIRECT
 (
vssˇnf
,

483 (
__c⁄°
 *
__ª°ri˘
 
__s
,

484 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
),

485 
__isoc99_vssˇnf
)

486 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

488 
	$__isoc99_vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
,

489 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

490 
_G_va_li°
 
__¨g
Ë
__wur
;

491 
	$__isoc99_vsˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

492 
_G_va_li°
 
__¨g
Ë
__wur
;

493 
	$__isoc99_vssˇnf
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

494 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

495 
_G_va_li°
 
__¨g
Ë
__THROW
;

496 
	#vfsˇnf
 
__isoc99_vfsˇnf


	)

497 
	#vsˇnf
 
__isoc99_vsˇnf


	)

498 
	#vssˇnf
 
__isoc99_vssˇnf


	)

502 
__END_NAMESPACE_C99


506 
__BEGIN_NAMESPACE_STD


511 
	`fgëc
 (
FILE
 *
__°ªam
);

512 
	`gëc
 (
FILE
 *
__°ªam
);

518 
	`gëch¨
 ();

519 
__END_NAMESPACE_STD


523 
	#gëc
(
_Â
Ë
	`_IO_gëc
 (_Â)

	)

525 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


530 
	`gëc_u∆ocked
 (
FILE
 *
__°ªam
);

531 
	`gëch¨_u∆ocked
 ();

534 #ifde‡
__USE_MISC


541 
	`fgëc_u∆ocked
 (
FILE
 *
__°ªam
);

545 
__BEGIN_NAMESPACE_STD


553 
	`Âutc
 (
__c
, 
FILE
 *
__°ªam
);

554 
	`putc
 (
__c
, 
FILE
 *
__°ªam
);

560 
	`putch¨
 (
__c
);

561 
__END_NAMESPACE_STD


565 
	#putc
(
_ch
, 
_Â
Ë
	`_IO_putc
 (_ch, _Â)

	)

567 #ifde‡
__USE_MISC


574 
	`Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

577 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


582 
	`putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

583 
	`putch¨_u∆ocked
 (
__c
);

587 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 \

588 || (
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

590 
	`gëw
 (
FILE
 *
__°ªam
);

593 
	`putw
 (
__w
, 
FILE
 *
__°ªam
);

597 
__BEGIN_NAMESPACE_STD


602 *
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

603 
__wur
;

610 *
	$gës
 (*
__s
Ë
__wur
;

611 
__END_NAMESPACE_STD


613 #ifde‡
__USE_GNU


620 *
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
,

621 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

625 #ifdef 
__USE_GNU


636 
_IO_ssize_t
 
	$__gëdñim
 (**
__ª°ri˘
 
__löïå
,

637 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

638 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

639 
_IO_ssize_t
 
	$gëdñim
 (**
__ª°ri˘
 
__löïå
,

640 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

641 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

649 
_IO_ssize_t
 
	$gëlöe
 (**
__ª°ri˘
 
__löïå
,

650 
size_t
 *
__ª°ri˘
 
__n
,

651 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

655 
__BEGIN_NAMESPACE_STD


660 
	`Âuts
 (
__c⁄°
 *
__ª°ri˘
 
__s
, 
FILE
 *__ª°ri˘ 
__°ªam
);

666 
	`puts
 (
__c⁄°
 *
__s
);

673 
	`ungëc
 (
__c
, 
FILE
 *
__°ªam
);

680 
size_t
 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

681 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

686 
size_t
 
	$fwrôe
 (
__c⁄°
 *
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

687 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__s
Ë
__wur
;

688 
__END_NAMESPACE_STD


690 #ifde‡
__USE_GNU


697 
	`Âuts_u∆ocked
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

698 
FILE
 *
__ª°ri˘
 
__°ªam
);

701 #ifde‡
__USE_MISC


708 
size_t
 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

709 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

710 
size_t
 
	$fwrôe_u∆ocked
 (
__c⁄°
 *
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

711 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

715 
__BEGIN_NAMESPACE_STD


720 
	`f£ek
 (
FILE
 *
__°ªam
, 
__off
, 
__whí˚
);

725 
	$·ñl
 (
FILE
 *
__°ªam
Ë
__wur
;

730 
	`ªwöd
 (
FILE
 *
__°ªam
);

731 
__END_NAMESPACE_STD


738 #i‡
deföed
 
__USE_LARGEFILE
 || deföed 
__USE_XOPEN2K


739 #i‚de‡
__USE_FILE_OFFSET64


744 
	`f£eko
 (
FILE
 *
__°ªam
, 
__off_t
 
__off
, 
__whí˚
);

749 
__off_t
 
	$·ñlo
 (
FILE
 *
__°ªam
Ë
__wur
;

751 #ifde‡
__REDIRECT


752 
	`__REDIRECT
 (
f£eko
,

753 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
),

754 
f£eko64
);

755 
__off64_t
 
	`__REDIRECT
 (
·ñlo
, (
FILE
 *
__°ªam
), 
·ñlo64
);

757 
	#f£eko
 
f£eko64


	)

758 
	#·ñlo
 
·ñlo64


	)

763 
__BEGIN_NAMESPACE_STD


764 #i‚de‡
__USE_FILE_OFFSET64


769 
	`fgëpos
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos_t
 *__ª°ri˘ 
__pos
);

774 
	`f£ços
 (
FILE
 *
__°ªam
, 
__c⁄°
 
Âos_t
 *
__pos
);

776 #ifde‡
__REDIRECT


777 
	`__REDIRECT
 (
fgëpos
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

778 
Âos_t
 *
__ª°ri˘
 
__pos
), 
fgëpos64
);

779 
	`__REDIRECT
 (
f£ços
,

780 (
FILE
 *
__°ªam
, 
__c⁄°
 
Âos_t
 *
__pos
), 
f£ços64
);

782 
	#fgëpos
 
fgëpos64


	)

783 
	#f£ços
 
f£ços64


	)

786 
__END_NAMESPACE_STD


788 #ifde‡
__USE_LARGEFILE64


789 
	`f£eko64
 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
);

790 
__off64_t
 
	$·ñlo64
 (
FILE
 *
__°ªam
Ë
__wur
;

791 
	`fgëpos64
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos64_t
 *__ª°ri˘ 
__pos
);

792 
	`f£ços64
 (
FILE
 *
__°ªam
, 
__c⁄°
 
Âos64_t
 *
__pos
);

795 
__BEGIN_NAMESPACE_STD


797 
	$˛óªº
 (
FILE
 *
__°ªam
Ë
__THROW
;

799 
	$„of
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

801 
	$„º‹
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

802 
__END_NAMESPACE_STD


804 #ifde‡
__USE_MISC


806 
	$˛óªº_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
;

807 
	$„of_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

808 
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

812 
__BEGIN_NAMESPACE_STD


817 
	`≥º‹
 (
__c⁄°
 *
__s
);

818 
__END_NAMESPACE_STD


824 
	~<bôs/sys_îæi°.h
>

827 #ifdef 
__USE_POSIX


829 
	$fûío
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

832 #ifde‡
__USE_MISC


834 
	$fûío_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

838 #i‡(
deföed
 
__USE_POSIX2
 || deföed 
__USE_SVID
 || deföed 
__USE_BSD
 || \

839 
deföed
 
__USE_MISC
)

844 
FILE
 *
	$p›í
 (
__c⁄°
 *
__comm™d
, __c⁄° *
__modes
Ë
__wur
;

850 
	`p˛o£
 (
FILE
 *
__°ªam
);

854 #ifdef 
__USE_POSIX


856 *
	$˘îmid
 (*
__s
Ë
__THROW
;

860 #ifde‡
__USE_XOPEN


862 *
	`cu£rid
 (*
__s
);

866 #ifdef 
__USE_GNU


867 
ob°ack
;

870 
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

871 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...)

872 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

873 
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

874 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

875 
_G_va_li°
 
__¨gs
)

876 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

880 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


884 
	$Êockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

888 
	$·rylockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

891 
	$fu∆ockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

894 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


898 
	#__√ed_gë›t


	)

899 
	~<gë›t.h
>

904 #ifde‡
__USE_EXTERN_INLINES


905 
	~<bôs/°dio.h
>

907 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


908 
	~<bôs/°dio2.h
>

910 #ifde‡
__LDBL_COMPAT


911 
	~<bôs/°dio-ldbl.h
>

914 
__END_DECLS


	@/usr/include/stdlib.h

23 #i‚def 
_STDLIB_H


25 
	~<„©uªs.h
>

28 
	#__√ed_size_t


	)

29 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


30 
	#__√ed_wch¨_t


	)

31 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	g__BEGIN_DECLS


37 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


38 
	#_STDLIB_H
 1

	)

40 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
_SYS_WAIT_H


42 
	~<bôs/waôÊags.h
>

43 
	~<bôs/waô°©us.h
>

45 #ifde‡
__USE_BSD


50 #i‡
deföed
 
__GNUC__
 && !deföed 
__˝lu•lus


51 
	#__WAIT_INT
(
°©us
) \

52 (
	`__exãnsi⁄__
 ({ uni⁄ { 
	`__ty≥of
(
°©us
Ë
__ö
; 
__i
; } 
__u
; \

53 
__u
.
__ö
 = (
°©us
); __u.
__i
; }))

	)

55 
	#__WAIT_INT
(
°©us
Ë(*(*Ë&(°©us))

	)

63 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2 || deföed 
__˝lu•lus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
waô
 *
	m__u±r
;

71 *
	m__ùå
;

72 } 
	t__WAIT_STATUS
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
°©us
Ë(°©us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
(
	`__WAIT_INT
(°©us))

	)

86 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
(
	`__WAIT_INT
(°©us))

	)

87 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
(
	`__WAIT_INT
(°©us))

	)

88 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
(
	`__WAIT_INT
(°©us))

	)

89 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
(
	`__WAIT_INT
(°©us))

	)

90 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
(
	`__WAIT_INT
(°©us))

	)

91 #ifde‡
__WIFCONTINUED


92 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
(
	`__WAIT_INT
(°©us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mquŸ
;

101 
	mªm
;

102 } 
	tdiv_t
;

105 #i‚de‡
__ldiv_t_deföed


108 
	mquŸ
;

109 
	mªm
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_deföed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


116 
__BEGIN_NAMESPACE_C99


118 
__exãnsi⁄__
 struct

120 
	mquŸ
;

121 
	mªm
;

122 } 
	tŒdiv_t
;

123 
	#__Œdiv_t_deföed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

140 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$©of
 (
__c⁄°
 *
__≈å
)

146 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

148 
	$©oi
 (
__c⁄°
 *
__≈å
)

149 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

151 
	$©ﬁ
 (
__c⁄°
 *
__≈å
)

152 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

153 
__END_NAMESPACE_STD


155 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__exãnsi⁄__
 
	$©ﬁl
 (
__c⁄°
 *
__≈å
)

159 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$°πod
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

166 **
__ª°ri˘
 
__íd±r
)

167 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$°πof
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

174 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

176 
	$°πﬁd
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

177 **
__ª°ri˘
 
__íd±r
)

178 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$°πﬁ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

185 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

186 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

188 
	$°πoul
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

189 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

190 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

191 
__END_NAMESPACE_STD


193 #i‡
deföed
 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_BSD


195 
__exãnsi⁄__


196 
	$°πoq
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

197 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

198 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

200 
__exãnsi⁄__


201 
	$°πouq
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

202 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

203 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

206 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__exãnsi⁄__


210 
	$°πﬁl
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

211 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

212 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

214 
__exãnsi⁄__


215 
	$°πouŒ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

216 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

217 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

218 
__END_NAMESPACE_C99


222 #ifde‡
__USE_GNU


236 
	~<xloˇÀ.h
>

240 
	$°πﬁ_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

241 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

242 
__loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

244 
	$°πoul_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

245 **
__ª°ri˘
 
__íd±r
,

246 
__ba£
, 
__loˇÀ_t
 
__loc
)

247 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

249 
__exãnsi⁄__


250 
	$°πﬁl_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

251 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

252 
__loˇÀ_t
 
__loc
)

253 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

255 
__exãnsi⁄__


256 
	$°πouŒ_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

257 **
__ª°ri˘
 
__íd±r
,

258 
__ba£
, 
__loˇÀ_t
 
__loc
)

259 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

261 
	$°πod_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

262 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

263 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

265 
	$°πof_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

266 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

267 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

269 
	$°πﬁd_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

270 **
__ª°ri˘
 
__íd±r
,

271 
__loˇÀ_t
 
__loc
)

272 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

276 #ifde‡
__USE_EXTERN_INLINES


277 
__BEGIN_NAMESPACE_STD


278 
__exã∫_ölöe
 

279 
	`__NTH
 (
	$©of
 (
__c⁄°
 *
__≈å
))

281  
	`°πod
 (
__≈å
, (**Ë
NULL
);

282 
	}
}

283 
__exã∫_ölöe
 

284 
__NTH
 (
	$©oi
 (
__c⁄°
 *
__≈å
))

286  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

287 
	}
}

288 
__exã∫_ölöe
 

289 
__NTH
 (
	$©ﬁ
 (
__c⁄°
 *
__≈å
))

291  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

292 
	}
}

293 
	g__END_NAMESPACE_STD


295 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


296 
__BEGIN_NAMESPACE_C99


297 
__exãnsi⁄__
 
__exã∫_ölöe
 

298 
__NTH
 (
	$©ﬁl
 (
__c⁄°
 *
__≈å
))

300  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

301 
	}
}

302 
	g__END_NAMESPACE_C99


307 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


311 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

314 
	$a64l
 (
__c⁄°
 *
__s
)

315 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

319 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_BSD


320 
	~<sys/ty≥s.h
>

327 
	$øndom
 (Ë
__THROW
;

330 
	$§™dom
 (
__£ed
Ë
__THROW
;

336 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

337 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

341 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

344 #ifde‡
__USE_MISC


349 
	søndom_d©a


351 
öt32_t
 *
Âå
;

352 
öt32_t
 *
Ωå
;

353 
öt32_t
 *
°©e
;

354 
ønd_ty≥
;

355 
ønd_deg
;

356 
ønd_£p
;

357 
öt32_t
 *
íd_±r
;

360 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

361 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

363 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

364 
__THROW
 
	`__n⁄nuŒ
 ((2));

366 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

367 
size_t
 
__°©ñí
,

368 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

369 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

371 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

372 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

373 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

378 
__BEGIN_NAMESPACE_STD


380 
	$ønd
 (Ë
__THROW
;

382 
	$§™d
 (
__£ed
Ë
__THROW
;

383 
__END_NAMESPACE_STD


385 #ifde‡
__USE_POSIX


387 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

391 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


395 
	$dønd48
 (Ë
__THROW
;

396 
	$î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

399 
	$Ã™d48
 (Ë
__THROW
;

400 
	$ƒ™d48
 (
__xsubi
[3])

401 
__THROW
 
	`__n⁄nuŒ
 ((1));

404 
	$mønd48
 (Ë
__THROW
;

405 
	$jønd48
 (
__xsubi
[3])

406 
__THROW
 
	`__n⁄nuŒ
 ((1));

409 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

410 *
	$£ed48
 (
__£ed16v
[3])

411 
__THROW
 
	`__n⁄nuŒ
 ((1));

412 
	$lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

414 #ifde‡
__USE_MISC


418 
	sdønd48_d©a


420 
__x
[3];

421 
__ﬁd_x
[3];

422 
__c
;

423 
__öô
;

424 
__a
;

428 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

429 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

430 
	$î™d48_r
 (
__xsubi
[3],

431 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

432 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

435 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

436 *
__ª°ri˘
 
__ªsu…
)

437 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

438 
	$ƒ™d48_r
 (
__xsubi
[3],

439 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

440 *
__ª°ri˘
 
__ªsu…
)

441 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

444 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

445 *
__ª°ri˘
 
__ªsu…
)

446 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

447 
	$jønd48_r
 (
__xsubi
[3],

448 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

449 *
__ª°ri˘
 
__ªsu…
)

450 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

453 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

454 
__THROW
 
	`__n⁄nuŒ
 ((2));

456 
	$£ed48_r
 (
__£ed16v
[3],

457 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

459 
	$lc⁄g48_r
 (
__∑øm
[7],

460 
dønd48_d©a
 *
__buf„r
)

461 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

467 #i‚de‡
__mÆloc_™d_ˇŒoc_deföed


468 
	#__mÆloc_™d_ˇŒoc_deföed


	)

469 
__BEGIN_NAMESPACE_STD


471 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

473 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

474 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

475 
__END_NAMESPACE_STD


478 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


479 
__BEGIN_NAMESPACE_STD


485 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

486 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
;

488 
	$‰ì
 (*
__±r
Ë
__THROW
;

489 
__END_NAMESPACE_STD


491 #ifdef 
__USE_MISC


493 
	$c‰ì
 (*
__±r
Ë
__THROW
;

496 #i‡
deföed
 
__USE_GNU
 || deföed 
__USE_BSD
 || deföed 
__USE_MISC


497 
	~<Æloˇ.h
>

500 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


502 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

505 #ifde‡
__USE_XOPEN2K


507 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

508 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

511 
__BEGIN_NAMESPACE_STD


513 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

517 
	`©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

518 
__END_NAMESPACE_STD


520 #ifdef 
__USE_MISC


523 
	`⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

524 
__THROW
 
	`__n⁄nuŒ
 ((1));

527 
__BEGIN_NAMESPACE_STD


531 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

532 
__END_NAMESPACE_STD


534 #ifde‡
__USE_ISOC99


535 
__BEGIN_NAMESPACE_C99


538 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

539 
__END_NAMESPACE_C99


543 
__BEGIN_NAMESPACE_STD


545 *
	$gëív
 (
__c⁄°
 *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

546 
__END_NAMESPACE_STD


550 *
	$__£cuª_gëív
 (
__c⁄°
 *
__«me
)

551 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

553 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


557 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

560 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


563 
	$£ãnv
 (
__c⁄°
 *
__«me
, __c⁄° *
__vÆue
, 
__ª∂a˚
)

564 
__THROW
 
	`__n⁄nuŒ
 ((2));

567 
	$un£ãnv
 (
__c⁄°
 *
__«me
Ë
__THROW
;

570 #ifdef 
__USE_MISC


574 
	$˛óªnv
 (Ë
__THROW
;

578 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


583 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

593 #i‚de‡
__USE_FILE_OFFSET64


594 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

596 #ifde‡
__REDIRECT


597 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

598 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

600 
	#mk°emp
 
mk°emp64


	)

603 #ifde‡
__USE_LARGEFILE64


604 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

608 #ifde‡
__USE_BSD


614 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

617 #ifde‡
__USE_GNU


624 #i‚de‡
__USE_FILE_OFFSET64


625 
	$mko°emp
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

627 #ifde‡
__REDIRECT


628 
	`__REDIRECT
 (
mko°emp
, (*
__ãm∂©e
, 
__Êags
), 
mko°emp64
)

629 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

631 
	#mko°emp
 
mko°emp64


	)

634 #ifde‡
__USE_LARGEFILE64


635 
	$mko°emp64
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

640 
__BEGIN_NAMESPACE_STD


645 
	$sy°em
 (
__c⁄°
 *
__comm™d
Ë
__wur
;

646 
__END_NAMESPACE_STD


649 #ifdef 
__USE_GNU


652 *
	$ˇn⁄iˇlize_fûe_«me
 (
__c⁄°
 *
__«me
)

653 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

656 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


662 *
	$ªÆ∑th
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

663 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

668 #i‚de‡
__COMPAR_FN_T


669 
	#__COMPAR_FN_T


	)

670 (*
	t__com∑r_‚_t
Ë(
	t__c⁄°
 *, __const *);

672 #ifdef 
__USE_GNU


673 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

676 #ifde‡
__USE_GNU


677 (*
	t__com∑r_d_‚_t
Ë(
	t__c⁄°
 *, __const *, *);

680 
__BEGIN_NAMESPACE_STD


683 *
	$b£¨ch
 (
__c⁄°
 *
__key
, __c⁄° *
__ba£
,

684 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

685 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

689 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

690 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

691 #ifde‡
__USE_GNU


692 
	$qs‹t_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

693 
__com∑r_d_‚_t
 
__com∑r
, *
__¨g
)

694 
	`__n⁄nuŒ
 ((1, 4));

699 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

700 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

701 
__END_NAMESPACE_STD


703 #ifde‡
__USE_ISOC99


704 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

705 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

709 
__BEGIN_NAMESPACE_STD


713 
div_t
 
	$div
 (
__numî
, 
__díom
)

714 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

715 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

716 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

717 
__END_NAMESPACE_STD


719 #ifde‡
__USE_ISOC99


720 
__BEGIN_NAMESPACE_C99


721 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

722 
__díom
)

723 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

724 
__END_NAMESPACE_C99


728 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


735 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

736 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

741 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

742 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

747 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

748 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

751 #ifde‡
__USE_MISC


753 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

754 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

755 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

756 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

757 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

758 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

759 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

760 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

765 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

766 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

767 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

768 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

769 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

770 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

772 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

773 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

774 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

775 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

776 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

777 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

778 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

779 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

784 
__BEGIN_NAMESPACE_STD


787 
	$mbÀn
 (
__c⁄°
 *
__s
, 
size_t
 
__n
Ë
__THROW
 
__wur
;

790 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

791 
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
 
__wur
;

794 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
 
__wur
;

798 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

799 
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

801 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

802 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

803 
__THROW
;

804 
__END_NAMESPACE_STD


807 #ifde‡
__USE_SVID


812 
	$Ωm©ch
 (
__c⁄°
 *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

816 #ifde‡
__USE_XOPEN_EXTENDED


823 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

824 *
__c⁄°
 *
__ª°ri˘
 
__tokís
,

825 **
__ª°ri˘
 
__vÆuï
)

826 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

830 #ifde‡
__USE_XOPEN


832 
	$£tkey
 (
__c⁄°
 *
__key
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

838 #ifde‡
__USE_XOPEN2K


840 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

843 #ifde‡
__USE_XOPEN


848 
	$gø¡±
 (
__fd
Ë
__THROW
;

852 
	$u∆ock±
 (
__fd
Ë
__THROW
;

857 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

860 #ifde‡
__USE_GNU


864 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

865 
__THROW
 
	`__n⁄nuŒ
 ((2));

868 
	`gë±
 ();

871 #ifde‡
__USE_BSD


875 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

876 
__THROW
 
	`__n⁄nuŒ
 ((1));

881 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


882 
	~<bôs/°dlib.h
>

884 #ifde‡
__LDBL_COMPAT


885 
	~<bôs/°dlib-ldbl.h
>

889 #unde‡
__√ed_mÆloc_™d_ˇŒoc


891 
__END_DECLS


	@/usr/include/string.h

23 #i‚def 
_STRING_H


24 
	#_STRING_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

36 
__BEGIN_NAMESPACE_STD


38 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
,

39 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

40 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

43 *
	$memmove
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
)

44 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

45 
__END_NAMESPACE_STD


50 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN


51 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

52 
__c
, 
size_t
 
__n
)

53 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

57 
__BEGIN_NAMESPACE_STD


59 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

62 
	$memcmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

63 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

66 *
	$memchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
)

67 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

68 
__END_NAMESPACE_STD


70 #ifde‡
__USE_GNU


73 *
	$øwmemchr
 (
__c⁄°
 *
__s
, 
__c
)

74 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

77 *
	$memrchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

82 
__BEGIN_NAMESPACE_STD


84 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
)

85 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

87 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

88 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

89 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

92 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
)

93 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

95 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

96 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

99 
	$°rcmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

100 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

102 
	$°∫cmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

103 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

106 
	$°rcﬁl
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

107 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

109 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

110 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

111 
__THROW
 
	`__n⁄nuŒ
 ((2));

112 
__END_NAMESPACE_STD


114 #ifde‡
__USE_GNU


118 
	~<xloˇÀ.h
>

121 
	$°rcﬁl_l
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
__loˇÀ_t
 
__l
)

122 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

124 
size_t
 
	$°rx‰m_l
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
,

125 
__loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

128 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


130 *
	$°rdup
 (
__c⁄°
 *
__s
)

131 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

137 #i‡
deföed
 
__USE_GNU


138 *
	$°∫dup
 (
__c⁄°
 *
__°rög
, 
size_t
 
__n
)

139 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

142 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


144 
	#°rdu∑
(
s
) \

145 (
__exãnsi⁄__
 \

147 
__c⁄°
 *
__ﬁd
 = (
s
); \

148 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

149 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

150 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

151 
	}
}))

	)

154 
	#°∫du∑
(
s
, 
n
) \

155 (
__exãnsi⁄__
 \

157 
__c⁄°
 *
__ﬁd
 = (
s
); \

158 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

159 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

160 
__√w
[
__Àn
] = '\0'; \

161 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

162 }))

	)

165 
__BEGIN_NAMESPACE_STD


167 *
	$°rchr
 (
__c⁄°
 *
__s
, 
__c
)

168 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

170 *
	$°ºchr
 (
__c⁄°
 *
__s
, 
__c
)

171 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

172 
__END_NAMESPACE_STD


174 #ifde‡
__USE_GNU


177 *
	$°rch∫ul
 (
__c⁄°
 *
__s
, 
__c
)

178 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

181 
__BEGIN_NAMESPACE_STD


184 
size_t
 
	$°rc•n
 (
__c⁄°
 *
__s
, __c⁄° *
__ªje˘
)

185 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

188 
size_t
 
	$°r•n
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
)

189 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

191 *
	$°Ωbrk
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
)

192 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

194 *
	$°r°r
 (
__c⁄°
 *
__hay°ack
, __c⁄° *
__√edÀ
)

195 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

199 *
	$°πok
 (*
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__dñim
)

200 
__THROW
 
	`__n⁄nuŒ
 ((2));

201 
__END_NAMESPACE_STD


205 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

206 
__c⁄°
 *
__ª°ri˘
 
__dñim
,

207 **
__ª°ri˘
 
__ßve_±r
)

208 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

209 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


210 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__dñim
,

211 **
__ª°ri˘
 
__ßve_±r
)

212 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

215 #ifde‡
__USE_GNU


217 *
	$°rˇ£°r
 (
__c⁄°
 *
__hay°ack
, __c⁄° *
__√edÀ
)

218 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

221 #ifde‡
__USE_GNU


225 *
	$memmem
 (
__c⁄°
 *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

226 
__c⁄°
 *
__√edÀ
, 
size_t
 
__√edÀÀn
)

227 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3));

231 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

232 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

233 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

234 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

235 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

236 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

240 
__BEGIN_NAMESPACE_STD


242 
size_t
 
	$°æí
 (
__c⁄°
 *
__s
)

243 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

244 
__END_NAMESPACE_STD


246 #ifdef 
__USE_GNU


249 
size_t
 
	$°∫Àn
 (
__c⁄°
 *
__°rög
, 
size_t
 
__maxÀn
)

250 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

254 
__BEGIN_NAMESPACE_STD


256 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

257 
__END_NAMESPACE_STD


258 #i‡
deföed
 
__USE_XOPEN2K
 || deföed 
__USE_MISC


266 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


269 #ifde‡
__REDIRECT_NTH


270 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

271 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

272 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2));

274 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

275 
__THROW
 
	`__n⁄nuŒ
 ((2));

276 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

281 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

282 
__THROW
 
	`__n⁄nuŒ
 ((2));

286 #ifde‡
__USE_GNU


288 *
	$°ªº‹_l
 (
__î∫um
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

294 
	$__bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

296 #ifde‡
__USE_BSD


298 
	$bc›y
 (
__c⁄°
 *
__§c
, *
__de°
, 
size_t
 
__n
)

299 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

302 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

305 
	$bcmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

306 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

309 *
	$ödex
 (
__c⁄°
 *
__s
, 
__c
)

310 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

313 *
	$rödex
 (
__c⁄°
 *
__s
, 
__c
)

314 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

318 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

322 #ifdef 
__USE_GNU


323 
	$ff¶
 (
__l
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

324 #ifde‡
__GNUC__


325 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

326 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

331 
	$°rˇ£cmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

332 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

335 
	$°∫ˇ£cmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

336 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

339 #ifdef 
__USE_GNU


342 
	$°rˇ£cmp_l
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
,

343 
__loˇÀ_t
 
__loc
)

344 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

346 
	$°∫ˇ£cmp_l
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
,

347 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

348 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

351 #ifdef 
__USE_BSD


354 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

355 
__c⁄°
 *
__ª°ri˘
 
__dñim
)

356 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

359 #ifdef 
__USE_GNU


361 
	$°rvîscmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

362 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

365 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

368 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
)

369 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

370 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
)

371 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

375 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

376 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

377 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

378 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

379 
__c⁄°
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

380 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

383 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

386 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

388 #i‚de‡
ba£«me


393 *
	$ba£«me
 (
__c⁄°
 *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

398 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

399 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__OPTIMIZE_SIZE__
 \

400 && !
deföed
 
__NO_INLINE__
 && !deföed 
__˝lu•lus


420 
	~<bôs/°rög.h
>

423 
	~<bôs/°rög2.h
>

426 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


428 
	~<bôs/°rög3.h
>

432 
__END_DECLS


	@/usr/include/sys/ioctl.h

19 #i‚def 
_SYS_IOCTL_H


20 
	#_SYS_IOCTL_H
 1

	)

22 
	~<„©uªs.h
>

24 
	g__BEGIN_DECLS


27 
	~<bôs/io˘ls.h
>

30 
	~<bôs/io˘l-ty≥s.h
>

37 
	~<sys/âydeÁu…s.h
>

42 
	$io˘l
 (
__fd
, 
__ªque°
, ...Ë
__THROW
;

44 
__END_DECLS


	@/usr/include/sys/mman.h

20 #i‚def 
_SYS_MMAN_H


21 
	#_SYS_MMAN_H
 1

	)

23 
	~<„©uªs.h
>

24 
	~<bôs/ty≥s.h
>

25 
	#__√ed_size_t


	)

26 
	~<°ddef.h
>

28 #i‚de‡
__off_t_deföed


29 #i‚de‡
__USE_FILE_OFFSET64


30 
__off_t
 
	toff_t
;

32 
__off64_t
 
	toff_t
;

34 
	#__off_t_deföed


	)

37 #i‚de‡
__mode_t_deföed


38 
__mode_t
 
	tmode_t
;

39 
	#__mode_t_deföed


	)

42 
	~<bôs/mm™.h
>

45 
	#MAP_FAILED
 ((*Ë-1)

	)

47 
	g__BEGIN_DECLS


57 #i‚de‡
__USE_FILE_OFFSET64


58 *
	$mm≠
 (*
__addr
, 
size_t
 
__Àn
, 
__¥Ÿ
,

59 
__Êags
, 
__fd
, 
__off_t
 
__off£t
Ë
__THROW
;

61 #ifde‡
__REDIRECT_NTH


62 * 
	`__REDIRECT_NTH
 (
mm≠
,

63 (*
__addr
, 
size_t
 
__Àn
, 
__¥Ÿ
,

64 
__Êags
, 
__fd
, 
__off64_t
 
__off£t
),

65 
mm≠64
);

67 
	#mm≠
 
mm≠64


	)

70 #ifde‡
__USE_LARGEFILE64


71 *
	$mm≠64
 (*
__addr
, 
size_t
 
__Àn
, 
__¥Ÿ
,

72 
__Êags
, 
__fd
, 
__off64_t
 
__off£t
Ë
__THROW
;

77 
	$munm≠
 (*
__addr
, 
size_t
 
__Àn
Ë
__THROW
;

82 
	$m¥Ÿe˘
 (*
__addr
, 
size_t
 
__Àn
, 
__¥Ÿ
Ë
__THROW
;

90 
	`msync
 (*
__addr
, 
size_t
 
__Àn
, 
__Êags
);

92 #ifde‡
__USE_BSD


95 
	$madvi£
 (*
__addr
, 
size_t
 
__Àn
, 
__advi˚
Ë
__THROW
;

97 #ifde‡
__USE_XOPEN2K


99 
	$posix_madvi£
 (*
__addr
, 
size_t
 
__Àn
, 
__advi˚
Ë
__THROW
;

104 
	$mlock
 (
__c⁄°
 *
__addr
, 
size_t
 
__Àn
Ë
__THROW
;

107 
	$mu∆ock
 (
__c⁄°
 *
__addr
, 
size_t
 
__Àn
Ë
__THROW
;

112 
	$mlockÆl
 (
__Êags
Ë
__THROW
;

116 
	$mu∆ockÆl
 (Ë
__THROW
;

118 #ifde‡
__USE_MISC


124 
	$möc‹e
 (*
__°¨t
, 
size_t
 
__Àn
, *
__vec
)

125 
__THROW
;

128 #ifde‡
__USE_GNU


134 *
	$mªm≠
 (*
__addr
, 
size_t
 
__ﬁd_Àn
, size_à
__√w_Àn
,

135 
__Êags
, ...Ë
__THROW
;

139 
	$ªm≠_fûe_∑ges
 (*
__°¨t
, 
size_t
 
__size
, 
__¥Ÿ
,

140 
size_t
 
__pgoff
, 
__Êags
Ë
__THROW
;

145 
	`shm_›í
 (
__c⁄°
 *
__«me
, 
__oÊag
, 
mode_t
 
__mode
);

148 
	`shm_u∆ök
 (
__c⁄°
 *
__«me
);

150 
__END_DECLS


	@/usr/include/sys/select.h

22 #i‚de‡
_SYS_SELECT_H


23 
	#_SYS_SELECT_H
 1

	)

25 
	~<„©uªs.h
>

28 
	~<bôs/ty≥s.h
>

31 
	~<bôs/£À˘.h
>

34 
	~<bôs/sig£t.h
>

36 #i‚de‡
__sig£t_t_deföed


37 
	#__sig£t_t_deföed


	)

38 
__sig£t_t
 
	tsig£t_t
;

42 
	#__√ed_time_t


	)

43 
	#__√ed_time•ec


	)

44 
	~<time.h
>

45 
	#__√ed_timevÆ


	)

46 
	~<bôs/time.h
>

48 #i‚de‡
__su£c⁄ds_t_deföed


49 
__su£c⁄ds_t
 
	tsu£c⁄ds_t
;

50 
	#__su£c⁄ds_t_deföed


	)

55 
	t__fd_mask
;

58 #unde‡
__NFDBITS


59 #unde‡
__FDELT


60 #unde‡
__FDMASK


62 
	#__NFDBITS
 (8 *  (
__fd_mask
))

	)

63 
	#__FDELT
(
d
Ë((dË/ 
__NFDBITS
)

	)

64 
	#__FDMASK
(
d
Ë((
__fd_mask
Ë1 << ((dË% 
__NFDBITS
))

	)

71 #ifde‡
__USE_XOPEN


72 
__fd_mask
 
	mfds_bôs
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
Ë((£t)->
fds_bôs
)

	)

75 
__fd_mask
 
	m__fds_bôs
[
__FD_SETSIZE
 / 
__NFDBITS
];

76 
	#__FDS_BITS
(
£t
Ë((£t)->
__fds_bôs
)

	)

78 } 
	tfd_£t
;

81 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

83 #ifde‡
__USE_MISC


85 
__fd_mask
 
	tfd_mask
;

88 
	#NFDBITS
 
__NFDBITS


	)

93 
	#FD_SET
(
fd
, 
fd£ç
Ë
	`__FD_SET
 (fd, fd£ç)

	)

94 
	#FD_CLR
(
fd
, 
fd£ç
Ë
	`__FD_CLR
 (fd, fd£ç)

	)

95 
	#FD_ISSET
(
fd
, 
fd£ç
Ë
	`__FD_ISSET
 (fd, fd£ç)

	)

96 
	#FD_ZERO
(
fd£ç
Ë
	`__FD_ZERO
 (fd£ç)

	)

99 
__BEGIN_DECLS


109 
£À˘
 (
__nfds
, 
fd_£t
 *
__ª°ri˘
 
__ªadfds
,

110 
fd_£t
 *
__ª°ri˘
 
__wrôefds
,

111 
fd_£t
 *
__ª°ri˘
 
__ex˚±fds
,

112 
timevÆ
 *
__ª°ri˘
 
__timeout
);

114 #ifde‡
__USE_XOPEN2K


121 
p£À˘
 (
__nfds
, 
fd_£t
 *
__ª°ri˘
 
__ªadfds
,

122 
fd_£t
 *
__ª°ri˘
 
__wrôefds
,

123 
fd_£t
 *
__ª°ri˘
 
__ex˚±fds
,

124 c⁄° 
time•ec
 *
__ª°ri˘
 
__timeout
,

125 c⁄° 
__sig£t_t
 *
__ª°ri˘
 
__sigmask
);

128 
	g__END_DECLS


	@/usr/include/sys/socket.h

21 #i‚def 
_SYS_SOCKET_H


22 
	#_SYS_SOCKET_H
 1

	)

24 
	~<„©uªs.h
>

26 
	g__BEGIN_DECLS


28 
	~<sys/uio.h
>

29 
	#__√ed_size_t


	)

30 
	~<°ddef.h
>

36 
	~<bôs/sockë.h
>

38 #ifde‡
__USE_BSD


41 
	sosockaddr


43 
	mß_Ámûy
;

44 
	mß_d©a
[14];

52 
	mSHUT_RD
 = 0,

53 
	#SHUT_RD
 
SHUT_RD


	)

54 
	mSHUT_WR
,

55 
	#SHUT_WR
 
SHUT_WR


	)

56 
	mSHUT_RDWR


57 
	#SHUT_RDWR
 
SHUT_RDWR


	)

66 #i‡
deföed
 
__˝lu•lus
 || !
__GNUC_PREREQ
 (2, 7Ë|| !deföed 
__USE_GNU


67 
	#__SOCKADDR_ARG
 
sockaddr
 *
__ª°ri˘


	)

68 
	#__CONST_SOCKADDR_ARG
 
__c⁄°
 
sockaddr
 *

	)

72 
	#__SOCKADDR_ALLTYPES
 \

73 
	`__SOCKADDR_ONETYPE
 (
sockaddr
) \

74 
	`__SOCKADDR_ONETYPE
 (
sockaddr_©
) \

75 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ax25
) \

76 
	`__SOCKADDR_ONETYPE
 (
sockaddr_dl
) \

77 
	`__SOCKADDR_ONETYPE
 (
sockaddr_e⁄
) \

78 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ö
) \

79 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ö6
) \

80 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ö¨p
) \

81 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ùx
) \

82 
	`__SOCKADDR_ONETYPE
 (
sockaddr_iso
) \

83 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ns
) \

84 
	`__SOCKADDR_ONETYPE
 (
sockaddr_un
) \

85 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x25
)

	)

87 
	#__SOCKADDR_ONETYPE
(
ty≥
Ëty≥ *
__ª°ri˘
 
__
##ty≥##__;

	)

88 uni⁄ { 
	m__SOCKADDR_ALLTYPES


89 } 
	t__SOCKADDR_ARG
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

90 #unde‡
__SOCKADDR_ONETYPE


91 
	#__SOCKADDR_ONETYPE
(
ty≥
Ë
__c⁄°
 ty≥ *
__ª°ri˘
 
__
##ty≥##__;

	)

92 uni⁄ { 
	m__SOCKADDR_ALLTYPES


93 } 
	t__CONST_SOCKADDR_ARG
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

94 #unde‡
__SOCKADDR_ONETYPE


101 
	$sockë
 (
__domaö
, 
__ty≥
, 
__¥Ÿocﬁ
Ë
__THROW
;

107 
	$sockë∑ú
 (
__domaö
, 
__ty≥
, 
__¥Ÿocﬁ
,

108 
__fds
[2]Ë
__THROW
;

111 
	$böd
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockÀn_t
 
__Àn
)

112 
__THROW
;

115 
	$gësock«me
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

116 
sockÀn_t
 *
__ª°ri˘
 
__Àn
Ë
__THROW
;

125 
	`c⁄√˘
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockÀn_t
 
__Àn
);

129 
	$gë≥î«me
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

130 
sockÀn_t
 *
__ª°ri˘
 
__Àn
Ë
__THROW
;

137 
ssize_t
 
	`£nd
 (
__fd
, 
__c⁄°
 *
__buf
, 
size_t
 
__n
, 
__Êags
);

144 
ssize_t
 
	`ªcv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__Êags
);

151 
ssize_t
 
	`£ndto
 (
__fd
, 
__c⁄°
 *
__buf
, 
size_t
 
__n
,

152 
__Êags
, 
__CONST_SOCKADDR_ARG
 
__addr
,

153 
sockÀn_t
 
__addr_Àn
);

162 
ssize_t
 
	`ªcv‰om
 (
__fd
, *
__ª°ri˘
 
__buf
, 
size_t
 
__n
,

163 
__Êags
, 
__SOCKADDR_ARG
 
__addr
,

164 
sockÀn_t
 *
__ª°ri˘
 
__addr_Àn
);

172 
ssize_t
 
	`£ndmsg
 (
__fd
, 
__c⁄°
 
msghdr
 *
__mesßge
,

173 
__Êags
);

180 
ssize_t
 
	`ªcvmsg
 (
__fd
, 
msghdr
 *
__mesßge
, 
__Êags
);

186 
	$gësock›t
 (
__fd
, 
__Àvñ
, 
__›äame
,

187 *
__ª°ri˘
 
__›tvÆ
,

188 
sockÀn_t
 *
__ª°ri˘
 
__›éí
Ë
__THROW
;

193 
	$£tsock›t
 (
__fd
, 
__Àvñ
, 
__›äame
,

194 
__c⁄°
 *
__›tvÆ
, 
sockÀn_t
 
__›éí
Ë
__THROW
;

200 
	$li°í
 (
__fd
, 
__n
Ë
__THROW
;

210 
	`ac˚±
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

211 
sockÀn_t
 *
__ª°ri˘
 
__addr_Àn
);

219 
	$shutdown
 (
__fd
, 
__how
Ë
__THROW
;

222 #ifde‡
__USE_XOPEN2K


224 
	$sock©m¨k
 (
__fd
Ë
__THROW
;

228 #ifde‡
__USE_MISC


232 
	$isfdty≥
 (
__fd
, 
__fdty≥
Ë
__THROW
;

237 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


238 
	~<bôs/sockë2.h
>

241 
__END_DECLS


	@/usr/include/sys/stat.h

24 #i‚def 
_SYS_STAT_H


25 
	#_SYS_STAT_H
 1

	)

27 
	~<„©uªs.h
>

29 
	~<bôs/ty≥s.h
>

31 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K
 || deföed 
__USE_MISC
 \

32 || 
deföed
 
	g__USE_ATFILE


33 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


34 
	#__√ed_time_t


	)

36 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ATFILE


37 
	#__√ed_time•ec


	)

39 
	~<time.h
>

42 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


45 #i‚de‡
__dev_t_deföed


46 
__dev_t
 
	tdev_t
;

47 
	#__dev_t_deföed


	)

50 #i‚de‡
__gid_t_deföed


51 
__gid_t
 
	tgid_t
;

52 
	#__gid_t_deföed


	)

55 #i‚de‡
__öo_t_deföed


56 #i‚de‡
__USE_FILE_OFFSET64


57 
__öo_t
 
	töo_t
;

59 
__öo64_t
 
	töo_t
;

61 
	#__öo_t_deföed


	)

64 #i‚de‡
__mode_t_deföed


65 
__mode_t
 
	tmode_t
;

66 
	#__mode_t_deföed


	)

69 #i‚de‡
__∆ök_t_deföed


70 
__∆ök_t
 
	t∆ök_t
;

71 
	#__∆ök_t_deföed


	)

74 #i‚de‡
__off_t_deföed


75 #i‚de‡
__USE_FILE_OFFSET64


76 
__off_t
 
	toff_t
;

78 
__off64_t
 
	toff_t
;

80 
	#__off_t_deföed


	)

83 #i‚de‡
__uid_t_deföed


84 
__uid_t
 
	tuid_t
;

85 
	#__uid_t_deföed


	)

89 #ifde‡
__USE_UNIX98


90 #i‚de‡
__blk˙t_t_deföed


91 #i‚de‡
__USE_FILE_OFFSET64


92 
__blk˙t_t
 
	tblk˙t_t
;

94 
__blk˙t64_t
 
	tblk˙t_t
;

96 
	#__blk˙t_t_deföed


	)

99 #i‚de‡
__blksize_t_deföed


100 
__blksize_t
 
	tblksize_t
;

101 
	#__blksize_t_deföed


	)

105 
	g__BEGIN_DECLS


107 
	~<bôs/°©.h
>

109 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


110 
	#S_IFMT
 
__S_IFMT


	)

111 
	#S_IFDIR
 
__S_IFDIR


	)

112 
	#S_IFCHR
 
__S_IFCHR


	)

113 
	#S_IFBLK
 
__S_IFBLK


	)

114 
	#S_IFREG
 
__S_IFREG


	)

115 #ifde‡
__S_IFIFO


116 
	#S_IFIFO
 
__S_IFIFO


	)

118 #ifde‡
__S_IFLNK


119 
	#S_IFLNK
 
__S_IFLNK


	)

121 #i‡(
deföed
 
__USE_BSD
 || deföed 
__USE_MISC
 || deföed 
__USE_UNIX98
) \

122 && 
deföed
 
	g__S_IFSOCK


123 
	#S_IFSOCK
 
__S_IFSOCK


	)

129 
	#__S_ISTYPE
(
mode
, 
mask
Ë(((modeË& 
__S_IFMT
Ë=(mask))

	)

131 
	#S_ISDIR
(
mode
Ë
	`__S_ISTYPE
((mode), 
__S_IFDIR
)

	)

132 
	#S_ISCHR
(
mode
Ë
	`__S_ISTYPE
((mode), 
__S_IFCHR
)

	)

133 
	#S_ISBLK
(
mode
Ë
	`__S_ISTYPE
((mode), 
__S_IFBLK
)

	)

134 
	#S_ISREG
(
mode
Ë
	`__S_ISTYPE
((mode), 
__S_IFREG
)

	)

135 #ifde‡
__S_IFIFO


136 
	#S_ISFIFO
(
mode
Ë
	`__S_ISTYPE
((mode), 
__S_IFIFO
)

	)

138 #ifde‡
__S_IFLNK


139 
	#S_ISLNK
(
mode
Ë
	`__S_ISTYPE
((mode), 
__S_IFLNK
)

	)

142 #i‡
deföed
 
__USE_BSD
 && !deföed 
__S_IFLNK


143 
	#S_ISLNK
(
mode
Ë0

	)

146 #i‡(
deföed
 
__USE_BSD
 || deföed 
__USE_UNIX98
) \

147 && 
deföed
 
	g__S_IFSOCK


148 
	#S_ISSOCK
(
mode
Ë
	`__S_ISTYPE
((mode), 
__S_IFSOCK
)

	)

155 #ifdef 
__USE_POSIX199309


156 
	#S_TYPEISMQ
(
buf
Ë
	`__S_TYPEISMQ
(buf)

	)

157 
	#S_TYPEISSEM
(
buf
Ë
	`__S_TYPEISSEM
(buf)

	)

158 
	#S_TYPEISSHM
(
buf
Ë
	`__S_TYPEISSHM
(buf)

	)

164 
	#S_ISUID
 
__S_ISUID


	)

165 
	#S_ISGID
 
__S_ISGID


	)

167 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


169 
	#S_ISVTX
 
__S_ISVTX


	)

172 
	#S_IRUSR
 
__S_IREAD


	)

173 
	#S_IWUSR
 
__S_IWRITE


	)

174 
	#S_IXUSR
 
__S_IEXEC


	)

176 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

178 #i‡
deföed
 
__USE_MISC
 && deföed 
__USE_BSD


179 
	#S_IREAD
 
S_IRUSR


	)

180 
	#S_IWRITE
 
S_IWUSR


	)

181 
	#S_IEXEC
 
S_IXUSR


	)

184 
	#S_IRGRP
 (
S_IRUSR
 >> 3Ë

	)

185 
	#S_IWGRP
 (
S_IWUSR
 >> 3Ë

	)

186 
	#S_IXGRP
 (
S_IXUSR
 >> 3Ë

	)

188 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

190 
	#S_IROTH
 (
S_IRGRP
 >> 3Ë

	)

191 
	#S_IWOTH
 (
S_IWGRP
 >> 3Ë

	)

192 
	#S_IXOTH
 (
S_IXGRP
 >> 3Ë

	)

194 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

197 #ifdef 
__USE_BSD


199 
	#ACCESSPERMS
 (
S_IRWXU
|
S_IRWXG
|
S_IRWXO
Ë

	)

200 
	#ALLPERMS
 (
S_ISUID
|
S_ISGID
|
S_ISVTX
|
S_IRWXU
|
S_IRWXG
|
S_IRWXO
)

	)

201 
	#DEFFILEMODE
 (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IWGRP
|
S_IROTH
|
S_IWOTH
)

	)

203 
	#S_BLKSIZE
 512

	)

207 #i‚de‡
__USE_FILE_OFFSET64


209 
	$°©
 (
__c⁄°
 *
__ª°ri˘
 
__fûe
,

210 
°©
 *
__ª°ri˘
 
__buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

214 
	$f°©
 (
__fd
, 
°©
 *
__buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

216 #ifde‡
__REDIRECT_NTH


217 
	`__REDIRECT_NTH
 (
°©
, (
__c⁄°
 *
__ª°ri˘
 
__fûe
,

218 
°©
 *
__ª°ri˘
 
__buf
), 
°©64
)

219 
	`__n⁄nuŒ
 ((1, 2));

220 
	`__REDIRECT_NTH
 (
f°©
, (
__fd
, 
°©
 *
__buf
), 
f°©64
)

221 
	`__n⁄nuŒ
 ((2));

223 
	#°©
 
°©64


	)

224 
	#f°©
 
f°©64


	)

227 #ifde‡
__USE_LARGEFILE64


228 
	$°©64
 (
__c⁄°
 *
__ª°ri˘
 
__fûe
,

229 
°©64
 *
__ª°ri˘
 
__buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

230 
	$f°©64
 (
__fd
, 
°©64
 *
__buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

233 #ifde‡
__USE_ATFILE


237 #i‚de‡
__USE_FILE_OFFSET64


238 
	$f°©©
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fûe
,

239 
°©
 *
__ª°ri˘
 
__buf
, 
__Êag
)

240 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

242 #ifde‡
__REDIRECT_NTH


243 
	`__REDIRECT_NTH
 (
f°©©
, (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fûe
,

244 
°©
 *
__ª°ri˘
 
__buf
,

245 
__Êag
),

246 
f°©©64
Ë
	`__n⁄nuŒ
 ((2, 3));

248 
	#f°©©
 
f°©©64


	)

252 
	$f°©©64
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fûe
,

253 
°©64
 *
__ª°ri˘
 
__buf
, 
__Êag
)

254 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

257 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


258 #i‚de‡
__USE_FILE_OFFSET64


261 
	$l°©
 (
__c⁄°
 *
__ª°ri˘
 
__fûe
,

262 
°©
 *
__ª°ri˘
 
__buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

264 #ifde‡
__REDIRECT_NTH


265 
	`__REDIRECT_NTH
 (
l°©
,

266 (
__c⁄°
 *
__ª°ri˘
 
__fûe
,

267 
°©
 *
__ª°ri˘
 
__buf
), 
l°©64
)

268 
	`__n⁄nuŒ
 ((1, 2));

270 
	#l°©
 
l°©64


	)

273 #ifde‡
__USE_LARGEFILE64


274 
	$l°©64
 (
__c⁄°
 *
__ª°ri˘
 
__fûe
,

275 
°©64
 *
__ª°ri˘
 
__buf
)

276 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

282 
	$chmod
 (
__c⁄°
 *
__fûe
, 
__mode_t
 
__mode
)

283 
__THROW
 
	`__n⁄nuŒ
 ((1));

285 #ifde‡
__USE_BSD


289 
	$lchmod
 (
__c⁄°
 *
__fûe
, 
__mode_t
 
__mode
)

290 
__THROW
 
	`__n⁄nuŒ
 ((1));

294 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


295 
	$fchmod
 (
__fd
, 
__mode_t
 
__mode
Ë
__THROW
;

298 #ifde‡
__USE_ATFILE


301 
	$fchmod©
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__mode_t
 
mode
, 
__Êag
)

302 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

309 
__mode_t
 
	$umask
 (
__mode_t
 
__mask
Ë
__THROW
;

311 #ifdef 
__USE_GNU


314 
__mode_t
 
	$gëumask
 (Ë
__THROW
;

318 
	$mkdú
 (
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
)

319 
__THROW
 
	`__n⁄nuŒ
 ((1));

321 #ifde‡
__USE_ATFILE


325 
	$mkdú©
 (
__fd
, 
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
)

326 
__THROW
 
	`__n⁄nuŒ
 ((2));

332 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


333 
	$mknod
 (
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
)

334 
__THROW
 
	`__n⁄nuŒ
 ((1));

337 #ifde‡
__USE_ATFILE


341 
	$mknod©
 (
__fd
, 
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
,

342 
__dev_t
 
__dev
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

347 
	$mkfifo
 (
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
)

348 
__THROW
 
	`__n⁄nuŒ
 ((1));

350 #ifde‡
__USE_ATFILE


354 
	$mkfifﬂt
 (
__fd
, 
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
)

355 
__THROW
 
	`__n⁄nuŒ
 ((2));

358 #ifde‡
__USE_ATFILE


361 
	$utimíßt
 (
__fd
, 
__c⁄°
 *
__∑th
,

362 
__c⁄°
 
time•ec
 
__times
[2],

363 
__Êags
)

364 
__THROW
 
	`__n⁄nuŒ
 ((2));

367 #ifde‡
__USE_GNU


370 
	$futimís
 (
__fd
, 
__c⁄°
 
time•ec
 
__times
[2]Ë
__THROW
;

388 #i‚de‡
_STAT_VER


389 
	#_STAT_VER
 0

	)

391 #i‚de‡
_MKNOD_VER


392 
	#_MKNOD_VER
 0

	)

396 #i‚de‡
__USE_FILE_OFFSET64


397 
	$__fx°©
 (
__vî
, 
__fûdes
, 
°©
 *
__°©_buf
)

398 
__THROW
 
	`__n⁄nuŒ
 ((3));

399 
	$__x°©
 (
__vî
, 
__c⁄°
 *
__fûíame
,

400 
°©
 *
__°©_buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

401 
	$__lx°©
 (
__vî
, 
__c⁄°
 *
__fûíame
,

402 
°©
 *
__°©_buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

403 
	$__fx°©©
 (
__vî
, 
__fûdes
, 
__c⁄°
 *
__fûíame
,

404 
°©
 *
__°©_buf
, 
__Êag
)

405 
__THROW
 
	`__n⁄nuŒ
 ((3, 4));

407 #ifde‡
__REDIRECT_NTH


408 
	`__REDIRECT_NTH
 (
__fx°©
, (
__vî
, 
__fûdes
,

409 
°©
 *
__°©_buf
), 
__fx°©64
)

410 
	`__n⁄nuŒ
 ((3));

411 
	`__REDIRECT_NTH
 (
__x°©
, (
__vî
, 
__c⁄°
 *
__fûíame
,

412 
°©
 *
__°©_buf
), 
__x°©64
)

413 
	`__n⁄nuŒ
 ((2, 3));

414 
	`__REDIRECT_NTH
 (
__lx°©
, (
__vî
, 
__c⁄°
 *
__fûíame
,

415 
°©
 *
__°©_buf
), 
__lx°©64
)

416 
	`__n⁄nuŒ
 ((2, 3));

417 
	`__REDIRECT_NTH
 (
__fx°©©
, (
__vî
, 
__fûdes
,

418 
__c⁄°
 *
__fûíame
,

419 
°©
 *
__°©_buf
, 
__Êag
),

420 
__fx°©©64
Ë
	`__n⁄nuŒ
 ((3, 4));

423 
	#__fx°©
 
__fx°©64


	)

424 
	#__x°©
 
__x°©64


	)

425 
	#__lx°©
 
__lx°©64


	)

429 #ifde‡
__USE_LARGEFILE64


430 
	$__fx°©64
 (
__vî
, 
__fûdes
, 
°©64
 *
__°©_buf
)

431 
__THROW
 
	`__n⁄nuŒ
 ((3));

432 
	$__x°©64
 (
__vî
, 
__c⁄°
 *
__fûíame
,

433 
°©64
 *
__°©_buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

434 
	$__lx°©64
 (
__vî
, 
__c⁄°
 *
__fûíame
,

435 
°©64
 *
__°©_buf
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

436 
	$__fx°©©64
 (
__vî
, 
__fûdes
, 
__c⁄°
 *
__fûíame
,

437 
°©64
 *
__°©_buf
, 
__Êag
)

438 
__THROW
 
	`__n⁄nuŒ
 ((3, 4));

440 
	$__xmknod
 (
__vî
, 
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
,

441 
__dev_t
 *
__dev
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

443 
	$__xmknod©
 (
__vî
, 
__fd
, 
__c⁄°
 *
__∑th
,

444 
__mode_t
 
__mode
, 
__dev_t
 *
__dev
)

445 
__THROW
 
	`__n⁄nuŒ
 ((3, 5));

447 #i‡
deföed
 
__GNUC__
 && __GNUC__ >2 && deföed 
__USE_EXTERN_INLINES


450 
__exã∫_ölöe
 

451 
	`__NTH
 (
	$°©
 (
__c⁄°
 *
__∑th
, 
°©
 *
__°©buf
))

453  
	`__x°©
 (
_STAT_VER
, 
__∑th
, 
__°©buf
);

454 
	}
}

456 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


457 
__exã∫_ölöe
 

458 
__NTH
 (
	$l°©
 (
__c⁄°
 *
__∑th
, 
°©
 *
__°©buf
))

460  
	`__lx°©
 (
_STAT_VER
, 
__∑th
, 
__°©buf
);

461 
	}
}

464 
__exã∫_ölöe
 

465 
__NTH
 (
	$f°©
 (
__fd
, 
°©
 *
__°©buf
))

467  
	`__fx°©
 (
_STAT_VER
, 
__fd
, 
__°©buf
);

468 
	}
}

470 #ifde‡
__USE_ATFILE


471 
__exã∫_ölöe
 

472 
__NTH
 (
	$f°©©
 (
__fd
, 
__c⁄°
 *
__fûíame
, 
°©
 *
__°©buf
,

473 
__Êag
))

475  
	`__fx°©©
 (
_STAT_VER
, 
__fd
, 
__fûíame
, 
__°©buf
, 
__Êag
);

476 
	}
}

479 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_BSD


480 
__exã∫_ölöe
 

481 
__NTH
 (
	$mknod
 (
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
))

483  
	`__xmknod
 (
_MKNOD_VER
, 
__∑th
, 
__mode
, &
__dev
);

484 
	}
}

487 #ifde‡
__USE_ATFILE


488 
__exã∫_ölöe
 

489 
__NTH
 (
	$mknod©
 (
__fd
, 
__c⁄°
 *
__∑th
, 
__mode_t
 
__mode
,

490 
__dev_t
 
__dev
))

492  
	`__xmknod©
 (
_MKNOD_VER
, 
__fd
, 
__∑th
, 
__mode
, &
__dev
);

493 
	}
}

496 #i‡
deföed
 
__USE_LARGEFILE64
 \

497 && (! 
deföed
 
	g__USE_FILE_OFFSET64
 \

498 || (
deföed
 
	g__REDIRECT_NTH
 && deföed 
	g__OPTIMIZE__
))

499 
__exã∫_ölöe
 

500 
__NTH
 (
	$°©64
 (
__c⁄°
 *
__∑th
, 
°©64
 *
__°©buf
))

502  
	`__x°©64
 (
_STAT_VER
, 
__∑th
, 
__°©buf
);

503 
	}
}

505 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


506 
__exã∫_ölöe
 

507 
__NTH
 (
	$l°©64
 (
__c⁄°
 *
__∑th
, 
°©64
 *
__°©buf
))

509  
	`__lx°©64
 (
_STAT_VER
, 
__∑th
, 
__°©buf
);

510 
	}
}

513 
__exã∫_ölöe
 

514 
__NTH
 (
	$f°©64
 (
__fd
, 
°©64
 *
__°©buf
))

516  
	`__fx°©64
 (
_STAT_VER
, 
__fd
, 
__°©buf
);

517 
	}
}

519 #ifde‡
__USE_GNU


520 
__exã∫_ölöe
 

521 
__NTH
 (
	$f°©©64
 (
__fd
, 
__c⁄°
 *
__fûíame
, 
°©64
 *
__°©buf
,

522 
__Êag
))

524  
	`__fx°©©64
 (
_STAT_VER
, 
__fd
, 
__fûíame
, 
__°©buf
, 
__Êag
);

525 
	}
}

532 
	g__END_DECLS


	@/usr/include/sys/time.h

20 #i‚de‡
_SYS_TIME_H


21 
	#_SYS_TIME_H
 1

	)

23 
	~<„©uªs.h
>

25 
	~<bôs/ty≥s.h
>

26 
	#__√ed_time_t


	)

27 
	~<time.h
>

28 
	#__√ed_timevÆ


	)

29 
	~<bôs/time.h
>

31 
	~<sys/£À˘.h
>

33 #i‚de‡
__su£c⁄ds_t_deföed


34 
__su£c⁄ds_t
 
	tsu£c⁄ds_t
;

35 
	#__su£c⁄ds_t_deföed


	)

39 
	g__BEGIN_DECLS


41 #ifde‡
__USE_GNU


43 
	#TIMEVAL_TO_TIMESPEC
(
tv
, 
ts
) { \

44 (
ts
)->
tv_£c
 = (
tv
)->tv_sec; \

45 (
ts
)->
tv_n£c
 = (
tv
)->
tv_u£c
 * 1000; \

46 }

	)

47 
	#TIMESPEC_TO_TIMEVAL
(
tv
, 
ts
) { \

48 (
tv
)->
tv_£c
 = (
ts
)->tv_sec; \

49 (
tv
)->
tv_u£c
 = (
ts
)->
tv_n£c
 / 1000; \

50 }

	)

54 #ifde‡
__USE_BSD


57 
	stimez⁄e


59 
	mtz_möuãswe°
;

60 
	mtz_d°time
;

63 
timez⁄e
 *
	t__ª°ri˘
 
	t__timez⁄e_±r_t
;

65 *
	t__ª°ri˘
 
	t__timez⁄e_±r_t
;

73 
	$gëtimeofday
 (
timevÆ
 *
__ª°ri˘
 
__tv
,

74 
__timez⁄e_±r_t
 
__tz
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

76 #ifde‡
__USE_BSD


79 
	$£âimeofday
 (
__c⁄°
 
timevÆ
 *
__tv
,

80 
__c⁄°
 
timez⁄e
 *
__tz
)

81 
__THROW
 
	`__n⁄nuŒ
 ((1));

87 
	$adjtime
 (
__c⁄°
 
timevÆ
 *
__dñè
,

88 
timevÆ
 *
__ﬁddñè
Ë
__THROW
;

93 
	e__ôimî_which


96 
ITIMER_REAL
 = 0,

97 
	#ITIMER_REAL
 
ITIMER_REAL


	)

99 
ITIMER_VIRTUAL
 = 1,

100 
	#ITIMER_VIRTUAL
 
ITIMER_VIRTUAL


	)

103 
ITIMER_PROF
 = 2

104 
	#ITIMER_PROF
 
ITIMER_PROF


	)

109 
	sôimîvÆ


112 
timevÆ
 
ô_öãrvÆ
;

114 
timevÆ
 
ô_vÆue
;

117 #i‡
deföed
 
__USE_GNU
 && !deföed 
__˝lu•lus


120 
__ôimî_which
 
	t__ôimî_which_t
;

122 
	t__ôimî_which_t
;

127 
	$gëôimî
 (
__ôimî_which_t
 
__which
,

128 
ôimîvÆ
 *
__vÆue
Ë
__THROW
;

133 
	$£tôimî
 (
__ôimî_which_t
 
__which
,

134 
__c⁄°
 
ôimîvÆ
 *
__ª°ri˘
 
__√w
,

135 
ôimîvÆ
 *
__ª°ri˘
 
__ﬁd
Ë
__THROW
;

140 
	$utimes
 (
__c⁄°
 *
__fûe
, __c⁄° 
timevÆ
 
__tvp
[2])

141 
__THROW
 
	`__n⁄nuŒ
 ((1));

143 #ifde‡
__USE_BSD


145 
	$lutimes
 (
__c⁄°
 *
__fûe
, __c⁄° 
timevÆ
 
__tvp
[2])

146 
__THROW
 
	`__n⁄nuŒ
 ((1));

149 
	$futimes
 (
__fd
, 
__c⁄°
 
timevÆ
 
__tvp
[2]Ë
__THROW
;

152 #ifde‡
__USE_ATFILE


156 
	$futimeßt
 (
__fd
, 
__c⁄°
 *
__fûe
,

157 
__c⁄°
 
timevÆ
 
__tvp
[2]Ë
__THROW
;

161 #ifde‡
__USE_BSD


164 
	#timîis£t
(
tvp
Ë(—vp)->
tv_£c
 || (tvp)->
tv_u£c
)

	)

165 
	#timî˛ór
(
tvp
Ë(—vp)->
tv_£c
 = (tvp)->
tv_u£c
 = 0)

	)

166 
	#timîcmp
(
a
, 
b
, 
CMP
) \

167 (((
a
)->
tv_£c
 =(
b
)->tv_sec) ? \

168 ((
a
)->
tv_u£c
 
	`CMP
 (
b
)->tv_usec) : \

169 ((
a
)->
tv_£c
 
	`CMP
 (
b
)->tv_£c))

	)

170 
	#timîadd
(
a
, 
b
, 
ªsu…
) \

172 (
ªsu…
)->
tv_£c
 = (
a
)->tv_£¯+ (
b
)->tv_sec; \

173 (
ªsu…
)->
tv_u£c
 = (
a
)->tv_u£¯+ (
b
)->tv_usec; \

174 i‡((
ªsu…
)->
tv_u£c
 >= 1000000) \

176 ++(
ªsu…
)->
tv_£c
; \

177 (
ªsu…
)->
tv_u£c
 -= 1000000; \

179 
	}
} 0)

	)

180 
	#timîsub
(
a
, 
b
, 
ªsu…
) \

182 (
ªsu…
)->
tv_£c
 = (
a
)->tv_£¯- (
b
)->tv_sec; \

183 (
ªsu…
)->
tv_u£c
 = (
a
)->tv_u£¯- (
b
)->tv_usec; \

184 i‡((
ªsu…
)->
tv_u£c
 < 0) { \

185 --(
ªsu…
)->
tv_£c
; \

186 (
ªsu…
)->
tv_u£c
 += 1000000; \

188 } 0)

	)

191 
	g__END_DECLS


	@/usr/include/sys/types.h

24 #i‚def 
_SYS_TYPES_H


25 
	#_SYS_TYPES_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


31 
	~<bôs/ty≥s.h
>

33 #ifdef 
__USE_BSD


34 #i‚de‡
__u_ch¨_deföed


35 
__u_ch¨
 
	tu_ch¨
;

36 
__u_sh‹t
 
	tu_sh‹t
;

37 
__u_öt
 
	tu_öt
;

38 
__u_l⁄g
 
	tu_l⁄g
;

39 
__quad_t
 
	tquad_t
;

40 
__u_quad_t
 
	tu_quad_t
;

41 
__fsid_t
 
	tfsid_t
;

42 
	#__u_ch¨_deföed


	)

46 
__loff_t
 
	tloff_t
;

48 #i‚de‡
__öo_t_deföed


49 #i‚de‡
__USE_FILE_OFFSET64


50 
__öo_t
 
	töo_t
;

52 
__öo64_t
 
	töo_t
;

54 
	#__öo_t_deföed


	)

56 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__öo64_t_deföed


57 
__öo64_t
 
	töo64_t
;

58 
	#__öo64_t_deföed


	)

61 #i‚de‡
__dev_t_deföed


62 
__dev_t
 
	tdev_t
;

63 
	#__dev_t_deföed


	)

66 #i‚de‡
__gid_t_deföed


67 
__gid_t
 
	tgid_t
;

68 
	#__gid_t_deföed


	)

71 #i‚de‡
__mode_t_deföed


72 
__mode_t
 
	tmode_t
;

73 
	#__mode_t_deföed


	)

76 #i‚de‡
__∆ök_t_deföed


77 
__∆ök_t
 
	t∆ök_t
;

78 
	#__∆ök_t_deföed


	)

81 #i‚de‡
__uid_t_deföed


82 
__uid_t
 
	tuid_t
;

83 
	#__uid_t_deföed


	)

86 #i‚de‡
__off_t_deföed


87 #i‚de‡
__USE_FILE_OFFSET64


88 
__off_t
 
	toff_t
;

90 
__off64_t
 
	toff_t
;

92 
	#__off_t_deföed


	)

94 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


95 
__off64_t
 
	toff64_t
;

96 
	#__off64_t_deföed


	)

99 #i‚de‡
__pid_t_deföed


100 
__pid_t
 
	tpid_t
;

101 
	#__pid_t_deföed


	)

104 #i‡(
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN
Ë&& !deföed 
__id_t_deföed


105 
__id_t
 
	tid_t
;

106 
	#__id_t_deföed


	)

109 #i‚de‡
__ssize_t_deföed


110 
__ssize_t
 
	tssize_t
;

111 
	#__ssize_t_deföed


	)

114 #ifdef 
__USE_BSD


115 #i‚de‡
__daddr_t_deföed


116 
__daddr_t
 
	tdaddr_t
;

117 
__ˇddr_t
 
	tˇddr_t
;

118 
	#__daddr_t_deföed


	)

122 #i‡(
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN
Ë&& !deföed 
__key_t_deföed


123 
__key_t
 
	tkey_t
;

124 
	#__key_t_deföed


	)

127 #ifde‡
__USE_XOPEN


128 
	#__√ed_˛ock_t


	)

130 
	#__√ed_time_t


	)

131 
	#__√ed_timî_t


	)

132 
	#__√ed_˛ockid_t


	)

133 
	~<time.h
>

135 #ifde‡
__USE_XOPEN


136 #i‚de‡
__u£c⁄ds_t_deföed


137 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

138 
	#__u£c⁄ds_t_deföed


	)

140 #i‚de‡
__su£c⁄ds_t_deföed


141 
__su£c⁄ds_t
 
	tsu£c⁄ds_t
;

142 
	#__su£c⁄ds_t_deföed


	)

146 
	#__√ed_size_t


	)

147 
	~<°ddef.h
>

149 #ifde‡
__USE_MISC


151 
	tul⁄g
;

152 
	tush‹t
;

153 
	tuöt
;

158 #i‡!
__GNUC_PREREQ
 (2, 7)

161 #i‚de‡
__öt8_t_deföed


162 
	#__öt8_t_deföed


	)

163 
	töt8_t
;

164 
	töt16_t
;

165 
	töt32_t
;

166 #i‡
__WORDSIZE
 == 64

167 
	töt64_t
;

168 #ñi‡
__GLIBC_HAVE_LONG_LONG


169 
__exãnsi⁄__
 
	töt64_t
;

174 
	tu_öt8_t
;

175 
	tu_öt16_t
;

176 
	tu_öt32_t
;

177 #i‡
__WORDSIZE
 == 64

178 
	tu_öt64_t
;

179 #ñi‡
__GLIBC_HAVE_LONG_LONG


180 
__exãnsi⁄__
 
	tu_öt64_t
;

183 
	tªgi°î_t
;

188 
	#__ötN_t
(
N
, 
MODE
) \

189 ##
	tN
##
	t_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	tMODE
)))

	)

190 
	t__u_ötN_t
(
	tN
, 
	tMODE
) \

191 
	tu_öt
##
	tN
##
	t_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	tMODE
)))

	)

193 #i‚de‡
	t__öt8_t_deföed


194 
	t__öt8_t_deföed


	)

195 
	t__ötN_t
 (8, 
	t__QI__
);

196 
__ötN_t
 (16, 
__HI__
);

197 
__ötN_t
 (32, 
__SI__
);

198 
__ötN_t
 (64, 
__DI__
);

201 
__u_ötN_t
 (8, 
__QI__
);

202 
__u_ötN_t
 (16, 
__HI__
);

203 
__u_ötN_t
 (32, 
__SI__
);

204 
__u_ötN_t
 (64, 
__DI__
);

206 
	tªgi°î_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__w‹d__
)));

212 
	#__BIT_TYPES_DEFINED__
 1

	)

215 #ifdef 
__USE_BSD


217 
	~<ídün.h
>

220 
	~<sys/£À˘.h
>

223 
	~<sys/sysma¸os.h
>

227 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__blksize_t_deföed


228 
__blksize_t
 
	tblksize_t
;

229 
	#__blksize_t_deföed


	)

233 #i‚de‡
__USE_FILE_OFFSET64


234 #i‚de‡
__blk˙t_t_deföed


235 
__blk˙t_t
 
	tblk˙t_t
;

236 
	#__blk˙t_t_deföed


	)

238 #i‚de‡
__fsblk˙t_t_deföed


239 
__fsblk˙t_t
 
	tfsblk˙t_t
;

240 
	#__fsblk˙t_t_deföed


	)

242 #i‚de‡
__fsfû˙t_t_deföed


243 
__fsfû˙t_t
 
	tfsfû˙t_t
;

244 
	#__fsfû˙t_t_deföed


	)

247 #i‚de‡
__blk˙t_t_deföed


248 
__blk˙t64_t
 
	tblk˙t_t
;

249 
	#__blk˙t_t_deföed


	)

251 #i‚de‡
__fsblk˙t_t_deföed


252 
__fsblk˙t64_t
 
	tfsblk˙t_t
;

253 
	#__fsblk˙t_t_deföed


	)

255 #i‚de‡
__fsfû˙t_t_deföed


256 
__fsfû˙t64_t
 
	tfsfû˙t_t
;

257 
	#__fsfû˙t_t_deföed


	)

261 #ifde‡
__USE_LARGEFILE64


262 
__blk˙t64_t
 
	tblk˙t64_t
;

263 
__fsblk˙t64_t
 
	tfsblk˙t64_t
;

264 
__fsfû˙t64_t
 
	tfsfû˙t64_t
;

269 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


270 
	~<bôs/±hªadty≥s.h
>

273 
	g__END_DECLS


	@/usr/include/sys/un.h

19 #i‚def 
_SYS_UN_H


20 
	#_SYS_UN_H
 1

	)

22 
	~<sys/cdefs.h
>

25 
	~<bôs/sockaddr.h
>

27 
__BEGIN_DECLS


30 
	ssockaddr_un


32 
__SOCKADDR_COMMON
 (
sun_
);

33 
	msun_∑th
[108];

37 #ifde‡
__USE_MISC


38 
	~<°rög.h
>

41 
	#SUN_LEN
(
±r
Ë((
size_t
Ë(((
sockaddr_un
 *Ë0)->
sun_∑th
) \

42 + 
	`°æí
 ((
±r
)->
sun_∑th
))

	)

45 
	g__END_DECLS


	@/usr/include/termios.h

23 #i‚def 
_TERMIOS_H


24 
	#_TERMIOS_H
 1

	)

26 
	~<„©uªs.h
>

27 #ifde‡
__USE_UNIX98


29 
	~<bôs/ty≥s.h
>

30 #i‚de‡
__pid_t_deföed


31 
__pid_t
 
	tpid_t
;

32 
	#__pid_t_deföed


	)

36 
	g__BEGIN_DECLS


40 
	~<bôs/ãrmios.h
>

42 #ifde‡
__USE_BSD


45 
	#CCEQ
(
vÆ
, 
c
Ë((cË=(vÆË&& (vÆË!
_POSIX_VDISABLE
)

	)

49 
•ìd_t
 
	$cfgëo•ìd
 (
__c⁄°
 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

52 
•ìd_t
 
	$cfgëi•ìd
 (
__c⁄°
 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

55 
	$cf£to•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

58 
	$cf£ti•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

60 #ifdef 
__USE_BSD


62 
	$cf£t•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

67 
	$tcgë©å
 (
__fd
, 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

71 
	$tc£èâr
 (
__fd
, 
__›ti⁄Æ_a˘i⁄s
,

72 
__c⁄°
 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

75 #ifdef 
__USE_BSD


77 
	$cfmakîaw
 (
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

81 
	$tc£ndbªak
 (
__fd
, 
__duøti⁄
Ë
__THROW
;

87 
	`tcdøö
 (
__fd
);

91 
	$tcÊush
 (
__fd
, 
__queue_£À˘‹
Ë
__THROW
;

95 
	$tcÊow
 (
__fd
, 
__a˘i⁄
Ë
__THROW
;

98 #ifde‡
__USE_UNIX98


100 
__pid_t
 
	$tcgësid
 (
__fd
Ë
__THROW
;

104 #ifde‡
__USE_BSD


105 
	~<sys/âydeÁu…s.h
>

108 
__END_DECLS


	@/usr/include/time.h

24 #i‚def 
_TIME_H


26 #i‡(! 
deföed
 
__√ed_time_t
 && !deföed 
__√ed_˛ock_t
 && \

27 ! 
deföed
 
	g__√ed_time•ec
)

28 
	#_TIME_H
 1

	)

29 
	~<„©uªs.h
>

31 
	g__BEGIN_DECLS


35 #ifdef 
_TIME_H


37 
	#__√ed_size_t


	)

38 
	#__√ed_NULL


	)

39 
	~<°ddef.h
>

43 
	~<bôs/time.h
>

46 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


47 #i‚de‡
CLK_TCK


48 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

54 #i‡!
deföed
 
__˛ock_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_˛ock_t
)

55 
	#__˛ock_t_deföed
 1

	)

57 
	~<bôs/ty≥s.h
>

59 
__BEGIN_NAMESPACE_STD


61 
__˛ock_t
 
	t˛ock_t
;

62 
	g__END_NAMESPACE_STD


63 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


64 
	$__USING_NAMESPACE_STD
(
˛ock_t
)

68 #unde‡
__√ed_˛ock_t


70 #i‡!
deföed
 
__time_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_time_t
)

71 
	#__time_t_deföed
 1

	)

73 
	~<bôs/ty≥s.h
>

75 
__BEGIN_NAMESPACE_STD


77 
__time_t
 
	ttime_t
;

78 
__END_NAMESPACE_STD


79 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC
 || deföed 
__USE_SVID


80 
	$__USING_NAMESPACE_STD
(
time_t
)

84 #unde‡
__√ed_time_t


86 #i‡!
deföed
 
__˛ockid_t_deföed
 && \

87 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_˛ockid_t
)

88 
	#__˛ockid_t_deföed
 1

	)

90 
	~<bôs/ty≥s.h
>

93 
__˛ockid_t
 
	t˛ockid_t
;

96 #unde‡
__˛ockid_time_t


98 #i‡!
deföed
 
__timî_t_deföed
 && \

99 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_timî_t
)

100 
	#__timî_t_deföed
 1

	)

102 
	~<bôs/ty≥s.h
>

105 
__timî_t
 
	ttimî_t
;

108 #unde‡
__√ed_timî_t


111 #i‡!
deföed
 
__time•ec_deföed
 && \

112 ((
deföed
 
_TIME_H
 && \

113 (
deföed
 
__USE_POSIX199309
 || deföed 
__USE_MISC
)) || \

114 
deföed
 
__√ed_time•ec
)

115 
	#__time•ec_deföed
 1

	)

117 
	~<bôs/ty≥s.h
>

121 
	stime•ec


123 
__time_t
 
tv_£c
;

124 
tv_n£c
;

128 #unde‡
__√ed_time•ec


131 #ifdef 
_TIME_H


132 
__BEGIN_NAMESPACE_STD


134 
	stm


136 
tm_£c
;

137 
tm_mö
;

138 
tm_hour
;

139 
tm_mday
;

140 
tm_m⁄
;

141 
tm_yór
;

142 
tm_wday
;

143 
tm_yday
;

144 
tm_isd°
;

146 #ifdef 
__USE_BSD


147 
tm_gmtoff
;

148 
__c⁄°
 *
tm_z⁄e
;

150 
__tm_gmtoff
;

151 
__c⁄°
 *
__tm_z⁄e
;

154 
__END_NAMESPACE_STD


155 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


156 
	$__USING_NAMESPACE_STD
(
tm
)

160 #ifde‡
__USE_POSIX199309


162 
	sôimî•ec


164 
time•ec
 
ô_öãrvÆ
;

165 
time•ec
 
ô_vÆue
;

169 
sigevít
;

173 #ifde‡
__USE_XOPEN2K


174 #i‚de‡
__pid_t_deföed


175 
__pid_t
 
	tpid_t
;

176 
	#__pid_t_deföed


	)

181 
__BEGIN_NAMESPACE_STD


184 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

187 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

190 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

191 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

194 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

200 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

201 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

202 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

203 
__END_NAMESPACE_STD


205 #ifde‡
__USE_XOPEN


208 *
	$°Ωtime
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

209 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

210 
__THROW
;

213 #ifde‡
__USE_GNU


216 
	~<xloˇÀ.h
>

218 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

219 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

220 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
,

221 
__loˇÀ_t
 
__loc
Ë
__THROW
;

223 *
	$°Ωtime_l
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

224 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

225 
__loˇÀ_t
 
__loc
Ë
__THROW
;

229 
__BEGIN_NAMESPACE_STD


232 
tm
 *
	$gmtime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

236 
tm
 *
	$loˇ…ime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

237 
__END_NAMESPACE_STD


239 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


242 
tm
 *
	$gmtime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

243 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

247 
tm
 *
	$loˇ…ime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

248 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

251 
__BEGIN_NAMESPACE_STD


254 *
	$as˘ime
 (
__c⁄°
 
tm
 *
__ç
Ë
__THROW
;

257 *
	$˘ime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

258 
__END_NAMESPACE_STD


260 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


265 *
	$as˘ime_r
 (
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
,

266 *
__ª°ri˘
 
__buf
Ë
__THROW
;

269 *
	$˘ime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

270 *
__ª°ri˘
 
__buf
Ë
__THROW
;

275 *
__tz«me
[2];

276 
__daylight
;

277 
__timez⁄e
;

280 #ifdef 
__USE_POSIX


282 *
tz«me
[2];

286 
	$tz£t
 (Ë
__THROW
;

289 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


290 
daylight
;

291 
timez⁄e
;

294 #ifde‡
__USE_SVID


297 
	$°ime
 (
__c⁄°
 
time_t
 *
__whí
Ë
__THROW
;

303 
	#__i¶óp
(
yór
) \

304 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

307 #ifde‡
__USE_MISC


312 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

315 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

318 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

322 #ifde‡
__USE_POSIX199309


327 
	`«no¶ìp
 (
__c⁄°
 
time•ec
 *
__ªque°ed_time
,

328 
time•ec
 *
__ªmaöög
);

332 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

335 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

338 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, 
__c⁄°
 
time•ec
 *
__ç
)

339 
__THROW
;

341 #ifde‡
__USE_XOPEN2K


346 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

347 
__c⁄°
 
time•ec
 *
__ªq
,

348 
time•ec
 *
__ªm
);

351 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

356 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

357 
sigevít
 *
__ª°ri˘
 
__evp
,

358 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

361 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

364 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

365 
__c⁄°
 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

366 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

369 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

370 
__THROW
;

373 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

377 #ifde‡
__USE_XOPEN_EXTENDED


389 
gëd©e_îr
;

398 
tm
 *
	`gëd©e
 (
__c⁄°
 *
__°rög
);

401 #ifde‡
__USE_GNU


412 
	`gëd©e_r
 (
__c⁄°
 *
__ª°ri˘
 
__°rög
,

413 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

416 
__END_DECLS


	@/usr/include/unistd.h

23 #i‚def 
_UNISTD_H


24 
	#_UNISTD_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


34 
	#_POSIX_VERSION
 200112L

	)

40 
	#_POSIX2_VERSION
 200112L

	)

44 
	#_POSIX2_C_BIND
 200112L

	)

48 
	#_POSIX2_C_DEV
 200112L

	)

52 
	#_POSIX2_SW_DEV
 200112L

	)

56 
	#_POSIX2_LOCALEDEF
 200112L

	)

59 #ifde‡
__USE_XOPEN2K


60 
	#_XOPEN_VERSION
 600

	)

61 #ñi‡
deföed
 
__USE_UNIX98


62 
	#_XOPEN_VERSION
 500

	)

64 
	#_XOPEN_VERSION
 4

	)

68 
	#_XOPEN_XCU_VERSION
 4

	)

71 
	#_XOPEN_XPG2
 1

	)

72 
	#_XOPEN_XPG3
 1

	)

73 
	#_XOPEN_XPG4
 1

	)

76 
	#_XOPEN_UNIX
 1

	)

79 
	#_XOPEN_CRYPT
 1

	)

83 
	#_XOPEN_ENH_I18N
 1

	)

86 
	#_XOPEN_LEGACY
 1

	)

173 
	~<bôs/posix_›t.h
>

176 #ifde‡
__USE_UNIX98


177 
	~<bôs/ívú⁄míts.h
>

181 
	#STDIN_FILENO
 0

	)

182 
	#STDOUT_FILENO
 1

	)

183 
	#STDERR_FILENO
 2

	)

188 
	~<bôs/ty≥s.h
>

190 #i‚def 
__ssize_t_deföed


191 
__ssize_t
 
	tssize_t
;

192 
	#__ssize_t_deföed


	)

195 
	#__√ed_size_t


	)

196 
	#__√ed_NULL


	)

197 
	~<°ddef.h
>

199 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


202 #i‚de‡
__gid_t_deföed


203 
__gid_t
 
	tgid_t
;

204 
	#__gid_t_deföed


	)

207 #i‚de‡
__uid_t_deföed


208 
__uid_t
 
	tuid_t
;

209 
	#__uid_t_deföed


	)

212 #i‚de‡
__off_t_deföed


213 #i‚de‡
__USE_FILE_OFFSET64


214 
__off_t
 
	toff_t
;

216 
__off64_t
 
	toff_t
;

218 
	#__off_t_deföed


	)

220 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


221 
__off64_t
 
	toff64_t
;

222 
	#__off64_t_deföed


	)

225 #i‚de‡
__u£c⁄ds_t_deföed


226 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

227 
	#__u£c⁄ds_t_deföed


	)

230 #i‚de‡
__pid_t_deföed


231 
__pid_t
 
	tpid_t
;

232 
	#__pid_t_deföed


	)

236 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


237 #i‚de‡
__öçå_t_deföed


238 
__öçå_t
 
	töçå_t
;

239 
	#__öçå_t_deföed


	)

243 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN


244 #i‚de‡
__sockÀn_t_deföed


245 
__sockÀn_t
 
	tsockÀn_t
;

246 
	#__sockÀn_t_deföed


	)

252 
	#R_OK
 4

	)

253 
	#W_OK
 2

	)

254 
	#X_OK
 1

	)

255 
	#F_OK
 0

	)

258 
	$ac˚ss
 (
__c⁄°
 *
__«me
, 
__ty≥
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

260 #ifde‡
__USE_GNU


263 
	$euidac˚ss
 (
__c⁄°
 *
__«me
, 
__ty≥
)

264 
__THROW
 
	`__n⁄nuŒ
 ((1));

267 
	$óc˚ss
 (
__c⁄°
 *
__«me
, 
__ty≥
)

268 
__THROW
 
	`__n⁄nuŒ
 ((1));

271 #ifde‡
__USE_ATFILE


275 
	$Ác˚sßt
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__ty≥
, 
__Êag
)

276 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

281 #i‚def 
_STDIO_H


282 
	#SEEK_SET
 0

	)

283 
	#SEEK_CUR
 1

	)

284 
	#SEEK_END
 2

	)

287 #i‡
deföed
 
__USE_BSD
 && !deföed 
L_SET


289 
	#L_SET
 
SEEK_SET


	)

290 
	#L_INCR
 
SEEK_CUR


	)

291 
	#L_XTND
 
SEEK_END


	)

300 #i‚de‡
__USE_FILE_OFFSET64


301 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__whí˚
Ë
__THROW
;

303 #ifde‡
__REDIRECT_NTH


304 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

305 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
),

306 
l£ek64
);

308 
	#l£ek
 
l£ek64


	)

311 #ifde‡
__USE_LARGEFILE64


312 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
)

313 
__THROW
;

320 
	`˛o£
 (
__fd
);

327 
ssize_t
 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
Ë
__wur
;

333 
ssize_t
 
	$wrôe
 (
__fd
, 
__c⁄°
 *
__buf
, 
size_t
 
__n
Ë
__wur
;

335 #ifde‡
__USE_UNIX98


336 #i‚de‡
__USE_FILE_OFFSET64


343 
ssize_t
 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

344 
__off_t
 
__off£t
Ë
__wur
;

351 
ssize_t
 
	$pwrôe
 (
__fd
, 
__c⁄°
 *
__buf
, 
size_t
 
__n
,

352 
__off_t
 
__off£t
Ë
__wur
;

354 #ifde‡
__REDIRECT


355 
ssize_t
 
	`__REDIRECT
 (
¥ód
, (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

356 
__off64_t
 
__off£t
),

357 
¥ód64
Ë
__wur
;

358 
ssize_t
 
	`__REDIRECT
 (
pwrôe
, (
__fd
, 
__c⁄°
 *
__buf
,

359 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
),

360 
pwrôe64
Ë
__wur
;

362 
	#¥ód
 
¥ód64


	)

363 
	#pwrôe
 
pwrôe64


	)

367 #ifde‡
__USE_LARGEFILE64


371 
ssize_t
 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

372 
__off64_t
 
__off£t
Ë
__wur
;

375 
ssize_t
 
	$pwrôe64
 (
__fd
, 
__c⁄°
 *
__buf
, 
size_t
 
__n
,

376 
__off64_t
 
__off£t
Ë
__wur
;

384 
	$pùe
 (
__pùedes
[2]Ë
__THROW
 
__wur
;

393 
	$Æ¨m
 (
__£c⁄ds
Ë
__THROW
;

405 
	`¶ìp
 (
__£c⁄ds
);

407 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


412 
__u£c⁄ds_t
 
	$uÆ¨m
 (
__u£c⁄ds_t
 
__vÆue
, __u£c⁄ds_à
__öãrvÆ
)

413 
__THROW
;

420 
	`u¶ìp
 (
__u£c⁄ds_t
 
__u£c⁄ds
);

429 
	`∑u£
 ();

433 
	$chown
 (
__c⁄°
 *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

434 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

436 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


438 
	$fchown
 (
__fd
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
Ë
__THROW
 
__wur
;

443 
	$lchown
 (
__c⁄°
 *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

444 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

448 #ifde‡
__USE_ATFILE


451 
	$fchow«t
 (
__fd
, 
__c⁄°
 *
__fûe
, 
__uid_t
 
__ow√r
,

452 
__gid_t
 
__group
, 
__Êag
)

453 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

457 
	$chdú
 (
__c⁄°
 *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

459 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


461 
	$fchdú
 (
__fd
Ë
__THROW
 
__wur
;

471 *
	$gëcwd
 (*
__buf
, 
size_t
 
__size
Ë
__THROW
 
__wur
;

473 #ifdef 
__USE_GNU


477 *
	$gë_cuºít_dú_«me
 (Ë
__THROW
;

480 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


484 *
	$gëwd
 (*
__buf
)

485 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
;

490 
	$dup
 (
__fd
Ë
__THROW
 
__wur
;

493 
	$dup2
 (
__fd
, 
__fd2
Ë
__THROW
;

496 **
__ívú⁄
;

497 #ifde‡
__USE_GNU


498 **
ívú⁄
;

504 
	$execve
 (
__c⁄°
 *
__∑th
, *__c⁄° 
__¨gv
[],

505 *
__c⁄°
 
__ívp
[]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

507 #ifde‡
__USE_GNU


510 
	$„xecve
 (
__fd
, *
__c⁄°
 
__¨gv
[], *__c⁄° 
__ívp
[])

511 
__THROW
;

516 
	$execv
 (
__c⁄°
 *
__∑th
, *__c⁄° 
__¨gv
[])

517 
__THROW
 
	`__n⁄nuŒ
 ((1));

521 
	$exe˛e
 (
__c⁄°
 *
__∑th
, __c⁄° *
__¨g
, ...)

522 
__THROW
 
	`__n⁄nuŒ
 ((1));

526 
	$exe˛
 (
__c⁄°
 *
__∑th
, __c⁄° *
__¨g
, ...)

527 
__THROW
 
	`__n⁄nuŒ
 ((1));

531 
	$execvp
 (
__c⁄°
 *
__fûe
, *__c⁄° 
__¨gv
[])

532 
__THROW
 
	`__n⁄nuŒ
 ((1));

537 
	$exe˛p
 (
__c⁄°
 *
__fûe
, __c⁄° *
__¨g
, ...)

538 
__THROW
 
	`__n⁄nuŒ
 ((1));

541 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


543 
	$ni˚
 (
__öc
Ë
__THROW
 
__wur
;

548 
	$_exô
 (
__°©us
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

554 
	~<bôs/c⁄‚ame.h
>

557 
	$∑thc⁄f
 (
__c⁄°
 *
__∑th
, 
__«me
)

558 
__THROW
 
	`__n⁄nuŒ
 ((1));

561 
	$Â©hc⁄f
 (
__fd
, 
__«me
Ë
__THROW
;

564 
	$sysc⁄f
 (
__«me
Ë
__THROW
;

566 #ifdef 
__USE_POSIX2


568 
size_t
 
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

573 
__pid_t
 
	$gëpid
 (Ë
__THROW
;

576 
__pid_t
 
	$gëµid
 (Ë
__THROW
;

580 #i‚de‡
__FAVOR_BSD


581 
__pid_t
 
	$gëpgΩ
 (Ë
__THROW
;

583 #ifde‡
__REDIRECT_NTH


584 
__pid_t
 
	`__REDIRECT_NTH
 (
gëpgΩ
, (__pid_à
__pid
), 
__gëpgid
);

586 
	#gëpgΩ
 
__gëpgid


	)

591 
__pid_t
 
	$__gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

592 #ifde‡
__USE_XOPEN_EXTENDED


593 
__pid_t
 
	$gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

600 
	$£çgid
 (
__pid_t
 
__pid
, __pid_à
__pgid
Ë
__THROW
;

602 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


613 #i‚de‡
__FAVOR_BSD


617 
	$£çgΩ
 (Ë
__THROW
;

622 #ifde‡
__REDIRECT_NTH


623 
	`__REDIRECT_NTH
 (
£çgΩ
, (
__pid_t
 
__pid
, __pid_à
__pgΩ
), 
£çgid
);

625 
	#£çgΩ
 
£çgid


	)

634 
__pid_t
 
	$£tsid
 (Ë
__THROW
;

636 #ifde‡
__USE_XOPEN_EXTENDED


638 
__pid_t
 
	$gësid
 (
__pid_t
 
__pid
Ë
__THROW
;

642 
__uid_t
 
	$gëuid
 (Ë
__THROW
;

645 
__uid_t
 
	$gëeuid
 (Ë
__THROW
;

648 
__gid_t
 
	$gëgid
 (Ë
__THROW
;

651 
__gid_t
 
	$gëegid
 (Ë
__THROW
;

656 
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]Ë
__THROW
 
__wur
;

658 #ifdef 
__USE_GNU


660 
	$group_membî
 (
__gid_t
 
__gid
Ë
__THROW
;

667 
	$£tuid
 (
__uid_t
 
__uid
Ë
__THROW
;

669 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


672 
	$£åeuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
Ë
__THROW
;

675 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


677 
	$£ãuid
 (
__uid_t
 
__uid
Ë
__THROW
;

684 
	$£tgid
 (
__gid_t
 
__gid
Ë
__THROW
;

686 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


689 
	$£åegid
 (
__gid_t
 
__rgid
, __gid_à
__egid
Ë
__THROW
;

692 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


694 
	$£ãgid
 (
__gid_t
 
__gid
Ë
__THROW
;

697 #ifde‡
__USE_GNU


700 
	$gëªsuid
 (
__uid_t
 *
__ruid
, __uid_à*
__euid
, __uid_à*
__suid
)

701 
__THROW
;

705 
	$gëªsgid
 (
__gid_t
 *
__rgid
, __gid_à*
__egid
, __gid_à*
__sgid
)

706 
__THROW
;

710 
	$£åesuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
, __uid_à
__suid
)

711 
__THROW
;

715 
	$£åesgid
 (
__gid_t
 
__rgid
, __gid_à
__egid
, __gid_à
__sgid
)

716 
__THROW
;

723 
__pid_t
 
	$f‹k
 (Ë
__THROW
;

725 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


730 
__pid_t
 
	$vf‹k
 (Ë
__THROW
;

736 *
	$ây«me
 (
__fd
Ë
__THROW
;

740 
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

741 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

745 
	$ißây
 (
__fd
Ë
__THROW
;

747 #i‡
deföed
 
__USE_BSD
 \

748 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_UNIX98
)

751 
	$ây¶Ÿ
 (Ë
__THROW
;

756 
	$lök
 (
__c⁄°
 *
__‰om
, __c⁄° *
__to
)

757 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

759 #ifde‡
__USE_ATFILE


762 
	$lök©
 (
__‰omfd
, 
__c⁄°
 *
__‰om
, 
__tofd
,

763 
__c⁄°
 *
__to
, 
__Êags
)

764 
__THROW
 
	`__n⁄nuŒ
 ((2, 4)Ë
__wur
;

767 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


769 
	$symlök
 (
__c⁄°
 *
__‰om
, __c⁄° *
__to
)

770 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

775 
ssize_t
 
	$ªadlök
 (
__c⁄°
 *
__ª°ri˘
 
__∑th
,

776 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

777 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

780 #ifde‡
__USE_ATFILE


782 
	$symlök©
 (
__c⁄°
 *
__‰om
, 
__tofd
,

783 
__c⁄°
 *
__to
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

786 
ssize_t
 
	$ªadlök©
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__∑th
,

787 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

788 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

792 
	$u∆ök
 (
__c⁄°
 *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

794 #ifde‡
__USE_ATFILE


796 
	$u∆ök©
 (
__fd
, 
__c⁄°
 *
__«me
, 
__Êag
)

797 
__THROW
 
	`__n⁄nuŒ
 ((2));

801 
	$rmdú
 (
__c⁄°
 *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

805 
__pid_t
 
	$tcgëpgΩ
 (
__fd
Ë
__THROW
;

808 
	$tc£çgΩ
 (
__fd
, 
__pid_t
 
__pgΩ_id
Ë
__THROW
;

815 *
	`gëlogö
 ();

816 #i‡
deföed
 
__USE_REENTRANT
 || deföed 
__USE_POSIX199506


823 
	$gëlogö_r
 (*
__«me
, 
size_t
 
__«me_Àn
Ë
	`__n⁄nuŒ
 ((1));

826 #ifdef 
__USE_BSD


828 
	$£éogö
 (
__c⁄°
 *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

832 #ifdef 
__USE_POSIX2


836 
	#__√ed_gë›t


	)

837 
	~<gë›t.h
>

841 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_UNIX98


845 
	$gëho°«me
 (*
__«me
, 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

849 #i‡
deföed
 
__USE_BSD
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_UNIX98
)

852 
	$£tho°«me
 (
__c⁄°
 *
__«me
, 
size_t
 
__Àn
)

853 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

857 
	$£tho°id
 (
__id
Ë
__THROW
 
__wur
;

863 
	$gëdomaö«me
 (*
__«me
, 
size_t
 
__Àn
)

864 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

865 
	$£tdomaö«me
 (
__c⁄°
 *
__«me
, 
size_t
 
__Àn
)

866 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

872 
	$vh™gup
 (Ë
__THROW
;

875 
	$ªvoke
 (
__c⁄°
 *
__fûe
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

883 
	$¥ofû
 (*
__ßm∂e_buf„r
, 
size_t
 
__size
,

884 
size_t
 
__off£t
, 
__sˇÀ
)

885 
__THROW
 
	`__n⁄nuŒ
 ((1));

891 
	$ac˘
 (
__c⁄°
 *
__«me
Ë
__THROW
;

895 *
	$gëu£rshñl
 (Ë
__THROW
;

896 
	$ídu£rshñl
 (Ë
__THROW
;

897 
	$£tu£rshñl
 (Ë
__THROW
;

903 
	$d´m⁄
 (
__nochdú
, 
__no˛o£
Ë
__THROW
 
__wur
;

907 #i‡
deföed
 
__USE_BSD
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

910 
	$chroŸ
 (
__c⁄°
 *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

914 *
	$gë∑ss
 (
__c⁄°
 *
__¥om±
Ë
	`__n⁄nuŒ
 ((1));

918 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


923 
	`fsync
 (
__fd
);

927 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


930 
	`gëho°id
 ();

933 
	$sync
 (Ë
__THROW
;

938 
	$gë∑gesize
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

943 
	$gëdèbÀsize
 (Ë
__THROW
;

947 #i‚de‡
__USE_FILE_OFFSET64


948 
	$åunˇã
 (
__c⁄°
 *
__fûe
, 
__off_t
 
__Àngth
)

949 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

951 #ifde‡
__REDIRECT_NTH


952 
	`__REDIRECT_NTH
 (
åunˇã
,

953 (
__c⁄°
 *
__fûe
, 
__off64_t
 
__Àngth
),

954 
åunˇã64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

956 
	#åunˇã
 
åunˇã64


	)

959 #ifde‡
__USE_LARGEFILE64


960 
	$åunˇã64
 (
__c⁄°
 *
__fûe
, 
__off64_t
 
__Àngth
)

961 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

966 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


969 #i‚de‡
__USE_FILE_OFFSET64


970 
	$·runˇã
 (
__fd
, 
__off_t
 
__Àngth
Ë
__THROW
 
__wur
;

972 #ifde‡
__REDIRECT_NTH


973 
	`__REDIRECT_NTH
 (
·runˇã
, (
__fd
, 
__off64_t
 
__Àngth
),

974 
·runˇã64
Ë
__wur
;

976 
	#·runˇã
 
·runˇã64


	)

979 #ifde‡
__USE_LARGEFILE64


980 
	$·runˇã64
 (
__fd
, 
__off64_t
 
__Àngth
Ë
__THROW
 
__wur
;

986 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


990 
	$brk
 (*
__addr
Ë
__THROW
 
__wur
;

996 *
	$sbrk
 (
öçå_t
 
__dñè
Ë
__THROW
;

1000 #ifde‡
__USE_MISC


1011 
	$sysˇŒ
 (
__sy¢o
, ...Ë
__THROW
;

1016 #i‡(
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
Ë&& !deföed 
F_LOCK


1028 
	#F_ULOCK
 0

	)

1029 
	#F_LOCK
 1

	)

1030 
	#F_TLOCK
 2

	)

1031 
	#F_TEST
 3

	)

1033 #i‚de‡
__USE_FILE_OFFSET64


1034 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
Ë
__wur
;

1036 #ifde‡
__REDIRECT


1037 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
),

1038 
lockf64
Ë
__wur
;

1040 
	#lockf
 
lockf64


	)

1043 #ifde‡
__USE_LARGEFILE64


1044 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
Ë
__wur
;

1049 #ifde‡
__USE_GNU


1054 
	#TEMP_FAILURE_RETRY
(
ex¥essi⁄
) \

1055 (
__exãnsi⁄__
 \

1056 ({ 
__ªsu…
; \

1057 dÿ
__ªsu…
 = (Ë(
ex¥essi⁄
); \

1058 
__ªsu…
 =-1L && 
î∫o
 =
EINTR
); \

1059 
__ªsu…
; 
	}
}))

	)

1062 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


1065 
fd©async
 (
__fûdes
);

1071 #ifdef 
__USE_XOPEN


1073 *
	$¸y±
 (
__c⁄°
 *
__key
, __c⁄° *
__ß…
)

1074 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1078 
	$í¸y±
 (*
__block
, 
__edÊag
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

1085 
	$swab
 (
__c⁄°
 *
__ª°ri˘
 
__‰om
, *__ª°ri˘ 
__to
,

1086 
ssize_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1092 #ifde‡
__USE_XOPEN


1094 *
	$˘îmid
 (*
__s
Ë
__THROW
;

1099 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


1100 
	~<bôs/uni°d.h
>

1103 
__END_DECLS


	@/usr/include/zlib.h

31 #i‚de‡
ZLIB_H


32 
	#ZLIB_H


	)

34 
	~"zc⁄f.h
"

36 #ifde‡
__˝lu•lus


40 
	#ZLIB_VERSION
 "1.2.3"

	)

41 
	#ZLIB_VERNUM
 0x1230

	)

77 
voidpf
 (*
	tÆloc_func
Ë
	tOF
((
	tvoidpf
 
	t›aque
, 
	tuI¡
 
	tôems
, uI¡ 
	tsize
));

78 (*
‰ì_func
Ë
	tOF
((
	tvoidpf
 
	t›aque
, voidp‡
	taddªss
));

80 
öã∫Æ_°©e
;

82 
	sz_°ªam_s
 {

83 
Byãf
 *
√xt_ö
;

84 
uI¡
 
avaû_ö
;

85 
uL⁄g
 
tŸÆ_ö
;

87 
Byãf
 *
√xt_out
;

88 
uI¡
 
avaû_out
;

89 
uL⁄g
 
tŸÆ_out
;

91 *
msg
;

92 
öã∫Æ_°©e
 
FAR
 *
°©e
;

94 
Æloc_func
 
zÆloc
;

95 
‰ì_func
 
z‰ì
;

96 
voidpf
 
›aque
;

98 
d©a_ty≥
;

99 
uL⁄g
 
adÀr
;

100 
uL⁄g
 
ª£rved
;

101 } 
	tz_°ªam
;

103 
z_°ªam
 
	tFAR
 *
	tz_°ªamp
;

109 
	sgz_hódî_s
 {

110 
ãxt
;

111 
uL⁄g
 
time
;

112 
xÊags
;

113 
os
;

114 
Byãf
 *
exåa
;

115 
uI¡
 
exåa_Àn
;

116 
uI¡
 
exåa_max
;

117 
Byãf
 *
«me
;

118 
uI¡
 
«me_max
;

119 
Byãf
 *
commít
;

120 
uI¡
 
comm_max
;

121 
h¸c
;

122 
d⁄e
;

124 } 
	tgz_hódî
;

126 
gz_hódî
 
	tFAR
 *
	tgz_hódîp
;

162 
	#Z_NO_FLUSH
 0

	)

163 
	#Z_PARTIAL_FLUSH
 1

	)

164 
	#Z_SYNC_FLUSH
 2

	)

165 
	#Z_FULL_FLUSH
 3

	)

166 
	#Z_FINISH
 4

	)

167 
	#Z_BLOCK
 5

	)

170 
	#Z_OK
 0

	)

171 
	#Z_STREAM_END
 1

	)

172 
	#Z_NEED_DICT
 2

	)

173 
	#Z_ERRNO
 (-1)

	)

174 
	#Z_STREAM_ERROR
 (-2)

	)

175 
	#Z_DATA_ERROR
 (-3)

	)

176 
	#Z_MEM_ERROR
 (-4)

	)

177 
	#Z_BUF_ERROR
 (-5)

	)

178 
	#Z_VERSION_ERROR
 (-6)

	)

183 
	#Z_NO_COMPRESSION
 0

	)

184 
	#Z_BEST_SPEED
 1

	)

185 
	#Z_BEST_COMPRESSION
 9

	)

186 
	#Z_DEFAULT_COMPRESSION
 (-1)

	)

189 
	#Z_FILTERED
 1

	)

190 
	#Z_HUFFMAN_ONLY
 2

	)

191 
	#Z_RLE
 3

	)

192 
	#Z_FIXED
 4

	)

193 
	#Z_DEFAULT_STRATEGY
 0

	)

196 
	#Z_BINARY
 0

	)

197 
	#Z_TEXT
 1

	)

198 
	#Z_ASCII
 
Z_TEXT


	)

199 
	#Z_UNKNOWN
 2

	)

202 
	#Z_DEFLATED
 8

	)

205 
	#Z_NULL
 0

	)

207 
	#zlib_vîsi⁄
 
	`zlibVîsi⁄
()

	)

212 
ZEXTERN
 c⁄° * 
ZEXPORT
 
zlibVîsi⁄
 
OF
(());

242 
ZEXTERN
 
ZEXPORT
 
deÊ©e
 
OF
((
z_°ªamp
 
°rm
, 
Êush
));

328 
ZEXTERN
 
ZEXPORT
 
deÊ©eEnd
 
OF
((
z_°ªamp
 
°rm
));

363 
ZEXTERN
 
ZEXPORT
 
öÊ©e
 
OF
((
z_°ªamp
 
°rm
, 
Êush
));

462 
ZEXTERN
 
ZEXPORT
 
öÊ©eEnd
 
OF
((
z_°ªamp
 
°rm
));

538 
ZEXTERN
 
ZEXPORT
 
deÊ©eSëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

539 c⁄° 
Byãf
 *
di˘i⁄¨y
,

540 
uI¡
 
di˘Lígth
));

577 
ZEXTERN
 
ZEXPORT
 
deÊ©eC›y
 
OF
((
z_°ªamp
 
de°
,

578 
z_°ªamp
 
sour˚
));

595 
ZEXTERN
 
ZEXPORT
 
deÊ©eRe£t
 
OF
((
z_°ªamp
 
°rm
));

606 
ZEXTERN
 
ZEXPORT
 
deÊ©eP¨ams
 
OF
((
z_°ªamp
 
°rm
,

607 
Àvñ
,

608 
°øãgy
));

627 
ZEXTERN
 
ZEXPORT
 
deÊ©eTu√
 
OF
((
z_°ªamp
 
°rm
,

628 
good_Àngth
,

629 
max_œzy
,

630 
ni˚_Àngth
,

631 
max_chaö
));

644 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
deÊ©eBound
 
OF
((
z_°ªamp
 
°rm
,

645 
uL⁄g
 
sour˚Lí
));

653 
ZEXTERN
 
ZEXPORT
 
deÊ©ePrime
 
OF
((
z_°ªamp
 
°rm
,

654 
bôs
,

655 
vÆue
));

669 
ZEXTERN
 
ZEXPORT
 
deÊ©eSëHódî
 
OF
((
z_°ªamp
 
°rm
,

670 
gz_hódîp
 
hód
));

736 
ZEXTERN
 
ZEXPORT
 
öÊ©eSëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

737 c⁄° 
Byãf
 *
di˘i⁄¨y
,

738 
uI¡
 
di˘Lígth
));

758 
ZEXTERN
 
ZEXPORT
 
öÊ©eSync
 
OF
((
z_°ªamp
 
°rm
));

773 
ZEXTERN
 
ZEXPORT
 
öÊ©eC›y
 
OF
((
z_°ªamp
 
de°
,

774 
z_°ªamp
 
sour˚
));

789 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£t
 
OF
((
z_°ªamp
 
°rm
));

799 
ZEXTERN
 
ZEXPORT
 
öÊ©ePrime
 
OF
((
z_°ªamp
 
°rm
,

800 
bôs
,

801 
vÆue
));

815 
ZEXTERN
 
ZEXPORT
 
öÊ©eGëHódî
 
OF
((
z_°ªamp
 
°rm
,

816 
gz_hódîp
 
hód
));

877 (*
ö_func
Ë
	tOF
((
	tFAR
 *, FAR * FAR *));

878 (*
out_func
Ë
	tOF
((
	tFAR
 *, FAR *, ));

880 
ZEXTERN
 
ZEXPORT
 
öÊ©eBack
 
OF
((
z_°ªamp
 
°rm
,

881 
ö_func
 
ö
, 
FAR
 *
ö_desc
,

882 
out_func
 
out
, 
FAR
 *
out_desc
));

949 
ZEXTERN
 
ZEXPORT
 
öÊ©eBackEnd
 
OF
((
z_°ªamp
 
°rm
));

957 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
zlibCompûeFœgs
 
OF
(());

1009 
ZEXTERN
 
ZEXPORT
 
com¥ess
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1010 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
));

1024 
ZEXTERN
 
ZEXPORT
 
com¥ess2
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1025 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
,

1026 
Àvñ
));

1040 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
com¥essBound
 
OF
((uL⁄g 
sour˚Lí
));

1047 
ZEXTERN
 
ZEXPORT
 
uncom¥ess
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1048 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
));

1066 
voidp
 
	tgzFûe
;

1068 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í
 
OF
((c⁄° *
∑th
, c⁄° *
mode
));

1085 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gzd›í
 
OF
((
fd
, c⁄° *
mode
));

1098 
ZEXTERN
 
ZEXPORT
 
gz£ç¨ams
 
OF
((
gzFûe
 
fûe
, 
Àvñ
, 
°øãgy
));

1106 
ZEXTERN
 
ZEXPORT
 
gzªad
 
OF
((
gzFûe
 
fûe
, 
voidp
 
buf
, 
Àn
));

1114 
ZEXTERN
 
ZEXPORT
 
gzwrôe
 
OF
((
gzFûe
 
fûe
,

1115 
voidpc
 
buf
, 
Àn
));

1123 
ZEXTERN
 
ZEXPORTVA
 
gz¥ötf
 
OF
((
gzFûe
 
fûe
, c⁄° *
f‹m©
, ...))

1124 #ifde‡
__GNUC__


1125 
__©åibuã__
((
__f‹m©__
(
__¥ötf__
,2,3)))

1140 
ZEXTERN
 
ZEXPORT
 
gzputs
 
OF
((
gzFûe
 
fûe
, c⁄° *
s
));

1147 
ZEXTERN
 * 
ZEXPORT
 
gzgës
 
OF
((
gzFûe
 
fûe
, *
buf
, 
Àn
));

1156 
ZEXTERN
 
ZEXPORT
 
gzputc
 
OF
((
gzFûe
 
fûe
, 
c
));

1162 
ZEXTERN
 
ZEXPORT
 
gzgëc
 
OF
((
gzFûe
 
fûe
));

1168 
ZEXTERN
 
ZEXPORT
 
gzungëc
 
OF
((
c
, 
gzFûe
 
fûe
));

1178 
ZEXTERN
 
ZEXPORT
 
gzÊush
 
OF
((
gzFûe
 
fûe
, 
Êush
));

1188 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek
 
OF
((
gzFûe
 
fûe
,

1189 
z_off_t
 
off£t
, 
whí˚
));

1206 
ZEXTERN
 
ZEXPORT
 
gzªwöd
 
OF
((
gzFûe
 
fûe
));

1213 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzãŒ
 
OF
((
gzFûe
 
fûe
));

1222 
ZEXTERN
 
ZEXPORT
 
gzeof
 
OF
((
gzFûe
 
fûe
));

1228 
ZEXTERN
 
ZEXPORT
 
gzdúe˘
 
OF
((
gzFûe
 
fûe
));

1234 
ZEXTERN
 
ZEXPORT
 
gz˛o£
 
OF
((
gzFûe
 
fûe
));

1241 
ZEXTERN
 c⁄° * 
ZEXPORT
 
gzîr‹
 
OF
((
gzFûe
 
fûe
, *
î∫um
));

1250 
ZEXTERN
 
ZEXPORT
 
gz˛óªº
 
OF
((
gzFûe
 
fûe
));

1265 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32
 
OF
((uL⁄g 
adÀr
, c⁄° 
Byãf
 *
buf
, 
uI¡
 
Àn
));

1281 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe
 
OF
((uL⁄g 
adÀr1
, uL⁄g 
adÀr2
,

1282 
z_off_t
 
Àn2
));

1290 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32
 
OF
((uL⁄g 
¸c
, c⁄° 
Byãf
 *
buf
, 
uI¡
 
Àn
));

1306 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe
 
OF
((uL⁄g 
¸c1
, uL⁄g 
¸c2
, 
z_off_t
 
Àn2
));

1322 
ZEXTERN
 
ZEXPORT
 
deÊ©eInô_
 
OF
((
z_°ªamp
 
°rm
, 
Àvñ
,

1323 c⁄° *
vîsi⁄
, 
°ªam_size
));

1324 
ZEXTERN
 
ZEXPORT
 
öÊ©eInô_
 
OF
((
z_°ªamp
 
°rm
,

1325 c⁄° *
vîsi⁄
, 
°ªam_size
));

1326 
ZEXTERN
 
ZEXPORT
 
deÊ©eInô2_
 
OF
((
z_°ªamp
 
°rm
, 
Àvñ
, 
mëhod
,

1327 
wödowBôs
, 
memLevñ
,

1328 
°øãgy
, c⁄° *
vîsi⁄
,

1329 
°ªam_size
));

1330 
ZEXTERN
 
ZEXPORT
 
öÊ©eInô2_
 
OF
((
z_°ªamp
 
°rm
, 
wödowBôs
,

1331 c⁄° *
vîsi⁄
, 
°ªam_size
));

1332 
ZEXTERN
 
ZEXPORT
 
öÊ©eBackInô_
 
OF
((
z_°ªamp
 
°rm
, 
wödowBôs
,

1333 
FAR
 *
wödow
,

1334 c⁄° *
vîsi⁄
,

1335 
°ªam_size
));

1336 
	#deÊ©eInô
(
°rm
, 
Àvñ
) \

1337 
	`deÊ©eInô_
((
°rm
), (
Àvñ
), 
ZLIB_VERSION
, (
z_°ªam
))

	)

1338 
	#öÊ©eInô
(
°rm
) \

1339 
	`öÊ©eInô_
((
°rm
), 
ZLIB_VERSION
, (
z_°ªam
))

	)

1340 
	#deÊ©eInô2
(
°rm
, 
Àvñ
, 
mëhod
, 
wödowBôs
, 
memLevñ
, 
°øãgy
) \

1341 
	`deÊ©eInô2_
((
°rm
),(
Àvñ
),(
mëhod
),(
wödowBôs
),(
memLevñ
),\

1342 (
°øãgy
), 
ZLIB_VERSION
, (
z_°ªam
))

	)

1343 
	#öÊ©eInô2
(
°rm
, 
wödowBôs
) \

1344 
	`öÊ©eInô2_
((
°rm
), (
wödowBôs
), 
ZLIB_VERSION
, (
z_°ªam
))

	)

1345 
	#öÊ©eBackInô
(
°rm
, 
wödowBôs
, 
wödow
) \

1346 
	`öÊ©eBackInô_
((
°rm
), (
wödowBôs
), (
wödow
), \

1347 
ZLIB_VERSION
, (
z_°ªam
))

	)

1350 #i‡!
deföed
(
ZUTIL_H
Ë&& !deföed(
NO_DUMMY_DECL
)

1351 
	söã∫Æ_°©e
 {
dummy
;};

1354 
ZEXTERN
 c⁄° * 
ZEXPORT
 
zEº‹
 
OF
(());

1355 
ZEXTERN
 
ZEXPORT
 
öÊ©eSyncPoöt
 
OF
((
z_°ªamp
 
z
));

1356 
ZEXTERN
 c⁄° 
uL⁄gf
 * 
ZEXPORT
 
gë_¸c_èbÀ
 
OF
(());

1358 #ifde‡
__˝lu•lus


	@/usr/include/alloca.h

19 #i‚def 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<„©uªs.h
>

24 
	#__√ed_size_t


	)

25 
	~<°ddef.h
>

27 
	g__BEGIN_DECLS


30 #unde‡
Æloˇ


33 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

35 #ifdef 
__GNUC__


36 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

39 
__END_DECLS


	@/usr/include/bits/confname.h

21 #i‚de‡
_UNISTD_H


28 
	m_PC_LINK_MAX
,

29 
	#_PC_LINK_MAX
 
_PC_LINK_MAX


	)

30 
	m_PC_MAX_CANON
,

31 
	#_PC_MAX_CANON
 
_PC_MAX_CANON


	)

32 
	m_PC_MAX_INPUT
,

33 
	#_PC_MAX_INPUT
 
_PC_MAX_INPUT


	)

34 
	m_PC_NAME_MAX
,

35 
	#_PC_NAME_MAX
 
_PC_NAME_MAX


	)

36 
	m_PC_PATH_MAX
,

37 
	#_PC_PATH_MAX
 
_PC_PATH_MAX


	)

38 
	m_PC_PIPE_BUF
,

39 
	#_PC_PIPE_BUF
 
_PC_PIPE_BUF


	)

40 
	m_PC_CHOWN_RESTRICTED
,

41 
	#_PC_CHOWN_RESTRICTED
 
_PC_CHOWN_RESTRICTED


	)

42 
	m_PC_NO_TRUNC
,

43 
	#_PC_NO_TRUNC
 
_PC_NO_TRUNC


	)

44 
	m_PC_VDISABLE
,

45 
	#_PC_VDISABLE
 
_PC_VDISABLE


	)

46 
	m_PC_SYNC_IO
,

47 
	#_PC_SYNC_IO
 
_PC_SYNC_IO


	)

48 
	m_PC_ASYNC_IO
,

49 
	#_PC_ASYNC_IO
 
_PC_ASYNC_IO


	)

50 
	m_PC_PRIO_IO
,

51 
	#_PC_PRIO_IO
 
_PC_PRIO_IO


	)

52 
	m_PC_SOCK_MAXBUF
,

53 
	#_PC_SOCK_MAXBUF
 
_PC_SOCK_MAXBUF


	)

54 
	m_PC_FILESIZEBITS
,

55 
	#_PC_FILESIZEBITS
 
_PC_FILESIZEBITS


	)

56 
	m_PC_REC_INCR_XFER_SIZE
,

57 
	#_PC_REC_INCR_XFER_SIZE
 
_PC_REC_INCR_XFER_SIZE


	)

58 
	m_PC_REC_MAX_XFER_SIZE
,

59 
	#_PC_REC_MAX_XFER_SIZE
 
_PC_REC_MAX_XFER_SIZE


	)

60 
	m_PC_REC_MIN_XFER_SIZE
,

61 
	#_PC_REC_MIN_XFER_SIZE
 
_PC_REC_MIN_XFER_SIZE


	)

62 
	m_PC_REC_XFER_ALIGN
,

63 
	#_PC_REC_XFER_ALIGN
 
_PC_REC_XFER_ALIGN


	)

64 
	m_PC_ALLOC_SIZE_MIN
,

65 
	#_PC_ALLOC_SIZE_MIN
 
_PC_ALLOC_SIZE_MIN


	)

66 
	m_PC_SYMLINK_MAX
,

67 
	#_PC_SYMLINK_MAX
 
_PC_SYMLINK_MAX


	)

68 
	m_PC_2_SYMLINKS


69 
	#_PC_2_SYMLINKS
 
_PC_2_SYMLINKS


	)

75 
	m_SC_ARG_MAX
,

76 
	#_SC_ARG_MAX
 
_SC_ARG_MAX


	)

77 
	m_SC_CHILD_MAX
,

78 
	#_SC_CHILD_MAX
 
_SC_CHILD_MAX


	)

79 
	m_SC_CLK_TCK
,

80 
	#_SC_CLK_TCK
 
_SC_CLK_TCK


	)

81 
	m_SC_NGROUPS_MAX
,

82 
	#_SC_NGROUPS_MAX
 
_SC_NGROUPS_MAX


	)

83 
	m_SC_OPEN_MAX
,

84 
	#_SC_OPEN_MAX
 
_SC_OPEN_MAX


	)

85 
	m_SC_STREAM_MAX
,

86 
	#_SC_STREAM_MAX
 
_SC_STREAM_MAX


	)

87 
	m_SC_TZNAME_MAX
,

88 
	#_SC_TZNAME_MAX
 
_SC_TZNAME_MAX


	)

89 
	m_SC_JOB_CONTROL
,

90 
	#_SC_JOB_CONTROL
 
_SC_JOB_CONTROL


	)

91 
	m_SC_SAVED_IDS
,

92 
	#_SC_SAVED_IDS
 
_SC_SAVED_IDS


	)

93 
	m_SC_REALTIME_SIGNALS
,

94 
	#_SC_REALTIME_SIGNALS
 
_SC_REALTIME_SIGNALS


	)

95 
	m_SC_PRIORITY_SCHEDULING
,

96 
	#_SC_PRIORITY_SCHEDULING
 
_SC_PRIORITY_SCHEDULING


	)

97 
	m_SC_TIMERS
,

98 
	#_SC_TIMERS
 
_SC_TIMERS


	)

99 
	m_SC_ASYNCHRONOUS_IO
,

100 
	#_SC_ASYNCHRONOUS_IO
 
_SC_ASYNCHRONOUS_IO


	)

101 
	m_SC_PRIORITIZED_IO
,

102 
	#_SC_PRIORITIZED_IO
 
_SC_PRIORITIZED_IO


	)

103 
	m_SC_SYNCHRONIZED_IO
,

104 
	#_SC_SYNCHRONIZED_IO
 
_SC_SYNCHRONIZED_IO


	)

105 
	m_SC_FSYNC
,

106 
	#_SC_FSYNC
 
_SC_FSYNC


	)

107 
	m_SC_MAPPED_FILES
,

108 
	#_SC_MAPPED_FILES
 
_SC_MAPPED_FILES


	)

109 
	m_SC_MEMLOCK
,

110 
	#_SC_MEMLOCK
 
_SC_MEMLOCK


	)

111 
	m_SC_MEMLOCK_RANGE
,

112 
	#_SC_MEMLOCK_RANGE
 
_SC_MEMLOCK_RANGE


	)

113 
	m_SC_MEMORY_PROTECTION
,

114 
	#_SC_MEMORY_PROTECTION
 
_SC_MEMORY_PROTECTION


	)

115 
	m_SC_MESSAGE_PASSING
,

116 
	#_SC_MESSAGE_PASSING
 
_SC_MESSAGE_PASSING


	)

117 
	m_SC_SEMAPHORES
,

118 
	#_SC_SEMAPHORES
 
_SC_SEMAPHORES


	)

119 
	m_SC_SHARED_MEMORY_OBJECTS
,

120 
	#_SC_SHARED_MEMORY_OBJECTS
 
_SC_SHARED_MEMORY_OBJECTS


	)

121 
	m_SC_AIO_LISTIO_MAX
,

122 
	#_SC_AIO_LISTIO_MAX
 
_SC_AIO_LISTIO_MAX


	)

123 
	m_SC_AIO_MAX
,

124 
	#_SC_AIO_MAX
 
_SC_AIO_MAX


	)

125 
	m_SC_AIO_PRIO_DELTA_MAX
,

126 
	#_SC_AIO_PRIO_DELTA_MAX
 
_SC_AIO_PRIO_DELTA_MAX


	)

127 
	m_SC_DELAYTIMER_MAX
,

128 
	#_SC_DELAYTIMER_MAX
 
_SC_DELAYTIMER_MAX


	)

129 
	m_SC_MQ_OPEN_MAX
,

130 
	#_SC_MQ_OPEN_MAX
 
_SC_MQ_OPEN_MAX


	)

131 
	m_SC_MQ_PRIO_MAX
,

132 
	#_SC_MQ_PRIO_MAX
 
_SC_MQ_PRIO_MAX


	)

133 
	m_SC_VERSION
,

134 
	#_SC_VERSION
 
_SC_VERSION


	)

135 
	m_SC_PAGESIZE
,

136 
	#_SC_PAGESIZE
 
_SC_PAGESIZE


	)

137 
	#_SC_PAGE_SIZE
 
_SC_PAGESIZE


	)

138 
	m_SC_RTSIG_MAX
,

139 
	#_SC_RTSIG_MAX
 
_SC_RTSIG_MAX


	)

140 
	m_SC_SEM_NSEMS_MAX
,

141 
	#_SC_SEM_NSEMS_MAX
 
_SC_SEM_NSEMS_MAX


	)

142 
	m_SC_SEM_VALUE_MAX
,

143 
	#_SC_SEM_VALUE_MAX
 
_SC_SEM_VALUE_MAX


	)

144 
	m_SC_SIGQUEUE_MAX
,

145 
	#_SC_SIGQUEUE_MAX
 
_SC_SIGQUEUE_MAX


	)

146 
	m_SC_TIMER_MAX
,

147 
	#_SC_TIMER_MAX
 
_SC_TIMER_MAX


	)

151 
	m_SC_BC_BASE_MAX
,

152 
	#_SC_BC_BASE_MAX
 
_SC_BC_BASE_MAX


	)

153 
	m_SC_BC_DIM_MAX
,

154 
	#_SC_BC_DIM_MAX
 
_SC_BC_DIM_MAX


	)

155 
	m_SC_BC_SCALE_MAX
,

156 
	#_SC_BC_SCALE_MAX
 
_SC_BC_SCALE_MAX


	)

157 
	m_SC_BC_STRING_MAX
,

158 
	#_SC_BC_STRING_MAX
 
_SC_BC_STRING_MAX


	)

159 
	m_SC_COLL_WEIGHTS_MAX
,

160 
	#_SC_COLL_WEIGHTS_MAX
 
_SC_COLL_WEIGHTS_MAX


	)

161 
	m_SC_EQUIV_CLASS_MAX
,

162 
	#_SC_EQUIV_CLASS_MAX
 
_SC_EQUIV_CLASS_MAX


	)

163 
	m_SC_EXPR_NEST_MAX
,

164 
	#_SC_EXPR_NEST_MAX
 
_SC_EXPR_NEST_MAX


	)

165 
	m_SC_LINE_MAX
,

166 
	#_SC_LINE_MAX
 
_SC_LINE_MAX


	)

167 
	m_SC_RE_DUP_MAX
,

168 
	#_SC_RE_DUP_MAX
 
_SC_RE_DUP_MAX


	)

169 
	m_SC_CHARCLASS_NAME_MAX
,

170 
	#_SC_CHARCLASS_NAME_MAX
 
_SC_CHARCLASS_NAME_MAX


	)

172 
	m_SC_2_VERSION
,

173 
	#_SC_2_VERSION
 
_SC_2_VERSION


	)

174 
	m_SC_2_C_BIND
,

175 
	#_SC_2_C_BIND
 
_SC_2_C_BIND


	)

176 
	m_SC_2_C_DEV
,

177 
	#_SC_2_C_DEV
 
_SC_2_C_DEV


	)

178 
	m_SC_2_FORT_DEV
,

179 
	#_SC_2_FORT_DEV
 
_SC_2_FORT_DEV


	)

180 
	m_SC_2_FORT_RUN
,

181 
	#_SC_2_FORT_RUN
 
_SC_2_FORT_RUN


	)

182 
	m_SC_2_SW_DEV
,

183 
	#_SC_2_SW_DEV
 
_SC_2_SW_DEV


	)

184 
	m_SC_2_LOCALEDEF
,

185 
	#_SC_2_LOCALEDEF
 
_SC_2_LOCALEDEF


	)

187 
	m_SC_PII
,

188 
	#_SC_PII
 
_SC_PII


	)

189 
	m_SC_PII_XTI
,

190 
	#_SC_PII_XTI
 
_SC_PII_XTI


	)

191 
	m_SC_PII_SOCKET
,

192 
	#_SC_PII_SOCKET
 
_SC_PII_SOCKET


	)

193 
	m_SC_PII_INTERNET
,

194 
	#_SC_PII_INTERNET
 
_SC_PII_INTERNET


	)

195 
	m_SC_PII_OSI
,

196 
	#_SC_PII_OSI
 
_SC_PII_OSI


	)

197 
	m_SC_POLL
,

198 
	#_SC_POLL
 
_SC_POLL


	)

199 
	m_SC_SELECT
,

200 
	#_SC_SELECT
 
_SC_SELECT


	)

201 
	m_SC_UIO_MAXIOV
,

202 
	#_SC_UIO_MAXIOV
 
_SC_UIO_MAXIOV


	)

203 
	m_SC_IOV_MAX
 = 
_SC_UIO_MAXIOV
,

204 
	#_SC_IOV_MAX
 
_SC_IOV_MAX


	)

205 
	m_SC_PII_INTERNET_STREAM
,

206 
	#_SC_PII_INTERNET_STREAM
 
_SC_PII_INTERNET_STREAM


	)

207 
	m_SC_PII_INTERNET_DGRAM
,

208 
	#_SC_PII_INTERNET_DGRAM
 
_SC_PII_INTERNET_DGRAM


	)

209 
	m_SC_PII_OSI_COTS
,

210 
	#_SC_PII_OSI_COTS
 
_SC_PII_OSI_COTS


	)

211 
	m_SC_PII_OSI_CLTS
,

212 
	#_SC_PII_OSI_CLTS
 
_SC_PII_OSI_CLTS


	)

213 
	m_SC_PII_OSI_M
,

214 
	#_SC_PII_OSI_M
 
_SC_PII_OSI_M


	)

215 
	m_SC_T_IOV_MAX
,

216 
	#_SC_T_IOV_MAX
 
_SC_T_IOV_MAX


	)

219 
	m_SC_THREADS
,

220 
	#_SC_THREADS
 
_SC_THREADS


	)

221 
	m_SC_THREAD_SAFE_FUNCTIONS
,

222 
	#_SC_THREAD_SAFE_FUNCTIONS
 
_SC_THREAD_SAFE_FUNCTIONS


	)

223 
	m_SC_GETGR_R_SIZE_MAX
,

224 
	#_SC_GETGR_R_SIZE_MAX
 
_SC_GETGR_R_SIZE_MAX


	)

225 
	m_SC_GETPW_R_SIZE_MAX
,

226 
	#_SC_GETPW_R_SIZE_MAX
 
_SC_GETPW_R_SIZE_MAX


	)

227 
	m_SC_LOGIN_NAME_MAX
,

228 
	#_SC_LOGIN_NAME_MAX
 
_SC_LOGIN_NAME_MAX


	)

229 
	m_SC_TTY_NAME_MAX
,

230 
	#_SC_TTY_NAME_MAX
 
_SC_TTY_NAME_MAX


	)

231 
	m_SC_THREAD_DESTRUCTOR_ITERATIONS
,

232 
	#_SC_THREAD_DESTRUCTOR_ITERATIONS
 
_SC_THREAD_DESTRUCTOR_ITERATIONS


	)

233 
	m_SC_THREAD_KEYS_MAX
,

234 
	#_SC_THREAD_KEYS_MAX
 
_SC_THREAD_KEYS_MAX


	)

235 
	m_SC_THREAD_STACK_MIN
,

236 
	#_SC_THREAD_STACK_MIN
 
_SC_THREAD_STACK_MIN


	)

237 
	m_SC_THREAD_THREADS_MAX
,

238 
	#_SC_THREAD_THREADS_MAX
 
_SC_THREAD_THREADS_MAX


	)

239 
	m_SC_THREAD_ATTR_STACKADDR
,

240 
	#_SC_THREAD_ATTR_STACKADDR
 
_SC_THREAD_ATTR_STACKADDR


	)

241 
	m_SC_THREAD_ATTR_STACKSIZE
,

242 
	#_SC_THREAD_ATTR_STACKSIZE
 
_SC_THREAD_ATTR_STACKSIZE


	)

243 
	m_SC_THREAD_PRIORITY_SCHEDULING
,

244 
	#_SC_THREAD_PRIORITY_SCHEDULING
 
_SC_THREAD_PRIORITY_SCHEDULING


	)

245 
	m_SC_THREAD_PRIO_INHERIT
,

246 
	#_SC_THREAD_PRIO_INHERIT
 
_SC_THREAD_PRIO_INHERIT


	)

247 
	m_SC_THREAD_PRIO_PROTECT
,

248 
	#_SC_THREAD_PRIO_PROTECT
 
_SC_THREAD_PRIO_PROTECT


	)

249 
	m_SC_THREAD_PROCESS_SHARED
,

250 
	#_SC_THREAD_PROCESS_SHARED
 
_SC_THREAD_PROCESS_SHARED


	)

252 
	m_SC_NPROCESSORS_CONF
,

253 
	#_SC_NPROCESSORS_CONF
 
_SC_NPROCESSORS_CONF


	)

254 
	m_SC_NPROCESSORS_ONLN
,

255 
	#_SC_NPROCESSORS_ONLN
 
_SC_NPROCESSORS_ONLN


	)

256 
	m_SC_PHYS_PAGES
,

257 
	#_SC_PHYS_PAGES
 
_SC_PHYS_PAGES


	)

258 
	m_SC_AVPHYS_PAGES
,

259 
	#_SC_AVPHYS_PAGES
 
_SC_AVPHYS_PAGES


	)

260 
	m_SC_ATEXIT_MAX
,

261 
	#_SC_ATEXIT_MAX
 
_SC_ATEXIT_MAX


	)

262 
	m_SC_PASS_MAX
,

263 
	#_SC_PASS_MAX
 
_SC_PASS_MAX


	)

265 
	m_SC_XOPEN_VERSION
,

266 
	#_SC_XOPEN_VERSION
 
_SC_XOPEN_VERSION


	)

267 
	m_SC_XOPEN_XCU_VERSION
,

268 
	#_SC_XOPEN_XCU_VERSION
 
_SC_XOPEN_XCU_VERSION


	)

269 
	m_SC_XOPEN_UNIX
,

270 
	#_SC_XOPEN_UNIX
 
_SC_XOPEN_UNIX


	)

271 
	m_SC_XOPEN_CRYPT
,

272 
	#_SC_XOPEN_CRYPT
 
_SC_XOPEN_CRYPT


	)

273 
	m_SC_XOPEN_ENH_I18N
,

274 
	#_SC_XOPEN_ENH_I18N
 
_SC_XOPEN_ENH_I18N


	)

275 
	m_SC_XOPEN_SHM
,

276 
	#_SC_XOPEN_SHM
 
_SC_XOPEN_SHM


	)

278 
	m_SC_2_CHAR_TERM
,

279 
	#_SC_2_CHAR_TERM
 
_SC_2_CHAR_TERM


	)

280 
	m_SC_2_C_VERSION
,

281 
	#_SC_2_C_VERSION
 
_SC_2_C_VERSION


	)

282 
	m_SC_2_UPE
,

283 
	#_SC_2_UPE
 
_SC_2_UPE


	)

285 
	m_SC_XOPEN_XPG2
,

286 
	#_SC_XOPEN_XPG2
 
_SC_XOPEN_XPG2


	)

287 
	m_SC_XOPEN_XPG3
,

288 
	#_SC_XOPEN_XPG3
 
_SC_XOPEN_XPG3


	)

289 
	m_SC_XOPEN_XPG4
,

290 
	#_SC_XOPEN_XPG4
 
_SC_XOPEN_XPG4


	)

292 
	m_SC_CHAR_BIT
,

293 
	#_SC_CHAR_BIT
 
_SC_CHAR_BIT


	)

294 
	m_SC_CHAR_MAX
,

295 
	#_SC_CHAR_MAX
 
_SC_CHAR_MAX


	)

296 
	m_SC_CHAR_MIN
,

297 
	#_SC_CHAR_MIN
 
_SC_CHAR_MIN


	)

298 
	m_SC_INT_MAX
,

299 
	#_SC_INT_MAX
 
_SC_INT_MAX


	)

300 
	m_SC_INT_MIN
,

301 
	#_SC_INT_MIN
 
_SC_INT_MIN


	)

302 
	m_SC_LONG_BIT
,

303 
	#_SC_LONG_BIT
 
_SC_LONG_BIT


	)

304 
	m_SC_WORD_BIT
,

305 
	#_SC_WORD_BIT
 
_SC_WORD_BIT


	)

306 
	m_SC_MB_LEN_MAX
,

307 
	#_SC_MB_LEN_MAX
 
_SC_MB_LEN_MAX


	)

308 
	m_SC_NZERO
,

309 
	#_SC_NZERO
 
_SC_NZERO


	)

310 
	m_SC_SSIZE_MAX
,

311 
	#_SC_SSIZE_MAX
 
_SC_SSIZE_MAX


	)

312 
	m_SC_SCHAR_MAX
,

313 
	#_SC_SCHAR_MAX
 
_SC_SCHAR_MAX


	)

314 
	m_SC_SCHAR_MIN
,

315 
	#_SC_SCHAR_MIN
 
_SC_SCHAR_MIN


	)

316 
	m_SC_SHRT_MAX
,

317 
	#_SC_SHRT_MAX
 
_SC_SHRT_MAX


	)

318 
	m_SC_SHRT_MIN
,

319 
	#_SC_SHRT_MIN
 
_SC_SHRT_MIN


	)

320 
	m_SC_UCHAR_MAX
,

321 
	#_SC_UCHAR_MAX
 
_SC_UCHAR_MAX


	)

322 
	m_SC_UINT_MAX
,

323 
	#_SC_UINT_MAX
 
_SC_UINT_MAX


	)

324 
	m_SC_ULONG_MAX
,

325 
	#_SC_ULONG_MAX
 
_SC_ULONG_MAX


	)

326 
	m_SC_USHRT_MAX
,

327 
	#_SC_USHRT_MAX
 
_SC_USHRT_MAX


	)

329 
	m_SC_NL_ARGMAX
,

330 
	#_SC_NL_ARGMAX
 
_SC_NL_ARGMAX


	)

331 
	m_SC_NL_LANGMAX
,

332 
	#_SC_NL_LANGMAX
 
_SC_NL_LANGMAX


	)

333 
	m_SC_NL_MSGMAX
,

334 
	#_SC_NL_MSGMAX
 
_SC_NL_MSGMAX


	)

335 
	m_SC_NL_NMAX
,

336 
	#_SC_NL_NMAX
 
_SC_NL_NMAX


	)

337 
	m_SC_NL_SETMAX
,

338 
	#_SC_NL_SETMAX
 
_SC_NL_SETMAX


	)

339 
	m_SC_NL_TEXTMAX
,

340 
	#_SC_NL_TEXTMAX
 
_SC_NL_TEXTMAX


	)

342 
	m_SC_XBS5_ILP32_OFF32
,

343 
	#_SC_XBS5_ILP32_OFF32
 
_SC_XBS5_ILP32_OFF32


	)

344 
	m_SC_XBS5_ILP32_OFFBIG
,

345 
	#_SC_XBS5_ILP32_OFFBIG
 
_SC_XBS5_ILP32_OFFBIG


	)

346 
	m_SC_XBS5_LP64_OFF64
,

347 
	#_SC_XBS5_LP64_OFF64
 
_SC_XBS5_LP64_OFF64


	)

348 
	m_SC_XBS5_LPBIG_OFFBIG
,

349 
	#_SC_XBS5_LPBIG_OFFBIG
 
_SC_XBS5_LPBIG_OFFBIG


	)

351 
	m_SC_XOPEN_LEGACY
,

352 
	#_SC_XOPEN_LEGACY
 
_SC_XOPEN_LEGACY


	)

353 
	m_SC_XOPEN_REALTIME
,

354 
	#_SC_XOPEN_REALTIME
 
_SC_XOPEN_REALTIME


	)

355 
	m_SC_XOPEN_REALTIME_THREADS
,

356 
	#_SC_XOPEN_REALTIME_THREADS
 
_SC_XOPEN_REALTIME_THREADS


	)

358 
	m_SC_ADVISORY_INFO
,

359 
	#_SC_ADVISORY_INFO
 
_SC_ADVISORY_INFO


	)

360 
	m_SC_BARRIERS
,

361 
	#_SC_BARRIERS
 
_SC_BARRIERS


	)

362 
	m_SC_BASE
,

363 
	#_SC_BASE
 
_SC_BASE


	)

364 
	m_SC_C_LANG_SUPPORT
,

365 
	#_SC_C_LANG_SUPPORT
 
_SC_C_LANG_SUPPORT


	)

366 
	m_SC_C_LANG_SUPPORT_R
,

367 
	#_SC_C_LANG_SUPPORT_R
 
_SC_C_LANG_SUPPORT_R


	)

368 
	m_SC_CLOCK_SELECTION
,

369 
	#_SC_CLOCK_SELECTION
 
_SC_CLOCK_SELECTION


	)

370 
	m_SC_CPUTIME
,

371 
	#_SC_CPUTIME
 
_SC_CPUTIME


	)

372 
	m_SC_THREAD_CPUTIME
,

373 
	#_SC_THREAD_CPUTIME
 
_SC_THREAD_CPUTIME


	)

374 
	m_SC_DEVICE_IO
,

375 
	#_SC_DEVICE_IO
 
_SC_DEVICE_IO


	)

376 
	m_SC_DEVICE_SPECIFIC
,

377 
	#_SC_DEVICE_SPECIFIC
 
_SC_DEVICE_SPECIFIC


	)

378 
	m_SC_DEVICE_SPECIFIC_R
,

379 
	#_SC_DEVICE_SPECIFIC_R
 
_SC_DEVICE_SPECIFIC_R


	)

380 
	m_SC_FD_MGMT
,

381 
	#_SC_FD_MGMT
 
_SC_FD_MGMT


	)

382 
	m_SC_FIFO
,

383 
	#_SC_FIFO
 
_SC_FIFO


	)

384 
	m_SC_PIPE
,

385 
	#_SC_PIPE
 
_SC_PIPE


	)

386 
	m_SC_FILE_ATTRIBUTES
,

387 
	#_SC_FILE_ATTRIBUTES
 
_SC_FILE_ATTRIBUTES


	)

388 
	m_SC_FILE_LOCKING
,

389 
	#_SC_FILE_LOCKING
 
_SC_FILE_LOCKING


	)

390 
	m_SC_FILE_SYSTEM
,

391 
	#_SC_FILE_SYSTEM
 
_SC_FILE_SYSTEM


	)

392 
	m_SC_MONOTONIC_CLOCK
,

393 
	#_SC_MONOTONIC_CLOCK
 
_SC_MONOTONIC_CLOCK


	)

394 
	m_SC_MULTI_PROCESS
,

395 
	#_SC_MULTI_PROCESS
 
_SC_MULTI_PROCESS


	)

396 
	m_SC_SINGLE_PROCESS
,

397 
	#_SC_SINGLE_PROCESS
 
_SC_SINGLE_PROCESS


	)

398 
	m_SC_NETWORKING
,

399 
	#_SC_NETWORKING
 
_SC_NETWORKING


	)

400 
	m_SC_READER_WRITER_LOCKS
,

401 
	#_SC_READER_WRITER_LOCKS
 
_SC_READER_WRITER_LOCKS


	)

402 
	m_SC_SPIN_LOCKS
,

403 
	#_SC_SPIN_LOCKS
 
_SC_SPIN_LOCKS


	)

404 
	m_SC_REGEXP
,

405 
	#_SC_REGEXP
 
_SC_REGEXP


	)

406 
	m_SC_REGEX_VERSION
,

407 
	#_SC_REGEX_VERSION
 
_SC_REGEX_VERSION


	)

408 
	m_SC_SHELL
,

409 
	#_SC_SHELL
 
_SC_SHELL


	)

410 
	m_SC_SIGNALS
,

411 
	#_SC_SIGNALS
 
_SC_SIGNALS


	)

412 
	m_SC_SPAWN
,

413 
	#_SC_SPAWN
 
_SC_SPAWN


	)

414 
	m_SC_SPORADIC_SERVER
,

415 
	#_SC_SPORADIC_SERVER
 
_SC_SPORADIC_SERVER


	)

416 
	m_SC_THREAD_SPORADIC_SERVER
,

417 
	#_SC_THREAD_SPORADIC_SERVER
 
_SC_THREAD_SPORADIC_SERVER


	)

418 
	m_SC_SYSTEM_DATABASE
,

419 
	#_SC_SYSTEM_DATABASE
 
_SC_SYSTEM_DATABASE


	)

420 
	m_SC_SYSTEM_DATABASE_R
,

421 
	#_SC_SYSTEM_DATABASE_R
 
_SC_SYSTEM_DATABASE_R


	)

422 
	m_SC_TIMEOUTS
,

423 
	#_SC_TIMEOUTS
 
_SC_TIMEOUTS


	)

424 
	m_SC_TYPED_MEMORY_OBJECTS
,

425 
	#_SC_TYPED_MEMORY_OBJECTS
 
_SC_TYPED_MEMORY_OBJECTS


	)

426 
	m_SC_USER_GROUPS
,

427 
	#_SC_USER_GROUPS
 
_SC_USER_GROUPS


	)

428 
	m_SC_USER_GROUPS_R
,

429 
	#_SC_USER_GROUPS_R
 
_SC_USER_GROUPS_R


	)

430 
	m_SC_2_PBS
,

431 
	#_SC_2_PBS
 
_SC_2_PBS


	)

432 
	m_SC_2_PBS_ACCOUNTING
,

433 
	#_SC_2_PBS_ACCOUNTING
 
_SC_2_PBS_ACCOUNTING


	)

434 
	m_SC_2_PBS_LOCATE
,

435 
	#_SC_2_PBS_LOCATE
 
_SC_2_PBS_LOCATE


	)

436 
	m_SC_2_PBS_MESSAGE
,

437 
	#_SC_2_PBS_MESSAGE
 
_SC_2_PBS_MESSAGE


	)

438 
	m_SC_2_PBS_TRACK
,

439 
	#_SC_2_PBS_TRACK
 
_SC_2_PBS_TRACK


	)

440 
	m_SC_SYMLOOP_MAX
,

441 
	#_SC_SYMLOOP_MAX
 
_SC_SYMLOOP_MAX


	)

442 
	m_SC_STREAMS
,

443 
	#_SC_STREAMS
 
_SC_STREAMS


	)

444 
	m_SC_2_PBS_CHECKPOINT
,

445 
	#_SC_2_PBS_CHECKPOINT
 
_SC_2_PBS_CHECKPOINT


	)

447 
	m_SC_V6_ILP32_OFF32
,

448 
	#_SC_V6_ILP32_OFF32
 
_SC_V6_ILP32_OFF32


	)

449 
	m_SC_V6_ILP32_OFFBIG
,

450 
	#_SC_V6_ILP32_OFFBIG
 
_SC_V6_ILP32_OFFBIG


	)

451 
	m_SC_V6_LP64_OFF64
,

452 
	#_SC_V6_LP64_OFF64
 
_SC_V6_LP64_OFF64


	)

453 
	m_SC_V6_LPBIG_OFFBIG
,

454 
	#_SC_V6_LPBIG_OFFBIG
 
_SC_V6_LPBIG_OFFBIG


	)

456 
	m_SC_HOST_NAME_MAX
,

457 
	#_SC_HOST_NAME_MAX
 
_SC_HOST_NAME_MAX


	)

458 
	m_SC_TRACE
,

459 
	#_SC_TRACE
 
_SC_TRACE


	)

460 
	m_SC_TRACE_EVENT_FILTER
,

461 
	#_SC_TRACE_EVENT_FILTER
 
_SC_TRACE_EVENT_FILTER


	)

462 
	m_SC_TRACE_INHERIT
,

463 
	#_SC_TRACE_INHERIT
 
_SC_TRACE_INHERIT


	)

464 
	m_SC_TRACE_LOG
,

465 
	#_SC_TRACE_LOG
 
_SC_TRACE_LOG


	)

467 
	m_SC_LEVEL1_ICACHE_SIZE
,

468 
	#_SC_LEVEL1_ICACHE_SIZE
 
_SC_LEVEL1_ICACHE_SIZE


	)

469 
	m_SC_LEVEL1_ICACHE_ASSOC
,

470 
	#_SC_LEVEL1_ICACHE_ASSOC
 
_SC_LEVEL1_ICACHE_ASSOC


	)

471 
	m_SC_LEVEL1_ICACHE_LINESIZE
,

472 
	#_SC_LEVEL1_ICACHE_LINESIZE
 
_SC_LEVEL1_ICACHE_LINESIZE


	)

473 
	m_SC_LEVEL1_DCACHE_SIZE
,

474 
	#_SC_LEVEL1_DCACHE_SIZE
 
_SC_LEVEL1_DCACHE_SIZE


	)

475 
	m_SC_LEVEL1_DCACHE_ASSOC
,

476 
	#_SC_LEVEL1_DCACHE_ASSOC
 
_SC_LEVEL1_DCACHE_ASSOC


	)

477 
	m_SC_LEVEL1_DCACHE_LINESIZE
,

478 
	#_SC_LEVEL1_DCACHE_LINESIZE
 
_SC_LEVEL1_DCACHE_LINESIZE


	)

479 
	m_SC_LEVEL2_CACHE_SIZE
,

480 
	#_SC_LEVEL2_CACHE_SIZE
 
_SC_LEVEL2_CACHE_SIZE


	)

481 
	m_SC_LEVEL2_CACHE_ASSOC
,

482 
	#_SC_LEVEL2_CACHE_ASSOC
 
_SC_LEVEL2_CACHE_ASSOC


	)

483 
	m_SC_LEVEL2_CACHE_LINESIZE
,

484 
	#_SC_LEVEL2_CACHE_LINESIZE
 
_SC_LEVEL2_CACHE_LINESIZE


	)

485 
	m_SC_LEVEL3_CACHE_SIZE
,

486 
	#_SC_LEVEL3_CACHE_SIZE
 
_SC_LEVEL3_CACHE_SIZE


	)

487 
	m_SC_LEVEL3_CACHE_ASSOC
,

488 
	#_SC_LEVEL3_CACHE_ASSOC
 
_SC_LEVEL3_CACHE_ASSOC


	)

489 
	m_SC_LEVEL3_CACHE_LINESIZE
,

490 
	#_SC_LEVEL3_CACHE_LINESIZE
 
_SC_LEVEL3_CACHE_LINESIZE


	)

491 
	m_SC_LEVEL4_CACHE_SIZE
,

492 
	#_SC_LEVEL4_CACHE_SIZE
 
_SC_LEVEL4_CACHE_SIZE


	)

493 
	m_SC_LEVEL4_CACHE_ASSOC
,

494 
	#_SC_LEVEL4_CACHE_ASSOC
 
_SC_LEVEL4_CACHE_ASSOC


	)

495 
	m_SC_LEVEL4_CACHE_LINESIZE
,

496 
	#_SC_LEVEL4_CACHE_LINESIZE
 
_SC_LEVEL4_CACHE_LINESIZE


	)

499 
	m_SC_IPV6
 = 
_SC_LEVEL1_ICACHE_SIZE
 + 50,

500 
	#_SC_IPV6
 
_SC_IPV6


	)

501 
	m_SC_RAW_SOCKETS


502 
	#_SC_RAW_SOCKETS
 
_SC_RAW_SOCKETS


	)

508 
	m_CS_PATH
,

509 
	#_CS_PATH
 
_CS_PATH


	)

511 
	m_CS_V6_WIDTH_RESTRICTED_ENVS
,

512 
	#_CS_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

513 
	#_CS_POSIX_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

515 
	m_CS_GNU_LIBC_VERSION
,

516 
	#_CS_GNU_LIBC_VERSION
 
_CS_GNU_LIBC_VERSION


	)

517 
	m_CS_GNU_LIBPTHREAD_VERSION
,

518 
	#_CS_GNU_LIBPTHREAD_VERSION
 
_CS_GNU_LIBPTHREAD_VERSION


	)

520 
	m_CS_LFS_CFLAGS
 = 1000,

521 
	#_CS_LFS_CFLAGS
 
_CS_LFS_CFLAGS


	)

522 
	m_CS_LFS_LDFLAGS
,

523 
	#_CS_LFS_LDFLAGS
 
_CS_LFS_LDFLAGS


	)

524 
	m_CS_LFS_LIBS
,

525 
	#_CS_LFS_LIBS
 
_CS_LFS_LIBS


	)

526 
	m_CS_LFS_LINTFLAGS
,

527 
	#_CS_LFS_LINTFLAGS
 
_CS_LFS_LINTFLAGS


	)

528 
	m_CS_LFS64_CFLAGS
,

529 
	#_CS_LFS64_CFLAGS
 
_CS_LFS64_CFLAGS


	)

530 
	m_CS_LFS64_LDFLAGS
,

531 
	#_CS_LFS64_LDFLAGS
 
_CS_LFS64_LDFLAGS


	)

532 
	m_CS_LFS64_LIBS
,

533 
	#_CS_LFS64_LIBS
 
_CS_LFS64_LIBS


	)

534 
	m_CS_LFS64_LINTFLAGS
,

535 
	#_CS_LFS64_LINTFLAGS
 
_CS_LFS64_LINTFLAGS


	)

537 
	m_CS_XBS5_ILP32_OFF32_CFLAGS
 = 1100,

538 
	#_CS_XBS5_ILP32_OFF32_CFLAGS
 
_CS_XBS5_ILP32_OFF32_CFLAGS


	)

539 
	m_CS_XBS5_ILP32_OFF32_LDFLAGS
,

540 
	#_CS_XBS5_ILP32_OFF32_LDFLAGS
 
_CS_XBS5_ILP32_OFF32_LDFLAGS


	)

541 
	m_CS_XBS5_ILP32_OFF32_LIBS
,

542 
	#_CS_XBS5_ILP32_OFF32_LIBS
 
_CS_XBS5_ILP32_OFF32_LIBS


	)

543 
	m_CS_XBS5_ILP32_OFF32_LINTFLAGS
,

544 
	#_CS_XBS5_ILP32_OFF32_LINTFLAGS
 
_CS_XBS5_ILP32_OFF32_LINTFLAGS


	)

545 
	m_CS_XBS5_ILP32_OFFBIG_CFLAGS
,

546 
	#_CS_XBS5_ILP32_OFFBIG_CFLAGS
 
_CS_XBS5_ILP32_OFFBIG_CFLAGS


	)

547 
	m_CS_XBS5_ILP32_OFFBIG_LDFLAGS
,

548 
	#_CS_XBS5_ILP32_OFFBIG_LDFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LDFLAGS


	)

549 
	m_CS_XBS5_ILP32_OFFBIG_LIBS
,

550 
	#_CS_XBS5_ILP32_OFFBIG_LIBS
 
_CS_XBS5_ILP32_OFFBIG_LIBS


	)

551 
	m_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
,

552 
	#_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LINTFLAGS


	)

553 
	m_CS_XBS5_LP64_OFF64_CFLAGS
,

554 
	#_CS_XBS5_LP64_OFF64_CFLAGS
 
_CS_XBS5_LP64_OFF64_CFLAGS


	)

555 
	m_CS_XBS5_LP64_OFF64_LDFLAGS
,

556 
	#_CS_XBS5_LP64_OFF64_LDFLAGS
 
_CS_XBS5_LP64_OFF64_LDFLAGS


	)

557 
	m_CS_XBS5_LP64_OFF64_LIBS
,

558 
	#_CS_XBS5_LP64_OFF64_LIBS
 
_CS_XBS5_LP64_OFF64_LIBS


	)

559 
	m_CS_XBS5_LP64_OFF64_LINTFLAGS
,

560 
	#_CS_XBS5_LP64_OFF64_LINTFLAGS
 
_CS_XBS5_LP64_OFF64_LINTFLAGS


	)

561 
	m_CS_XBS5_LPBIG_OFFBIG_CFLAGS
,

562 
	#_CS_XBS5_LPBIG_OFFBIG_CFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_CFLAGS


	)

563 
	m_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
,

564 
	#_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LDFLAGS


	)

565 
	m_CS_XBS5_LPBIG_OFFBIG_LIBS
,

566 
	#_CS_XBS5_LPBIG_OFFBIG_LIBS
 
_CS_XBS5_LPBIG_OFFBIG_LIBS


	)

567 
	m_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
,

568 
	#_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS


	)

570 
	m_CS_POSIX_V6_ILP32_OFF32_CFLAGS
,

571 
	#_CS_POSIX_V6_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_CFLAGS


	)

572 
	m_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
,

573 
	#_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LDFLAGS


	)

574 
	m_CS_POSIX_V6_ILP32_OFF32_LIBS
,

575 
	#_CS_POSIX_V6_ILP32_OFF32_LIBS
 
_CS_POSIX_V6_ILP32_OFF32_LIBS


	)

576 
	m_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
,

577 
	#_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS


	)

578 
	m_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
,

579 
	#_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS


	)

580 
	m_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
,

581 
	#_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS


	)

582 
	m_CS_POSIX_V6_ILP32_OFFBIG_LIBS
,

583 
	#_CS_POSIX_V6_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V6_ILP32_OFFBIG_LIBS


	)

584 
	m_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
,

585 
	#_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS


	)

586 
	m_CS_POSIX_V6_LP64_OFF64_CFLAGS
,

587 
	#_CS_POSIX_V6_LP64_OFF64_CFLAGS
 
_CS_POSIX_V6_LP64_OFF64_CFLAGS


	)

588 
	m_CS_POSIX_V6_LP64_OFF64_LDFLAGS
,

589 
	#_CS_POSIX_V6_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LDFLAGS


	)

590 
	m_CS_POSIX_V6_LP64_OFF64_LIBS
,

591 
	#_CS_POSIX_V6_LP64_OFF64_LIBS
 
_CS_POSIX_V6_LP64_OFF64_LIBS


	)

592 
	m_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
,

593 
	#_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LINTFLAGS


	)

594 
	m_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
,

595 
	#_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS


	)

596 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
,

597 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS


	)

598 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
,

599 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LIBS


	)

600 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS


601 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS


	)

	@/usr/include/bits/environments.h

19 #i‚de‡
_UNISTD_H


41 
	#_POSIX_V6_ILP32_OFF32
 1

	)

42 
	#_POSIX_V6_ILP32_OFFBIG
 1

	)

43 
	#_XBS5_ILP32_OFF32
 1

	)

44 
	#_XBS5_ILP32_OFFBIG
 1

	)

57 
	#__ILP32_OFF32_CFLAGS
 "-m32"

	)

58 
	#__ILP32_OFFBIG_CFLAGS
 "-m32 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64"

	)

59 
	#__ILP32_OFF32_LDFLAGS
 "-m32"

	)

60 
	#__ILP32_OFFBIG_LDFLAGS
 "-m32"

	)

61 
	#__LP64_OFF64_CFLAGS
 "-m64"

	)

62 
	#__LP64_OFF64_LDFLAGS
 "-m64"

	)

	@/usr/include/bits/errno.h

20 #ifde‡
_ERRNO_H


22 #unde‡
EDOM


23 #unde‡
EILSEQ


24 #unde‡
ERANGE


25 
	~<löux/î∫o.h
>

28 
	#ENOTSUP
 
EOPNOTSUPP


	)

31 #i‚de‡
ECANCELED


32 
	#ECANCELED
 125

	)

36 #i‚de‡
EOWNERDEAD


37 
	#EOWNERDEAD
 130

	)

38 
	#ENOTRECOVERABLE
 131

	)

41 #i‚de‡
__ASSEMBLER__


43 *
	$__î∫o_loˇti⁄
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

45 #i‡!
deföed
 
_LIBC
 || deföed 
_LIBC_REENTRANT


47 
	#î∫o
 (*
	`__î∫o_loˇti⁄
 ())

	)

52 #i‡!
deföed
 
_ERRNO_H
 && deföed 
__√ed_Em©h


56 
	#EDOM
 33

	)

57 
	#EILSEQ
 84

	)

58 
	#ERANGE
 34

	)

	@/usr/include/bits/fcntl.h

21 #i‚def 
_FCNTL_H


25 
	~<sys/ty≥s.h
>

26 #ifde‡
__USE_GNU


27 
	~<bôs/uio.h
>

33 
	#O_ACCMODE
 0003

	)

34 
	#O_RDONLY
 00

	)

35 
	#O_WRONLY
 01

	)

36 
	#O_RDWR
 02

	)

37 
	#O_CREAT
 0100

	)

38 
	#O_EXCL
 0200

	)

39 
	#O_NOCTTY
 0400

	)

40 
	#O_TRUNC
 01000

	)

41 
	#O_APPEND
 02000

	)

42 
	#O_NONBLOCK
 04000

	)

43 
	#O_NDELAY
 
O_NONBLOCK


	)

44 
	#O_SYNC
 010000

	)

45 
	#O_FSYNC
 
O_SYNC


	)

46 
	#O_ASYNC
 020000

	)

48 #ifde‡
__USE_GNU


49 
	#O_DIRECT
 040000

	)

50 
	#O_DIRECTORY
 0200000

	)

51 
	#O_NOFOLLOW
 0400000

	)

52 
	#O_NOATIME
 01000000

	)

53 
	#O_CLOEXEC
 02000000

	)

59 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


60 
	#O_DSYNC
 
O_SYNC


	)

61 
	#O_RSYNC
 
O_SYNC


	)

64 #ifde‡
__USE_LARGEFILE64


65 
	#O_LARGEFILE
 0100000

	)

69 
	#F_DUPFD
 0

	)

70 
	#F_GETFD
 1

	)

71 
	#F_SETFD
 2

	)

72 
	#F_GETFL
 3

	)

73 
	#F_SETFL
 4

	)

74 #i‚de‡
__USE_FILE_OFFSET64


75 
	#F_GETLK
 5

	)

76 
	#F_SETLK
 6

	)

77 
	#F_SETLKW
 7

	)

79 
	#F_GETLK
 
F_GETLK64


	)

80 
	#F_SETLK
 
F_SETLK64


	)

81 
	#F_SETLKW
 
F_SETLKW64


	)

83 
	#F_GETLK64
 12

	)

84 
	#F_SETLK64
 13

	)

85 
	#F_SETLKW64
 14

	)

87 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_UNIX98


88 
	#F_SETOWN
 8

	)

89 
	#F_GETOWN
 9

	)

92 #ifde‡
__USE_GNU


93 
	#F_SETSIG
 10

	)

94 
	#F_GETSIG
 11

	)

97 #ifde‡
__USE_GNU


98 
	#F_SETLEASE
 1024

	)

99 
	#F_GETLEASE
 1025

	)

100 
	#F_NOTIFY
 1026

	)

101 
	#F_DUPFD_CLOEXEC
 1030

	)

106 
	#FD_CLOEXEC
 1

	)

109 
	#F_RDLCK
 0

	)

110 
	#F_WRLCK
 1

	)

111 
	#F_UNLCK
 2

	)

114 
	#F_EXLCK
 4

	)

115 
	#F_SHLCK
 8

	)

117 #ifde‡
__USE_BSD


119 
	#LOCK_SH
 1

	)

120 
	#LOCK_EX
 2

	)

121 
	#LOCK_NB
 4

	)

123 
	#LOCK_UN
 8

	)

126 #ifde‡
__USE_GNU


127 
	#LOCK_MAND
 32

	)

128 
	#LOCK_READ
 64

	)

129 
	#LOCK_WRITE
 128

	)

130 
	#LOCK_RW
 192

	)

133 #ifde‡
__USE_GNU


135 
	#DN_ACCESS
 0x00000001

	)

136 
	#DN_MODIFY
 0x00000002

	)

137 
	#DN_CREATE
 0x00000004

	)

138 
	#DN_DELETE
 0x00000008

	)

139 
	#DN_RENAME
 0x00000010

	)

140 
	#DN_ATTRIB
 0x00000020

	)

141 
	#DN_MULTISHOT
 0x80000000

	)

144 
	sÊock


146 
	ml_ty≥
;

147 
	ml_whí˚
;

148 #i‚de‡
__USE_FILE_OFFSET64


149 
__off_t
 
	ml_°¨t
;

150 
__off_t
 
	ml_Àn
;

152 
__off64_t
 
	ml_°¨t
;

153 
__off64_t
 
	ml_Àn
;

155 
__pid_t
 
	ml_pid
;

158 #ifde‡
__USE_LARGEFILE64


159 
	sÊock64


161 
	ml_ty≥
;

162 
	ml_whí˚
;

163 
__off64_t
 
	ml_°¨t
;

164 
__off64_t
 
	ml_Àn
;

165 
__pid_t
 
	ml_pid
;

171 #ifdef 
__USE_BSD


172 
	#FAPPEND
 
O_APPEND


	)

173 
	#FFSYNC
 
O_FSYNC


	)

174 
	#FASYNC
 
O_ASYNC


	)

175 
	#FNONBLOCK
 
O_NONBLOCK


	)

176 
	#FNDELAY
 
O_NDELAY


	)

180 #ifde‡
__USE_XOPEN2K


181 
	#POSIX_FADV_NORMAL
 0

	)

182 
	#POSIX_FADV_RANDOM
 1

	)

183 
	#POSIX_FADV_SEQUENTIAL
 2

	)

184 
	#POSIX_FADV_WILLNEED
 3

	)

185 
	#POSIX_FADV_DONTNEED
 4

	)

186 
	#POSIX_FADV_NOREUSE
 5

	)

190 #ifde‡
__USE_GNU


192 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

195 
	#SYNC_FILE_RANGE_WRITE
 2

	)

198 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

203 
	#SPLICE_F_MOVE
 1

	)

204 
	#SPLICE_F_NONBLOCK
 2

	)

207 
	#SPLICE_F_MORE
 4

	)

208 
	#SPLICE_F_GIFT
 8

	)

211 
	g__BEGIN_DECLS


213 #ifde‡
__USE_GNU


216 
ssize_t
 
	$ªadahód
 (
__fd
, 
__off64_t
 
__off£t
, 
size_t
 
__cou¡
)

217 
__THROW
;

221 
	`sync_fûe_ønge
 (
__fd
, 
__off64_t
 
__‰om
, __off64_à
__to
,

222 
__Êags
);

226 
ssize_t
 
	`vm•li˚
 (
__fdout
, c⁄° 
iovec
 *
__iov
,

227 
size_t
 
__cou¡
, 
__Êags
);

230 
ssize_t
 
	`•li˚
 (
__fdö
, 
__off64_t
 *
__offö
, 
__fdout
,

231 
__off64_t
 *
__offout
, 
size_t
 
__Àn
,

232 
__Êags
);

235 
ssize_t
 
	`ãe
 (
__fdö
, 
__fdout
, 
size_t
 
__Àn
,

236 
__Êags
);

240 
__END_DECLS


	@/usr/include/bits/fcntl2.h

20 #i‚def 
_FCNTL_H


26 #i‚de‡
__USE_FILE_OFFSET64


27 
	$__›í_2
 (
__c⁄°
 *
__∑th
, 
__oÊag
Ë
	`__n⁄nuŒ
 ((1));

28 
	`__REDIRECT
 (
__›í_Æüs
, (
__c⁄°
 *
__∑th
, 
__oÊag
, ...),

29 
›í
Ë
	`__n⁄nuŒ
 ((1));

31 
	`__REDIRECT
 (
__›í_2
, (
__c⁄°
 *
__∑th
, 
__oÊag
),

32 
__›í64_2
Ë
	`__n⁄nuŒ
 ((1));

33 
	`__REDIRECT
 (
__›í_Æüs
, (
__c⁄°
 *
__∑th
, 
__oÊag
, ...),

34 
›í64
Ë
	`__n⁄nuŒ
 ((1));

36 
	`__îr‹de˛
 (
__›í_too_m™y_¨gs
,

38 
	`__îr‹de˛
 (
__›í_missög_mode
,

41 
__exã∫_Æways_ölöe
 

42 
	$›í
 (
__c⁄°
 *
__∑th
, 
__oÊag
, ...)

44 i‡(
	`__va_¨g_∑ck_Àn
 () > 1)

45 
	`__›í_too_m™y_¨gs
 ();

47 i‡(
	`__buûtö_c⁄°™t_p
 (
__oÊag
))

49 i‡((
__oÊag
 & 
O_CREAT
Ë!0 && 
	`__va_¨g_∑ck_Àn
 () < 1)

51 
	`__›í_missög_mode
 ();

52  
	`__›í_2
 (
__∑th
, 
__oÊag
);

54  
	`__›í_Æüs
 (
__∑th
, 
__oÊag
, 
	`__va_¨g_∑ck
 ());

57 i‡(
	`__va_¨g_∑ck_Àn
 () < 1)

58  
	`__›í_2
 (
__∑th
, 
__oÊag
);

60  
	`__›í_Æüs
 (
__∑th
, 
__oÊag
, 
	`__va_¨g_∑ck
 ());

61 
	}
}

64 #ifde‡
__USE_LARGEFILE64


65 
	$__›í64_2
 (
__c⁄°
 *
__∑th
, 
__oÊag
Ë
	`__n⁄nuŒ
 ((1));

66 
	`__REDIRECT
 (
__›í64_Æüs
, (
__c⁄°
 *
__∑th
, 
__oÊag
,

67 ...), 
›í64
Ë
	`__n⁄nuŒ
 ((1));

68 
	`__îr‹de˛
 (
__›í64_too_m™y_¨gs
,

70 
	`__îr‹de˛
 (
__›í64_missög_mode
,

73 
__exã∫_Æways_ölöe
 

74 
	$›í64
 (
__c⁄°
 *
__∑th
, 
__oÊag
, ...)

76 i‡(
	`__va_¨g_∑ck_Àn
 () > 1)

77 
	`__›í64_too_m™y_¨gs
 ();

79 i‡(
	`__buûtö_c⁄°™t_p
 (
__oÊag
))

81 i‡((
__oÊag
 & 
O_CREAT
Ë!0 && 
	`__va_¨g_∑ck_Àn
 () < 1)

83 
	`__›í64_missög_mode
 ();

84  
	`__›í64_2
 (
__∑th
, 
__oÊag
);

86  
	`__›í64_Æüs
 (
__∑th
, 
__oÊag
, 
	`__va_¨g_∑ck
 ());

89 i‡(
	`__va_¨g_∑ck_Àn
 () < 1)

90  
	`__›í64_2
 (
__∑th
, 
__oÊag
);

92  
	`__›í64_Æüs
 (
__∑th
, 
__oÊag
, 
	`__va_¨g_∑ck
 ());

93 
	}
}

97 #ifde‡
__USE_ATFILE


98 #i‚de‡
__USE_FILE_OFFSET64


99 
	$__›í©_2
 (
__fd
, 
__c⁄°
 *
__∑th
, 
__oÊag
)

100 
	`__n⁄nuŒ
 ((2));

101 
	`__REDIRECT
 (
__›í©_Æüs
, (
__fd
, 
__c⁄°
 *
__∑th
,

102 
__oÊag
, ...), 
›í©
)

103 
	`__n⁄nuŒ
 ((2));

105 
	`__REDIRECT
 (
__›í©_2
, (
__fd
, 
__c⁄°
 *
__∑th
,

106 
__oÊag
), 
__›í©64_2
)

107 
	`__n⁄nuŒ
 ((2));

108 
	`__REDIRECT
 (
__›í©_Æüs
, (
__fd
, 
__c⁄°
 *
__∑th
,

109 
__oÊag
, ...), 
›í©64
)

110 
	`__n⁄nuŒ
 ((2));

112 
	`__îr‹de˛
 (
__›í©_too_m™y_¨gs
,

114 
	`__îr‹de˛
 (
__›í©_missög_mode
,

117 
__exã∫_Æways_ölöe
 

118 
	$›í©
 (
__fd
, 
__c⁄°
 *
__∑th
, 
__oÊag
, ...)

120 i‡(
	`__va_¨g_∑ck_Àn
 () > 1)

121 
	`__›í©_too_m™y_¨gs
 ();

123 i‡(
	`__buûtö_c⁄°™t_p
 (
__oÊag
))

125 i‡((
__oÊag
 & 
O_CREAT
Ë!0 && 
	`__va_¨g_∑ck_Àn
 () < 1)

127 
	`__›í©_missög_mode
 ();

128  
	`__›í©_2
 (
__fd
, 
__∑th
, 
__oÊag
);

130  
	`__›í©_Æüs
 (
__fd
, 
__∑th
, 
__oÊag
, 
	`__va_¨g_∑ck
 ());

133 i‡(
	`__va_¨g_∑ck_Àn
 () < 1)

134  
	`__›í©_2
 (
__fd
, 
__∑th
, 
__oÊag
);

136  
	`__›í©_Æüs
 (
__fd
, 
__∑th
, 
__oÊag
, 
	`__va_¨g_∑ck
 ());

137 
	}
}

140 #ifde‡
__USE_LARGEFILE64


141 
	$__›í©64_2
 (
__fd
, 
__c⁄°
 *
__∑th
, 
__oÊag
)

142 
	`__n⁄nuŒ
 ((2));

143 
	`__REDIRECT
 (
__›í©64_Æüs
, (
__fd
, 
__c⁄°
 *
__∑th
,

144 
__oÊag
, ...), 
›í©64
)

145 
	`__n⁄nuŒ
 ((2));

146 
	`__îr‹de˛
 (
__›í©64_too_m™y_¨gs
,

148 
	`__îr‹de˛
 (
__›í©64_missög_mode
,

151 
__exã∫_Æways_ölöe
 

152 
	$›í©64
 (
__fd
, 
__c⁄°
 *
__∑th
, 
__oÊag
, ...)

154 i‡(
	`__va_¨g_∑ck_Àn
 () > 1)

155 
	`__›í©64_too_m™y_¨gs
 ();

157 i‡(
	`__buûtö_c⁄°™t_p
 (
__oÊag
))

159 i‡((
__oÊag
 & 
O_CREAT
Ë!0 && 
	`__va_¨g_∑ck_Àn
 () < 1)

161 
	`__›í©64_missög_mode
 ();

162  
	`__›í©64_2
 (
__fd
, 
__∑th
, 
__oÊag
);

164  
	`__›í©64_Æüs
 (
__fd
, 
__∑th
, 
__oÊag
, 
	`__va_¨g_∑ck
 ());

167 i‡(
	`__va_¨g_∑ck_Àn
 () < 1)

168  
	`__›í©64_2
 (
__fd
, 
__∑th
, 
__oÊag
);

170  
	`__›í©64_Æüs
 (
__fd
, 
__∑th
, 
__oÊag
, 
	`__va_¨g_∑ck
 ());

171 
	}
}

	@/usr/include/bits/huge_val.h

22 #i‚de‡
_MATH_H


28 #i‡
__GNUC_PREREQ
(3,3)

29 
	#HUGE_VAL
 (
	`__buûtö_huge_vÆ
())

	)

30 #ñi‡
__GNUC_PREREQ
(2,96)

31 
	#HUGE_VAL
 (
__exãnsi⁄__
 0x1.0
p2047
)

	)

32 #ñi‡
deföed
 
__GNUC__


34 
	#HUGE_VAL
 \

35 (
__exãnsi⁄__
 \

36 ((uni⁄ { 
__l
 
	`__©åibuã__
((
	`__mode__
(
__DI__
))); 
__d
; }) \

37 { 
__l
: 0x7ff0000000000000ULL }).
__d
)

	)

41 
	~<ídün.h
>

43 uni⁄ { 
	m__c
[8]; 
	m__d
; } 
	t__huge_vÆ_t
;

45 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


46 
	#__HUGE_VAL_byãs
 { 0x7f, 0xf0, 0, 0, 0, 0, 0, 0 }

	)

48 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


49 
	#__HUGE_VAL_byãs
 { 0, 0, 0, 0, 0, 0, 0xf0, 0x7‡}

	)

52 
__huge_vÆ_t
 
	g__huge_vÆ
 = { 
__HUGE_VAL_byãs
 };

53 
	#HUGE_VAL
 (
__huge_vÆ
.
__d
)

	)

	@/usr/include/bits/huge_valf.h

22 #i‚de‡
_MATH_H


28 #i‡
__GNUC_PREREQ
(3,3)

29 
	#HUGE_VALF
 (
	`__buûtö_huge_vÆf
())

	)

30 #ñi‡
__GNUC_PREREQ
(2,96)

31 
	#HUGE_VALF
 (
__exãnsi⁄__
 0x1.0
p255f
)

	)

32 #ñi‡
deföed
 
__GNUC__


34 
	#HUGE_VALF
 \

35 (
__exãnsi⁄__
 \

36 ((uni⁄ { 
__l
 
	`__©åibuã__
((
	`__mode__
(
__SI__
))); 
__d
; }) \

37 { 
__l
: 0x7f800000UL }).
__d
)

	)

41 uni⁄ { 
	m__c
[4]; 
	m__f
; } 
	t__huge_vÆf_t
;

43 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


44 
	#__HUGE_VALF_byãs
 { 0x7f, 0x80, 0, 0 }

	)

46 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


47 
	#__HUGE_VALF_byãs
 { 0, 0, 0x80, 0x7‡}

	)

50 
__huge_vÆf_t
 
	g__huge_vÆf
 = { 
__HUGE_VALF_byãs
 };

51 
	#HUGE_VALF
 (
__huge_vÆf
.
__f
)

	)

	@/usr/include/bits/huge_vall.h

22 #i‚de‡
_MATH_H


26 #i‡
__GNUC_PREREQ
(3,3)

27 
	#HUGE_VALL
 (
	`__buûtö_huge_vÆl
())

	)

28 #ñi‡
__GNUC_PREREQ
(2,96)

29 
	#HUGE_VALL
 (
__exãnsi⁄__
 0x1.0
p32767L
)

	)

32 
	#__HUGE_VALL_byãs
 { 0, 0, 0, 0, 0, 0, 0, 0x80, 0xff, 0x7f, 0, 0 }

	)

34 
	#__huge_vÆl_t
 uni⁄ { 
__c
[12]; 
__ld
; }

	)

35 #ifde‡
__GNUC__


36 
	#HUGE_VALL
 (
__exãnsi⁄__
 \

37 ((
__huge_vÆl_t
Ë{ 
__c
: 
__HUGE_VALL_byãs
 }).
__ld
)

	)

39 
__huge_vÆl_t
 
	g__huge_vÆl
 = { 
__HUGE_VALL_byãs
 };

40 
	#HUGE_VALL
 (
__huge_vÆl
.
__ld
)

	)

	@/usr/include/bits/inf.h

20 #i‚de‡
_MATH_H


26 #i‡
__GNUC_PREREQ
(3,3)

27 
	#INFINITY
 (
	`__buûtö_öff
())

	)

29 
	#INFINITY
 
HUGE_VALF


	)

	@/usr/include/bits/ioctl-types.h

20 #i‚de‡
_SYS_IOCTL_H


25 
	~<asm/io˘ls.h
>

28 
	swösize


30 
	mws_row
;

31 
	mws_cﬁ
;

32 
	mws_xpixñ
;

33 
	mws_ypixñ
;

36 
	#NCC
 8

	)

37 
	sãrmio


39 
	mc_iÊag
;

40 
	mc_oÊag
;

41 
	mc_cÊag
;

42 
	mc_lÊag
;

43 
	mc_löe
;

44 
	mc_cc
[
NCC
];

48 
	#TIOCM_LE
 0x001

	)

49 
	#TIOCM_DTR
 0x002

	)

50 
	#TIOCM_RTS
 0x004

	)

51 
	#TIOCM_ST
 0x008

	)

52 
	#TIOCM_SR
 0x010

	)

53 
	#TIOCM_CTS
 0x020

	)

54 
	#TIOCM_CAR
 0x040

	)

55 
	#TIOCM_RNG
 0x080

	)

56 
	#TIOCM_DSR
 0x100

	)

57 
	#TIOCM_CD
 
TIOCM_CAR


	)

58 
	#TIOCM_RI
 
TIOCM_RNG


	)

63 
	#N_TTY
 0

	)

64 
	#N_SLIP
 1

	)

65 
	#N_MOUSE
 2

	)

66 
	#N_PPP
 3

	)

67 
	#N_STRIP
 4

	)

68 
	#N_AX25
 5

	)

69 
	#N_X25
 6

	)

70 
	#N_6PACK
 7

	)

71 
	#N_MASC
 8

	)

72 
	#N_R3964
 9

	)

73 
	#N_PROFIBUS_FDL
 10

	)

74 
	#N_IRDA
 11

	)

75 
	#N_SMSBLOCK
 12

	)

76 
	#N_HDLC
 13

	)

77 
	#N_SYNC_PPP
 14

	)

78 
	#N_HCI
 15

	)

	@/usr/include/bits/ioctls.h

19 #i‚de‡
_SYS_IOCTL_H


24 
	~<asm/io˘ls.h
>

27 
	#SIOCADDRT
 0x890B

	)

28 
	#SIOCDELRT
 0x890C

	)

29 
	#SIOCRTMSG
 0x890D

	)

32 
	#SIOCGIFNAME
 0x8910

	)

33 
	#SIOCSIFLINK
 0x8911

	)

34 
	#SIOCGIFCONF
 0x8912

	)

35 
	#SIOCGIFFLAGS
 0x8913

	)

36 
	#SIOCSIFFLAGS
 0x8914

	)

37 
	#SIOCGIFADDR
 0x8915

	)

38 
	#SIOCSIFADDR
 0x8916

	)

39 
	#SIOCGIFDSTADDR
 0x8917

	)

40 
	#SIOCSIFDSTADDR
 0x8918

	)

41 
	#SIOCGIFBRDADDR
 0x8919

	)

42 
	#SIOCSIFBRDADDR
 0x891®

	)

43 
	#SIOCGIFNETMASK
 0x891b

	)

44 
	#SIOCSIFNETMASK
 0x891¯

	)

45 
	#SIOCGIFMETRIC
 0x891d

	)

46 
	#SIOCSIFMETRIC
 0x891ê

	)

47 
	#SIOCGIFMEM
 0x891‡

	)

48 
	#SIOCSIFMEM
 0x8920

	)

49 
	#SIOCGIFMTU
 0x8921

	)

50 
	#SIOCSIFMTU
 0x8922

	)

51 
	#SIOCSIFNAME
 0x8923

	)

52 
	#SIOCSIFHWADDR
 0x8924

	)

53 
	#SIOCGIFENCAP
 0x8925

	)

54 
	#SIOCSIFENCAP
 0x8926

	)

55 
	#SIOCGIFHWADDR
 0x8927

	)

56 
	#SIOCGIFSLAVE
 0x8929

	)

57 
	#SIOCSIFSLAVE
 0x8930

	)

58 
	#SIOCADDMULTI
 0x8931

	)

59 
	#SIOCDELMULTI
 0x8932

	)

60 
	#SIOCGIFINDEX
 0x8933

	)

61 
	#SIOGIFINDEX
 
SIOCGIFINDEX


	)

62 
	#SIOCSIFPFLAGS
 0x8934

	)

63 
	#SIOCGIFPFLAGS
 0x8935

	)

64 
	#SIOCDIFADDR
 0x8936

	)

65 
	#SIOCSIFHWBROADCAST
 0x8937

	)

66 
	#SIOCGIFCOUNT
 0x8938

	)

68 
	#SIOCGIFBR
 0x8940

	)

69 
	#SIOCSIFBR
 0x8941

	)

71 
	#SIOCGIFTXQLEN
 0x8942

	)

72 
	#SIOCSIFTXQLEN
 0x8943

	)

77 
	#SIOCDARP
 0x8953

	)

78 
	#SIOCGARP
 0x8954

	)

79 
	#SIOCSARP
 0x8955

	)

82 
	#SIOCDRARP
 0x8960

	)

83 
	#SIOCGRARP
 0x8961

	)

84 
	#SIOCSRARP
 0x8962

	)

88 
	#SIOCGIFMAP
 0x8970

	)

89 
	#SIOCSIFMAP
 0x8971

	)

93 
	#SIOCADDDLCI
 0x8980

	)

94 
	#SIOCDELDLCI
 0x8981

	)

103 
	#SIOCDEVPRIVATE
 0x89F0

	)

109 
	#SIOCPROTOPRIVATE
 0x89E0

	)

	@/usr/include/bits/mathcalls.h

46 #i‚de‡
_MATH_H


53 
_MdoubÀ_BEGIN_NAMESPACE


55 
__MATHCALL
 (
acos
,, (
_MdoubÀ_
 
__x
));

57 
__MATHCALL
 (
asö
,, (
_MdoubÀ_
 
__x
));

59 
__MATHCALL
 (
©™
,, (
_MdoubÀ_
 
__x
));

61 
__MATHCALL
 (
©™2
,, (
_MdoubÀ_
 
__y
, _MdoubÀ_ 
__x
));

64 
__MATHCALL
 (
cos
,, (
_MdoubÀ_
 
__x
));

66 
__MATHCALL
 (
sö
,, (
_MdoubÀ_
 
__x
));

68 
__MATHCALL
 (
èn
,, (
_MdoubÀ_
 
__x
));

73 
__MATHCALL
 (
cosh
,, (
_MdoubÀ_
 
__x
));

75 
__MATHCALL
 (
söh
,, (
_MdoubÀ_
 
__x
));

77 
__MATHCALL
 (
ènh
,, (
_MdoubÀ_
 
__x
));

78 
	g_MdoubÀ_END_NAMESPACE


80 #ifde‡
__USE_GNU


82 
__MATHDECL
 (,
söcos
,,

83 (
_MdoubÀ_
 
__x
, _MdoubÀ_ *
__söx
, _MdoubÀ_ *
__cosx
));

86 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_ISOC99


87 
__BEGIN_NAMESPACE_C99


89 
__MATHCALL
 (
acosh
,, (
_MdoubÀ_
 
__x
));

91 
__MATHCALL
 (
asöh
,, (
_MdoubÀ_
 
__x
));

93 
__MATHCALL
 (
©™h
,, (
_MdoubÀ_
 
__x
));

94 
	g__END_NAMESPACE_C99


99 
_MdoubÀ_BEGIN_NAMESPACE


101 
__MATHCALL
 (
exp
,, (
_MdoubÀ_
 
__x
));

104 
__MATHCALL
 (
‰exp
,, (
_MdoubÀ_
 
__x
, *
__exp⁄ít
));

107 
__MATHCALL
 (
ldexp
,, (
_MdoubÀ_
 
__x
, 
__exp⁄ít
));

110 
__MATHCALL
 (
log
,, (
_MdoubÀ_
 
__x
));

113 
__MATHCALL
 (
log10
,, (
_MdoubÀ_
 
__x
));

116 
__MATHCALL
 (
modf
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ *
__ùå
));

117 
	g_MdoubÀ_END_NAMESPACE


119 #ifde‡
__USE_GNU


121 
__MATHCALL
 (
exp10
,, (
_MdoubÀ_
 
__x
));

123 
__MATHCALL
 (
pow10
,, (
_MdoubÀ_
 
__x
));

126 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_ISOC99


127 
__BEGIN_NAMESPACE_C99


129 
__MATHCALL
 (
expm1
,, (
_MdoubÀ_
 
__x
));

132 
__MATHCALL
 (
log1p
,, (
_MdoubÀ_
 
__x
));

135 
__MATHCALL
 (
logb
,, (
_MdoubÀ_
 
__x
));

136 
	g__END_NAMESPACE_C99


139 #ifde‡
__USE_ISOC99


140 
__BEGIN_NAMESPACE_C99


142 
__MATHCALL
 (
exp2
,, (
_MdoubÀ_
 
__x
));

145 
__MATHCALL
 (
log2
,, (
_MdoubÀ_
 
__x
));

146 
	g__END_NAMESPACE_C99


152 
_MdoubÀ_BEGIN_NAMESPACE


154 
__MATHCALL
 (
pow
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
));

157 
__MATHCALL
 (
sqπ
,, (
_MdoubÀ_
 
__x
));

158 
	g_MdoubÀ_END_NAMESPACE


160 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN
 || deföed 
__USE_ISOC99


161 
__BEGIN_NAMESPACE_C99


163 
__MATHCALL
 (
hypŸ
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
));

164 
	g__END_NAMESPACE_C99


167 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_ISOC99


168 
__BEGIN_NAMESPACE_C99


170 
__MATHCALL
 (
cbπ
,, (
_MdoubÀ_
 
__x
));

171 
	g__END_NAMESPACE_C99


177 
_MdoubÀ_BEGIN_NAMESPACE


179 
__MATHCALLX
 (
˚û
,, (
_MdoubÀ_
 
__x
), (
__c⁄°__
));

182 
__MATHCALLX
 (
Ábs
,, (
_MdoubÀ_
 
__x
), (
__c⁄°__
));

185 
__MATHCALLX
 (
Êo‹
,, (
_MdoubÀ_
 
__x
), (
__c⁄°__
));

188 
__MATHCALL
 (
fmod
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
));

193 
__MATHDECL_1
 (,
__isöf
,, (
_MdoubÀ_
 
__vÆue
)Ë
__©åibuã__
 ((
__c⁄°__
));

196 
__MATHDECL_1
 (,
__föôe
,, (
_MdoubÀ_
 
__vÆue
)Ë
__©åibuã__
 ((
__c⁄°__
));

197 
	g_MdoubÀ_END_NAMESPACE


199 #ifde‡
__USE_MISC


202 
__MATHDECL_1
 (,
isöf
,, (
_MdoubÀ_
 
__vÆue
)Ë
__©åibuã__
 ((
__c⁄°__
));

205 
__MATHDECL_1
 (,
föôe
,, (
_MdoubÀ_
 
__vÆue
)Ë
__©åibuã__
 ((
__c⁄°__
));

208 
__MATHCALL
 (
dªm
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
));

212 
__MATHCALL
 (
signifiˇnd
,, (
_MdoubÀ_
 
__x
));

215 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


216 
__BEGIN_NAMESPACE_C99


218 
__MATHCALLX
 (
c›ysign
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
), (
__c⁄°__
));

219 
	g__END_NAMESPACE_C99


222 #ifde‡
__USE_ISOC99


223 
__BEGIN_NAMESPACE_C99


225 
__MATHCALLX
 (
«n
,, (
__c⁄°
 *
__ègb
), (
__c⁄°__
));

226 
	g__END_NAMESPACE_C99


231 
__MATHDECL_1
 (,
__i¢™
,, (
_MdoubÀ_
 
__vÆue
)Ë
__©åibuã__
 ((
__c⁄°__
));

233 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


235 
__MATHDECL_1
 (,
i¢™
,, (
_MdoubÀ_
 
__vÆue
)Ë
__©åibuã__
 ((
__c⁄°__
));

238 
__MATHCALL
 (
j0
,, (
_MdoubÀ_
));

239 
__MATHCALL
 (
j1
,, (
_MdoubÀ_
));

240 
__MATHCALL
 (
jn
,, (, 
_MdoubÀ_
));

241 
__MATHCALL
 (
y0
,, (
_MdoubÀ_
));

242 
__MATHCALL
 (
y1
,, (
_MdoubÀ_
));

243 
__MATHCALL
 (
yn
,, (, 
_MdoubÀ_
));

247 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN
 || deföed 
__USE_ISOC99


248 
__BEGIN_NAMESPACE_C99


250 
__MATHCALL
 (
îf
,, (
_MdoubÀ_
));

251 
__MATHCALL
 (
îfc
,, (
_MdoubÀ_
));

252 
__MATHCALL
 (
lgamma
,, (
_MdoubÀ_
));

253 
	g__END_NAMESPACE_C99


256 #ifde‡
__USE_ISOC99


257 
__BEGIN_NAMESPACE_C99


259 
__MATHCALL
 (
tgamma
,, (
_MdoubÀ_
));

260 
	g__END_NAMESPACE_C99


263 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


265 
__MATHCALL
 (
gamma
,, (
_MdoubÀ_
));

268 #ifde‡
__USE_MISC


272 
__MATHCALL
 (
lgamma
,
_r
, (
_MdoubÀ_
, *
__signgamp
));

276 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_ISOC99


277 
__BEGIN_NAMESPACE_C99


280 
__MATHCALL
 (
röt
,, (
_MdoubÀ_
 
__x
));

283 
__MATHCALLX
 (
√xè·î
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
), (
__c⁄°__
));

284 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__LDBL_COMPAT


285 
__MATHCALLX
 (
√xâow¨d
,, (
_MdoubÀ_
 
__x
, 
__y
), (
__c⁄°__
));

289 
__MATHCALL
 (
ªmaödî
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
));

291 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


293 
__MATHCALL
 (
sˇlbn
,, (
_MdoubÀ_
 
__x
, 
__n
));

297 
__MATHDECL
 (,
ûogb
,, (
_MdoubÀ_
 
__x
));

300 #ifde‡
__USE_ISOC99


302 
__MATHCALL
 (
sˇlb 
,, (
_MdoubÀ_
 
__x
, 
__n
));

306 
__MATHCALL
 (
√¨byöt
,, (
_MdoubÀ_
 
__x
));

310 
__MATHCALLX
 (
round
,, (
_MdoubÀ_
 
__x
), (
__c⁄°__
));

314 
__MATHCALLX
 (
åunc
,, (
_MdoubÀ_
 
__x
), (
__c⁄°__
));

319 
__MATHCALL
 (
ªmquo
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
, *
__quo
));

326 
__MATHDECL
 (,
Ãöt
,, (
_MdoubÀ_
 
__x
));

327 
__MATHDECL
 (,
Œröt
,, (
_MdoubÀ_
 
__x
));

331 
__MATHDECL
 (,
Ãound
,, (
_MdoubÀ_
 
__x
));

332 
__MATHDECL
 (,
Œround
,, (
_MdoubÀ_
 
__x
));

336 
__MATHCALL
 (
fdim
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
));

339 
__MATHCALL
 (
fmax
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
));

342 
__MATHCALL
 (
fmö
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
));

346 
__MATHDECL_1
 (, 
__Â˛assify
,, (
_MdoubÀ_
 
__vÆue
))

347 
__©åibuã__
 ((
__c⁄°__
));

350 
__MATHDECL_1
 (, 
__signbô
,, (
_MdoubÀ_
 
__vÆue
))

351 
__©åibuã__
 ((
__c⁄°__
));

355 
__MATHCALL
 (
fma
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__y
, _MdoubÀ_ 
__z
));

358 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_ISOC99


359 
	g__END_NAMESPACE_C99


362 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


364 
__MATHCALL
 (
sˇlb
,, (
_MdoubÀ_
 
__x
, _MdoubÀ_ 
__n
));

	@/usr/include/bits/mathdef.h

19 #i‡!
deföed
 
_MATH_H
 && !deföed 
_COMPLEX_H


23 #i‡
deföed
 
__USE_ISOC99
 && deföed 
_MATH_H
 && !deföed 
_MATH_H_MATHDEF


24 
	#_MATH_H_MATHDEF
 1

	)

26 #i‡
deföed
 
__FLT_EVAL_METHOD__
 && __FLT_EVAL_METHOD__ == 0

29 
	tÊﬂt_t
;

30 
	tdoubÀ_t
;

36 
	tÊﬂt_t
;

38 
	tdoubÀ_t
;

43 
	#FP_ILOGB0
 (-2147483647 - 1)

	)

44 
	#FP_ILOGBNAN
 (-2147483647 - 1)

	)

	@/usr/include/bits/mathinline.h

22 #i‚de‡
_MATH_H


26 #i‚de‡
__exã∫_ölöe


27 
	#__MATH_INLINE
 
__ölöe


	)

29 
	#__MATH_INLINE
 
__exã∫_ölöe


	)

33 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__
 && __GNUC__ >= 2

35 #i‡!
__GNUC_PREREQ
 (2,97)

40 #unde‡
isgª©î


41 #unde‡
isgª©îequÆ


42 #unde‡
i¶ess


43 #unde‡
i¶es£quÆ


44 #unde‡
i¶essgª©î


45 #unde‡
isun‹dîed


46 #ifde‡
__i686__


49 
	#isgª©î
(
x
, 
y
) \

50 ({ 
__ªsu…
; \

51 
	`__asm__
 ("fucomip %%st(1), %%st; seta %%al" \

52 : "˜" (
__ªsu…
Ë: "u" (
y
), "t" (
x
) : "cc", "st"); \

53 
__ªsu…
; })

	)

54 
	#isgª©îequÆ
(
x
, 
y
) \

55 ({ 
__ªsu…
; \

56 
	`__asm__
 ("fucomip %%st(1), %%st; setae %%al" \

57 : "˜" (
__ªsu…
Ë: "u" (
y
), "t" (
x
) : "cc", "st"); \

58 
__ªsu…
; })

	)

60 
	#i¶ess
(
x
, 
y
) \

61 ({ 
__ªsu…
; \

62 
	`__asm__
 ("fucomip %%st(1), %%st; seta %%al" \

63 : "˜" (
__ªsu…
Ë: "u" (
x
), "t" (
y
) : "cc", "st"); \

64 
__ªsu…
; })

	)

66 
	#i¶es£quÆ
(
x
, 
y
) \

67 ({ 
__ªsu…
; \

68 
	`__asm__
 ("fucomip %%st(1), %%st; setae %%al" \

69 : "˜" (
__ªsu…
Ë: "u" (
x
), "t" (
y
) : "cc", "st"); \

70 
__ªsu…
; })

	)

72 
	#i¶essgª©î
(
x
, 
y
) \

73 ({ 
__ªsu…
; \

74 
	`__asm__
 ("fucomip %%st(1), %%st; setne %%al" \

75 : "˜" (
__ªsu…
Ë: "u" (
y
), "t" (
x
) : "cc", "st"); \

76 
__ªsu…
; })

	)

78 
	#isun‹dîed
(
x
, 
y
) \

79 ({ 
__ªsu…
; \

80 
	`__asm__
 ("fucomip %%st(1), %%st; setp %%al" \

81 : "˜" (
__ªsu…
Ë: "u" (
y
), "t" (
x
) : "cc", "st"); \

82 
__ªsu…
; })

	)

85 
	#isgª©î
(
x
, 
y
) \

86 ({ 
__ªsu…
; \

87 
	`__asm__
 ("fucompp; fnstsw;Åestb $0x45, %%ah; setz %%al" \

88 : "˜" (
__ªsu…
Ë: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

89 
__ªsu…
; })

	)

91 
	#isgª©îequÆ
(
x
, 
y
) \

92 ({ 
__ªsu…
; \

93 
	`__asm__
 ("fucompp; fnstsw;Åestb $0x05, %%ah; setz %%al" \

94 : "˜" (
__ªsu…
Ë: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

95 
__ªsu…
; })

	)

97 
	#i¶ess
(
x
, 
y
) \

98 ({ 
__ªsu…
; \

99 
	`__asm__
 ("fucompp; fnstsw;Åestb $0x45, %%ah; setz %%al" \

100 : "˜" (
__ªsu…
Ë: "u" (
x
), "t" (
y
) : "cc", "st", "st(1)"); \

101 
__ªsu…
; })

	)

103 
	#i¶es£quÆ
(
x
, 
y
) \

104 ({ 
__ªsu…
; \

105 
	`__asm__
 ("fucompp; fnstsw;Åestb $0x05, %%ah; setz %%al" \

106 : "˜" (
__ªsu…
Ë: "u" (
x
), "t" (
y
) : "cc", "st", "st(1)"); \

107 
__ªsu…
; })

	)

109 
	#i¶essgª©î
(
x
, 
y
) \

110 ({ 
__ªsu…
; \

111 
	`__asm__
 ("fucompp; fnstsw;Åestb $0x44, %%ah; setz %%al" \

112 : "˜" (
__ªsu…
Ë: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

113 
__ªsu…
; })

	)

115 
	#isun‹dîed
(
x
, 
y
) \

116 ({ 
__ªsu…
; \

117 
	`__asm__
 ("fucompp; fnstsw; sahf; setp %%al" \

118 : "˜" (
__ªsu…
Ë: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

119 
__ªsu…
; })

	)

125 #i‡
__GNUC_PREREQ
 (2, 8)

127 
__MATH_INLINE
 

128 
__NTH
 (
	$__signbôf
 (
__x
))

130 
__exãnsi⁄__
 uni⁄ { 
__f
; 
__i
; } 
__u
 = { __f: 
__x
 };

131  
__u
.
__i
 < 0;

132 
	}
}

133 
__MATH_INLINE
 

134 
__NTH
 (
	$__signbô
 (
__x
))

136 
__exãnsi⁄__
 uni⁄ { 
__d
; 
__i
[2]; } 
__u
 = { __d: 
__x
 };

137  
__u
.
__i
[1] < 0;

138 
	}
}

139 
__MATH_INLINE
 

140 
__NTH
 (
	$__signbôl
 (
__x
))

142 
__exãnsi⁄__
 uni⁄ { 
__l
; 
__i
[3]; } 
__u
 = { __l: 
__x
 };

143  (
__u
.
__i
[2] & 0x8000) != 0;

144 
	}
}

151 #i‡
__GNUC_PREREQ
 (2, 8)

153 #i‡((!
deföed
 
__NO_MATH_INLINES
 || deföed 
__LIBC_INTERNAL_MATH_INLINES
) \

154 && 
deföed
 
	g__OPTIMIZE__
)

163 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


164 
	#__ölöe_m©h›
(
func
, 
›
) \

165 
	`__ölöe_m©h›_
 (, 
func
, 
›
) \

166 
	`__ölöe_m©h›_
 (, 
	`__CONCAT
(
func
,
f
), 
›
) \

167 
	`__ölöe_m©h›_
 (, 
	`__CONCAT
(
func
,
l
), 
›
)

	)

168 
	#__ölöe_m©h›NP
(
func
, 
›
) \

169 
	`__ölöe_m©h›NP_
 (, 
func
, 
›
) \

170 
	`__ölöe_m©h›NP_
 (, 
	`__CONCAT
(
func
,
f
), 
›
) \

171 
	`__ölöe_m©h›NP_
 (, 
	`__CONCAT
(
func
,
l
), 
›
)

	)

173 
	#__ölöe_m©h›
(
func
, 
›
) \

174 
	`__ölöe_m©h›_
 (, 
func
, 
›
)

	)

175 
	#__ölöe_m©h›NP
(
func
, 
›
) \

176 
	`__ölöe_m©h›NP_
 (, 
func
, 
›
)

	)

179 
	#__ölöe_m©h›_
(
Êﬂt_ty≥
, 
func
, 
›
) \

180 
	`__ölöe_m©h›_de˛_
 (
Êﬂt_ty≥
, 
func
, 
›
, "0" (
__x
))

	)

181 
	#__ölöe_m©h›NP_
(
Êﬂt_ty≥
, 
func
, 
›
) \

182 
	`__ölöe_m©h›_de˛NP_
 (
Êﬂt_ty≥
, 
func
, 
›
, "0" (
__x
))

	)

185 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


186 
	#__ölöe_m©h›_de˛
(
func
, 
›
, 
∑øms
...) \

187 
	`__ölöe_m©h›_de˛_
 (, 
func
, 
›
, 
∑øms
) \

188 
	`__ölöe_m©h›_de˛_
 (, 
	`__CONCAT
(
func
,
f
), 
›
, 
∑øms
) \

189 
	`__ölöe_m©h›_de˛_
 (, 
	`__CONCAT
(
func
,
l
), 
›
, 
∑øms
)

	)

190 
	#__ölöe_m©h›_de˛NP
(
func
, 
›
, 
∑øms
...) \

191 
	`__ölöe_m©h›_de˛NP_
 (, 
func
, 
›
, 
∑øms
) \

192 
	`__ölöe_m©h›_de˛NP_
 (, 
	`__CONCAT
(
func
,
f
), 
›
, 
∑øms
) \

193 
	`__ölöe_m©h›_de˛NP_
 (, 
	`__CONCAT
(
func
,
l
), 
›
, 
∑øms
)

	)

195 
	#__ölöe_m©h›_de˛
(
func
, 
›
, 
∑øms
...) \

196 
	`__ölöe_m©h›_de˛_
 (, 
func
, 
›
, 
∑øms
)

	)

197 
	#__ölöe_m©h›_de˛NP
(
func
, 
›
, 
∑øms
...) \

198 
	`__ölöe_m©h›_de˛NP_
 (, 
func
, 
›
, 
∑øms
)

	)

201 
	#__ölöe_m©h›_de˛_
(
Êﬂt_ty≥
, 
func
, 
›
, 
∑øms
...) \

202 
__MATH_INLINE
 
Êﬂt_ty≥
 
	`func
 (Êﬂt_ty≥Ë
__THROW
; \

203 
	`__ölöe_m©h›_de˛NP_
 (
Êﬂt_ty≥
, 
func
, 
›
, 
∑øms
)

	)

205 
	#__ölöe_m©h›_de˛NP_
(
Êﬂt_ty≥
, 
func
, 
›
, 
∑øms
...) \

206 
__MATH_INLINE
 
Êﬂt_ty≥
 
	`__NTH
 (
	`func
 (Êﬂt_ty≥ 
__x
)) \

208 
Êﬂt_ty≥
 
__ªsu…
; \

209 
__asm
 
	`__vﬁ©ûe__
 (
›
 : "Ò" (
__ªsu…
Ë: 
∑øms
); \

210  
__ªsu…
; \

211 }

	)

214 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


215 
	#__ölöe_m©hcode
(
func
, 
¨g
, 
code
) \

216 
	`__ölöe_m©hcode_
 (, 
func
, 
¨g
, 
code
) \

217 
	`__ölöe_m©hcode_
 (, 
	`__CONCAT
(
func
,
f
), 
¨g
, 
code
) \

218 
	`__ölöe_m©hcode_
 (, 
	`__CONCAT
(
func
,
l
), 
¨g
, 
code
)

	)

219 
	#__ölöe_m©hcodeNP
(
func
, 
¨g
, 
code
) \

220 
	`__ölöe_m©hcodeNP_
 (, 
func
, 
¨g
, 
code
) \

221 
	`__ölöe_m©hcodeNP_
 (, 
	`__CONCAT
(
func
,
f
), 
¨g
, 
code
) \

222 
	`__ölöe_m©hcodeNP_
 (, 
	`__CONCAT
(
func
,
l
), 
¨g
, 
code
)

	)

223 
	#__ölöe_m©hcode2
(
func
, 
¨g1
, 
¨g2
, 
code
) \

224 
	`__ölöe_m©hcode2_
 (, 
func
, 
¨g1
, 
¨g2
, 
code
) \

225 
	`__ölöe_m©hcode2_
 (, 
	`__CONCAT
(
func
,
f
), 
¨g1
, 
¨g2
, 
code
) \

226 
	`__ölöe_m©hcode2_
 (, 
	`__CONCAT
(
func
,
l
), 
¨g1
, 
¨g2
, 
code
)

	)

227 
	#__ölöe_m©hcodeNP2
(
func
, 
¨g1
, 
¨g2
, 
code
) \

228 
	`__ölöe_m©hcodeNP2_
 (, 
func
, 
¨g1
, 
¨g2
, 
code
) \

229 
	`__ölöe_m©hcodeNP2_
 (, 
	`__CONCAT
(
func
,
f
), 
¨g1
, 
¨g2
, 
code
) \

230 
	`__ölöe_m©hcodeNP2_
 (, 
	`__CONCAT
(
func
,
l
), 
¨g1
, 
¨g2
, 
code
)

	)

231 
	#__ölöe_m©hcode3
(
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

232 
	`__ölöe_m©hcode3_
 (, 
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

233 
	`__ölöe_m©hcode3_
 (, 
	`__CONCAT
(
func
,
f
), 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

234 
	`__ölöe_m©hcode3_
 (, 
	`__CONCAT
(
func
,
l
), 
¨g1
, 
¨g2
, 
¨g3
, 
code
)

	)

235 
	#__ölöe_m©hcodeNP3
(
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

236 
	`__ölöe_m©hcodeNP3_
 (, 
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

237 
	`__ölöe_m©hcodeNP3_
 (, 
	`__CONCAT
(
func
,
f
), 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

238 
	`__ölöe_m©hcodeNP3_
 (, 
	`__CONCAT
(
func
,
l
), 
¨g1
, 
¨g2
, 
¨g3
, 
code
)

	)

240 
	#__ölöe_m©hcode
(
func
, 
¨g
, 
code
) \

241 
	`__ölöe_m©hcode_
 (, 
func
, (
¨g
), 
code
)

	)

242 
	#__ölöe_m©hcodeNP
(
func
, 
¨g
, 
code
) \

243 
	`__ölöe_m©hcodeNP_
 (, 
func
, (
¨g
), 
code
)

	)

244 
	#__ölöe_m©hcode2
(
func
, 
¨g1
, 
¨g2
, 
code
) \

245 
	`__ölöe_m©hcode2_
 (, 
func
, 
¨g1
, 
¨g2
, 
code
)

	)

246 
	#__ölöe_m©hcodeNP2
(
func
, 
¨g1
, 
¨g2
, 
code
) \

247 
	`__ölöe_m©hcodeNP2_
 (, 
func
, 
¨g1
, 
¨g2
, 
code
)

	)

248 
	#__ölöe_m©hcode3
(
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

249 
	`__ölöe_m©hcode3_
 (, 
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
)

	)

250 
	#__ölöe_m©hcodeNP3
(
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

251 
	`__ölöe_m©hcodeNP3_
 (, 
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
)

	)

254 
	#__ölöe_m©hcode_
(
Êﬂt_ty≥
, 
func
, 
¨g
, 
code
) \

255 
__MATH_INLINE
 
Êﬂt_ty≥
 
	`func
 (Êﬂt_ty≥Ë
__THROW
; \

256 
	`__ölöe_m©hcodeNP_
(
Êﬂt_ty≥
, 
func
, 
¨g
, 
code
)

	)

258 
	#__ölöe_m©hcodeNP_
(
Êﬂt_ty≥
, 
func
, 
¨g
, 
code
) \

259 
__MATH_INLINE
 
Êﬂt_ty≥
 
	`__NTH
 (
	`func
 (Êﬂt_ty≥ 
¨g
)) \

261 
code
; \

262 }

	)

265 
	#__ölöe_m©hcode2_
(
Êﬂt_ty≥
, 
func
, 
¨g1
, 
¨g2
, 
code
) \

266 
__MATH_INLINE
 
Êﬂt_ty≥
 
	`func
 (Êﬂt_ty≥, flﬂt_ty≥Ë
__THROW
; \

267 
	`__ölöe_m©hcodeNP2_
 (
Êﬂt_ty≥
, 
func
, 
¨g1
, 
¨g2
, 
code
)

	)

269 
	#__ölöe_m©hcodeNP2_
(
Êﬂt_ty≥
, 
func
, 
¨g1
, 
¨g2
, 
code
) \

270 
__MATH_INLINE
 
Êﬂt_ty≥
 
	`__NTH
 (
	`func
 (Êﬂt_ty≥ 
¨g1
, flﬂt_ty≥ 
¨g2
)) \

272 
code
; \

273 }

	)

275 
	#__ölöe_m©hcode3_
(
Êﬂt_ty≥
, 
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

276 
__MATH_INLINE
 
Êﬂt_ty≥
 
	`func
 (Êﬂt_ty≥, flﬂt_ty≥, flﬂt_ty≥Ë
__THROW
; \

277 
	`__ölöe_m©hcodeNP3_
(
Êﬂt_ty≥
, 
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
)

	)

279 
	#__ölöe_m©hcodeNP3_
(
Êﬂt_ty≥
, 
func
, 
¨g1
, 
¨g2
, 
¨g3
, 
code
) \

280 
__MATH_INLINE
 
Êﬂt_ty≥
 
	`__NTH
 (
	`func
 (Êﬂt_ty≥ 
¨g1
, flﬂt_ty≥ 
¨g2
, \

281 
Êﬂt_ty≥
 
¨g3
)) \

283 
code
; \

284 }

	)

288 #i‡!
deföed
 
__NO_MATH_INLINES
 && deföed 
__OPTIMIZE__


291 
__ölöe_m©hcode
 (
__sgn
, 
__x
, \

292  
__x
 == 0.0 ? 0.0 : (__x > 0.0 ? 1.0 : -1.0))

295 #ifde‡
__FAST_MATH__


296 
__ölöe_m©hcode
 (
__pow2
, 
__x
, \

297 
__vÆue
; \

298 
__exp⁄ít
; \

299 
__exãnsi⁄__
 
__p
 = (Ë
__x
; \

300 i‡(
__x
 =(Ë
__p
) \

302 
__asm
 
__vﬁ©ûe__
 \

304 : "Ò" (
__vÆue
Ë: "0" (1.0), "u" (
__x
)); \

305  
__vÆue
; \

307 
__asm
 
__vﬁ©ûe__
 \

313 : "Ò" (
__vÆue
), "=u" (
__exp⁄ít
Ë: "0" (
__x
)); \

314 
__vÆue
 += 1.0; \

315 
__asm
 
__vﬁ©ûe__
 \

317 : "Ò" (
__vÆue
Ë: "0" (__vÆue), "u" (
__exp⁄ít
)); \

318  
__vÆue
)

320 #ifde‡
__USE_GNU


321 
	#__söcos_code
 \

322 
__co§
; \

323 
__sör
; \

324 
__asm
 
__vﬁ©ûe__
 \

339 : "Ò" (
__co§
), "=u" (
__sör
Ë: "0" (
__x
)); \

340 *
__söx
 = 
__sör
; \

341 *
__cosx
 = 
__co§


	)

343 
__MATH_INLINE
 

344 
__NTH
 (
	$__söcos
 (
__x
, *
__söx
, *
__cosx
))

346 
__söcos_code
;

347 
	}
}

349 
__MATH_INLINE
 

350 
__NTH
 (
	$__söcosf
 (
__x
, *
__söx
, *
__cosx
))

352 
__söcos_code
;

353 
	}
}

355 
__MATH_INLINE
 

356 
__NTH
 (
	$__söco¶
 (
__x
, *
__söx
, *
__cosx
))

358 
__söcos_code
;

359 
	}
}

366 #i‡
__GNUC_PREREQ
 (3, 5)

367 
	#__expm1_code
 \

368 
__ãmp
; \

369 
__ãmp
 = 
	`__buûtö_expm1l
 (
__x
); \

370  
__ãmp
 ? __ãm∞: 
__x


	)

372 
	#__expm1_code
 \

373 
__vÆue
; \

374 
__exp⁄ít
; \

375 
__ãmp
; \

376 
__asm
 
__vﬁ©ûe__
 \

385 : "Ò" (
__vÆue
), "=u" (
__exp⁄ít
Ë: "0" (
__x
)); \

386 
__asm
 
__vﬁ©ûe__
 \

388 : "Ò" (
__ãmp
Ë: "0" (1.0), "u" (
__exp⁄ít
)); \

389 
__ãmp
 -= 1.0; \

390 
__ãmp
 +
__vÆue
; \

391  
__ãmp
 ? __ãm∞: 
__x


	)

393 
	$__ölöe_m©hcodeNP_
 (, 
__expm1l
, 
__x
, 
__expm1_code
)

395 #i‡
	`__GNUC_PREREQ
 (3, 4)

396 
	`__ölöe_m©hcodeNP_
 (, 
__ex∂
, 
__x
,  
	$__buûtö_ex∂
 (
__x
))

398 
	#__exp_code
 \

399 
__vÆue
; \

400 
__exp⁄ít
; \

401 
__asm
 
__vﬁ©ûe__
 \

409 : "Ò" (
__vÆue
), "=u" (
__exp⁄ít
Ë: "0" (
__x
)); \

410 
__vÆue
 += 1.0; \

411 
__asm
 
__vﬁ©ûe__
 \

413 : "Ò" (
__vÆue
Ë: "0" (__vÆue), "u" (
__exp⁄ít
)); \

414  
__vÆue


	)

415 
	$__ölöe_m©hcodeNP
 (
exp
, 
__x
, 
__exp_code
)

416 
	$__ölöe_m©hcodeNP_
 (, 
__ex∂
, 
__x
, 
__exp_code
)

420 #i‡!
	`__GNUC_PREREQ
 (3, 5)

421 
	`__ölöe_m©hcodeNP
 (
èn
, 
__x
, \

422 
__vÆue
; \

423 
__vÆue2
 
	`__©åibuã__
 ((
__unu£d__
)); \

424 
__asm
 
__vﬁ©ûe__
 \

426 : "Ò" (
__vÆue2
), "=u" (
__vÆue
Ë: "0" (
__x
)); \

427  
__vÆue
)

432 #i‡
	`__GNUC_PREREQ
 (3, 4)

433 
	`__ölöe_m©hcodeNP2_
 (, 
__©™2l
, 
__y
, 
__x
,

434  
	$__buûtö_©™2l
 (
__y
, 
__x
))

436 
	#__©™2_code
 \

437 
__vÆue
; \

438 
__asm
 
__vﬁ©ûe__
 \

440 : "Ò" (
__vÆue
Ë: "0" (
__x
), "u" (
__y
) : "st(1)"); \

441  
__vÆue


	)

442 #ifde‡
__FAST_MATH__


443 
	$__ölöe_m©hcodeNP2
 (
©™2
, 
__y
, 
__x
, 
__©™2_code
)

445 
	$__ölöe_m©hcodeNP2_
 (, 
__©™2l
, 
__y
, 
__x
, 
__©™2_code
)

449 #i‡
deföed
 
__FAST_MATH__
 && !
	`__GNUC_PREREQ
 (3, 5)

450 
	`__ölöe_m©hcodeNP2
 (
fmod
, 
__x
, 
__y
, \

451 
__vÆue
; \

452 
__asm
 
__vﬁ©ûe__
 \

457 : "Ò" (
__vÆue
Ë: "0" (
__x
), "u" (
__y
) : "ax", "cc"); \

458  
__vÆue
)

462 #ifde‡
__FAST_MATH__


463 #i‡!
	`__GNUC_PREREQ
 (3,3)

464 
	`__ölöe_m©h›NP
 (
sqπ
, "fsqrt")

465 
	`__ölöe_m©h›NP_
 (, 
__sqπl
, "fsqrt")

466 
	#__libc_sqπl
(
n
Ë
	`__sqπl
 (n)

	)

468 
	#__libc_sqπl
(
n
Ë
	`__buûtö_sqπl
 (n)

	)

472 #i‡
	`__GNUC_PREREQ
 (2, 8)

473 
	`__ölöe_m©hcodeNP_
 (, 
Ábs
, 
__x
,  
	$__buûtö_Ábs
 (
__x
))

474 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


475 
	`__ölöe_m©hcodeNP_
 (, 
Ábsf
, 
__x
,  
	$__buûtö_Ábsf
 (
__x
))

476 
	`__ölöe_m©hcodeNP_
 (, 
Áb¶
, 
__x
,  
	$__buûtö_Áb¶
 (
__x
))

478 
	`__ölöe_m©hcodeNP_
 (, 
__Áb¶
, 
__x
,  
	$__buûtö_Áb¶
 (
__x
))

480 
	`__ölöe_m©h›
 (
Ábs
, "fabs")

481 
	`__ölöe_m©h›_
 (, 
__Áb¶
, "fabs")

484 #ifde‡
__FAST_MATH__


485 #i‡!
	`__GNUC_PREREQ
 (3, 4)

487 
	`__ölöe_m©h›NP
 (
sö
, "fsin")

489 
	`__ölöe_m©h›NP
 (
cos
, "fcos")

491 
	`__ölöe_m©h›_de˛NP
 (
log
, "Êd 2; fxch; fyl2x", "0" (
__x
) : "st(1)")

494 #i‡!
	`__GNUC_PREREQ
 (3, 5)

495 
	`__ölöe_m©h›_de˛NP
 (
log10
, "Êdlg2; fxch; fyl2x", "0" (
__x
) : "st(1)")

497 
	`__ölöe_m©hcodeNP
 (
asö
, 
__x
,  
	`__©™2l
 (__x, 
	`__libc_sqπl
 (1.0 - __x * __x)))

498 
	`__ölöe_m©hcodeNP
 (
acos
, 
__x
,  
	`__©™2l
 (
	`__libc_sqπl
 (1.0 - __x * __x), __x))

501 #i‡!
	`__GNUC_PREREQ
 (3, 4)

502 
	`__ölöe_m©h›_de˛NP
 (
©™
, "Êd1; f∑èn", "0" (
__x
) : "st(1)")

506 
	`__ölöe_m©hcode_
 (, 
__sgn1l
, 
__x
, \

507 
__exãnsi⁄__
 uni⁄ { 
__xld
; 
__xi
[3]; } 
__n
 = \

508 { 
__xld
: 
__x
 
	}
}; \

509 
	g__n
.
	g__xi
[2] = (
__n
.
__xi
[2] & 0x8000) | 0x3fff; \

510 
	g__n
.
	g__xi
[1] = 0x80000000; \

511 
	g__n
.
	g__xi
[0] = 0; \

512  
	g__n
.
	g__xld
)

515 #ifde‡
__FAST_MATH__


517 
__ölöe_m©hcodeNP
 (
söh
, 
__x
, \

518 
__exm1
 = 
__expm1l
 (
__Áb¶
 (
__x
)); \

519  0.5 * (
__exm1
 / (__exm1 + 1.0Ë+ __exm1Ë* 
	$__sgn1l
 (
__x
))

521 
	`__ölöe_m©hcodeNP
 (
cosh
, 
__x
, \

522 
__ex
 = 
	`__ex∂
 (
__x
); \

523  0.5 * (
__ex
 + 1.0 / __ex))

525 
	`__ölöe_m©hcodeNP
 (
ènh
, 
__x
, \

526 
__exm1
 = 
	`__expm1l
 (-
	`__Áb¶
 (
__x
 + __x)); \

527  
__exm1
 / (__exm1 + 2.0Ë* 
	`__sgn1l
 (-
__x
))

530 
	`__ölöe_m©hcodeNP
 (
Êo‹
, 
__x
, \

531 
__vÆue
; \

532 
__ign‹e
; \

533 
__cw
; \

534 
__cwtmp
; \

535 
__asm
 
	`__vﬁ©ûe
 ("fnstcw %3\n\t" \

543 : "Ò" (
__vÆue
), "=&q" (
__ign‹e
), "=m" (
__cwtmp
), \

544 "=m" (
__cw
) \

545 : "0" (
__x
)); \

546  
__vÆue
)

548 
	`__ölöe_m©hcodeNP
 (
˚û
, 
__x
, \

549 
__vÆue
; \

550 
__ign‹e
; \

551 
__cw
; \

552 
__cwtmp
; \

553 
__asm
 
	`__vﬁ©ûe
 ("fnstcw %3\n\t" \

561 : "Ò" (
__vÆue
), "=&q" (
__ign‹e
), "=m" (
__cwtmp
), \

562 "=m" (
__cw
) \

563 : "0" (
__x
)); \

564  
__vÆue
)

566 #ifde‡
__FAST_MATH__


567 
	#__ldexp_code
 \

568 
__vÆue
; \

569 
__asm
 
__vﬁ©ûe__
 \

571 : "Ò" (
__vÆue
Ë: "0" (
__x
), "u" ((Ë
__y
)); \

572  
__vÆue


	)

574 
__MATH_INLINE
 

575 
	`__NTH
 (
	$ldexp
 (
__x
, 
__y
))

577 
__ldexp_code
;

578 
	}
}

583 #i‡
deföed
 
__USE_ISOC99
 || deföed 
__USE_MISC


585 #ifde‡
__FAST_MATH__


586 
	$__ölöe_m©hcodeNP
 (
expm1
, 
__x
, 
__expm1_code
)

590 
	#__M_SQRT2
 1.41421356237309504880L

	)

592 #i‡!
	`__GNUC_PREREQ
 (3, 5)

593 
	`__ölöe_m©hcodeNP
 (
log1p
, 
__x
, \

594 
__vÆue
; \

595 i‡(
	`__Áb¶
 (
__x
Ë>1.0 - 0.5 * 
__M_SQRT2
) \

596 
__vÆue
 = 
	`logl
 (1.0 + 
__x
); \

598 
__asm
 
__vﬁ©ûe__
 \

602 : "Ò" (
__vÆue
Ë: "0" (
__x
) : "st(1)"); \

603  
__vÆue
)

608 
	`__ölöe_m©hcodeNP
 (
asöh
, 
__x
, \

609 
__y
 = 
	`__Áb¶
 (
__x
); \

610  (
	`log1∂
 (
__y
 * __y / (
	`__libc_sqπl
 (__y * __y + 1.0) + 1.0) + __y) \

611 * 
	$__sgn1l
 (
__x
)))

613 
	`__ölöe_m©hcodeNP
 (
acosh
, 
__x
, \

614  
	`logl
 (
__x
 + 
	`__libc_sqπl
 (__x - 1.0) * __libc_sqrtl (__x + 1.0)))

616 
	`__ölöe_m©hcodeNP
 (
©™h
, 
__x
, \

617 
__y
 = 
	`__Áb¶
 (
__x
); \

618  -0.5 * 
	`log1∂
 (-(
__y
 + __yË/ (1.0 + __y)Ë* 
	$__sgn1l
 (
__x
))

621 
	`__ölöe_m©hcodeNP2
 (
hypŸ
, 
__x
, 
__y
,

622  
	`__libc_sqπl
 (
__x
 * __x + 
__y
 * __y))

624 #i‡!
	`__GNUC_PREREQ
 (3, 5)

625 
	`__ölöe_m©hcodeNP
(
logb
, 
__x
, \

626 
__vÆue
; \

627 
__junk
; \

628 
__asm
 
__vﬁ©ûe__
 \

630 : "Ò" (
__junk
), "=u" (
__vÆue
Ë: "0" (
__x
)); \

631  
__vÆue
)

637 #ifde‡
__USE_ISOC99


638 #ifde‡
__FAST_MATH__


640 #i‡!
	`__GNUC_PREREQ
 (3, 5)

641 
	`__ölöe_m©h›_de˛NP
 (
log2
, "Êd1; fxch; fyl2x", "0" (
__x
) : "st(1)")

644 
__MATH_INLINE
 

645 
	`__NTH
 (
	$ldexpf
 (
__x
, 
__y
))

647 
__ldexp_code
;

648 
	}
}

650 
__MATH_INLINE
 

651 
__NTH
 (
	$ldex∂
 (
__x
, 
__y
))

653 
__ldexp_code
;

654 
	}
}

656 
__ölöe_m©hcodeNP3
 (
fma
, 
__x
, 
__y
, 
__z
,  (__x * __y) + __z)

658 
__ölöe_m©h›NP
 (
röt
, "frndint")

661 
	#__Ãöt_code
 \

662 
__Ãöåes
; \

663 
__asm__
 
__vﬁ©ûe__
 \

665 : "=m" (
__Ãöåes
Ë: "t" (
__x
) : "st"); \

666  
__Ãöåes


	)

667 
__MATH_INLINE
 

668 
__NTH
 (
	$Ãötf
 (
__x
))

670 
__Ãöt_code
;

671 
	}
}

672 
__MATH_INLINE
 

673 
__NTH
 (
	$Ãöt
 (
__x
))

675 
__Ãöt_code
;

676 
	}
}

677 
__MATH_INLINE
 

678 
__NTH
 (
	$Ãöé
 (
__x
))

680 
__Ãöt_code
;

681 
	}
}

682 #unde‡
__Ãöt_code


684 
	#__Œröt_code
 \

685 
__Œröåes
; \

686 
__asm__
 
__vﬁ©ûe__
 \

688 : "=m" (
__Œröåes
Ë: "t" (
__x
) : "st"); \

689  
__Œröåes


	)

690 
__MATH_INLINE
 

691 
__NTH
 (
	$Œrötf
 (
__x
))

693 
__Œröt_code
;

694 
	}
}

695 
__MATH_INLINE
 

696 
__NTH
 (
	$Œröt
 (
__x
))

698 
__Œröt_code
;

699 
	}
}

700 
__MATH_INLINE
 

701 
__NTH
 (
	$Œröé
 (
__x
))

703 
__Œröt_code
;

704 
	}
}

705 #unde‡
__Œröt_code


710 #ifde‡
__USE_MISC


712 #i‡
deföed
 
__FAST_MATH__
 && !
__GNUC_PREREQ
 (3, 5)

713 
__ölöe_m©hcodeNP2
 (
dªm
, 
__x
, 
__y
, \

714 
__vÆue
; \

715 
__˛obbîed
; \

716 
__asm
 
__vﬁ©ûe__
 \

721 : "Ò" (
__vÆue
), "=&a" (
__˛obbîed
Ë: "0" (
__x
), "u" (
__y
) : "cc"); \

722  
__vÆue
)

727 
__MATH_INLINE
 

728 
__NTH
 (
	$__föôe
 (
__x
))

730  (
__exãnsi⁄__


731 (((((uni⁄ { 
__d
; 
__i
[2]; }Ë{__d: 
__x
}).__i[1]

733 
	}
}

736 #ifde‡
__FAST_MATH__


737 
__ölöe_m©hcode
 (
__coshm1
, 
__x
, \

738 
__exm1
 = 
__expm1l
 (
__Áb¶
 (
__x
)); \

739  0.5 * (
__exm1
 / (__exm1 + 1.0)) * __exm1)

741 
__ölöe_m©hcode
 (
__acosh1p
, 
__x
, \

742  
log1∂
 (
__x
 + 
__libc_sqπl
 (__x) * __libc_sqrtl (__x + 2.0)))

748 #unde‡
__©™2_code


749 #ifde‡
__FAST_MATH__


750 #unde‡
__expm1_code


751 #unde‡
__exp_code


752 #unde‡
__söcos_code


759 #ifde‡
__LIBC_INTERNAL_MATH_INLINES


760 
__ölöe_m©h›
 (
__õì754_sqπ
, "fsqrt")

761 
__ölöe_m©hcode2
 (
__õì754_©™2
, 
__y
, 
__x
,

762 
__vÆue
;

763 
__asm
 
__vﬁ©ûe__
 ("fpatan\n\t"

764 : "Ò" (
__vÆue
)

765 : "0" (
__x
), "u" (
__y
) : "st(1)");

766  
__vÆue
;)

	@/usr/include/bits/mman.h

20 #i‚de‡
_SYS_MMAN_H


33 
	#PROT_READ
 0x1

	)

34 
	#PROT_WRITE
 0x2

	)

35 
	#PROT_EXEC
 0x4

	)

36 
	#PROT_NONE
 0x0

	)

37 
	#PROT_GROWSDOWN
 0x01000000

	)

39 
	#PROT_GROWSUP
 0x02000000

	)

43 
	#MAP_SHARED
 0x01

	)

44 
	#MAP_PRIVATE
 0x02

	)

45 #ifde‡
__USE_MISC


46 
	#MAP_TYPE
 0x0‡

	)

50 
	#MAP_FIXED
 0x10

	)

51 #ifde‡
__USE_MISC


52 
	#MAP_FILE
 0

	)

53 
	#MAP_ANONYMOUS
 0x20

	)

54 
	#MAP_ANON
 
MAP_ANONYMOUS


	)

58 #ifde‡
__USE_MISC


59 
	#MAP_GROWSDOWN
 0x00100

	)

60 
	#MAP_DENYWRITE
 0x00800

	)

61 
	#MAP_EXECUTABLE
 0x01000

	)

62 
	#MAP_LOCKED
 0x02000

	)

63 
	#MAP_NORESERVE
 0x04000

	)

64 
	#MAP_POPULATE
 0x08000

	)

65 
	#MAP_NONBLOCK
 0x10000

	)

69 
	#MS_ASYNC
 1

	)

70 
	#MS_SYNC
 4

	)

71 
	#MS_INVALIDATE
 2

	)

74 
	#MCL_CURRENT
 1

	)

75 
	#MCL_FUTURE
 2

	)

79 #ifde‡
__USE_GNU


80 
	#MREMAP_MAYMOVE
 1

	)

81 
	#MREMAP_FIXED
 2

	)

85 #ifde‡
__USE_BSD


86 
	#MADV_NORMAL
 0

	)

87 
	#MADV_RANDOM
 1

	)

88 
	#MADV_SEQUENTIAL
 2

	)

89 
	#MADV_WILLNEED
 3

	)

90 
	#MADV_DONTNEED
 4

	)

91 
	#MADV_REMOVE
 9

	)

92 
	#MADV_DONTFORK
 10

	)

93 
	#MADV_DOFORK
 11

	)

97 #ifde‡
__USE_XOPEN2K


98 
	#POSIX_MADV_NORMAL
 0

	)

99 
	#POSIX_MADV_RANDOM
 1

	)

100 
	#POSIX_MADV_SEQUENTIAL
 2

	)

101 
	#POSIX_MADV_WILLNEED
 3

	)

102 
	#POSIX_MADV_DONTNEED
 4

	)

	@/usr/include/bits/nan.h

20 #i‚de‡
_MATH_H


27 #i‡
__GNUC_PREREQ
(3,3)

29 
	#NAN
 (
	`__buûtö_«nf
 (""))

	)

31 #ñi‡
deföed
 
__GNUC__


33 
	#NAN
 \

34 (
__exãnsi⁄__
 \

35 ((uni⁄ { 
__l
 
	`__©åibuã__
 ((
	`__mode__
 (
__SI__
))); 
__d
; }) \

36 { 
__l
: 0x7fc00000UL }).
__d
)

	)

40 
	~<ídün.h
>

42 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


43 
	#__«n_byãs
 { 0x7f, 0xc0, 0, 0 }

	)

45 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


46 
	#__«n_byãs
 { 0, 0, 0xc0, 0x7‡}

	)

49 uni⁄ { 
	m__c
[4]; 
	m__d
; } 
__«n_uni⁄


50 
	g__©åibuã_u£d__
 = { 
__«n_byãs
 };

51 
	#NAN
 (
__«n_uni⁄
.
__d
)

	)

	@/usr/include/bits/posix_opt.h

20 #i‚def 
_POSIX_OPT_H


21 
	#_POSIX_OPT_H
 1

	)

24 
	#_POSIX_JOB_CONTROL
 1

	)

27 
	#_POSIX_SAVED_IDS
 1

	)

30 
	#_POSIX_PRIORITY_SCHEDULING
 200112L

	)

33 
	#_POSIX_SYNCHRONIZED_IO
 200112L

	)

36 
	#_POSIX_FSYNC
 200112L

	)

39 
	#_POSIX_MAPPED_FILES
 200112L

	)

42 
	#_POSIX_MEMLOCK
 200112L

	)

45 
	#_POSIX_MEMLOCK_RANGE
 200112L

	)

48 
	#_POSIX_MEMORY_PROTECTION
 200112L

	)

51 
	#_POSIX_CHOWN_RESTRICTED
 0

	)

55 
	#_POSIX_VDISABLE
 '\0'

	)

58 
	#_POSIX_NO_TRUNC
 1

	)

61 
	#_XOPEN_REALTIME
 1

	)

64 
	#_XOPEN_REALTIME_THREADS
 1

	)

67 
	#_XOPEN_SHM
 1

	)

70 
	#_POSIX_THREADS
 200112L

	)

73 
	#_POSIX_REENTRANT_FUNCTIONS
 1

	)

74 
	#_POSIX_THREAD_SAFE_FUNCTIONS
 200112L

	)

77 
	#_POSIX_THREAD_PRIORITY_SCHEDULING
 200112L

	)

80 
	#_POSIX_THREAD_ATTR_STACKSIZE
 200112L

	)

83 
	#_POSIX_THREAD_ATTR_STACKADDR
 200112L

	)

86 
	#_POSIX_THREAD_PRIO_INHERIT
 200112L

	)

90 
	#_POSIX_THREAD_PRIO_PROTECT
 200112L

	)

93 
	#_POSIX_SEMAPHORES
 200112L

	)

96 
	#_POSIX_REALTIME_SIGNALS
 200112L

	)

99 
	#_POSIX_ASYNCHRONOUS_IO
 200112L

	)

100 
	#_POSIX_ASYNC_IO
 1

	)

102 
	#_LFS_ASYNCHRONOUS_IO
 1

	)

104 
	#_POSIX_PRIORITIZED_IO
 200112L

	)

107 
	#_LFS64_ASYNCHRONOUS_IO
 1

	)

110 
	#_LFS_LARGEFILE
 1

	)

111 
	#_LFS64_LARGEFILE
 1

	)

112 
	#_LFS64_STDIO
 1

	)

115 
	#_POSIX_SHARED_MEMORY_OBJECTS
 200112L

	)

118 
	#_POSIX_CPUTIME
 0

	)

121 
	#_POSIX_THREAD_CPUTIME
 0

	)

124 
	#_POSIX_REGEXP
 1

	)

127 
	#_POSIX_READER_WRITER_LOCKS
 200112L

	)

130 
	#_POSIX_SHELL
 1

	)

133 
	#_POSIX_TIMEOUTS
 200112L

	)

136 
	#_POSIX_SPIN_LOCKS
 200112L

	)

139 
	#_POSIX_SPAWN
 200112L

	)

142 
	#_POSIX_TIMERS
 200112L

	)

145 
	#_POSIX_BARRIERS
 200112L

	)

148 
	#_POSIX_MESSAGE_PASSING
 200112L

	)

151 
	#_POSIX_THREAD_PROCESS_SHARED
 200112L

	)

154 
	#_POSIX_MONOTONIC_CLOCK
 0

	)

157 
	#_POSIX_CLOCK_SELECTION
 200112L

	)

160 
	#_POSIX_ADVISORY_INFO
 200112L

	)

163 
	#_POSIX_IPV6
 200112L

	)

166 
	#_POSIX_RAW_SOCKETS
 200112L

	)

169 
	#_POSIX2_CHAR_TERM
 200112L

	)

172 
	#_POSIX_SPORADIC_SERVER
 -1

	)

173 
	#_POSIX_THREAD_SPORADIC_SERVER
 -1

	)

176 
	#_POSIX_TRACE
 -1

	)

177 
	#_POSIX_TRACE_EVENT_FILTER
 -1

	)

178 
	#_POSIX_TRACE_INHERIT
 -1

	)

179 
	#_POSIX_TRACE_LOG
 -1

	)

182 
	#_POSIX_TYPED_MEMORY_OBJECTS
 -1

	)

	@/usr/include/bits/pthreadtypes.h

19 #i‚de‡
_BITS_PTHREADTYPES_H


20 
	#_BITS_PTHREADTYPES_H
 1

	)

22 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

23 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

24 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

25 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

26 
	#__SIZEOF_PTHREAD_COND_COMPAT_T
 12

	)

27 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

28 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

29 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

30 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

31 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

36 
	t±hªad_t
;

41 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

42 
	m__Æign
;

43 } 
	t±hªad_©å_t
;

46 
	s__±hªad_öã∫Æ_¶i°


48 
__±hªad_öã∫Æ_¶i°
 *
	m__√xt
;

49 } 
	t__±hªad_¶i°_t
;

56 
	s__±hªad_muãx_s


58 
	m__lock
;

59 
	m__cou¡
;

60 
	m__ow√r
;

63 
	m__köd
;

64 
	m__nu£rs
;

65 
__exãnsi⁄__
 union

67 
	m__•ös
;

68 
__±hªad_¶i°_t
 
	m__li°
;

70 } 
	m__d©a
;

71 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

72 
	m__Æign
;

73 } 
	t±hªad_muãx_t
;

77 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

78 
	m__Æign
;

79 } 
	t±hªad_muãx©å_t
;

88 
	m__lock
;

89 
	m__fuãx
;

90 
__exãnsi⁄__
 
	m__tŸÆ_£q
;

91 
__exãnsi⁄__
 
	m__wakeup_£q
;

92 
__exãnsi⁄__
 
	m__wokí_£q
;

93 *
	m__muãx
;

94 
	m__nwaôîs
;

95 
	m__brﬂdˇ°_£q
;

96 } 
	m__d©a
;

97 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

98 
__exãnsi⁄__
 
	m__Æign
;

99 } 
	t±hªad_c⁄d_t
;

103 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

104 
	m__Æign
;

105 } 
	t±hªad_c⁄d©å_t
;

109 
	t±hªad_key_t
;

113 
	t±hªad_⁄˚_t
;

116 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


123 
	m__lock
;

124 
	m__ƒ_ªadîs
;

125 
	m__ªadîs_wakeup
;

126 
	m__wrôî_wakeup
;

127 
	m__ƒ_ªadîs_queued
;

128 
	m__ƒ_wrôîs_queued
;

131 
	m__Êags
;

132 
	m__sh¨ed
;

133 
	m__∑d1
;

134 
	m__∑d2
;

135 
	m__wrôî
;

136 } 
	m__d©a
;

137 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

138 
	m__Æign
;

139 } 
	t±hªad_rwlock_t
;

143 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

144 
	m__Æign
;

145 } 
	t±hªad_rwlock©å_t
;

149 #ifde‡
__USE_XOPEN2K


151 vﬁ©ûê
	t±hªad_•ölock_t
;

158 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

159 
	m__Æign
;

160 } 
	t±hªad_b¨rõr_t
;

164 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

165 
	m__Æign
;

166 } 
	t±hªad_b¨rõøâr_t
;

171 
	#__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
	`__ªg∑rm__
 (1)))

	)

	@/usr/include/bits/select.h

19 #i‚de‡
_SYS_SELECT_H


24 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

26 
	#__FD_ZERO
(
fd•
) \

28 
__d0
, 
__d1
; \

29 
__asm__
 
	`__vﬁ©ûe__
 ("cld;Ñep; stosl" \

30 : "=c" (
__d0
), "=D" (
__d1
) \

31 : "a" (0), "0" ( (
fd_£t
) \

32 /  (
__fd_mask
)), \

33 "1" (&
	`__FDS_BITS
 (
fd•
)[0]) \

35 } 0)

	)

37 
	#__FD_SET
(
fd
, 
fd•
) \

38 
__asm__
 
	`__vﬁ©ûe__
 ("btsl %1,%0" \

39 : "=m" (
	`__FDS_BITS
 (
fd•
)[
	`__FDELT
 (
fd
)]) \

40 : "r" (((Ë(
fd
)Ë% 
__NFDBITS
) \

41 : "cc","mem‹y")

	)

42 
	#__FD_CLR
(
fd
, 
fd•
) \

43 
__asm__
 
	`__vﬁ©ûe__
 ("btrl %1,%0" \

44 : "=m" (
	`__FDS_BITS
 (
fd•
)[
	`__FDELT
 (
fd
)]) \

45 : "r" (((Ë(
fd
)Ë% 
__NFDBITS
) \

46 : "cc","mem‹y")

	)

47 
	#__FD_ISSET
(
fd
, 
fd•
) \

48 (
__exãnsi⁄__
 \

49 ({
__ªsu…
; \

50 
__asm__
 
	`__vﬁ©ûe__
 ("btl %1,%2 ; setcb %b0" \

51 : "=q" (
__ªsu…
) \

52 : "r" (((Ë(
fd
)Ë% 
__NFDBITS
), \

53 "m" (
	`__FDS_BITS
 (
fd•
)[
	`__FDELT
 (
fd
)]) \

55 
__ªsu…
; }))

	)

61 
	#__FD_ZERO
(
£t
) \

63 
__i
; \

64 
fd_£t
 *
__¨r
 = (
£t
); \

65 
__i
 = 0; __ò<  (
fd_£t
Ë/  (
__fd_mask
); ++__i) \

66 
	`__FDS_BITS
 (
__¨r
)[
__i
] = 0; \

67 } 0)

	)

68 
	#__FD_SET
(
d
, 
£t
Ë(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] |
	`__FDMASK
 (d))

	)

69 
	#__FD_CLR
(
d
, 
£t
Ë(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] &~
	`__FDMASK
 (d))

	)

70 
	#__FD_ISSET
(
d
, 
£t
Ë(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] & 
	`__FDMASK
 (d))

	)

	@/usr/include/bits/setjmp.h

21 #i‚de‡
_BITS_SETJMP_H


22 
	#_BITS_SETJMP_H
 1

	)

24 #i‡!
deföed
 
_SETJMP_H
 && !deföed 
_PTHREAD_H


28 #i‚def 
_ASM


29 
	t__jmp_buf
[6];

	@/usr/include/bits/sigaction.h

20 #i‚de‡
_SIGNAL_H


25 
	ssiga˘i⁄


28 #ifde‡
__USE_POSIX199309


32 
__sigh™dÀr_t
 
	mß_h™dÀr
;

34 (*
	mß_siga˘i⁄
Ë(, 
	msigöfo_t
 *, *);

36 
	m__siga˘i⁄_h™dÀr
;

37 
	#ß_h™dÀr
 
__siga˘i⁄_h™dÀr
.
ß_h™dÀr


	)

38 
	#ß_siga˘i⁄
 
__siga˘i⁄_h™dÀr
.
ß_siga˘i⁄


	)

40 
__sigh™dÀr_t
 
	mß_h™dÀr
;

44 
__sig£t_t
 
	mß_mask
;

47 
	mß_Êags
;

50 (*
	mß_ª°‹î
) ();

54 
	#SA_NOCLDSTOP
 1

	)

55 
	#SA_NOCLDWAIT
 2

	)

56 
	#SA_SIGINFO
 4

	)

58 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_MISC


59 
	#SA_ONSTACK
 0x08000000

	)

60 
	#SA_RESTART
 0x10000000

	)

61 
	#SA_NODEFER
 0x40000000

	)

63 
	#SA_RESETHAND
 0x80000000

	)

65 #ifde‡
__USE_MISC


66 
	#SA_INTERRUPT
 0x20000000

	)

69 
	#SA_NOMASK
 
SA_NODEFER


	)

70 
	#SA_ONESHOT
 
SA_RESETHAND


	)

71 
	#SA_STACK
 
SA_ONSTACK


	)

75 
	#SIG_BLOCK
 0

	)

76 
	#SIG_UNBLOCK
 1

	)

77 
	#SIG_SETMASK
 2

	)

	@/usr/include/bits/sigcontext.h

19 #i‡!
deföed
 
_SIGNAL_H
 && !deföed 
_SYS_UCONTEXT_H


23 #i‚de‡
sigc⁄ãxt_°ru˘


26 
	#sigc⁄ãxt_°ru˘
 
sigc⁄ãxt


	)

28 
	~<asm/sigc⁄ãxt.h
>

	@/usr/include/bits/siginfo.h

20 #i‡!
deföed
 
_SIGNAL_H
 && !deföed 
__√ed_sigöfo_t
 \

21 && !
deföed
 
	g__√ed_sigevít_t


25 
	~<bôs/w‹dsize.h
>

27 #i‡(!
deföed
 
__have_sigvÆ_t
 \

28 && (
deföed
 
	g_SIGNAL_H
 || deföed 
	g__√ed_sigöfo_t
 \

29 || 
deföed
 
	g__√ed_sigevít_t
))

30 
	#__have_sigvÆ_t
 1

	)

33 
	usigvÆ


35 
	msivÆ_öt
;

36 *
	msivÆ_±r
;

37 } 
	tsigvÆ_t
;

40 #i‡(!
deföed
 
__have_sigöfo_t
 \

41 && (
deföed
 
	g_SIGNAL_H
 || deföed 
	g__√ed_sigöfo_t
))

42 
	#__have_sigöfo_t
 1

	)

44 
	#__SI_MAX_SIZE
 128

	)

45 #i‡
__WORDSIZE
 == 64

46 
	#__SI_PAD_SIZE
 ((
__SI_MAX_SIZE
 /  ()Ë- 4)

	)

48 
	#__SI_PAD_SIZE
 ((
__SI_MAX_SIZE
 /  ()Ë- 3)

	)

51 
	ssigöfo


53 
	msi_signo
;

54 
	msi_î∫o
;

56 
	msi_code
;

60 
	m_∑d
[
__SI_PAD_SIZE
];

65 
__pid_t
 
	msi_pid
;

66 
__uid_t
 
	msi_uid
;

67 } 
	m_kûl
;

72 
	msi_tid
;

73 
	msi_ovîrun
;

74 
sigvÆ_t
 
	msi_sigvÆ
;

75 } 
	m_timî
;

80 
__pid_t
 
	msi_pid
;

81 
__uid_t
 
	msi_uid
;

82 
sigvÆ_t
 
	msi_sigvÆ
;

83 } 
	m_π
;

88 
__pid_t
 
	msi_pid
;

89 
__uid_t
 
	msi_uid
;

90 
	msi_°©us
;

91 
__˛ock_t
 
	msi_utime
;

92 
__˛ock_t
 
	msi_°ime
;

93 } 
	m_sigchld
;

98 *
	msi_addr
;

99 } 
	m_sigÁu…
;

104 
	msi_b™d
;

105 
	msi_fd
;

106 } 
	m_sigpﬁl
;

107 } 
	m_sifõlds
;

108 } 
	tsigöfo_t
;

112 
	#si_pid
 
_sifõlds
.
_kûl
.
si_pid


	)

113 
	#si_uid
 
_sifõlds
.
_kûl
.
si_uid


	)

114 
	#si_timîid
 
_sifõlds
.
_timî
.
si_tid


	)

115 
	#si_ovîrun
 
_sifõlds
.
_timî
.
si_ovîrun


	)

116 
	#si_°©us
 
_sifõlds
.
_sigchld
.
si_°©us


	)

117 
	#si_utime
 
_sifõlds
.
_sigchld
.
si_utime


	)

118 
	#si_°ime
 
_sifõlds
.
_sigchld
.
si_°ime


	)

119 
	#si_vÆue
 
_sifõlds
.
_π
.
si_sigvÆ


	)

120 
	#si_öt
 
_sifõlds
.
_π
.
si_sigvÆ
.
sivÆ_öt


	)

121 
	#si_±r
 
_sifõlds
.
_π
.
si_sigvÆ
.
sivÆ_±r


	)

122 
	#si_addr
 
_sifõlds
.
_sigÁu…
.
si_addr


	)

123 
	#si_b™d
 
_sifõlds
.
_sigpﬁl
.
si_b™d


	)

124 
	#si_fd
 
_sifõlds
.
_sigpﬁl
.
si_fd


	)

131 
	mSI_ASYNCNL
 = -60,

132 
	#SI_ASYNCNL
 
SI_ASYNCNL


	)

133 
	mSI_TKILL
 = -6,

134 
	#SI_TKILL
 
SI_TKILL


	)

135 
	mSI_SIGIO
,

136 
	#SI_SIGIO
 
SI_SIGIO


	)

137 
	mSI_ASYNCIO
,

138 
	#SI_ASYNCIO
 
SI_ASYNCIO


	)

139 
	mSI_MESGQ
,

140 
	#SI_MESGQ
 
SI_MESGQ


	)

141 
	mSI_TIMER
,

142 
	#SI_TIMER
 
SI_TIMER


	)

143 
	mSI_QUEUE
,

144 
	#SI_QUEUE
 
SI_QUEUE


	)

145 
	mSI_USER
,

146 
	#SI_USER
 
SI_USER


	)

147 
	mSI_KERNEL
 = 0x80

148 
	#SI_KERNEL
 
SI_KERNEL


	)

155 
	mILL_ILLOPC
 = 1,

156 
	#ILL_ILLOPC
 
ILL_ILLOPC


	)

157 
	mILL_ILLOPN
,

158 
	#ILL_ILLOPN
 
ILL_ILLOPN


	)

159 
	mILL_ILLADR
,

160 
	#ILL_ILLADR
 
ILL_ILLADR


	)

161 
	mILL_ILLTRP
,

162 
	#ILL_ILLTRP
 
ILL_ILLTRP


	)

163 
	mILL_PRVOPC
,

164 
	#ILL_PRVOPC
 
ILL_PRVOPC


	)

165 
	mILL_PRVREG
,

166 
	#ILL_PRVREG
 
ILL_PRVREG


	)

167 
	mILL_COPROC
,

168 
	#ILL_COPROC
 
ILL_COPROC


	)

169 
	mILL_BADSTK


170 
	#ILL_BADSTK
 
ILL_BADSTK


	)

176 
	mFPE_INTDIV
 = 1,

177 
	#FPE_INTDIV
 
FPE_INTDIV


	)

178 
	mFPE_INTOVF
,

179 
	#FPE_INTOVF
 
FPE_INTOVF


	)

180 
	mFPE_FLTDIV
,

181 
	#FPE_FLTDIV
 
FPE_FLTDIV


	)

182 
	mFPE_FLTOVF
,

183 
	#FPE_FLTOVF
 
FPE_FLTOVF


	)

184 
	mFPE_FLTUND
,

185 
	#FPE_FLTUND
 
FPE_FLTUND


	)

186 
	mFPE_FLTRES
,

187 
	#FPE_FLTRES
 
FPE_FLTRES


	)

188 
	mFPE_FLTINV
,

189 
	#FPE_FLTINV
 
FPE_FLTINV


	)

190 
	mFPE_FLTSUB


191 
	#FPE_FLTSUB
 
FPE_FLTSUB


	)

197 
	mSEGV_MAPERR
 = 1,

198 
	#SEGV_MAPERR
 
SEGV_MAPERR


	)

199 
	mSEGV_ACCERR


200 
	#SEGV_ACCERR
 
SEGV_ACCERR


	)

206 
	mBUS_ADRALN
 = 1,

207 
	#BUS_ADRALN
 
BUS_ADRALN


	)

208 
	mBUS_ADRERR
,

209 
	#BUS_ADRERR
 
BUS_ADRERR


	)

210 
	mBUS_OBJERR


211 
	#BUS_OBJERR
 
BUS_OBJERR


	)

217 
	mTRAP_BRKPT
 = 1,

218 
	#TRAP_BRKPT
 
TRAP_BRKPT


	)

219 
	mTRAP_TRACE


220 
	#TRAP_TRACE
 
TRAP_TRACE


	)

226 
	mCLD_EXITED
 = 1,

227 
	#CLD_EXITED
 
CLD_EXITED


	)

228 
	mCLD_KILLED
,

229 
	#CLD_KILLED
 
CLD_KILLED


	)

230 
	mCLD_DUMPED
,

231 
	#CLD_DUMPED
 
CLD_DUMPED


	)

232 
	mCLD_TRAPPED
,

233 
	#CLD_TRAPPED
 
CLD_TRAPPED


	)

234 
	mCLD_STOPPED
,

235 
	#CLD_STOPPED
 
CLD_STOPPED


	)

236 
	mCLD_CONTINUED


237 
	#CLD_CONTINUED
 
CLD_CONTINUED


	)

243 
	mPOLL_IN
 = 1,

244 
	#POLL_IN
 
POLL_IN


	)

245 
	mPOLL_OUT
,

246 
	#POLL_OUT
 
POLL_OUT


	)

247 
	mPOLL_MSG
,

248 
	#POLL_MSG
 
POLL_MSG


	)

249 
	mPOLL_ERR
,

250 
	#POLL_ERR
 
POLL_ERR


	)

251 
	mPOLL_PRI
,

252 
	#POLL_PRI
 
POLL_PRI


	)

253 
	mPOLL_HUP


254 
	#POLL_HUP
 
POLL_HUP


	)

257 #unde‡
__√ed_sigöfo_t


261 #i‡(
deföed
 
_SIGNAL_H
 || deföed 
__√ed_sigevít_t
) \

262 && !
deföed
 
	g__have_sigevít_t


263 
	#__have_sigevít_t
 1

	)

266 
	#__SIGEV_MAX_SIZE
 64

	)

267 #i‡
__WORDSIZE
 == 64

268 
	#__SIGEV_PAD_SIZE
 ((
__SIGEV_MAX_SIZE
 /  ()Ë- 4)

	)

270 
	#__SIGEV_PAD_SIZE
 ((
__SIGEV_MAX_SIZE
 /  ()Ë- 3)

	)

273 
	ssigevít


275 
sigvÆ_t
 
	msigev_vÆue
;

276 
	msigev_signo
;

277 
	msigev_nŸify
;

281 
	m_∑d
[
__SIGEV_PAD_SIZE
];

285 
__pid_t
 
	m_tid
;

289 (*
	m_fun˘i⁄
Ë(
	msigvÆ_t
);

290 *
	m_©åibuã
;

291 } 
	m_sigev_thªad
;

292 } 
	m_sigev_un
;

293 } 
	tsigevít_t
;

296 
	#sigev_nŸify_fun˘i⁄
 
_sigev_un
.
_sigev_thªad
.
_fun˘i⁄


	)

297 
	#sigev_nŸify_©åibuãs
 
_sigev_un
.
_sigev_thªad
.
_©åibuã


	)

302 
	mSIGEV_SIGNAL
 = 0,

303 
	#SIGEV_SIGNAL
 
SIGEV_SIGNAL


	)

304 
	mSIGEV_NONE
,

305 
	#SIGEV_NONE
 
SIGEV_NONE


	)

306 
	mSIGEV_THREAD
,

307 
	#SIGEV_THREAD
 
SIGEV_THREAD


	)

309 
	mSIGEV_THREAD_ID
 = 4

310 
	#SIGEV_THREAD_ID
 
SIGEV_THREAD_ID


	)

	@/usr/include/bits/signum.h

20 #ifdef 
_SIGNAL_H


23 
	#SIG_ERR
 ((
__sigh™dÀr_t
Ë-1Ë

	)

24 
	#SIG_DFL
 ((
__sigh™dÀr_t
Ë0Ë

	)

25 
	#SIG_IGN
 ((
__sigh™dÀr_t
Ë1Ë

	)

27 #ifde‡
__USE_UNIX98


28 
	#SIG_HOLD
 ((
__sigh™dÀr_t
Ë2Ë

	)

33 
	#SIGHUP
 1

	)

34 
	#SIGINT
 2

	)

35 
	#SIGQUIT
 3

	)

36 
	#SIGILL
 4

	)

37 
	#SIGTRAP
 5

	)

38 
	#SIGABRT
 6

	)

39 
	#SIGIOT
 6

	)

40 
	#SIGBUS
 7

	)

41 
	#SIGFPE
 8

	)

42 
	#SIGKILL
 9

	)

43 
	#SIGUSR1
 10

	)

44 
	#SIGSEGV
 11

	)

45 
	#SIGUSR2
 12

	)

46 
	#SIGPIPE
 13

	)

47 
	#SIGALRM
 14

	)

48 
	#SIGTERM
 15

	)

49 
	#SIGSTKFLT
 16

	)

50 
	#SIGCLD
 
SIGCHLD


	)

51 
	#SIGCHLD
 17

	)

52 
	#SIGCONT
 18

	)

53 
	#SIGSTOP
 19

	)

54 
	#SIGTSTP
 20

	)

55 
	#SIGTTIN
 21

	)

56 
	#SIGTTOU
 22

	)

57 
	#SIGURG
 23

	)

58 
	#SIGXCPU
 24

	)

59 
	#SIGXFSZ
 25

	)

60 
	#SIGVTALRM
 26

	)

61 
	#SIGPROF
 27

	)

62 
	#SIGWINCH
 28

	)

63 
	#SIGPOLL
 
SIGIO


	)

64 
	#SIGIO
 29

	)

65 
	#SIGPWR
 30

	)

66 
	#SIGSYS
 31

	)

67 
	#SIGUNUSED
 31

	)

69 
	#_NSIG
 65

	)

72 
	#SIGRTMIN
 (
	`__libc_cuºít_sigπmö
 ())

	)

73 
	#SIGRTMAX
 (
	`__libc_cuºít_sigπmax
 ())

	)

77 
	#__SIGRTMIN
 32

	)

78 
	#__SIGRTMAX
 (
_NSIG
 - 1)

	)

	@/usr/include/bits/sigset.h

21 #i‚def 
_SIGSET_H_ty≥s


22 
	#_SIGSET_H_ty≥s
 1

	)

24 
	t__sig_©omic_t
;

28 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

31 
	m__vÆ
[
_SIGSET_NWORDS
];

32 } 
	t__sig£t_t
;

43 #i‡!
deföed
 
_SIGSET_H_‚s
 && deföed 
_SIGNAL_H


44 
	#_SIGSET_H_‚s
 1

	)

46 #i‚de‡
_EXTERN_INLINE


47 
	#_EXTERN_INLINE
 
__exã∫_ölöe


	)

51 
	#__sigmask
(
sig
) \

52 (((Ë1Ë<< (((
sig
Ë- 1Ë% (8 *  ())))

	)

55 
	#__sigw‹d
(
sig
Ë(((sigË- 1Ë/ (8 *  ()))

	)

57 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

58 
	#__sigem±y£t
(
£t
) \

59 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

60 
sig£t_t
 *
__£t
 = (
£t
); \

61 --
__˙t
 >0Ë
__£t
->
__vÆ
[__cnt] = 0; \

62 0; }))

	)

63 
	#__sigfûl£t
(
£t
) \

64 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

65 
sig£t_t
 *
__£t
 = (
£t
); \

66 --
__˙t
 >0Ë
__£t
->
__vÆ
[__cnt] = ~0UL; \

67 0; }))

	)

69 #ifde‡
__USE_GNU


73 
	#__sigi£m±y£t
(
£t
) \

74 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

75 c⁄° 
sig£t_t
 *
__£t
 = (
£t
); \

76 
__ªt
 = 
__£t
->
__vÆ
[--
__˙t
]; \

77 !
__ªt
 && --
__˙t
 >= 0) \

78 
__ªt
 = 
__£t
->
__vÆ
[
__˙t
]; \

79 
__ªt
 =0; }))

	)

80 
	#__sig™d£t
(
de°
, 
À·
, 
right
) \

81 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

82 
sig£t_t
 *
__de°
 = (
de°
); \

83 c⁄° 
sig£t_t
 *
__À·
 = (
À·
); \

84 c⁄° 
sig£t_t
 *
__right
 = (
right
); \

85 --
__˙t
 >= 0) \

86 
__de°
->
__vÆ
[
__˙t
] = (
__À·
->__val[__cnt] \

87 & 
__right
->
__vÆ
[
__˙t
]); \

88 0; }))

	)

89 
	#__sig‹£t
(
de°
, 
À·
, 
right
) \

90 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

91 
sig£t_t
 *
__de°
 = (
de°
); \

92 c⁄° 
sig£t_t
 *
__À·
 = (
À·
); \

93 c⁄° 
sig£t_t
 *
__right
 = (
right
); \

94 --
__˙t
 >= 0) \

95 
__de°
->
__vÆ
[
__˙t
] = (
__À·
->__val[__cnt] \

96 | 
__right
->
__vÆ
[
__˙t
]); \

97 0; }))

	)

104 
__sigismembî
 (
__c⁄°
 
__sig£t_t
 *, );

105 
__sigadd£t
 (
__sig£t_t
 *, );

106 
__sigdñ£t
 (
__sig£t_t
 *, );

108 #ifde‡
__USE_EXTERN_INLINES


109 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

110 
_EXTERN_INLINE
 \

111 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

113 
__mask
 = 
	`__sigmask
 (
__sig
); \

114 
__w‹d
 = 
	`__sigw‹d
 (
__sig
); \

115  
BODY
; \

116 }

	)

118 
__SIGSETFN
 (
__sigismembî
, (
__£t
->
__vÆ
[
__w‹d
] & 
__mask
Ë? 1 : 0, 
__c⁄°
)

119 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__vÆ
[
__w‹d
] |
__mask
), 0), )

120 
__SIGSETFN
 (
__sigdñ£t
, ((
__£t
->
__vÆ
[
__w‹d
] &~
__mask
), 0), )

122 #unde‡
__SIGSETFN


	@/usr/include/bits/sigstack.h

20 #i‚de‡
_SIGNAL_H


26 
	ssig°ack


28 *
	mss_•
;

29 
	mss_⁄°ack
;

36 
	mSS_ONSTACK
 = 1,

37 
	#SS_ONSTACK
 
SS_ONSTACK


	)

38 
	mSS_DISABLE


39 
	#SS_DISABLE
 
SS_DISABLE


	)

43 
	#MINSIGSTKSZ
 2048

	)

46 
	#SIGSTKSZ
 8192

	)

50 
	ssigÆt°ack


52 *
	mss_•
;

53 
	mss_Êags
;

54 
size_t
 
	mss_size
;

55 } 
	t°ack_t
;

	@/usr/include/bits/sigthread.h

20 #i‚de‡
_BITS_SIGTHREAD_H


21 
	#_BITS_SIGTHREAD_H
 1

	)

23 #i‡!
deföed
 
_SIGNAL_H
 && !deföed 
_PTHREAD_H


31 
	$±hªad_sigmask
 (
__how
,

32 
__c⁄°
 
__sig£t_t
 *
__ª°ri˘
 
__√wmask
,

33 
__sig£t_t
 *
__ª°ri˘
 
__ﬁdmask
)
__THROW
;

36 
	$±hªad_kûl
 (
±hªad_t
 
__thªadid
, 
__signo
Ë
__THROW
;

	@/usr/include/bits/sockaddr.h

24 #i‚de‡
_BITS_SOCKADDR_H


25 
	#_BITS_SOCKADDR_H
 1

	)

29 
	tß_Ámûy_t
;

35 
	#__SOCKADDR_COMMON
(
ß_¥efix
) \

36 
ß_Ámûy_t
 
ß_¥efix
##
Ámûy


	)

38 
	#__SOCKADDR_COMMON_SIZE
 ( ())

	)

	@/usr/include/bits/socket.h

21 #i‚de‡
__BITS_SOCKET_H


22 
	#__BITS_SOCKET_H


	)

24 #i‚de‡
_SYS_SOCKET_H


28 
	#__√ed_size_t


	)

29 
	#__√ed_NULL


	)

30 
	~<°ddef.h
>

32 
	~<limôs.h
>

33 
	~<sys/ty≥s.h
>

36 #i‚de‡
__sockÀn_t_deföed


37 
__sockÀn_t
 
	tsockÀn_t
;

38 
	#__sockÀn_t_deföed


	)

42 
	e__sockë_ty≥


44 
	mSOCK_STREAM
 = 1,

46 
	#SOCK_STREAM
 
SOCK_STREAM


	)

47 
	mSOCK_DGRAM
 = 2,

49 
	#SOCK_DGRAM
 
SOCK_DGRAM


	)

50 
	mSOCK_RAW
 = 3,

51 
	#SOCK_RAW
 
SOCK_RAW


	)

52 
	mSOCK_RDM
 = 4,

53 
	#SOCK_RDM
 
SOCK_RDM


	)

54 
	mSOCK_SEQPACKET
 = 5,

56 
	#SOCK_SEQPACKET
 
SOCK_SEQPACKET


	)

57 
	mSOCK_PACKET
 = 10

60 
	#SOCK_PACKET
 
SOCK_PACKET


	)

64 
	#PF_UNSPEC
 0

	)

65 
	#PF_LOCAL
 1

	)

66 
	#PF_UNIX
 
PF_LOCAL


	)

67 
	#PF_FILE
 
PF_LOCAL


	)

68 
	#PF_INET
 2

	)

69 
	#PF_AX25
 3

	)

70 
	#PF_IPX
 4

	)

71 
	#PF_APPLETALK
 5

	)

72 
	#PF_NETROM
 6

	)

73 
	#PF_BRIDGE
 7

	)

74 
	#PF_ATMPVC
 8

	)

75 
	#PF_X25
 9

	)

76 
	#PF_INET6
 10

	)

77 
	#PF_ROSE
 11

	)

78 
	#PF_DEC√t
 12

	)

79 
	#PF_NETBEUI
 13

	)

80 
	#PF_SECURITY
 14

	)

81 
	#PF_KEY
 15

	)

82 
	#PF_NETLINK
 16

	)

83 
	#PF_ROUTE
 
PF_NETLINK


	)

84 
	#PF_PACKET
 17

	)

85 
	#PF_ASH
 18

	)

86 
	#PF_ECONET
 19

	)

87 
	#PF_ATMSVC
 20

	)

88 
	#PF_SNA
 22

	)

89 
	#PF_IRDA
 23

	)

90 
	#PF_PPPOX
 24

	)

91 
	#PF_WANPIPE
 25

	)

92 
	#PF_BLUETOOTH
 31

	)

93 
	#PF_IUCV
 32

	)

94 
	#PF_RXRPC
 33

	)

95 
	#PF_MAX
 34

	)

98 
	#AF_UNSPEC
 
PF_UNSPEC


	)

99 
	#AF_LOCAL
 
PF_LOCAL


	)

100 
	#AF_UNIX
 
PF_UNIX


	)

101 
	#AF_FILE
 
PF_FILE


	)

102 
	#AF_INET
 
PF_INET


	)

103 
	#AF_AX25
 
PF_AX25


	)

104 
	#AF_IPX
 
PF_IPX


	)

105 
	#AF_APPLETALK
 
PF_APPLETALK


	)

106 
	#AF_NETROM
 
PF_NETROM


	)

107 
	#AF_BRIDGE
 
PF_BRIDGE


	)

108 
	#AF_ATMPVC
 
PF_ATMPVC


	)

109 
	#AF_X25
 
PF_X25


	)

110 
	#AF_INET6
 
PF_INET6


	)

111 
	#AF_ROSE
 
PF_ROSE


	)

112 
	#AF_DEC√t
 
PF_DEC√t


	)

113 
	#AF_NETBEUI
 
PF_NETBEUI


	)

114 
	#AF_SECURITY
 
PF_SECURITY


	)

115 
	#AF_KEY
 
PF_KEY


	)

116 
	#AF_NETLINK
 
PF_NETLINK


	)

117 
	#AF_ROUTE
 
PF_ROUTE


	)

118 
	#AF_PACKET
 
PF_PACKET


	)

119 
	#AF_ASH
 
PF_ASH


	)

120 
	#AF_ECONET
 
PF_ECONET


	)

121 
	#AF_ATMSVC
 
PF_ATMSVC


	)

122 
	#AF_SNA
 
PF_SNA


	)

123 
	#AF_IRDA
 
PF_IRDA


	)

124 
	#AF_PPPOX
 
PF_PPPOX


	)

125 
	#AF_WANPIPE
 
PF_WANPIPE


	)

126 
	#AF_BLUETOOTH
 
PF_BLUETOOTH


	)

127 
	#AF_IUCV
 
PF_IUCV


	)

128 
	#AF_RXRPC
 
PF_RXRPC


	)

129 
	#AF_MAX
 
PF_MAX


	)

135 
	#SOL_RAW
 255

	)

136 
	#SOL_DECNET
 261

	)

137 
	#SOL_X25
 262

	)

138 
	#SOL_PACKET
 263

	)

139 
	#SOL_ATM
 264

	)

140 
	#SOL_AAL
 265

	)

141 
	#SOL_IRDA
 266

	)

144 
	#SOMAXCONN
 128

	)

147 
	~<bôs/sockaddr.h
>

150 
	ssockaddr


152 
__SOCKADDR_COMMON
 (
ß_
);

153 
	mß_d©a
[14];

159 #i‡
ULONG_MAX
 > 0xffffffff

160 
	#__ss_Æig¡y≥
 
__uöt64_t


	)

162 
	#__ss_Æig¡y≥
 
__uöt32_t


	)

164 
	#_SS_SIZE
 128

	)

165 
	#_SS_PADSIZE
 (
_SS_SIZE
 - (2 *  (
__ss_Æig¡y≥
)))

	)

167 
	ssockaddr_°‹age


169 
__SOCKADDR_COMMON
 (
ss_
);

170 
__ss_Æig¡y≥
 
	m__ss_Æign
;

171 
	m__ss_∑ddög
[
_SS_PADSIZE
];

178 
	mMSG_OOB
 = 0x01,

179 
	#MSG_OOB
 
MSG_OOB


	)

180 
	mMSG_PEEK
 = 0x02,

181 
	#MSG_PEEK
 
MSG_PEEK


	)

182 
	mMSG_DONTROUTE
 = 0x04,

183 
	#MSG_DONTROUTE
 
MSG_DONTROUTE


	)

184 #ifde‡
__USE_GNU


186 
	mMSG_TRYHARD
 = 
MSG_DONTROUTE
,

187 
	#MSG_TRYHARD
 
MSG_DONTROUTE


	)

189 
	mMSG_CTRUNC
 = 0x08,

190 
	#MSG_CTRUNC
 
MSG_CTRUNC


	)

191 
	mMSG_PROXY
 = 0x10,

192 
	#MSG_PROXY
 
MSG_PROXY


	)

193 
	mMSG_TRUNC
 = 0x20,

194 
	#MSG_TRUNC
 
MSG_TRUNC


	)

195 
	mMSG_DONTWAIT
 = 0x40,

196 
	#MSG_DONTWAIT
 
MSG_DONTWAIT


	)

197 
	mMSG_EOR
 = 0x80,

198 
	#MSG_EOR
 
MSG_EOR


	)

199 
	mMSG_WAITALL
 = 0x100,

200 
	#MSG_WAITALL
 
MSG_WAITALL


	)

201 
	mMSG_FIN
 = 0x200,

202 
	#MSG_FIN
 
MSG_FIN


	)

203 
	mMSG_SYN
 = 0x400,

204 
	#MSG_SYN
 
MSG_SYN


	)

205 
	mMSG_CONFIRM
 = 0x800,

206 
	#MSG_CONFIRM
 
MSG_CONFIRM


	)

207 
	mMSG_RST
 = 0x1000,

208 
	#MSG_RST
 
MSG_RST


	)

209 
	mMSG_ERRQUEUE
 = 0x2000,

210 
	#MSG_ERRQUEUE
 
MSG_ERRQUEUE


	)

211 
	mMSG_NOSIGNAL
 = 0x4000,

212 
	#MSG_NOSIGNAL
 
MSG_NOSIGNAL


	)

213 
	mMSG_MORE
 = 0x8000,

214 
	#MSG_MORE
 
MSG_MORE


	)

216 
	mMSG_CMSG_CLOEXEC
 = 0x40000000

219 
	#MSG_CMSG_CLOEXEC
 
MSG_CMSG_CLOEXEC


	)

225 
	smsghdr


227 *
	mmsg_«me
;

228 
sockÀn_t
 
	mmsg_«mñí
;

230 
iovec
 *
	mmsg_iov
;

231 
size_t
 
	mmsg_iovÀn
;

233 *
	mmsg_c⁄åﬁ
;

234 
size_t
 
	mmsg_c⁄åﬁÀn
;

239 
	mmsg_Êags
;

243 
	scmsghdr


245 
size_t
 
	mcmsg_Àn
;

250 
	mcmsg_Àvñ
;

251 
	mcmsg_ty≥
;

252 #i‡(!
deföed
 
__STRICT_ANSI__
 && 
__GNUC__
 >2Ë|| 
__STDC_VERSION__
 >= 199901L

253 
__exãnsi⁄__
 
__cmsg_d©a
 
	m__Êex¨r
;

258 #i‡(!
deföed
 
__STRICT_ANSI__
 && 
__GNUC__
 >2Ë|| 
__STDC_VERSION__
 >= 199901L

259 
	#CMSG_DATA
(
cmsg
Ë((cmsg)->
__cmsg_d©a
)

	)

261 
	#CMSG_DATA
(
cmsg
Ë((*Ë((
cmsghdr
 *Ë(cmsgË+ 1))

	)

263 
	#CMSG_NXTHDR
(
mhdr
, 
cmsg
Ë
	`__cmsg_nxthdr
 (mhdr, cmsg)

	)

264 
	#CMSG_FIRSTHDR
(
mhdr
) \

265 ((
size_t
Ë(
mhdr
)->
msg_c⁄åﬁÀn
 > (
cmsghdr
) \

266 ? (
cmsghdr
 *Ë(
mhdr
)->
msg_c⁄åﬁ
 : (cmsghd∏*Ë
NULL
)

	)

267 
	#CMSG_ALIGN
(
Àn
Ë((÷íË+  (
size_t
) - 1) \

268 & (
size_t
Ë~( (size_tË- 1))

	)

269 
	#CMSG_SPACE
(
Àn
Ë(
	`CMSG_ALIGN
 (len) \

270 + 
	`CMSG_ALIGN
 ( (
cmsghdr
)))

	)

271 
	#CMSG_LEN
(
Àn
Ë(
	`CMSG_ALIGN
 ( (
cmsghdr
)Ë+ (Àn))

	)

273 
cmsghdr
 *
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
,

274 
cmsghdr
 *
__cmsg
Ë
__THROW
;

275 #ifde‡
__USE_EXTERN_INLINES


276 #i‚de‡
_EXTERN_INLINE


277 
	#_EXTERN_INLINE
 
__exã∫_ölöe


	)

279 
_EXTERN_INLINE
 
cmsghdr
 *

280 
	`__NTH
 (
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
, 
cmsghdr
 *
__cmsg
))

282 i‡((
size_t
Ë
__cmsg
->
cmsg_Àn
 <  (
cmsghdr
))

286 
__cmsg
 = (
cmsghdr
 *) ((*) __cmsg

287 + 
	`CMSG_ALIGN
 (
__cmsg
->
cmsg_Àn
));

288 i‡((*Ë(
__cmsg
 + 1Ë> ((*Ë
__mhdr
->
msg_c⁄åﬁ


289 + 
__mhdr
->
msg_c⁄åﬁÀn
)

290 || ((*Ë
__cmsg
 + 
	`CMSG_ALIGN
 (__cmsg->
cmsg_Àn
)

291 > ((*Ë
__mhdr
->
msg_c⁄åﬁ
 + __mhdr->
msg_c⁄åﬁÀn
)))

294  
__cmsg
;

295 
	}
}

302 
	mSCM_RIGHTS
 = 0x01

303 
	#SCM_RIGHTS
 
SCM_RIGHTS


	)

304 #ifde‡
__USE_BSD


305 , 
	mSCM_CREDENTIALS
 = 0x02

306 
	#SCM_CREDENTIALS
 
SCM_CREDENTIALS


	)

312 
	su¸ed


314 
pid_t
 
	mpid
;

315 
uid_t
 
	muid
;

316 
gid_t
 
	mgid
;

320 
	~<asm/sockë.h
>

324 
	slögî


326 
	ml_⁄off
;

327 
	ml_lögî
;

	@/usr/include/bits/socket2.h

20 #i‚de‡
_SYS_SOCKET_H


24 
ssize_t
 
__ªcv_chk
 (
__fd
, *
__buf
, 
size_t
 
__n
, size_à
__buÊí
,

25 
__Êags
);

26 
ssize_t
 
__REDIRECT
 (
__ªcv_Æüs
, (
__fd
, *
__buf
, 
size_t
 
__n
,

27 
__Êags
), 
ªcv
);

28 
ssize_t
 
__REDIRECT
 (
__ªcv_chk_w¨n
,

29 (
__fd
, *
__buf
, 
size_t
 
__n
, size_à
__buÊí
,

30 
__Êags
), 
__ªcv_chk
)

31 
__w¨«âr
 ("recv called with biggerÜengthÅhan size of destination "

34 
__exã∫_Æways_ölöe
 
ssize_t


35 
	$ªcv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__Êags
)

37 i‡(
	`__bos0
 (
__buf
Ë!(
size_t
) -1)

39 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
))

40  
	`__ªcv_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__Êags
);

42 i‡(
__n
 > 
	`__bos0
 (
__buf
))

43  
	`__ªcv_chk_w¨n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__Êags
);

45  
	`__ªcv_Æüs
 (
__fd
, 
__buf
, 
__n
, 
__Êags
);

46 
	}
}

48 
ssize_t
 
__ªcv‰om_chk
 (
__fd
, *
__ª°ri˘
 
__buf
, 
size_t
 
__n
,

49 
size_t
 
__buÊí
, 
__Êags
,

50 
__SOCKADDR_ARG
 
__addr
,

51 
sockÀn_t
 *
__ª°ri˘
 
__addr_Àn
);

52 
ssize_t
 
__REDIRECT
 (
__ªcv‰om_Æüs
,

53 (
__fd
, *
__ª°ri˘
 
__buf
, 
size_t
 
__n
,

54 
__Êags
, 
__SOCKADDR_ARG
 
__addr
,

55 
sockÀn_t
 *
__ª°ri˘
 
__addr_Àn
), 
ªcv‰om
);

56 
ssize_t
 
__REDIRECT
 (
__ªcv‰om_chk_w¨n
,

57 (
__fd
, *
__ª°ri˘
 
__buf
, 
size_t
 
__n
,

58 
size_t
 
__buÊí
, 
__Êags
,

59 
__SOCKADDR_ARG
 
__addr
,

60 
sockÀn_t
 *
__ª°ri˘
 
__addr_Àn
), 
__ªcv‰om_chk
)

61 
__w¨«âr
 ("recvfrom called with biggerÜengthÅhan size of "

64 
__exã∫_Æways_ölöe
 
ssize_t


65 
	$ªcv‰om
 (
__fd
, *
__ª°ri˘
 
__buf
, 
size_t
 
__n
, 
__Êags
,

66 
__SOCKADDR_ARG
 
__addr
, 
sockÀn_t
 *
__ª°ri˘
 
__addr_Àn
)

68 i‡(
	`__bos0
 (
__buf
Ë!(
size_t
) -1)

70 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
))

71  
	`__ªcv‰om_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__Êags
,

72 
__addr
, 
__addr_Àn
);

73 i‡(
__n
 > 
	`__bos0
 (
__buf
))

74  
	`__ªcv‰om_chk_w¨n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__Êags
,

75 
__addr
, 
__addr_Àn
);

77  
	`__ªcv‰om_Æüs
 (
__fd
, 
__buf
, 
__n
, 
__Êags
, 
__addr
, 
__addr_Àn
);

78 
	}
}

	@/usr/include/bits/stat.h

19 #i‚de‡
_SYS_STAT_H


24 
	#_STAT_VER_LINUX_OLD
 1

	)

25 
	#_STAT_VER_KERNEL
 1

	)

26 
	#_STAT_VER_SVR4
 2

	)

27 
	#_STAT_VER_LINUX
 3

	)

28 
	#_STAT_VER
 
_STAT_VER_LINUX


	)

31 
	#_MKNOD_VER_LINUX
 1

	)

32 
	#_MKNOD_VER_SVR4
 2

	)

33 
	#_MKNOD_VER
 
_MKNOD_VER_LINUX


	)

36 
	s°©


38 
__dev_t
 
	m°_dev
;

39 
	m__∑d1
;

40 #i‚de‡
__USE_FILE_OFFSET64


41 
__öo_t
 
	m°_öo
;

43 
__öo_t
 
	m__°_öo
;

45 
__mode_t
 
	m°_mode
;

46 
__∆ök_t
 
	m°_∆ök
;

47 
__uid_t
 
	m°_uid
;

48 
__gid_t
 
	m°_gid
;

49 
__dev_t
 
	m°_rdev
;

50 
	m__∑d2
;

51 #i‚de‡
__USE_FILE_OFFSET64


52 
__off_t
 
	m°_size
;

54 
__off64_t
 
	m°_size
;

56 
__blksize_t
 
	m°_blksize
;

58 #i‚de‡
__USE_FILE_OFFSET64


59 
__blk˙t_t
 
	m°_blocks
;

61 
__blk˙t64_t
 
	m°_blocks
;

63 #ifde‡
__USE_MISC


70 
time•ec
 
	m°_©im
;

71 
time•ec
 
	m°_mtim
;

72 
time•ec
 
	m°_˘im
;

73 
	#°_©ime
 
°_©im
.
tv_£c


	)

74 
	#°_mtime
 
°_mtim
.
tv_£c


	)

75 
	#°_˘ime
 
°_˘im
.
tv_£c


	)

77 
__time_t
 
	m°_©ime
;

78 
	m°_©imí£c
;

79 
__time_t
 
	m°_mtime
;

80 
	m°_mtimí£c
;

81 
__time_t
 
	m°_˘ime
;

82 
	m°_˘imí£c
;

84 #i‚de‡
__USE_FILE_OFFSET64


85 
	m__unu£d4
;

86 
	m__unu£d5
;

88 
__öo64_t
 
	m°_öo
;

92 #ifde‡
__USE_LARGEFILE64


93 
	s°©64


95 
__dev_t
 
	m°_dev
;

96 
	m__∑d1
;

98 
__öo_t
 
	m__°_öo
;

99 
__mode_t
 
	m°_mode
;

100 
__∆ök_t
 
	m°_∆ök
;

101 
__uid_t
 
	m°_uid
;

102 
__gid_t
 
	m°_gid
;

103 
__dev_t
 
	m°_rdev
;

104 
	m__∑d2
;

105 
__off64_t
 
	m°_size
;

106 
__blksize_t
 
	m°_blksize
;

108 
__blk˙t64_t
 
	m°_blocks
;

109 #ifde‡
__USE_MISC


116 
time•ec
 
	m°_©im
;

117 
time•ec
 
	m°_mtim
;

118 
time•ec
 
	m°_˘im
;

120 
__time_t
 
	m°_©ime
;

121 
	m°_©imí£c
;

122 
__time_t
 
	m°_mtime
;

123 
	m°_mtimí£c
;

124 
__time_t
 
	m°_˘ime
;

125 
	m°_˘imí£c
;

127 
__öo64_t
 
	m°_öo
;

132 
	#_STATBUF_ST_BLKSIZE


	)

133 
	#_STATBUF_ST_RDEV


	)

135 
	#_STATBUF_ST_NSEC


	)

139 
	#__S_IFMT
 0170000

	)

142 
	#__S_IFDIR
 0040000

	)

143 
	#__S_IFCHR
 0020000

	)

144 
	#__S_IFBLK
 0060000

	)

145 
	#__S_IFREG
 0100000

	)

146 
	#__S_IFIFO
 0010000

	)

147 
	#__S_IFLNK
 0120000

	)

148 
	#__S_IFSOCK
 0140000

	)

152 
	#__S_TYPEISMQ
(
buf
Ë((buf)->
°_mode
 - (buf)->°_mode)

	)

153 
	#__S_TYPEISSEM
(
buf
Ë((buf)->
°_mode
 - (buf)->°_mode)

	)

154 
	#__S_TYPEISSHM
(
buf
Ë((buf)->
°_mode
 - (buf)->°_mode)

	)

158 
	#__S_ISUID
 04000

	)

159 
	#__S_ISGID
 02000

	)

160 
	#__S_ISVTX
 01000

	)

161 
	#__S_IREAD
 0400

	)

162 
	#__S_IWRITE
 0200

	)

163 
	#__S_IEXEC
 0100

	)

165 #i‡
deföed
 
__USE_ATFILE
 || deföed 
__USE_GNU


167 
	#UTIME_NOW
 ((1»<< 30Ë- 1l)

	)

168 
	#UTIME_OMIT
 ((1»<< 30Ë- 2l)

	)

	@/usr/include/bits/stdio-ldbl.h

20 #i‚de‡
_STDIO_H


24 
__BEGIN_NAMESPACE_STD


25 
	$__LDBL_REDIR_DECL
 (
Ârötf
)

26 
	$__LDBL_REDIR_DECL
 (
¥ötf
)

27 
	$__LDBL_REDIR_DECL
 (
•rötf
)

28 
	$__LDBL_REDIR_DECL
 (
vÂrötf
)

29 
	$__LDBL_REDIR_DECL
 (
v¥ötf
)

30 
	$__LDBL_REDIR_DECL
 (
v•rötf
)

31 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

32 && !
deföed
 
__REDIRECT
 \

33 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

34 
	$__LDBL_REDIR1_DECL
 (
fsˇnf
, 
__∆dbl___isoc99_fsˇnf
)

35 
	$__LDBL_REDIR1_DECL
 (
sˇnf
, 
__∆dbl___isoc99_sˇnf
)

36 
	$__LDBL_REDIR1_DECL
 (
ssˇnf
, 
__∆dbl___isoc99_ssˇnf
)

38 
	$__LDBL_REDIR_DECL
 (
fsˇnf
)

39 
	$__LDBL_REDIR_DECL
 (
sˇnf
)

40 
	$__LDBL_REDIR_DECL
 (
ssˇnf
)

42 
__END_NAMESPACE_STD


44 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_ISOC99
 || deföed 
__USE_UNIX98


45 
__BEGIN_NAMESPACE_C99


46 
	$__LDBL_REDIR_DECL
 (
¢¥ötf
)

47 
	$__LDBL_REDIR_DECL
 (
v¢¥ötf
)

48 
__END_NAMESPACE_C99


51 #ifdef 
__USE_ISOC99


52 
__BEGIN_NAMESPACE_C99


53 #i‡!
deföed
 
__USE_GNU
 && !deföed 
__REDIRECT
 \

54 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

55 
	$__LDBL_REDIR1_DECL
 (
vfsˇnf
, 
__∆dbl___isoc99_vfsˇnf
)

56 
	$__LDBL_REDIR1_DECL
 (
vsˇnf
, 
__∆dbl___isoc99_vsˇnf
)

57 
	$__LDBL_REDIR1_DECL
 (
vssˇnf
, 
__∆dbl___isoc99_vssˇnf
)

59 
	$__LDBL_REDIR_DECL
 (
vfsˇnf
)

60 
	$__LDBL_REDIR_DECL
 (
vssˇnf
)

61 
	$__LDBL_REDIR_DECL
 (
vsˇnf
)

63 
__END_NAMESPACE_C99


66 #ifde‡
__USE_GNU


67 
	$__LDBL_REDIR_DECL
 (
vd¥ötf
)

68 
	$__LDBL_REDIR_DECL
 (
d¥ötf
)

69 
	$__LDBL_REDIR_DECL
 (
va•rötf
)

70 
	$__LDBL_REDIR_DECL
 (
__a•rötf
)

71 
	$__LDBL_REDIR_DECL
 (
a•rötf
)

72 
	$__LDBL_REDIR_DECL
 (
ob°ack_¥ötf
)

73 
	$__LDBL_REDIR_DECL
 (
ob°ack_v¥ötf
)

76 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


77 
	$__LDBL_REDIR_DECL
 (
__•rötf_chk
)

78 
	$__LDBL_REDIR_DECL
 (
__v•rötf_chk
)

79 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_ISOC99
 || deföed 
__USE_UNIX98


80 
	$__LDBL_REDIR_DECL
 (
__¢¥ötf_chk
)

81 
	$__LDBL_REDIR_DECL
 (
__v¢¥ötf_chk
)

83 #i‡
__USE_FORTIFY_LEVEL
 > 1

84 
	$__LDBL_REDIR_DECL
 (
__Ârötf_chk
)

85 
	$__LDBL_REDIR_DECL
 (
__¥ötf_chk
)

86 
	$__LDBL_REDIR_DECL
 (
__vÂrötf_chk
)

87 
	$__LDBL_REDIR_DECL
 (
__v¥ötf_chk
)

88 #ifde‡
__USE_GNU


89 
	$__LDBL_REDIR_DECL
 (
__a•rötf_chk
)

90 
	$__LDBL_REDIR_DECL
 (
__va•rötf_chk
)

91 
	$__LDBL_REDIR_DECL
 (
__d¥ötf_chk
)

92 
	$__LDBL_REDIR_DECL
 (
__vd¥ötf_chk
)

93 
	$__LDBL_REDIR_DECL
 (
__ob°ack_¥ötf_chk
)

94 
	$__LDBL_REDIR_DECL
 (
__ob°ack_v¥ötf_chk
)

	@/usr/include/bits/stdio.h

20 #i‚de‡
_STDIO_H


24 #i‚de‡
__exã∫_ölöe


25 
	#__STDIO_INLINE
 
ölöe


	)

27 
	#__STDIO_INLINE
 
__exã∫_ölöe


	)

31 #ifde‡
__USE_EXTERN_INLINES


34 #i‡!(
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe
)

36 
__STDIO_INLINE
 

37 
	$v¥ötf
 (
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
_G_va_li°
 
__¨g
)

39  
	`vÂrötf
 (
°dout
, 
__fmt
, 
__¨g
);

40 
	}
}

44 
__STDIO_INLINE
 

45 
	$gëch¨
 ()

47  
	`_IO_gëc
 (
°dö
);

48 
	}
}

51 #ifde‡
__USE_MISC


53 
__STDIO_INLINE
 

54 
	$fgëc_u∆ocked
 (
FILE
 *
__Â
)

56  
	`_IO_gëc_u∆ocked
 (
__Â
);

57 
	}
}

61 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


63 
__STDIO_INLINE
 

64 
	$gëc_u∆ocked
 (
FILE
 *
__Â
)

66  
	`_IO_gëc_u∆ocked
 (
__Â
);

67 
	}
}

70 
__STDIO_INLINE
 

71 
	$gëch¨_u∆ocked
 ()

73  
	`_IO_gëc_u∆ocked
 (
°dö
);

74 
	}
}

79 
__STDIO_INLINE
 

80 
	$putch¨
 (
__c
)

82  
	`_IO_putc
 (
__c
, 
°dout
);

83 
	}
}

86 #ifde‡
__USE_MISC


88 
__STDIO_INLINE
 

89 
	$Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
)

91  
	`_IO_putc_u∆ocked
 (
__c
, 
__°ªam
);

92 
	}
}

96 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


98 
__STDIO_INLINE
 

99 
	$putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
)

101  
	`_IO_putc_u∆ocked
 (
__c
, 
__°ªam
);

102 
	}
}

105 
__STDIO_INLINE
 

106 
	$putch¨_u∆ocked
 (
__c
)

108  
	`_IO_putc_u∆ocked
 (
__c
, 
°dout
);

109 
	}
}

113 #ifdef 
__USE_GNU


115 
__STDIO_INLINE
 
_IO_ssize_t


116 
	$gëlöe
 (**
__löïå
, 
size_t
 *
__n
, 
FILE
 *
__°ªam
)

118  
	`__gëdñim
 (
__löïå
, 
__n
, '\n', 
__°ªam
);

119 
	}
}

123 #ifde‡
__USE_MISC


125 
__STDIO_INLINE
 

126 
__NTH
 (
	$„of_u∆ocked
 (
FILE
 *
__°ªam
))

128  
	`_IO_„of_u∆ocked
 (
__°ªam
);

129 
	}
}

132 
__STDIO_INLINE
 

133 
__NTH
 (
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
))

135  
	`_IO_„º‹_u∆ocked
 (
__°ªam
);

136 
	}
}

142 #i‡
deföed
 
__USE_MISC
 && deföed 
__GNUC__
 && deföed 
__OPTIMIZE__
 \

143 && !
deföed
 
	g__˝lu•lus


145 
	#‰ód_u∆ocked
(
±r
, 
size
, 
n
, 
°ªam
) \

146 (
	`__exãnsi⁄__
 ((
	`__buûtö_c⁄°™t_p
 (
size
Ë&& __buûtö_c⁄°™t_∞(
n
) \

147 && (
size_t
Ë(
size
Ë* (size_tË(
n
) <= 8 \

148 && (
size_t
Ë(
size
) != 0) \

149 ? ({ *
__±r
 = (*Ë(
±r
); \

150 
FILE
 *
__°ªam
 = (
°ªam
); \

151 
size_t
 
__˙t
; \

152 
__˙t
 = (
size_t
Ë(
size
Ë* (size_tË(
n
); \

153 
__˙t
 > 0; --__cnt) \

155 
__c
 = 
	`_IO_gëc_u∆ocked
 (
__°ªam
); \

156 i‡(
__c
 =
EOF
) \

158 *
__±r
++ = 
__c
; \

160 ((
size_t
Ë(
size
Ë* (size_tË(
n
Ë- 
__˙t
) \

161 / (
size_t
Ë(
size
); }) \

162 : (((
	`__buûtö_c⁄°™t_p
 (
size
Ë&& (
size_t
) (size) == 0) \

163 || (
	`__buûtö_c⁄°™t_p
 (
n
Ë&& (
size_t
) (n) == 0)) \

165 ? ((Ë(
±r
), (Ë(
°ªam
), (Ë(
size
), \

166 (Ë(
n
), (
size_t
) 0) \

167 : 
	`‰ód_u∆ocked
 (
±r
, 
size
, 
n
, 
°ªam
))))

	)

169 
	#fwrôe_u∆ocked
(
±r
, 
size
, 
n
, 
°ªam
) \

170 (
	`__exãnsi⁄__
 ((
	`__buûtö_c⁄°™t_p
 (
size
Ë&& __buûtö_c⁄°™t_∞(
n
) \

171 && (
size_t
Ë(
size
Ë* (size_tË(
n
) <= 8 \

172 && (
size_t
Ë(
size
) != 0) \

173 ? ({ c⁄° *
__±r
 = (c⁄° *Ë(
±r
); \

174 
FILE
 *
__°ªam
 = (
°ªam
); \

175 
size_t
 
__˙t
; \

176 
__˙t
 = (
size_t
Ë(
size
Ë* (size_tË(
n
); \

177 
__˙t
 > 0; --__cnt) \

178 i‡(
	`_IO_putc_u∆ocked
 (*
__±r
++, 
__°ªam
Ë=
EOF
) \

180 ((
size_t
Ë(
size
Ë* (size_tË(
n
Ë- 
__˙t
) \

181 / (
size_t
Ë(
size
); }) \

182 : (((
	`__buûtö_c⁄°™t_p
 (
size
Ë&& (
size_t
) (size) == 0) \

183 || (
	`__buûtö_c⁄°™t_p
 (
n
Ë&& (
size_t
) (n) == 0)) \

185 ? ((Ë(
±r
), (Ë(
°ªam
), (Ë(
size
), \

186 (Ë(
n
), (
size_t
) 0) \

187 : 
	`fwrôe_u∆ocked
 (
±r
, 
size
, 
n
, 
°ªam
))))

	)

191 #unde‡
__STDIO_INLINE


	@/usr/include/bits/stdio2.h

20 #i‚de‡
_STDIO_H


24 
	$__•rötf_chk
 (*
__ª°ri˘
 
__s
, 
__Êag
, 
size_t
 
__¶í
,

25 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

26 
	$__v•rötf_chk
 (*
__ª°ri˘
 
__s
, 
__Êag
, 
size_t
 
__¶í
,

27 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

28 
_G_va_li°
 
__≠
Ë
__THROW
;

30 #ifde‡
__va_¨g_∑ck


31 
__exã∫_Æways_ölöe
 

32 
	`__NTH
 (
	$•rötf
 (*
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__fmt
, ...))

34  
	`__buûtö___•rötf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

35 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¨g_∑ck
 ());

36 
	}
}

37 #ñi‡!
deföed
 
__˝lu•lus


38 
	#•rötf
(
°r
, ...) \

39 
	`__buûtö___•rötf_chk
 (
°r
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

40 
__VA_ARGS__
)

	)

43 
__exã∫_Æways_ölöe
 

44 
__NTH
 (
	$v•rötf
 (*
__ª°ri˘
 
__s
, 
__c⁄°
 *__ª°ri˘ 
__fmt
,

45 
_G_va_li°
 
__≠
))

47  
	`__buûtö___v•rötf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

48 
	`__bos
 (
__s
), 
__fmt
, 
__≠
);

49 
	}
}

51 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_ISOC99
 || deföed 
__USE_UNIX98


53 
	$__¢¥ötf_chk
 (*
__ª°ri˘
 
__s
, 
size_t
 
__n
, 
__Êag
,

54 
size_t
 
__¶í
, 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

55 ...Ë
__THROW
;

56 
	$__v¢¥ötf_chk
 (*
__ª°ri˘
 
__s
, 
size_t
 
__n
, 
__Êag
,

57 
size_t
 
__¶í
, 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

58 
_G_va_li°
 
__≠
Ë
__THROW
;

60 #ifde‡
__va_¨g_∑ck


61 
__exã∫_Æways_ölöe
 

62 
	`__NTH
 (
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__n
,

63 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...))

65  
	`__buûtö___¢¥ötf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

66 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¨g_∑ck
 ());

67 
	}
}

68 #ñi‡!
deföed
 
__˝lu•lus


69 
	#¢¥ötf
(
°r
, 
Àn
, ...) \

70 
	`__buûtö___¢¥ötf_chk
 (
°r
, 
Àn
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

71 
__VA_ARGS__
)

	)

74 
__exã∫_Æways_ölöe
 

75 
__NTH
 (
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__n
,

76 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
_G_va_li°
 
__≠
))

78  
	`__buûtö___v¢¥ötf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

79 
	`__bos
 (
__s
), 
__fmt
, 
__≠
);

80 
	}
}

84 #i‡
__USE_FORTIFY_LEVEL
 > 1

86 
__Ârötf_chk
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
__Êag
,

87 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...);

88 
__¥ötf_chk
 (
__Êag
, 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, ...);

89 
__vÂrötf_chk
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
__Êag
,

90 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__≠
);

91 
__v¥ötf_chk
 (
__Êag
, 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

92 
_G_va_li°
 
__≠
);

94 #ifde‡
__va_¨g_∑ck


95 
__exã∫_Æways_ölöe
 

96 
	$Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
__c⁄°
 *__ª°ri˘ 
__fmt
, ...)

98  
	`__Ârötf_chk
 (
__°ªam
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

99 
	`__va_¨g_∑ck
 ());

100 
	}
}

102 
__exã∫_Æways_ölöe
 

103 
	$¥ötf
 (
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

105  
	`__¥ötf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¨g_∑ck
 ());

106 
	}
}

107 #ñi‡!
deföed
 
__˝lu•lus


108 
	#¥ötf
(...) \

109 
	`__¥ötf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

110 
	#Ârötf
(
°ªam
, ...) \

111 
	`__Ârötf_chk
 (
°ªam
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

114 
__exã∫_Æways_ölöe
 

115 
	$v¥ötf
 (
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
_G_va_li°
 
__≠
)

117 #ifde‡
__USE_EXTERN_INLINES


118  
	`__vÂrötf_chk
 (
°dout
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__≠
);

120  
	`__v¥ötf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__≠
);

122 
	}
}

124 
__exã∫_Æways_ölöe
 

125 
	$vÂrötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

126 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
_G_va_li°
 
__≠
)

128  
	`__vÂrötf_chk
 (
__°ªam
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__≠
);

129 
	}
}

131 #ifde‡
__USE_GNU


133 
	$__a•rötf_chk
 (**
__ª°ri˘
 
__±r
, 
__Êag
,

134 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

135 
__THROW
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 3, 4))Ë
__wur
;

136 
	$__va•rötf_chk
 (**
__ª°ri˘
 
__±r
, 
__Êag
,

137 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
_G_va_li°
 
__¨g
)

138 
__THROW
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 3, 0))Ë
__wur
;

139 
	$__d¥ötf_chk
 (
__fd
, 
__Êag
, 
__c⁄°
 *
__ª°ri˘
 
__fmt
,

140 ...Ë
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

141 
	$__vd¥ötf_chk
 (
__fd
, 
__Êag
,

142 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
_G_va_li°
 
__¨g
)

143 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

144 
	$__ob°ack_¥ötf_chk
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

145 
__Êag
, 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

147 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

148 
	$__ob°ack_v¥ötf_chk
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

149 
__Êag
,

150 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

151 
_G_va_li°
 
__¨gs
)

152 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

154 #ifde‡
__va_¨g_∑ck


155 
__exã∫_Æways_ölöe
 

156 
	`__NTH
 (
	$a•rötf
 (**
__ª°ri˘
 
__±r
, 
__c⁄°
 *__ª°ri˘ 
__fmt
, ...))

158  
	`__a•rötf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

159 
	`__va_¨g_∑ck
 ());

160 
	}
}

162 
__exã∫_Æways_ölöe
 

163 
__NTH
 (
	$__a•rötf
 (**
__ª°ri˘
 
__±r
, 
__c⁄°
 *__ª°ri˘ 
__fmt
,

166  
	`__a•rötf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

167 
	`__va_¨g_∑ck
 ());

168 
	}
}

170 
__exã∫_Æways_ölöe
 

171 
	$d¥ötf
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...)

173  
	`__d¥ötf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

174 
	`__va_¨g_∑ck
 ());

175 
	}
}

177 
__exã∫_Æways_ölöe
 

178 
__NTH
 (
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

179 
__c⁄°
 *
__ª°ri˘
 
__fmt
, ...))

181  
	`__ob°ack_¥ötf_chk
 (
__ob°ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

182 
	`__va_¨g_∑ck
 ());

183 
	}
}

184 #ñi‡!
deföed
 
__˝lu•lus


185 
	#a•rötf
(
±r
, ...) \

186 
	`__a•rötf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

187 
	#__a•rötf
(
±r
, ...) \

188 
	`__a•rötf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

189 
	#d¥ötf
(
fd
, ...) \

190 
	`__d¥ötf_chk
 (
fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

191 
	#ob°ack_¥ötf
(
ob°ack
, ...) \

192 
	`__ob°ack_¥ötf_chk
 (
ob°ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

195 
__exã∫_Æways_ölöe
 

196 
__NTH
 (
	$va•rötf
 (**
__ª°ri˘
 
__±r
, 
__c⁄°
 *__ª°ri˘ 
__fmt
,

197 
_G_va_li°
 
__≠
))

199  
	`__va•rötf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__≠
);

200 
	}
}

202 
__exã∫_Æways_ölöe
 

203 
	$vd¥ötf
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
_G_va_li°
 
__≠
)

205  
	`__vd¥ötf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__≠
);

206 
	}
}

208 
__exã∫_Æways_ölöe
 

209 
__NTH
 (
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

210 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
_G_va_li°
 
__≠
))

212  
	`__ob°ack_v¥ötf_chk
 (
__ob°ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

213 
__≠
);

214 
	}
}

220 *
	$__gës_chk
 (*
__°r
, 
size_t
Ë
__wur
;

221 *
	`__REDIRECT
 (
__gës_w¨n
, (*
__°r
), 
gës
)

222 
__wur
 
	`__w¨«âr
 ("please use fgets or getline instead, gets can't "

225 
__exã∫_Æways_ölöe
 
__wur
 *

226 
	$gës
 (*
__°r
)

228 i‡(
	`__bos
 (
__°r
Ë!(
size_t
) -1)

229  
	`__gës_chk
 (
__°r
, 
	`__bos
 (__str));

230  
	`__gës_w¨n
 (
__°r
);

231 
	}
}

233 *
	$__fgës_chk
 (*
__ª°ri˘
 
__s
, 
size_t
 
__size
, 
__n
,

234 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

235 *
	`__REDIRECT
 (
__fgës_Æüs
,

236 (*
__ª°ri˘
 
__s
, 
__n
,

237 
FILE
 *
__ª°ri˘
 
__°ªam
), 
fgës
Ë
__wur
;

238 *
	`__REDIRECT
 (
__fgës_chk_w¨n
,

239 (*
__ª°ri˘
 
__s
, 
size_t
 
__size
, 
__n
,

240 
FILE
 *
__ª°ri˘
 
__°ªam
), 
__fgës_chk
)

241 
__wur
 
	`__w¨«âr
 ("fgets called with bigger sizeÅhanÜength "

244 
__exã∫_Æways_ölöe
 
__wur
 *

245 
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

247 i‡(
	`__bos
 (
__s
Ë!(
size_t
) -1)

249 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
) || __n <= 0)

250  
	`__fgës_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__°ªam
);

252 i‡((
size_t
Ë
__n
 > 
	`__bos
 (
__s
))

253  
	`__fgës_chk_w¨n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__°ªam
);

255  
	`__fgës_Æüs
 (
__s
, 
__n
, 
__°ªam
);

256 
	}
}

258 
size_t
 
	$__‰ód_chk
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__±æí
,

259 
size_t
 
__size
, size_à
__n
,

260 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

261 
size_t
 
	`__REDIRECT
 (
__‰ód_Æüs
,

262 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

263 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
),

264 
‰ód
Ë
__wur
;

265 
size_t
 
	`__REDIRECT
 (
__‰ód_chk_w¨n
,

266 (*
__ª°ri˘
 
__±r
, 
size_t
 
__±æí
,

267 
size_t
 
__size
, size_à
__n
,

268 
FILE
 *
__ª°ri˘
 
__°ªam
),

269 
__‰ód_chk
)

270 
__wur
 
	`__w¨«âr
 ("fread called with bigger size *ÇmembÅhanÜength "

273 
__exã∫_Æways_ölöe
 
__wur
 
size_t


274 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
, size_à
__n
,

275 
FILE
 *
__ª°ri˘
 
__°ªam
)

277 i‡(
	`__bos0
 (
__±r
Ë!(
size_t
) -1)

279 i‡(!
	`__buûtö_c⁄°™t_p
 (
__size
)

280 || !
	`__buûtö_c⁄°™t_p
 (
__n
)

281 || (
__size
 | 
__n
Ë>(((
size_t
) 1) << (8 *  (size_t) / 2)))

282  
	`__‰ód_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__°ªam
);

284 i‡(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

285  
	`__‰ód_chk_w¨n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__°ªam
);

287  
	`__‰ód_Æüs
 (
__±r
, 
__size
, 
__n
, 
__°ªam
);

288 
	}
}

290 #ifde‡
__USE_GNU


291 *
	$__fgës_u∆ocked_chk
 (*
__ª°ri˘
 
__s
, 
size_t
 
__size
,

292 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

293 *
	`__REDIRECT
 (
__fgës_u∆ocked_Æüs
,

294 (*
__ª°ri˘
 
__s
, 
__n
,

295 
FILE
 *
__ª°ri˘
 
__°ªam
), 
fgës_u∆ocked
Ë
__wur
;

296 *
	`__REDIRECT
 (
__fgës_u∆ocked_chk_w¨n
,

297 (*
__ª°ri˘
 
__s
, 
size_t
 
__size
, 
__n
,

298 
FILE
 *
__ª°ri˘
 
__°ªam
), 
__fgës_u∆ocked_chk
)

299 
__wur
 
	`__w¨«âr
 ("fgets_unlocked called with bigger sizeÅhanÜength "

302 
__exã∫_Æways_ölöe
 
__wur
 *

303 
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

305 i‡(
	`__bos
 (
__s
Ë!(
size_t
) -1)

307 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
) || __n <= 0)

308  
	`__fgës_u∆ocked_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__°ªam
);

310 i‡((
size_t
Ë
__n
 > 
	`__bos
 (
__s
))

311  
	`__fgës_u∆ocked_chk_w¨n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__°ªam
);

313  
	`__fgës_u∆ocked_Æüs
 (
__s
, 
__n
, 
__°ªam
);

314 
	}
}

317 #ifde‡
__USE_MISC


318 #unde‡
‰ód_u∆ocked


319 
size_t
 
	$__‰ód_u∆ocked_chk
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__±æí
,

320 
size_t
 
__size
, size_à
__n
,

321 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

322 
size_t
 
	`__REDIRECT
 (
__‰ód_u∆ocked_Æüs
,

323 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

324 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
),

325 
‰ód_u∆ocked
Ë
__wur
;

326 
size_t
 
	`__REDIRECT
 (
__‰ód_u∆ocked_chk_w¨n
,

327 (*
__ª°ri˘
 
__±r
, 
size_t
 
__±æí
,

328 
size_t
 
__size
, size_à
__n
,

329 
FILE
 *
__ª°ri˘
 
__°ªam
),

330 
__‰ód_u∆ocked_chk
)

331 
__wur
 
	`__w¨«âr
 ("fread_unlocked called with bigger size *ÇmembÅhan "

334 
__exã∫_Æways_ölöe
 
__wur
 
size_t


335 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
, size_à
__n
,

336 
FILE
 *
__ª°ri˘
 
__°ªam
)

338 i‡(
	`__bos0
 (
__±r
Ë!(
size_t
) -1)

340 i‡(!
	`__buûtö_c⁄°™t_p
 (
__size
)

341 || !
	`__buûtö_c⁄°™t_p
 (
__n
)

342 || (
__size
 | 
__n
Ë>(((
size_t
) 1) << (8 *  (size_t) / 2)))

343  
	`__‰ód_u∆ocked_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

344 
__°ªam
);

346 i‡(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

347  
	`__‰ód_u∆ocked_chk_w¨n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

348 
__°ªam
);

351 #ifde‡
__USE_EXTERN_INLINES


352 i‡(
	`__buûtö_c⁄°™t_p
 (
__size
)

353 && 
	`__buûtö_c⁄°™t_p
 (
__n
)

354 && (
__size
 | 
__n
Ë< (((
size_t
) 1) << (8 *  (size_t) / 2))

355 && 
__size
 * 
__n
 <= 8)

357 
size_t
 
__˙t
 = 
__size
 * 
__n
;

358 *
__˝å
 = (*Ë
__±r
;

359 i‡(
__˙t
 == 0)

362 ; 
__˙t
 > 0; --__cnt)

364 
__c
 = 
	`_IO_gëc_u∆ocked
 (
__°ªam
);

365 i‡(
__c
 =
EOF
)

367 *
__˝å
++ = 
__c
;

369  (
__˝å
 - (*Ë
__±r
Ë/ 
__size
;

372  
	`__‰ód_u∆ocked_Æüs
 (
__±r
, 
__size
, 
__n
, 
__°ªam
);

373 
	}
}

	@/usr/include/bits/stdio_lim.h

19 #i‡!
deföed
 
_STDIO_H
 && !deföed 
__√ed_FOPEN_MAX
 && !deföed 
__√ed_IOV_MAX


23 #ifde‡
_STDIO_H


24 
	#L_tm≤am
 20

	)

25 
	#TMP_MAX
 238328

	)

26 
	#FILENAME_MAX
 4096

	)

28 #ifde‡
__USE_POSIX


29 
	#L_˘îmid
 9

	)

30 
	#L_cu£rid
 9

	)

34 #i‡
deföed
 
__√ed_FOPEN_MAX
 || deföed 
_STDIO_H


35 #unde‡
FOPEN_MAX


36 
	#FOPEN_MAX
 16

	)

39 #i‡
deföed
 
__√ed_IOV_MAX
 && !deföed 
IOV_MAX


40 
	#IOV_MAX
 1024

	)

	@/usr/include/bits/stdlib-ldbl.h

20 #i‚de‡
_STDLIB_H


24 #ifdef 
__USE_ISOC99


25 
__BEGIN_NAMESPACE_C99


26 
	$__LDBL_REDIR1_DECL
 (
°πﬁd
, 
°πod
)

27 
__END_NAMESPACE_C99


30 #ifde‡
__USE_GNU


31 
	$__LDBL_REDIR1_DECL
 (
°πﬁd_l
, 
°πod_l
)

34 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


35 #ifde‡
__USE_MISC


36 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

37 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

38 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

39 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

40 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

20 #i‚de‡
_STDLIB_H


24 *
	$__ªÆ∑th_chk
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

25 *
__ª°ri˘
 
__ªsﬁved
,

26 
size_t
 
__ªsﬁvedÀn
Ë
__THROW
 
__wur
;

27 *
	`__REDIRECT_NTH
 (
__ªÆ∑th_Æüs
,

28 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

29 *
__ª°ri˘
 
__ªsﬁved
), 
ªÆ∑th
Ë
__wur
;

30 *
	`__REDIRECT_NTH
 (
__ªÆ∑th_chk_w¨n
,

31 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

32 *
__ª°ri˘
 
__ªsﬁved
,

33 
size_t
 
__ªsﬁvedÀn
), 
__ªÆ∑th_chk
Ë
__wur


34 
	`__w¨«âr
 ("secondárgument ofÑealpath must beÉither NULL orát "

37 
__exã∫_Æways_ölöe
 
__wur
 *

38 
	`__NTH
 (
	$ªÆ∑th
 (
__c⁄°
 *
__ª°ri˘
 
__«me
, *__ª°ri˘ 
__ªsﬁved
))

40 i‡(
	`__bos
 (
__ªsﬁved
Ë!(
size_t
) -1)

42 #i‡
deföed
 
_LIBC_LIMITS_H_
 && deföed 
PATH_MAX


43 i‡(
	`__bos
 (
__ªsﬁved
Ë< 
PATH_MAX
)

44  
	`__ªÆ∑th_chk_w¨n
 (
__«me
, 
__ªsﬁved
, 
	`__bos
 (__resolved));

46  
	`__ªÆ∑th_chk
 (
__«me
, 
__ªsﬁved
, 
	`__bos
 (__resolved));

49  
	`__ªÆ∑th_Æüs
 (
__«me
, 
__ªsﬁved
);

50 
	}
}

53 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
,

54 
size_t
 
__ƒól
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

55 
	`__REDIRECT_NTH
 (
__±¢ame_r_Æüs
, (
__fd
, *
__buf
,

56 
size_t
 
__buÊí
), 
±¢ame_r
)

57 
	`__n⁄nuŒ
 ((2));

58 
	`__REDIRECT_NTH
 (
__±¢ame_r_chk_w¨n
,

59 (
__fd
, *
__buf
, 
size_t
 
__buÊí
,

60 
size_t
 
__ƒól
), 
__±¢ame_r_chk
)

61 
	`__n⁄nuŒ
 ((2)Ë
	`__w¨«âr
 ("ptsname_r called with buflen biggerÅhan "

64 
__exã∫_Æways_ölöe
 

65 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
))

67 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

69 i‡(!
	`__buûtö_c⁄°™t_p
 (
__buÊí
))

70  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

71 i‡(
__buÊí
 > 
	`__bos
 (
__buf
))

72  
	`__±¢ame_r_chk_w¨n
 (
__fd
, 
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

74  
	`__±¢ame_r_Æüs
 (
__fd
, 
__buf
, 
__buÊí
);

75 
	}
}

78 
	$__w˘omb_chk
 (*
__s
, 
wch¨_t
 
__wch¨
, 
size_t
 
__buÊí
)

79 
__THROW
 
__wur
;

80 
	`__REDIRECT_NTH
 (
__w˘omb_Æüs
, (*
__s
, 
wch¨_t
 
__wch¨
),

81 
w˘omb
Ë
__wur
;

83 
__exã∫_Æways_ölöe
 
__wur
 

84 
	`__NTH
 (
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
))

89 
	#__STDLIB_MB_LEN_MAX
 16

	)

90 #i‡
deföed
 
MB_LEN_MAX
 && MB_LEN_MAX !
__STDLIB_MB_LEN_MAX


93 i‡(
	`__bos
 (
__s
Ë!(
size_t
Ë-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

94  
	`__w˘omb_chk
 (
__s
, 
__wch¨
, 
	`__bos
 (__s));

95  
	`__w˘omb_Æüs
 (
__s
, 
__wch¨
);

96 
	}
}

99 
size_t
 
	$__mb°owcs_chk
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

100 
__c⁄°
 *
__ª°ri˘
 
__§c
,

101 
size_t
 
__Àn
, size_à
__d°Àn
Ë
__THROW
;

102 
size_t
 
	`__REDIRECT_NTH
 (
__mb°owcs_Æüs
,

103 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

104 
__c⁄°
 *
__ª°ri˘
 
__§c
,

105 
size_t
 
__Àn
), 
mb°owcs
);

106 
size_t
 
	`__REDIRECT_NTH
 (
__mb°owcs_chk_w¨n
,

107 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

108 
__c⁄°
 *
__ª°ri˘
 
__§c
,

109 
size_t
 
__Àn
, size_à
__d°Àn
), 
__mb°owcs_chk
)

110 
	`__w¨«âr
 ("mbstowcs called with dst buffer smallerÅhanÜen "

113 
__exã∫_Æways_ölöe
 
size_t


114 
	`__NTH
 (
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

115 
size_t
 
__Àn
))

117 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1)

119 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

120  
	`__mb°owcs_chk
 (
__d°
, 
__§c
, 
__Àn
,

121 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

123 i‡(
__Àn
 > 
	`__bos
 (
__d°
Ë/  (
wch¨_t
))

124  
	`__mb°owcs_chk_w¨n
 (
__d°
, 
__§c
, 
__Àn
,

125 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

127  
	`__mb°owcs_Æüs
 (
__d°
, 
__§c
, 
__Àn
);

128 
	}
}

131 
size_t
 
	$__wc°ombs_chk
 (*
__ª°ri˘
 
__d°
,

132 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

133 
size_t
 
__Àn
, size_à
__d°Àn
Ë
__THROW
;

134 
size_t
 
	`__REDIRECT_NTH
 (
__wc°ombs_Æüs
,

135 (*
__ª°ri˘
 
__d°
,

136 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

137 
size_t
 
__Àn
), 
wc°ombs
);

138 
size_t
 
	`__REDIRECT_NTH
 (
__wc°ombs_chk_w¨n
,

139 (*
__ª°ri˘
 
__d°
,

140 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

141 
size_t
 
__Àn
, size_à
__d°Àn
), 
__wc°ombs_chk
)

142 
	`__w¨«âr
 ("wcstombs called with dst buffer smallerÅhanÜen");

144 
__exã∫_Æways_ölöe
 
size_t


145 
	`__NTH
 (
	$wc°ombs
 (*
__ª°ri˘
 
__d°
, 
__c⁄°
 
wch¨_t
 *__ª°ri˘ 
__§c
,

146 
size_t
 
__Àn
))

148 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1)

150 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

151  
	`__wc°ombs_chk
 (
__d°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dst));

152 i‡(
__Àn
 > 
	`__bos
 (
__d°
))

153  
	`__wc°ombs_chk_w¨n
 (
__d°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dst));

155  
	`__wc°ombs_Æüs
 (
__d°
, 
__§c
, 
__Àn
);

156 
	}
}

	@/usr/include/bits/string.h

21 #i‚de‡
_STRING_H


26 
	#_STRING_ARCH_u«lig√d
 1

	)

31 #i‡!
deföed
 
__NO_STRING_INLINES
 && deföed 
__USE_STRING_INLINES
 \

32 && 
deföed
 
	g__GNUC__
 && __GNUC__ >2 && !
__BOUNDED_POINTERS__


34 #i‚de‡
__STRING_INLINE


35 #i‚de‡
__exã∫_ölöe


36 
	#__STRING_INLINE
 
ölöe


	)

38 
	#__STRING_INLINE
 
__exã∫_ölöe


	)

43 
	#__STRING_SMALL_GET16
(
§c
, 
idx
) \

44 ((((
__c⁄°
 *Ë(
§c
))[
idx
 + 1] << 8) \

45 | ((
__c⁄°
 *Ë(
§c
))[
idx
])

	)

46 
	#__STRING_SMALL_GET32
(
§c
, 
idx
) \

47 (((((
__c⁄°
 *Ë(
§c
))[
idx
 + 3] << 8 \

48 | ((
__c⁄°
 *Ë(
§c
))[
idx
 + 2]) << 8 \

49 | ((
__c⁄°
 *Ë(
§c
))[
idx
 + 1]) << 8 \

50 | ((
__c⁄°
 *Ë(
§c
))[
idx
])

	)

54 
	#_HAVE_STRING_ARCH_mem˝y
 1

	)

55 
	#mem˝y
(
de°
, 
§c
, 
n
) \

56 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
n
) \

57 ? 
	`__mem˝y_c
 ((
de°
), (
§c
), (
n
)) \

58 : 
	`__mem˝y_g
 ((
de°
), (
§c
), (
n
))))

	)

59 
	#__mem˝y_c
(
de°
, 
§c
, 
n
) \

60 ((
n
) == 0 \

61 ? (
de°
) \

62 : (((
n
) % 4 == 0) \

63 ? 
	`__mem˝y_by4
 (
de°
, 
§c
, 
n
) \

64 : (((
n
) % 2 == 0) \

65 ? 
	`__mem˝y_by2
 (
de°
, 
§c
, 
n
) \

66 : 
	`__mem˝y_g
 (
de°
, 
§c
, 
n
))))

	)

68 
__STRING_INLINE
 *
__mem˝y_by4
 (*
__de°
, 
__c⁄°
 *
__§c
,

69 
size_t
 
__n
);

71 
__STRING_INLINE
 *

72 
	$__mem˝y_by4
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
)

74 
__d0
, 
__d1
;

75 *
__tmp
 = 
__de°
;

76 
__asm__
 
__vﬁ©ûe__


84 : "=&r" (
__d0
), "=&r" (
__tmp
), "=&r" (
__§c
), "=&r" (
__d1
)

85 : "1" (
__tmp
), "2" (
__§c
), "3" (
__n
 / 4)

87  
__de°
;

88 
	}
}

90 
__STRING_INLINE
 *
__mem˝y_by2
 (*
__de°
, 
__c⁄°
 *
__§c
,

91 
size_t
 
__n
);

93 
__STRING_INLINE
 *

94 
	$__mem˝y_by2
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
)

96 
__d0
, 
__d1
;

97 *
__tmp
 = 
__de°
;

98 
__asm__
 
__vﬁ©ûe__


111 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__§c
), "=&r" (
__d1
)

112 : "1" (
__tmp
), "2" (
__§c
), "3" (
__n
 / 2)

114  
__de°
;

115 
	}
}

117 
__STRING_INLINE
 *
__mem˝y_g
 (*
__de°
, 
__c⁄°
 *
__§c
,

118 
size_t
 
__n
);

120 
__STRING_INLINE
 *

121 
	$__mem˝y_g
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
)

123 
__d0
, 
__d1
, 
__d2
;

124 *
__tmp
 = 
__de°
;

125 
__asm__
 
__vﬁ©ûe__


136 : "=&c" (
__d0
), "=&D" (
__d1
), "=&S" (
__d2
),

137 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__de°
)

138 : "0" (
__n
), "1" (
__tmp
), "2" (
__§c
),

139 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__§c
)

141  
__de°
;

142 
	}
}

144 
	#_HAVE_STRING_ARCH_memmove
 1

	)

145 #i‚de‡
_FORCE_INLINES


148 
	#memmove
(
de°
, 
§c
, 
n
Ë
	`__memmove_g
 (de°, src,Ç)

	)

150 
__STRING_INLINE
 *
	$__memmove_g
 (*, 
__c⁄°
 *, 
size_t
)

151 
	`__asm__
 ("memmove");

153 
__STRING_INLINE
 *

154 
	$__memmove_g
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
)

156 
__d0
, 
__d1
, 
__d2
;

157 *
__tmp
 = 
__de°
;

158 i‡(
__de°
 < 
__§c
)

159 
__asm__
 
__vﬁ©ûe__


162 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

163 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__de°
)

164 : "0" (
__n
), "1" (
__§c
), "2" (
__tmp
),

165 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__§c
));

167 
__asm__
 
__vﬁ©ûe__


171 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

172 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__de°
)

173 : "0" (
__n
), "1" (__¿- 1 + (
__c⁄°
 *Ë
__§c
),

174 "2" (
__n
 - 1 + (*Ë
__tmp
),

175 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__§c
));

176  
__de°
;

177 
	}
}

181 
	#_HAVE_STRING_ARCH_memcmp
 1

	)

182 #i‚de‡
_FORCE_INLINES


183 #i‚de‡
__PIC__


185 
__STRING_INLINE
 

186 
	$memcmp
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

188 
__d0
, 
__d1
, 
__d2
;

189 
__ªs
;

190 
__asm__
 
__vﬁ©ûe__


198 : "=&a" (
__ªs
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

199 : "0" (0), "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

200 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s1
),

201 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s2
)

203  
__ªs
;

204 
	}
}

209 
	#_HAVE_STRING_ARCH_mem£t
 1

	)

210 
	#_USE_STRING_ARCH_mem£t
 1

	)

211 
	#mem£t
(
s
, 
c
, 
n
) \

212 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
n
) && (n) <= 16 \

213 ? ((
n
) == 1 \

214 ? 
	`__mem£t_c1
 ((
s
), (
c
)) \

215 : 
	`__mem£t_gc
 ((
s
), (
c
), (
n
))) \

216 : (
	`__buûtö_c⁄°™t_p
 (
c
) \

217 ? (
	`__buûtö_c⁄°™t_p
 (
n
) \

218 ? 
	`__mem£t_c˙
 ((
s
), (
c
), (
n
)) \

219 : 
	`mem£t
 ((
s
), (
c
), (
n
))) \

220 : (
	`__buûtö_c⁄°™t_p
 (
n
) \

221 ? 
	`__mem£t_g˙
 ((
s
), (
c
), (
n
)) \

222 : 
	`mem£t
 ((
s
), (
c
), (
n
))))))

	)

224 
	#__mem£t_c1
(
s
, 
c
Ë({ *
__s
 = (s); \

225 *((*Ë
__s
Ë(Ë(
c
); \

226 
__s
; })

	)

228 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

229 ({ *
__s
 = (
s
); \

231 
__ui
; \

232 
__usi
; \

233 
__uc
; \

234 } *
__u
 = 
__s
; \

235 
__c
 = ((Ë((Ë(
c
))) * 0x01010101; \

241 i‡((
n
) == 3 || (n) >= 5) \

242 
__asm__
 
	`__vﬁ©ûe__
 ("" : "Ù" (
__c
) : "0" (__c)); \

245 
n
) \

248 
__u
->
__ui
 = 
__c
; \

249 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

251 
__u
->
__ui
 = 
__c
; \

252 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

254 
__u
->
__ui
 = 
__c
; \

255 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

257 
__u
->
__usi
 = (Ë
__c
; \

258 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

259 
__u
->
__uc
 = (Ë
__c
; \

263 
__u
->
__ui
 = 
__c
; \

264 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

266 
__u
->
__ui
 = 
__c
; \

267 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

269 
__u
->
__ui
 = 
__c
; \

270 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

272 
__u
->
__usi
 = (Ë
__c
; \

276 
__u
->
__ui
 = 
__c
; \

277 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

279 
__u
->
__ui
 = 
__c
; \

280 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

282 
__u
->
__ui
 = 
__c
; \

283 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

285 
__u
->
__uc
 = (Ë
__c
; \

289 
__u
->
__ui
 = 
__c
; \

290 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

292 
__u
->
__ui
 = 
__c
; \

293 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

295 
__u
->
__ui
 = 
__c
; \

296 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

298 
__u
->
__ui
 = 
__c
; \

303 
__s
; })

	)

305 
	#__mem£t_c˙
(
s
, 
c
, 
n
) \

306 (((
n
) % 4 == 0) \

307 ? 
	`__mem£t_c˙_by4
 (
s
, ((Ë((Ë(
c
))) * 0x01010101,\

308 
n
) \

309 : (((
n
) % 2 == 0) \

310 ? 
	`__mem£t_c˙_by2
 (
s
, \

311 ((Ë((Ë(
c
))) * 0x01010101,\

312 
n
) \

313 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

315 
__STRING_INLINE
 *
__mem£t_c˙_by4
 (*
__s
, 
__c
,

316 
size_t
 
__n
);

318 
__STRING_INLINE
 *

319 
	$__mem£t_c˙_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

321 *
__tmp
 = 
__s
;

322 
__d0
;

323 #ifde‡
__i686__


324 
__asm__
 
__vﬁ©ûe__


327 : "=&a" (
__c
), "=&D" (
__tmp
), "=&c" (
__d0
),

328 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

329 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

332 
__asm__
 
__vﬁ©ûe__


338 : "=&r" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

339 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

340 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

343  
__s
;

344 
	}
}

346 
__STRING_INLINE
 *
__mem£t_c˙_by2
 (*
__s
, 
__c
,

347 
size_t
 
__n
);

349 
__STRING_INLINE
 *

350 
	$__mem£t_c˙_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

352 
__d0
, 
__d1
;

353 *
__tmp
 = 
__s
;

354 #ifde‡
__i686__


355 
__asm__
 
__vﬁ©ûe__


359 : "=&a" (
__d0
), "=&D" (
__tmp
), "=&c" (
__d1
),

360 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

361 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

364 
__asm__
 
__vﬁ©ûe__


370 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

371 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

372 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

375  
__s
;

376 
	}
}

378 
	#__mem£t_g˙
(
s
, 
c
, 
n
) \

379 (((
n
) % 4 == 0) \

380 ? 
	`__mem£t_g˙_by4
 (
s
, 
c
, 
n
) \

381 : (((
n
) % 2 == 0) \

382 ? 
	`__mem£t_g˙_by2
 (
s
, 
c
, 
n
) \

383 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

385 
__STRING_INLINE
 *
__mem£t_g˙_by4
 (*
__s
, 
__c
, 
size_t
 
__n
);

387 
__STRING_INLINE
 *

388 
	$__mem£t_g˙_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

390 *
__tmp
 = 
__s
;

391 
__d0
;

392 
__asm__
 
__vﬁ©ûe__


402 : "=&q" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

403 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

404 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

406  
__s
;

407 
	}
}

409 
__STRING_INLINE
 *
__mem£t_g˙_by2
 (*
__s
, 
__c
, 
size_t
 
__n
);

411 
__STRING_INLINE
 *

412 
	$__mem£t_g˙_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

414 
__d0
, 
__d1
;

415 *
__tmp
 = 
__s
;

416 
__asm__
 
__vﬁ©ûe__


427 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

428 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

429 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

431  
__s
;

432 
	}
}

436 
	#_HAVE_STRING_ARCH_memchr
 1

	)

437 #i‚de‡
_FORCE_INLINES


438 
__STRING_INLINE
 *

439 
	$memchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
)

441 
__d0
;

442 #ifde‡
__i686__


443 
__d1
;

445 *
__ªs
;

446 i‡(
__n
 == 0)

447  
NULL
;

448 #ifde‡
__i686__


449 
__asm__
 
__vﬁ©ûe__


453 : "=D" (
__ªs
), "=&c" (
__d0
), "=&r" (
__d1
)

454 : "a" (
__c
), "0" (
__s
), "1" (
__n
), "2" (1),

455 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

458 
__asm__
 
__vﬁ©ûe__


464 : "=D" (
__ªs
), "=&c" (
__d0
)

465 : "a" (
__c
), "0" (
__s
), "1" (
__n
),

466 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

469  
__ªs
 - 1;

470 
	}
}

473 
	#_HAVE_STRING_ARCH_memrchr
 1

	)

474 #i‚de‡
_FORCE_INLINES


475 
__STRING_INLINE
 *
__memrchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
);

477 
__STRING_INLINE
 *

478 
	$__memrchr
 (
__c⁄°
 *
__s
, 
__c
, 
size_t
 
__n
)

480 
__d0
;

481 #ifde‡
__i686__


482 
__d1
;

484 *
__ªs
;

485 i‡(
__n
 == 0)

486  
NULL
;

487 #ifde‡
__i686__


488 
__asm__
 
__vﬁ©ûe__


494 : "=D" (
__ªs
), "=&c" (
__d0
), "=&r" (
__d1
)

495 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n), "2" (-1),

496 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

499 
__asm__
 
__vﬁ©ûe__


506 : "=D" (
__ªs
), "=&c" (
__d0
)

507 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n),

508 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

511  
__ªs
;

512 
	}
}

513 #ifde‡
__USE_GNU


514 
	#memrchr
(
s
, 
c
, 
n
Ë
	`__memrchr
 ((s), (c), (n))

	)

519 
	#_HAVE_STRING_ARCH_øwmemchr
 1

	)

520 
__STRING_INLINE
 *
__øwmemchr
 (c⁄° *
__s
, 
__c
);

522 #i‚de‡
_FORCE_INLINES


523 
__STRING_INLINE
 *

524 
	$__øwmemchr
 (c⁄° *
__s
, 
__c
)

526 
__d0
;

527 *
__ªs
;

528 
__asm__
 
__vﬁ©ûe__


531 : "=D" (
__ªs
), "=&c" (
__d0
)

532 : "a" (
__c
), "0" (
__s
), "1" (0xffffffff),

533 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

535  
__ªs
 - 1;

536 
	}
}

537 #ifde‡
__USE_GNU


538 
__STRING_INLINE
 *

539 
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

541  
	`__øwmemchr
 (
__s
, 
__c
);

542 
	}
}

548 
	#_HAVE_STRING_ARCH_°æí
 1

	)

549 
	#°æí
(
°r
) \

550 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
°r
) \

551 ? 
	`__buûtö_°æí
 (
°r
) \

552 : 
	`__°æí_g
 (
°r
)))

	)

553 
__STRING_INLINE
 
size_t
 
__°æí_g
 (
__c⁄°
 *
__°r
);

555 
__STRING_INLINE
 
size_t


556 
	$__°æí_g
 (
__c⁄°
 *
__°r
)

558 
__dummy
;

559 
__c⁄°
 *
__tmp
 = 
__°r
;

560 
__asm__
 
__vﬁ©ûe__


566 : "Ù" (
__tmp
), "=&q" (
__dummy
)

567 : "0" (
__°r
),

568 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__°r
)

570  
__tmp
 - 
__°r
 - 1;

571 
	}
}

575 
	#_HAVE_STRING_ARCH_°r˝y
 1

	)

576 
	#°r˝y
(
de°
, 
§c
) \

577 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

578 ? ( ((
§c
)[0]Ë=1 && 
	`°æí
 (src) + 1 <= 8 \

579 ? 
	`__°r˝y_a_smÆl
 ((
de°
), (
§c
), 
	`°æí
 (src) + 1) \

580 : (*Ë
	`mem˝y
 ((*Ë(
de°
), \

581 (
__c⁄°
 *Ë(
§c
), \

582 
	`°æí
 (
§c
) + 1)) \

583 : 
	`__°r˝y_g
 ((
de°
), (
§c
))))

	)

585 
	#__°r˝y_a_smÆl
(
de°
, 
§c
, 
§˛í
) \

586 (
	`__exãnsi⁄__
 ({ *
__de°
 = (
de°
); \

588 
__ui
; \

589 
__usi
; \

590 
__uc
; \

591 
__c
; \

592 } *
__u
 = (*Ë
__de°
; \

593 
§˛í
) \

596 
__u
->
__uc
 = '\0'; \

599 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 0); \

602 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 0); \

603 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

604 
__u
->
__uc
 = '\0'; \

607 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

610 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

611 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

612 
__u
->
__uc
 = '\0'; \

615 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

616 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

617 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 4); \

620 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

621 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

622 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 4); \

623 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

624 
__u
->
__uc
 = '\0'; \

627 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

628 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

629 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 4); \

632 (*Ë
__de°
; }))

	)

634 
__STRING_INLINE
 *
__°r˝y_g
 (*
__de°
, 
__c⁄°
 *
__§c
);

636 
__STRING_INLINE
 *

637 
	$__°r˝y_g
 (*
__de°
, 
__c⁄°
 *
__§c
)

639 *
__tmp
 = 
__de°
;

640 
__dummy
;

641 
__asm__
 
__vﬁ©ûe__


650 : "=&r" (
__§c
), "=&r" (
__tmp
), "=&q" (
__dummy
),

651 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

652 : "0" (
__§c
), "1" (
__tmp
),

653 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__§c
)

655  
__de°
;

656 
	}
}

659 #ifde‡
__USE_GNU


660 
	#_HAVE_STRING_ARCH_°p˝y
 1

	)

662 
	#__°p˝y
(
de°
, 
§c
) \

663 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

664 ? (
	`°æí
 (
§c
) + 1 <= 8 \

665 ? 
	`__°p˝y_a_smÆl
 ((
de°
), (
§c
), 
	`°æí
 (src) + 1) \

666 : 
	`__°p˝y_c
 ((
de°
), (
§c
), 
	`°æí
 (src) + 1)) \

667 : 
	`__°p˝y_g
 ((
de°
), (
§c
))))

	)

668 
	#__°p˝y_c
(
de°
, 
§c
, 
§˛í
) \

669 ((
§˛í
) % 4 == 0 \

670 ? 
	`__memp˝y_by4
 (
de°
, 
§c
, 
§˛í
) - 1 \

671 : ((
§˛í
) % 2 == 0 \

672 ? 
	`__memp˝y_by2
 (
de°
, 
§c
, 
§˛í
) - 1 \

673 : 
	`__memp˝y_byn
 (
de°
, 
§c
, 
§˛í
Ë- 1))

	)

676 
	#°p˝y
(
de°
, 
§c
Ë
	`__°p˝y
 ((de°), (§c))

	)

678 
	#__°p˝y_a_smÆl
(
de°
, 
§c
, 
§˛í
) \

679 (
	`__exãnsi⁄__
 ({ union { \

680 
__ui
; \

681 
__usi
; \

682 
__uc
; \

683 
__c
; \

684 } *
__u
 = (*Ë(
de°
); \

685 
§˛í
) \

688 
__u
->
__uc
 = '\0'; \

691 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 0); \

692 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1); \

695 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 0); \

696 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

697 
__u
->
__uc
 = '\0'; \

700 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

701 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 3); \

704 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

705 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

706 
__u
->
__uc
 = '\0'; \

709 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

710 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

711 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 4); \

712 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1); \

715 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

716 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

717 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 4); \

718 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

719 
__u
->
__uc
 = '\0'; \

722 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

723 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

724 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 4); \

725 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 3); \

728 (*Ë
__u
; }))

	)

730 
__STRING_INLINE
 *
__memp˝y_by4
 (*
__de°
, 
__c⁄°
 *
__§c
,

731 
size_t
 
__§˛í
);

733 
__STRING_INLINE
 *

734 
	$__memp˝y_by4
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__§˛í
)

736 *
__tmp
 = 
__de°
;

737 
__d0
, 
__d1
;

738 
__asm__
 
__vﬁ©ûe__


746 : "=&r" (
__d0
), "Ù" (
__tmp
), "=&r" (
__§c
), "=&r" (
__d1
)

747 : "1" (
__tmp
), "2" (
__§c
), "3" (
__§˛í
 / 4)

749  
__tmp
;

750 
	}
}

752 
__STRING_INLINE
 *
__memp˝y_by2
 (*
__de°
, 
__c⁄°
 *
__§c
,

753 
size_t
 
__§˛í
);

755 
__STRING_INLINE
 *

756 
	$__memp˝y_by2
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__§˛í
)

758 *
__tmp
 = 
__de°
;

759 
__d0
, 
__d1
;

760 
__asm__
 
__vﬁ©ûe__


773 : "=&q" (
__d0
), "Ù" (
__tmp
), "=&r" (
__§c
), "=&r" (
__d1
),

774 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

775 : "1" (
__tmp
), "2" (
__§c
), "3" (
__§˛í
 / 2),

776 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

778  
__tmp
 + 2;

779 
	}
}

781 
__STRING_INLINE
 *
__memp˝y_byn
 (*
__de°
, 
__c⁄°
 *
__§c
,

782 
size_t
 
__§˛í
);

784 
__STRING_INLINE
 *

785 
	$__memp˝y_byn
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__§˛í
)

787 
__d0
, 
__d1
;

788 *
__tmp
 = 
__de°
;

789 
__asm__
 
__vﬁ©ûe__


800 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

801 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

802 : "0" (
__tmp
), "1" (
__§˛í
), "2" (
__§c
),

803 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

805  
__tmp
;

806 
	}
}

808 
__STRING_INLINE
 *
__°p˝y_g
 (*
__de°
, 
__c⁄°
 *
__§c
);

810 
__STRING_INLINE
 *

811 
	$__°p˝y_g
 (*
__de°
, 
__c⁄°
 *
__§c
)

813 *
__tmp
 = 
__de°
;

814 
__dummy
;

815 
__asm__
 
__vﬁ©ûe__


824 : "=&r" (
__§c
), "Ù" (
__tmp
), "=&q" (
__dummy
),

825 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

826 : "0" (
__§c
), "1" (
__tmp
),

827 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__§c
)

829  
__tmp
 - 1;

830 
	}
}

835 
	#_HAVE_STRING_ARCH_°∫˝y
 1

	)

836 
	#°∫˝y
(
de°
, 
§c
, 
n
) \

837 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

838 ? ((
	`°æí
 (
§c
Ë+ 1 >((
size_t
Ë(
n
)) \

839 ? (*Ë
	`mem˝y
 ((*Ë(
de°
), \

840 (
__c⁄°
 *Ë(
§c
), 
n
) \

841 : 
	`__°∫˝y_cg
 ((
de°
), (
§c
), 
	`°æí
 (§cË+ 1, 
n
))) \

842 : 
	`__°∫˝y_gg
 ((
de°
), (
§c
), 
n
)))

	)

843 
	#__°∫˝y_cg
(
de°
, 
§c
, 
§˛í
, 
n
) \

844 (((
§˛í
) % 4 == 0) \

845 ? 
	`__°∫˝y_by4
 (
de°
, 
§c
, 
§˛í
, 
n
) \

846 : (((
§˛í
) % 2 == 0) \

847 ? 
	`__°∫˝y_by2
 (
de°
, 
§c
, 
§˛í
, 
n
) \

848 : 
	`__°∫˝y_byn
 (
de°
, 
§c
, 
§˛í
, 
n
)))

	)

850 
__STRING_INLINE
 *
__°∫˝y_by4
 (*
__de°
, 
__c⁄°
 
__§c
[],

851 
size_t
 
__§˛í
, size_à
__n
);

853 
__STRING_INLINE
 *

854 
	$__°∫˝y_by4
 (*
__de°
, 
__c⁄°
 
__§c
[], 
size_t
 
__§˛í
, size_à
__n
)

856 *
__tmp
 = 
__de°
;

857 
__dummy1
, 
__dummy2
;

858 
__asm__
 
__vﬁ©ûe__


866 : "=&r" (
__dummy1
), "Ù" (
__tmp
), "=&r" (
__§c
), "=&r" (
__dummy2
),

867 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

868 : "1" (
__tmp
), "2" (
__§c
), "3" (
__§˛í
 / 4),

869 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

871 (Ë
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__§˛í
);

872  
__de°
;

873 
	}
}

875 
__STRING_INLINE
 *
__°∫˝y_by2
 (*
__de°
, 
__c⁄°
 
__§c
[],

876 
size_t
 
__§˛í
, size_à
__n
);

878 
__STRING_INLINE
 *

879 
	$__°∫˝y_by2
 (*
__de°
, 
__c⁄°
 
__§c
[], 
size_t
 
__§˛í
, size_à
__n
)

881 *
__tmp
 = 
__de°
;

882 
__dummy1
, 
__dummy2
;

883 
__asm__
 
__vﬁ©ûe__


896 : "=&q" (
__dummy1
), "Ù" (
__tmp
), "=&r" (
__§c
), "=&r" (
__dummy2
),

897 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

898 : "1" (
__tmp
), "2" (
__§c
), "3" (
__§˛í
 / 2),

899 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

901 (Ë
	`mem£t
 (
__tmp
 + 2, '\0', 
__n
 - 
__§˛í
);

902  
__de°
;

903 
	}
}

905 
__STRING_INLINE
 *
__°∫˝y_byn
 (*
__de°
, 
__c⁄°
 
__§c
[],

906 
size_t
 
__§˛í
, size_à
__n
);

908 
__STRING_INLINE
 *

909 
	$__°∫˝y_byn
 (*
__de°
, 
__c⁄°
 
__§c
[], 
size_t
 
__§˛í
, size_à
__n
)

911 
__d0
, 
__d1
;

912 *
__tmp
 = 
__de°
;

913 
__asm__
 
__vﬁ©ûe__


924 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

925 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

926 : "1" (
__§˛í
), "0" (
__tmp
),"2" (
__§c
),

927 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

929 (Ë
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__§˛í
);

930  
__de°
;

931 
	}
}

933 
__STRING_INLINE
 *
__°∫˝y_gg
 (*
__de°
, 
__c⁄°
 *
__§c
,

934 
size_t
 
__n
);

936 
__STRING_INLINE
 *

937 
	$__°∫˝y_gg
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
)

939 *
__tmp
 = 
__de°
;

940 
__dummy
;

941 i‡(
__n
 > 0)

942 
__asm__
 
__vﬁ©ûe__


958 : "=&r" (
__§c
), "=&r" (
__tmp
), "=&q" (
__dummy
), "=&r" (
__n
)

959 : "0" (
__§c
), "1" (
__tmp
), "3" (
__n
)

962  
__de°
;

963 
	}
}

967 
	#_HAVE_STRING_ARCH_°rˇt
 1

	)

968 
	#°rˇt
(
de°
, 
§c
) \

969 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

970 ? 
	`__°rˇt_c
 ((
de°
), (
§c
), 
	`°æí
 (src) + 1) \

971 : 
	`__°rˇt_g
 ((
de°
), (
§c
))))

	)

973 
__STRING_INLINE
 *
__°rˇt_c
 (*
__de°
, 
__c⁄°
 
__§c
[],

974 
size_t
 
__§˛í
);

976 
__STRING_INLINE
 *

977 
	$__°rˇt_c
 (*
__de°
, 
__c⁄°
 
__§c
[], 
size_t
 
__§˛í
)

979 #ifde‡
__i686__


980 
__d0
;

981 *
__tmp
;

982 
__asm__
 
__vﬁ©ûe__


984 : "=D" (
__tmp
), "=&c" (
__d0
),

985 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

986 : "0" (
__de°
), "1" (0xffffffff), "a" (0),

987 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

989 --
__tmp
;

991 *
__tmp
 = 
__de°
 - 1;

992 
__asm__
 
__vﬁ©ûe__


997 : "Ù" (
__tmp
),

998 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

999 : "0" (
__tmp
),

1000 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

1003 (Ë
	`mem˝y
 (
__tmp
, 
__§c
, 
__§˛í
);

1004  
__de°
;

1005 
	}
}

1007 
__STRING_INLINE
 *
__°rˇt_g
 (*
__de°
, 
__c⁄°
 *
__§c
);

1009 
__STRING_INLINE
 *

1010 
	$__°rˇt_g
 (*
__de°
, 
__c⁄°
 *
__§c
)

1012 *
__tmp
 = 
__de°
 - 1;

1013 
__dummy
;

1014 
__asm__
 
__vﬁ©ûe__


1026 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__§c
),

1027 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

1028 : "1" (
__tmp
), "2" (
__§c
),

1029 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__§c
)

1031  
__de°
;

1032 
	}
}

1036 
	#_HAVE_STRING_ARCH_°∫ˇt
 1

	)

1037 
	#°∫ˇt
(
de°
, 
§c
, 
n
) \

1038 (
	`__exãnsi⁄__
 ({ *
__de°
 = (
de°
); \

1039 
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

1040 ? (
	`°æí
 (
§c
Ë< ((
size_t
Ë(
n
)) \

1041 ? 
	`°rˇt
 (
__de°
, (
§c
)) \

1042 : (*(*)
	`__memp˝y
 (
	`°rchr
 (
__de°
, '\0'), \

1043 (
__c⁄°
 *Ë(
§c
), \

1044 (
n
)Ë0, 
__de°
)) \

1045 : 
	`__°∫ˇt_g
 (
__de°
, (
§c
), (
n
)); }))

	)

1047 
__STRING_INLINE
 *
__°∫ˇt_g
 (*
__de°
, 
__c⁄°
 
__§c
[],

1048 
size_t
 
__n
);

1050 
__STRING_INLINE
 *

1051 
	$__°∫ˇt_g
 (*
__de°
, 
__c⁄°
 
__§c
[], 
size_t
 
__n
)

1053 *
__tmp
 = 
__de°
;

1054 
__dummy
;

1055 #ifde‡
__i686__


1056 
__asm__
 
__vﬁ©ûe__


1070 : "=&a" (
__dummy
), "=&D" (
__tmp
), "=&S" (
__§c
), "=&c" (
__n
)

1071 : "g" (
__n
), "0" (0), "1" (
__tmp
), "2" (
__§c
), "3" (0xffffffff)

1074 --
__tmp
;

1075 
__asm__
 
__vﬁ©ûe__


1092 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__§c
), "=&r" (
__n
)

1093 : "1" (
__tmp
), "2" (
__§c
), "3" (
__n
)

1096  
__de°
;

1097 
	}
}

1101 
	#_HAVE_STRING_ARCH_°rcmp
 1

	)

1102 
	#°rcmp
(
s1
, 
s2
) \

1103 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& __buûtö_c⁄°™t_∞(
s2
) \

1104 && ( ((
s1
)[0]Ë!1 || 
	`°æí
 (s1) >= 4) \

1105 && ( ((
s2
)[0]Ë!1 || 
	`°æí
 (s2) >= 4) \

1106 ? 
	`memcmp
 ((
__c⁄°
 *Ë(
s1
), (__c⁄° *Ë(
s2
), \

1107 (
	`°æí
 (
s1
Ë< såÀ¿(
s2
) \

1108 ? 
	`°æí
 (
s1
Ë: såÀ¿(
s2
)) + 1) \

1109 : (
	`__buûtö_c⁄°™t_p
 (
s1
) &&  ((s1)[0]) == 1 \

1110 &&  ((
s2
)[0]Ë=1 && 
	`°æí
 (
s1
) < 4 \

1111 ? (
	`__buûtö_c⁄°™t_p
 (
s2
) &&  ((s2)[0]) == 1 \

1112 ? 
	`__°rcmp_cc
 ((
__c⁄°
 *Ë(
s1
), \

1113 (
__c⁄°
 *Ë(
s2
), \

1114 
	`°æí
 (
s1
)) \

1115 : 
	`__°rcmp_cg
 ((
__c⁄°
 *Ë(
s1
), \

1116 (
__c⁄°
 *Ë(
s2
), \

1117 
	`°æí
 (
s1
))) \

1118 : (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&&  ((
s1
)[0]) == 1 \

1119 &&  ((
s2
)[0]Ë=1 && 
	`°æí
 (s2) < 4 \

1120 ? (
	`__buûtö_c⁄°™t_p
 (
s1
) \

1121 ? 
	`__°rcmp_cc
 ((
__c⁄°
 *Ë(
s1
), \

1122 (
__c⁄°
 *Ë(
s2
), \

1123 
	`°æí
 (
s2
)) \

1124 : 
	`__°rcmp_gc
 ((
__c⁄°
 *Ë(
s1
), \

1125 (
__c⁄°
 *Ë(
s2
), \

1126 
	`°æí
 (
s2
))) \

1127 : 
	`__°rcmp_gg
 ((
s1
), (
s2
))))))

	)

1129 
	#__°rcmp_cc
(
s1
, 
s2
, 
l
) \

1130 (
	`__exãnsi⁄__
 ({ 
__ªsu…
 = (
s1
)[0] - (
s2
)[0]; \

1131 i‡(
l
 > 0 && 
__ªsu…
 == 0) \

1133 
__ªsu…
 = (
s1
)[1] - (
s2
)[1]; \

1134 i‡(
l
 > 1 && 
__ªsu…
 == 0) \

1136 
__ªsu…
 = (
s1
)[2] - (
s2
)[2]; \

1137 i‡(
l
 > 2 && 
__ªsu…
 == 0) \

1138 
__ªsu…
 = (
s1
)[3] - (
s2
)[3]; \

1141 
__ªsu…
; }))

	)

1143 
	#__°rcmp_cg
(
s1
, 
s2
, 
l1
) \

1144 (
	`__exãnsi⁄__
 ({ 
__c⁄°
 *
__s2
 = (
s2
); \

1145 
__ªsu…
 = (
s1
)[0] - 
__s2
[0]; \

1146 i‡(
l1
 > 0 && 
__ªsu…
 == 0) \

1148 
__ªsu…
 = (
s1
)[1] - 
__s2
[1]; \

1149 i‡(
l1
 > 1 && 
__ªsu…
 == 0) \

1151 
__ªsu…
 = (
s1
)[2] - 
__s2
[2]; \

1152 i‡(
l1
 > 2 && 
__ªsu…
 == 0) \

1153 
__ªsu…
 = (
s1
)[3] - 
__s2
[3]; \

1156 
__ªsu…
; }))

	)

1158 
	#__°rcmp_gc
(
s1
, 
s2
, 
l2
) \

1159 (
	`__exãnsi⁄__
 ({ 
__c⁄°
 *
__s1
 = (
s1
); \

1160 
__ªsu…
 = 
__s1
[0] - (
s2
)[0]; \

1161 i‡(
l2
 > 0 && 
__ªsu…
 == 0) \

1163 
__ªsu…
 = 
__s1
[1] - (
s2
)[1]; \

1164 i‡(
l2
 > 1 && 
__ªsu…
 == 0) \

1166 
__ªsu…
 = 
__s1
[2] - (
s2
)[2]; \

1167 i‡(
l2
 > 2 && 
__ªsu…
 == 0) \

1168 
__ªsu…
 = 
__s1
[3] - (
s2
)[3]; \

1171 
__ªsu…
; }))

	)

1173 
__STRING_INLINE
 
__°rcmp_gg
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
);

1175 
__STRING_INLINE
 

1176 
	$__°rcmp_gg
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
)

1178 
__ªs
;

1179 
__asm__
 
__vﬁ©ûe__


1195 : "=q" (
__ªs
), "=&r" (
__s1
), "=&r" (
__s2
)

1196 : "1" (
__s1
), "2" (
__s2
),

1197 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s1
),

1198 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s2
)

1200  
__ªs
;

1201 
	}
}

1205 
	#_HAVE_STRING_ARCH_°∫cmp
 1

	)

1206 
	#°∫cmp
(
s1
, 
s2
, 
n
) \

1207 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`°æí
 (s1Ë< ((
size_t
Ë(
n
)) \

1208 ? 
	`°rcmp
 ((
s1
), (
s2
)) \

1209 : (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`°æí
 (s2Ë< ((
size_t
Ë(
n
))\

1210 ? 
	`°rcmp
 ((
s1
), (
s2
)) \

1211 : 
	`__°∫cmp_g
 ((
s1
), (
s2
), (
n
)))))

	)

1213 
__STRING_INLINE
 
__°∫cmp_g
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
,

1214 
size_t
 
__n
);

1216 
__STRING_INLINE
 

1217 
	$__°∫cmp_g
 (
__c⁄°
 *
__s1
, __c⁄° *
__s2
, 
size_t
 
__n
)

1219 
__ªs
;

1220 
__asm__
 
__vﬁ©ûe__


1239 : "=q" (
__ªs
), "=&r" (
__s1
), "=&r" (
__s2
), "=&r" (
__n
)

1240 : "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

1241 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s1
),

1242 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s2
)

1244  
__ªs
;

1245 
	}
}

1249 
	#_HAVE_STRING_ARCH_°rchr
 1

	)

1250 
	#_USE_STRING_ARCH_°rchr
 1

	)

1251 
	#°rchr
(
s
, 
c
) \

1252 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1253 ? ((
c
) == '\0' \

1254 ? (*Ë
	`__øwmemchr
 ((
s
), (
c
)) \

1255 : 
	`__°rchr_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1256 : 
	`__°rchr_g
 ((
s
), (
c
))))

	)

1258 
__STRING_INLINE
 *
__°rchr_c
 (
__c⁄°
 *
__s
, 
__c
);

1260 
__STRING_INLINE
 *

1261 
	$__°rchr_c
 (
__c⁄°
 *
__s
, 
__c
)

1263 
__d0
;

1264 *
__ªs
;

1265 
__asm__
 
__vﬁ©ûe__


1275 : "Ù" (
__ªs
), "=&a" (
__d0
)

1276 : "0" (
__s
), "1" (
__c
),

1277 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1279  
__ªs
;

1280 
	}
}

1282 
__STRING_INLINE
 *
__°rchr_g
 (
__c⁄°
 *
__s
, 
__c
);

1284 
__STRING_INLINE
 *

1285 
	$__°rchr_g
 (
__c⁄°
 *
__s
, 
__c
)

1287 
__d0
;

1288 *
__ªs
;

1289 
__asm__
 
__vﬁ©ûe__


1300 : "Ù" (
__ªs
), "=&a" (
__d0
)

1301 : "0" (
__s
), "1" (
__c
),

1302 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1304  
__ªs
;

1305 
	}
}

1309 
	#_HAVE_STRING_ARCH_°rch∫ul
 1

	)

1310 
	#__°rch∫ul
(
s
, 
c
) \

1311 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1312 ? ((
c
) == '\0' \

1313 ? (*Ë
	`__øwmemchr
 ((
s
), 
c
) \

1314 : 
	`__°rch∫ul_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1315 : 
	`__°rch∫ul_g
 ((
s
), 
c
)))

	)

1317 
__STRING_INLINE
 *
__°rch∫ul_c
 (
__c⁄°
 *
__s
, 
__c
);

1319 
__STRING_INLINE
 *

1320 
	$__°rch∫ul_c
 (
__c⁄°
 *
__s
, 
__c
)

1322 
__d0
;

1323 *
__ªs
;

1324 
__asm__
 
__vﬁ©ûe__


1334 : "Ù" (
__ªs
), "=&a" (
__d0
)

1335 : "0" (
__s
), "1" (
__c
),

1336 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1338  
__ªs
;

1339 
	}
}

1341 
__STRING_INLINE
 *
__°rch∫ul_g
 (
__c⁄°
 *
__s
, 
__c
);

1343 
__STRING_INLINE
 *

1344 
	$__°rch∫ul_g
 (
__c⁄°
 *
__s
, 
__c
)

1346 
__d0
;

1347 *
__ªs
;

1348 
__asm__
 
__vﬁ©ûe__


1359 : "Ù" (
__ªs
), "=&a" (
__d0
)

1360 : "0" (
__s
), "1" (
__c
),

1361 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1363  
__ªs
;

1364 
	}
}

1365 #ifde‡
__USE_GNU


1366 
	#°rch∫ul
(
s
, 
c
Ë
	`__°rch∫ul
 ((s), (c))

	)

1370 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


1372 
	#_HAVE_STRING_ARCH_ödex
 1

	)

1373 
	#ödex
(
s
, 
c
) \

1374 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1375 ? 
	`__°rchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1376 : 
	`__°rchr_g
 ((
s
), (
c
))))

	)

1381 
	#_HAVE_STRING_ARCH_°ºchr
 1

	)

1382 
	#°ºchr
(
s
, 
c
) \

1383 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1384 ? 
	`__°ºchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1385 : 
	`__°ºchr_g
 ((
s
), (
c
))))

	)

1387 #ifde‡
__i686__


1388 
__STRING_INLINE
 *
__°ºchr_c
 (
__c⁄°
 *
__s
, 
__c
);

1390 
__STRING_INLINE
 *

1391 
	$__°ºchr_c
 (
__c⁄°
 *
__s
, 
__c
)

1393 
__d0
, 
__d1
;

1394 *
__ªs
;

1395 
__asm__
 
__vﬁ©ûe__


1403 : "=d" (
__ªs
), "=&S" (
__d0
), "=&a" (
__d1
)

1404 : "0" (1), "1" (
__s
), "2" (
__c
),

1405 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1407  
__ªs
 - 1;

1408 
	}
}

1410 
__STRING_INLINE
 *
__°ºchr_g
 (
__c⁄°
 *
__s
, 
__c
);

1412 
__STRING_INLINE
 *

1413 
	$__°ºchr_g
 (
__c⁄°
 *
__s
, 
__c
)

1415 
__d0
, 
__d1
;

1416 *
__ªs
;

1417 
__asm__
 
__vﬁ©ûe__


1426 : "=d" (
__ªs
), "=&S" (
__d0
), "=&a" (
__d1
)

1427 : "0" (1), "1" (
__s
), "2" (
__c
),

1428 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1430  
__ªs
 - 1;

1431 
	}
}

1433 
__STRING_INLINE
 *
__°ºchr_c
 (
__c⁄°
 *
__s
, 
__c
);

1435 
__STRING_INLINE
 *

1436 
	$__°ºchr_c
 (
__c⁄°
 *
__s
, 
__c
)

1438 
__d0
, 
__d1
;

1439 *
__ªs
;

1440 
__asm__
 
__vﬁ©ûe__


1450 : "=d" (
__ªs
), "=&S" (
__d0
), "=&a" (
__d1
)

1451 : "0" (0), "1" (
__s
), "2" (
__c
),

1452 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1454  
__ªs
;

1455 
	}
}

1457 
__STRING_INLINE
 *
__°ºchr_g
 (
__c⁄°
 *
__s
, 
__c
);

1459 
__STRING_INLINE
 *

1460 
	$__°ºchr_g
 (
__c⁄°
 *
__s
, 
__c
)

1462 
__d0
, 
__d1
;

1463 *
__ªs
;

1464 
__asm__
 
__vﬁ©ûe__


1475 : "Ù" (
__ªs
), "=&S" (
__d0
), "=&a" (
__d1
)

1476 : "0" (0), "1" (
__s
), "2" (
__c
),

1477 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1479  
__ªs
;

1480 
	}
}

1484 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


1486 
	#_HAVE_STRING_ARCH_rödex
 1

	)

1487 
	#rödex
(
s
, 
c
) \

1488 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1489 ? 
	`__°ºchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1490 : 
	`__°ºchr_g
 ((
s
), (
c
))))

	)

1496 
	#_HAVE_STRING_ARCH_°rc•n
 1

	)

1497 
	#°rc•n
(
s
, 
ªje˘
) \

1498 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
ªje˘
) &&  ((reject)[0]) == 1 \

1499 ? ((
ªje˘
)[0] == '\0' \

1500 ? 
	`°æí
 (
s
) \

1501 : ((
ªje˘
)[1] == '\0' \

1502 ? 
	`__°rc•n_c1
 ((
s
), (((
ªje˘
)[0] << 8) & 0xff00)) \

1503 : 
	`__°rc•n_cg
 ((
s
), (
ªje˘
), 
	`°æí
 (reject)))) \

1504 : 
	`__°rc•n_g
 ((
s
), (
ªje˘
))))

	)

1506 
__STRING_INLINE
 
size_t
 
__°rc•n_c1
 (
__c⁄°
 *
__s
, 
__ªje˘
);

1508 #i‚de‡
_FORCE_INLINES


1509 
__STRING_INLINE
 
size_t


1510 
	$__°rc•n_c1
 (
__c⁄°
 *
__s
, 
__ªje˘
)

1512 
__d0
;

1513 *
__ªs
;

1514 
__asm__
 
__vﬁ©ûe__


1523 : "Ù" (
__ªs
), "=&a" (
__d0
)

1524 : "0" (
__s
), "1" (
__ªje˘
),

1525 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1527  (
__ªs
 - 1Ë- 
__s
;

1528 
	}
}

1531 
__STRING_INLINE
 
size_t
 
__°rc•n_cg
 (
__c⁄°
 *
__s
, __c⁄° 
__ªje˘
[],

1532 
size_t
 
__ªje˘_Àn
);

1534 
__STRING_INLINE
 
size_t


1535 
	$__°rc•n_cg
 (
__c⁄°
 *
__s
, __c⁄° 
__ªje˘
[], 
size_t
 
__ªje˘_Àn
)

1537 
__d0
, 
__d1
, 
__d2
;

1538 
__c⁄°
 *
__ªs
;

1539 
__asm__
 
__vﬁ©ûe__


1550 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1551 : "0" (
__s
), "d" (
__ªje˘
), "g" (
__ªje˘_Àn
)

1553  (
__ªs
 - 1Ë- 
__s
;

1554 
	}
}

1556 
__STRING_INLINE
 
size_t
 
__°rc•n_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ªje˘
);

1557 #ifde‡
__PIC__


1559 
__STRING_INLINE
 
size_t


1560 
	$__°rc•n_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ªje˘
)

1562 
__d0
, 
__d1
, 
__d2
;

1563 
__c⁄°
 *
__ªs
;

1564 
__asm__
 
__vﬁ©ûe__


1581 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1582 : "r" (
__ªje˘
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1584  (
__ªs
 - 1Ë- 
__s
;

1585 
	}
}

1587 
__STRING_INLINE
 
size_t


1588 
	$__°rc•n_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ªje˘
)

1590 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1591 
__c⁄°
 *
__ªs
;

1592 
__asm__
 
__vﬁ©ûe__


1606 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1607 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__ªje˘
), "b" (__reject)

1610  (
__ªs
 - 1Ë- 
__s
;

1611 
	}
}

1617 
	#_HAVE_STRING_ARCH_°r•n
 1

	)

1618 
	#°r•n
(
s
, 
ac˚±
) \

1619 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
) &&  ((accept)[0]) == 1 \

1620 ? ((
ac˚±
)[0] == '\0' \

1621 ? ((Ë(
s
), 0) \

1622 : ((
ac˚±
)[1] == '\0' \

1623 ? 
	`__°r•n_c1
 ((
s
), (((
ac˚±
)[0] << 8 ) & 0xff00)) \

1624 : 
	`__°r•n_cg
 ((
s
), (
ac˚±
), 
	`°æí
 (accept)))) \

1625 : 
	`__°r•n_g
 ((
s
), (
ac˚±
))))

	)

1627 #i‚de‡
_FORCE_INLINES


1628 
__STRING_INLINE
 
size_t
 
__°r•n_c1
 (
__c⁄°
 *
__s
, 
__ac˚±
);

1630 
__STRING_INLINE
 
size_t


1631 
	$__°r•n_c1
 (
__c⁄°
 *
__s
, 
__ac˚±
)

1633 
__d0
;

1634 *
__ªs
;

1636 
__asm__
 
__vﬁ©ûe__


1642 : "Ù" (
__ªs
), "=&q" (
__d0
)

1643 : "0" (
__s
), "1" (
__ac˚±
),

1644 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1646  (
__ªs
 - 1Ë- 
__s
;

1647 
	}
}

1650 
__STRING_INLINE
 
size_t
 
__°r•n_cg
 (
__c⁄°
 *
__s
, __c⁄° 
__ac˚±
[],

1651 
size_t
 
__ac˚±_Àn
);

1653 
__STRING_INLINE
 
size_t


1654 
	$__°r•n_cg
 (
__c⁄°
 *
__s
, __c⁄° 
__ac˚±
[], 
size_t
 
__ac˚±_Àn
)

1656 
__d0
, 
__d1
, 
__d2
;

1657 
__c⁄°
 *
__ªs
;

1658 
__asm__
 
__vﬁ©ûe__


1669 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1670 : "0" (
__s
), "g" (
__ac˚±
), "g" (
__ac˚±_Àn
),

1673 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
),

1674 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__ac˚±_Àn
]; } *)
__ac˚±
)

1676  (
__ªs
 - 1Ë- 
__s
;

1677 
	}
}

1679 
__STRING_INLINE
 
size_t
 
__°r•n_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
);

1680 #ifde‡
__PIC__


1682 
__STRING_INLINE
 
size_t


1683 
	$__°r•n_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
)

1685 
__d0
, 
__d1
, 
__d2
;

1686 
__c⁄°
 *
__ªs
;

1687 
__asm__
 
__vﬁ©ûe__


1703 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1704 : "d" (
__ac˚±
), "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (__accept)

1706  (
__ªs
 - 1Ë- 
__s
;

1707 
	}
}

1709 
__STRING_INLINE
 
size_t


1710 
	$__°r•n_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
)

1712 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1713 
__c⁄°
 *
__ªs
;

1714 
__asm__
 
__vﬁ©ûe__


1728 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1729 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__ac˚±
), "b" (__accept)

1731  (
__ªs
 - 1Ë- 
__s
;

1732 
	}
}

1737 
	#_HAVE_STRING_ARCH_°Ωbrk
 1

	)

1738 
	#°Ωbrk
(
s
, 
ac˚±
) \

1739 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
) &&  ((accept)[0]) == 1 \

1740 ? ((
ac˚±
)[0] == '\0' \

1741 ? ((Ë(
s
), (*) 0) \

1742 : ((
ac˚±
)[1] == '\0' \

1743 ? 
	`°rchr
 ((
s
), (
ac˚±
)[0]) \

1744 : 
	`__°Ωbrk_cg
 ((
s
), (
ac˚±
), 
	`°æí
 (accept)))) \

1745 : 
	`__°Ωbrk_g
 ((
s
), (
ac˚±
))))

	)

1747 
__STRING_INLINE
 *
__°Ωbrk_cg
 (
__c⁄°
 *
__s
, __c⁄° 
__ac˚±
[],

1748 
size_t
 
__ac˚±_Àn
);

1750 
__STRING_INLINE
 *

1751 
	$__°Ωbrk_cg
 (
__c⁄°
 *
__s
, __c⁄° 
__ac˚±
[], 
size_t
 
__ac˚±_Àn
)

1753 
__d0
, 
__d1
, 
__d2
;

1754 *
__ªs
;

1755 
__asm__
 
__vﬁ©ûe__


1770 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1771 : "0" (
__s
), "d" (
__ac˚±
), "g" (
__ac˚±_Àn
)

1773  
__ªs
;

1774 
	}
}

1776 
__STRING_INLINE
 *
__°Ωbrk_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
);

1777 #ifde‡
__PIC__


1779 
__STRING_INLINE
 *

1780 
	$__°Ωbrk_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
)

1782 
__d0
, 
__d1
, 
__d2
;

1783 *
__ªs
;

1784 
__asm__
 
__vﬁ©ûe__


1805 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1806 : "d" (
__ac˚±
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1808  
__ªs
;

1809 
	}
}

1811 
__STRING_INLINE
 *

1812 
	$__°Ωbrk_g
 (
__c⁄°
 *
__s
, __c⁄° *
__ac˚±
)

1814 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1815 *
__ªs
;

1816 
__asm__
 
__vﬁ©ûe__


1835 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&d" (
__d2
), "=&D" (
__d3
)

1836 : "0" (
__s
), "1" (0), "2" (0xffffffff), "b" (
__ac˚±
)

1838  
__ªs
;

1839 
	}
}

1844 
	#_HAVE_STRING_ARCH_°r°r
 1

	)

1845 
	#°r°r
(
hay°ack
, 
√edÀ
) \

1846 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
√edÀ
) &&  ((needle)[0]) == 1 \

1847 ? ((
√edÀ
)[0] == '\0' \

1848 ? (
hay°ack
) \

1849 : ((
√edÀ
)[1] == '\0' \

1850 ? 
	`°rchr
 ((
hay°ack
), (
√edÀ
)[0]) \

1851 : 
	`__°r°r_cg
 ((
hay°ack
), (
√edÀ
), \

1852 
	`°æí
 (
√edÀ
)))) \

1853 : 
	`__°r°r_g
 ((
hay°ack
), (
√edÀ
))))

	)

1857 
__STRING_INLINE
 *
__°r°r_cg
 (
__c⁄°
 *
__hay°ack
, __c⁄° 
__√edÀ
[],

1858 
size_t
 
__√edÀ_Àn
);

1860 
__STRING_INLINE
 *

1861 
	$__°r°r_cg
 (
__c⁄°
 *
__hay°ack
, __c⁄° 
__√edÀ
[],

1862 
size_t
 
__√edÀ_Àn
)

1864 
__d0
, 
__d1
, 
__d2
;

1865 *
__ªs
;

1866 
__asm__
 
__vﬁ©ûe__


1879 : "=&a" (
__ªs
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

1880 : "g" (
__√edÀ_Àn
), "1" (
__hay°ack
), "d" (
__√edÀ
)

1882  
__ªs
;

1883 
	}
}

1885 
__STRING_INLINE
 *
__°r°r_g
 (
__c⁄°
 *
__hay°ack
, __c⁄° *
__√edÀ
);

1886 #ifde‡
__PIC__


1888 
__STRING_INLINE
 *

1889 
	$__°r°r_g
 (
__c⁄°
 *
__hay°ack
, __c⁄° *
__√edÀ
)

1891 
__d0
, 
__d1
, 
__d2
;

1892 *
__ªs
;

1893 
__asm__
 
__vﬁ©ûe__


1912 : "=&a" (
__ªs
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
)

1913 : "0" (0), "1" (0xffffffff), "2" (
__hay°ack
), "3" (
__√edÀ
),

1914 "d" (
__√edÀ
)

1916  
__ªs
;

1917 
	}
}

1919 
__STRING_INLINE
 *

1920 
	$__°r°r_g
 (
__c⁄°
 *
__hay°ack
, __c⁄° *
__√edÀ
)

1922 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1923 *
__ªs
;

1924 
__asm__
 
__vﬁ©ûe__


1941 : "=&a" (
__ªs
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1942 : "0" (0), "1" (0xffffffff), "2" (
__hay°ack
), "3" (
__√edÀ
),

1943 "b" (
__√edÀ
)

1945  
__ªs
;

1946 
	}
}

1952 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


1953 #ifde‡
__i686__


1954 
	#_HAVE_STRING_ARCH_ffs
 1

	)

1955 
	#ffs
(
w‹d
Ë(
	`__buûtö_c⁄°™t_p
 (word) \

1956 ? 
	`__buûtö_ffs
 (
w‹d
) \

1957 : ({ 
__˙t
, 
__tmp
; \

1958 
__asm__
 
__vﬁ©ûe__
 \

1961 : "=&r" (
__˙t
), "Ù" (
__tmp
) \

1962 : "rm" (
w‹d
), "1" (-1)); \

1963 
__˙t
 + 1; }))

	)

1965 #i‚de‡
ff¶


1966 
	#ff¶
(
w‹d
Ë
	`ffs
(w‹d)

	)

1971 #i‚de‡
_FORCE_INLINES


1972 #unde‡
__STRING_INLINE


	@/usr/include/bits/string2.h

21 #i‚de‡
_STRING_H


25 #i‡!
deföed
 
__NO_STRING_INLINES
 && !deföed 
__BOUNDED_POINTERS__


42 #i‚de‡
__STRING_INLINE


43 #ifde‡
__˝lu•lus


44 
	#__STRING_INLINE
 
ölöe


	)

46 
	#__STRING_INLINE
 
__exã∫_ölöe


	)

50 #i‡
_STRING_ARCH_u«lig√d


52 
	~<ídün.h
>

53 
	~<bôs/ty≥s.h
>

55 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


56 
	#__STRING2_SMALL_GET16
(
§c
, 
idx
) \

57 (((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
 + 1] << 8 \

58 | ((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
])

	)

59 
	#__STRING2_SMALL_GET32
(
§c
, 
idx
) \

60 (((((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
 + 3] << 8 \

61 | ((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
 + 2]) << 8 \

62 | ((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
 + 1]) << 8 \

63 | ((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
])

	)

65 
	#__STRING2_SMALL_GET16
(
§c
, 
idx
) \

66 (((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
] << 8 \

67 | ((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
 + 1])

	)

68 
	#__STRING2_SMALL_GET32
(
§c
, 
idx
) \

69 (((((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
] << 8 \

70 | ((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
 + 1]) << 8 \

71 | ((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
 + 2]) << 8 \

72 | ((
__c⁄°
 *Ë(__c⁄° *Ë(
§c
))[
idx
 + 3])

	)

77 
	#__STRING2_COPY_TYPE
(
N
) \

78 °ru˘ { 
__¨r
[
N
]; } \

79 
	t__©åibuã__
 ((
	t__∑cked__
)Ë
	t__STRING2_COPY_ARR
##
	tN


	)

80 
	t__STRING2_COPY_TYPE
 (2);

81 
__STRING2_COPY_TYPE
 (3);

82 
__STRING2_COPY_TYPE
 (4);

83 
__STRING2_COPY_TYPE
 (5);

84 
__STRING2_COPY_TYPE
 (6);

85 
__STRING2_COPY_TYPE
 (7);

86 
__STRING2_COPY_TYPE
 (8);

87 #unde‡
__STRING2_COPY_TYPE


93 
	#__°rög2_1b±r_p
(
__x
) \

94 ((
size_t
)(c⁄° *)((
__x
Ë+ 1Ë- (size_t)(c⁄° *)(__xË=1)

	)

97 #i‡!
deföed
 
_HAVE_STRING_ARCH_mem£t


98 #i‡!
__GNUC_PREREQ
 (3, 0)

99 #i‡
_STRING_ARCH_u«lig√d


100 
	#mem£t
(
s
, 
c
, 
n
) \

101 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
n
) && (n) <= 16 \

102 ? ((
n
) == 1 \

103 ? 
	`__mem£t_1
 (
s
, 
c
) \

104 : 
	`__mem£t_gc
 (
s
, 
c
, 
n
)) \

105 : (
	`__buûtö_c⁄°™t_p
 (
c
) && (c) == '\0' \

106 ? ({ *
__s
 = (
s
); 
	`__bzîo
 (__s, 
n
); __s; }) \

107 : 
	`mem£t
 (
s
, 
c
, 
n
))))

	)

109 
	#__mem£t_1
(
s
, 
c
Ë({ *
__s
 = (s); \

110 *((
__uöt8_t
 *Ë
__s
Ë(__uöt8_tË
c
; __s; })

	)

112 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

113 ({ *
__s
 = (
s
); \

115 
__ui
; \

116 
__usi
; \

117 
__uc
; \

118 } *
__u
 = 
__s
; \

119 
__uöt8_t
 
__c
 = (__uöt8_tË(
c
); \

122 (Ë(
n
)) \

125 
__u
->
__ui
 = 
__c
 * 0x01010101; \

126 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

128 
__u
->
__ui
 = 
__c
 * 0x01010101; \

129 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

131 
__u
->
__ui
 = 
__c
 * 0x01010101; \

132 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

134 
__u
->
__usi
 = (Ë
__c
 * 0x0101; \

135 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

136 
__u
->
__uc
 = (Ë
__c
; \

140 
__u
->
__ui
 = 
__c
 * 0x01010101; \

141 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

143 
__u
->
__ui
 = 
__c
 * 0x01010101; \

144 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

146 
__u
->
__ui
 = 
__c
 * 0x01010101; \

147 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

149 
__u
->
__usi
 = (Ë
__c
 * 0x0101; \

153 
__u
->
__ui
 = 
__c
 * 0x01010101; \

154 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

156 
__u
->
__ui
 = 
__c
 * 0x01010101; \

157 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

159 
__u
->
__ui
 = 
__c
 * 0x01010101; \

160 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

162 
__u
->
__uc
 = (Ë
__c
; \

166 
__u
->
__ui
 = 
__c
 * 0x01010101; \

167 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

169 
__u
->
__ui
 = 
__c
 * 0x01010101; \

170 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

172 
__u
->
__ui
 = 
__c
 * 0x01010101; \

173 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

175 
__u
->
__ui
 = 
__c
 * 0x01010101; \

180 
__s
; })

	)

182 
	#mem£t
(
s
, 
c
, 
n
) \

183 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) && (c) == '\0' \

184 ? ({ *
__s
 = (
s
); 
	`__bzîo
 (__s, 
n
); __s; }) \

185 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

194 #i‡
__GNUC_PREREQ
 (2, 91)

195 
	#__bzîo
(
s
, 
n
Ë
	`__buûtö_mem£t
 (s, '\0',Ç)

	)

203 #ifde‡
__USE_GNU


204 #i‡!
deföed
 
_HAVE_STRING_ARCH_memp˝y
 || deföed 
_FORCE_INLINES


205 #i‚de‡
_HAVE_STRING_ARCH_memp˝y


206 #i‡
__GNUC_PREREQ
 (3, 4)

207 
	#__memp˝y
(
de°
, 
§c
, 
n
Ë
	`__buûtö_memp˝y
 (de°, src,Ç)

	)

208 #ñi‡
__GNUC_PREREQ
 (3, 0)

209 
	#__memp˝y
(
de°
, 
§c
, 
n
) \

210 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

211 && 
	`__°rög2_1b±r_p
 (
§c
Ë&& 
n
 <= 8 \

212 ? 
	`__buûtö_mem˝y
 (
de°
, 
§c
, 
n
) + (n) \

213 : 
	`__memp˝y
 (
de°
, 
§c
, 
n
)))

	)

215 
	#__memp˝y
(
de°
, 
§c
, 
n
) \

216 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

217 && 
	`__°rög2_1b±r_p
 (
§c
Ë&& 
n
 <= 8 \

218 ? 
	`__memp˝y_smÆl
 (
de°
, 
	`__memp˝y_¨gs
 (
§c
), 
n
) \

219 : 
	`__memp˝y
 (
de°
, 
§c
, 
n
)))

	)

223 
	#memp˝y
(
de°
, 
§c
, 
n
Ë
	`__memp˝y
 (de°, src,Ç)

	)

226 #i‡!
__GNUC_PREREQ
 (3, 0Ë|| 
deföed
 
_FORCE_INLINES


227 #i‡
_STRING_ARCH_u«lig√d


228 #i‚de‡
_FORCE_INLINES


229 
	#__memp˝y_¨gs
(
§c
) \

230 ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[2], \

231 ((
__c⁄°
 *Ë(
§c
))[4], ((__const *) (src))[6], \

232 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 0), \

233 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 4), \

234 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 0), \

235 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 4)

	)

237 
__STRING_INLINE
 *
__memp˝y_smÆl
 (*, , , , ,

238 
__uöt16_t
, __uöt16_t, 
__uöt32_t
,

239 
__uöt32_t
, 
size_t
);

240 
__STRING_INLINE
 *

241 
	$__memp˝y_smÆl
 (*
__de°1
,

242 
__§c0_1
, 
__§c2_1
, 
__§c4_1
, 
__§c6_1
,

243 
__uöt16_t
 
__§c0_2
, __uöt16_à
__§c4_2
,

244 
__uöt32_t
 
__§c0_4
, __uöt32_à
__§c4_4
,

245 
size_t
 
__§˛í
)

248 
__uöt32_t
 
__ui
;

249 
__uöt16_t
 
__usi
;

250 
__uc
;

251 
__c
;

252 } *
__u
 = 
__de°1
;

253 (Ë
__§˛í
)

256 
__u
->
__c
 = 
__§c0_1
;

257 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

260 
__u
->
__usi
 = 
__§c0_2
;

261 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

264 
__u
->
__usi
 = 
__§c0_2
;

265 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

266 
__u
->
__c
 = 
__§c2_1
;

267 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

270 
__u
->
__ui
 = 
__§c0_4
;

271 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

274 
__u
->
__ui
 = 
__§c0_4
;

275 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

276 
__u
->
__c
 = 
__§c4_1
;

277 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

280 
__u
->
__ui
 = 
__§c0_4
;

281 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

282 
__u
->
__usi
 = 
__§c4_2
;

283 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

286 
__u
->
__ui
 = 
__§c0_4
;

287 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

288 
__u
->
__usi
 = 
__§c4_2
;

289 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

290 
__u
->
__c
 = 
__§c6_1
;

291 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

294 
__u
->
__ui
 = 
__§c0_4
;

295 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

296 
__u
->
__ui
 = 
__§c4_4
;

297 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

300  (*Ë
__u
;

301 
	}
}

303 #i‚de‡
_FORCE_INLINES


304 
	#__memp˝y_¨gs
(
§c
) \

305 ((
__c⁄°
 *Ë(
§c
))[0], \

306 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR2
) \

307 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1] } }), \

308 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR3
) \

309 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

310 ((
__c⁄°
 *Ë(
§c
))[2] } }), \

311 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR4
) \

312 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

313 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3] } }), \

314 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR5
) \

315 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

316 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

317 ((
__c⁄°
 *Ë(
§c
))[4] } }), \

318 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR6
) \

319 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

320 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

321 ((
__c⁄°
 *Ë(
§c
))[4], ((__const *) (src))[5] } }), \

322 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR7
) \

323 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

324 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

325 ((
__c⁄°
 *Ë(
§c
))[4], ((__const *) (src))[5], \

326 ((
__c⁄°
 *Ë(
§c
))[6] } }), \

327 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR8
) \

328 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

329 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

330 ((
__c⁄°
 *Ë(
§c
))[4], ((__const *) (src))[5], \

331 ((
__c⁄°
 *Ë(
§c
))[6], ((__c⁄° *Ë(§c))[7] } })

	)

333 
__STRING_INLINE
 *
__memp˝y_smÆl
 (*, , 
__STRING2_COPY_ARR2
,

334 
__STRING2_COPY_ARR3
,

335 
__STRING2_COPY_ARR4
,

336 
__STRING2_COPY_ARR5
,

337 
__STRING2_COPY_ARR6
,

338 
__STRING2_COPY_ARR7
,

339 
__STRING2_COPY_ARR8
, 
size_t
);

340 
__STRING_INLINE
 *

341 
	$__memp˝y_smÆl
 (*
__de°
, 
__§c1
,

342 
__STRING2_COPY_ARR2
 
__§c2
, 
__STRING2_COPY_ARR3
 
__§c3
,

343 
__STRING2_COPY_ARR4
 
__§c4
, 
__STRING2_COPY_ARR5
 
__§c5
,

344 
__STRING2_COPY_ARR6
 
__§c6
, 
__STRING2_COPY_ARR7
 
__§c7
,

345 
__STRING2_COPY_ARR8
 
__§c8
, 
size_t
 
__§˛í
)

348 
__c
;

349 
__STRING2_COPY_ARR2
 
__sˇ2
;

350 
__STRING2_COPY_ARR3
 
__sˇ3
;

351 
__STRING2_COPY_ARR4
 
__sˇ4
;

352 
__STRING2_COPY_ARR5
 
__sˇ5
;

353 
__STRING2_COPY_ARR6
 
__sˇ6
;

354 
__STRING2_COPY_ARR7
 
__sˇ7
;

355 
__STRING2_COPY_ARR8
 
__sˇ8
;

356 } *
__u
 = 
__de°
;

357 (Ë
__§˛í
)

360 
__u
->
__c
 = 
__§c1
;

363 
__exãnsi⁄__
 
__u
->
__sˇ2
 = 
__§c2
;

366 
__exãnsi⁄__
 
__u
->
__sˇ3
 = 
__§c3
;

369 
__exãnsi⁄__
 
__u
->
__sˇ4
 = 
__§c4
;

372 
__exãnsi⁄__
 
__u
->
__sˇ5
 = 
__§c5
;

375 
__exãnsi⁄__
 
__u
->
__sˇ6
 = 
__§c6
;

378 
__exãnsi⁄__
 
__u
->
__sˇ7
 = 
__§c7
;

381 
__exãnsi⁄__
 
__u
->
__sˇ8
 = 
__§c8
;

384  
	`__exãnsi⁄__
 ((*Ë
__u
 + 
__§˛í
);

385 
	}
}

393 #i‚de‡
_HAVE_STRING_ARCH_°rchr


394 *
__øwmemchr
 (c⁄° *
__s
, 
__c
);

395 #i‡
__GNUC_PREREQ
 (3, 2)

396 
	#°rchr
(
s
, 
c
) \

397 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
Ë&& !__buûtö_c⁄°™t_∞(
s
) \

398 && (
c
) == '\0' \

399 ? (*Ë
	`__øwmemchr
 (
s
, 
c
) \

400 : 
	`__buûtö_°rchr
 (
s
, 
c
)))

	)

402 
	#°rchr
(
s
, 
c
) \

403 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) && (c) == '\0' \

404 ? (*Ë
	`__øwmemchr
 (
s
, 
c
) \

405 : 
	`°rchr
 (
s
, 
c
)))

	)

411 #i‡(!
deföed
 
_HAVE_STRING_ARCH_°r˝y
 && !
__GNUC_PREREQ
 (3, 0)) \

412 || 
deföed
 
	g_FORCE_INLINES


413 #i‡!
deföed
 
_HAVE_STRING_ARCH_°r˝y
 && !
__GNUC_PREREQ
 (3, 0)

414 
	#°r˝y
(
de°
, 
§c
) \

415 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

416 ? (
	`__°rög2_1b±r_p
 (
§c
Ë&& 
	`°æí
 (src) + 1 <= 8 \

417 ? 
	`__°r˝y_smÆl
 (
de°
, 
	`__°r˝y_¨gs
 (
§c
), \

418 
	`°æí
 (
§c
) + 1) \

419 : (*Ë
	`mem˝y
 (
de°
, 
§c
, 
	`°æí
 (src) + 1)) \

420 : 
	`°r˝y
 (
de°
, 
§c
)))

	)

423 #i‡
_STRING_ARCH_u«lig√d


424 #i‚de‡
_FORCE_INLINES


425 
	#__°r˝y_¨gs
(
§c
) \

426 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 0), \

427 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 4), \

428 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 0), \

429 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 4)

	)

431 
__STRING_INLINE
 *
__°r˝y_smÆl
 (*, 
__uöt16_t
, __uint16_t,

432 
__uöt32_t
, __uöt32_t, 
size_t
);

433 
__STRING_INLINE
 *

434 
	$__°r˝y_smÆl
 (*
__de°
,

435 
__uöt16_t
 
__§c0_2
, __uöt16_à
__§c4_2
,

436 
__uöt32_t
 
__§c0_4
, __uöt32_à
__§c4_4
,

437 
size_t
 
__§˛í
)

440 
__uöt32_t
 
__ui
;

441 
__uöt16_t
 
__usi
;

442 
__uc
;

443 } *
__u
 = (*Ë
__de°
;

444 (Ë
__§˛í
)

447 
__u
->
__uc
 = '\0';

450 
__u
->
__usi
 = 
__§c0_2
;

453 
__u
->
__usi
 = 
__§c0_2
;

454 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

455 
__u
->
__uc
 = '\0';

458 
__u
->
__ui
 = 
__§c0_4
;

461 
__u
->
__ui
 = 
__§c0_4
;

462 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

463 
__u
->
__uc
 = '\0';

466 
__u
->
__ui
 = 
__§c0_4
;

467 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

468 
__u
->
__usi
 = 
__§c4_2
;

471 
__u
->
__ui
 = 
__§c0_4
;

472 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

473 
__u
->
__usi
 = 
__§c4_2
;

474 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

475 
__u
->
__uc
 = '\0';

478 
__u
->
__ui
 = 
__§c0_4
;

479 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

480 
__u
->
__ui
 = 
__§c4_4
;

483  
__de°
;

484 
	}
}

486 #i‚de‡
_FORCE_INLINES


487 
	#__°r˝y_¨gs
(
§c
) \

488 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR2
) \

489 { { ((
__c⁄°
 *Ë(
§c
))[0], '\0' } }), \

490 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR3
) \

491 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

493 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR4
) \

494 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

495 ((
__c⁄°
 *Ë(
§c
))[2], '\0' } }), \

496 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR5
) \

497 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

498 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

500 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR6
) \

501 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

502 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

503 ((
__c⁄°
 *Ë(
§c
))[4], '\0' } }), \

504 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR7
) \

505 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

506 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

507 ((
__c⁄°
 *Ë(
§c
))[4], ((__const *) (src))[5], \

509 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR8
) \

510 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

511 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

512 ((
__c⁄°
 *Ë(
§c
))[4], ((__const *) (src))[5], \

513 ((
__c⁄°
 *Ë(
§c
))[6], '\0' } })

	)

515 
__STRING_INLINE
 *
__°r˝y_smÆl
 (*, 
__STRING2_COPY_ARR2
,

516 
__STRING2_COPY_ARR3
,

517 
__STRING2_COPY_ARR4
,

518 
__STRING2_COPY_ARR5
,

519 
__STRING2_COPY_ARR6
,

520 
__STRING2_COPY_ARR7
,

521 
__STRING2_COPY_ARR8
, 
size_t
);

522 
__STRING_INLINE
 *

523 
	$__°r˝y_smÆl
 (*
__de°
,

524 
__STRING2_COPY_ARR2
 
__§c2
, 
__STRING2_COPY_ARR3
 
__§c3
,

525 
__STRING2_COPY_ARR4
 
__§c4
, 
__STRING2_COPY_ARR5
 
__§c5
,

526 
__STRING2_COPY_ARR6
 
__§c6
, 
__STRING2_COPY_ARR7
 
__§c7
,

527 
__STRING2_COPY_ARR8
 
__§c8
, 
size_t
 
__§˛í
)

530 
__c
;

531 
__STRING2_COPY_ARR2
 
__sˇ2
;

532 
__STRING2_COPY_ARR3
 
__sˇ3
;

533 
__STRING2_COPY_ARR4
 
__sˇ4
;

534 
__STRING2_COPY_ARR5
 
__sˇ5
;

535 
__STRING2_COPY_ARR6
 
__sˇ6
;

536 
__STRING2_COPY_ARR7
 
__sˇ7
;

537 
__STRING2_COPY_ARR8
 
__sˇ8
;

538 } *
__u
 = (*Ë
__de°
;

539 (Ë
__§˛í
)

542 
__u
->
__c
 = '\0';

545 
__exãnsi⁄__
 
__u
->
__sˇ2
 = 
__§c2
;

548 
__exãnsi⁄__
 
__u
->
__sˇ3
 = 
__§c3
;

551 
__exãnsi⁄__
 
__u
->
__sˇ4
 = 
__§c4
;

554 
__exãnsi⁄__
 
__u
->
__sˇ5
 = 
__§c5
;

557 
__exãnsi⁄__
 
__u
->
__sˇ6
 = 
__§c6
;

560 
__exãnsi⁄__
 
__u
->
__sˇ7
 = 
__§c7
;

563 
__exãnsi⁄__
 
__u
->
__sˇ8
 = 
__§c8
;

566  
__de°
;

567 
	}
}

573 #ifde‡
__USE_GNU


574 #i‡!
deföed
 
_HAVE_STRING_ARCH_°p˝y
 || deföed 
_FORCE_INLINES


575 #i‚de‡
_HAVE_STRING_ARCH_°p˝y


576 #i‡
__GNUC_PREREQ
 (3, 4)

577 
	#__°p˝y
(
de°
, 
§c
Ë
	`__buûtö_°p˝y
 (de°, src)

	)

578 #ñi‡
__GNUC_PREREQ
 (3, 0)

579 
	#__°p˝y
(
de°
, 
§c
) \

580 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

581 ? (
	`__°rög2_1b±r_p
 (
§c
Ë&& 
	`°æí
 (src) + 1 <= 8 \

582 ? 
	`__buûtö_°r˝y
 (
de°
, 
§c
Ë+ 
	`°æí
 (src) \

583 : ((*Ë(
__memp˝y
Ë(
de°
, 
§c
, 
	`°æí
 (src) + 1) \

585 : 
	`__°p˝y
 (
de°
, 
§c
)))

	)

587 
	#__°p˝y
(
de°
, 
§c
) \

588 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

589 ? (
	`__°rög2_1b±r_p
 (
§c
Ë&& 
	`°æí
 (src) + 1 <= 8 \

590 ? 
	`__°p˝y_smÆl
 (
de°
, 
	`__°p˝y_¨gs
 (
§c
), \

591 
	`°æí
 (
§c
) + 1) \

592 : ((*Ë(
__memp˝y
Ë(
de°
, 
§c
, 
	`°æí
 (src) + 1) \

594 : 
	`__°p˝y
 (
de°
, 
§c
)))

	)

598 
	#°p˝y
(
de°
, 
§c
Ë
	`__°p˝y
 (de°, src)

	)

601 #i‡!
__GNUC_PREREQ
 (3, 0Ë|| 
deföed
 
_FORCE_INLINES


602 #i‡
_STRING_ARCH_u«lig√d


603 #i‚de‡
_FORCE_INLINES


604 
	#__°p˝y_¨gs
(
§c
) \

605 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 0), \

606 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 4), \

607 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 0), \

608 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 4)

	)

610 
__STRING_INLINE
 *
__°p˝y_smÆl
 (*, 
__uöt16_t
, __uint16_t,

611 
__uöt32_t
, __uöt32_t, 
size_t
);

612 
__STRING_INLINE
 *

613 
	$__°p˝y_smÆl
 (*
__de°
,

614 
__uöt16_t
 
__§c0_2
, __uöt16_à
__§c4_2
,

615 
__uöt32_t
 
__§c0_4
, __uöt32_à
__§c4_4
,

616 
size_t
 
__§˛í
)

619 
__ui
;

620 
__usi
;

621 
__uc
;

622 
__c
;

623 } *
__u
 = (*Ë
__de°
;

624 (Ë
__§˛í
)

627 
__u
->
__uc
 = '\0';

630 
__u
->
__usi
 = 
__§c0_2
;

631 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

634 
__u
->
__usi
 = 
__§c0_2
;

635 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

636 
__u
->
__uc
 = '\0';

639 
__u
->
__ui
 = 
__§c0_4
;

640 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 3);

643 
__u
->
__ui
 = 
__§c0_4
;

644 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

645 
__u
->
__uc
 = '\0';

648 
__u
->
__ui
 = 
__§c0_4
;

649 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

650 
__u
->
__usi
 = 
__§c4_2
;

651 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

654 
__u
->
__ui
 = 
__§c0_4
;

655 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

656 
__u
->
__usi
 = 
__§c4_2
;

657 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

658 
__u
->
__uc
 = '\0';

661 
__u
->
__ui
 = 
__§c0_4
;

662 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

663 
__u
->
__ui
 = 
__§c4_4
;

664 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 3);

667  &
__u
->
__c
;

668 
	}
}

670 #i‚de‡
_FORCE_INLINES


671 
	#__°p˝y_¨gs
(
§c
) \

672 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR2
) \

673 { { ((
__c⁄°
 *Ë(
§c
))[0], '\0' } }), \

674 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR3
) \

675 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

677 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR4
) \

678 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

679 ((
__c⁄°
 *Ë(
§c
))[2], '\0' } }), \

680 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR5
) \

681 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

682 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

684 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR6
) \

685 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

686 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

687 ((
__c⁄°
 *Ë(
§c
))[4], '\0' } }), \

688 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR7
) \

689 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

690 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

691 ((
__c⁄°
 *Ë(
§c
))[4], ((__const *) (src))[5], \

693 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR8
) \

694 { { ((
__c⁄°
 *Ë(
§c
))[0], ((__const *) (src))[1], \

695 ((
__c⁄°
 *Ë(
§c
))[2], ((__const *) (src))[3], \

696 ((
__c⁄°
 *Ë(
§c
))[4], ((__const *) (src))[5], \

697 ((
__c⁄°
 *Ë(
§c
))[6], '\0' } })

	)

699 
__STRING_INLINE
 *
__°p˝y_smÆl
 (*, 
__STRING2_COPY_ARR2
,

700 
__STRING2_COPY_ARR3
,

701 
__STRING2_COPY_ARR4
,

702 
__STRING2_COPY_ARR5
,

703 
__STRING2_COPY_ARR6
,

704 
__STRING2_COPY_ARR7
,

705 
__STRING2_COPY_ARR8
, 
size_t
);

706 
__STRING_INLINE
 *

707 
	$__°p˝y_smÆl
 (*
__de°
,

708 
__STRING2_COPY_ARR2
 
__§c2
, 
__STRING2_COPY_ARR3
 
__§c3
,

709 
__STRING2_COPY_ARR4
 
__§c4
, 
__STRING2_COPY_ARR5
 
__§c5
,

710 
__STRING2_COPY_ARR6
 
__§c6
, 
__STRING2_COPY_ARR7
 
__§c7
,

711 
__STRING2_COPY_ARR8
 
__§c8
, 
size_t
 
__§˛í
)

714 
__c
;

715 
__STRING2_COPY_ARR2
 
__sˇ2
;

716 
__STRING2_COPY_ARR3
 
__sˇ3
;

717 
__STRING2_COPY_ARR4
 
__sˇ4
;

718 
__STRING2_COPY_ARR5
 
__sˇ5
;

719 
__STRING2_COPY_ARR6
 
__sˇ6
;

720 
__STRING2_COPY_ARR7
 
__sˇ7
;

721 
__STRING2_COPY_ARR8
 
__sˇ8
;

722 } *
__u
 = (*Ë
__de°
;

723 (Ë
__§˛í
)

726 
__u
->
__c
 = '\0';

729 
__exãnsi⁄__
 
__u
->
__sˇ2
 = 
__§c2
;

732 
__exãnsi⁄__
 
__u
->
__sˇ3
 = 
__§c3
;

735 
__exãnsi⁄__
 
__u
->
__sˇ4
 = 
__§c4
;

738 
__exãnsi⁄__
 
__u
->
__sˇ5
 = 
__§c5
;

741 
__exãnsi⁄__
 
__u
->
__sˇ6
 = 
__§c6
;

744 
__exãnsi⁄__
 
__u
->
__sˇ7
 = 
__§c7
;

747 
__exãnsi⁄__
 
__u
->
__sˇ8
 = 
__§c8
;

750  
__de°
 + 
__§˛í
 - 1;

751 
	}
}

759 #i‚de‡
_HAVE_STRING_ARCH_°∫˝y


760 #i‡
__GNUC_PREREQ
 (3, 2)

761 
	#°∫˝y
(
de°
, 
§c
, 
n
Ë
	`__buûtö_°∫˝y
 (de°, src,Ç)

	)

763 
	#°∫˝y
(
de°
, 
§c
, 
n
) \

764 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

765 ? (
	`°æí
 (
§c
Ë+ 1 >((
size_t
Ë(
n
)) \

766 ? (*Ë
	`mem˝y
 (
de°
, 
§c
, 
n
) \

767 : 
	`°∫˝y
 (
de°
, 
§c
, 
n
)) \

768 : 
	`°∫˝y
 (
de°
, 
§c
, 
n
)))

	)

774 #i‚de‡
_HAVE_STRING_ARCH_°∫ˇt


775 #ifde‡
_USE_STRING_ARCH_°rchr


776 
	#°∫ˇt
(
de°
, 
§c
, 
n
) \

777 (
	`__exãnsi⁄__
 ({ *
__de°
 = (
de°
); \

778 
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

779 ? (
	`°æí
 (
§c
Ë< ((
size_t
Ë(
n
)) \

780 ? 
	`°rˇt
 (
__de°
, 
§c
) \

781 : (*((*Ë
	`__memp˝y
 (
	`°rchr
 (
__de°
, '\0'), \

782 
§c
, 
n
)Ë'\0', 
__de°
)) \

783 : 
	`°∫ˇt
 (
de°
, 
§c
, 
n
); }))

	)

784 #ñi‡
__GNUC_PREREQ
 (3, 2)

785 
	#°∫ˇt
(
de°
, 
§c
, 
n
Ë
	`__buûtö_°∫ˇt
 (de°, src,Ç)

	)

787 
	#°∫ˇt
(
de°
, 
§c
, 
n
) \

788 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

789 ? (
	`°æí
 (
§c
Ë< ((
size_t
Ë(
n
)) \

790 ? 
	`°rˇt
 (
de°
, 
§c
) \

791 : 
	`°∫ˇt
 (
de°
, 
§c
, 
n
)) \

792 : 
	`°∫ˇt
 (
de°
, 
§c
, 
n
)))

	)

798 #i‚de‡
_HAVE_STRING_ARCH_°rcmp


799 #i‡
__GNUC_PREREQ
 (3, 2)

800 
	#°rcmp
(
s1
, 
s2
) \

801 
__exãnsi⁄__
 \

802 ({ 
size_t
 
__s1_Àn
, 
__s2_Àn
; \

803 (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& __buûtö_c⁄°™t_∞(
s2
) \

804 && (
__s1_Àn
 = 
	`°æí
 (
s1
), 
__s2_Àn
 = såÀ¿(
s2
), \

805 (!
	`__°rög2_1b±r_p
 (
s1
Ë|| 
__s1_Àn
 >= 4) \

806 && (!
	`__°rög2_1b±r_p
 (
s2
Ë|| 
__s2_Àn
 >= 4)) \

807 ? 
	`__buûtö_°rcmp
 (
s1
, 
s2
) \

808 : (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`__°rög2_1b±r_p
 (s1) \

809 && (
__s1_Àn
 = 
	`°æí
 (
s1
), __s1_len < 4) \

810 ? (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`__°rög2_1b±r_p
 (s2) \

811 ? 
	`__buûtö_°rcmp
 (
s1
, 
s2
) \

812 : 
	`__°rcmp_cg
 (
s1
, 
s2
, 
__s1_Àn
)) \

813 : (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`__°rög2_1b±r_p
 (s2) \

814 && (
__s2_Àn
 = 
	`°æí
 (
s2
), __s2_len < 4) \

815 ? (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`__°rög2_1b±r_p
 (s1) \

816 ? 
	`__buûtö_°rcmp
 (
s1
, 
s2
) \

817 : 
	`__°rcmp_gc
 (
s1
, 
s2
, 
__s2_Àn
)) \

818 : 
	`__buûtö_°rcmp
 (
s1
, 
s2
)))); })

	)

820 
	#°rcmp
(
s1
, 
s2
) \

821 
__exãnsi⁄__
 \

822 ({ 
size_t
 
__s1_Àn
, 
__s2_Àn
; \

823 (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& __buûtö_c⁄°™t_∞(
s2
) \

824 && (
__s1_Àn
 = 
	`°æí
 (
s1
), 
__s2_Àn
 = såÀ¿(
s2
), \

825 (!
	`__°rög2_1b±r_p
 (
s1
Ë|| 
__s1_Àn
 >= 4) \

826 && (!
	`__°rög2_1b±r_p
 (
s2
Ë|| 
__s2_Àn
 >= 4)) \

827 ? 
	`memcmp
 ((
__c⁄°
 *Ë(
s1
), (__c⁄° *Ë(
s2
), \

828 (
__s1_Àn
 < 
__s2_Àn
 ? __s1_len : __s2_len) + 1) \

829 : (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`__°rög2_1b±r_p
 (s1) \

830 && (
__s1_Àn
 = 
	`°æí
 (
s1
), __s1_len < 4) \

831 ? (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`__°rög2_1b±r_p
 (s2) \

832 ? 
	`__°rcmp_cc
 (
s1
, 
s2
, 
__s1_Àn
) \

833 : 
	`__°rcmp_cg
 (
s1
, 
s2
, 
__s1_Àn
)) \

834 : (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`__°rög2_1b±r_p
 (s2) \

835 && (
__s2_Àn
 = 
	`°æí
 (
s2
), __s2_len < 4) \

836 ? (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`__°rög2_1b±r_p
 (s1) \

837 ? 
	`__°rcmp_cc
 (
s1
, 
s2
, 
__s2_Àn
) \

838 : 
	`__°rcmp_gc
 (
s1
, 
s2
, 
__s2_Àn
)) \

839 : 
	`°rcmp
 (
s1
, 
s2
)))); })

	)

842 
	#__°rcmp_cc
(
s1
, 
s2
, 
l
) \

843 (
	`__exãnsi⁄__
 ({ 
__ªsu…
 = \

844 (((
__c⁄°
 *Ë(__c⁄° *Ë(
s1
))[0] \

845 - ((
__c⁄°
 *Ë(__c⁄° *)(
s2
))[0]);\

846 i‡(
l
 > 0 && 
__ªsu…
 == 0) \

848 
__ªsu…
 = (((
__c⁄°
 *) \

849 (
__c⁄°
 *Ë(
s1
))[1] \

850 - ((
__c⁄°
 *) \

851 (
__c⁄°
 *Ë(
s2
))[1]); \

852 i‡(
l
 > 1 && 
__ªsu…
 == 0) \

854 
__ªsu…
 = \

855 (((
__c⁄°
 *) \

856 (
__c⁄°
 *Ë(
s1
))[2] \

857 - ((
__c⁄°
 *) \

858 (
__c⁄°
 *Ë(
s2
))[2]); \

859 i‡(
l
 > 2 && 
__ªsu…
 == 0) \

860 
__ªsu…
 = \

861 (((
__c⁄°
 *) \

862 (
__c⁄°
 *Ë(
s1
))[3] \

863 - ((
__c⁄°
 *) \

864 (
__c⁄°
 *Ë(
s2
))[3]); \

867 
__ªsu…
; }))

	)

869 
	#__°rcmp_cg
(
s1
, 
s2
, 
l1
) \

870 (
	`__exãnsi⁄__
 ({ 
__c⁄°
 *
__s2
 = \

871 (
__c⁄°
 *Ë(__c⁄° *Ë(
s2
); \

872 
__ªsu…
 = \

873 (((
__c⁄°
 *Ë(__c⁄° *Ë(
s1
))[0] \

874 - 
__s2
[0]); \

875 i‡(
l1
 > 0 && 
__ªsu…
 == 0) \

877 
__ªsu…
 = (((
__c⁄°
 *) \

878 (
__c⁄°
 *Ë(
s1
))[1] - 
__s2
[1]); \

879 i‡(
l1
 > 1 && 
__ªsu…
 == 0) \

881 
__ªsu…
 = (((
__c⁄°
 *) \

882 (
__c⁄°
 *Ë(
s1
))[2] - 
__s2
[2]);\

883 i‡(
l1
 > 2 && 
__ªsu…
 == 0) \

884 
__ªsu…
 = (((
__c⁄°
 *) \

885 (
__c⁄°
 *Ë(
s1
))[3] \

886 - 
__s2
[3]); \

889 
__ªsu…
; }))

	)

891 
	#__°rcmp_gc
(
s1
, 
s2
, 
l2
) \

892 (
	`__exãnsi⁄__
 ({ 
__c⁄°
 *
__s1
 = \

893 (
__c⁄°
 *Ë(__c⁄° *Ë(
s1
); \

894 
__ªsu…
 = \

895 
__s1
[0] - ((
__c⁄°
 *) \

896 (
__c⁄°
 *Ë(
s2
))[0]; \

897 i‡(
l2
 > 0 && 
__ªsu…
 == 0) \

899 
__ªsu…
 = (
__s1
[1] \

900 - ((
__c⁄°
 *) \

901 (
__c⁄°
 *Ë(
s2
))[1]); \

902 i‡(
l2
 > 1 && 
__ªsu…
 == 0) \

904 
__ªsu…
 = \

905 (
__s1
[2] - ((
__c⁄°
 *) \

906 (
__c⁄°
 *Ë(
s2
))[2]); \

907 i‡(
l2
 > 2 && 
__ªsu…
 == 0) \

908 
__ªsu…
 = \

909 (
__s1
[3] \

910 - ((
__c⁄°
 *) \

911 (
__c⁄°
 *Ë(
s2
))[3]); \

914 
__ªsu…
; }))

	)

919 #i‚de‡
_HAVE_STRING_ARCH_°∫cmp


920 
	#°∫cmp
(
s1
, 
s2
, 
n
) \

921 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
n
) \

922 && ((
	`__buûtö_c⁄°™t_p
 (
s1
) \

923 && 
	`°æí
 (
s1
Ë< ((
size_t
Ë(
n
))) \

924 || (
	`__buûtö_c⁄°™t_p
 (
s2
) \

925 && 
	`°æí
 (
s2
Ë< ((
size_t
Ë(
n
)))) \

926 ? 
	`°rcmp
 (
s1
, 
s2
Ë: 
	`°∫cmp
 (s1, s2, 
n
)))

	)

932 #i‡!
deföed
 
_HAVE_STRING_ARCH_°rc•n
 || deföed 
_FORCE_INLINES


933 #i‚de‡
_HAVE_STRING_ARCH_°rc•n


934 #i‡
__GNUC_PREREQ
 (3, 2)

935 
	#°rc•n
(
s
, 
ªje˘
) \

936 
__exãnsi⁄__
 \

937 ({ 
__r0
, 
__r1
, 
__r2
; \

938 (
	`__buûtö_c⁄°™t_p
 (
ªje˘
Ë&& 
	`__°rög2_1b±r_p
 (reject) \

939 ? ((
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s)) \

940 ? 
	`__buûtö_°rc•n
 (
s
, 
ªje˘
) \

941 : ((
__r0
 = ((
__c⁄°
 *Ë(
ªje˘
))[0], __r0 == '\0') \

942 ? 
	`°æí
 (
s
) \

943 : ((
__r1
 = ((
__c⁄°
 *Ë(
ªje˘
))[1], __r1 == '\0') \

944 ? 
	`__°rc•n_c1
 (
s
, 
__r0
) \

945 : ((
__r2
 = ((
__c⁄°
 *Ë(
ªje˘
))[2], __r2 == '\0') \

946 ? 
	`__°rc•n_c2
 (
s
, 
__r0
, 
__r1
) \

947 : (((
__c⁄°
 *Ë(
ªje˘
))[3] == '\0' \

948 ? 
	`__°rc•n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

949 : 
	`__buûtö_°rc•n
 (
s
, 
ªje˘
)))))) \

950 : 
	`__buûtö_°rc•n
 (
s
, 
ªje˘
)); })

	)

952 
	#°rc•n
(
s
, 
ªje˘
) \

953 
__exãnsi⁄__
 \

954 ({ 
__r0
, 
__r1
, 
__r2
; \

955 (
	`__buûtö_c⁄°™t_p
 (
ªje˘
Ë&& 
	`__°rög2_1b±r_p
 (reject) \

956 ? ((
__r0
 = ((
__c⁄°
 *Ë(
ªje˘
))[0], __r0 == '\0') \

957 ? 
	`°æí
 (
s
) \

958 : ((
__r1
 = ((
__c⁄°
 *Ë(
ªje˘
))[1], __r1 == '\0') \

959 ? 
	`__°rc•n_c1
 (
s
, 
__r0
) \

960 : ((
__r2
 = ((
__c⁄°
 *Ë(
ªje˘
))[2], __r2 == '\0') \

961 ? 
	`__°rc•n_c2
 (
s
, 
__r0
, 
__r1
) \

962 : (((
__c⁄°
 *Ë(
ªje˘
))[3] == '\0' \

963 ? 
	`__°rc•n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

964 : 
	`°rc•n
 (
s
, 
ªje˘
))))) \

965 : 
	`°rc•n
 (
s
, 
ªje˘
)); })

	)

969 
__STRING_INLINE
 
size_t
 
__°rc•n_c1
 (
__c⁄°
 *
__s
, 
__ªje˘
);

970 
__STRING_INLINE
 
size_t


971 
	$__°rc•n_c1
 (
__c⁄°
 *
__s
, 
__ªje˘
)

973 
size_t
 
__ªsu…
 = 0;

974 
__s
[
__ªsu…
] !'\0' && __s[__ªsu…] !
__ªje˘
)

975 ++
__ªsu…
;

976  
__ªsu…
;

977 
	}
}

979 
__STRING_INLINE
 
size_t
 
__°rc•n_c2
 (
__c⁄°
 *
__s
, 
__ªje˘1
,

980 
__ªje˘2
);

981 
__STRING_INLINE
 
size_t


982 
	$__°rc•n_c2
 (
__c⁄°
 *
__s
, 
__ªje˘1
, 
__ªje˘2
)

984 
size_t
 
__ªsu…
 = 0;

985 
__s
[
__ªsu…
] !'\0' && __s[__ªsu…] !
__ªje˘1


986 && 
__s
[
__ªsu…
] !
__ªje˘2
)

987 ++
__ªsu…
;

988  
__ªsu…
;

989 
	}
}

991 
__STRING_INLINE
 
size_t
 
__°rc•n_c3
 (
__c⁄°
 *
__s
, 
__ªje˘1
,

992 
__ªje˘2
, 
__ªje˘3
);

993 
__STRING_INLINE
 
size_t


994 
	$__°rc•n_c3
 (
__c⁄°
 *
__s
, 
__ªje˘1
, 
__ªje˘2
,

995 
__ªje˘3
)

997 
size_t
 
__ªsu…
 = 0;

998 
__s
[
__ªsu…
] !'\0' && __s[__ªsu…] !
__ªje˘1


999 && 
__s
[
__ªsu…
] !
__ªje˘2
 && __s[__ªsu…] !
__ªje˘3
)

1000 ++
__ªsu…
;

1001  
__ªsu…
;

1002 
	}
}

1008 #i‡!
deföed
 
_HAVE_STRING_ARCH_°r•n
 || deföed 
_FORCE_INLINES


1009 #i‚de‡
_HAVE_STRING_ARCH_°r•n


1010 #i‡
__GNUC_PREREQ
 (3, 2)

1011 
	#°r•n
(
s
, 
ac˚±
) \

1012 
__exãnsi⁄__
 \

1013 ({ 
__a0
, 
__a1
, 
__a2
; \

1014 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
Ë&& 
	`__°rög2_1b±r_p
 (accept) \

1015 ? ((
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s)) \

1016 ? 
	`__buûtö_°r•n
 (
s
, 
ac˚±
) \

1017 : ((
__a0
 = ((
__c⁄°
 *Ë(
ac˚±
))[0], __a0 == '\0') \

1018 ? ((Ë(
s
), 0) \

1019 : ((
__a1
 = ((
__c⁄°
 *Ë(
ac˚±
))[1], __a1 == '\0') \

1020 ? 
	`__°r•n_c1
 (
s
, 
__a0
) \

1021 : ((
__a2
 = ((
__c⁄°
 *Ë(
ac˚±
))[2], __a2 == '\0') \

1022 ? 
	`__°r•n_c2
 (
s
, 
__a0
, 
__a1
) \

1023 : (((
__c⁄°
 *Ë(
ac˚±
))[3] == '\0' \

1024 ? 
	`__°r•n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1025 : 
	`__buûtö_°r•n
 (
s
, 
ac˚±
)))))) \

1026 : 
	`__buûtö_°r•n
 (
s
, 
ac˚±
)); })

	)

1028 
	#°r•n
(
s
, 
ac˚±
) \

1029 
__exãnsi⁄__
 \

1030 ({ 
__a0
, 
__a1
, 
__a2
; \

1031 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
Ë&& 
	`__°rög2_1b±r_p
 (accept) \

1032 ? ((
__a0
 = ((
__c⁄°
 *Ë(
ac˚±
))[0], __a0 == '\0') \

1033 ? ((Ë(
s
), 0) \

1034 : ((
__a1
 = ((
__c⁄°
 *Ë(
ac˚±
))[1], __a1 == '\0') \

1035 ? 
	`__°r•n_c1
 (
s
, 
__a0
) \

1036 : ((
__a2
 = ((
__c⁄°
 *Ë(
ac˚±
))[2], __a2 == '\0') \

1037 ? 
	`__°r•n_c2
 (
s
, 
__a0
, 
__a1
) \

1038 : (((
__c⁄°
 *Ë(
ac˚±
))[3] == '\0' \

1039 ? 
	`__°r•n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1040 : 
	`°r•n
 (
s
, 
ac˚±
))))) \

1041 : 
	`°r•n
 (
s
, 
ac˚±
)); })

	)

1045 
__STRING_INLINE
 
size_t
 
__°r•n_c1
 (
__c⁄°
 *
__s
, 
__ac˚±
);

1046 
__STRING_INLINE
 
size_t


1047 
	$__°r•n_c1
 (
__c⁄°
 *
__s
, 
__ac˚±
)

1049 
size_t
 
__ªsu…
 = 0;

1051 
__s
[
__ªsu…
] =
__ac˚±
)

1052 ++
__ªsu…
;

1053  
__ªsu…
;

1054 
	}
}

1056 
__STRING_INLINE
 
size_t
 
__°r•n_c2
 (
__c⁄°
 *
__s
, 
__ac˚±1
,

1057 
__ac˚±2
);

1058 
__STRING_INLINE
 
size_t


1059 
	$__°r•n_c2
 (
__c⁄°
 *
__s
, 
__ac˚±1
, 
__ac˚±2
)

1061 
size_t
 
__ªsu…
 = 0;

1063 
__s
[
__ªsu…
] =
__ac˚±1
 || __s[__ªsu…] =
__ac˚±2
)

1064 ++
__ªsu…
;

1065  
__ªsu…
;

1066 
	}
}

1068 
__STRING_INLINE
 
size_t
 
__°r•n_c3
 (
__c⁄°
 *
__s
, 
__ac˚±1
,

1069 
__ac˚±2
, 
__ac˚±3
);

1070 
__STRING_INLINE
 
size_t


1071 
	$__°r•n_c3
 (
__c⁄°
 *
__s
, 
__ac˚±1
, 
__ac˚±2
, 
__ac˚±3
)

1073 
size_t
 
__ªsu…
 = 0;

1075 
__s
[
__ªsu…
] =
__ac˚±1
 || __s[__ªsu…] =
__ac˚±2


1076 || 
__s
[
__ªsu…
] =
__ac˚±3
)

1077 ++
__ªsu…
;

1078  
__ªsu…
;

1079 
	}
}

1084 #i‡!
deföed
 
_HAVE_STRING_ARCH_°Ωbrk
 || deföed 
_FORCE_INLINES


1085 #i‚de‡
_HAVE_STRING_ARCH_°Ωbrk


1086 #i‡
__GNUC_PREREQ
 (3, 2)

1087 
	#°Ωbrk
(
s
, 
ac˚±
) \

1088 
__exãnsi⁄__
 \

1089 ({ 
__a0
, 
__a1
, 
__a2
; \

1090 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
Ë&& 
	`__°rög2_1b±r_p
 (accept) \

1091 ? ((
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s)) \

1092 ? 
	`__buûtö_°Ωbrk
 (
s
, 
ac˚±
) \

1093 : ((
__a0
 = ((
__c⁄°
 *Ë(
ac˚±
))[0], __a0 == '\0') \

1094 ? ((Ë(
s
), (*Ë
NULL
) \

1095 : ((
__a1
 = ((
__c⁄°
 *Ë(
ac˚±
))[1], __a1 == '\0') \

1096 ? 
	`__buûtö_°rchr
 (
s
, 
__a0
) \

1097 : ((
__a2
 = ((
__c⁄°
 *Ë(
ac˚±
))[2], __a2 == '\0') \

1098 ? 
	`__°Ωbrk_c2
 (
s
, 
__a0
, 
__a1
) \

1099 : (((
__c⁄°
 *Ë(
ac˚±
))[3] == '\0' \

1100 ? 
	`__°Ωbrk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1101 : 
	`__buûtö_°Ωbrk
 (
s
, 
ac˚±
)))))) \

1102 : 
	`__buûtö_°Ωbrk
 (
s
, 
ac˚±
)); })

	)

1104 
	#°Ωbrk
(
s
, 
ac˚±
) \

1105 
__exãnsi⁄__
 \

1106 ({ 
__a0
, 
__a1
, 
__a2
; \

1107 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
Ë&& 
	`__°rög2_1b±r_p
 (accept) \

1108 ? ((
__a0
 = ((
__c⁄°
 *Ë(
ac˚±
))[0], __a0 == '\0') \

1109 ? ((Ë(
s
), (*Ë
NULL
) \

1110 : ((
__a1
 = ((
__c⁄°
 *Ë(
ac˚±
))[1], __a1 == '\0') \

1111 ? 
	`°rchr
 (
s
, 
__a0
) \

1112 : ((
__a2
 = ((
__c⁄°
 *Ë(
ac˚±
))[2], __a2 == '\0') \

1113 ? 
	`__°Ωbrk_c2
 (
s
, 
__a0
, 
__a1
) \

1114 : (((
__c⁄°
 *Ë(
ac˚±
))[3] == '\0' \

1115 ? 
	`__°Ωbrk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1116 : 
	`°Ωbrk
 (
s
, 
ac˚±
))))) \

1117 : 
	`°Ωbrk
 (
s
, 
ac˚±
)); })

	)

1121 
__STRING_INLINE
 *
__°Ωbrk_c2
 (
__c⁄°
 *
__s
, 
__ac˚±1
,

1122 
__ac˚±2
);

1123 
__STRING_INLINE
 *

1124 
	$__°Ωbrk_c2
 (
__c⁄°
 *
__s
, 
__ac˚±1
, 
__ac˚±2
)

1127 *
__s
 !'\0' && *__†!
__ac˚±1
 && *__†!
__ac˚±2
)

1128 ++
__s
;

1129  *
__s
 ='\0' ? 
NULL
 : (*Ë(
size_t
) __s;

1130 
	}
}

1132 
__STRING_INLINE
 *
__°Ωbrk_c3
 (
__c⁄°
 *
__s
, 
__ac˚±1
,

1133 
__ac˚±2
, 
__ac˚±3
);

1134 
__STRING_INLINE
 *

1135 
	$__°Ωbrk_c3
 (
__c⁄°
 *
__s
, 
__ac˚±1
, 
__ac˚±2
,

1136 
__ac˚±3
)

1139 *
__s
 !'\0' && *__†!
__ac˚±1
 && *__†!
__ac˚±2


1140 && *
__s
 !
__ac˚±3
)

1141 ++
__s
;

1142  *
__s
 ='\0' ? 
NULL
 : (*Ë(
size_t
) __s;

1143 
	}
}

1149 #i‡!
deföed
 
_HAVE_STRING_ARCH_°r°r
 && !
__GNUC_PREREQ
 (2, 97)

1150 
	#°r°r
(
hay°ack
, 
√edÀ
) \

1151 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
√edÀ
Ë&& 
	`__°rög2_1b±r_p
 (needle) \

1152 ? (((
__c⁄°
 *Ë(
√edÀ
))[0] == '\0' \

1153 ? (*Ë(
size_t
Ë(
hay°ack
) \

1154 : (((
__c⁄°
 *Ë(
√edÀ
))[1] == '\0' \

1155 ? 
	`°rchr
 (
hay°ack
, \

1156 ((
__c⁄°
 *Ë(
√edÀ
))[0]) \

1157 : 
	`°r°r
 (
hay°ack
, 
√edÀ
))) \

1158 : 
	`°r°r
 (
hay°ack
, 
√edÀ
)))

	)

1162 #i‡!
deföed
 
_HAVE_STRING_ARCH_°πok_r
 || deföed 
_FORCE_INLINES


1163 #i‚de‡
_HAVE_STRING_ARCH_°πok_r


1164 
	#__°πok_r
(
s
, 
£p
, 
√xç
) \

1165 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
£p
Ë&& 
	`__°rög2_1b±r_p
 (sep) \

1166 && ((
__c⁄°
 *Ë(
£p
))[0] != '\0' \

1167 && ((
__c⁄°
 *Ë(
£p
))[1] == '\0' \

1168 ? 
	`__°πok_r_1c
 (
s
, ((
__c⁄°
 *Ë(
£p
))[0], 
√xç
) \

1169 : 
	`__°πok_r
 (
s
, 
£p
, 
√xç
)))

	)

1172 
__STRING_INLINE
 *
__°πok_r_1c
 (*
__s
, 
__£p
, **
__√xç
);

1173 
__STRING_INLINE
 *

1174 
	$__°πok_r_1c
 (*
__s
, 
__£p
, **
__√xç
)

1176 *
__ªsu…
;

1177 i‡(
__s
 =
NULL
)

1178 
__s
 = *
__√xç
;

1179 *
__s
 =
__£p
)

1180 ++
__s
;

1181 
__ªsu…
 = 
NULL
;

1182 i‡(*
__s
 != '\0')

1184 
__ªsu…
 = 
__s
++;

1185 *
__s
 != '\0')

1186 i‡(*
__s
++ =
__£p
)

1188 
__s
[-1] = '\0';

1192 *
__√xç
 = 
__s
;

1193  
__ªsu…
;

1194 
	}
}

1195 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


1196 
	#°πok_r
(
s
, 
£p
, 
√xç
Ë
	`__°πok_r
 (s, sï,Çexç)

	)

1201 #i‡!
deföed
 
_HAVE_STRING_ARCH_°r£p
 || deföed 
_FORCE_INLINES


1202 #i‚de‡
_HAVE_STRING_ARCH_°r£p


1204 *
__°r£p_g
 (**
__°rögp
, 
__c⁄°
 *
__dñim
);

1205 
	#__°r£p
(
s
, 
ªje˘
) \

1206 
__exãnsi⁄__
 \

1207 ({ 
__r0
, 
__r1
, 
__r2
; \

1208 (
	`__buûtö_c⁄°™t_p
 (
ªje˘
Ë&& 
	`__°rög2_1b±r_p
 (reject) \

1209 && (
__r0
 = ((
__c⁄°
 *Ë(
ªje˘
))[0], \

1210 ((
__c⁄°
 *Ë(
ªje˘
))[0] != '\0') \

1211 ? ((
__r1
 = ((
__c⁄°
 *Ë(
ªje˘
))[1], \

1212 ((
__c⁄°
 *Ë(
ªje˘
))[1] == '\0') \

1213 ? 
	`__°r£p_1c
 (
s
, 
__r0
) \

1214 : ((
__r2
 = ((
__c⁄°
 *Ë(
ªje˘
))[2], __r2 == '\0') \

1215 ? 
	`__°r£p_2c
 (
s
, 
__r0
, 
__r1
) \

1216 : (((
__c⁄°
 *Ë(
ªje˘
))[3] == '\0' \

1217 ? 
	`__°r£p_3c
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

1218 : 
	`__°r£p_g
 (
s
, 
ªje˘
)))) \

1219 : 
	`__°r£p_g
 (
s
, 
ªje˘
)); })

	)

1222 
__STRING_INLINE
 *
__°r£p_1c
 (**
__s
, 
__ªje˘
);

1223 
__STRING_INLINE
 *

1224 
	$__°r£p_1c
 (**
__s
, 
__ªje˘
)

1226 *
__ªtvÆ
 = *
__s
;

1227 i‡(
__ªtvÆ
 !
NULL
 && (*
__s
 = 
	`°rchr
 (__ªtvÆ, 
__ªje˘
)) != NULL)

1228 *(*
__s
)++ = '\0';

1229  
__ªtvÆ
;

1230 
	}
}

1232 
__STRING_INLINE
 *
__°r£p_2c
 (**
__s
, 
__ªje˘1
, 
__ªje˘2
);

1233 
__STRING_INLINE
 *

1234 
	$__°r£p_2c
 (**
__s
, 
__ªje˘1
, 
__ªje˘2
)

1236 *
__ªtvÆ
 = *
__s
;

1237 i‡(
__ªtvÆ
 !
NULL
)

1239 *
__˝
 = 
__ªtvÆ
;

1242 i‡(*
__˝
 == '\0')

1244 
__˝
 = 
NULL
;

1247 i‡(*
__˝
 =
__ªje˘1
 || *__˝ =
__ªje˘2
)

1249 *
__˝
++ = '\0';

1252 ++
__˝
;

1254 *
__s
 = 
__˝
;

1256  
__ªtvÆ
;

1257 
	}
}

1259 
__STRING_INLINE
 *
__°r£p_3c
 (**
__s
, 
__ªje˘1
, 
__ªje˘2
,

1260 
__ªje˘3
);

1261 
__STRING_INLINE
 *

1262 
	$__°r£p_3c
 (**
__s
, 
__ªje˘1
, 
__ªje˘2
, 
__ªje˘3
)

1264 *
__ªtvÆ
 = *
__s
;

1265 i‡(
__ªtvÆ
 !
NULL
)

1267 *
__˝
 = 
__ªtvÆ
;

1270 i‡(*
__˝
 == '\0')

1272 
__˝
 = 
NULL
;

1275 i‡(*
__˝
 =
__ªje˘1
 || *__˝ =
__ªje˘2
 || *__˝ =
__ªje˘3
)

1277 *
__˝
++ = '\0';

1280 ++
__˝
;

1282 *
__s
 = 
__˝
;

1284  
__ªtvÆ
;

1285 
	}
}

1286 #ifde‡
__USE_BSD


1287 
	#°r£p
(
s
, 
ªje˘
Ë
	`__°r£p
 (s,Ñeje˘)

	)

1294 #ifde‡
__USE_MISC


1296 #i‡!
deföed
 
_HAVE_STRING_ARCH_°rdup
 || !deföed 
_HAVE_STRING_ARCH_°∫dup


1297 
	#__√ed_mÆloc_™d_ˇŒoc


	)

1298 
	~<°dlib.h
>

1301 #i‚de‡
_HAVE_STRING_ARCH_°rdup


1303 *
	$__°rdup
 (
__c⁄°
 *
__°rög
Ë
__THROW
 
__©åibuã_mÆloc__
;

1304 
	#__°rdup
(
s
) \

1305 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s) \

1306 ? (((
__c⁄°
 *Ë(
s
))[0] == '\0' \

1307 ? (*Ë
	`ˇŒoc
 ((
size_t
) 1, (size_t) 1) \

1308 : ({ 
size_t
 
__Àn
 = 
	`°æí
 (
s
) + 1; \

1309 *
__ªtvÆ
 = (*Ë
	`mÆloc
 (
__Àn
); \

1310 i‡(
__ªtvÆ
 !
NULL
) \

1311 
__ªtvÆ
 = (*Ë
	`mem˝y
 (__ªtvÆ, 
s
, 
__Àn
); \

1312 
__ªtvÆ
; 
	}
})) \

1313 : 
	`__°rdup
 (
s
)))

	)

1315 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


1316 
	#°rdup
(
s
Ë
	`__°rdup
 (s)

	)

1320 #i‚de‡
_HAVE_STRING_ARCH_°∫dup


1322 *
	$__°∫dup
 (
__c⁄°
 *
__°rög
, 
size_t
 
__n
)

1323 
__THROW
 
__©åibuã_mÆloc__
;

1324 
	#__°∫dup
(
s
, 
n
) \

1325 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s) \

1326 ? (((
__c⁄°
 *Ë(
s
))[0] == '\0' \

1327 ? (*Ë
	`ˇŒoc
 ((
size_t
) 1, (size_t) 1) \

1328 : ({ 
size_t
 
__Àn
 = 
	`°æí
 (
s
) + 1; \

1329 
size_t
 
__n
 = (
n
); \

1330 *
__ªtvÆ
; \

1331 i‡(
__n
 < 
__Àn
) \

1332 
__Àn
 = 
__n
 + 1; \

1333 
__ªtvÆ
 = (*Ë
	`mÆloc
 (
__Àn
); \

1334 i‡(
__ªtvÆ
 !
NULL
) \

1336 
__ªtvÆ
[
__Àn
 - 1] = '\0'; \

1337 
__ªtvÆ
 = (*Ë
	`mem˝y
 (__ªtvÆ, 
s
, \

1338 
__Àn
 - 1); \

1340 
__ªtvÆ
; 
	}
})) \

1341 : 
	`__°∫dup
 (
s
, 
n
)))

	)

1343 #ifde‡
__USE_GNU


1344 
	#°∫dup
(
s
, 
n
Ë
	`__°∫dup
 (s,Ç)

	)

1350 #i‚de‡
_FORCE_INLINES


1351 #unde‡
__STRING_INLINE


	@/usr/include/bits/string3.h

19 #i‚de‡
_STRING_H


23 
__w¨nde˛
 (
__w¨n_mem£t_zîo_Àn
,

26 #i‚de‡
__˝lu•lus


30 #unde‡
mem˝y


31 #unde‡
memmove


32 #unde‡
mem£t


33 #unde‡
°rˇt


34 #unde‡
°r˝y


35 #unde‡
°∫ˇt


36 #unde‡
°∫˝y


37 #ifde‡
__USE_GNU


38 #unde‡
memp˝y


39 #unde‡
°p˝y


41 #ifde‡
__USE_BSD


42 #unde‡
bc›y


43 #unde‡
bzîo


48 
__exã∫_Æways_ölöe
 *

49 
__NTH
 (
	$mem˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

50 
size_t
 
__Àn
))

52  
	`__buûtö___mem˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos0
 (__dest));

53 
	}
}

55 
__exã∫_Æways_ölöe
 *

56 
__NTH
 (
	$memmove
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

57 
size_t
 
__Àn
))

59  
	`__buûtö___memmove_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos0
 (__dest));

60 
	}
}

62 #ifde‡
__USE_GNU


63 
__exã∫_Æways_ölöe
 *

64 
__NTH
 (
	$memp˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

65 
size_t
 
__Àn
))

67  
	`__buûtö___memp˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos0
 (__dest));

68 
	}
}

77 
__exã∫_Æways_ölöe
 *

78 
__NTH
 (
	$mem£t
 (*
__de°
, 
__ch
, 
size_t
 
__Àn
))

80 i‡(
	`__buûtö_c⁄°™t_p
 (
__Àn
) && __len == 0)

82 
	`__w¨n_mem£t_zîo_Àn
 ();

83  
__de°
;

85  
	`__buûtö___mem£t_chk
 (
__de°
, 
__ch
, 
__Àn
, 
	`__bos0
 (__dest));

86 
	}
}

88 #ifde‡
__USE_BSD


89 
__exã∫_Æways_ölöe
 

90 
__NTH
 (
	$bc›y
 (
__c⁄°
 *
__ª°ri˘
 
__§c
, *__ª°ri˘ 
__de°
,

91 
size_t
 
__Àn
))

93 (Ë
	`__buûtö___memmove_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos0
 (__dest));

94 
	}
}

96 
__exã∫_Æways_ölöe
 

97 
__NTH
 (
	$bzîo
 (*
__de°
, 
size_t
 
__Àn
))

99 (Ë
	`__buûtö___mem£t_chk
 (
__de°
, '\0', 
__Àn
, 
	`__bos0
 (__dest));

100 
	}
}

103 
__exã∫_Æways_ölöe
 *

104 
__NTH
 (
	$°r˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
))

106  
	`__buûtö___°r˝y_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__dest));

107 
	}
}

109 #ifde‡
__USE_GNU


110 
__exã∫_Æways_ölöe
 *

111 
__NTH
 (
	$°p˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
))

113  
	`__buûtö___°p˝y_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__dest));

114 
	}
}

118 
__exã∫_Æways_ölöe
 *

119 
__NTH
 (
	$°∫˝y
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

120 
size_t
 
__Àn
))

122  
	`__buûtö___°∫˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dest));

123 
	}
}

126 *
	$__°≤˝y_chk
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
,

127 
size_t
 
__de°Àn
Ë
__THROW
;

128 *
	`__REDIRECT_NTH
 (
__°≤˝y_Æüs
, (*
__de°
,

129 
__c⁄°
 *
__§c
,

130 
size_t
 
__n
), 
°≤˝y
);

132 
__exã∫_Æways_ölöe
 *

133 
	`__NTH
 (
	$°≤˝y
 (*
__de°
, 
__c⁄°
 *
__§c
, 
size_t
 
__n
))

135 i‡(
	`__bos
 (
__de°
Ë!(
size_t
) -1

136 && (!
	`__buûtö_c⁄°™t_p
 (
__n
Ë|| __¿<
	`__bos
 (
__de°
)))

137  
	`__°≤˝y_chk
 (
__de°
, 
__§c
, 
__n
, 
	`__bos
 (__dest));

138  
	`__°≤˝y_Æüs
 (
__de°
, 
__§c
, 
__n
);

139 
	}
}

142 
__exã∫_Æways_ölöe
 *

143 
__NTH
 (
	$°rˇt
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
))

145  
	`__buûtö___°rˇt_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__dest));

146 
	}
}

149 
__exã∫_Æways_ölöe
 *

150 
__NTH
 (
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

151 
size_t
 
__Àn
))

153  
	`__buûtö___°∫ˇt_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dest));

154 
	}
}

	@/usr/include/bits/sys_errlist.h

20 #i‚de‡
_STDIO_H


26 #ifde‡ 
__USE_BSD


27 
sys_√º
;

28 
__c⁄°
 *__c⁄° 
sys_îæi°
[];

30 #ifde‡ 
__USE_GNU


31 
_sys_√º
;

32 
__c⁄°
 *__c⁄° 
_sys_îæi°
[];

	@/usr/include/bits/termios.h

21 #i‚de‡
_TERMIOS_H


25 
	tcc_t
;

26 
	t•ìd_t
;

27 
	ttcÊag_t
;

29 
	#NCCS
 32

	)

30 
	sãrmios


32 
tcÊag_t
 
	mc_iÊag
;

33 
tcÊag_t
 
	mc_oÊag
;

34 
tcÊag_t
 
	mc_cÊag
;

35 
tcÊag_t
 
	mc_lÊag
;

36 
cc_t
 
	mc_löe
;

37 
cc_t
 
	mc_cc
[
NCCS
];

38 
•ìd_t
 
	mc_i•ìd
;

39 
•ìd_t
 
	mc_o•ìd
;

40 
	#_HAVE_STRUCT_TERMIOS_C_ISPEED
 1

	)

41 
	#_HAVE_STRUCT_TERMIOS_C_OSPEED
 1

	)

45 
	#VINTR
 0

	)

46 
	#VQUIT
 1

	)

47 
	#VERASE
 2

	)

48 
	#VKILL
 3

	)

49 
	#VEOF
 4

	)

50 
	#VTIME
 5

	)

51 
	#VMIN
 6

	)

52 
	#VSWTC
 7

	)

53 
	#VSTART
 8

	)

54 
	#VSTOP
 9

	)

55 
	#VSUSP
 10

	)

56 
	#VEOL
 11

	)

57 
	#VREPRINT
 12

	)

58 
	#VDISCARD
 13

	)

59 
	#VWERASE
 14

	)

60 
	#VLNEXT
 15

	)

61 
	#VEOL2
 16

	)

64 
	#IGNBRK
 0000001

	)

65 
	#BRKINT
 0000002

	)

66 
	#IGNPAR
 0000004

	)

67 
	#PARMRK
 0000010

	)

68 
	#INPCK
 0000020

	)

69 
	#ISTRIP
 0000040

	)

70 
	#INLCR
 0000100

	)

71 
	#IGNCR
 0000200

	)

72 
	#ICRNL
 0000400

	)

73 
	#IUCLC
 0001000

	)

74 
	#IXON
 0002000

	)

75 
	#IXANY
 0004000

	)

76 
	#IXOFF
 0010000

	)

77 
	#IMAXBEL
 0020000

	)

78 
	#IUTF8
 0040000

	)

81 
	#OPOST
 0000001

	)

82 
	#OLCUC
 0000002

	)

83 
	#ONLCR
 0000004

	)

84 
	#OCRNL
 0000010

	)

85 
	#ONOCR
 0000020

	)

86 
	#ONLRET
 0000040

	)

87 
	#OFILL
 0000100

	)

88 
	#OFDEL
 0000200

	)

89 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


90 
	#NLDLY
 0000400

	)

91 
	#NL0
 0000000

	)

92 
	#NL1
 0000400

	)

93 
	#CRDLY
 0003000

	)

94 
	#CR0
 0000000

	)

95 
	#CR1
 0001000

	)

96 
	#CR2
 0002000

	)

97 
	#CR3
 0003000

	)

98 
	#TABDLY
 0014000

	)

99 
	#TAB0
 0000000

	)

100 
	#TAB1
 0004000

	)

101 
	#TAB2
 0010000

	)

102 
	#TAB3
 0014000

	)

103 
	#BSDLY
 0020000

	)

104 
	#BS0
 0000000

	)

105 
	#BS1
 0020000

	)

106 
	#FFDLY
 0100000

	)

107 
	#FF0
 0000000

	)

108 
	#FF1
 0100000

	)

111 
	#VTDLY
 0040000

	)

112 
	#VT0
 0000000

	)

113 
	#VT1
 0040000

	)

115 #ifde‡
__USE_MISC


116 
	#XTABS
 0014000

	)

120 #ifde‡
__USE_MISC


121 
	#CBAUD
 0010017

	)

123 
	#B0
 0000000

	)

124 
	#B50
 0000001

	)

125 
	#B75
 0000002

	)

126 
	#B110
 0000003

	)

127 
	#B134
 0000004

	)

128 
	#B150
 0000005

	)

129 
	#B200
 0000006

	)

130 
	#B300
 0000007

	)

131 
	#B600
 0000010

	)

132 
	#B1200
 0000011

	)

133 
	#B1800
 0000012

	)

134 
	#B2400
 0000013

	)

135 
	#B4800
 0000014

	)

136 
	#B9600
 0000015

	)

137 
	#B19200
 0000016

	)

138 
	#B38400
 0000017

	)

139 #ifde‡
__USE_MISC


140 
	#EXTA
 
B19200


	)

141 
	#EXTB
 
B38400


	)

143 
	#CSIZE
 0000060

	)

144 
	#CS5
 0000000

	)

145 
	#CS6
 0000020

	)

146 
	#CS7
 0000040

	)

147 
	#CS8
 0000060

	)

148 
	#CSTOPB
 0000100

	)

149 
	#CREAD
 0000200

	)

150 
	#PARENB
 0000400

	)

151 
	#PARODD
 0001000

	)

152 
	#HUPCL
 0002000

	)

153 
	#CLOCAL
 0004000

	)

154 #ifde‡
__USE_MISC


155 
	#CBAUDEX
 0010000

	)

157 
	#B57600
 0010001

	)

158 
	#B115200
 0010002

	)

159 
	#B230400
 0010003

	)

160 
	#B460800
 0010004

	)

161 
	#B500000
 0010005

	)

162 
	#B576000
 0010006

	)

163 
	#B921600
 0010007

	)

164 
	#B1000000
 0010010

	)

165 
	#B1152000
 0010011

	)

166 
	#B1500000
 0010012

	)

167 
	#B2000000
 0010013

	)

168 
	#B2500000
 0010014

	)

169 
	#B3000000
 0010015

	)

170 
	#B3500000
 0010016

	)

171 
	#B4000000
 0010017

	)

172 
	#__MAX_BAUD
 
B4000000


	)

173 #ifde‡
__USE_MISC


174 
	#CIBAUD
 002003600000

	)

175 
	#CMSPAR
 010000000000

	)

176 
	#CRTSCTS
 020000000000

	)

180 
	#ISIG
 0000001

	)

181 
	#ICANON
 0000002

	)

182 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


183 
	#XCASE
 0000004

	)

185 
	#ECHO
 0000010

	)

186 
	#ECHOE
 0000020

	)

187 
	#ECHOK
 0000040

	)

188 
	#ECHONL
 0000100

	)

189 
	#NOFLSH
 0000200

	)

190 
	#TOSTOP
 0000400

	)

191 #ifde‡
__USE_MISC


192 
	#ECHOCTL
 0001000

	)

193 
	#ECHOPRT
 0002000

	)

194 
	#ECHOKE
 0004000

	)

195 
	#FLUSHO
 0010000

	)

196 
	#PENDIN
 0040000

	)

198 
	#IEXTEN
 0100000

	)

201 
	#TCOOFF
 0

	)

202 
	#TCOON
 1

	)

203 
	#TCIOFF
 2

	)

204 
	#TCION
 3

	)

207 
	#TCIFLUSH
 0

	)

208 
	#TCOFLUSH
 1

	)

209 
	#TCIOFLUSH
 2

	)

212 
	#TCSANOW
 0

	)

213 
	#TCSADRAIN
 1

	)

214 
	#TCSAFLUSH
 2

	)

217 
	#_IOT_ãrmios
 \

218 
	`_IOT
 (
	`_IOTS
 (
cÊag_t
), 4, _IOTS (
cc_t
), 
NCCS
, _IOTS (
•ìd_t
), 2)

	)

	@/usr/include/bits/time.h

24 #i‚de‡
__√ed_timevÆ


25 #i‚de‡
_BITS_TIME_H


26 
	#_BITS_TIME_H
 1

	)

34 
	#CLOCKS_PER_SEC
 1000000l

	)

36 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


39 
	~<bôs/ty≥s.h
>

40 
__sysc⁄f
 ();

41 
	#CLK_TCK
 ((
__˛ock_t
Ë
	`__sysc⁄f
 (2)Ë

	)

44 #ifde‡
__USE_POSIX199309


46 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

50 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

52 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

55 
	#TIMER_ABSTIME
 1

	)

61 #ifde‡
__√ed_timevÆ


62 #unde‡
__√ed_timevÆ


63 #i‚de‡
_STRUCT_TIMEVAL


64 
	#_STRUCT_TIMEVAL
 1

	)

65 
	~<bôs/ty≥s.h
>

69 
	stimevÆ


71 
__time_t
 
	mtv_£c
;

72 
__su£c⁄ds_t
 
	mtv_u£c
;

	@/usr/include/bits/types.h

24 #i‚def 
_BITS_TYPES_H


25 
	#_BITS_TYPES_H
 1

	)

27 
	~<„©uªs.h
>

28 
	~<bôs/w‹dsize.h
>

31 
	t__u_ch¨
;

32 
	t__u_sh‹t
;

33 
	t__u_öt
;

34 
	t__u_l⁄g
;

37 sig√d 
	t__öt8_t
;

38 
	t__uöt8_t
;

39 sig√d 
	t__öt16_t
;

40 
	t__uöt16_t
;

41 sig√d 
	t__öt32_t
;

42 
	t__uöt32_t
;

43 #i‡
__WORDSIZE
 == 64

44 sig√d 
	t__öt64_t
;

45 
	t__uöt64_t
;

46 #ñi‡
deföed
 
__GLIBC_HAVE_LONG_LONG


47 
__exãnsi⁄__
 sig√d 
	t__öt64_t
;

48 
__exãnsi⁄__
 
	t__uöt64_t
;

52 #i‡
__WORDSIZE
 == 64

53 
	t__quad_t
;

54 
	t__u_quad_t
;

55 #ñi‡
deföed
 
__GLIBC_HAVE_LONG_LONG


56 
__exãnsi⁄__
 
	t__quad_t
;

57 
__exãnsi⁄__
 
	t__u_quad_t
;

61 
	m__vÆ
[2];

62 } 
	t__quad_t
;

65 
__u_l⁄g
 
	m__vÆ
[2];

66 } 
	t__u_quad_t
;

99 
	#__S16_TYPE
 

	)

100 
	#__U16_TYPE
 

	)

101 
	#__S32_TYPE
 

	)

102 
	#__U32_TYPE
 

	)

103 
	#__SLONGWORD_TYPE
 

	)

104 
	#__ULONGWORD_TYPE
 

	)

105 #i‡
__WORDSIZE
 == 32

106 
	#__SQUAD_TYPE
 
__quad_t


	)

107 
	#__UQUAD_TYPE
 
__u_quad_t


	)

108 
	#__SWORD_TYPE
 

	)

109 
	#__UWORD_TYPE
 

	)

110 
	#__SLONG32_TYPE
 

	)

111 
	#__ULONG32_TYPE
 

	)

112 
	#__S64_TYPE
 
__quad_t


	)

113 
	#__U64_TYPE
 
__u_quad_t


	)

116 
	#__STD_TYPE
 
__exãnsi⁄__
 

	)

117 #ñi‡
__WORDSIZE
 == 64

118 
	t__SQUAD_TYPE
 

	)

119 
	t__UQUAD_TYPE
 

	)

120 
	t__SWORD_TYPE
 

	)

121 
	t__UWORD_TYPE
 

	)

122 
	t__SLONG32_TYPE
 

	)

123 
	t__ULONG32_TYPE
 

	)

124 
	t__S64_TYPE
 

	)

125 
	t__U64_TYPE
 

	)

127 
	t__STD_TYPE
 

	)

131 
	~<bôs/ty≥sizes.h
>

134 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

135 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

136 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

137 
__STD_TYPE
 
__INO_T_TYPE
 
	g__öo_t
;

138 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__öo64_t
;

139 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

140 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__∆ök_t
;

141 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

142 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

143 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

144 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

145 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__˛ock_t
;

146 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__æim_t
;

147 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__æim64_t
;

148 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

149 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

150 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£c⁄ds_t
;

151 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£c⁄ds_t
;

153 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

154 
__STD_TYPE
 
__SWBLK_T_TYPE
 
	g__swblk_t
;

155 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

158 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__˛ockid_t
;

161 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__timî_t
;

164 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

169 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blk˙t_t
;

170 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blk˙t64_t
;

173 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblk˙t_t
;

174 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblk˙t64_t
;

177 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfû˙t_t
;

178 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfû˙t64_t
;

180 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

184 
__off64_t
 
	t__loff_t
;

185 
__quad_t
 *
	t__qaddr_t
;

186 *
	t__ˇddr_t
;

189 
__STD_TYPE
 
__SWORD_TYPE
 
	g__öçå_t
;

192 
__STD_TYPE
 
__U32_TYPE
 
	g__sockÀn_t
;

195 #unde‡
__STD_TYPE


	@/usr/include/bits/unistd.h

20 #i‚de‡
_UNISTD_H


24 
ssize_t
 
	$__ªad_chk
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

25 
size_t
 
__buÊí
Ë
__wur
;

26 
ssize_t
 
	`__REDIRECT
 (
__ªad_Æüs
, (
__fd
, *
__buf
,

27 
size_t
 
__nbyãs
), 
ªad
Ë
__wur
;

28 
ssize_t
 
	`__REDIRECT
 (
__ªad_chk_w¨n
,

29 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

30 
size_t
 
__buÊí
), 
__ªad_chk
)

31 
__wur
 
	`__w¨«âr
 ("read called with biggerÜengthÅhan size of "

34 
__exã∫_Æways_ölöe
 
__wur
 
ssize_t


35 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
)

37 i‡(
	`__bos0
 (
__buf
Ë!(
size_t
) -1)

39 i‡(!
	`__buûtö_c⁄°™t_p
 (
__nbyãs
))

40  
	`__ªad_chk
 (
__fd
, 
__buf
, 
__nbyãs
, 
	`__bos0
 (__buf));

42 i‡(
__nbyãs
 > 
	`__bos0
 (
__buf
))

43  
	`__ªad_chk_w¨n
 (
__fd
, 
__buf
, 
__nbyãs
, 
	`__bos0
 (__buf));

45  
	`__ªad_Æüs
 (
__fd
, 
__buf
, 
__nbyãs
);

46 
	}
}

48 #ifde‡
__USE_UNIX98


49 
ssize_t
 
	$__¥ód_chk
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

50 
__off_t
 
__off£t
, 
size_t
 
__bufsize
Ë
__wur
;

51 
ssize_t
 
	$__¥ód64_chk
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

52 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
Ë
__wur
;

53 
ssize_t
 
	`__REDIRECT
 (
__¥ód_Æüs
,

54 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

55 
__off_t
 
__off£t
), 
¥ód
Ë
__wur
;

56 
ssize_t
 
	`__REDIRECT
 (
__¥ód64_Æüs
,

57 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

58 
__off64_t
 
__off£t
), 
¥ód64
Ë
__wur
;

59 
ssize_t
 
	`__REDIRECT
 (
__¥ód_chk_w¨n
,

60 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

61 
__off_t
 
__off£t
, 
size_t
 
__bufsize
), 
__¥ód_chk
)

62 
__wur
 
	`__w¨«âr
 ("pread called with biggerÜengthÅhan size of "

64 
ssize_t
 
	`__REDIRECT
 (
__¥ód64_chk_w¨n
,

65 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

66 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
),

67 
__¥ód64_chk
)

68 
__wur
 
	`__w¨«âr
 ("pread64 called with biggerÜengthÅhan size of "

71 #i‚de‡
__USE_FILE_OFFSET64


72 
__exã∫_Æways_ölöe
 
__wur
 
ssize_t


73 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
, 
__off_t
 
__off£t
)

75 i‡(
	`__bos0
 (
__buf
Ë!(
size_t
) -1)

77 i‡(!
	`__buûtö_c⁄°™t_p
 (
__nbyãs
))

78  
	`__¥ód_chk
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
, 
	`__bos0
 (__buf));

80 i‡–
__nbyãs
 > 
	`__bos0
 (
__buf
))

81  
	`__¥ód_chk_w¨n
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
,

82 
	`__bos0
 (
__buf
));

84  
	`__¥ód_Æüs
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
);

85 
	}
}

87 
__exã∫_Æways_ölöe
 
__wur
 
ssize_t


88 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
)

90 i‡(
	`__bos0
 (
__buf
Ë!(
size_t
) -1)

92 i‡(!
	`__buûtö_c⁄°™t_p
 (
__nbyãs
))

93  
	`__¥ód64_chk
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
, 
	`__bos0
 (__buf));

95 i‡–
__nbyãs
 > 
	`__bos0
 (
__buf
))

96  
	`__¥ód64_chk_w¨n
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
,

97 
	`__bos0
 (
__buf
));

100  
	`__¥ód64_Æüs
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
);

101 
	}
}

104 #ifde‡
__USE_LARGEFILE64


105 
__exã∫_Æways_ölöe
 
__wur
 
ssize_t


106 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
)

108 i‡(
	`__bos0
 (
__buf
Ë!(
size_t
) -1)

110 i‡(!
	`__buûtö_c⁄°™t_p
 (
__nbyãs
))

111  
	`__¥ód64_chk
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
, 
	`__bos0
 (__buf));

113 i‡–
__nbyãs
 > 
	`__bos0
 (
__buf
))

114  
	`__¥ód64_chk_w¨n
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
,

115 
	`__bos0
 (
__buf
));

118  
	`__¥ód64_Æüs
 (
__fd
, 
__buf
, 
__nbyãs
, 
__off£t
);

119 
	}
}

123 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


124 
ssize_t
 
	$__ªadlök_chk
 (
__c⁄°
 *
__ª°ri˘
 
__∑th
,

125 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
,

126 
size_t
 
__buÊí
)

127 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

128 
ssize_t
 
	`__REDIRECT_NTH
 (
__ªadlök_Æüs
,

129 (
__c⁄°
 *
__ª°ri˘
 
__∑th
,

130 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
), 
ªadlök
)

131 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

132 
ssize_t
 
	`__REDIRECT_NTH
 (
__ªadlök_chk_w¨n
,

133 (
__c⁄°
 *
__ª°ri˘
 
__∑th
,

134 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
,

135 
size_t
 
__buÊí
), 
__ªadlök_chk
)

136 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
 
	`__w¨«âr
 ("readlink called with biggerÜength "

139 
__exã∫_Æways_ölöe
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
 
ssize_t


140 
	`__NTH
 (
	$ªadlök
 (
__c⁄°
 *
__ª°ri˘
 
__∑th
, *__ª°ri˘ 
__buf
,

141 
size_t
 
__Àn
))

143 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

145 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

146  
	`__ªadlök_chk
 (
__∑th
, 
__buf
, 
__Àn
, 
	`__bos
 (__buf));

148 i‡–
__Àn
 > 
	`__bos
 (
__buf
))

149  
	`__ªadlök_chk_w¨n
 (
__∑th
, 
__buf
, 
__Àn
, 
	`__bos
 (__buf));

151  
	`__ªadlök_Æüs
 (
__∑th
, 
__buf
, 
__Àn
);

152 
	}
}

155 #ifde‡
__USE_ATFILE


156 
ssize_t
 
	$__ªadlök©_chk
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__∑th
,

157 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
,

158 
size_t
 
__buÊí
)

159 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

160 
ssize_t
 
	`__REDIRECT_NTH
 (
__ªadlök©_Æüs
,

161 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__∑th
,

162 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
),

163 
ªadlök©
)

164 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

165 
ssize_t
 
	`__REDIRECT_NTH
 (
__ªadlök©_chk_w¨n
,

166 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__∑th
,

167 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
,

168 
size_t
 
__buÊí
), 
__ªadlök©_chk
)

169 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
 
	`__w¨«âr
 ("readlinkat called with bigger "

173 
__exã∫_Æways_ölöe
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
 
ssize_t


174 
	`__NTH
 (
	$ªadlök©
 (
__fd
, 
__c⁄°
 *
__ª°ri˘
 
__∑th
,

175 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
))

177 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

179 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

180  
	`__ªadlök©_chk
 (
__fd
, 
__∑th
, 
__buf
, 
__Àn
, 
	`__bos
 (__buf));

182 i‡(
__Àn
 > 
	`__bos
 (
__buf
))

183  
	`__ªadlök©_chk_w¨n
 (
__fd
, 
__∑th
, 
__buf
, 
__Àn
,

184 
	`__bos
 (
__buf
));

186  
	`__ªadlök©_Æüs
 (
__fd
, 
__∑th
, 
__buf
, 
__Àn
);

187 
	}
}

190 *
	$__gëcwd_chk
 (*
__buf
, 
size_t
 
__size
, size_à
__buÊí
)

191 
__THROW
 
__wur
;

192 *
	`__REDIRECT_NTH
 (
__gëcwd_Æüs
,

193 (*
__buf
, 
size_t
 
__size
), 
gëcwd
Ë
__wur
;

194 *
	`__REDIRECT_NTH
 (
__gëcwd_chk_w¨n
,

195 (*
__buf
, 
size_t
 
__size
, size_à
__buÊí
),

196 
__gëcwd_chk
)

197 
__wur
 
	`__w¨«âr
 ("getcwd caller with biggerÜengthÅhan size of "

200 
__exã∫_Æways_ölöe
 
__wur
 *

201 
	`__NTH
 (
	$gëcwd
 (*
__buf
, 
size_t
 
__size
))

203 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

205 i‡(!
	`__buûtö_c⁄°™t_p
 (
__size
))

206  
	`__gëcwd_chk
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

208 i‡(
__size
 > 
	`__bos
 (
__buf
))

209  
	`__gëcwd_chk_w¨n
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

211  
	`__gëcwd_Æüs
 (
__buf
, 
__size
);

212 
	}
}

214 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


215 *
	$__gëwd_chk
 (*
__buf
, 
size_t
 
buÊí
)

216 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

217 *
	`__REDIRECT_NTH
 (
__gëwd_w¨n
, (*
__buf
), 
gëwd
)

218 
	`__n⁄nuŒ
 ((1)Ë
__wur
 
	`__w¨«âr
 ("please use getcwd instead,ás getwd "

221 
__exã∫_Æways_ölöe
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
 *

222 
	`__NTH
 (
	$gëwd
 (*
__buf
))

224 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

225  
	`__gëwd_chk
 (
__buf
, 
	`__bos
 (__buf));

226  
	`__gëwd_w¨n
 (
__buf
);

227 
	}
}

230 
size_t
 
	$__c⁄f°r_chk
 (
__«me
, *
__buf
, 
size_t
 
__Àn
,

231 
size_t
 
__buÊí
Ë
__THROW
;

232 
size_t
 
	`__REDIRECT_NTH
 (
__c⁄f°r_Æüs
, (
__«me
, *
__buf
,

233 
size_t
 
__Àn
), 
c⁄f°r
);

234 
size_t
 
	`__REDIRECT_NTH
 (
__c⁄f°r_chk_w¨n
,

235 (
__«me
, *
__buf
, 
size_t
 
__Àn
,

236 
size_t
 
__buÊí
), 
__c⁄f°r_chk
)

237 
	`__w¨«âr
 ("confstr called with biggerÜengthÅhan size of destination "

240 
__exã∫_Æways_ölöe
 
size_t


241 
	`__NTH
 (
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
))

243 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

245 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

246  
	`__c⁄f°r_chk
 (
__«me
, 
__buf
, 
__Àn
, 
	`__bos
 (__buf));

248 i‡(
	`__bos
 (
__buf
Ë< 
__Àn
)

249  
	`__c⁄f°r_chk_w¨n
 (
__«me
, 
__buf
, 
__Àn
, 
	`__bos
 (__buf));

251  
	`__c⁄f°r_Æüs
 (
__«me
, 
__buf
, 
__Àn
);

252 
	}
}

255 
	$__gëgroups_chk
 (
__size
, 
__gid_t
 
__li°
[], 
size_t
 
__li°Àn
)

256 
__THROW
 
__wur
;

257 
	`__REDIRECT_NTH
 (
__gëgroups_Æüs
, (
__size
, 
__gid_t
 
__li°
[]),

258 
gëgroups
Ë
__wur
;

259 
	`__REDIRECT_NTH
 (
__gëgroups_chk_w¨n
,

260 (
__size
, 
__gid_t
 
__li°
[], 
size_t
 
__li°Àn
),

261 
__gëgroups_chk
)

262 
__wur
 
	`__w¨«âr
 ("getgroups called with bigger group countÅhan what "

265 
__exã∫_Æways_ölöe
 

266 
	`__NTH
 (
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]))

268 i‡(
	`__bos
 (
__li°
Ë!(
size_t
) -1)

270 i‡(!
	`__buûtö_c⁄°™t_p
 (
__size
))

271  
	`__gëgroups_chk
 (
__size
, 
__li°
, 
	`__bos
 (__list));

273 i‡(
__size
 *  (
__gid_t
Ë> 
	`__bos
 (
__li°
))

274  
	`__gëgroups_chk_w¨n
 (
__size
, 
__li°
, 
	`__bos
 (__list));

276  
	`__gëgroups_Æüs
 (
__size
, 
__li°
);

277 
	}
}

280 
	$__ây«me_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
,

281 
size_t
 
__ƒól
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

282 
	`__REDIRECT_NTH
 (
__ây«me_r_Æüs
, (
__fd
, *
__buf
,

283 
size_t
 
__buÊí
), 
ây«me_r
)

284 
	`__n⁄nuŒ
 ((2));

285 
	`__REDIRECT_NTH
 (
__ây«me_r_chk_w¨n
,

286 (
__fd
, *
__buf
, 
size_t
 
__buÊí
,

287 
size_t
 
__ƒól
), 
__ây«me_r_chk
)

288 
	`__n⁄nuŒ
 ((2)Ë
	`__w¨«âr
 ("ttyname_r called with bigger buflenÅhan "

291 
__exã∫_Æways_ölöe
 

292 
	`__NTH
 (
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
))

294 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

296 i‡(!
	`__buûtö_c⁄°™t_p
 (
__buÊí
))

297  
	`__ây«me_r_chk
 (
__fd
, 
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

299 i‡(
__buÊí
 > 
	`__bos
 (
__buf
))

300  
	`__ây«me_r_chk_w¨n
 (
__fd
, 
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

302  
	`__ây«me_r_Æüs
 (
__fd
, 
__buf
, 
__buÊí
);

303 
	}
}

306 #i‡
deföed
 
__USE_REENTRANT
 || deföed 
__USE_POSIX199506


307 
	$__gëlogö_r_chk
 (*
__buf
, 
size_t
 
__buÊí
, size_à
__ƒól
)

308 
	`__n⁄nuŒ
 ((1));

309 
	`__REDIRECT
 (
__gëlogö_r_Æüs
, (*
__buf
, 
size_t
 
__buÊí
),

310 
gëlogö_r
Ë
	`__n⁄nuŒ
 ((1));

311 
	`__REDIRECT
 (
__gëlogö_r_chk_w¨n
,

312 (*
__buf
, 
size_t
 
__buÊí
, size_à
__ƒól
),

313 
__gëlogö_r_chk
)

314 
	`__n⁄nuŒ
 ((1)Ë
	`__w¨«âr
 ("getlogin_r called with bigger buflenÅhan "

317 
__exã∫_Æways_ölöe
 

318 
	$gëlogö_r
 (*
__buf
, 
size_t
 
__buÊí
)

320 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

322 i‡(!
	`__buûtö_c⁄°™t_p
 (
__buÊí
))

323  
	`__gëlogö_r_chk
 (
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

325 i‡(
__buÊí
 > 
	`__bos
 (
__buf
))

326  
	`__gëlogö_r_chk_w¨n
 (
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

328  
	`__gëlogö_r_Æüs
 (
__buf
, 
__buÊí
);

329 
	}
}

333 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_UNIX98


334 
	$__gëho°«me_chk
 (*
__buf
, 
size_t
 
__buÊí
, size_à
__ƒól
)

335 
__THROW
 
	`__n⁄nuŒ
 ((1));

336 
	`__REDIRECT_NTH
 (
__gëho°«me_Æüs
, (*
__buf
, 
size_t
 
__buÊí
),

337 
gëho°«me
Ë
	`__n⁄nuŒ
 ((1));

338 
	`__REDIRECT_NTH
 (
__gëho°«me_chk_w¨n
,

339 (*
__buf
, 
size_t
 
__buÊí
, size_à
__ƒól
),

340 
__gëho°«me_chk
)

341 
	`__n⁄nuŒ
 ((1)Ë
	`__w¨«âr
 ("gethostname called with bigger buflenÅhan "

344 
__exã∫_Æways_ölöe
 

345 
	`__NTH
 (
	$gëho°«me
 (*
__buf
, 
size_t
 
__buÊí
))

347 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

349 i‡(!
	`__buûtö_c⁄°™t_p
 (
__buÊí
))

350  
	`__gëho°«me_chk
 (
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

352 i‡(
__buÊí
 > 
	`__bos
 (
__buf
))

353  
	`__gëho°«me_chk_w¨n
 (
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

355  
	`__gëho°«me_Æüs
 (
__buf
, 
__buÊí
);

356 
	}
}

360 #i‡
deföed
 
__USE_BSD
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_UNIX98
)

361 
	$__gëdomaö«me_chk
 (*
__buf
, 
size_t
 
__buÊí
, size_à
__ƒól
)

362 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

363 
	`__REDIRECT_NTH
 (
__gëdomaö«me_Æüs
, (*
__buf
,

364 
size_t
 
__buÊí
),

365 
gëdomaö«me
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

366 
	`__REDIRECT_NTH
 (
__gëdomaö«me_chk_w¨n
,

367 (*
__buf
, 
size_t
 
__buÊí
, size_à
__ƒól
),

368 
__gëdomaö«me_chk
)

369 
	`__n⁄nuŒ
 ((1)Ë
__wur
 
	`__w¨«âr
 ("getdomainname called with bigger "

373 
__exã∫_Æways_ölöe
 

374 
	`__NTH
 (
	$gëdomaö«me
 (*
__buf
, 
size_t
 
__buÊí
))

376 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

378 i‡(!
	`__buûtö_c⁄°™t_p
 (
__buÊí
))

379  
	`__gëdomaö«me_chk
 (
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

381 i‡(
__buÊí
 > 
	`__bos
 (
__buf
))

382  
	`__gëdomaö«me_chk_w¨n
 (
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

384  
	`__gëdomaö«me_Æüs
 (
__buf
, 
__buÊí
);

385 
	}
}

	@/usr/include/bits/waitflags.h

20 #i‡!
deföed
 
_SYS_WAIT_H
 && !deföed 
_STDLIB_H


26 
	#WNOHANG
 1

	)

27 
	#WUNTRACED
 2

	)

30 
	#WSTOPPED
 2

	)

31 
	#WEXITED
 4

	)

32 
	#WCONTINUED
 8

	)

33 
	#WNOWAIT
 0x01000000

	)

35 
	#__WNOTHREAD
 0x20000000

	)

37 
	#__WALL
 0x40000000

	)

38 
	#__WCLONE
 0x80000000

	)

	@/usr/include/bits/waitstatus.h

20 #i‡!
deföed
 
_SYS_WAIT_H
 && !deföed 
_STDLIB_H


29 
	#__WEXITSTATUS
(
°©us
Ë(((°©usË& 0xff00Ë>> 8)

	)

32 
	#__WTERMSIG
(
°©us
Ë((°©usË& 0x7f)

	)

35 
	#__WSTOPSIG
(
°©us
Ë
	`__WEXITSTATUS
(°©us)

	)

38 
	#__WIFEXITED
(
°©us
Ë(
	`__WTERMSIG
(°©usË=0)

	)

41 
	#__WIFSIGNALED
(
°©us
) \

42 (((sig√d Ë(((
°©us
Ë& 0x7fË+ 1Ë>> 1Ë> 0)

	)

45 
	#__WIFSTOPPED
(
°©us
Ë(((°©usË& 0xffË=0x7f)

	)

49 #ifde‡
WCONTINUED


50 
	#__WIFCONTINUED
(
°©us
Ë((°©usË=
__W_CONTINUED
)

	)

54 
	#__WCOREDUMP
(
°©us
Ë((°©usË& 
__WCOREFLAG
)

	)

57 
	#__W_EXITCODE
(
ªt
, 
sig
Ë(‘ëË<< 8 | (sig))

	)

58 
	#__W_STOPCODE
(
sig
Ë((sigË<< 8 | 0x7f)

	)

59 
	#__W_CONTINUED
 0xffff

	)

60 
	#__WCOREFLAG
 0x80

	)

63 #ifdef 
__USE_BSD


65 
	~<ídün.h
>

67 
	uwaô


69 
	mw_°©us
;

72 #if 
__BYTE_ORDER
 =
__LITTLE_ENDIAN


73 
	m__w_ãrmsig
:7;

74 
	m__w_c‹edump
:1;

75 
	m__w_ªtcode
:8;

78 #if 
__BYTE_ORDER
 =
__BIG_ENDIAN


80 
	m__w_ªtcode
:8;

81 
	m__w_c‹edump
:1;

82 
	m__w_ãrmsig
:7;

84 } 
	m__waô_ãrmö©ed
;

87 #if 
__BYTE_ORDER
 =
__LITTLE_ENDIAN


88 
	m__w_°›vÆ
:8;

89 
	m__w_°›sig
:8;

92 #if 
__BYTE_ORDER
 =
__BIG_ENDIAN


94 
	m__w_°›sig
:8;

95 
	m__w_°›vÆ
:8;

97 } 
	m__waô_°›≥d
;

100 
	#w_ãrmsig
 
__waô_ãrmö©ed
.
__w_ãrmsig


	)

101 
	#w_c‹edump
 
__waô_ãrmö©ed
.
__w_c‹edump


	)

102 
	#w_ªtcode
 
__waô_ãrmö©ed
.
__w_ªtcode


	)

103 
	#w_°›sig
 
__waô_°›≥d
.
__w_°›sig


	)

104 
	#w_°›vÆ
 
__waô_°›≥d
.
__w_°›vÆ


	)

	@/usr/include/endian.h

19 #i‚def 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<„©uªs.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<bôs/ídün.h
>

41 #i‚de‡
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

54 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

	@/usr/include/features.h

19 #i‚def 
_FEATURES_H


20 
	#_FEATURES_H
 1

	)

93 #unde‡
__USE_ISOC99


94 #unde‡
__USE_ISOC95


95 #unde‡
__USE_POSIX


96 #unde‡
__USE_POSIX2


97 #unde‡
__USE_POSIX199309


98 #unde‡
__USE_POSIX199506


99 #unde‡
__USE_XOPEN


100 #unde‡
__USE_XOPEN_EXTENDED


101 #unde‡
__USE_UNIX98


102 #unde‡
__USE_XOPEN2K


103 #unde‡
__USE_LARGEFILE


104 #unde‡
__USE_LARGEFILE64


105 #unde‡
__USE_FILE_OFFSET64


106 #unde‡
__USE_BSD


107 #unde‡
__USE_SVID


108 #unde‡
__USE_MISC


109 #unde‡
__USE_ATFILE


110 #unde‡
__USE_GNU


111 #unde‡
__USE_REENTRANT


112 #unde‡
__USE_FORTIFY_LEVEL


113 #unde‡
__FAVOR_BSD


114 #unde‡
__KERNEL_STRICT_NAMES


118 #i‚de‡
_LOOSE_KERNEL_NAMES


119 
	#__KERNEL_STRICT_NAMES


	)

123 
	#__USE_ANSI
 1

	)

132 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


133 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

134 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

136 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

141 #i‡
deföed
 
_BSD_SOURCE
 && \

142 !(
deföed
 
	g_POSIX_SOURCE
 || deföed 
	g_POSIX_C_SOURCE
 || \

143 
deföed
 
	g_XOPEN_SOURCE
 || deföed 
	g_XOPEN_SOURCE_EXTENDED
 || \

144 
deföed
 
	g_GNU_SOURCE
 || deföed 
	g_SVID_SOURCE
)

145 
	#__FAVOR_BSD
 1

	)

149 #ifde‡
_GNU_SOURCE


150 #unde‡
_ISOC99_SOURCE


151 
	#_ISOC99_SOURCE
 1

	)

152 #unde‡
_POSIX_SOURCE


153 
	#_POSIX_SOURCE
 1

	)

154 #unde‡
_POSIX_C_SOURCE


155 
	#_POSIX_C_SOURCE
 200112L

	)

156 #unde‡
_XOPEN_SOURCE


157 
	#_XOPEN_SOURCE
 600

	)

158 #unde‡
_XOPEN_SOURCE_EXTENDED


159 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

160 #unde‡
_LARGEFILE64_SOURCE


161 
	#_LARGEFILE64_SOURCE
 1

	)

162 #unde‡
_BSD_SOURCE


163 
	#_BSD_SOURCE
 1

	)

164 #unde‡
_SVID_SOURCE


165 
	#_SVID_SOURCE
 1

	)

166 #unde‡
_ATFILE_SOURCE


167 
	#_ATFILE_SOURCE
 1

	)

172 #i‡(!
deföed
 
__STRICT_ANSI__
 && !deföed 
_ISOC99_SOURCE
 && \

173 !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 && \

174 !
deföed
 
	g_XOPEN_SOURCE
 && !deföed 
	g_XOPEN_SOURCE_EXTENDED
 && \

175 !
deföed
 
	g_BSD_SOURCE
 && !deföed 
	g_SVID_SOURCE
)

176 
	#_BSD_SOURCE
 1

	)

177 
	#_SVID_SOURCE
 1

	)

184 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC9X_SOURCE
 \

185 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

186 
	#__USE_ISOC99
 1

	)

190 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC9X_SOURCE
 \

191 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

192 
	#__USE_ISOC95
 1

	)

197 #i‡((!
deföed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

198 !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

199 
	#_POSIX_SOURCE
 1

	)

200 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

201 
	#_POSIX_C_SOURCE
 2

	)

202 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

203 
	#_POSIX_C_SOURCE
 199506L

	)

205 
	#_POSIX_C_SOURCE
 200112L

	)

209 #i‡
deföed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || deföed 
_XOPEN_SOURCE


210 
	#__USE_POSIX
 1

	)

213 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


214 
	#__USE_POSIX2
 1

	)

217 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199309L

218 
	#__USE_POSIX199309
 1

	)

221 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199506L

222 
	#__USE_POSIX199506
 1

	)

225 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200112L

226 
	#__USE_XOPEN2K
 1

	)

229 #ifdef 
_XOPEN_SOURCE


230 
	#__USE_XOPEN
 1

	)

231 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

232 
	#__USE_XOPEN_EXTENDED
 1

	)

233 
	#__USE_UNIX98
 1

	)

234 #unde‡
_LARGEFILE_SOURCE


235 
	#_LARGEFILE_SOURCE
 1

	)

236 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

237 
	#__USE_XOPEN2K
 1

	)

238 #unde‡
__USE_ISOC99


239 
	#__USE_ISOC99
 1

	)

242 #ifde‡
_XOPEN_SOURCE_EXTENDED


243 
	#__USE_XOPEN_EXTENDED
 1

	)

248 #ifde‡
_LARGEFILE_SOURCE


249 
	#__USE_LARGEFILE
 1

	)

252 #ifde‡
_LARGEFILE64_SOURCE


253 
	#__USE_LARGEFILE64
 1

	)

256 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

257 
	#__USE_FILE_OFFSET64
 1

	)

260 #i‡
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE


261 
	#__USE_MISC
 1

	)

264 #ifdef 
_BSD_SOURCE


265 
	#__USE_BSD
 1

	)

268 #ifdef 
_SVID_SOURCE


269 
	#__USE_SVID
 1

	)

272 #ifdef 
_ATFILE_SOURCE


273 
	#__USE_ATFILE
 1

	)

276 #ifdef 
_GNU_SOURCE


277 
	#__USE_GNU
 1

	)

280 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


281 
	#__USE_REENTRANT
 1

	)

284 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

285 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

286 #i‡
_FORTIFY_SOURCE
 > 1

287 
	#__USE_FORTIFY_LEVEL
 2

	)

289 
	#__USE_FORTIFY_LEVEL
 1

	)

292 
	#__USE_FORTIFY_LEVEL
 0

	)

296 
	#__STDC_IEC_559__
 1

	)

297 
	#__STDC_IEC_559_COMPLEX__
 1

	)

300 
	#__STDC_ISO_10646__
 200009L

	)

308 #unde‡
__GNU_LIBRARY__


309 
	#__GNU_LIBRARY__
 6

	)

313 
	#__GLIBC__
 2

	)

314 
	#__GLIBC_MINOR__
 8

	)

316 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

317 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

320 #i‡
deföed
 
__GNUC__
 \

321 || (
deföed
 
	g__PGI
 && deföed 
	g__i386__
 ) \

322 || (
deföed
 
	g__INTEL_COMPILER
 && (deföed 
	g__i386__
 || deföed 
	g__ü64__
)) \

323 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

324 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

328 #i‚de‡
__ASSEMBLER__


329 #i‚de‡
_SYS_CDEFS_H


330 
	~<sys/cdefs.h
>

335 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


336 
	#__USE_LARGEFILE
 1

	)

337 
	#__USE_LARGEFILE64
 1

	)

343 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

344 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

345 && 
deföed
 
	g__exã∫_ölöe


346 
	#__USE_EXTERN_INLINES
 1

	)

354 
	~<gnu/°ubs.h
>

	@/usr/include/getopt.h

21 #i‚de‡
_GETOPT_H


23 #i‚de‡
__√ed_gë›t


24 
	#_GETOPT_H
 1

	)

34 #i‡!
deföed
 
__GNU_LIBRARY__


35 
	~<˘y≥.h
>

38 #i‚de‡
__THROW


39 #i‚de‡
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë(0)

	)

42 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__˝lu•lus


59 *
›èrg
;

73 
›töd
;

78 
›ãº
;

82 
›t›t
;

84 #i‚de‡
__√ed_gë›t


106 
	s›ti⁄


108 c⁄° *
	g«me
;

111 
	ghas_¨g
;

112 *
	gÊag
;

113 
	gvÆ
;

118 
	#no_¨gumít
 0

	)

119 
	#ªquúed_¨gumít
 1

	)

120 
	#›ti⁄Æ_¨gumít
 2

	)

148 #ifde‡
__GNU_LIBRARY__


152 
gë›t
 (
___¨gc
, *c⁄° *
___¨gv
, c⁄° *
__sh‹t›ts
)

153 
__THROW
;

155 
gë›t
 ();

158 #i‚de‡
__√ed_gë›t


159 
gë›t_l⁄g
 (
___¨gc
, *c⁄° *
___¨gv
,

160 c⁄° *
__sh‹t›ts
,

161 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

162 
__THROW
;

163 
gë›t_l⁄g_⁄ly
 (
___¨gc
, *c⁄° *
___¨gv
,

164 c⁄° *
__sh‹t›ts
,

165 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

166 
__THROW
;

170 #ifdef 
__˝lu•lus


175 #unde‡
__√ed_gë›t


	@/usr/include/libio.h

29 #i‚de‡
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_c⁄fig.h
>

34 
	#_IO_pos_t
 
_G_Âos_t


	)

35 
	#_IO_Âos_t
 
_G_Âos_t


	)

36 
	#_IO_Âos64_t
 
_G_Âos64_t


	)

37 
	#_IO_size_t
 
_G_size_t


	)

38 
	#_IO_ssize_t
 
_G_ssize_t


	)

39 
	#_IO_off_t
 
_G_off_t


	)

40 
	#_IO_off64_t
 
_G_off64_t


	)

41 
	#_IO_pid_t
 
_G_pid_t


	)

42 
	#_IO_uid_t
 
_G_uid_t


	)

43 
	#_IO_ic⁄v_t
 
_G_ic⁄v_t


	)

44 
	#_IO_HAVE_SYS_WAIT
 
_G_HAVE_SYS_WAIT


	)

45 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

46 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

47 
	#_IO_va_li°
 
_G_va_li°


	)

48 
	#_IO_wöt_t
 
_G_wöt_t


	)

50 #ifde‡
_G_NEED_STDARG_H


52 
	#__√ed___va_li°


	)

53 
	~<°d¨g.h
>

54 #ifde‡
__GNUC_VA_LIST


55 #unde‡
_IO_va_li°


56 
	#_IO_va_li°
 
__gnuc_va_li°


	)

60 #i‚de‡
__P


61 #i‡
_G_HAVE_SYS_CDEFS


62 
	~<sys/cdefs.h
>

64 #ifde‡
__STDC__


65 
	#__P
(
p
Ë
	)
p

66 
	#__PMT
(
p
Ë
	)
p

68 
	#__P
(
p
Ë()

	)

69 
	#__PMT
(
p
Ë()

	)

75 #i‚de‡
_PARAMS


76 
	#_PARAMS
(
¥Ÿos
Ë
	`__P
’rŸos)

	)

79 #i‚de‡
__STDC__


81 c⁄°

	)

84 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

85 #i‚de‡
_G_HAVE_PRINTF_FP


86 
	#_IO_USE_DTOA
 1

	)

89 #i‚de‡
EOF


90 
	#EOF
 (-1)

	)

92 #i‚de‡
NULL


93 #i‡
deföed
 
__GNUG__
 && \

94 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

95 
	#NULL
 (
__nuŒ
)

	)

97 #i‡!
deföed
(
__˝lu•lus
)

98 
	#NULL
 ((*)0)

	)

100 
	#NULL
 (0)

	)

105 
	#_IOS_INPUT
 1

	)

106 
	#_IOS_OUTPUT
 2

	)

107 
	#_IOS_ATEND
 4

	)

108 
	#_IOS_APPEND
 8

	)

109 
	#_IOS_TRUNC
 16

	)

110 
	#_IOS_NOCREATE
 32

	)

111 
	#_IOS_NOREPLACE
 64

	)

112 
	#_IOS_BIN
 128

	)

120 
	#_IO_MAGIC
 0xFBAD0000

	)

121 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

122 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

123 
	#_IO_USER_BUF
 1

	)

124 
	#_IO_UNBUFFERED
 2

	)

125 
	#_IO_NO_READS
 4

	)

126 
	#_IO_NO_WRITES
 8

	)

127 
	#_IO_EOF_SEEN
 0x10

	)

128 
	#_IO_ERR_SEEN
 0x20

	)

129 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

130 
	#_IO_LINKED
 0x80

	)

131 
	#_IO_IN_BACKUP
 0x100

	)

132 
	#_IO_LINE_BUF
 0x200

	)

133 
	#_IO_TIED_PUT_GET
 0x400

	)

134 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

135 
	#_IO_IS_APPENDING
 0x1000

	)

136 
	#_IO_IS_FILEBUF
 0x2000

	)

137 
	#_IO_BAD_SEEN
 0x4000

	)

138 
	#_IO_USER_LOCK
 0x8000

	)

140 
	#_IO_FLAGS2_MMAP
 1

	)

141 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

142 #ifde‡
_LIBC


143 
	#_IO_FLAGS2_FORTIFY
 4

	)

145 
	#_IO_FLAGS2_USER_WBUF
 8

	)

146 #ifde‡
_LIBC


147 
	#_IO_FLAGS2_SCANF_STD
 16

	)

151 
	#_IO_SKIPWS
 01

	)

152 
	#_IO_LEFT
 02

	)

153 
	#_IO_RIGHT
 04

	)

154 
	#_IO_INTERNAL
 010

	)

155 
	#_IO_DEC
 020

	)

156 
	#_IO_OCT
 040

	)

157 
	#_IO_HEX
 0100

	)

158 
	#_IO_SHOWBASE
 0200

	)

159 
	#_IO_SHOWPOINT
 0400

	)

160 
	#_IO_UPPERCASE
 01000

	)

161 
	#_IO_SHOWPOS
 02000

	)

162 
	#_IO_SCIENTIFIC
 04000

	)

163 
	#_IO_FIXED
 010000

	)

164 
	#_IO_UNITBUF
 020000

	)

165 
	#_IO_STDIO
 040000

	)

166 
	#_IO_DONT_CLOSE
 0100000

	)

167 
	#_IO_BOOLALPHA
 0200000

	)

170 
_IO_jump_t
; 
	g_IO_FILE
;

173 #ifde‡
_IO_MTSAFE_IO


174 #i‡
deföed
 
__GLIBC__
 && __GLIBC__ >= 2

175 
	~<bôs/°dio-lock.h
>

180 
	t_IO_lock_t
;

186 
	s_IO_m¨kî
 {

187 
_IO_m¨kî
 *
	m_√xt
;

188 
_IO_FILE
 *
	m_sbuf
;

192 
	m_pos
;

194 
£t_°ªampos
(
°ªampos
 
•
Ë{ 
	m_•os
 = sp; }

195 
£t_off£t
(
off£t
Ë{ 
	m_pos
 = off£t; 
	m_•os
 = (
°ªampos
)(-2); }

196 
	mpublic
:

197 
°ªamm¨kî
(
°ªambuf
 *
sb
);

198 ~
°ªamm¨kî
();

199 
ßvög
(Ë{  
	m_•os
 == -2; }

200 
dñè
(
°ªamm¨kî
&);

201 
dñè
();

206 
	e__codecvt_ªsu…


208 
	m__codecvt_ok
,

209 
	m__codecvt_∑πül
,

210 
	m__codecvt_îr‹
,

211 
	m__codecvt_noc⁄v


214 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


217 
	s_IO_codecvt


219 (*
	m__codecvt_de°r
Ë(
	m_IO_codecvt
 *);

220 
__codecvt_ªsu…
 (*
__codecvt_do_out
Ë(
	m_IO_codecvt
 *,

221 
	m__mb°©e_t
 *,

222 c⁄° 
	mwch¨_t
 *,

223 c⁄° 
	mwch¨_t
 *,

224 c⁄° 
	mwch¨_t
 **, *,

226 
__codecvt_ªsu…
 (*
__codecvt_do_unshi·
Ë(
	m_IO_codecvt
 *,

227 
	m__mb°©e_t
 *, *,

229 
__codecvt_ªsu…
 (*
__codecvt_do_ö
Ë(
	m_IO_codecvt
 *,

230 
	m__mb°©e_t
 *,

232 c⁄° **, 
	mwch¨_t
 *,

233 
	mwch¨_t
 *, wchar_t **);

234 (*
	m__codecvt_do_ícodög
Ë(
	m_IO_codecvt
 *);

235 (*
	m__codecvt_do_Æways_noc⁄v
Ë(
	m_IO_codecvt
 *);

236 (*
	m__codecvt_do_Àngth
Ë(
	m_IO_codecvt
 *, 
	m__mb°©e_t
 *,

237 c⁄° *, c⁄° *, 
	m_IO_size_t
);

238 (*
	m__codecvt_do_max_Àngth
Ë(
	m_IO_codecvt
 *);

240 
_IO_ic⁄v_t
 
	m__cd_ö
;

241 
_IO_ic⁄v_t
 
	m__cd_out
;

245 
	s_IO_wide_d©a


247 
wch¨_t
 *
	m_IO_ªad_±r
;

248 
wch¨_t
 *
	m_IO_ªad_íd
;

249 
wch¨_t
 *
	m_IO_ªad_ba£
;

250 
wch¨_t
 *
	m_IO_wrôe_ba£
;

251 
wch¨_t
 *
	m_IO_wrôe_±r
;

252 
wch¨_t
 *
	m_IO_wrôe_íd
;

253 
wch¨_t
 *
	m_IO_buf_ba£
;

254 
wch¨_t
 *
	m_IO_buf_íd
;

256 
wch¨_t
 *
	m_IO_ßve_ba£
;

257 
wch¨_t
 *
	m_IO_backup_ba£
;

259 
wch¨_t
 *
	m_IO_ßve_íd
;

261 
__mb°©e_t
 
	m_IO_°©e
;

262 
__mb°©e_t
 
	m_IO_œ°_°©e
;

263 
_IO_codecvt
 
	m_codecvt
;

265 
wch¨_t
 
	m_sh‹tbuf
[1];

267 c⁄° 
_IO_jump_t
 *
	m_wide_vèbÀ
;

271 
	s_IO_FILE
 {

272 
	m_Êags
;

273 
	#_IO_fûe_Êags
 
_Êags


	)

277 * 
	m_IO_ªad_±r
;

278 * 
	m_IO_ªad_íd
;

279 * 
	m_IO_ªad_ba£
;

280 * 
	m_IO_wrôe_ba£
;

281 * 
	m_IO_wrôe_±r
;

282 * 
	m_IO_wrôe_íd
;

283 * 
	m_IO_buf_ba£
;

284 * 
	m_IO_buf_íd
;

286 *
	m_IO_ßve_ba£
;

287 *
	m_IO_backup_ba£
;

288 *
	m_IO_ßve_íd
;

290 
_IO_m¨kî
 *
	m_m¨kîs
;

292 
_IO_FILE
 *
	m_chaö
;

294 
	m_fûío
;

296 
	m_blksize
;

298 
	m_Êags2
;

300 
_IO_off_t
 
	m_ﬁd_off£t
;

302 
	#__HAVE_COLUMN


	)

304 
	m_cur_cﬁumn
;

305 sig√d 
	m_vèbÀ_off£t
;

306 
	m_sh‹tbuf
[1];

310 
_IO_lock_t
 *
	m_lock
;

311 #ifde‡
_IO_USE_OLD_IO_FILE


314 
	s_IO_FILE_com∂ëe


316 
_IO_FILE
 
	m_fûe
;

318 #i‡
deföed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

319 
_IO_off64_t
 
	m_off£t
;

320 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


322 
_IO_codecvt
 *
	m_codecvt
;

323 
_IO_wide_d©a
 *
	m_wide_d©a
;

324 
_IO_FILE
 *
	m_‰ìªs_li°
;

325 *
	m_‰ìªs_buf
;

326 
size_t
 
	m_‰ìªs_size
;

328 *
	m__∑d1
;

329 *
	m__∑d2
;

330 *
	m__∑d3
;

331 *
	m__∑d4
;

332 
size_t
 
	m__∑d5
;

334 
	m_mode
;

336 
	m_unu£d2
[15 *  (Ë- 4 *  (*Ë-  (
size_t
)];

340 #i‚de‡
__˝lu•lus


341 
_IO_FILE
 
	t_IO_FILE
;

344 
	g_IO_FILE_∂us
;

346 
_IO_FILE_∂us
 
_IO_2_1_°dö_
;

347 
_IO_FILE_∂us
 
_IO_2_1_°dout_
;

348 
_IO_FILE_∂us
 
_IO_2_1_°dîr_
;

349 #i‚de‡
_LIBC


350 
	#_IO_°dö
 ((
_IO_FILE
*)(&
_IO_2_1_°dö_
))

	)

351 
	#_IO_°dout
 ((
_IO_FILE
*)(&
_IO_2_1_°dout_
))

	)

352 
	#_IO_°dîr
 ((
_IO_FILE
*)(&
_IO_2_1_°dîr_
))

	)

354 
_IO_FILE
 *
_IO_°dö
 
©åibuã_hiddí
;

355 
_IO_FILE
 *
_IO_°dout
 
©åibuã_hiddí
;

356 
_IO_FILE
 *
_IO_°dîr
 
©åibuã_hiddí
;

364 
__ssize_t
 
	t__io_ªad_‚
 (*
	t__cookõ
, *
	t__buf
, 
	tsize_t
 
	t__nbyãs
);

372 
__ssize_t
 
	t__io_wrôe_‚
 (*
	t__cookõ
, 
	t__c⁄°
 *
	t__buf
,

373 
	tsize_t
 
	t__n
);

381 
	t__io_£ek_‚
 (*
	t__cookõ
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

384 
	t__io_˛o£_‚
 (*
	t__cookõ
);

387 #ifde‡
_GNU_SOURCE


389 
__io_ªad_‚
 
	tcookõ_ªad_fun˘i⁄_t
;

390 
__io_wrôe_‚
 
	tcookõ_wrôe_fun˘i⁄_t
;

391 
__io_£ek_‚
 
	tcookõ_£ek_fun˘i⁄_t
;

392 
__io_˛o£_‚
 
	tcookõ_˛o£_fun˘i⁄_t
;

397 
__io_ªad_‚
 *
	mªad
;

398 
__io_wrôe_‚
 *
	mwrôe
;

399 
__io_£ek_‚
 *
	m£ek
;

400 
__io_˛o£_‚
 *
	m˛o£
;

401 } 
	t_IO_cookõ_io_fun˘i⁄s_t
;

402 
_IO_cookõ_io_fun˘i⁄s_t
 
	tcookõ_io_fun˘i⁄s_t
;

404 
	g_IO_cookõ_fûe
;

407 
_IO_cookõ_öô
 (
_IO_cookõ_fûe
 *
__cfûe
, 
__ªad_wrôe
,

408 *
__cookõ
, 
_IO_cookõ_io_fun˘i⁄s_t
 
__‚s
);

412 #ifde‡
__˝lu•lus


416 
__undîÊow
 (
_IO_FILE
 *);

417 
__uÊow
 (
_IO_FILE
 *);

418 
__ovîÊow
 (
_IO_FILE
 *, );

419 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


420 
_IO_wöt_t
 
__wundîÊow
 (
_IO_FILE
 *);

421 
_IO_wöt_t
 
__wuÊow
 (
_IO_FILE
 *);

422 
_IO_wöt_t
 
__wovîÊow
 (
_IO_FILE
 *, _IO_wint_t);

425 #i‡ 
__GNUC__
 >= 3

426 
	#_IO_BE
(
ex¥
, 
ªs
Ë
	`__buûtö_ex≥˘
 (”x¥),Ñes)

	)

428 
	#_IO_BE
(
ex¥
, 
ªs
Ë”x¥)

	)

431 
	#_IO_gëc_u∆ocked
(
_Â
) \

432 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

433 ? 
	`__uÊow
 (
_Â
Ë: *(*Ë(_Â)->
_IO_ªad_±r
++)

	)

434 
	#_IO_≥ekc_u∆ocked
(
_Â
) \

435 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

436 && 
	`__undîÊow
 (
_Â
Ë=
EOF
 ? EOF \

437 : *(*Ë(
_Â
)->
_IO_ªad_±r
)

	)

438 
	#_IO_putc_u∆ocked
(
_ch
, 
_Â
) \

439 (
	`_IO_BE
 ((
_Â
)->
_IO_wrôe_±r
 >(_Â)->
_IO_wrôe_íd
, 0) \

440 ? 
	`__ovîÊow
 (
_Â
, (Ë(
_ch
)) \

441 : (Ë(*(
_Â
)->
_IO_wrôe_±r
++ = (
_ch
)))

	)

443 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


444 
	#_IO_gëwc_u∆ocked
(
_Â
) \

445 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
->
_IO_ªad_±r
 >(_Â)->_wide_d©a->
_IO_ªad_íd
,\

447 ? 
	`__wuÊow
 (
_Â
Ë: (
_IO_wöt_t
Ë*(_Â)->
_wide_d©a
->
_IO_ªad_±r
++)

	)

448 
	#_IO_putwc_u∆ocked
(
_wch
, 
_Â
) \

449 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
 \

450 >(
_Â
)->
_wide_d©a
->
_IO_wrôe_íd
, 0) \

451 ? 
	`__wovîÊow
 (
_Â
, 
_wch
) \

452 : (
_IO_wöt_t
Ë(*(
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
++ = (
_wch
)))

	)

455 
	#_IO_„of_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_EOF_SEEN
Ë!0)

	)

456 
	#_IO_„º‹_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_ERR_SEEN
Ë!0)

	)

458 
_IO_gëc
 (
_IO_FILE
 *
__Â
);

459 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__Â
);

460 
_IO_„of
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

461 
_IO_„º‹
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

463 
_IO_≥ekc_locked
 (
_IO_FILE
 *
__Â
);

466 
	#_IO_PENDING_OUTPUT_COUNT
(
_Â
) \

467 ((
_Â
)->
_IO_wrôe_±r
 - (_Â)->
_IO_wrôe_ba£
)

	)

469 
_IO_Êockfûe
 (
_IO_FILE
 *Ë
__THROW
;

470 
_IO_fu∆ockfûe
 (
_IO_FILE
 *Ë
__THROW
;

471 
_IO_·rylockfûe
 (
_IO_FILE
 *Ë
__THROW
;

473 #ifde‡
_IO_MTSAFE_IO


474 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_locked
 (_Â)

	)

475 
	#_IO_Êockfûe
(
_Â
) \

476 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_Êockfûe
 (_Â)

	)

477 
	#_IO_fu∆ockfûe
(
_Â
) \

478 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_fu∆ockfûe
 (_Â)

	)

480 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_u∆ocked
 (_Â)

	)

481 
	#_IO_Êockfûe
(
_Â
Ë

	)

482 
	#_IO_fu∆ockfûe
(
_Â
Ë

	)

483 
	#_IO_·rylockfûe
(
_Â
Ë

	)

484 
	#_IO_˛ónup_ªgi⁄_°¨t
(
_f˘
, 
_Â
Ë

	)

485 
	#_IO_˛ónup_ªgi⁄_íd
(
_Doô
Ë

	)

488 
_IO_vfsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, const * __restrict,

489 
_IO_va_li°
, *
__ª°ri˘
);

490 
_IO_vÂrötf
 (
_IO_FILE
 *
__ª°ri˘
, const *__restrict,

491 
_IO_va_li°
);

492 
_IO_ssize_t
 
_IO_∑dn
 (
_IO_FILE
 *, , _IO_ssize_t);

493 
_IO_size_t
 
_IO_sgën
 (
_IO_FILE
 *, *, _IO_size_t);

495 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

496 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

498 
_IO_‰ì_backup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

500 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


501 
_IO_wöt_t
 
_IO_gëwc
 (
_IO_FILE
 *
__Â
);

502 
_IO_wöt_t
 
_IO_putwc
 (
wch¨_t
 
__wc
, 
_IO_FILE
 *
__Â
);

503 
_IO_fwide
 (
_IO_FILE
 *
__Â
, 
__mode
Ë
__THROW
;

504 #i‡
__GNUC__
 >= 2

507 #i‡
deföed
 
_LIBC
 && deföed 
SHARED


508 
	~<shlib-com∑t.h
>

509 #i‡
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

510 
	#_IO_fwide_maybe_öcom∑tibÀ
 \

511 (
	`__buûtö_ex≥˘
 (&
_IO_°dö_u£d
 =
NULL
, 0))

	)

512 c⁄° 
_IO_°dö_u£d
;

513 
wók_exã∫
 (
_IO_°dö_u£d
);

516 #i‚de‡
_IO_fwide_maybe_öcom∑tibÀ


517 
	#_IO_fwide_maybe_öcom∑tibÀ
 (0)

	)

521 
	#_IO_fwide
(
__Â
, 
__mode
) \

522 ({ 
__ªsu…
 = (
__mode
); \

523 i‡(
__ªsu…
 < 0 && ! 
_IO_fwide_maybe_öcom∑tibÀ
) \

525 i‡((
__Â
)->
_mode
 == 0) \

527 (
__Â
)->
_mode
 = -1; \

528 
__ªsu…
 = (
__Â
)->
_mode
; \

530 i‡(
	`__buûtö_c⁄°™t_p
 (
__mode
) && (__mode) == 0) \

531 
__ªsu…
 = 
_IO_fwide_maybe_öcom∑tibÀ
 ? -1 : (
__Â
)->
_mode
; \

533 
__ªsu…
 = 
	`_IO_fwide
 (
__Â
, __result); \

534 
__ªsu…
; })

	)

537 
_IO_vfwsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict,

538 
_IO_va_li°
, *
__ª°ri˘
);

539 
_IO_vfw¥ötf
 (
_IO_FILE
 *
__ª°ri˘
, c⁄° 
wch¨_t
 *__restrict,

540 
_IO_va_li°
);

541 
_IO_ssize_t
 
_IO_w∑dn
 (
_IO_FILE
 *, 
wöt_t
, _IO_ssize_t);

542 
_IO_‰ì_wbackup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

545 #ifde‡
__LDBL_COMPAT


546 
	~<bôs/libio-ldbl.h
>

549 #ifde‡
__˝lu•lus


	@/usr/include/sys/cdefs.h

20 #i‚def 
_SYS_CDEFS_H


21 
	#_SYS_CDEFS_H
 1

	)

24 #i‚de‡
_FEATURES_H


25 
	~<„©uªs.h
>

31 #i‡
deföed
 
__GNUC__
 && !deföed 
__STDC__


36 #unde‡
__P


37 #unde‡
__PMT


39 #ifde‡
__GNUC__


46 #i‡!
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (3, 3)

47 
	#__THROW
 
	`__©åibuã__
 ((
__nŸhrow__
))

	)

48 
	#__NTH
(
f˘
Ë
	`__©åibuã__
 ((
__nŸhrow__
)Ë
	)
fct

50 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

51 
	#__THROW
 
	`throw
 ()

	)

52 
	#__NTH
(
f˘
Ëf˘ 
	`throw
 ()

	)

54 
	#__THROW


	)

55 
	#__NTH
(
f˘
Ë
	)
fct

61 
	#__ölöe


	)

63 
	#__THROW


	)

64 
	#__NTH
(
f˘
Ë
	)
fct

66 
	#__c⁄°
 c⁄°

	)

67 
	#__sig√d
 sig√d

	)

68 
	#__vﬁ©ûe
 vﬁ©ûe

	)

74 
	#__P
(
¨gs
Ë
	)
args

75 
	#__PMT
(
¨gs
Ë
	)
args

80 
	#__CONCAT
(
x
,
y
Ëx ## 
	)
y

81 
	#__STRING
(
x
Ë#x

	)

84 
	#__±r_t
 *

	)

85 
	#__l⁄g_doubÀ_t
 

	)

89 #ifdef 
__˝lu•lus


90 
	#__BEGIN_DECLS
 "C" {

	)

91 
	#__END_DECLS
 }

	)

93 
	#__BEGIN_DECLS


	)

94 
	#__END_DECLS


	)

103 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES


104 
	#__BEGIN_NAMESPACE_STD
 
«me•a˚
 
°d
 {

	)

105 
	#__END_NAMESPACE_STD
 }

	)

106 
	#__USING_NAMESPACE_STD
(
«me
Ë
usög
 
°d
::«me;

	)

107 
	#__BEGIN_NAMESPACE_C99
 
«me•a˚
 
__c99
 {

	)

108 
	#__END_NAMESPACE_C99
 }

	)

109 
	#__USING_NAMESPACE_C99
(
«me
Ë
usög
 
__c99
::«me;

	)

114 
	#__BEGIN_NAMESPACE_STD


	)

115 
	#__END_NAMESPACE_STD


	)

116 
	#__USING_NAMESPACE_STD
(
«me
)

	)

117 
	#__BEGIN_NAMESPACE_C99


	)

118 
	#__END_NAMESPACE_C99


	)

119 
	#__USING_NAMESPACE_C99
(
«me
)

	)

124 #i‚de‡
__BOUNDED_POINTERS__


125 
	#__bounded


	)

126 
	#__unbounded


	)

127 
	#__±rvÆue


	)

132 
	#__bos
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 0)

	)

135 #i‡
__GNUC_PREREQ
 (4,3)

136 
	#__w¨nde˛
(
«me
, 
msg
) \

137 
	`«me
 (Ë
	`__©åibuã__
((
	`__w¨nög__
 (
msg
)))

	)

138 
	#__w¨«âr
(
msg
Ë
	`__©åibuã__
((
	`__w¨nög__
 (msg)))

	)

139 
	#__îr‹de˛
(
«me
, 
msg
) \

140 
	`«me
 (Ë
	`__©åibuã__
((
	`__îr‹__
 (
msg
)))

	)

142 
	#__w¨nde˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

143 
	#__w¨«âr
(
msg
)

	)

144 
	#__îr‹de˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

148 #i‡
__GNUC_PREREQ
 (2,97)

150 
	#__Êex¨r
 []

	)

152 #ifde‡
__GNUC__


153 
	#__Êex¨r
 [0]

	)

155 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

156 
	#__Êex¨r
 []

	)

159 
	#__Êex¨r
 [1]

	)

175 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

177 
	#__REDIRECT
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

178 #ifde‡
__˝lu•lus


179 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

180 
«me
 
¥Ÿo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

182 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

183 
«me
 
¥Ÿo
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs)Ë
__THROW


	)

185 
	#__ASMNAME
(
˙ame
Ë
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, c«me)

	)

186 
	#__ASMNAME2
(
¥efix
, 
˙ame
Ë
	`__STRING
 (¥efixË
	)
cname

199 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

200 
	#__©åibuã__
(
xyz
Ë

	)

206 #i‡
__GNUC_PREREQ
 (2,96)

207 
	#__©åibuã_mÆloc__
 
	`__©åibuã__
 ((
__mÆloc__
))

	)

209 
	#__©åibuã_mÆloc__


	)

215 #i‡
__GNUC_PREREQ
 (2,96)

216 
	#__©åibuã_puª__
 
	`__©åibuã__
 ((
__puª__
))

	)

218 
	#__©åibuã_puª__


	)

224 #i‡
__GNUC_PREREQ
 (3,1)

225 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__u£d__
))

	)

226 
	#__©åibuã_noölöe__
 
	`__©åibuã__
 ((
__noölöe__
))

	)

228 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__unu£d__
))

	)

229 
	#__©åibuã_noölöe__


	)

233 #i‡
__GNUC_PREREQ
 (3,2)

234 
	#__©åibuã_dïªˇãd__
 
	`__©åibuã__
 ((
__dïªˇãd__
))

	)

236 
	#__©åibuã_dïªˇãd__


	)

245 #i‡
__GNUC_PREREQ
 (2,8)

246 
	#__©åibuã_f‹m©_¨g__
(
x
Ë
	`__©åibuã__
 ((
	`__f‹m©_¨g__
 (x)))

	)

248 
	#__©åibuã_f‹m©_¨g__
(
x
Ë

	)

255 #i‡
__GNUC_PREREQ
 (2,97)

256 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
) \

257 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__°rfm⁄__
, 
a
, 
b
)))

	)

259 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
Ë

	)

264 #i‡
__GNUC_PREREQ
 (3,3)

265 
	#__n⁄nuŒ
(
∑øms
Ë
	`__©åibuã__
 ((
__n⁄nuŒ__
Ö¨ams))

	)

267 
	#__n⁄nuŒ
(
∑øms
)

	)

272 #i‡
__GNUC_PREREQ
 (3,4)

273 
	#__©åibuã_w¨n_unu£d_ªsu…__
 \

274 
	`__©åibuã__
 ((
__w¨n_unu£d_ªsu…__
))

	)

275 #i‡
__USE_FORTIFY_LEVEL
 > 0

276 
	#__wur
 
__©åibuã_w¨n_unu£d_ªsu…__


	)

279 
	#__©åibuã_w¨n_unu£d_ªsu…__


	)

281 #i‚de‡
__wur


282 
	#__wur


	)

286 #i‡
__GNUC_PREREQ
 (3,2)

287 
	#__Æways_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__Æways_ölöe__
))

	)

289 
	#__Æways_ölöe
 
__ölöe


	)

294 #i‡!
deföed
 
__˝lu•lus
 || 
__GNUC_PREREQ
 (4,3)

295 #i‡
deföed
 
__GNUC_STDC_INLINE__
 || deföed 
__˝lu•lus


296 
	#__exã∫_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
))

	)

297 #i‡
__GNUC_PREREQ
 (4,3)

298 
	#__exã∫_Æways_ölöe
 \

299 
__Æways_ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
, 
__¨tificül__
))

	)

301 
	#__exã∫_Æways_ölöe
 \

302 
__Æways_ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
))

	)

305 
	#__exã∫_ölöe
 
__ölöe


	)

306 
	#__exã∫_Æways_ölöe
 
__Æways_ölöe


	)

312 #i‡
__GNUC_PREREQ
 (4,3)

313 
	#__va_¨g_∑ck
(Ë
	`__buûtö_va_¨g_∑ck
 ()

	)

314 
	#__va_¨g_∑ck_Àn
(Ë
	`__buûtö_va_¨g_∑ck_Àn
 ()

	)

321 #i‡!
__GNUC_PREREQ
 (2,8)

322 
	#__exãnsi⁄__


	)

326 #i‡!
__GNUC_PREREQ
 (2,92)

327 
	#__ª°ri˘


	)

333 #i‡
__GNUC_PREREQ
 (3,1Ë&& !
deföed
 
__GNUG__


334 
	#__ª°ri˘_¨r
 
__ª°ri˘


	)

336 #ifde‡
__GNUC__


337 
	#__ª°ri˘_¨r


	)

339 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

340 
	#__ª°ri˘_¨r
 
ª°ri˘


	)

343 
	#__ª°ri˘_¨r


	)

348 
	~<bôs/w‹dsize.h
>

350 #i‡
deföed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && deföed 
__NO_LONG_DOUBLE_MATH


351 
	#__LDBL_COMPAT
 1

	)

352 #ifde‡
__REDIRECT


353 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

354 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
) \

355 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

356 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT_NTH
 («me,ÖrŸo,álüs)

	)

357 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
) \

358 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

359 
	#__LDBL_REDIR1_DECL
(
«me
, 
Æüs
) \

360 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 (#Æüs));

	)

361 
	#__LDBL_REDIR_DECL
(
«me
) \

362 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 ("__∆dbl_" #«me));

	)

363 
	#__REDIRECT_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

364 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##
Æüs
)

	)

365 
	#__REDIRECT_NTH_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

366 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##
Æüs
)

	)

369 #i‡!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT


370 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê
	)
proto

371 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
Ë«mê
	)
proto

372 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
__THROW


	)

373 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
Ë«mê¥Ÿÿ
__THROW


	)

374 
	#__LDBL_REDIR_DECL
(
«me
)

	)

375 #ifde‡
__REDIRECT


376 
	#__REDIRECT_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

377 
	#__REDIRECT_NTH_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

378 
	`__REDIRECT_NTH
 (
«me
, 
¥Ÿo
, 
Æüs
)

	)

	@/usr/include/sys/sysmacros.h

21 #i‚de‡
_SYS_SYSMACROS_H


22 
	#_SYS_SYSMACROS_H
 1

	)

24 
	~<„©uªs.h
>

29 #ifde‡
__GLIBC_HAVE_LONG_LONG


30 
__exãnsi⁄__


31 
	$gnu_dev_maj‹
 (
__dev
)

32 
__THROW
;

33 
__exãnsi⁄__


34 
	$gnu_dev_mö‹
 (
__dev
)

35 
__THROW
;

36 
__exãnsi⁄__


37 
	$gnu_dev_makedev
 (
__maj‹
,

38 
__mö‹
)

39 
__THROW
;

41 #i‡
deföed
 
__GNUC__
 && __GNUC__ >2 && deföed 
__USE_EXTERN_INLINES


42 
__exãnsi⁄__
 
__exã∫_ölöe
 

43 
	`__NTH
 (
	$gnu_dev_maj‹
 (
__dev
))

45  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

46 
	}
}

48 
__exãnsi⁄__
 
__exã∫_ölöe
 

49 
__NTH
 (
	$gnu_dev_mö‹
 (
__dev
))

51  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

52 
	}
}

54 
__exãnsi⁄__
 
__exã∫_ölöe
 

55 
__NTH
 (
	$gnu_dev_makedev
 (
__maj‹
, 
__mö‹
))

57  ((
__mö‹
 & 0xffË| ((
__maj‹
 & 0xfff) << 8)

58 | (((Ë(
__mö‹
 & ~0xff)) << 12)

59 | (((Ë(
__maj‹
 & ~0xfff)) << 32));

60 
	}
}

65 
	#maj‹
(
dev
Ë
	`gnu_dev_maj‹
 (dev)

	)

66 
	#mö‹
(
dev
Ë
	`gnu_dev_mö‹
 (dev)

	)

67 
	#makedev
(
maj
, 
mö
Ë
	`gnu_dev_makedev
 (maj, mö)

	)

	@/usr/include/sys/ttydefaults.h

40 #i‚de‡
_SYS_TTYDEFAULTS_H_


41 
	#_SYS_TTYDEFAULTS_H_


	)

46 
	#TTYDEF_IFLAG
 (
BRKINT
 | 
ISTRIP
 | 
ICRNL
 | 
IMAXBEL
 | 
IXON
 | 
IXANY
)

	)

47 
	#TTYDEF_OFLAG
 (
OPOST
 | 
ONLCR
 | 
XTABS
)

	)

48 
	#TTYDEF_LFLAG
 (
ECHO
 | 
ICANON
 | 
ISIG
 | 
IEXTEN
 | 
ECHOE
|
ECHOKE
|
ECHOCTL
)

	)

49 
	#TTYDEF_CFLAG
 (
CREAD
 | 
CS7
 | 
PARENB
 | 
HUPCL
)

	)

50 
	#TTYDEF_SPEED
 (
B9600
)

	)

55 
	#CTRL
(
x
Ë(x&037)

	)

56 
	#CEOF
 
	`CTRL
('d')

	)

57 #ifde‡
_POSIX_VDISABLE


58 
	#CEOL
 
_POSIX_VDISABLE


	)

60 
	#CEOL
 '\0'

	)

62 
	#CERASE
 0177

	)

63 
	#CINTR
 
	`CTRL
('c')

	)

64 #ifde‡
_POSIX_VDISABLE


65 
	#CSTATUS
 
_POSIX_VDISABLE


	)

67 
	#CSTATUS
 '\0'

	)

69 
	#CKILL
 
	`CTRL
('u')

	)

70 
	#CMIN
 1

	)

71 
	#CQUIT
 034

	)

72 
	#CSUSP
 
	`CTRL
('z')

	)

73 
	#CTIME
 0

	)

74 
	#CDSUSP
 
	`CTRL
('y')

	)

75 
	#CSTART
 
	`CTRL
('q')

	)

76 
	#CSTOP
 
	`CTRL
('s')

	)

77 
	#CLNEXT
 
	`CTRL
('v')

	)

78 
	#CDISCARD
 
	`CTRL
('o')

	)

79 
	#CWERASE
 
	`CTRL
('w')

	)

80 
	#CREPRINT
 
	`CTRL
('r')

	)

81 
	#CEOT
 
CEOF


	)

83 
	#CBRK
 
CEOL


	)

84 
	#CRPRNT
 
CREPRINT


	)

85 
	#CFLUSH
 
CDISCARD


	)

93 #ifde‡
TTYDEFCHARS


94 
cc_t
 
	gâydefch¨s
[
NCCS
] = {

95 
CEOF
, 
CEOL
, CEOL, 
CERASE
, 
CWERASE
, 
CKILL
, 
CREPRINT
,

96 
_POSIX_VDISABLE
, 
CINTR
, 
CQUIT
, 
CSUSP
, 
CDSUSP
, 
CSTART
, 
CSTOP
, 
CLNEXT
,

97 
CDISCARD
, 
CMIN
, 
CTIME
, 
CSTATUS
, 
_POSIX_VDISABLE


99 #unde‡
TTYDEFCHARS


	@/usr/include/sys/ucontext.h

19 #i‚de‡
_SYS_UCONTEXT_H


20 
	#_SYS_UCONTEXT_H
 1

	)

22 
	~<„©uªs.h
>

23 
	~<sig«l.h
>

27 
	~<bôs/sigc⁄ãxt.h
>

31 
	tgªg_t
;

34 
	#NGREG
 19

	)

37 
gªg_t
 
	tgªg£t_t
[
NGREG
];

39 #ifde‡
__USE_GNU


43 
	mREG_GS
 = 0,

44 
	#REG_GS
 
REG_GS


	)

45 
	mREG_FS
,

46 
	#REG_FS
 
REG_FS


	)

47 
	mREG_ES
,

48 
	#REG_ES
 
REG_ES


	)

49 
	mREG_DS
,

50 
	#REG_DS
 
REG_DS


	)

51 
	mREG_EDI
,

52 
	#REG_EDI
 
REG_EDI


	)

53 
	mREG_ESI
,

54 
	#REG_ESI
 
REG_ESI


	)

55 
	mREG_EBP
,

56 
	#REG_EBP
 
REG_EBP


	)

57 
	mREG_ESP
,

58 
	#REG_ESP
 
REG_ESP


	)

59 
	mREG_EBX
,

60 
	#REG_EBX
 
REG_EBX


	)

61 
	mREG_EDX
,

62 
	#REG_EDX
 
REG_EDX


	)

63 
	mREG_ECX
,

64 
	#REG_ECX
 
REG_ECX


	)

65 
	mREG_EAX
,

66 
	#REG_EAX
 
REG_EAX


	)

67 
	mREG_TRAPNO
,

68 
	#REG_TRAPNO
 
REG_TRAPNO


	)

69 
	mREG_ERR
,

70 
	#REG_ERR
 
REG_ERR


	)

71 
	mREG_EIP
,

72 
	#REG_EIP
 
REG_EIP


	)

73 
	mREG_CS
,

74 
	#REG_CS
 
REG_CS


	)

75 
	mREG_EFL
,

76 
	#REG_EFL
 
REG_EFL


	)

77 
	mREG_UESP
,

78 
	#REG_UESP
 
REG_UESP


	)

79 
	mREG_SS


80 
	#REG_SS
 
REG_SS


	)

85 
	s_libc_Âªg


87 
	msignifiˇnd
[4];

88 
	mexp⁄ít
;

91 
	s_libc_Â°©e


93 
	mcw
;

94 
	msw
;

95 
	mèg
;

96 
	mùoff
;

97 
	mcs£l
;

98 
	md©aoff
;

99 
	md©a£l
;

100 
_libc_Âªg
 
	m_°
[8];

101 
	m°©us
;

105 
_libc_Â°©e
 *
	tÂªg£t_t
;

110 
gªg£t_t
 
	mgªgs
;

113 
Âªg£t_t
 
	mÂªgs
;

114 
	mﬁdmask
;

115 
	m¸2
;

116 } 
	tmc⁄ãxt_t
;

119 
	suc⁄ãxt


121 
	muc_Êags
;

122 
uc⁄ãxt
 *
	muc_lök
;

123 
°ack_t
 
	muc_°ack
;

124 
mc⁄ãxt_t
 
	muc_mc⁄ãxt
;

125 
__sig£t_t
 
	muc_sigmask
;

126 
_libc_Â°©e
 
	m__Âªgs_mem
;

127 } 
	tuc⁄ãxt_t
;

	@/usr/include/sys/uio.h

19 #i‚de‡
_SYS_UIO_H


20 
	#_SYS_UIO_H
 1

	)

22 
	~<„©uªs.h
>

24 
	~<sys/ty≥s.h
>

26 
	g__BEGIN_DECLS


29 
	~<bôs/uio.h
>

40 
ssize_t
 
ªadv
 (
__fd
, 
__c⁄°
 
iovec
 *
__iovec
, 
__cou¡
);

50 
ssize_t
 
wrôev
 (
__fd
, 
__c⁄°
 
iovec
 *
__iovec
, 
__cou¡
);

52 
	g__END_DECLS


	@/usr/include/xlocale.h

21 #i‚de‡
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loˇÀ_°ru˘


31 
loˇÀ_d©a
 *
	m__loˇÀs
[13];

34 c⁄° *
	m__˘y≥_b
;

35 c⁄° *
	m__˘y≥_tﬁowî
;

36 c⁄° *
	m__˘y≥_touµî
;

39 c⁄° *
	m__«mes
[13];

40 } *
	t__loˇÀ_t
;

	@/usr/include/zconf.h

8 #i‚de‡
ZCONF_H


9 
	#ZCONF_H


	)

15 #ifde‡
Z_PREFIX


16 
	#deÊ©eInô_
 
z_deÊ©eInô_


	)

17 
	#deÊ©e
 
z_deÊ©e


	)

18 
	#deÊ©eEnd
 
z_deÊ©eEnd


	)

19 
	#öÊ©eInô_
 
z_öÊ©eInô_


	)

20 
	#öÊ©e
 
z_öÊ©e


	)

21 
	#öÊ©eEnd
 
z_öÊ©eEnd


	)

22 
	#deÊ©eInô2_
 
z_deÊ©eInô2_


	)

23 
	#deÊ©eSëDi˘i⁄¨y
 
z_deÊ©eSëDi˘i⁄¨y


	)

24 
	#deÊ©eC›y
 
z_deÊ©eC›y


	)

25 
	#deÊ©eRe£t
 
z_deÊ©eRe£t


	)

26 
	#deÊ©eP¨ams
 
z_deÊ©eP¨ams


	)

27 
	#deÊ©eBound
 
z_deÊ©eBound


	)

28 
	#deÊ©ePrime
 
z_deÊ©ePrime


	)

29 
	#öÊ©eInô2_
 
z_öÊ©eInô2_


	)

30 
	#öÊ©eSëDi˘i⁄¨y
 
z_öÊ©eSëDi˘i⁄¨y


	)

31 
	#öÊ©eSync
 
z_öÊ©eSync


	)

32 
	#öÊ©eSyncPoöt
 
z_öÊ©eSyncPoöt


	)

33 
	#öÊ©eC›y
 
z_öÊ©eC›y


	)

34 
	#öÊ©eRe£t
 
z_öÊ©eRe£t


	)

35 
	#öÊ©eBack
 
z_öÊ©eBack


	)

36 
	#öÊ©eBackEnd
 
z_öÊ©eBackEnd


	)

37 
	#com¥ess
 
z_com¥ess


	)

38 
	#com¥ess2
 
z_com¥ess2


	)

39 
	#com¥essBound
 
z_com¥essBound


	)

40 
	#uncom¥ess
 
z_uncom¥ess


	)

41 
	#adÀr32
 
z_adÀr32


	)

42 
	#¸c32
 
z_¸c32


	)

43 
	#gë_¸c_èbÀ
 
z_gë_¸c_èbÀ


	)

44 
	#zEº‹
 
z_zEº‹


	)

46 
	#Æloc_func
 
z_Æloc_func


	)

47 
	#‰ì_func
 
z_‰ì_func


	)

48 
	#ö_func
 
z_ö_func


	)

49 
	#out_func
 
z_out_func


	)

50 
	#Byã
 
z_Byã


	)

51 
	#uI¡
 
z_uI¡


	)

52 
	#uL⁄g
 
z_uL⁄g


	)

53 
	#Byãf
 
z_Byãf


	)

54 
	#ch¨f
 
z_ch¨f


	)

55 
	#ötf
 
z_ötf


	)

56 
	#uI¡f
 
z_uI¡f


	)

57 
	#uL⁄gf
 
z_uL⁄gf


	)

58 
	#voidpf
 
z_voidpf


	)

59 
	#voidp
 
z_voidp


	)

62 #i‡
deföed
(
__MSDOS__
Ë&& !deföed(
MSDOS
)

63 
	#MSDOS


	)

65 #i‡(
deföed
(
OS_2
Ë|| deföed(
__OS2__
)Ë&& !deföed(
OS2
)

66 
	#OS2


	)

68 #i‡
deföed
(
_WINDOWS
Ë&& !deföed(
WINDOWS
)

69 
	#WINDOWS


	)

71 #i‡
deföed
(
_WIN32
Ë|| deföed(
_WIN32_WCE
Ë|| deföed(
__WIN32__
)

72 #i‚de‡
WIN32


73 
	#WIN32


	)

76 #i‡(
deföed
(
MSDOS
Ë|| deföed(
OS2
Ë|| deföed(
WINDOWS
)Ë&& !deföed(
WIN32
)

77 #i‡!
deföed
(
__GNUC__
Ë&& !deföed(
__FLAT__
Ë&& !deföed(
__386__
)

78 #i‚de‡
SYS16BIT


79 
	#SYS16BIT


	)

88 #ifde‡
SYS16BIT


89 
	#MAXSEG_64K


	)

91 #ifde‡
MSDOS


92 
	#UNALIGNED_OK


	)

95 #ifde‡
__STDC_VERSION__


96 #i‚de‡
STDC


97 
	#STDC


	)

99 #i‡
__STDC_VERSION__
 >= 199901L

100 #i‚de‡
STDC99


101 
	#STDC99


	)

105 #i‡!
deföed
(
STDC
Ë&& (deföed(
__STDC__
Ë|| deföed(
__˝lu•lus
))

106 
	#STDC


	)

108 #i‡!
deföed
(
STDC
Ë&& (deföed(
__GNUC__
Ë|| deföed(
__BORLANDC__
))

109 
	#STDC


	)

111 #i‡!
deföed
(
STDC
Ë&& (deföed(
MSDOS
Ë|| deföed(
WINDOWS
Ë|| deföed(
WIN32
))

112 
	#STDC


	)

114 #i‡!
deföed
(
STDC
Ë&& (deföed(
OS2
Ë|| deföed(
__HOS_AIX__
))

115 
	#STDC


	)

118 #i‡
deföed
(
__OS400__
Ë&& !deföed(
STDC
)

119 
	#STDC


	)

122 #i‚de‡
STDC


124 c⁄°

	)

129 #i‡
deföed
(
__MWERKS__
)||deföed(
≠∂ec
)||deföed(
THINK_C
)||deföed(
__SC__
)

130 
	#NO_DUMMY_DECL


	)

134 #i‚de‡
MAX_MEM_LEVEL


135 #ifde‡
MAXSEG_64K


136 
	#MAX_MEM_LEVEL
 8

	)

138 
	#MAX_MEM_LEVEL
 9

	)

147 #i‚de‡
MAX_WBITS


148 
	#MAX_WBITS
 15

	)

166 #i‚de‡
OF


167 #ifde‡
STDC


168 
	#OF
(
¨gs
Ë
	)
args

170 
	#OF
(
¨gs
Ë()

	)

180 #ifde‡
SYS16BIT


181 #i‡
deföed
(
M_I86SM
Ë|| deföed(
M_I86MM
)

183 
	#SMALL_MEDIUM


	)

184 #ifde‡
_MSC_VER


185 
	#FAR
 
_Ár


	)

187 
	#FAR
 
Ár


	)

190 #i‡(
deföed
(
__SMALL__
Ë|| deföed(
__MEDIUM__
))

192 
	#SMALL_MEDIUM


	)

193 #ifde‡
__BORLANDC__


194 
	#FAR
 
_Ár


	)

196 
	#FAR
 
Ár


	)

201 #i‡
deföed
(
WINDOWS
Ë|| deföed(
WIN32
)

205 #ifde‡
ZLIB_DLL


206 #i‡
deföed
(
WIN32
Ë&& (!deföed(
__BORLANDC__
) || (__BORLANDC__ >= 0x500))

207 #ifde‡
ZLIB_INTERNAL


208 
	#ZEXTERN
 
	`__de˛•ec
(
dŒexp‹t
)

	)

210 
	#ZEXTERN
 
	`__de˛•ec
(
dŒimp‹t
)

	)

218 #ifde‡
ZLIB_WINAPI


219 #ifde‡
FAR


220 #unde‡
FAR


222 
	~<wödows.h
>

225 
	#ZEXPORT
 
WINAPI


	)

226 #ifde‡
WIN32


227 
	#ZEXPORTVA
 
WINAPIV


	)

229 
	#ZEXPORTVA
 
FAR
 
CDECL


	)

234 #i‡
deföed
 (
__BEOS__
)

235 #ifde‡
ZLIB_DLL


236 #ifde‡
ZLIB_INTERNAL


237 
	#ZEXPORT
 
	`__de˛•ec
(
dŒexp‹t
)

	)

238 
	#ZEXPORTVA
 
	`__de˛•ec
(
dŒexp‹t
)

	)

240 
	#ZEXPORT
 
	`__de˛•ec
(
dŒimp‹t
)

	)

241 
	#ZEXPORTVA
 
	`__de˛•ec
(
dŒimp‹t
)

	)

246 #i‚de‡
ZEXTERN


247 
	#ZEXTERN
 

	)

249 #i‚de‡
ZEXPORT


250 
	#ZEXPORT


	)

252 #i‚de‡
ZEXPORTVA


253 
	#ZEXPORTVA


	)

256 #i‚de‡
FAR


257 
	#FAR


	)

260 #i‡!
deföed
(
__MACTYPES__
)

261 
	tByã
;

263 
	tuI¡
;

264 
	tuL⁄g
;

266 #ifde‡
SMALL_MEDIUM


268 
	#Byãf
 
Byã
 
FAR


	)

270 
Byã
 
	tFAR
 
	tByãf
;

272 
	tFAR
 
	tch¨f
;

273 
	tFAR
 
	tötf
;

274 
uI¡
 
	tFAR
 
	tuI¡f
;

275 
uL⁄g
 
	tFAR
 
	tuL⁄gf
;

277 #ifde‡
STDC


278 c⁄° *
	tvoidpc
;

279 
	tFAR
 *
	tvoidpf
;

280 *
	tvoidp
;

282 
Byã
 c⁄° *
	tvoidpc
;

283 
Byã
 
	tFAR
 *
	tvoidpf
;

284 
Byã
 *
	tvoidp
;

288 
	~<sys/ty≥s.h
>

289 
	~<uni°d.h
>

290 #ifde‡
VMS


291 
	~<unixio.h
>

293 
	#z_off_t
 
off_t


	)

295 #i‚de‡
SEEK_SET


296 
	#SEEK_SET
 0

	)

297 
	#SEEK_CUR
 1

	)

298 
	#SEEK_END
 2

	)

300 #i‚de‡
z_off_t


301 
	#z_off_t
 

	)

304 #i‡
deföed
(
__OS400__
)

305 
	#NO_v¢¥ötf


	)

308 #i‡
deföed
(
__MVS__
)

309 
	#NO_v¢¥ötf


	)

310 #ifde‡
FAR


311 #unde‡
FAR


316 #i‡
deföed
(
__MVS__
)

317 #¥agm®
m≠
(
deÊ©eInô_
,"DEIN")

318 #¥agm®
m≠
(
deÊ©eInô2_
,"DEIN2")

319 #¥agm®
m≠
(
deÊ©eEnd
,"DEEND")

320 #¥agm®
m≠
(
deÊ©eBound
,"DEBND")

321 #¥agm®
m≠
(
öÊ©eInô_
,"ININ")

322 #¥agm®
m≠
(
öÊ©eInô2_
,"ININ2")

323 #¥agm®
m≠
(
öÊ©eEnd
,"INEND")

324 #¥agm®
m≠
(
öÊ©eSync
,"INSY")

325 #¥agm®
m≠
(
öÊ©eSëDi˘i⁄¨y
,"INSEDI")

326 #¥agm®
m≠
(
com¥essBound
,"CMBND")

327 #¥agm®
m≠
(
öÊ©e_èbÀ
,"INTABL")

328 #¥agm®
m≠
(
öÊ©e_Á°
,"INFA")

329 #¥agm®
m≠
(
öÊ©e_c›yright
,"INCOPY")

	@/usr/include/_G_config.h

4 #i‚de‡
_G_c⁄fig_h


5 
	#_G_c⁄fig_h
 1

	)

9 
	~<bôs/ty≥s.h
>

10 
	#__√ed_size_t


	)

11 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


12 
	#__√ed_wch¨_t


	)

14 
	#__√ed_NULL


	)

15 
	~<°ddef.h
>

16 
	#__√ed_mb°©e_t


	)

17 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


18 
	#__√ed_wöt_t


	)

20 
	~<wch¨.h
>

21 
	#_G_size_t
 
size_t


	)

24 
__off_t
 
	m__pos
;

25 
__mb°©e_t
 
	m__°©e
;

26 } 
	t_G_Âos_t
;

29 
__off64_t
 
	m__pos
;

30 
__mb°©e_t
 
	m__°©e
;

31 } 
	t_G_Âos64_t
;

32 
	#_G_ssize_t
 
__ssize_t


	)

33 
	#_G_off_t
 
__off_t


	)

34 
	#_G_off64_t
 
__off64_t


	)

35 
	#_G_pid_t
 
__pid_t


	)

36 
	#_G_uid_t
 
__uid_t


	)

37 
	#_G_wch¨_t
 
wch¨_t


	)

38 
	#_G_wöt_t
 
wöt_t


	)

39 
	#_G_°©64
 
°©64


	)

40 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


41 
	~<gc⁄v.h
>

44 
__gc⁄v_öfo
 
	m__cd
;

47 
__gc⁄v_öfo
 
	m__cd
;

48 
__gc⁄v_°ï_d©a
 
	m__d©a
;

49 } 
	m__comböed
;

50 } 
	t_G_ic⁄v_t
;

53 
	t_G_öt16_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__HI__
)));

54 
	t_G_öt32_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__SI__
)));

55 
	t_G_uöt16_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__HI__
)));

56 
	t_G_uöt32_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__SI__
)));

58 
	#_G_HAVE_BOOL
 1

	)

62 
	#_G_HAVE_ATEXIT
 1

	)

63 
	#_G_HAVE_SYS_CDEFS
 1

	)

64 
	#_G_HAVE_SYS_WAIT
 1

	)

65 
	#_G_NEED_STDARG_H
 1

	)

66 
	#_G_va_li°
 
__gnuc_va_li°


	)

68 
	#_G_HAVE_PRINTF_FP
 1

	)

69 
	#_G_HAVE_MMAP
 1

	)

70 
	#_G_HAVE_MREMAP
 1

	)

71 
	#_G_HAVE_LONG_DOUBLE_IO
 1

	)

72 
	#_G_HAVE_IO_FILE_OPEN
 1

	)

73 
	#_G_HAVE_IO_GETLINE_INFO
 1

	)

75 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

77 
	#_G_OPEN64
 
__›í64


	)

78 
	#_G_LSEEK64
 
__l£ek64


	)

79 
	#_G_MMAP64
 
__mm≠64


	)

80 
	#_G_FSTAT64
(
fd
,
buf
Ë
	`__fx°©64
 (
_STAT_VER
, fd, buf)

	)

83 
	#_G_HAVE_ST_BLKSIZE
 
	`deföed
 (
_STATBUF_ST_BLKSIZE
)

	)

85 
	#_G_BUFSIZ
 8192

	)

88 
	#_G_NAMES_HAVE_UNDERSCORE
 0

	)

89 
	#_G_VTABLE_LABEL_HAS_LENGTH
 1

	)

90 
	#_G_USING_THUNKS
 1

	)

91 
	#_G_VTABLE_LABEL_PREFIX
 "__vt_"

	)

92 
	#_G_VTABLE_LABEL_PREFIX_ID
 
__vt_


	)

95 #i‡
deföed
 
__˝lu•lus
 || deföed 
__STDC__


96 
	#_G_ARGS
(
ARGLIST
Ë
	)
ARGLIST

98 
	#_G_ARGS
(
ARGLIST
Ë()

	)

	@/usr/include/asm/ioctls.h

1 #i‚de‡
_ASM_X86_IOCTLS_H


2 
	#_ASM_X86_IOCTLS_H


	)

4 
	~<asm/io˘l.h
>

8 
	#TCGETS
 0x5401

	)

9 
	#TCSETS
 0x5402

	)

10 
	#TCSETSW
 0x5403

	)

11 
	#TCSETSF
 0x5404

	)

12 
	#TCGETA
 0x5405

	)

13 
	#TCSETA
 0x5406

	)

14 
	#TCSETAW
 0x5407

	)

15 
	#TCSETAF
 0x5408

	)

16 
	#TCSBRK
 0x5409

	)

17 
	#TCXONC
 0x540A

	)

18 
	#TCFLSH
 0x540B

	)

19 
	#TIOCEXCL
 0x540C

	)

20 
	#TIOCNXCL
 0x540D

	)

21 
	#TIOCSCTTY
 0x540E

	)

22 
	#TIOCGPGRP
 0x540F

	)

23 
	#TIOCSPGRP
 0x5410

	)

24 
	#TIOCOUTQ
 0x5411

	)

25 
	#TIOCSTI
 0x5412

	)

26 
	#TIOCGWINSZ
 0x5413

	)

27 
	#TIOCSWINSZ
 0x5414

	)

28 
	#TIOCMGET
 0x5415

	)

29 
	#TIOCMBIS
 0x5416

	)

30 
	#TIOCMBIC
 0x5417

	)

31 
	#TIOCMSET
 0x5418

	)

32 
	#TIOCGSOFTCAR
 0x5419

	)

33 
	#TIOCSSOFTCAR
 0x541A

	)

34 
	#FIONREAD
 0x541B

	)

35 
	#TIOCINQ
 
FIONREAD


	)

36 
	#TIOCLINUX
 0x541C

	)

37 
	#TIOCCONS
 0x541D

	)

38 
	#TIOCGSERIAL
 0x541E

	)

39 
	#TIOCSSERIAL
 0x541F

	)

40 
	#TIOCPKT
 0x5420

	)

41 
	#FIONBIO
 0x5421

	)

42 
	#TIOCNOTTY
 0x5422

	)

43 
	#TIOCSETD
 0x5423

	)

44 
	#TIOCGETD
 0x5424

	)

45 
	#TCSBRKP
 0x5425

	)

47 
	#TIOCSBRK
 0x5427

	)

48 
	#TIOCCBRK
 0x5428

	)

49 
	#TIOCGSID
 0x5429

	)

50 
	#TCGETS2
 
	`_IOR
('T',0x2A, 
ãrmios2
)

	)

51 
	#TCSETS2
 
	`_IOW
('T',0x2B, 
ãrmios2
)

	)

52 
	#TCSETSW2
 
	`_IOW
('T',0x2C, 
ãrmios2
)

	)

53 
	#TCSETSF2
 
	`_IOW
('T',0x2D, 
ãrmios2
)

	)

54 
	#TIOCGPTN
 
	`_IOR
('T',0x30, Ë

	)

55 
	#TIOCSPTLCK
 
	`_IOW
('T',0x31, Ë

	)

56 
	#TIOCGDEV
 
	`_IOR
('T',0x32, Ë

	)

58 
	#FIONCLEX
 0x5450

	)

59 
	#FIOCLEX
 0x5451

	)

60 
	#FIOASYNC
 0x5452

	)

61 
	#TIOCSERCONFIG
 0x5453

	)

62 
	#TIOCSERGWILD
 0x5454

	)

63 
	#TIOCSERSWILD
 0x5455

	)

64 
	#TIOCGLCKTRMIOS
 0x5456

	)

65 
	#TIOCSLCKTRMIOS
 0x5457

	)

66 
	#TIOCSERGSTRUCT
 0x5458

	)

67 
	#TIOCSERGETLSR
 0x5459

	)

68 
	#TIOCSERGETMULTI
 0x545A

	)

69 
	#TIOCSERSETMULTI
 0x545B

	)

71 
	#TIOCMIWAIT
 0x545C

	)

72 
	#TIOCGICOUNT
 0x545D

	)

73 
	#TIOCGHAYESESP
 0x545E

	)

74 
	#TIOCSHAYESESP
 0x545F

	)

75 
	#FIOQSIZE
 0x5460

	)

78 
	#TIOCPKT_DATA
 0

	)

79 
	#TIOCPKT_FLUSHREAD
 1

	)

80 
	#TIOCPKT_FLUSHWRITE
 2

	)

81 
	#TIOCPKT_STOP
 4

	)

82 
	#TIOCPKT_START
 8

	)

83 
	#TIOCPKT_NOSTOP
 16

	)

84 
	#TIOCPKT_DOSTOP
 32

	)

86 
	#TIOCSER_TEMT
 0x01

	)

	@/usr/include/asm/sigcontext.h

1 #i‚de‡
_ASM_X86_SIGCONTEXT_H


2 
	#_ASM_X86_SIGCONTEXT_H


	)

4 
	~<asm/ty≥s.h
>

6 #ifde‡
__i386__


21 
	s_Âªg
 {

22 
	msignifiˇnd
[4];

23 
	mexp⁄ít
;

26 
	s_Âxªg
 {

27 
	msignifiˇnd
[4];

28 
	mexp⁄ít
;

29 
	m∑ddög
[3];

32 
	s_xmmªg
 {

33 
	mñemít
[4];

36 
	s_Â°©e
 {

38 
	mcw
;

39 
	msw
;

40 
	mèg
;

41 
	mùoff
;

42 
	mcs£l
;

43 
	md©aoff
;

44 
	md©a£l
;

45 
_Âªg
 
	m_°
[8];

46 
	m°©us
;

47 
	mmagic
;

50 
	m_fx§_ív
[6];

51 
	mmxc§
;

52 
	mª£rved
;

53 
_Âxªg
 
	m_fx§_°
[8];

54 
_xmmªg
 
	m_xmm
[8];

55 
	m∑ddög
[56];

58 
	#X86_FXSR_MAGIC
 0x0000

	)

63 
	ssigc⁄ãxt
 {

64 
	mgs
, 
	m__gsh
;

65 
	mfs
, 
	m__fsh
;

66 
	mes
, 
	m__esh
;

67 
	mds
, 
	m__dsh
;

68 
	medi
;

69 
	mesi
;

70 
	mebp
;

71 
	me•
;

72 
	mebx
;

73 
	medx
;

74 
	mecx
;

75 
	móx
;

76 
	må≠no
;

77 
	mîr
;

78 
	meù
;

79 
	mcs
, 
	m__csh
;

80 
	meÊags
;

81 
	me•_©_sig«l
;

82 
	mss
, 
	m__ssh
;

83 
_Â°©e
 * 
	mÂ°©e
;

84 
	mﬁdmask
;

85 
	m¸2
;

93 
	s_Â°©e
 {

94 
__u16
 
	mcwd
;

95 
__u16
 
	mswd
;

96 
__u16
 
	mtwd
;

97 
__u16
 
	mf›
;

98 
__u64
 
	mrù
;

99 
__u64
 
	mrdp
;

100 
__u32
 
	mmxc§
;

101 
__u32
 
	mmxc§_mask
;

102 
__u32
 
	m°_•a˚
[32];

103 
__u32
 
	mxmm_•a˚
[64];

104 
__u32
 
	mª£rved2
[24];

110 
	ssigc⁄ãxt
 {

111 
	mr8
;

112 
	mr9
;

113 
	mr10
;

114 
	mr11
;

115 
	mr12
;

116 
	mr13
;

117 
	mr14
;

118 
	mr15
;

119 
	mrdi
;

120 
	mrsi
;

121 
	mrbp
;

122 
	mrbx
;

123 
	mrdx
;

124 
	møx
;

125 
	mrcx
;

126 
	mr•
;

127 
	mrù
;

128 
	meÊags
;

129 
	mcs
;

130 
	mgs
;

131 
	mfs
;

132 
	m__∑d0
;

133 
	mîr
;

134 
	må≠no
;

135 
	mﬁdmask
;

136 
	m¸2
;

137 
_Â°©e
 *
	mÂ°©e
;

138 
	mª£rved1
[8];

	@/usr/include/asm/socket.h

1 #i‚de‡
_ASM_SOCKET_H


2 
	#_ASM_SOCKET_H


	)

4 
	~<asm/sockios.h
>

7 
	#SOL_SOCKET
 1

	)

9 
	#SO_DEBUG
 1

	)

10 
	#SO_REUSEADDR
 2

	)

11 
	#SO_TYPE
 3

	)

12 
	#SO_ERROR
 4

	)

13 
	#SO_DONTROUTE
 5

	)

14 
	#SO_BROADCAST
 6

	)

15 
	#SO_SNDBUF
 7

	)

16 
	#SO_RCVBUF
 8

	)

17 
	#SO_SNDBUFFORCE
 32

	)

18 
	#SO_RCVBUFFORCE
 33

	)

19 
	#SO_KEEPALIVE
 9

	)

20 
	#SO_OOBINLINE
 10

	)

21 
	#SO_NO_CHECK
 11

	)

22 
	#SO_PRIORITY
 12

	)

23 
	#SO_LINGER
 13

	)

25 
	#SO_PASSCRED
 16

	)

26 
	#SO_PEERCRED
 17

	)

27 
	#SO_RCVLOWAT
 18

	)

28 
	#SO_SNDLOWAT
 19

	)

29 
	#SO_RCVTIMEO
 20

	)

30 
	#SO_SNDTIMEO
 21

	)

33 
	#SO_SECURITY_AUTHENTICATION
 22

	)

34 
	#SO_SECURITY_ENCRYPTION_TRANSPORT
 23

	)

35 
	#SO_SECURITY_ENCRYPTION_NETWORK
 24

	)

37 
	#SO_BINDTODEVICE
 25

	)

40 
	#SO_ATTACH_FILTER
 26

	)

41 
	#SO_DETACH_FILTER
 27

	)

43 
	#SO_PEERNAME
 28

	)

44 
	#SO_TIMESTAMP
 29

	)

45 
	#SCM_TIMESTAMP
 
SO_TIMESTAMP


	)

47 
	#SO_ACCEPTCONN
 30

	)

49 
	#SO_PEERSEC
 31

	)

50 
	#SO_PASSSEC
 34

	)

51 
	#SO_TIMESTAMPNS
 35

	)

52 
	#SCM_TIMESTAMPNS
 
SO_TIMESTAMPNS


	)

54 
	#SO_MARK
 36

	)

	@/usr/include/bits/endian.h

3 #i‚de‡
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/libio-ldbl.h

20 #i‚de‡
_IO_STDIO_H


24 
	$__LDBL_REDIR_DECL
 (
_IO_vfsˇnf
)

25 
	`__LDBL_REDIR_DECL
 (
_IO_vÂrötf
)

	@/usr/include/bits/stdio-lock.h

20 #i‚de‡
_BITS_STDIO_LOCK_H


21 
	#_BITS_STDIO_LOCK_H
 1

	)

23 
	~<bôs/libc-lock.h
>

25 
	$__libc_lock_deföe_ªcursive
 (, 
_IO_lock_t
)

28 #ifde‡
	t_LIBC_LOCK_RECURSIVE_INITIALIZER


29 
	t_IO_lock_öôülizî
 
	t_LIBC_LOCK_RECURSIVE_INITIALIZER


	)

30 #ñi‡
	t_IO_MTSAFE_IO


31 #îr‹ 
	tlibio
 
	t√eds
 
	tªcursive
 
	tmuãxes
 
	t_IO_MTSAFE_IO


34 
	t_IO_lock_öô
(
	t_«me
Ë
	t__libc_lock_öô_ªcursive
 (_«me)

	)

35 
	t_IO_lock_föi
(
	t_«me
Ë
	t__libc_lock_föi_ªcursive
 (_«me)

	)

36 
	t_IO_lock_lock
(
	t_«me
Ë
	t__libc_lock_lock_ªcursive
 (_«me)

	)

37 
	t_IO_lock_åylock
(
	t_«me
Ë
	t__libc_lock_åylock_ªcursive
 (_«me)

	)

38 
	t_IO_lock_u∆ock
(
	t_«me
Ë
	t__libc_lock_u∆ock_ªcursive
 (_«me)

	)

41 
	t_IO_˛ónup_ªgi⁄_°¨t
(
	t_f˘
, 
	t_Â
) \

42 
	t__libc_˛ónup_ªgi⁄_°¨t
 (((
	t_Â
)->
	t_Êags
 & 
	t_IO_USER_LOCK
Ë=0, 
	t_f˘
, _Â)

	)

43 
	t_IO_˛ónup_ªgi⁄_°¨t_nﬂrg
(
	t_f˘
) \

44 
	t__libc_˛ónup_ªgi⁄_°¨t
 (1, 
	t_f˘
, 
	tNULL
)

	)

45 
	t_IO_˛ónup_ªgi⁄_íd
(
	t_doô
) \

46 
	t__libc_˛ónup_ªgi⁄_íd
 (
	t_doô
)

	)

48 #i‡
	tdeföed
 
	t_LIBC
 && !deföed 
	tNOT_IN_libc


49 
	t_IO_acquúe_lock
(
	t_Â
) \

50 
	t_IO_˛ónup_ªgi⁄_°¨t
 (((*Ë(*)Ë
	t_IO_fu∆ockfûe
, (
	t_Â
)); \

51 
	`_IO_Êockfûe
 (
_Â
)

	)

53 
	#_IO_ªÀa£_lock
(
_Â
) \

54 
	`_IO_fu∆ockfûe
 (
_Â
); \

55 
	`_IO_˛ónup_ªgi⁄_íd
 (0)

	)

	@/usr/include/bits/typesizes.h

20 #i‚de‡
_BITS_TYPES_H


24 #i‚def 
_BITS_TYPESIZES_H


25 
	#_BITS_TYPESIZES_H
 1

	)

30 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

31 
	#__UID_T_TYPE
 
__U32_TYPE


	)

32 
	#__GID_T_TYPE
 
__U32_TYPE


	)

33 
	#__INO_T_TYPE
 
__ULONGWORD_TYPE


	)

34 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

35 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

36 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

37 
	#__OFF_T_TYPE
 
__SLONGWORD_TYPE


	)

38 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

39 
	#__PID_T_TYPE
 
__S32_TYPE


	)

40 
	#__RLIM_T_TYPE
 
__ULONGWORD_TYPE


	)

41 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

42 
	#__BLKCNT_T_TYPE
 
__SLONGWORD_TYPE


	)

43 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

44 
	#__FSBLKCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

45 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

46 
	#__FSFILCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

47 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

48 
	#__ID_T_TYPE
 
__U32_TYPE


	)

49 
	#__CLOCK_T_TYPE
 
__SLONGWORD_TYPE


	)

50 
	#__TIME_T_TYPE
 
__SLONGWORD_TYPE


	)

51 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

52 
	#__SUSECONDS_T_TYPE
 
__SLONGWORD_TYPE


	)

53 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

54 
	#__SWBLK_T_TYPE
 
__SLONGWORD_TYPE


	)

55 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

56 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

57 
	#__TIMER_T_TYPE
 *

	)

58 
	#__BLKSIZE_T_TYPE
 
__SLONGWORD_TYPE


	)

59 
	#__FSID_T_TYPE
 såu˘ { 
__vÆ
[2]; }

	)

60 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

63 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/uio.h

19 #i‡!
deföed
 
_SYS_UIO_H
 && !deföed 
_FCNTL_H


23 #i‚de‡
_BITS_UIO_H


24 
	#_BITS_UIO_H
 1

	)

26 
	~<sys/ty≥s.h
>

40 
	#UIO_MAXIOV
 1024

	)

44 
	siovec


46 *
	miov_ba£
;

47 
size_t
 
	miov_Àn
;

	@/usr/include/bits/wordsize.h

19 
	#__WORDSIZE
 32

	)

	@/usr/include/ctype.h

24 #i‚def 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<„©uªs.h
>

28 
	~<bôs/ty≥s.h
>

30 
	g__BEGIN_DECLS


32 #i‚de‡
_ISbô


41 
	~<ídün.h
>

42 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


43 
	#_ISbô
(
bô
Ë(1 << (bô))

	)

45 
	#_ISbô
(
bô
Ë((bôË< 8 ? ((1 << (bô)Ë<< 8Ë: ((1 << (bô)Ë>> 8))

	)

50 
	m_ISuµî
 = 
_ISbô
 (0),

51 
	m_ISlowî
 = 
_ISbô
 (1),

52 
	m_ISÆpha
 = 
_ISbô
 (2),

53 
	m_ISdigô
 = 
_ISbô
 (3),

54 
	m_ISxdigô
 = 
_ISbô
 (4),

55 
	m_IS•a˚
 = 
_ISbô
 (5),

56 
	m_IS¥öt
 = 
_ISbô
 (6),

57 
	m_ISgøph
 = 
_ISbô
 (7),

58 
	m_ISbœnk
 = 
_ISbô
 (8),

59 
	m_IS˙ål
 = 
_ISbô
 (9),

60 
	m_ISpun˘
 = 
_ISbô
 (10),

61 
	m_ISÆnum
 = 
_ISbô
 (11)

81 
__c⁄°
 **
	$__˘y≥_b_loc
 ()

82 
__THROW
 
	`__©åibuã__
 ((
__c⁄°
));

83 
__c⁄°
 
__öt32_t
 **
	$__˘y≥_tﬁowî_loc
 ()

84 
__THROW
 
	`__©åibuã__
 ((
__c⁄°
));

85 
__c⁄°
 
__öt32_t
 **
	$__˘y≥_touµî_loc
 ()

86 
__THROW
 
	`__©åibuã__
 ((
__c⁄°
));

88 
	#__is˘y≥
(
c
, 
ty≥
) \

89 ((*
	`__˘y≥_b_loc
 ())[(Ë(
c
)] & (Ë
ty≥
)

	)

91 
	#__ißscii
(
c
Ë(((cË& ~0x7fË=0Ë

	)

92 
	#__tﬂscii
(
c
Ë((cË& 0x7fË

	)

94 
	#__ex˘y≥
(
«me
Ë
	`«me
 (Ë
__THROW


	)

96 
__BEGIN_NAMESPACE_STD


102 
	`__ex˘y≥
 (
iß um
);

103 
	`__ex˘y≥
 (
ißÕha
);

104 
	`__ex˘y≥
 (
is˙ål
);

105 
	`__ex˘y≥
 (
isdigô
);

106 
	`__ex˘y≥
 (
i¶owî
);

107 
	`__ex˘y≥
 (
isgøph
);

108 
	`__ex˘y≥
 (
i•röt
);

109 
	`__ex˘y≥
 (
i•un˘
);

110 
	`__ex˘y≥
 (
is•a˚
);

111 
	`__ex˘y≥
 (
isuµî
);

112 
	`__ex˘y≥
 (
isxdigô
);

116 
	$tﬁowî
 (
__c
Ë
__THROW
;

119 
	$touµî
 (
__c
Ë
__THROW
;

121 
__END_NAMESPACE_STD


125 #ifdef 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
	`__ex˘y≥
 (
isbœnk
);

130 
__END_NAMESPACE_C99


133 #ifde‡
__USE_GNU


135 
	$is˘y≥
 (
__c
, 
__mask
Ë
__THROW
;

138 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


142 
	$ißscii
 (
__c
Ë
__THROW
;

146 
	$tﬂscii
 (
__c
Ë
__THROW
;

150 
	`__ex˘y≥
 (
_touµî
);

151 
	`__ex˘y≥
 (
_tﬁowî
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¨gs
) \

156 (
__exãnsi⁄__
 \

157 ({ 
__ªs
; \

158 i‡( (
c
) > 1) \

160 i‡(
	`__buûtö_c⁄°™t_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__ªs
 = 
__c
 < -128 || __¯> 255 ? __¯: (
a
)[__c]; \

166 
__ªs
 = 
f
 
¨gs
; \

169 
__ªs
 = (
a
)[(Ë(
c
)]; \

170 
__ªs
; 
	}
}))

	)

172 #i‡!
deföed
 
__NO_CTYPE
 && !deföed 
__˝lu•lus


173 
	#iß um
(
c
Ë
	`__is˘y≥
((c), 
_ISÆnum
)

	)

174 
	#ißÕha
(
c
Ë
	`__is˘y≥
((c), 
_ISÆpha
)

	)

175 
	#is˙ål
(
c
Ë
	`__is˘y≥
((c), 
_IS˙ål
)

	)

176 
	#isdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISdigô
)

	)

177 
	#i¶owî
(
c
Ë
	`__is˘y≥
((c), 
_ISlowî
)

	)

178 
	#isgøph
(
c
Ë
	`__is˘y≥
((c), 
_ISgøph
)

	)

179 
	#i•röt
(
c
Ë
	`__is˘y≥
((c), 
_IS¥öt
)

	)

180 
	#i•un˘
(
c
Ë
	`__is˘y≥
((c), 
_ISpun˘
)

	)

181 
	#is•a˚
(
c
Ë
	`__is˘y≥
((c), 
_IS•a˚
)

	)

182 
	#isuµî
(
c
Ë
	`__is˘y≥
((c), 
_ISuµî
)

	)

183 
	#isxdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISxdigô
)

	)

185 #ifde‡
__USE_ISOC99


186 
	#isbœnk
(
c
Ë
	`__is˘y≥
((c), 
_ISbœnk
)

	)

189 #ifde‡
__USE_EXTERN_INLINES


190 
__exã∫_ölöe
 

191 
__NTH
 (
	$tﬁowî
 (
__c
))

193  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_tﬁowî_loc
 ())[__c] : __c;

194 
	}
}

196 
__exã∫_ölöe
 

197 
__NTH
 (
	$touµî
 (
__c
))

199  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_touµî_loc
 ())[__c] : __c;

200 
	}
}

203 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


204 
	#tﬁowî
(
c
Ë
	`__tobody
 (c, 
tﬁowî
, *
	`__˘y≥_tﬁowî_loc
 (), (c))

	)

205 
	#touµî
(
c
Ë
	`__tobody
 (c, 
touµî
, *
	`__˘y≥_touµî_loc
 (), (c))

	)

208 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


209 
	#ißscii
(
c
Ë
	`__ißscii
 (c)

	)

210 
	#tﬂscii
(
c
Ë
	`__tﬂscii
 (c)

	)

212 
	#_tﬁowî
(
c
Ë((Ë(*
	`__˘y≥_tﬁowî_loc
 ())[(Ë(c)])

	)

213 
	#_touµî
(
c
Ë((Ë(*
	`__˘y≥_touµî_loc
 ())[(Ë(c)])

	)

219 #ifde‡
__USE_GNU


233 
	~<xloˇÀ.h
>

237 
	#__is˘y≥_l
(
c
, 
ty≥
, 
loˇÀ
) \

238 ((
loˇÀ
)->
__˘y≥_b
[(Ë(
c
)] & (Ë
ty≥
)

	)

240 
	#__ex˘y≥_l
(
«me
) \

241 
	`«me
 (, 
__loˇÀ_t
Ë
__THROW


	)

247 
__ex˘y≥_l
 (
iß um_l
);

248 
__ex˘y≥_l
 (
ißÕha_l
);

249 
__ex˘y≥_l
 (
is˙ål_l
);

250 
__ex˘y≥_l
 (
isdigô_l
);

251 
__ex˘y≥_l
 (
i¶owî_l
);

252 
__ex˘y≥_l
 (
isgøph_l
);

253 
__ex˘y≥_l
 (
i•röt_l
);

254 
__ex˘y≥_l
 (
i•un˘_l
);

255 
__ex˘y≥_l
 (
is•a˚_l
);

256 
__ex˘y≥_l
 (
isuµî_l
);

257 
__ex˘y≥_l
 (
isxdigô_l
);

259 
__ex˘y≥_l
 (
isbœnk_l
);

263 
	$__tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

264 
	$tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

267 
	$__touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

268 
	$touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

270 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


271 
	#__tﬁowî_l
(
c
, 
loˇÀ
) \

272 
	`__tobody
 (
c
, 
__tﬁowî_l
, (
loˇÀ
)->
__˘y≥_tﬁowî
, (c,ÜoˇÀ))

	)

273 
	#__touµî_l
(
c
, 
loˇÀ
) \

274 
	`__tobody
 (
c
, 
__touµî_l
, (
loˇÀ
)->
__˘y≥_touµî
, (c,ÜoˇÀ))

	)

275 
	#tﬁowî_l
(
c
, 
loˇÀ
Ë
	`__tﬁowî_l
 ((c), (loˇÀ))

	)

276 
	#touµî_l
(
c
, 
loˇÀ
Ë
	`__touµî_l
 ((c), (loˇÀ))

	)

280 #i‚de‡
__NO_CTYPE


281 
	#__iß um_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆnum
, (l))

	)

282 
	#__ißÕha_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆpha
, (l))

	)

283 
	#__is˙ål_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS˙ål
, (l))

	)

284 
	#__isdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISdigô
, (l))

	)

285 
	#__i¶owî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISlowî
, (l))

	)

286 
	#__isgøph_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISgøph
, (l))

	)

287 
	#__i•röt_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS¥öt
, (l))

	)

288 
	#__i•un˘_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISpun˘
, (l))

	)

289 
	#__is•a˚_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS•a˚
, (l))

	)

290 
	#__isuµî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISuµî
, (l))

	)

291 
	#__isxdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISxdigô
, (l))

	)

293 
	#__isbœnk_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISbœnk
, (l))

	)

295 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


296 
	#__ißscii_l
(
c
,
l
Ë(÷), 
	`__ißscii
 (c))

	)

297 
	#__tﬂscii_l
(
c
,
l
Ë(÷), 
	`__tﬂscii
 (c))

	)

300 
	#iß um_l
(
c
,
l
Ë
	`__iß um_l
 ((c), (l))

	)

301 
	#ißÕha_l
(
c
,
l
Ë
	`__ißÕha_l
 ((c), (l))

	)

302 
	#is˙ål_l
(
c
,
l
Ë
	`__is˙ål_l
 ((c), (l))

	)

303 
	#isdigô_l
(
c
,
l
Ë
	`__isdigô_l
 ((c), (l))

	)

304 
	#i¶owî_l
(
c
,
l
Ë
	`__i¶owî_l
 ((c), (l))

	)

305 
	#isgøph_l
(
c
,
l
Ë
	`__isgøph_l
 ((c), (l))

	)

306 
	#i•röt_l
(
c
,
l
Ë
	`__i•röt_l
 ((c), (l))

	)

307 
	#i•un˘_l
(
c
,
l
Ë
	`__i•un˘_l
 ((c), (l))

	)

308 
	#is•a˚_l
(
c
,
l
Ë
	`__is•a˚_l
 ((c), (l))

	)

309 
	#isuµî_l
(
c
,
l
Ë
	`__isuµî_l
 ((c), (l))

	)

310 
	#isxdigô_l
(
c
,
l
Ë
	`__isxdigô_l
 ((c), (l))

	)

312 
	#isbœnk_l
(
c
,
l
Ë
	`__isbœnk_l
 ((c), (l))

	)

314 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


315 
	#ißscii_l
(
c
,
l
Ë
	`__ißscii_l
 ((c), (l))

	)

316 
	#tﬂscii_l
(
c
,
l
Ë
	`__tﬂscii_l
 ((c), (l))

	)

323 
__END_DECLS


	@/usr/include/gnu/stubs.h

4 
	~<bôs/w‹dsize.h
>

6 #i‡
__WORDSIZE
 == 32

7 
	~<gnu/°ubs-32.h
>

8 #ñi‡
__WORDSIZE
 == 64

9 
	~<gnu/°ubs-64.h
>

	@/usr/include/limits.h

24 #i‚de‡
_LIBC_LIMITS_H_


25 
	#_LIBC_LIMITS_H_
 1

	)

27 
	~<„©uªs.h
>

33 
	#MB_LEN_MAX
 16

	)

38 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

43 #i‚de‡
_LIMITS_H


44 
	#_LIMITS_H
 1

	)

46 
	~<bôs/w‹dsize.h
>

55 
	#CHAR_BIT
 8

	)

58 
	#SCHAR_MIN
 (-128)

	)

59 
	#SCHAR_MAX
 127

	)

62 
	#UCHAR_MAX
 255

	)

65 #ifde‡
__CHAR_UNSIGNED__


66 
	#CHAR_MIN
 0

	)

67 
	#CHAR_MAX
 
UCHAR_MAX


	)

69 
	#CHAR_MIN
 
SCHAR_MIN


	)

70 
	#CHAR_MAX
 
SCHAR_MAX


	)

74 
	#SHRT_MIN
 (-32768)

	)

75 
	#SHRT_MAX
 32767

	)

78 
	#USHRT_MAX
 65535

	)

81 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

82 
	#INT_MAX
 2147483647

	)

85 
	#UINT_MAX
 4294967295U

	)

88 #i‡
__WORDSIZE
 == 64

89 
	#LONG_MAX
 9223372036854775807L

	)

91 
	#LONG_MAX
 2147483647L

	)

93 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

96 #i‡
__WORDSIZE
 == 64

97 
	#ULONG_MAX
 18446744073709551615UL

	)

99 
	#ULONG_MAX
 4294967295UL

	)

102 #ifde‡
__USE_ISOC99


105 
	#LLONG_MAX
 9223372036854775807LL

	)

106 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

109 
	#ULLONG_MAX
 18446744073709551615ULL

	)

123 #i‡
deföed
 
__GNUC__
 && !deföed 
_GCC_LIMITS_H_


125 #ö˛ude_√xà<
limôs
.
h
>

131 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__


132 #i‚de‡
LLONG_MIN


133 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

135 #i‚de‡
LLONG_MAX


136 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

138 #i‚de‡
ULLONG_MAX


139 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

143 #ifdef 
__USE_POSIX


145 
	~<bôs/posix1_lim.h
>

148 #ifdef 
__USE_POSIX2


149 
	~<bôs/posix2_lim.h
>

152 #ifdef 
__USE_XOPEN


153 
	~<bôs/x›í_lim.h
>

	@/usr/include/linux/errno.h

1 #i‚de‡
_LINUX_ERRNO_H


2 
	#_LINUX_ERRNO_H


	)

4 
	~<asm/î∫o.h
>

	@/usr/include/asm/errno.h

1 
	~<asm-gíîic/î∫o.h
>

	@/usr/include/asm/ioctl.h

1 
	~<asm-gíîic/io˘l.h
>

	@/usr/include/asm/sockios.h

1 #i‚de‡
_ASM_X86_SOCKIOS_H


2 
	#_ASM_X86_SOCKIOS_H


	)

5 
	#FIOSETOWN
 0x8901

	)

6 
	#SIOCSPGRP
 0x8902

	)

7 
	#FIOGETOWN
 0x8903

	)

8 
	#SIOCGPGRP
 0x8904

	)

9 
	#SIOCATMARK
 0x8905

	)

10 
	#SIOCGSTAMP
 0x8906

	)

11 
	#SIOCGSTAMPNS
 0x8907

	)

	@/usr/include/asm/types.h

1 #i‚de‡
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 #i‚de‡
__ASSEMBLY__


6 
	tumode_t
;

13 
__sig√d__
 
	t__s8
;

14 
	t__u8
;

16 
__sig√d__
 
	t__s16
;

17 
	t__u16
;

19 
__sig√d__
 
	t__s32
;

20 
	t__u32
;

22 #ifde‡
__i386__


23 #ifde‡
__GNUC__


24 
__exãnsi⁄__
 
__sig√d__
 
	t__s64
;

25 
__exãnsi⁄__
 
	t__u64
;

28 
__sig√d__
 
	t__s64
;

29 
	t__u64
;

	@/usr/include/bits/libc-lock.h

20 #i‚de‡
_BITS_LIBC_LOCK_H


21 
	#_BITS_LIBC_LOCK_H
 1

	)

23 
	~<±hªad.h
>

24 
	#__√ed_NULL


	)

25 
	~<°ddef.h
>

34 #ifde‡
_LIBC


35 
	~<lowÀvñlock.h
>

36 
	~<és.h
>

37 
	~<±hªad-fun˘i⁄s.h
>

41 #i‡
deföed
 
_LIBC
 || deföed 
_IO_MTSAFE_IO


42 #i‡(
deföed
 
NOT_IN_libc
 && !deföed 
IS_IN_lib±hªad
Ë|| !deföed 
_LIBC


43 
±hªad_muãx_t
 
	t__libc_lock_t
;

44 °ru˘ { 
±hªad_muãx_t
 
	mmuãx
; } 
	t__libc_lock_ªcursive_t
;

46 
	t__libc_lock_t
;

47 °ru˘ { 
	mlock
; 
	m˙t
; *
	mow√r
; } 
	t__libc_lock_ªcursive_t
;

49 °ru˘ { 
±hªad_muãx_t
 
	mmuãx
; } 
	t__πld_lock_ªcursive_t
;

50 #ifde‡
__USE_UNIX98


51 
±hªad_rwlock_t
 
	t__libc_rwlock_t
;

53 
__libc_rwlock_›aque__
 
	t__libc_rwlock_t
;

56 
__libc_lock_›aque__
 
	t__libc_lock_t
;

57 
__libc_lock_ªcursive_›aque__
 
	t__libc_lock_ªcursive_t
;

58 
__libc_rwlock_›aque__
 
	t__libc_rwlock_t
;

62 
±hªad_key_t
 
	t__libc_key_t
;

71 
	#__libc_lock_deföe
(
CLASS
,
NAME
) \

72 
CLASS
 
__libc_lock_t
 
NAME
;

	)

73 
	#__libc_rwlock_deföe
(
CLASS
,
NAME
) \

74 
CLASS
 
__libc_rwlock_t
 
NAME
;

	)

75 
	#__libc_lock_deföe_ªcursive
(
CLASS
,
NAME
) \

76 
CLASS
 
__libc_lock_ªcursive_t
 
NAME
;

	)

77 
	#__πld_lock_deföe_ªcursive
(
CLASS
,
NAME
) \

78 
CLASS
 
__πld_lock_ªcursive_t
 
NAME
;

	)

89 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

90 #i‡
LLL_LOCK_INITIALIZER
 == 0

91 
	#__libc_lock_deföe_öôülized
(
CLASS
,
NAME
) \

92 
CLASS
 
__libc_lock_t
 
NAME
;

	)

94 
	#__libc_lock_deföe_öôülized
(
CLASS
,
NAME
) \

95 
CLASS
 
__libc_lock_t
 
NAME
 = 
LLL_LOCK_INITIALIZER
;

	)

98 #i‡
__LT_SPINLOCK_INIT
 == 0

99 
	#__libc_lock_deföe_öôülized
(
CLASS
,
NAME
) \

100 
CLASS
 
__libc_lock_t
 
NAME
;

	)

102 
	#__libc_lock_deföe_öôülized
(
CLASS
,
NAME
) \

103 
CLASS
 
__libc_lock_t
 
NAME
 = 
PTHREAD_MUTEX_INITIALIZER
;

	)

107 
	#__libc_rwlock_deföe_öôülized
(
CLASS
,
NAME
) \

108 
CLASS
 
__libc_rwlock_t
 
NAME
 = 
PTHREAD_RWLOCK_INITIALIZER
;

	)

112 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

113 #i‡
LLL_LOCK_INITIALIZER
 == 0

114 
	#__libc_lock_deföe_öôülized_ªcursive
(
CLASS
,
NAME
) \

115 
CLASS
 
__libc_lock_ªcursive_t
 
NAME
;

	)

117 
	#__libc_lock_deföe_öôülized_ªcursive
(
CLASS
,
NAME
) \

118 
CLASS
 
__libc_lock_ªcursive_t
 
NAME
 = 
_LIBC_LOCK_RECURSIVE_INITIALIZER
;

	)

120 
	#_LIBC_LOCK_RECURSIVE_INITIALIZER
 \

121 { 
LLL_LOCK_INITIALIZER
, 0, 
NULL
 }

	)

123 
	#__libc_lock_deföe_öôülized_ªcursive
(
CLASS
,
NAME
) \

124 
CLASS
 
__libc_lock_ªcursive_t
 
NAME
 = 
_LIBC_LOCK_RECURSIVE_INITIALIZER
;

	)

125 
	#_LIBC_LOCK_RECURSIVE_INITIALIZER
 \

126 {
PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
}

	)

129 
	#__πld_lock_deföe_öôülized_ªcursive
(
CLASS
,
NAME
) \

130 
CLASS
 
__πld_lock_ªcursive_t
 
NAME
 = 
_RTLD_LOCK_RECURSIVE_INITIALIZER
;

	)

131 
	#_RTLD_LOCK_RECURSIVE_INITIALIZER
 \

132 {
PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
}

	)

134 
	#__πld_lock_öôülize
(
NAME
) \

135 (Ë((
NAME
Ë(
__πld_lock_ªcursive_t
Ë
_RTLD_LOCK_RECURSIVE_INITIALIZER
)

	)

142 #ifde‡
__PIC__


143 
	#__libc_maybe_ˇŒ
(
FUNC
, 
ARGS
, 
ELSE
) \

144 (
	`__exãnsi⁄__
 ({ 
	`__ty≥of
 (
FUNC
Ë*
_‚
 = (FUNC); \

145 
_‚
 !
NULL
 ? (*_‚Ë
ARGS
 : 
ELSE
; }))

	)

147 
	#__libc_maybe_ˇŒ
(
FUNC
, 
ARGS
, 
ELSE
) \

148 (
FUNC
 !
NULL
 ? FUNC 
ARGS
 : 
ELSE
)

	)

152 #i‡
deföed
 
SHARED
 && !deföed 
NOT_IN_libc


153 
	#PTFAVAIL
(
NAME
Ë
__libc_±hªad_fun˘i⁄s_öô


	)

154 
	#__libc_±f_ˇŒ
(
FUNC
, 
ARGS
, 
ELSE
) \

155 (
__libc_±hªad_fun˘i⁄s_öô
 ? 
	`PTHFCT_CALL
 (
±r_
##
FUNC
, 
ARGS
Ë: 
ELSE
)

	)

156 
	#__libc_±f_ˇŒ_Æways
(
FUNC
, 
ARGS
) \

157 
	`PTHFCT_CALL
 (
±r_
##
FUNC
, 
ARGS
)

	)

159 
	#PTFAVAIL
(
NAME
Ë(NAME !
NULL
)

	)

160 
	#__libc_±f_ˇŒ
(
FUNC
, 
ARGS
, 
ELSE
) \

161 
	`__libc_maybe_ˇŒ
 (
FUNC
, 
ARGS
, 
ELSE
)

	)

162 
	#__libc_±f_ˇŒ_Æways
(
FUNC
, 
ARGS
) \

163 
FUNC
 
ARGS


	)

169 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

170 
	#__libc_lock_öô
(
NAME
Ë((NAMEË
LLL_LOCK_INITIALIZER
, 0)

	)

172 
	#__libc_lock_öô
(
NAME
) \

173 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_öô
, (&(
NAME
), 
NULL
), 0)

	)

175 #i‡
deföed
 
SHARED
 && !deföed 
NOT_IN_libc


178 
	#__libc_rwlock_öô
(
NAME
) \

179 (
	`__buûtö_mem£t
 (&(
NAME
), '\0',  (NAME)), 0)

	)

181 
	#__libc_rwlock_öô
(
NAME
) \

182 
	`__libc_maybe_ˇŒ
 (
__±hªad_rwlock_öô
, (&(
NAME
), 
NULL
), 0)

	)

186 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

187 
	#__libc_lock_öô_ªcursive
(
NAME
) \

188 ((
NAME
Ë(
__libc_lock_ªcursive_t
Ë
_LIBC_LOCK_RECURSIVE_INITIALIZER
, 0)

	)

190 
	#__libc_lock_öô_ªcursive
(
NAME
) \

192 i‡(
__±hªad_muãx_öô
 !
NULL
) \

194 
±hªad_muãx©å_t
 
__©å
; \

195 
	`__±hªad_muãx©å_öô
 (&
__©å
); \

196 
	`__±hªad_muãx©å_£ây≥
 (&
__©å
, 
PTHREAD_MUTEX_RECURSIVE_NP
); \

197 
	`__±hªad_muãx_öô
 (&(
NAME
).
muãx
, &
__©å
); \

198 
	`__±hªad_muãx©å_de°roy
 (&
__©å
); \

200 } 0)

	)

203 
	#__πld_lock_öô_ªcursive
(
NAME
) \

205 i‡(
__±hªad_muãx_öô
 !
NULL
) \

207 
±hªad_muãx©å_t
 
__©å
; \

208 
	`__±hªad_muãx©å_öô
 (&
__©å
); \

209 
	`__±hªad_muãx©å_£ây≥
 (&
__©å
, 
PTHREAD_MUTEX_RECURSIVE_NP
); \

210 
	`__±hªad_muãx_öô
 (&(
NAME
).
muãx
, &
__©å
); \

211 
	`__±hªad_muãx©å_de°roy
 (&
__©å
); \

213 } 0)

	)

218 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

219 
	#__libc_lock_föi
(
NAME
Ë((Ë0)

	)

221 
	#__libc_lock_föi
(
NAME
) \

222 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_de°roy
, (&(
NAME
)), 0)

	)

224 #i‡
deföed
 
SHARED
 && !deföed 
NOT_IN_libc


225 
	#__libc_rwlock_föi
(
NAME
Ë((Ë0)

	)

227 
	#__libc_rwlock_föi
(
NAME
) \

228 
	`__libc_maybe_ˇŒ
 (
__±hªad_rwlock_de°roy
, (&(
NAME
)), 0)

	)

232 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

233 
	#__libc_lock_föi_ªcursive
(
NAME
Ë((Ë0)

	)

235 
	#__libc_lock_föi_ªcursive
(
NAME
) \

236 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_de°roy
, (&(
NAME
)), 0)

	)

240 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

241 
	#__libc_lock_lock
(
NAME
) \

242 ({ 
	`Œl_lock
 (
NAME
, 
LLL_PRIVATE
); 0; })

	)

244 
	#__libc_lock_lock
(
NAME
) \

245 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_lock
, (&(
NAME
)), 0)

	)

247 
	#__libc_rwlock_rdlock
(
NAME
) \

248 
	`__libc_±f_ˇŒ
 (
__±hªad_rwlock_rdlock
, (&(
NAME
)), 0)

	)

249 
	#__libc_rwlock_wæock
(
NAME
) \

250 
	`__libc_±f_ˇŒ
 (
__±hªad_rwlock_wæock
, (&(
NAME
)), 0)

	)

253 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

254 
	#__libc_lock_lock_ªcursive
(
NAME
) \

256 *
£lf
 = 
THREAD_SELF
; \

257 i‡((
NAME
).
ow√r
 !
£lf
) \

259 
	`Œl_lock
 ((
NAME
).
lock
, 
LLL_PRIVATE
); \

260 (
NAME
).
ow√r
 = 
£lf
; \

262 ++(
NAME
).
˙t
; \

263 } 0)

	)

265 
	#__libc_lock_lock_ªcursive
(
NAME
) \

266 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_lock
, (&(
NAME
).
muãx
), 0)

	)

270 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

271 
	#__libc_lock_åylock
(
NAME
) \

272 
	`Œl_åylock
 (
NAME
)

	)

274 
	#__libc_lock_åylock
(
NAME
) \

275 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_åylock
, (&(
NAME
)), 0)

	)

277 
	#__libc_rwlock_åyrdlock
(
NAME
) \

278 
	`__libc_maybe_ˇŒ
 (
__±hªad_rwlock_åyrdlock
, (&(
NAME
)), 0)

	)

279 
	#__libc_rwlock_åywæock
(
NAME
) \

280 
	`__libc_maybe_ˇŒ
 (
__±hªad_rwlock_åywæock
, (&(
NAME
)), 0)

	)

283 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

284 
	#__libc_lock_åylock_ªcursive
(
NAME
) \

286 
ªsu…
 = 0; \

287 *
£lf
 = 
THREAD_SELF
; \

288 i‡((
NAME
).
ow√r
 !
£lf
) \

290 i‡(
	`Œl_åylock
 ((
NAME
).
lock
) == 0) \

292 (
NAME
).
ow√r
 = 
£lf
; \

293 (
NAME
).
˙t
 = 1; \

296 
ªsu…
 = 
EBUSY
; \

299 ++(
NAME
).
˙t
; \

300 
ªsu…
; \

301 })

	)

303 
	#__libc_lock_åylock_ªcursive
(
NAME
) \

304 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_åylock
, (&(
NAME
)), 0)

	)

307 
	#__πld_lock_åylock_ªcursive
(
NAME
) \

308 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_åylock
, (&(
NAME
).
muãx
), 0)

	)

311 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

312 
	#__libc_lock_u∆ock
(
NAME
) \

313 
	`Œl_u∆ock
 (
NAME
, 
LLL_PRIVATE
)

	)

315 
	#__libc_lock_u∆ock
(
NAME
) \

316 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_u∆ock
, (&(
NAME
)), 0)

	)

318 
	#__libc_rwlock_u∆ock
(
NAME
) \

319 
	`__libc_±f_ˇŒ
 (
__±hªad_rwlock_u∆ock
, (&(
NAME
)), 0)

	)

322 #i‡
deföed
 
_LIBC
 && (!deföed 
NOT_IN_libc
 || deföed 
IS_IN_lib±hªad
)

324 
	#__libc_lock_u∆ock_ªcursive
(
NAME
) \

326 i‡(--(
NAME
).
˙t
 == 0) \

328 (
NAME
).
ow√r
 = 
NULL
; \

329 
	`Œl_u∆ock
 ((
NAME
).
lock
, 
LLL_PRIVATE
); \

331 } 0)

	)

333 
	#__libc_lock_u∆ock_ªcursive
(
NAME
) \

334 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_u∆ock
, (&(
NAME
)), 0)

	)

337 #i‡
deföed
 
_LIBC
 && deföed 
SHARED


338 
	#__πld_lock_deÁu…_lock_ªcursive
(
lock
) \

339 ++((
±hªad_muãx_t
 *)(
lock
))->
__d©a
.
__cou¡
;

	)

341 
	#__πld_lock_deÁu…_u∆ock_ªcursive
(
lock
) \

342 --((
±hªad_muãx_t
 *)(
lock
))->
__d©a
.
__cou¡
;

	)

344 
	#__πld_lock_lock_ªcursive
(
NAME
) \

345 
	`GL
(
dl_πld_lock_ªcursive
Ë(&(
NAME
).
muãx
)

	)

347 
	#__πld_lock_u∆ock_ªcursive
(
NAME
) \

348 
	`GL
(
dl_πld_u∆ock_ªcursive
Ë(&(
NAME
).
muãx
)

	)

350 
	#__πld_lock_lock_ªcursive
(
NAME
) \

351 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_lock
, (&(
NAME
).
muãx
), 0)

	)

353 
	#__πld_lock_u∆ock_ªcursive
(
NAME
) \

354 
	`__libc_maybe_ˇŒ
 (
__±hªad_muãx_u∆ock
, (&(
NAME
).
muãx
), 0)

	)

358 #i‡
PTHREAD_ONCE_INIT
 == 0

361 
	#__libc_⁄˚_deföe
(
CLASS
, 
NAME
) \

362 
CLASS
 
±hªad_⁄˚_t
 
NAME


	)

364 
	#__libc_⁄˚_deföe
(
CLASS
, 
NAME
) \

365 
CLASS
 
±hªad_⁄˚_t
 
NAME
 = 
PTHREAD_ONCE_INIT


	)

369 
	#__libc_⁄˚
(
ONCE_CONTROL
, 
INIT_FUNCTION
) \

371 i‡(
	`PTFAVAIL
 (
__±hªad_⁄˚
)) \

372 
	`__libc_±f_ˇŒ_Æways
 (
__±hªad_⁄˚
, (&(
ONCE_CONTROL
), \

373 
INIT_FUNCTION
)); \

374 i‡((
ONCE_CONTROL
Ë=
PTHREAD_ONCE_INIT
) { \

375 
	`INIT_FUNCTION
 (); \

376 (
ONCE_CONTROL
) |= 2; \

378 } 0)

	)

385 
_±hªad_˛ónup_push
 (
_±hªad_˛ónup_buf„r
 *
buf„r
,

386 (*
routöe
Ë(*), *
¨g
);

387 
	`_±hªad_˛ónup_p›
 (
_±hªad_˛ónup_buf„r
 *
buf„r
,

388 
execuã
);

389 
	`_±hªad_˛ónup_push_de„r
 (
_±hªad_˛ónup_buf„r
 *
buf„r
,

390 (*
routöe
Ë(*), *
¨g
);

391 
	`_±hªad_˛ónup_p›_ª°‹e
 (
_±hªad_˛ónup_buf„r
 *
buf„r
,

392 
execuã
);

395 
	#__libc_˛ónup_ªgi⁄_°¨t
(
DOIT
, 
FCT
, 
ARG
) \

396 { 
_±hªad_˛ónup_buf„r
 
_buf„r
; \

397 
_avaû
; \

398 i‡(
DOIT
) { \

399 
_avaû
 = 
	`PTFAVAIL
 (
_±hªad_˛ónup_push_de„r
); \

400 i‡(
_avaû
) { \

401 
	`__libc_±f_ˇŒ_Æways
 (
_±hªad_˛ónup_push_de„r
, (&
_buf„r
, 
FCT
, \

402 
ARG
)); \

404 
_buf„r
.
__routöe
 = (
FCT
); \

405 
_buf„r
.
__¨g
 = (
ARG
); \

408 
_avaû
 = 0; \

409 }

	)

412 
	#__libc_˛ónup_ªgi⁄_íd
(
DOIT
) \

413 i‡(
_avaû
) { \

414 
	`__libc_±f_ˇŒ_Æways
 (
_±hªad_˛ónup_p›_ª°‹e
, (&
_buf„r
, 
DOIT
));\

415 } i‡(
DOIT
) \

416 
_buf„r
.
	`__routöe
 (_buf„r.
__¨g
); \

417 
	}

	)
}

420 
	#__libc_˛ónup_íd
(
DOIT
) \

421 i‡(
_avaû
) { \

422 
	`__libc_±f_ˇŒ_Æways
 (
_±hªad_˛ónup_p›_ª°‹e
, (&
_buf„r
, 
DOIT
));\

423 } i‡(
DOIT
) \

424 
_buf„r
.
	`__routöe
 (_buf„r.
__¨g
)

	)

428 
__exã∫_ölöe
 

429 
	$__libc_˛ónup_routöe
 (
__±hªad_˛ónup_‰ame
 *
f
)

431 i‡(
f
->
__do_ô
)

432 
f
->
	`__ˇn˚l_routöe
 (f->
__ˇn˚l_¨g
);

433 
	}
}

435 
	#__libc_˛ónup_push
(
f˘
, 
¨g
) \

437 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

438 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__libc_˛ónup_routöe
))) \

439 { .
__ˇn˚l_routöe
 = (
f˘
), .
__ˇn˚l_¨g
 = (
¨g
), \

440 .
__do_ô
 = 1 };

	)

442 
	#__libc_˛ónup_p›
(
execuã
) \

443 
__˛‰ame
.
__do_ô
 = (
execuã
); \

444 } 0)

	)

448 
	#__libc_key_¸óã
(
KEY
, 
DESTRUCTOR
) \

449 
	`__libc_±f_ˇŒ
 (
__±hªad_key_¸óã
, (
KEY
, 
DESTRUCTOR
), 1)

	)

452 
	#__libc_gë•ecific
(
KEY
) \

453 
	`__libc_±f_ˇŒ
 (
__±hªad_gë•ecific
, (
KEY
), 
NULL
)

	)

456 
	#__libc_£t•ecific
(
KEY
, 
VALUE
) \

457 
	`__libc_±f_ˇŒ
 (
__±hªad_£t•ecific
, (
KEY
, 
VALUE
), 0)

	)

463 
	#__libc_©f‹k
(
PREPARE
, 
PARENT
, 
CHILD
) \

464 
	`__ªgi°î_©f‹k
 (
PREPARE
, 
PARENT
, 
CHILD
, 
NULL
)

	)

465 
__ªgi°î_©f‹k
 ((*
__¥ï¨e
) (),

466 (*
__∑ª¡
) (),

467 (*
__chûd
) (),

468 *
__dso_h™dÀ
);

473 
	`__±hªad_muãx_öô
 (
±hªad_muãx_t
 *
__muãx
,

474 
__c⁄°
 
±hªad_muãx©å_t
 *
__muãx_©å
);

476 
	`__±hªad_muãx_de°roy
 (
±hªad_muãx_t
 *
__muãx
);

478 
	`__±hªad_muãx_åylock
 (
±hªad_muãx_t
 *
__muãx
);

480 
	`__±hªad_muãx_lock
 (
±hªad_muãx_t
 *
__muãx
);

482 
	`__±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 *
__muãx
);

484 
	`__±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 *
__©å
);

486 
	`__±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 *
__©å
);

488 
	`__±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 *
__©å
,

489 
__köd
);

491 #ifde‡
__USE_UNIX98


492 
	`__±hªad_rwlock_öô
 (
±hªad_rwlock_t
 *
__rwlock
,

493 
__c⁄°
 
±hªad_rwlock©å_t
 *
__©å
);

495 
	`__±hªad_rwlock_de°roy
 (
±hªad_rwlock_t
 *
__rwlock
);

497 
	`__±hªad_rwlock_rdlock
 (
±hªad_rwlock_t
 *
__rwlock
);

499 
	`__±hªad_rwlock_åyrdlock
 (
±hªad_rwlock_t
 *
__rwlock
);

501 
	`__±hªad_rwlock_wæock
 (
±hªad_rwlock_t
 *
__rwlock
);

503 
	`__±hªad_rwlock_åywæock
 (
±hªad_rwlock_t
 *
__rwlock
);

505 
	`__±hªad_rwlock_u∆ock
 (
±hªad_rwlock_t
 *
__rwlock
);

508 
	`__±hªad_key_¸óã
 (
±hªad_key_t
 *
__key
,

509 (*
__de°r_fun˘i⁄
) (*));

511 
	`__±hªad_£t•ecific
 (
±hªad_key_t
 
__key
,

512 
__c⁄°
 *
__poöãr
);

514 *
	`__±hªad_gë•ecific
 (
±hªad_key_t
 
__key
);

516 
	`__±hªad_⁄˚
 (
±hªad_⁄˚_t
 *
__⁄˚_c⁄åﬁ
,

517 (*
__öô_routöe
) ());

519 
	`__±hªad_©f‹k
 ((*
__¥ï¨e
) (),

520 (*
__∑ª¡
) (),

521 (*
__chûd
) ());

527 #i‚de‡
__NO_WEAK_PTHREAD_ALIASES


528 #ifde‡
wók_exã∫


529 #i‡
_LIBC


530 
	~<bp-sym.h
>

532 
	#BP_SYM
 (
sym
Ë
	)
sym

534 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_muãx_öô
))

535 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_muãx_de°roy
))

536 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_muãx_lock
))

537 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_muãx_åylock
))

538 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_muãx_u∆ock
))

539 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_muãx©å_öô
))

540 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_muãx©å_de°roy
))

541 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_muãx©å_£ây≥
))

542 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_rwlock_öô
))

543 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_rwlock_de°roy
))

544 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_rwlock_rdlock
))

545 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_rwlock_åyrdlock
))

546 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_rwlock_wæock
))

547 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_rwlock_åywæock
))

548 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_rwlock_u∆ock
))

549 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_key_¸óã
))

550 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_£t•ecific
))

551 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_gë•ecific
))

552 
	`wók_exã∫
 (
	$BP_SYM
 (
__±hªad_⁄˚
))

553 
	$wók_exã∫
 (
__±hªad_öôülize
)

554 
	$wók_exã∫
 (
__±hªad_©f‹k
)

555 
	`wók_exã∫
 (
	$BP_SYM
 (
_±hªad_˛ónup_push_de„r
))

556 
	`wók_exã∫
 (
	$BP_SYM
 (
_±hªad_˛ónup_p›_ª°‹e
))

557 
	`wók_exã∫
 (
	$BP_SYM
 (
±hªad_£tˇn˚l°©e
))

559 #¥agm®
wók
 
__±hªad_muãx_öô


560 #¥agm®
wók
 
__±hªad_muãx_de°roy


561 #¥agm®
wók
 
__±hªad_muãx_lock


562 #¥agm®
wók
 
__±hªad_muãx_åylock


563 #¥agm®
wók
 
__±hªad_muãx_u∆ock


564 #¥agm®
wók
 
__±hªad_muãx©å_öô


565 #¥agm®
wók
 
__±hªad_muãx©å_de°roy


566 #¥agm®
wók
 
__±hªad_muãx©å_£ây≥


567 #¥agm®
wók
 
__±hªad_rwlock_de°roy


568 #¥agm®
wók
 
__±hªad_rwlock_rdlock


569 #¥agm®
wók
 
__±hªad_rwlock_åyrdlock


570 #¥agm®
wók
 
__±hªad_rwlock_wæock


571 #¥agm®
wók
 
__±hªad_rwlock_åywæock


572 #¥agm®
wók
 
__±hªad_rwlock_u∆ock


573 #¥agm®
wók
 
__±hªad_key_¸óã


574 #¥agm®
wók
 
__±hªad_£t•ecific


575 #¥agm®
wók
 
__±hªad_gë•ecific


576 #¥agm®
wók
 
__±hªad_⁄˚


577 #¥agm®
wók
 
__±hªad_öôülize


578 #¥agm®
wók
 
__±hªad_©f‹k


579 #¥agm®
wók
 
_±hªad_˛ónup_push_de„r


580 #¥agm®
wók
 
_±hªad_˛ónup_p›_ª°‹e


581 #¥agm®
wók
 
±hªad_£tˇn˚l°©e


	@/usr/include/bits/posix1_lim.h

25 #i‚def 
_BITS_POSIX1_LIM_H


26 
	#_BITS_POSIX1_LIM_H
 1

	)

32 
	#_POSIX_AIO_LISTIO_MAX
 2

	)

35 
	#_POSIX_AIO_MAX
 1

	)

38 
	#_POSIX_ARG_MAX
 4096

	)

41 #ifde‡
__USE_XOPEN2K


42 
	#_POSIX_CHILD_MAX
 25

	)

44 
	#_POSIX_CHILD_MAX
 6

	)

48 
	#_POSIX_DELAYTIMER_MAX
 32

	)

52 
	#_POSIX_HOST_NAME_MAX
 255

	)

55 
	#_POSIX_LINK_MAX
 8

	)

58 
	#_POSIX_LOGIN_NAME_MAX
 9

	)

61 
	#_POSIX_MAX_CANON
 255

	)

65 
	#_POSIX_MAX_INPUT
 255

	)

68 
	#_POSIX_MQ_OPEN_MAX
 8

	)

71 
	#_POSIX_MQ_PRIO_MAX
 32

	)

74 
	#_POSIX_NAME_MAX
 14

	)

77 #ifde‡
__USE_XOPEN2K


78 
	#_POSIX_NGROUPS_MAX
 8

	)

80 
	#_POSIX_NGROUPS_MAX
 0

	)

84 #ifde‡
__USE_XOPEN2K


85 
	#_POSIX_OPEN_MAX
 20

	)

87 
	#_POSIX_OPEN_MAX
 16

	)

92 
	#_POSIX_FD_SETSIZE
 
_POSIX_OPEN_MAX


	)

95 
	#_POSIX_PATH_MAX
 256

	)

98 
	#_POSIX_PIPE_BUF
 512

	)

102 
	#_POSIX_RE_DUP_MAX
 255

	)

105 
	#_POSIX_RTSIG_MAX
 8

	)

108 
	#_POSIX_SEM_NSEMS_MAX
 256

	)

111 
	#_POSIX_SEM_VALUE_MAX
 32767

	)

114 
	#_POSIX_SIGQUEUE_MAX
 32

	)

117 
	#_POSIX_SSIZE_MAX
 32767

	)

120 
	#_POSIX_STREAM_MAX
 8

	)

123 
	#_POSIX_SYMLINK_MAX
 255

	)

127 
	#_POSIX_SYMLOOP_MAX
 8

	)

130 
	#_POSIX_TIMER_MAX
 32

	)

133 
	#_POSIX_TTY_NAME_MAX
 9

	)

136 
	#_POSIX_TZNAME_MAX
 6

	)

139 
	#_POSIX_QLIMIT
 1

	)

143 
	#_POSIX_HIWAT
 
_POSIX_PIPE_BUF


	)

146 
	#_POSIX_UIO_MAXIOV
 16

	)

149 
	#_POSIX_CLOCKRES_MIN
 20000000

	)

153 
	~<bôs/loˇl_lim.h
>

156 #i‚def 
SSIZE_MAX


157 
	#SSIZE_MAX
 
LONG_MAX


	)

164 #i‚def 
NGROUPS_MAX


165 
	#NGROUPS_MAX
 8

	)

	@/usr/include/bits/posix2_lim.h

23 #i‚def 
_BITS_POSIX2_LIM_H


24 
	#_BITS_POSIX2_LIM_H
 1

	)

28 
	#_POSIX2_BC_BASE_MAX
 99

	)

31 
	#_POSIX2_BC_DIM_MAX
 2048

	)

34 
	#_POSIX2_BC_SCALE_MAX
 99

	)

37 
	#_POSIX2_BC_STRING_MAX
 1000

	)

41 
	#_POSIX2_COLL_WEIGHTS_MAX
 2

	)

45 
	#_POSIX2_EXPR_NEST_MAX
 32

	)

48 
	#_POSIX2_LINE_MAX
 2048

	)

52 
	#_POSIX2_RE_DUP_MAX
 255

	)

56 
	#_POSIX2_CHARCLASS_NAME_MAX
 14

	)

63 #i‚def 
BC_BASE_MAX


64 
	#BC_BASE_MAX
 
_POSIX2_BC_BASE_MAX


	)

66 #i‚def 
BC_DIM_MAX


67 
	#BC_DIM_MAX
 
_POSIX2_BC_DIM_MAX


	)

69 #i‚def 
BC_SCALE_MAX


70 
	#BC_SCALE_MAX
 
_POSIX2_BC_SCALE_MAX


	)

72 #i‚def 
BC_STRING_MAX


73 
	#BC_STRING_MAX
 
_POSIX2_BC_STRING_MAX


	)

75 #i‚def 
COLL_WEIGHTS_MAX


76 
	#COLL_WEIGHTS_MAX
 255

	)

78 #i‚def 
EXPR_NEST_MAX


79 
	#EXPR_NEST_MAX
 
_POSIX2_EXPR_NEST_MAX


	)

81 #i‚def 
LINE_MAX


82 
	#LINE_MAX
 
_POSIX2_LINE_MAX


	)

84 #i‚def 
CHARCLASS_NAME_MAX


85 
	#CHARCLASS_NAME_MAX
 2048

	)

89 
	#RE_DUP_MAX
 (0x7fff)

	)

	@/usr/include/bits/xopen_lim.h

30 #i‚de‡
_XOPEN_LIM_H


31 
	#_XOPEN_LIM_H
 1

	)

33 
	#__√ed_IOV_MAX


	)

34 
	~<bôs/°dio_lim.h
>

66 
	#_XOPEN_IOV_MAX
 
_POSIX_UIO_MAXIOV


	)

71 
	#NL_ARGMAX
 
_POSIX_ARG_MAX


	)

74 
	#NL_LANGMAX
 
_POSIX2_LINE_MAX


	)

77 
	#NL_MSGMAX
 
INT_MAX


	)

81 
	#NL_NMAX
 
INT_MAX


	)

84 
	#NL_SETMAX
 
INT_MAX


	)

87 
	#NL_TEXTMAX
 
INT_MAX


	)

90 
	#NZERO
 20

	)

94 #ifde‡
INT_MAX


95 #i‡
INT_MAX
 == 32767

96 
	#WORD_BIT
 16

	)

98 #i‡
INT_MAX
 == 2147483647

99 
	#WORD_BIT
 32

	)

102 
	#WORD_BIT
 64

	)

105 #ñi‡
deföed
 
__INT_MAX__


106 #i‡
__INT_MAX__
 == 32767

107 
	#WORD_BIT
 16

	)

109 #i‡
__INT_MAX__
 == 2147483647

110 
	#WORD_BIT
 32

	)

113 
	#WORD_BIT
 64

	)

117 
	#WORD_BIT
 32

	)

121 #ifde‡
LONG_MAX


122 #i‡
LONG_MAX
 == 2147483647

123 
	#LONG_BIT
 32

	)

126 
	#LONG_BIT
 64

	)

128 #ñi‡
deföed
 
__LONG_MAX__


129 #i‡
__LONG_MAX__
 == 2147483647

130 
	#LONG_BIT
 32

	)

133 
	#LONG_BIT
 64

	)

136 
	~<bôs/w‹dsize.h
>

137 #i‡
__WORDSIZE
 == 64

138 
	#LONG_BIT
 64

	)

140 
	#LONG_BIT
 32

	)

	@/usr/include/gconv.h

23 #i‚de‡
_GCONV_H


24 
	#_GCONV_H
 1

	)

26 
	~<„©uªs.h
>

27 
	#__√ed_mb°©e_t


	)

28 
	#__√ed_wöt_t


	)

29 
	~<wch¨.h
>

30 
	#__√ed_size_t


	)

31 
	#__√ed_wch¨_t


	)

32 
	~<°ddef.h
>

35 
	#__UNKNOWN_10646_CHAR
 ((
wch¨_t
Ë0xfffd)

	)

40 
	m__GCONV_OK
 = 0,

41 
	m__GCONV_NOCONV
,

42 
	m__GCONV_NODB
,

43 
	m__GCONV_NOMEM
,

45 
	m__GCONV_EMPTY_INPUT
,

46 
	m__GCONV_FULL_OUTPUT
,

47 
	m__GCONV_ILLEGAL_INPUT
,

48 
	m__GCONV_INCOMPLETE_INPUT
,

50 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

51 
	m__GCONV_INTERNAL_ERROR


58 
	m__GCONV_IS_LAST
 = 0x0001,

59 
	m__GCONV_IGNORE_ERRORS
 = 0x0002

64 
	g__gc⁄v_°ï
;

65 
	g__gc⁄v_°ï_d©a
;

66 
	g__gc⁄v_lﬂded_obje˘
;

67 
	g__gc⁄v_å™s_d©a
;

71 (*
	t__gc⁄v_f˘
Ë(
	t__gc⁄v_°ï
 *, 
	t__gc⁄v_°ï_d©a
 *,

72 
	t__c⁄°
 **, __const *,

73 **, 
	tsize_t
 *, , );

76 
	$wöt_t
 (*
	t__gc⁄v_btowc_f˘
Ë(
	t__gc⁄v_°ï
 *, );

79 (*
	t__gc⁄v_öô_f˘
Ë(
	t__gc⁄v_°ï
 *);

80 (*
	t__gc⁄v_íd_f˘
Ë(
	t__gc⁄v_°ï
 *);

84 (*
	t__gc⁄v_å™s_f˘
Ë(
	t__gc⁄v_°ï
 *,

85 
	t__gc⁄v_°ï_d©a
 *, *,

86 
	t__c⁄°
 *,

87 
	t__c⁄°
 **,

88 
	t__c⁄°
 *, **,

89 
	tsize_t
 *);

92 (*
	t__gc⁄v_å™s_c⁄ãxt_f˘
Ë(*, 
	t__c⁄°
 *,

93 
	t__c⁄°
 *,

97 (*
	t__gc⁄v_å™s_quîy_f˘
Ë(
	t__c⁄°
 *, __const ***,

98 
	tsize_t
 *);

101 (*
	t__gc⁄v_å™s_öô_f˘
) (**, const *);

102 (*
	t__gc⁄v_å™s_íd_f˘
) (*);

104 
	s__gc⁄v_å™s_d©a


107 
__gc⁄v_å™s_f˘
 
__å™s_f˘
;

108 
__gc⁄v_å™s_c⁄ãxt_f˘
 
__å™s_c⁄ãxt_f˘
;

109 
__gc⁄v_å™s_íd_f˘
 
__å™s_íd_f˘
;

110 *
__d©a
;

111 
__gc⁄v_å™s_d©a
 *
__√xt
;

116 
	s__gc⁄v_°ï


118 
__gc⁄v_lﬂded_obje˘
 *
__shlib_h™dÀ
;

119 
__c⁄°
 *
__mod«me
;

121 
__cou¡î
;

123 *
__‰om_«me
;

124 *
__to_«me
;

126 
__gc⁄v_f˘
 
__f˘
;

127 
__gc⁄v_btowc_f˘
 
__btowc_f˘
;

128 
__gc⁄v_öô_f˘
 
__öô_f˘
;

129 
__gc⁄v_íd_f˘
 
__íd_f˘
;

133 
__mö_√eded_‰om
;

134 
__max_√eded_‰om
;

135 
__mö_√eded_to
;

136 
__max_√eded_to
;

139 
__°©eful
;

141 *
__d©a
;

146 
	s__gc⁄v_°ï_d©a


148 *
__outbuf
;

149 *
__outbu„nd
;

153 
__Êags
;

157 
__övoˇti⁄_cou¡î
;

161 
__öã∫Æ_u£
;

163 
__mb°©e_t
 *
__°©ï
;

164 
__mb°©e_t
 
__°©e
;

168 
__gc⁄v_å™s_d©a
 *
__å™s
;

173 
	s__gc⁄v_öfo


175 
size_t
 
__n°ïs
;

176 
__gc⁄v_°ï
 *
__°ïs
;

177 
__exãnsi⁄__
 
__gc⁄v_°ï_d©a
 
__d©a
 
__Êex¨r
;

178 } *
	t__gc⁄v_t
;

	@/usr/include/gnu/stubs-32.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub___kî√l_co¶


	)

11 
	#__°ub___kî√l_söl


	)

12 
	#__°ub___kî√l_è∆


	)

13 
	#__°ub_chÊags


	)

14 
	#__°ub_Áâach


	)

15 
	#__°ub_fchÊags


	)

16 
	#__°ub_fdëach


	)

17 
	#__°ub_gây


	)

18 
	#__°ub_lchmod


	)

19 
	#__°ub_ªvoke


	)

20 
	#__°ub_£éogö


	)

21 
	#__°ub_sigªtu∫


	)

22 
	#__°ub_s°k


	)

23 
	#__°ub_°ty


	)

	@/usr/include/wchar.h

24 #i‚de‡
_WCHAR_H


26 #i‡!
deföed
 
__√ed_mb°©e_t
 && !deföed 
__√ed_wöt_t


27 
	#_WCHAR_H
 1

	)

28 
	~<„©uªs.h
>

31 #ifde‡
_WCHAR_H


33 
	#__√ed___FILE


	)

34 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


35 
	#__√ed_FILE


	)

37 
	~<°dio.h
>

39 
	#__√ed___va_li°


	)

40 
	~<°d¨g.h
>

42 
	~<bôs/wch¨.h
>

45 
	#__√ed_size_t


	)

46 
	#__√ed_wch¨_t


	)

47 
	#__√ed_NULL


	)

49 #i‡
deföed
 
_WCHAR_H
 || deföed 
__√ed_wöt_t
 || !deföed 
__WINT_TYPE__


50 #unde‡
__√ed_wöt_t


51 
	#__√ed_wöt_t


	)

52 
	~<°ddef.h
>

56 #i‚de‡
_WINT_T


61 
	#_WINT_T


	)

62 
	twöt_t
;

66 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES
 \

67 && 
deföed
 
__WINT_TYPE__


68 
__BEGIN_NAMESPACE_STD


69 
__WINT_TYPE__
 
	twöt_t
;

70 
	g__END_NAMESPACE_STD


75 #i‡(
deföed
 
_WCHAR_H
 || deföed 
__√ed_mb°©e_t
Ë&& !deföed 
__mb°©e_t_deföed


76 
	#__mb°©e_t_deföed
 1

	)

80 
	m__cou¡
;

83 #ifde‡
__WINT_TYPE__


84 
__WINT_TYPE__
 
	m__wch
;

86 
wöt_t
 
	m__wch
;

88 
	m__wchb
[4];

89 } 
	m__vÆue
;

90 } 
	t__mb°©e_t
;

92 #unde‡
__√ed_mb°©e_t


97 #ifde‡
_WCHAR_H


99 
__BEGIN_NAMESPACE_C99


101 
__mb°©e_t
 
	tmb°©e_t
;

102 
	g__END_NAMESPACE_C99


103 #ifde‡
__USE_GNU


104 
	$__USING_NAMESPACE_C99
(
mb°©e_t
)

107 #i‚de‡
WCHAR_MIN


109 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

110 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

113 #i‚de‡
WEOF


114 
	#WEOF
 (0xffffffffu)

	)

119 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_UNIX98


120 
	~<w˘y≥.h
>

124 
__BEGIN_DECLS


126 
__BEGIN_NAMESPACE_STD


129 
tm
;

130 
__END_NAMESPACE_STD


134 
	$__USING_NAMESPACE_STD
(
tm
)

137 
__BEGIN_NAMESPACE_STD


139 
wch¨_t
 *
	$wcs˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

140 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

142 
wch¨_t
 *
	$wc¢˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

143 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

144 
__THROW
;

147 
wch¨_t
 *
	$wcsˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

148 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

150 
wch¨_t
 *
	$wc¢ˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

151 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

152 
__THROW
;

155 
	$wcscmp
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
)

156 
__THROW
 
__©åibuã_puª__
;

158 
	$wc¢cmp
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

159 
__THROW
 
__©åibuã_puª__
;

160 
__END_NAMESPACE_STD


162 #ifde‡
__USE_GNU


164 
	$wcsˇ£cmp
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
Ë
__THROW
;

167 
	$wc¢ˇ£cmp
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
,

168 
size_t
 
__n
Ë
__THROW
;

172 
	~<xloˇÀ.h
>

174 
	$wcsˇ£cmp_l
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
,

175 
__loˇÀ_t
 
__loc
Ë
__THROW
;

177 
	$wc¢ˇ£cmp_l
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
,

178 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

181 
__BEGIN_NAMESPACE_STD


184 
	$wcscﬁl
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
Ë
__THROW
;

188 
size_t
 
	$wcsx‰m
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

189 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

190 
__END_NAMESPACE_STD


192 #ifde‡
__USE_GNU


198 
	$wcscﬁl_l
 (
__c⁄°
 
wch¨_t
 *
__s1
, __c⁄° wch¨_à*
__s2
,

199 
__loˇÀ_t
 
__loc
Ë
__THROW
;

204 
size_t
 
	$wcsx‰m_l
 (
wch¨_t
 *
__s1
, 
__c⁄°
 wch¨_à*
__s2
,

205 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

208 
wch¨_t
 *
	$wcsdup
 (
__c⁄°
 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_mÆloc__
;

211 
__BEGIN_NAMESPACE_STD


213 
wch¨_t
 *
	$wcschr
 (
__c⁄°
 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

214 
__THROW
 
__©åibuã_puª__
;

216 
wch¨_t
 *
	$wc§chr
 (
__c⁄°
 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

217 
__THROW
 
__©åibuã_puª__
;

218 
__END_NAMESPACE_STD


220 #ifde‡
__USE_GNU


223 
wch¨_t
 *
	$wcsch∫ul
 (
__c⁄°
 
wch¨_t
 *
__s
, wch¨_à
__wc
)

224 
__THROW
 
__©åibuã_puª__
;

227 
__BEGIN_NAMESPACE_STD


230 
size_t
 
	$wcsc•n
 (
__c⁄°
 
wch¨_t
 *
__wcs
, __c⁄° wch¨_à*
__ªje˘
)

231 
__THROW
 
__©åibuã_puª__
;

234 
size_t
 
	$wcs•n
 (
__c⁄°
 
wch¨_t
 *
__wcs
, __c⁄° wch¨_à*
__ac˚±
)

235 
__THROW
 
__©åibuã_puª__
;

237 
wch¨_t
 *
	$wc•brk
 (
__c⁄°
 
wch¨_t
 *
__wcs
, __c⁄° wch¨_à*
__ac˚±
)

238 
__THROW
 
__©åibuã_puª__
;

240 
wch¨_t
 *
	$wcs°r
 (
__c⁄°
 
wch¨_t
 *
__hay°ack
, __c⁄° wch¨_à*
__√edÀ
)

241 
__THROW
 
__©åibuã_puª__
;

244 
wch¨_t
 *
	$wc°ok
 (
wch¨_t
 *
__ª°ri˘
 
__s
,

245 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__dñim
,

246 
wch¨_t
 **
__ª°ri˘
 
__±r
Ë
__THROW
;

249 
size_t
 
	$wc¶í
 (
__c⁄°
 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_puª__
;

250 
__END_NAMESPACE_STD


252 #ifde‡
__USE_XOPEN


254 
wch¨_t
 *
	$wcswcs
 (
__c⁄°
 
wch¨_t
 *
__hay°ack
, __c⁄° wch¨_à*
__√edÀ
)

255 
__THROW
 
__©åibuã_puª__
;

258 #ifde‡
__USE_GNU


260 
size_t
 
	$wc¢Àn
 (
__c⁄°
 
wch¨_t
 *
__s
, 
size_t
 
__maxÀn
)

261 
__THROW
 
__©åibuã_puª__
;

265 
__BEGIN_NAMESPACE_STD


267 
wch¨_t
 *
	$wmemchr
 (
__c⁄°
 
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

268 
__THROW
 
__©åibuã_puª__
;

271 
	$wmemcmp
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s1
,

272 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

273 
__THROW
 
__©åibuã_puª__
;

276 
wch¨_t
 *
	$wmem˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

277 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

281 
wch¨_t
 *
	$wmemmove
 (
wch¨_t
 *
__s1
, 
__c⁄°
 wch¨_à*
__s2
, 
size_t
 
__n
)

282 
__THROW
;

285 
wch¨_t
 *
	$wmem£t
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
Ë
__THROW
;

286 
__END_NAMESPACE_STD


288 #ifde‡
__USE_GNU


291 
wch¨_t
 *
	$wmemp˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

292 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

293 
__THROW
;

297 
__BEGIN_NAMESPACE_STD


300 
wöt_t
 
	$btowc
 (
__c
Ë
__THROW
;

304 
	$w˘ob
 (
wöt_t
 
__c
Ë
__THROW
;

308 
	$mbsöô
 (
__c⁄°
 
mb°©e_t
 *
__ps
Ë
__THROW
 
__©åibuã_puª__
;

312 
size_t
 
	$mbπowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

313 
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

314 
mb°©e_t
 *
__p
Ë
__THROW
;

317 
size_t
 
	$w¸tomb
 (*
__ª°ri˘
 
__s
, 
wch¨_t
 
__wc
,

318 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

321 
size_t
 
	$__mbæí
 (
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

322 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

323 
size_t
 
	$mbæí
 (
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

324 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

325 
__END_NAMESPACE_STD


327 #ifde‡
__USE_EXTERN_INLINES


333 
wöt_t
 
	$__btowc_Æüs
 (
__c
Ë
	`__asm
 ("btowc");

334 
__exã∫_ölöe
 
wöt_t


335 
	`__NTH
 (
	$btowc
 (
__c
))

336 {  (
	`__buûtö_c⁄°™t_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

337 ? (
wöt_t
Ë
__c
 : 
	`__btowc_Æüs
 (__c)); 
	}
}

339 
	$__w˘ob_Æüs
 (
wöt_t
 
__c
Ë
	`__asm
 ("wctob");

340 
__exã∫_ölöe
 

341 
	`__NTH
 (
	$w˘ob
 (
wöt_t
 
__wc
))

342 {  (
	`__buûtö_c⁄°™t_p
 (
__wc
Ë&& __w¯>
L
'\0' && __wc <= L'\x7f'

343 ? (Ë
__wc
 : 
	`__w˘ob_Æüs
 (__wc)); 
	}
}

345 
__exã∫_ölöe
 
size_t


346 
__NTH
 (
	$mbæí
 (
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

347 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

348 {  (
__ps
 !
NULL


349 ? 
	`mbπowc
 (
NULL
, 
__s
, 
__n
, 
__ps
Ë: 
	`__mbæí
 (__s, __n, NULL)); 
	}
}

352 
__BEGIN_NAMESPACE_STD


355 
size_t
 
	$mb§towcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

356 
__c⁄°
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

357 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

361 
size_t
 
	$wc§tombs
 (*
__ª°ri˘
 
__d°
,

362 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

363 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

364 
__END_NAMESPACE_STD


367 #ifdef 
__USE_GNU


370 
size_t
 
	$mb¢πowcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

371 
__c⁄°
 **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

372 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

376 
size_t
 
	$wc¢πombs
 (*
__ª°ri˘
 
__d°
,

377 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
,

378 
size_t
 
__nwc
, size_à
__Àn
,

379 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

384 #ifde‡
__USE_XOPEN


386 
	$wcwidth
 (
wch¨_t
 
__c
Ë
__THROW
;

390 
	$wcswidth
 (
__c⁄°
 
wch¨_t
 *
__s
, 
size_t
 
__n
Ë
__THROW
;

394 
__BEGIN_NAMESPACE_STD


397 
	$wc°od
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

398 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

399 
__END_NAMESPACE_STD


401 #ifde‡
__USE_ISOC99


402 
__BEGIN_NAMESPACE_C99


404 
	$wc°of
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

405 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

406 
	$wc°ﬁd
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

407 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

408 
__END_NAMESPACE_C99


412 
__BEGIN_NAMESPACE_STD


415 
	$wc°ﬁ
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

416 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

420 
	$wc°oul
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

421 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

422 
__THROW
;

423 
__END_NAMESPACE_STD


425 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GNUC__
 && deföed 
__USE_GNU
)

426 
__BEGIN_NAMESPACE_C99


429 
__exãnsi⁄__


430 
	$wc°ﬁl
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

431 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

432 
__THROW
;

436 
__exãnsi⁄__


437 
	$wc°ouŒ
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

438 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

439 
__ba£
Ë
__THROW
;

440 
__END_NAMESPACE_C99


443 #i‡
deföed
 
__GNUC__
 && deföed 
__USE_GNU


446 
__exãnsi⁄__


447 
	$wc°oq
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

448 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

449 
__THROW
;

453 
__exãnsi⁄__


454 
	$wc°ouq
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

455 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

456 
__ba£
Ë
__THROW
;

459 #ifde‡
__USE_GNU


473 
	~<xloˇÀ.h
>

477 
	$wc°ﬁ_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

478 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

479 
__loˇÀ_t
 
__loc
Ë
__THROW
;

481 
	$wc°oul_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

482 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

483 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

485 
__exãnsi⁄__


486 
	$wc°ﬁl_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

487 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

488 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

490 
__exãnsi⁄__


491 
	$wc°ouŒ_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

492 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

493 
__ba£
, 
__loˇÀ_t
 
__loc
)

494 
__THROW
;

496 
	$wc°od_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

497 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

498 
__THROW
;

500 
	$wc°of_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

501 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

502 
__THROW
;

504 
	$wc°ﬁd_l
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

505 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

506 
__loˇÀ_t
 
__loc
Ë
__THROW
;

510 #ifdef 
__USE_GNU


513 
wch¨_t
 *
	$w˝˝y
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
Ë
__THROW
;

517 
wch¨_t
 *
	$w˝n˝y
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
, 
size_t
 
__n
)

518 
__THROW
;

524 #ifdef 
__USE_GNU


527 
__FILE
 *
	$›í_wmem°ªam
 (
wch¨_t
 **
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
;

530 #i‡
deföed
 
__USE_ISOC95
 || deföed 
__USE_UNIX98


531 
__BEGIN_NAMESPACE_STD


534 
	$fwide
 (
__FILE
 *
__Â
, 
__mode
Ë
__THROW
;

541 
	`fw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

542 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

548 
	`w¥ötf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

551 
	$sw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

552 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

553 
__THROW
 ;

559 
	`vfw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__s
,

560 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

561 
__gnuc_va_li°
 
__¨g
)

567 
	`vw¥ötf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

568 
__gnuc_va_li°
 
__¨g
)

572 
	$vsw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

573 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

574 
__gnuc_va_li°
 
__¨g
)

575 
__THROW
 ;

582 
	`fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

583 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

589 
	`wsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

592 
	$swsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

593 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

594 
__THROW
 ;

596 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

597 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

598 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

599 #ifde‡
__REDIRECT


603 
	`__REDIRECT
 (
fwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__°ªam
,

604 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

605 
__isoc99_fwsˇnf
)

607 
	`__REDIRECT
 (
wsˇnf
, (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

608 
__isoc99_wsˇnf
)

610 
	`__REDIRECT
 (
swsˇnf
, (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

611 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

612 
__isoc99_swsˇnf
)

613 
__THROW
 ;

615 
	`__isoc99_fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

616 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

617 
	`__isoc99_wsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

618 
	$__isoc99_swsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

619 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

620 
__THROW
;

621 
	#fwsˇnf
 
__isoc99_fwsˇnf


	)

622 
	#wsˇnf
 
__isoc99_wsˇnf


	)

623 
	#swsˇnf
 
__isoc99_swsˇnf


	)

627 
__END_NAMESPACE_STD


630 #ifde‡
__USE_ISOC99


631 
__BEGIN_NAMESPACE_C99


636 
	`vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

637 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

638 
__gnuc_va_li°
 
__¨g
)

644 
	`vwsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

645 
__gnuc_va_li°
 
__¨g
)

648 
	$vswsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

649 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

650 
__gnuc_va_li°
 
__¨g
)

651 
__THROW
 ;

653 #i‡!
deföed
 
__USE_GNU
 \

654 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

655 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

656 #ifde‡
__REDIRECT


657 
	`__REDIRECT
 (
vfwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__s
,

658 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

659 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vfwsˇnf
)

661 
	`__REDIRECT
 (
vwsˇnf
, (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

662 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vwsˇnf
)

664 
	`__REDIRECT
 (
vswsˇnf
, (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

665 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

666 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vswsˇnf
)

667 
__THROW
 ;

669 
	`__isoc99_vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

670 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

671 
__gnuc_va_li°
 
__¨g
);

672 
	`__isoc99_vwsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

673 
__gnuc_va_li°
 
__¨g
);

674 
	$__isoc99_vswsˇnf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s
,

675 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

676 
__gnuc_va_li°
 
__¨g
Ë
__THROW
;

677 
	#vfwsˇnf
 
__isoc99_vfwsˇnf


	)

678 
	#vwsˇnf
 
__isoc99_vwsˇnf


	)

679 
	#vswsˇnf
 
__isoc99_vswsˇnf


	)

683 
__END_NAMESPACE_C99


687 
__BEGIN_NAMESPACE_STD


692 
wöt_t
 
	`fgëwc
 (
__FILE
 *
__°ªam
);

693 
wöt_t
 
	`gëwc
 (
__FILE
 *
__°ªam
);

699 
wöt_t
 
	`gëwch¨
 ();

706 
wöt_t
 
	`Âutwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

707 
wöt_t
 
	`putwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

713 
wöt_t
 
	`putwch¨
 (
wch¨_t
 
__wc
);

721 
wch¨_t
 *
	`fgëws
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

722 
__FILE
 *
__ª°ri˘
 
__°ªam
);

728 
	`Âutws
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__ws
,

729 
__FILE
 *
__ª°ri˘
 
__°ªam
);

736 
wöt_t
 
	`ungëwc
 (wöt_à
__wc
, 
__FILE
 *
__°ªam
);

737 
__END_NAMESPACE_STD


740 #ifde‡
__USE_GNU


748 
wöt_t
 
	`gëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

749 
wöt_t
 
	`gëwch¨_u∆ocked
 ();

757 
wöt_t
 
	`fgëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

765 
wöt_t
 
	`Âutwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

774 
wöt_t
 
	`putwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

775 
wöt_t
 
	`putwch¨_u∆ocked
 (
wch¨_t
 
__wc
);

784 
wch¨_t
 *
	`fgëws_u∆ocked
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

785 
__FILE
 *
__ª°ri˘
 
__°ªam
);

793 
	`Âutws_u∆ocked
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__ws
,

794 
__FILE
 *
__ª°ri˘
 
__°ªam
);

798 
__BEGIN_NAMESPACE_C99


802 
size_t
 
	$wcs·ime
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

803 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

804 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

805 
__END_NAMESPACE_C99


807 #ifde‡
__USE_GNU


808 
	~<xloˇÀ.h
>

812 
size_t
 
	$wcs·ime_l
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

813 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

814 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
,

815 
__loˇÀ_t
 
__loc
Ë
__THROW
;

824 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__USE_GNU


825 
	#__√ed_iswxxx


	)

826 
	~<w˘y≥.h
>

830 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


831 
	~<bôs/wch¨2.h
>

834 #ifde‡
__LDBL_COMPAT


835 
	~<bôs/wch¨-ldbl.h
>

838 
__END_DECLS


844 #unde‡
__√ed_mb°©e_t


845 #unde‡
__√ed_wöt_t


	@/usr/include/asm-generic/errno.h

1 #i‚de‡
_ASM_GENERIC_ERRNO_H


2 
	#_ASM_GENERIC_ERRNO_H


	)

4 
	~<asm-gíîic/î∫o-ba£.h
>

6 
	#EDEADLK
 35

	)

7 
	#ENAMETOOLONG
 36

	)

8 
	#ENOLCK
 37

	)

9 
	#ENOSYS
 38

	)

10 
	#ENOTEMPTY
 39

	)

11 
	#ELOOP
 40

	)

12 
	#EWOULDBLOCK
 
EAGAIN


	)

13 
	#ENOMSG
 42

	)

14 
	#EIDRM
 43

	)

15 
	#ECHRNG
 44

	)

16 
	#EL2NSYNC
 45

	)

17 
	#EL3HLT
 46

	)

18 
	#EL3RST
 47

	)

19 
	#ELNRNG
 48

	)

20 
	#EUNATCH
 49

	)

21 
	#ENOCSI
 50

	)

22 
	#EL2HLT
 51

	)

23 
	#EBADE
 52

	)

24 
	#EBADR
 53

	)

25 
	#EXFULL
 54

	)

26 
	#ENOANO
 55

	)

27 
	#EBADRQC
 56

	)

28 
	#EBADSLT
 57

	)

30 
	#EDEADLOCK
 
EDEADLK


	)

32 
	#EBFONT
 59

	)

33 
	#ENOSTR
 60

	)

34 
	#ENODATA
 61

	)

35 
	#ETIME
 62

	)

36 
	#ENOSR
 63

	)

37 
	#ENONET
 64

	)

38 
	#ENOPKG
 65

	)

39 
	#EREMOTE
 66

	)

40 
	#ENOLINK
 67

	)

41 
	#EADV
 68

	)

42 
	#ESRMNT
 69

	)

43 
	#ECOMM
 70

	)

44 
	#EPROTO
 71

	)

45 
	#EMULTIHOP
 72

	)

46 
	#EDOTDOT
 73

	)

47 
	#EBADMSG
 74

	)

48 
	#EOVERFLOW
 75

	)

49 
	#ENOTUNIQ
 76

	)

50 
	#EBADFD
 77

	)

51 
	#EREMCHG
 78

	)

52 
	#ELIBACC
 79

	)

53 
	#ELIBBAD
 80

	)

54 
	#ELIBSCN
 81

	)

55 
	#ELIBMAX
 82

	)

56 
	#ELIBEXEC
 83

	)

57 
	#EILSEQ
 84

	)

58 
	#ERESTART
 85

	)

59 
	#ESTRPIPE
 86

	)

60 
	#EUSERS
 87

	)

61 
	#ENOTSOCK
 88

	)

62 
	#EDESTADDRREQ
 89

	)

63 
	#EMSGSIZE
 90

	)

64 
	#EPROTOTYPE
 91

	)

65 
	#ENOPROTOOPT
 92

	)

66 
	#EPROTONOSUPPORT
 93

	)

67 
	#ESOCKTNOSUPPORT
 94

	)

68 
	#EOPNOTSUPP
 95

	)

69 
	#EPFNOSUPPORT
 96

	)

70 
	#EAFNOSUPPORT
 97

	)

71 
	#EADDRINUSE
 98

	)

72 
	#EADDRNOTAVAIL
 99

	)

73 
	#ENETDOWN
 100

	)

74 
	#ENETUNREACH
 101

	)

75 
	#ENETRESET
 102

	)

76 
	#ECONNABORTED
 103

	)

77 
	#ECONNRESET
 104

	)

78 
	#ENOBUFS
 105

	)

79 
	#EISCONN
 106

	)

80 
	#ENOTCONN
 107

	)

81 
	#ESHUTDOWN
 108

	)

82 
	#ETOOMANYREFS
 109

	)

83 
	#ETIMEDOUT
 110

	)

84 
	#ECONNREFUSED
 111

	)

85 
	#EHOSTDOWN
 112

	)

86 
	#EHOSTUNREACH
 113

	)

87 
	#EALREADY
 114

	)

88 
	#EINPROGRESS
 115

	)

89 
	#ESTALE
 116

	)

90 
	#EUCLEAN
 117

	)

91 
	#ENOTNAM
 118

	)

92 
	#ENAVAIL
 119

	)

93 
	#EISNAM
 120

	)

94 
	#EREMOTEIO
 121

	)

95 
	#EDQUOT
 122

	)

97 
	#ENOMEDIUM
 123

	)

98 
	#EMEDIUMTYPE
 124

	)

99 
	#ECANCELED
 125

	)

100 
	#ENOKEY
 126

	)

101 
	#EKEYEXPIRED
 127

	)

102 
	#EKEYREVOKED
 128

	)

103 
	#EKEYREJECTED
 129

	)

106 
	#EOWNERDEAD
 130

	)

107 
	#ENOTRECOVERABLE
 131

	)

	@/usr/include/asm-generic/ioctl.h

1 #i‚de‡
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

24 
	#_IOC_SIZEBITS
 14

	)

25 
	#_IOC_DIRBITS
 2

	)

27 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

28 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

29 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

30 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

32 
	#_IOC_NRSHIFT
 0

	)

33 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

34 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

35 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

40 
	#_IOC_NONE
 0U

	)

41 
	#_IOC_WRITE
 1U

	)

42 
	#_IOC_READ
 2U

	)

44 
	#_IOC
(
dú
,
ty≥
,
ƒ
,
size
) \

45 (((
dú
Ë<< 
_IOC_DIRSHIFT
) | \

46 ((
ty≥
Ë<< 
_IOC_TYPESHIFT
) | \

47 ((
ƒ
Ë<< 
_IOC_NRSHIFT
) | \

48 ((
size
Ë<< 
_IOC_SIZESHIFT
))

	)

51 
__övÆid_size_¨gumít_f‹_IOC
;

52 
	#_IOC_TYPECHECK
(
t
) \

53 (((
t
) == (t[1]) && \

54 (
t
Ë< (1 << 
_IOC_SIZEBITS
)) ? \

55 (
t
Ë: 
__övÆid_size_¨gumít_f‹_IOC
)

	)

58 
	#_IO
(
ty≥
,
ƒ
Ë
	`_IOC
(
_IOC_NONE
,—y≥),“r),0)

	)

59 
	#_IOR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

60 
	#_IOW
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

61 
	#_IOWR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

62 
	#_IOR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(size))

	)

63 
	#_IOW_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(size))

	)

64 
	#_IOWR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(size))

	)

67 
	#_IOC_DIR
(
ƒ
Ë((“rË>> 
_IOC_DIRSHIFT
Ë& 
_IOC_DIRMASK
)

	)

68 
	#_IOC_TYPE
(
ƒ
Ë((“rË>> 
_IOC_TYPESHIFT
Ë& 
_IOC_TYPEMASK
)

	)

69 
	#_IOC_NR
(
ƒ
Ë((“rË>> 
_IOC_NRSHIFT
Ë& 
_IOC_NRMASK
)

	)

70 
	#_IOC_SIZE
(
ƒ
Ë((“rË>> 
_IOC_SIZESHIFT
Ë& 
_IOC_SIZEMASK
)

	)

74 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

75 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

76 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
Ë<< 
_IOC_DIRSHIFT
)

	)

77 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

78 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/bits/local_lim.h

25 #i‚de‡
NR_OPEN


26 
	#__undef_NR_OPEN


	)

28 #i‚de‡
LINK_MAX


29 
	#__undef_LINK_MAX


	)

31 #i‚de‡
OPEN_MAX


32 
	#__undef_OPEN_MAX


	)

34 #i‚de‡
ARG_MAX


35 
	#__undef_ARG_MAX


	)

39 
	~<löux/limôs.h
>

42 #ifde‡
__undef_NR_OPEN


43 #unde‡
NR_OPEN


44 #unde‡
__undef_NR_OPEN


47 #ifde‡
__undef_LINK_MAX


48 #unde‡
LINK_MAX


49 #unde‡
__undef_LINK_MAX


52 #ifde‡
__undef_OPEN_MAX


53 #unde‡
OPEN_MAX


54 #unde‡
__undef_OPEN_MAX


57 #ifde‡
__undef_ARG_MAX


58 #unde‡
ARG_MAX


59 #unde‡
__undef_ARG_MAX


63 
	#_POSIX_THREAD_KEYS_MAX
 128

	)

65 
	#PTHREAD_KEYS_MAX
 1024

	)

68 
	#_POSIX_THREAD_DESTRUCTOR_ITERATIONS
 4

	)

70 
	#PTHREAD_DESTRUCTOR_ITERATIONS
 
_POSIX_THREAD_DESTRUCTOR_ITERATIONS


	)

73 
	#_POSIX_THREAD_THREADS_MAX
 64

	)

75 #unde‡
PTHREAD_THREADS_MAX


79 
	#AIO_PRIO_DELTA_MAX
 20

	)

82 
	#PTHREAD_STACK_MIN
 16384

	)

85 
	#DELAYTIMER_MAX
 2147483647

	)

88 
	#TTY_NAME_MAX
 32

	)

91 
	#LOGIN_NAME_MAX
 256

	)

94 
	#HOST_NAME_MAX
 64

	)

97 
	#MQ_PRIO_MAX
 32768

	)

100 
	#SEM_VALUE_MAX
 (2147483647)

	)

	@/usr/include/bits/wchar-ldbl.h

20 #i‚de‡
_WCHAR_H


24 #i‡
deföed
 
__USE_ISOC95
 || deföed 
__USE_UNIX98


25 
__BEGIN_NAMESPACE_C99


26 
__LDBL_REDIR_DECL
 (
fw¥ötf
);

27 
__LDBL_REDIR_DECL
 (
w¥ötf
);

28 
__LDBL_REDIR_DECL
 (
sw¥ötf
);

29 
__LDBL_REDIR_DECL
 (
vfw¥ötf
);

30 
__LDBL_REDIR_DECL
 (
vw¥ötf
);

31 
__LDBL_REDIR_DECL
 (
vsw¥ötf
);

32 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

33 && !
deföed
 
	g__REDIRECT
 \

34 && (
deföed
 
	g__STRICT_ANSI__
 || deföed 
	g__USE_XOPEN2K
)

35 
	$__LDBL_REDIR1_DECL
 (
fwsˇnf
, 
__∆dbl___isoc99_fwsˇnf
)

36 
	$__LDBL_REDIR1_DECL
 (
wsˇnf
, 
__∆dbl___isoc99_wsˇnf
)

37 
	$__LDBL_REDIR1_DECL
 (
swsˇnf
, 
__∆dbl___isoc99_swsˇnf
)

39 
	`__LDBL_REDIR_DECL
 (
fwsˇnf
);

40 
	`__LDBL_REDIR_DECL
 (
wsˇnf
);

41 
	`__LDBL_REDIR_DECL
 (
swsˇnf
);

43 
__END_NAMESPACE_C99


46 #ifde‡
__USE_ISOC99


47 
__BEGIN_NAMESPACE_C99


48 
	`__LDBL_REDIR1_DECL
 (
wc°ﬁd
, 
wc°od
);

49 #i‡!
deföed
 
__USE_GNU
 && !deföed 
__REDIRECT
 \

50 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

51 
	$__LDBL_REDIR1_DECL
 (
vfwsˇnf
, 
__∆dbl___isoc99_vfwsˇnf
)

52 
	$__LDBL_REDIR1_DECL
 (
vwsˇnf
, 
__∆dbl___isoc99_vwsˇnf
)

53 
	$__LDBL_REDIR1_DECL
 (
vswsˇnf
, 
__∆dbl___isoc99_vswsˇnf
)

55 
	`__LDBL_REDIR_DECL
 (
vfwsˇnf
);

56 
	`__LDBL_REDIR_DECL
 (
vwsˇnf
);

57 
	`__LDBL_REDIR_DECL
 (
vswsˇnf
);

59 
__END_NAMESPACE_C99


62 #ifde‡
__USE_GNU


63 
	`__LDBL_REDIR1_DECL
 (
wc°ﬁd_l
, 
wc°od_l
);

66 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


67 
	$__LDBL_REDIR_DECL
 (
__sw¥ötf_chk
)

68 
	$__LDBL_REDIR_DECL
 (
__vsw¥ötf_chk
)

69 #i‡
__USE_FORTIFY_LEVEL
 > 1

70 
	$__LDBL_REDIR_DECL
 (
__fw¥ötf_chk
)

71 
	$__LDBL_REDIR_DECL
 (
__w¥ötf_chk
)

72 
	$__LDBL_REDIR_DECL
 (
__vfw¥ötf_chk
)

73 
	$__LDBL_REDIR_DECL
 (
__vw¥ötf_chk
)

	@/usr/include/bits/wchar.h

20 #i‚de‡
_BITS_WCHAR_H


21 
	#_BITS_WCHAR_H
 1

	)

23 
	#__WCHAR_MIN
 (-2147483647»- 1l)

	)

24 
	#__WCHAR_MAX
 (2147483647l)

	)

	@/usr/include/bits/wchar2.h

20 #i‚de‡
_WCHAR_H


25 
wch¨_t
 *
	$__wmem˝y_chk
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

26 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
,

27 
size_t
 
__ns1
Ë
__THROW
;

28 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wmem˝y_Æüs
,

29 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

30 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
),

31 
wmem˝y
);

32 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wmem˝y_chk_w¨n
,

33 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

34 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
,

35 
size_t
 
__ns1
), 
__wmem˝y_chk
)

36 
	`__w¨«âr
 ("wmemcpy called withÜength biggerÅhan size of destination "

39 
__exã∫_Æways_ölöe
 
wch¨_t
 *

40 
	`__NTH
 (
	$wmem˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
, 
__c⁄°
 wch¨_à*__ª°ri˘ 
__s2
,

41 
size_t
 
__n
))

43 i‡(
	`__bos0
 (
__s1
Ë!(
size_t
) -1)

45 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
))

46  
	`__wmem˝y_chk
 (
__s1
, 
__s2
, 
__n
,

47 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
));

49 i‡(
__n
 > 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
))

50  
	`__wmem˝y_chk_w¨n
 (
__s1
, 
__s2
, 
__n
,

51 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
));

53  
	`__wmem˝y_Æüs
 (
__s1
, 
__s2
, 
__n
);

54 
	}
}

57 
wch¨_t
 *
	$__wmemmove_chk
 (
wch¨_t
 *
__s1
, 
__c⁄°
 wch¨_à*
__s2
,

58 
size_t
 
__n
, size_à
__ns1
Ë
__THROW
;

59 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_Æüs
, (wch¨_à*
__s1
,

60 
__c⁄°
 
wch¨_t
 *
__s2
,

61 
size_t
 
__n
), 
wmemmove
);

62 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_chk_w¨n
,

63 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

64 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
,

65 
size_t
 
__ns1
), 
__wmemmove_chk
)

66 
	`__w¨«âr
 ("wmemmove called withÜength biggerÅhan size of destination "

69 
__exã∫_Æways_ölöe
 
wch¨_t
 *

70 
	`__NTH
 (
	$wmemmove
 (
wch¨_t
 *
__ª°ri˘
 
__s1
, 
__c⁄°
 wch¨_à*__ª°ri˘ 
__s2
,

71 
size_t
 
__n
))

73 i‡(
	`__bos0
 (
__s1
Ë!(
size_t
) -1)

75 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
))

76  
	`__wmemmove_chk
 (
__s1
, 
__s2
, 
__n
,

77 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
));

79 i‡(
__n
 > 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
))

80  
	`__wmemmove_chk_w¨n
 (
__s1
, 
__s2
, 
__n
,

81 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
));

83  
	`__wmemmove_Æüs
 (
__s1
, 
__s2
, 
__n
);

84 
	}
}

87 #ifde‡
__USE_GNU


88 
wch¨_t
 *
	$__wmemp˝y_chk
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

89 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
,

90 
size_t
 
__ns1
Ë
__THROW
;

91 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wmemp˝y_Æüs
,

92 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

93 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
,

94 
size_t
 
__n
), 
wmemp˝y
);

95 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wmemp˝y_chk_w¨n
,

96 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

97 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
,

98 
size_t
 
__ns1
), 
__wmemp˝y_chk
)

99 
	`__w¨«âr
 ("wmempcpy called withÜength biggerÅhan size of destination "

102 
__exã∫_Æways_ölöe
 
wch¨_t
 *

103 
	`__NTH
 (
	$wmemp˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
, 
__c⁄°
 wch¨_à*__ª°ri˘ 
__s2
,

104 
size_t
 
__n
))

106 i‡(
	`__bos0
 (
__s1
Ë!(
size_t
) -1)

108 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
))

109  
	`__wmemp˝y_chk
 (
__s1
, 
__s2
, 
__n
,

110 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
));

112 i‡(
__n
 > 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
))

113  
	`__wmemp˝y_chk_w¨n
 (
__s1
, 
__s2
, 
__n
,

114 
	`__bos0
 (
__s1
Ë/  (
wch¨_t
));

116  
	`__wmemp˝y_Æüs
 (
__s1
, 
__s2
, 
__n
);

117 
	}
}

121 
wch¨_t
 *
	$__wmem£t_chk
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
,

122 
size_t
 
__ns
Ë
__THROW
;

123 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_Æüs
, (wch¨_à*
__s
, wch¨_à
__c
,

124 
size_t
 
__n
), 
wmem£t
);

125 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_chk_w¨n
,

126 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
,

127 
size_t
 
__ns
), 
__wmem£t_chk
)

128 
	`__w¨«âr
 ("wmemset called withÜength biggerÅhan size of destination "

131 
__exã∫_Æways_ölöe
 
wch¨_t
 *

132 
	`__NTH
 (
	$wmem£t
 (
wch¨_t
 *
__ª°ri˘
 
__s
, wch¨_à
__c
, 
size_t
 
__n
))

134 i‡(
	`__bos0
 (
__s
Ë!(
size_t
) -1)

136 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
))

137  
	`__wmem£t_chk
 (
__s
, 
__c
, 
__n
, 
	`__bos0
 (__sË/  (
wch¨_t
));

139 i‡(
__n
 > 
	`__bos0
 (
__s
Ë/  (
wch¨_t
))

140  
	`__wmem£t_chk_w¨n
 (
__s
, 
__c
, 
__n
,

141 
	`__bos0
 (
__s
Ë/  (
wch¨_t
));

143  
	`__wmem£t_Æüs
 (
__s
, 
__c
, 
__n
);

144 
	}
}

147 
wch¨_t
 *
	$__wcs˝y_chk
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

148 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

149 
size_t
 
__n
Ë
__THROW
;

150 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wcs˝y_Æüs
,

151 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

152 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
), 
wcs˝y
);

154 
__exã∫_Æways_ölöe
 
wch¨_t
 *

155 
	`__NTH
 (
	$wcs˝y
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
))

157 i‡(
	`__bos
 (
__de°
Ë!(
size_t
) -1)

158  
	`__wcs˝y_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__de°Ë/  (
wch¨_t
));

159  
	`__wcs˝y_Æüs
 (
__de°
, 
__§c
);

160 
	}
}

163 
wch¨_t
 *
	$__w˝˝y_chk
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
,

164 
size_t
 
__de°Àn
Ë
__THROW
;

165 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__w˝˝y_Æüs
, (wch¨_à*
__de°
,

166 
__c⁄°
 
wch¨_t
 *
__§c
),

167 
w˝˝y
);

169 
__exã∫_Æways_ölöe
 
wch¨_t
 *

170 
	`__NTH
 (
	$w˝˝y
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
))

172 i‡(
	`__bos
 (
__de°
Ë!(
size_t
) -1)

173  
	`__w˝˝y_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__de°Ë/  (
wch¨_t
));

174  
	`__w˝˝y_Æüs
 (
__de°
, 
__§c
);

175 
	}
}

178 
wch¨_t
 *
	$__wc¢˝y_chk
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

179 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
,

180 
size_t
 
__de°Àn
Ë
__THROW
;

181 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wc¢˝y_Æüs
,

182 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

183 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

184 
size_t
 
__n
), 
wc¢˝y
);

185 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wc¢˝y_chk_w¨n
,

186 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

187 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

188 
size_t
 
__n
, size_à
__de°Àn
), 
__wc¢˝y_chk
)

189 
	`__w¨«âr
 ("wcsncpy called withÜength biggerÅhan size of destination "

192 
__exã∫_Æways_ölöe
 
wch¨_t
 *

193 
	`__NTH
 (
	$wc¢˝y
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
, 
size_t
 
__n
))

195 i‡(
	`__bos
 (
__de°
Ë!(
size_t
) -1)

197 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
))

198  
	`__wc¢˝y_chk
 (
__de°
, 
__§c
, 
__n
,

199 
	`__bos
 (
__de°
Ë/  (
wch¨_t
));

200 i‡(
__n
 > 
	`__bos
 (
__de°
Ë/  (
wch¨_t
))

201  
	`__wc¢˝y_chk_w¨n
 (
__de°
, 
__§c
, 
__n
,

202 
	`__bos
 (
__de°
Ë/  (
wch¨_t
));

204  
	`__wc¢˝y_Æüs
 (
__de°
, 
__§c
, 
__n
);

205 
	}
}

208 
wch¨_t
 *
	$__w˝n˝y_chk
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

209 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
,

210 
size_t
 
__de°Àn
Ë
__THROW
;

211 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__w˝n˝y_Æüs
,

212 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

213 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

214 
size_t
 
__n
), 
w˝n˝y
);

215 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__w˝n˝y_chk_w¨n
,

216 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

217 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

218 
size_t
 
__n
, size_à
__de°Àn
), 
__w˝n˝y_chk
)

219 
	`__w¨«âr
 ("wcpncpy called withÜength biggerÅhan size of destination "

222 
__exã∫_Æways_ölöe
 
wch¨_t
 *

223 
	`__NTH
 (
	$w˝n˝y
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
, 
size_t
 
__n
))

225 i‡(
	`__bos
 (
__de°
Ë!(
size_t
) -1)

227 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
))

228  
	`__w˝n˝y_chk
 (
__de°
, 
__§c
, 
__n
,

229 
	`__bos
 (
__de°
Ë/  (
wch¨_t
));

230 i‡(
__n
 > 
	`__bos
 (
__de°
Ë/  (
wch¨_t
))

231  
	`__w˝n˝y_chk_w¨n
 (
__de°
, 
__§c
, 
__n
,

232 
	`__bos
 (
__de°
Ë/  (
wch¨_t
));

234  
	`__w˝n˝y_Æüs
 (
__de°
, 
__§c
, 
__n
);

235 
	}
}

238 
wch¨_t
 *
	$__wcsˇt_chk
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

239 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

240 
size_t
 
__de°Àn
Ë
__THROW
;

241 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wcsˇt_Æüs
,

242 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

243 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
), 
wcsˇt
);

245 
__exã∫_Æways_ölöe
 
wch¨_t
 *

246 
	`__NTH
 (
	$wcsˇt
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
))

248 i‡(
	`__bos
 (
__de°
Ë!(
size_t
) -1)

249  
	`__wcsˇt_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__de°Ë/  (
wch¨_t
));

250  
	`__wcsˇt_Æüs
 (
__de°
, 
__§c
);

251 
	}
}

254 
wch¨_t
 *
	$__wc¢ˇt_chk
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

255 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

256 
size_t
 
__n
, size_à
__de°Àn
Ë
__THROW
;

257 
wch¨_t
 *
	`__REDIRECT_NTH
 (
__wc¢ˇt_Æüs
,

258 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

259 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

260 
size_t
 
__n
), 
wc¢ˇt
);

262 
__exã∫_Æways_ölöe
 
wch¨_t
 *

263 
	`__NTH
 (
	$wc¢ˇt
 (
wch¨_t
 *
__de°
, 
__c⁄°
 wch¨_à*
__§c
, 
size_t
 
__n
))

265 i‡(
	`__bos
 (
__de°
Ë!(
size_t
) -1)

266  
	`__wc¢ˇt_chk
 (
__de°
, 
__§c
, 
__n
,

267 
	`__bos
 (
__de°
Ë/  (
wch¨_t
));

268  
	`__wc¢ˇt_Æüs
 (
__de°
, 
__§c
, 
__n
);

269 
	}
}

272 
	$__sw¥ötf_chk
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

273 
__Êag
, 
size_t
 
__s_Àn
,

274 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

275 
__THROW
 ;

277 
	`__REDIRECT_NTH_LDBL
 (
__sw¥ötf_Æüs
,

278 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

279 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__fmt
, ...),

280 
sw¥ötf
);

282 #ifde‡
__va_¨g_∑ck


283 
__exã∫_Æways_ölöe
 

284 
	`__NTH
 (
	$sw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

285 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__fmt
, ...))

287 i‡(
	`__bos
 (
__s
Ë!(
size_t
Ë-1 || 
__USE_FORTIFY_LEVEL
 > 1)

288  
	`__sw¥ötf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

289 
	`__bos
 (
__s
Ë/  (
wch¨_t
),

290 
__fmt
, 
	`__va_¨g_∑ck
 ());

291  
	`__sw¥ötf_Æüs
 (
__s
, 
__n
, 
__fmt
, 
	`__va_¨g_∑ck
 ());

292 
	}
}

293 #ñi‡!
deföed
 
__˝lu•lus


295 
	#sw¥ötf
(
s
, 
n
, ...) \

296 (
	`__bos
 (
s
Ë!(
size_t
Ë-1 || 
__USE_FORTIFY_LEVEL
 > 1 \

297 ? 
	`__sw¥ötf_chk
 (
s
, 
n
, 
__USE_FORTIFY_LEVEL
 - 1, \

298 
	`__bos
 (
s
Ë/  (
wch¨_t
), 
__VA_ARGS__
) \

299 : 
	`sw¥ötf
 (
s
, 
n
, 
__VA_ARGS__
))

	)

302 
	$__vsw¥ötf_chk
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

303 
__Êag
, 
size_t
 
__s_Àn
,

304 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

305 
__gnuc_va_li°
 
__¨g
)

306 
__THROW
 ;

308 
	`__REDIRECT_NTH_LDBL
 (
__vsw¥ötf_Æüs
,

309 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

310 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__fmt
,

311 
__gnuc_va_li°
 
__≠
), 
vsw¥ötf
);

313 
__exã∫_Æways_ölöe
 

314 
	`__NTH
 (
	$vsw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

315 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__fmt
, 
__gnuc_va_li°
 
__≠
))

317 i‡(
	`__bos
 (
__s
Ë!(
size_t
Ë-1 || 
__USE_FORTIFY_LEVEL
 > 1)

318  
	`__vsw¥ötf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

319 
	`__bos
 (
__s
Ë/  (
wch¨_t
), 
__fmt
, 
__≠
);

320  
	`__vsw¥ötf_Æüs
 (
__s
, 
__n
, 
__fmt
, 
__≠
);

321 
	}
}

324 #i‡
__USE_FORTIFY_LEVEL
 > 1

326 
__fw¥ötf_chk
 (
__FILE
 *
__ª°ri˘
 
__°ªam
, 
__Êag
,

327 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

328 
__w¥ötf_chk
 (
__Êag
, 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

330 
__vfw¥ötf_chk
 (
__FILE
 *
__ª°ri˘
 
__°ªam
, 
__Êag
,

331 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

332 
__gnuc_va_li°
 
__≠
);

333 
__vw¥ötf_chk
 (
__Êag
, 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

334 
__gnuc_va_li°
 
__≠
);

336 #ifde‡
__va_¨g_∑ck


337 
__exã∫_Æways_ölöe
 

338 
	$w¥ötf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__fmt
, ...)

340  
	`__w¥ötf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¨g_∑ck
 ());

341 
	}
}

343 
__exã∫_Æways_ölöe
 

344 
	$fw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
, 
__c⁄°
 
wch¨_t
 *__ª°ri˘ 
__fmt
, ...)

346  
	`__fw¥ötf_chk
 (
__°ªam
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

347 
	`__va_¨g_∑ck
 ());

348 
	}
}

349 #ñi‡!
deföed
 
__˝lu•lus


350 
	#w¥ötf
(...) \

351 
	`__w¥ötf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

352 
	#fw¥ötf
(
°ªam
, ...) \

353 
	`__fw¥ötf_chk
 (
°ªam
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

356 
__exã∫_Æways_ölöe
 

357 
	$vw¥ötf
 (
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__fmt
, 
__gnuc_va_li°
 
__≠
)

359  
	`__vw¥ötf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__≠
);

360 
	}
}

362 
__exã∫_Æways_ölöe
 

363 
	$vfw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

364 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__fmt
, 
__gnuc_va_li°
 
__≠
)

366  
	`__vfw¥ötf_chk
 (
__°ªam
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__≠
);

367 
	}
}

371 
wch¨_t
 *
	$__fgëws_chk
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__size
, 
__n
,

372 
__FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

373 
wch¨_t
 *
	`__REDIRECT
 (
__fgëws_Æüs
,

374 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
__n
,

375 
__FILE
 *
__ª°ri˘
 
__°ªam
), 
fgëws
Ë
__wur
;

376 
wch¨_t
 *
	`__REDIRECT
 (
__fgëws_chk_w¨n
,

377 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__size
, 
__n
,

378 
__FILE
 *
__ª°ri˘
 
__°ªam
), 
__fgëws_chk
)

379 
__wur
 
	`__w¨«âr
 ("fgetws called with bigger sizeÅhanÜength "

382 
__exã∫_Æways_ölöe
 
__wur
 
wch¨_t
 *

383 
	$fgëws
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
__n
, 
__FILE
 *__ª°ri˘ 
__°ªam
)

385 i‡(
	`__bos
 (
__s
Ë!(
size_t
) -1)

387 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
) || __n <= 0)

388  
	`__fgëws_chk
 (
__s
, 
	`__bos
 (__sË/  (
wch¨_t
),

389 
__n
, 
__°ªam
);

391 i‡((
size_t
Ë
__n
 > 
	`__bos
 (
__s
Ë/  (
wch¨_t
))

392  
	`__fgëws_chk_w¨n
 (
__s
, 
	`__bos
 (__sË/  (
wch¨_t
),

393 
__n
, 
__°ªam
);

395  
	`__fgëws_Æüs
 (
__s
, 
__n
, 
__°ªam
);

396 
	}
}

398 #ifde‡
__USE_GNU


399 
wch¨_t
 *
	$__fgëws_u∆ocked_chk
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__size
,

400 
__n
, 
__FILE
 *
__ª°ri˘
 
__°ªam
)

401 
__wur
;

402 
wch¨_t
 *
	`__REDIRECT
 (
__fgëws_u∆ocked_Æüs
,

403 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
__n
,

404 
__FILE
 *
__ª°ri˘
 
__°ªam
), 
fgëws_u∆ocked
)

405 
__wur
;

406 
wch¨_t
 *
	`__REDIRECT
 (
__fgëws_u∆ocked_chk_w¨n
,

407 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__size
, 
__n
,

408 
__FILE
 *
__ª°ri˘
 
__°ªam
),

409 
__fgëws_u∆ocked_chk
)

410 
__wur
 
	`__w¨«âr
 ("fgetws_unlocked called with bigger sizeÅhanÜength "

413 
__exã∫_Æways_ölöe
 
__wur
 
wch¨_t
 *

414 
	$fgëws_u∆ocked
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
__n
, 
__FILE
 *__ª°ri˘ 
__°ªam
)

416 i‡(
	`__bos
 (
__s
Ë!(
size_t
) -1)

418 i‡(!
	`__buûtö_c⁄°™t_p
 (
__n
) || __n <= 0)

419  
	`__fgëws_u∆ocked_chk
 (
__s
, 
	`__bos
 (__sË/  (
wch¨_t
),

420 
__n
, 
__°ªam
);

422 i‡((
size_t
Ë
__n
 > 
	`__bos
 (
__s
Ë/  (
wch¨_t
))

423  
	`__fgëws_u∆ocked_chk_w¨n
 (
__s
, 
	`__bos
 (__sË/  (
wch¨_t
),

424 
__n
, 
__°ªam
);

426  
	`__fgëws_u∆ocked_Æüs
 (
__s
, 
__n
, 
__°ªam
);

427 
	}
}

431 
size_t
 
	$__w¸tomb_chk
 (*
__s
, 
wch¨_t
 
__wch¨
, 
mb°©e_t
 *
__p
,

432 
size_t
 
__buÊí
Ë
__THROW
 
__wur
;

433 
size_t
 
	`__REDIRECT_NTH
 (
__w¸tomb_Æüs
,

434 (*
__ª°ri˘
 
__s
, 
wch¨_t
 
__wch¨
,

435 
mb°©e_t
 *
__ª°ri˘
 
__ps
), 
w¸tomb
Ë
__wur
;

437 
__exã∫_Æways_ölöe
 
__wur
 
size_t


438 
	`__NTH
 (
	$w¸tomb
 (*
__s
, 
wch¨_t
 
__wch¨
, 
mb°©e_t
 *
__ps
))

443 
	#__WCHAR_MB_LEN_MAX
 16

	)

444 #i‡
deföed
 
MB_LEN_MAX
 && MB_LEN_MAX !
__WCHAR_MB_LEN_MAX


447 i‡(
	`__bos
 (
__s
Ë!(
size_t
Ë-1 && 
__WCHAR_MB_LEN_MAX
 > __bos (__s))

448  
	`__w¸tomb_chk
 (
__s
, 
__wch¨
, 
__ps
, 
	`__bos
 (__s));

449  
	`__w¸tomb_Æüs
 (
__s
, 
__wch¨
, 
__ps
);

450 
	}
}

453 
size_t
 
	$__mb§towcs_chk
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

454 
__c⁄°
 **
__ª°ri˘
 
__§c
,

455 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
,

456 
size_t
 
__d°Àn
Ë
__THROW
;

457 
size_t
 
	`__REDIRECT_NTH
 (
__mb§towcs_Æüs
,

458 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

459 
__c⁄°
 **
__ª°ri˘
 
__§c
,

460 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
),

461 
mb§towcs
);

462 
size_t
 
	`__REDIRECT_NTH
 (
__mb§towcs_chk_w¨n
,

463 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

464 
__c⁄°
 **
__ª°ri˘
 
__§c
,

465 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
,

466 
size_t
 
__d°Àn
), 
__mb§towcs_chk
)

467 
	`__w¨«âr
 ("mbsrtowcs called with dst buffer smallerÅhanÜen "

470 
__exã∫_Æways_ölöe
 
size_t


471 
	`__NTH
 (
	$mb§towcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
, 
__c⁄°
 **__ª°ri˘ 
__§c
,

472 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

474 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1)

476 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

477  
	`__mb§towcs_chk
 (
__d°
, 
__§c
, 
__Àn
, 
__ps
,

478 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

480 i‡(
__Àn
 > 
	`__bos
 (
__d°
Ë/  (
wch¨_t
))

481  
	`__mb§towcs_chk_w¨n
 (
__d°
, 
__§c
, 
__Àn
, 
__ps
,

482 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

484  
	`__mb§towcs_Æüs
 (
__d°
, 
__§c
, 
__Àn
, 
__ps
);

485 
	}
}

488 
size_t
 
	$__wc§tombs_chk
 (*
__ª°ri˘
 
__d°
,

489 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
,

490 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
,

491 
size_t
 
__d°Àn
Ë
__THROW
;

492 
size_t
 
	`__REDIRECT_NTH
 (
__wc§tombs_Æüs
,

493 (*
__ª°ri˘
 
__d°
,

494 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
,

495 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
),

496 
wc§tombs
);

497 
size_t
 
	`__REDIRECT_NTH
 (
__wc§tombs_chk_w¨n
,

498 (*
__ª°ri˘
 
__d°
,

499 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
,

500 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
,

501 
size_t
 
__d°Àn
), 
__wc§tombs_chk
)

502 
	`__w¨«âr
 ("wcsrtombs called with dst buffer smallerÅhanÜen");

504 
__exã∫_Æways_ölöe
 
size_t


505 
	`__NTH
 (
	$wc§tombs
 (*
__ª°ri˘
 
__d°
, 
__c⁄°
 
wch¨_t
 **__ª°ri˘ 
__§c
,

506 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

508 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1)

510 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

511  
	`__wc§tombs_chk
 (
__d°
, 
__§c
, 
__Àn
, 
__ps
, 
	`__bos
 (__dst));

513 i‡(
__Àn
 > 
	`__bos
 (
__d°
))

514  
	`__wc§tombs_chk_w¨n
 (
__d°
, 
__§c
, 
__Àn
, 
__ps
, 
	`__bos
 (__dst));

516  
	`__wc§tombs_Æüs
 (
__d°
, 
__§c
, 
__Àn
, 
__ps
);

517 
	}
}

520 #ifde‡
__USE_GNU


521 
size_t
 
	$__mb¢πowcs_chk
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

522 
__c⁄°
 **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

523 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
,

524 
size_t
 
__d°Àn
Ë
__THROW
;

525 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢πowcs_Æüs
,

526 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

527 
__c⁄°
 **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

528 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
),

529 
mb¢πowcs
);

530 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢πowcs_chk_w¨n
,

531 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

532 
__c⁄°
 **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

533 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
,

534 
size_t
 
__d°Àn
), 
__mb¢πowcs_chk
)

535 
	`__w¨«âr
 ("mbsnrtowcs called with dst buffer smallerÅhanÜen "

538 
__exã∫_Æways_ölöe
 
size_t


539 
	`__NTH
 (
	$mb¢πowcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
, 
__c⁄°
 **__ª°ri˘ 
__§c
,

540 
size_t
 
__nmc
, size_à
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

542 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1)

544 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

545  
	`__mb¢πowcs_chk
 (
__d°
, 
__§c
, 
__nmc
, 
__Àn
, 
__ps
,

546 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

548 i‡(
__Àn
 > 
	`__bos
 (
__d°
Ë/  (
wch¨_t
))

549  
	`__mb¢πowcs_chk_w¨n
 (
__d°
, 
__§c
, 
__nmc
, 
__Àn
, 
__ps
,

550 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

552  
	`__mb¢πowcs_Æüs
 (
__d°
, 
__§c
, 
__nmc
, 
__Àn
, 
__ps
);

553 
	}
}

556 
size_t
 
	$__wc¢πombs_chk
 (*
__ª°ri˘
 
__d°
,

557 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
,

558 
size_t
 
__nwc
, size_à
__Àn
,

559 
mb°©e_t
 *
__ª°ri˘
 
__ps
, 
size_t
 
__d°Àn
)

560 
__THROW
;

561 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢πombs_Æüs
,

562 (*
__ª°ri˘
 
__d°
,

563 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
,

564 
size_t
 
__nwc
, size_à
__Àn
,

565 
mb°©e_t
 *
__ª°ri˘
 
__ps
), 
wc¢πombs
);

566 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢πombs_chk_w¨n
,

567 (*
__ª°ri˘
 
__d°
,

568 
__c⁄°
 
wch¨_t
 **
__ª°ri˘
 
__§c
,

569 
size_t
 
__nwc
, size_à
__Àn
,

570 
mb°©e_t
 *
__ª°ri˘
 
__ps
,

571 
size_t
 
__d°Àn
), 
__wc¢πombs_chk
)

572 
	`__w¨«âr
 ("wcsnrtombs called with dst buffer smallerÅhanÜen");

574 
__exã∫_Æways_ölöe
 
size_t


575 
	`__NTH
 (
	$wc¢πombs
 (*
__ª°ri˘
 
__d°
, 
__c⁄°
 
wch¨_t
 **__ª°ri˘ 
__§c
,

576 
size_t
 
__nwc
, size_à
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

578 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1)

580 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

581  
	`__wc¢πombs_chk
 (
__d°
, 
__§c
, 
__nwc
, 
__Àn
, 
__ps
,

582 
	`__bos
 (
__d°
));

584 i‡(
__Àn
 > 
	`__bos
 (
__d°
))

585  
	`__wc¢πombs_chk_w¨n
 (
__d°
, 
__§c
, 
__nwc
, 
__Àn
, 
__ps
,

586 
	`__bos
 (
__d°
));

588  
	`__wc¢πombs_Æüs
 (
__d°
, 
__§c
, 
__nwc
, 
__Àn
, 
__ps
);

589 
	}
}

	@/usr/include/pthread.h

20 #i‚de‡
_PTHREAD_H


21 
	#_PTHREAD_H
 1

	)

23 
	~<„©uªs.h
>

24 
	~<ídün.h
>

25 
	~<sched.h
>

26 
	~<time.h
>

28 
	#__√ed_sig£t_t


	)

29 
	~<sig«l.h
>

30 
	~<bôs/±hªadty≥s.h
>

31 
	~<bôs/£tjmp.h
>

32 
	~<bôs/w‹dsize.h
>

38 
	mPTHREAD_CREATE_JOINABLE
,

39 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

40 
	mPTHREAD_CREATE_DETACHED


41 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

48 
	mPTHREAD_MUTEX_TIMED_NP
,

49 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

50 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

51 
	mPTHREAD_MUTEX_ADAPTIVE_NP


52 #ifde‡
__USE_UNIX98


54 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

55 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

56 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

57 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


59 #ifde‡
__USE_GNU


61 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


66 #ifde‡
__USE_GNU


70 
	mPTHREAD_MUTEX_STALLED_NP
,

71 
	mPTHREAD_MUTEX_ROBUST_NP


76 #ifde‡
__USE_UNIX98


80 
	mPTHREAD_PRIO_NONE
,

81 
	mPTHREAD_PRIO_INHERIT
,

82 
	mPTHREAD_PRIO_PROTECT


88 #i‡
__WORDSIZE
 == 64

89 
	#PTHREAD_MUTEX_INITIALIZER
 \

90 { { 0, 0, 0, 0, 0, 0, { 0, 0 } } }

	)

91 #ifde‡
__USE_GNU


92 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

93 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0, 0 } } }

	)

94 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

95 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0, 0 } } }

	)

96 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

97 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0, 0 } } }

	)

100 
	#PTHREAD_MUTEX_INITIALIZER
 \

101 { { 0, 0, 0, 0, 0, { 0 } } }

	)

102 #ifde‡
__USE_GNU


103 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0 } } }

	)

105 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0 } } }

	)

107 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

108 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0 } } }

	)

114 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


117 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

119 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

120 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


124 
	#PTHREAD_RWLOCK_INITIALIZER
 \

125 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 } }

	)

126 #ifde‡
__USE_GNU


127 #i‡
__WORDSIZE
 == 64

128 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

130 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

132 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


133 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

134 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

135 0, 0, 0, 0 } }

	)

137 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

138 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

139 0 } }

	)

149 
	mPTHREAD_INHERIT_SCHED
,

150 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

151 
	mPTHREAD_EXPLICIT_SCHED


152 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

159 
	mPTHREAD_SCOPE_SYSTEM
,

160 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

161 
	mPTHREAD_SCOPE_PROCESS


162 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

169 
	mPTHREAD_PROCESS_PRIVATE
,

170 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

171 
	mPTHREAD_PROCESS_SHARED


172 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

178 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*Ë0, 0, 0 } }

	)

182 
	s_±hªad_˛ónup_buf„r


184 (*
	m__routöe
) (*);

185 *
	m__¨g
;

186 
	m__ˇn˚…y≥
;

187 
_±hªad_˛ónup_buf„r
 *
	m__¥ev
;

193 
	mPTHREAD_CANCEL_ENABLE
,

194 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

195 
	mPTHREAD_CANCEL_DISABLE


196 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

200 
	mPTHREAD_CANCEL_DEFERRED
,

201 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

202 
	mPTHREAD_CANCEL_ASYNCHRONOUS


203 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

205 
	#PTHREAD_CANCELED
 ((*Ë-1)

	)

209 
	#PTHREAD_ONCE_INIT
 0

	)

212 #ifde‡
__USE_XOPEN2K


216 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

220 
__BEGIN_DECLS


225 
±hªad_¸óã
 (
±hªad_t
 *
__ª°ri˘
 
__√wthªad
,

226 
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

227 *(*
__°¨t_routöe
) (*),

228 *
__ª°ri˘
 
__¨g
Ë
__THROW
 
__n⁄nuŒ
 ((1, 3));

234 
	$±hªad_exô
 (*
__ªtvÆ
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

242 
	`±hªad_joö
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
);

244 #ifde‡
__USE_GNU


247 
	$±hªad_åyjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
Ë
__THROW
;

255 
	`±hªad_timedjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
,

256 
__c⁄°
 
time•ec
 *
__ab°ime
);

263 
	$±hªad_dëach
 (
±hªad_t
 
__th
Ë
__THROW
;

267 
±hªad_t
 
	$±hªad_£lf
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

270 
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
Ë
__THROW
;

278 
	$±hªad_©å_öô
 (
±hªad_©å_t
 *
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

281 
	$±hªad_©å_de°roy
 (
±hªad_©å_t
 *
__©å
)

282 
__THROW
 
	`__n⁄nuŒ
 ((1));

285 
	$±hªad_©å_gëdëach°©e
 (
__c⁄°
 
±hªad_©å_t
 *
__©å
,

286 *
__dëach°©e
)

287 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

290 
	$±hªad_©å_£tdëach°©e
 (
±hªad_©å_t
 *
__©å
,

291 
__dëach°©e
)

292 
__THROW
 
	`__n⁄nuŒ
 ((1));

296 
	$±hªad_©å_gëgu¨dsize
 (
__c⁄°
 
±hªad_©å_t
 *
__©å
,

297 
size_t
 *
__gu¨dsize
)

298 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

301 
	$±hªad_©å_£tgu¨dsize
 (
±hªad_©å_t
 *
__©å
,

302 
size_t
 
__gu¨dsize
)

303 
__THROW
 
	`__n⁄nuŒ
 ((1));

307 
	$±hªad_©å_gësched∑øm
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


308 
__©å
,

309 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

310 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

313 
	$±hªad_©å_£tsched∑øm
 (
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

314 
__c⁄°
 
sched_∑øm
 *
__ª°ri˘


315 
__∑øm
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

318 
	$±hªad_©å_gëschedpﬁicy
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


319 
__©å
, *
__ª°ri˘
 
__pﬁicy
)

320 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

323 
	$±hªad_©å_£tschedpﬁicy
 (
±hªad_©å_t
 *
__©å
, 
__pﬁicy
)

324 
__THROW
 
	`__n⁄nuŒ
 ((1));

327 
	$±hªad_©å_gëöhîôsched
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


328 
__©å
, *
__ª°ri˘
 
__öhîô
)

329 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

332 
	$±hªad_©å_£töhîôsched
 (
±hªad_©å_t
 *
__©å
,

333 
__öhîô
)

334 
__THROW
 
	`__n⁄nuŒ
 ((1));

338 
	$±hªad_©å_gësc›e
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

339 *
__ª°ri˘
 
__sc›e
)

340 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

343 
	$±hªad_©å_£tsc›e
 (
±hªad_©å_t
 *
__©å
, 
__sc›e
)

344 
__THROW
 
	`__n⁄nuŒ
 ((1));

347 
	$±hªad_©å_gë°ackaddr
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


348 
__©å
, **
__ª°ri˘
 
__°ackaddr
)

349 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__©åibuã_dïªˇãd__
;

355 
	$±hªad_©å_£t°ackaddr
 (
±hªad_©å_t
 *
__©å
,

356 *
__°ackaddr
)

357 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
;

360 
	$±hªad_©å_gë°acksize
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘


361 
__©å
, 
size_t
 *
__ª°ri˘
 
__°acksize
)

362 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

367 
	$±hªad_©å_£t°acksize
 (
±hªad_©å_t
 *
__©å
,

368 
size_t
 
__°acksize
)

369 
__THROW
 
	`__n⁄nuŒ
 ((1));

371 #ifde‡
__USE_XOPEN2K


373 
	$±hªad_©å_gë°ack
 (
__c⁄°
 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

374 **
__ª°ri˘
 
__°ackaddr
,

375 
size_t
 *
__ª°ri˘
 
__°acksize
)

376 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

381 
	$±hªad_©å_£t°ack
 (
±hªad_©å_t
 *
__©å
, *
__°ackaddr
,

382 
size_t
 
__°acksize
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

385 #ifde‡
__USE_GNU


388 
	$±hªad_©å_£èfföôy_≈
 (
±hªad_©å_t
 *
__©å
,

389 
size_t
 
__˝u£tsize
,

390 
__c⁄°
 
˝u_£t_t
 *
__˝u£t
)

391 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

395 
	$±hªad_©å_gëafföôy_≈
 (
__c⁄°
 
±hªad_©å_t
 *
__©å
,

396 
size_t
 
__˝u£tsize
,

397 
˝u_£t_t
 *
__˝u£t
)

398 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

404 
	$±hªad_gë©å_≈
 (
±hªad_t
 
__th
, 
±hªad_©å_t
 *
__©å
)

405 
__THROW
 
	`__n⁄nuŒ
 ((2));

413 
	$±hªad_£tsched∑øm
 (
±hªad_t
 
__èrgë_thªad
, 
__pﬁicy
,

414 
__c⁄°
 
sched_∑øm
 *
__∑øm
)

415 
__THROW
 
	`__n⁄nuŒ
 ((3));

418 
	$±hªad_gësched∑øm
 (
±hªad_t
 
__èrgë_thªad
,

419 *
__ª°ri˘
 
__pﬁicy
,

420 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

421 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

424 
	$±hªad_£tsched¥io
 (
±hªad_t
 
__èrgë_thªad
, 
__¥io
)

425 
__THROW
;

428 #ifde‡
__USE_UNIX98


430 
	$±hªad_gëc⁄cuºícy
 (Ë
__THROW
;

433 
	$±hªad_£tc⁄cuºícy
 (
__Àvñ
Ë
__THROW
;

436 #ifde‡
__USE_GNU


441 
	$±hªad_yõld
 (Ë
__THROW
;

446 
	$±hªad_£èfföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

447 
__c⁄°
 
˝u_£t_t
 *
__˝u£t
)

448 
__THROW
 
	`__n⁄nuŒ
 ((3));

451 
	$±hªad_gëafföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

452 
˝u_£t_t
 *
__˝u£t
)

453 
__THROW
 
	`__n⁄nuŒ
 ((3));

466 
	`±hªad_⁄˚
 (
±hªad_⁄˚_t
 *
__⁄˚_c⁄åﬁ
,

467 (*
__öô_routöe
Ë()Ë
	`__n⁄nuŒ
 ((1, 2));

478 
	`±hªad_£tˇn˚l°©e
 (
__°©e
, *
__ﬁd°©e
);

482 
	`±hªad_£tˇn˚…y≥
 (
__ty≥
, *
__ﬁdty≥
);

485 
	`±hªad_ˇn˚l
 (
±hªad_t
 
__th
);

490 
	`±hªad_ã°ˇn˚l
 ();

499 
__jmp_buf
 
__ˇn˚l_jmp_buf
;

500 
__mask_was_ßved
;

501 } 
__ˇn˚l_jmp_buf
[1];

502 *
__∑d
[4];

503 } 
	t__±hªad_unwöd_buf_t
 
	t__©åibuã__
 ((
	t__Æig√d__
));

506 #i‚de‡
__˛ónup_f˘_©åibuã


507 
	#__˛ónup_f˘_©åibuã


	)

512 
	s__±hªad_˛ónup_‰ame


514 (*
__ˇn˚l_routöe
) (*);

515 *
__ˇn˚l_¨g
;

516 
__do_ô
;

517 
__ˇn˚l_ty≥
;

520 #i‡
deföed
 
__GNUC__
 && deföed 
__EXCEPTIONS


521 #ifde‡
__˝lu•lus


523 ˛as†
	c__±hªad_˛ónup_˛ass


525 (*
__ˇn˚l_routöe
) (*);

526 *
__ˇn˚l_¨g
;

527 
__do_ô
;

528 
__ˇn˚l_ty≥
;

530 
public
:

531 
	`__±hªad_˛ónup_˛ass
 ((*
__f˘
Ë(*), *
__¨g
)

532 : 
	`__ˇn˚l_routöe
 (
__f˘
), 
	`__ˇn˚l_¨g
 (
__¨g
), 
	$__do_ô
 (1) { }

533 ~
	$__±hªad_˛ónup_˛ass
 (Ë{ i‡(
__do_ô
Ë
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); 
	}
}

534 
	$__£tdoô
 (
__√wvÆ
Ë{ 
__do_ô
 = __√wvÆ; 
	}
}

535 
	$__de„r
 (Ë{ 
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
,

536 &
__ˇn˚l_ty≥
); 
	}
}

537 
	$__ª°‹e
 (Ëc⁄° { 
	`±hªad_£tˇn˚…y≥
 (
__ˇn˚l_ty≥
, 0); 
	}
}

547 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

549 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
)

	)

553 
	#±hªad_˛ónup_p›
(
execuã
) \

554 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

555 } 0)

	)

557 #ifde‡
__USE_GNU


561 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

563 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
); \

564 
__˛‰ame
.
	`__de„r
 ()

	)

569 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

570 
__˛‰ame
.
	`__ª°‹e
 (); \

571 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

572 } 0)

	)

579 
__exã∫_ölöe
 

580 
	$__±hªad_˛ónup_routöe
 (
__±hªad_˛ónup_‰ame
 *
__‰ame
)

582 i‡(
__‰ame
->
__do_ô
)

583 
__‰ame
->
	`__ˇn˚l_routöe
 (__‰ame->
__ˇn˚l_¨g
);

584 
	}
}

593 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

595 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

596 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

597 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

598 .
__do_ô
 = 1 };

	)

602 
	#±hªad_˛ónup_p›
(
execuã
) \

603 
__˛‰ame
.
__do_ô
 = (
execuã
); \

604 } 0)

	)

606 #ifde‡
__USE_GNU


610 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

612 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

613 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

614 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

615 .
__do_ô
 = 1 }; \

616 (Ë
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
, \

617 &
__˛‰ame
.
__ˇn˚l_ty≥
)

	)

622 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

623 (Ë
	`±hªad_£tˇn˚…y≥
 (
__˛‰ame
.
__ˇn˚l_ty≥
, 
NULL
); \

624 
__˛‰ame
.
__do_ô
 = (
execuã
); \

625 } 0)

	)

636 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

638 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

639 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

640 *
__ˇn˚l_¨g
 = (
¨g
); \

641 
nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

642 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

643 i‡(
	`__buûtö_ex≥˘
 (
nŸ_fú°_ˇŒ
, 0)) \

645 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

646 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

650 
	`__±hªad_ªgi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

651 dÿ{

	)

652 
__±hªad_ªgi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

653 
__˛ónup_f˘_©åibuã
;

657 
	#±hªad_˛ónup_p›
(
execuã
) \

660 
	`__±hªad_uƒegi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

661 i‡(
execuã
) \

662 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

663 } 0)

	)

664 
	$__±hªad_uƒegi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

665 
__˛ónup_f˘_©åibuã
;

667 #ifde‡
__USE_GNU


671 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

673 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

674 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

675 *
__ˇn˚l_¨g
 = (
¨g
); \

676 
nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

677 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

678 i‡(
	`__buûtö_ex≥˘
 (
nŸ_fú°_ˇŒ
, 0)) \

680 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

681 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

685 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (&
__ˇn˚l_buf
); \

686 dÿ{

	)

687 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (
__±hªad_unwöd_buf_t
 *
__buf
)

688 
__˛ónup_f˘_©åibuã
;

693 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

696 
	`__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (&
__ˇn˚l_buf
); \

697 i‡(
execuã
) \

698 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

699 
	}
} 0)

	)

700 
	$__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (
__±hªad_unwöd_buf_t
 *
__buf
)

701 
__˛ónup_f˘_©åibuã
;

705 
	$__±hªad_unwöd_√xt
 (
__±hªad_unwöd_buf_t
 *
__buf
)

706 
__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

707 #i‚de‡
SHARED


708 
	`__©åibuã__
 ((
__wók__
))

714 
__jmp_buf_èg
;

715 
	$__sig£tjmp
 (
__jmp_buf_èg
 *
__ív
, 
__ßvemask
Ë
__THROW
;

721 
	$±hªad_muãx_öô
 (
±hªad_muãx_t
 *
__muãx
,

722 
__c⁄°
 
±hªad_muãx©å_t
 *
__muãx©å
)

723 
__THROW
 
	`__n⁄nuŒ
 ((1));

726 
	$±hªad_muãx_de°roy
 (
±hªad_muãx_t
 *
__muãx
)

727 
__THROW
 
	`__n⁄nuŒ
 ((1));

730 
	$±hªad_muãx_åylock
 (
±hªad_muãx_t
 *
__muãx
)

731 
__THROW
 
	`__n⁄nuŒ
 ((1));

734 
	$±hªad_muãx_lock
 (
±hªad_muãx_t
 *
__muãx
)

735 
__THROW
 
	`__n⁄nuŒ
 ((1));

737 #ifde‡
__USE_XOPEN2K


739 
	$±hªad_muãx_timedlock
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

740 
__c⁄°
 
time•ec
 *
__ª°ri˘


741 
__ab°ime
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

745 
	$±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 *
__muãx
)

746 
__THROW
 
	`__n⁄nuŒ
 ((1));

749 #ifde‡
__USE_UNIX98


751 
	$±hªad_muãx_gë¥io˚ûög
 (
__c⁄°
 
±hªad_muãx_t
 *

752 
__ª°ri˘
 
__muãx
,

753 *
__ª°ri˘
 
__¥io˚ûög
)

754 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

758 
	$±hªad_muãx_£çrio˚ûög
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

759 
__¥io˚ûög
,

760 *
__ª°ri˘
 
__ﬁd_˚ûög
)

761 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

765 #ifde‡
__USE_GNU


767 
	$±hªad_muãx_c⁄si°ít_≈
 (
±hªad_muãx_t
 *
__muãx
)

768 
__THROW
 
	`__n⁄nuŒ
 ((1));

776 
	$±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 *
__©å
)

777 
__THROW
 
	`__n⁄nuŒ
 ((1));

780 
	$±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 *
__©å
)

781 
__THROW
 
	`__n⁄nuŒ
 ((1));

784 
	$±hªad_muãx©å_gëpsh¨ed
 (
__c⁄°
 
±hªad_muãx©å_t
 *

785 
__ª°ri˘
 
__©å
,

786 *
__ª°ri˘
 
__psh¨ed
)

787 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

790 
	$±hªad_muãx©å_£çsh¨ed
 (
±hªad_muãx©å_t
 *
__©å
,

791 
__psh¨ed
)

792 
__THROW
 
	`__n⁄nuŒ
 ((1));

794 #ifde‡
__USE_UNIX98


796 
	$±hªad_muãx©å_gëty≥
 (
__c⁄°
 
±hªad_muãx©å_t
 *
__ª°ri˘


797 
__©å
, *
__ª°ri˘
 
__köd
)

798 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

803 
	$±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 *
__©å
, 
__köd
)

804 
__THROW
 
	`__n⁄nuŒ
 ((1));

807 
	$±hªad_muãx©å_gë¥Ÿocﬁ
 (
__c⁄°
 
±hªad_muãx©å_t
 *

808 
__ª°ri˘
 
__©å
,

809 *
__ª°ri˘
 
__¥Ÿocﬁ
)

810 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

814 
	$±hªad_muãx©å_£çrŸocﬁ
 (
±hªad_muãx©å_t
 *
__©å
,

815 
__¥Ÿocﬁ
)

816 
__THROW
 
	`__n⁄nuŒ
 ((1));

819 
	$±hªad_muãx©å_gë¥io˚ûög
 (
__c⁄°
 
±hªad_muãx©å_t
 *

820 
__ª°ri˘
 
__©å
,

821 *
__ª°ri˘
 
__¥io˚ûög
)

822 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

825 
	$±hªad_muãx©å_£çrio˚ûög
 (
±hªad_muãx©å_t
 *
__©å
,

826 
__¥io˚ûög
)

827 
__THROW
 
	`__n⁄nuŒ
 ((1));

830 #ifde‡
__USE_GNU


832 
	$±hªad_muãx©å_gërobu°_≈
 (
__c⁄°
 
±hªad_muãx©å_t
 *
__©å
,

833 *
__robu°√ss
)

834 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

837 
	$±hªad_muãx©å_£åobu°_≈
 (
±hªad_muãx©å_t
 *
__©å
,

838 
__robu°√ss
)

839 
__THROW
 
	`__n⁄nuŒ
 ((1));

843 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


848 
	$±hªad_rwlock_öô
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

849 
__c⁄°
 
±hªad_rwlock©å_t
 *
__ª°ri˘


850 
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

853 
	$±hªad_rwlock_de°roy
 (
±hªad_rwlock_t
 *
__rwlock
)

854 
__THROW
 
	`__n⁄nuŒ
 ((1));

857 
	$±hªad_rwlock_rdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

858 
__THROW
 
	`__n⁄nuŒ
 ((1));

861 
	$±hªad_rwlock_åyrdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

862 
__THROW
 
	`__n⁄nuŒ
 ((1));

864 #ifde‡
__USE_XOPEN2K


866 
	$±hªad_rwlock_timedrdlock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

867 
__c⁄°
 
time•ec
 *
__ª°ri˘


868 
__ab°ime
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

872 
	$±hªad_rwlock_wæock
 (
±hªad_rwlock_t
 *
__rwlock
)

873 
__THROW
 
	`__n⁄nuŒ
 ((1));

876 
	$±hªad_rwlock_åywæock
 (
±hªad_rwlock_t
 *
__rwlock
)

877 
__THROW
 
	`__n⁄nuŒ
 ((1));

879 #ifde‡
__USE_XOPEN2K


881 
	$±hªad_rwlock_timedwæock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

882 
__c⁄°
 
time•ec
 *
__ª°ri˘


883 
__ab°ime
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

887 
	$±hªad_rwlock_u∆ock
 (
±hªad_rwlock_t
 *
__rwlock
)

888 
__THROW
 
	`__n⁄nuŒ
 ((1));

894 
	$±hªad_rwlock©å_öô
 (
±hªad_rwlock©å_t
 *
__©å
)

895 
__THROW
 
	`__n⁄nuŒ
 ((1));

898 
	$±hªad_rwlock©å_de°roy
 (
±hªad_rwlock©å_t
 *
__©å
)

899 
__THROW
 
	`__n⁄nuŒ
 ((1));

902 
	$±hªad_rwlock©å_gëpsh¨ed
 (
__c⁄°
 
±hªad_rwlock©å_t
 *

903 
__ª°ri˘
 
__©å
,

904 *
__ª°ri˘
 
__psh¨ed
)

905 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

908 
	$±hªad_rwlock©å_£çsh¨ed
 (
±hªad_rwlock©å_t
 *
__©å
,

909 
__psh¨ed
)

910 
__THROW
 
	`__n⁄nuŒ
 ((1));

913 
	$±hªad_rwlock©å_gëköd_≈
 (
__c⁄°
 
±hªad_rwlock©å_t
 *

914 
__ª°ri˘
 
__©å
,

915 *
__ª°ri˘
 
__¥ef
)

916 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

919 
	$±hªad_rwlock©å_£tköd_≈
 (
±hªad_rwlock©å_t
 *
__©å
,

920 
__¥ef
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

928 
	$±hªad_c⁄d_öô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

929 
__c⁄°
 
±hªad_c⁄d©å_t
 *
__ª°ri˘


930 
__c⁄d_©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

933 
	$±hªad_c⁄d_de°roy
 (
±hªad_c⁄d_t
 *
__c⁄d
)

934 
__THROW
 
	`__n⁄nuŒ
 ((1));

937 
	$±hªad_c⁄d_sig«l
 (
±hªad_c⁄d_t
 *
__c⁄d
)

938 
__THROW
 
	`__n⁄nuŒ
 ((1));

941 
	$±hªad_c⁄d_brﬂdˇ°
 (
±hªad_c⁄d_t
 *
__c⁄d
)

942 
__THROW
 
	`__n⁄nuŒ
 ((1));

949 
	$±hªad_c⁄d_waô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

950 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
)

951 
	`__n⁄nuŒ
 ((1, 2));

960 
	$±hªad_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

961 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

962 
__c⁄°
 
time•ec
 *
__ª°ri˘


963 
__ab°ime
Ë
	`__n⁄nuŒ
 ((1, 2, 3));

968 
	$±hªad_c⁄d©å_öô
 (
±hªad_c⁄d©å_t
 *
__©å
)

969 
__THROW
 
	`__n⁄nuŒ
 ((1));

972 
	$±hªad_c⁄d©å_de°roy
 (
±hªad_c⁄d©å_t
 *
__©å
)

973 
__THROW
 
	`__n⁄nuŒ
 ((1));

976 
	$±hªad_c⁄d©å_gëpsh¨ed
 (
__c⁄°
 
±hªad_c⁄d©å_t
 *

977 
__ª°ri˘
 
__©å
,

978 *
__ª°ri˘
 
__psh¨ed
)

979 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

982 
	$±hªad_c⁄d©å_£çsh¨ed
 (
±hªad_c⁄d©å_t
 *
__©å
,

983 
__psh¨ed
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

985 #ifde‡
__USE_XOPEN2K


987 
	$±hªad_c⁄d©å_gë˛ock
 (
__c⁄°
 
±hªad_c⁄d©å_t
 *

988 
__ª°ri˘
 
__©å
,

989 
__˛ockid_t
 *
__ª°ri˘
 
__˛ock_id
)

990 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

993 
	$±hªad_c⁄d©å_£t˛ock
 (
±hªad_c⁄d©å_t
 *
__©å
,

994 
__˛ockid_t
 
__˛ock_id
)

995 
__THROW
 
	`__n⁄nuŒ
 ((1));

999 #ifde‡
__USE_XOPEN2K


1004 
	$±hªad_•ö_öô
 (
±hªad_•ölock_t
 *
__lock
, 
__psh¨ed
)

1005 
__THROW
 
	`__n⁄nuŒ
 ((1));

1008 
	$±hªad_•ö_de°roy
 (
±hªad_•ölock_t
 *
__lock
)

1009 
__THROW
 
	`__n⁄nuŒ
 ((1));

1012 
	$±hªad_•ö_lock
 (
±hªad_•ölock_t
 *
__lock
)

1013 
__THROW
 
	`__n⁄nuŒ
 ((1));

1016 
	$±hªad_•ö_åylock
 (
±hªad_•ölock_t
 *
__lock
)

1017 
__THROW
 
	`__n⁄nuŒ
 ((1));

1020 
	$±hªad_•ö_u∆ock
 (
±hªad_•ölock_t
 *
__lock
)

1021 
__THROW
 
	`__n⁄nuŒ
 ((1));

1028 
	$±hªad_b¨rõr_öô
 (
±hªad_b¨rõr_t
 *
__ª°ri˘
 
__b¨rõr
,

1029 
__c⁄°
 
±hªad_b¨rõøâr_t
 *
__ª°ri˘


1030 
__©å
, 
__cou¡
)

1031 
__THROW
 
	`__n⁄nuŒ
 ((1));

1034 
	$±hªad_b¨rõr_de°roy
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1035 
__THROW
 
	`__n⁄nuŒ
 ((1));

1038 
	$±hªad_b¨rõr_waô
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1039 
__THROW
 
	`__n⁄nuŒ
 ((1));

1043 
	$±hªad_b¨rõøâr_öô
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1044 
__THROW
 
	`__n⁄nuŒ
 ((1));

1047 
	$±hªad_b¨rõøâr_de°roy
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1048 
__THROW
 
	`__n⁄nuŒ
 ((1));

1051 
	$±hªad_b¨rõøâr_gëpsh¨ed
 (
__c⁄°
 
±hªad_b¨rõøâr_t
 *

1052 
__ª°ri˘
 
__©å
,

1053 *
__ª°ri˘
 
__psh¨ed
)

1054 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1057 
	$±hªad_b¨rõøâr_£çsh¨ed
 (
±hªad_b¨rõøâr_t
 *
__©å
,

1058 
__psh¨ed
)

1059 
__THROW
 
	`__n⁄nuŒ
 ((1));

1071 
	`±hªad_key_¸óã
 (
±hªad_key_t
 *
__key
,

1072 (*
__de°r_fun˘i⁄
) (*))

1073 
__THROW
 
	`__n⁄nuŒ
 ((1));

1076 
	$±hªad_key_dñëe
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1079 *
	$±hªad_gë•ecific
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1082 
	$±hªad_£t•ecific
 (
±hªad_key_t
 
__key
,

1083 
__c⁄°
 *
__poöãr
Ë
__THROW
 ;

1086 #ifde‡
__USE_XOPEN2K


1088 
	$±hªad_gë˝u˛ockid
 (
±hªad_t
 
__thªad_id
,

1089 
__˛ockid_t
 *
__˛ock_id
)

1090 
__THROW
 
	`__n⁄nuŒ
 ((2));

1105 
	`±hªad_©f‹k
 ((*
__¥ï¨e
) (),

1106 (*
__∑ª¡
) (),

1107 (*
__chûd
Ë()Ë
__THROW
;

1110 #ifde‡
__USE_EXTERN_INLINES


1112 
__exã∫_ölöe
 

1113 
	`__NTH
 (
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
))

1115  
__thªad1
 =
__thªad2
;

1116 
	}
}

1119 
	g__END_DECLS


	@/usr/include/tls.h

20 #i‚de‡
_TLS_H


21 
	#_TLS_H


	)

23 
	~<t˛.h
>

25 #ifde‡
TCL_STORAGE_CLASS


26 #unde‡
TCL_STORAGE_CLASS


28 #ifde‡
BUILD_és


29 
	#TCL_STORAGE_CLASS
 
DLLEXPORT


	)

31 
	#TCL_STORAGE_CLASS
 
DLLIMPORT


	)

38 
EXTERN
 
Tls_Inô
 
_ANSI_ARGS_
 ((
T˛_I¡îp
 *));

39 
EXTERN
 
Tls_Sa„Inô
 
_ANSI_ARGS_
 ((
T˛_I¡îp
 *));

	@/usr/include/wctype.h

24 #i‚de‡
_WCTYPE_H


26 
	~<„©uªs.h
>

27 
	~<bôs/ty≥s.h
>

29 #i‚de‡
__√ed_iswxxx


30 
	#_WCTYPE_H
 1

	)

33 
	#__√ed_wöt_t


	)

34 
	~<wch¨.h
>

38 #i‚de‡
WEOF


39 
	#WEOF
 (0xffffffffu)

	)

42 #unde‡
__√ed_iswxxx


47 #i‚de‡
__iswxxx_deföed


48 
	#__iswxxx_deföed
 1

	)

50 
__BEGIN_NAMESPACE_C99


53 
	tw˘y≥_t
;

54 
	g__END_NAMESPACE_C99


56 #i‚de‡
_ISwbô


61 
	~<ídün.h
>

62 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


63 
	#_ISwbô
(
bô
Ë(1 << (bô))

	)

65 
	#_ISwbô
(
bô
) \

66 ((
bô
) < 8 ? () ((1UL << (bit)) << 24) \

67 : ((
bô
) < 16 ? () ((1UL << (bit)) << 8) \

68 : ((
bô
) < 24 ? () ((1UL << (bit)) >> 8) \

69 : (Ë((1UL << (
bô
)Ë>> 24))))

	)

74 
	m__ISwuµî
 = 0,

75 
	m__ISwlowî
 = 1,

76 
	m__ISwÆpha
 = 2,

77 
	m__ISwdigô
 = 3,

78 
	m__ISwxdigô
 = 4,

79 
	m__ISw•a˚
 = 5,

80 
	m__ISw¥öt
 = 6,

81 
	m__ISwgøph
 = 7,

82 
	m__ISwbœnk
 = 8,

83 
	m__ISw˙ål
 = 9,

84 
	m__ISwpun˘
 = 10,

85 
	m__ISwÆnum
 = 11,

87 
	m_ISwuµî
 = 
_ISwbô
 (
__ISwuµî
),

88 
	m_ISwlowî
 = 
_ISwbô
 (
__ISwlowî
),

89 
	m_ISwÆpha
 = 
_ISwbô
 (
__ISwÆpha
),

90 
	m_ISwdigô
 = 
_ISwbô
 (
__ISwdigô
),

91 
	m_ISwxdigô
 = 
_ISwbô
 (
__ISwxdigô
),

92 
	m_ISw•a˚
 = 
_ISwbô
 (
__ISw•a˚
),

93 
	m_ISw¥öt
 = 
_ISwbô
 (
__ISw¥öt
),

94 
	m_ISwgøph
 = 
_ISwbô
 (
__ISwgøph
),

95 
	m_ISwbœnk
 = 
_ISwbô
 (
__ISwbœnk
),

96 
	m_ISw˙ål
 = 
_ISwbô
 (
__ISw˙ål
),

97 
	m_ISwpun˘
 = 
_ISwbô
 (
__ISwpun˘
),

98 
	m_ISwÆnum
 = 
_ISwbô
 (
__ISwÆnum
)

103 
__BEGIN_DECLS


105 
__BEGIN_NAMESPACE_C99


112 
	$iswÆnum
 (
wöt_t
 
__wc
Ë
__THROW
;

118 
	$iswÆpha
 (
wöt_t
 
__wc
Ë
__THROW
;

121 
	$isw˙ål
 (
wöt_t
 
__wc
Ë
__THROW
;

125 
	$iswdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

129 
	$iswgøph
 (
wöt_t
 
__wc
Ë
__THROW
;

134 
	$iswlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

137 
	$isw¥öt
 (
wöt_t
 
__wc
Ë
__THROW
;

142 
	$iswpun˘
 (
wöt_t
 
__wc
Ë
__THROW
;

147 
	$isw•a˚
 (
wöt_t
 
__wc
Ë
__THROW
;

152 
	$iswuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

157 
	$iswxdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

162 #ifde‡
__USE_ISOC99


163 
	$iswbœnk
 (
wöt_t
 
__wc
Ë
__THROW
;

172 
w˘y≥_t
 
	$w˘y≥
 (
__c⁄°
 *
__¥›îty
Ë
__THROW
;

176 
	$isw˘y≥
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
Ë
__THROW
;

177 
__END_NAMESPACE_C99


184 
__BEGIN_NAMESPACE_C99


187 
__c⁄°
 
	t__öt32_t
 *
	tw˘øns_t
;

188 
__END_NAMESPACE_C99


189 #ifde‡
__USE_GNU


190 
	$__USING_NAMESPACE_C99
(
w˘øns_t
)

193 
__BEGIN_NAMESPACE_C99


195 
wöt_t
 
	$towlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

198 
wöt_t
 
	$towuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

199 
__END_NAMESPACE_C99


201 
__END_DECLS


208 #ifde‡
_WCTYPE_H


214 
__BEGIN_DECLS


216 
__BEGIN_NAMESPACE_C99


219 
w˘øns_t
 
	$w˘øns
 (
__c⁄°
 *
__¥›îty
Ë
__THROW
;

222 
wöt_t
 
	$tow˘øns
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
Ë
__THROW
;

223 
__END_NAMESPACE_C99


225 #ifde‡
__USE_GNU


227 
	~<xloˇÀ.h
>

231 
	$iswÆnum_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

237 
	$iswÆpha_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

240 
	$isw˙ål_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

244 
	$iswdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

248 
	$iswgøph_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

253 
	$iswlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

256 
	$isw¥öt_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

261 
	$iswpun˘_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

266 
	$isw•a˚_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

271 
	$iswuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

276 
	$iswxdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

281 
	$iswbœnk_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

285 
w˘y≥_t
 
	$w˘y≥_l
 (
__c⁄°
 *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

286 
__THROW
;

290 
	$isw˘y≥_l
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
, 
__loˇÀ_t
 
__loˇÀ
)

291 
__THROW
;

299 
wöt_t
 
	$towlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

302 
wöt_t
 
	$towuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

306 
w˘øns_t
 
	$w˘øns_l
 (
__c⁄°
 *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

307 
__THROW
;

310 
wöt_t
 
	$tow˘øns_l
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
,

311 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

315 
__END_DECLS


	@/usr/include/asm-generic/errno-base.h

1 #i‚de‡
_ASM_GENERIC_ERRNO_BASE_H


2 
	#_ASM_GENERIC_ERRNO_BASE_H


	)

4 
	#EPERM
 1

	)

5 
	#ENOENT
 2

	)

6 
	#ESRCH
 3

	)

7 
	#EINTR
 4

	)

8 
	#EIO
 5

	)

9 
	#ENXIO
 6

	)

10 
	#E2BIG
 7

	)

11 
	#ENOEXEC
 8

	)

12 
	#EBADF
 9

	)

13 
	#ECHILD
 10

	)

14 
	#EAGAIN
 11

	)

15 
	#ENOMEM
 12

	)

16 
	#EACCES
 13

	)

17 
	#EFAULT
 14

	)

18 
	#ENOTBLK
 15

	)

19 
	#EBUSY
 16

	)

20 
	#EEXIST
 17

	)

21 
	#EXDEV
 18

	)

22 
	#ENODEV
 19

	)

23 
	#ENOTDIR
 20

	)

24 
	#EISDIR
 21

	)

25 
	#EINVAL
 22

	)

26 
	#ENFILE
 23

	)

27 
	#EMFILE
 24

	)

28 
	#ENOTTY
 25

	)

29 
	#ETXTBSY
 26

	)

30 
	#EFBIG
 27

	)

31 
	#ENOSPC
 28

	)

32 
	#ESPIPE
 29

	)

33 
	#EROFS
 30

	)

34 
	#EMLINK
 31

	)

35 
	#EPIPE
 32

	)

36 
	#EDOM
 33

	)

37 
	#ERANGE
 34

	)

	@/usr/include/linux/limits.h

1 #i‚de‡
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/sched.h

20 #i‚def 
_SCHED_H


21 
	#_SCHED_H
 1

	)

23 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 
	#__√ed_size_t


	)

29 
	~<°ddef.h
>

31 
	#__√ed_time•ec


	)

32 
	~<time.h
>

35 
	~<bôs/sched.h
>

37 
	#sched_¥i‹ôy
 
__sched_¥i‹ôy


	)

40 
__BEGIN_DECLS


43 
	$sched_£ç¨am
 (
__pid_t
 
__pid
, 
__c⁄°
 
sched_∑øm
 *
__∑øm
)

44 
__THROW
;

47 
	$sched_gë∑øm
 (
__pid_t
 
__pid
, 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

50 
	$sched_£tscheduÀr
 (
__pid_t
 
__pid
, 
__pﬁicy
,

51 
__c⁄°
 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

54 
	$sched_gëscheduÀr
 (
__pid_t
 
__pid
Ë
__THROW
;

57 
	$sched_yõld
 (Ë
__THROW
;

60 
	$sched_gë_¥i‹ôy_max
 (
__Æg‹ôhm
Ë
__THROW
;

63 
	$sched_gë_¥i‹ôy_mö
 (
__Æg‹ôhm
Ë
__THROW
;

66 
	$sched_º_gë_öãrvÆ
 (
__pid_t
 
__pid
, 
time•ec
 *
__t
Ë
__THROW
;

69 #ifde‡
__USE_GNU


71 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

72 
	#CPU_SET
(
˝u
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

73 
	#CPU_CLR
(
˝u
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

74 
	#CPU_ISSET
(
˝u
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (˝u,  (
˝u_£t_t
), \

75 
˝u£ç
)

	)

76 
	#CPU_ZERO
(
˝u£ç
Ë
	`__CPU_ZERO_S
 ( (
˝u_£t_t
), cpu£ç)

	)

77 
	#CPU_COUNT
(
˝u£ç
Ë
	`__CPU_COUNT_S
 ( (
˝u_£t_t
), cpu£ç)

	)

79 
	#CPU_SET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u, sësize, cpu£ç)

	)

80 
	#CPU_CLR_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u, sësize, cpu£ç)

	)

81 
	#CPU_ISSET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (cpu, setsize, \

82 
˝u£ç
)

	)

83 
	#CPU_ZERO_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_ZERO_S
 (£tsize, cpu£ç)

	)

84 
	#CPU_COUNT_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_COUNT_S
 (£tsize, cpu£ç)

	)

86 
	#CPU_EQUAL
(
˝u£ç1
, 
˝u£ç2
) \

87 
	`__CPU_EQUAL_S
 ( (
˝u_£t_t
), 
˝u£ç1
, 
˝u£ç2
)

	)

88 
	#CPU_EQUAL_S
(
£tsize
, 
˝u£ç1
, 
˝u£ç2
) \

89 
	`__CPU_EQUAL_S
 (
£tsize
, 
˝u£ç1
, 
˝u£ç2
)

	)

91 
	#CPU_AND
(
de°£t
, 
§c£t1
, 
§c£t2
) \

92 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

93 
	#CPU_OR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

94 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

95 
	#CPU_XOR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

96 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

97 
	#CPU_AND_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

98 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

99 
	#CPU_OR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

100 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

101 
	#CPU_XOR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

102 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

104 
	#CPU_ALLOC_SIZE
(
cou¡
Ë
	`__CPU_ALLOC_SIZE
 (cou¡)

	)

105 
	#CPU_ALLOC
(
cou¡
Ë
	`__CPU_ALLOC
 (cou¡)

	)

106 
	#CPU_FREE
(
˝u£t
Ë
	`__CPU_FREE
 (˝u£t)

	)

110 
	$sched_£èfföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

111 
__c⁄°
 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

114 
	$sched_gëafföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

115 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

118 
__END_DECLS


	@/usr/include/tcl.h

19 #i‚de‡
_TCL


20 
	#_TCL


	)

26 #ifde‡
__˝lu•lus


34 
	#TCL_ALPHA_RELEASE
 0

	)

35 
	#TCL_BETA_RELEASE
 1

	)

36 
	#TCL_FINAL_RELEASE
 2

	)

60 
	#TCL_MAJOR_VERSION
 8

	)

61 
	#TCL_MINOR_VERSION
 5

	)

62 
	#TCL_RELEASE_LEVEL
 
TCL_FINAL_RELEASE


	)

63 
	#TCL_RELEASE_SERIAL
 2

	)

65 
	#TCL_VERSION
 "8.5"

	)

66 
	#TCL_PATCH_LEVEL
 "8.5.2"

	)

73 #i‚de‡
__WIN32__


74 #i‡
deföed
(
_WIN32
Ë|| deföed(
WIN32
Ë|| deföed(
__MINGW32__
Ë|| deföed(
__BORLANDC__
Ë|| (deföed(
__WATCOMC__
Ë&& deföed(
__WINDOWS_386__
))

75 
	#__WIN32__


	)

76 #i‚de‡
WIN32


77 
	#WIN32


	)

79 #i‚de‡
_WIN32


80 
	#_WIN32


	)

89 #ifde‡
__WIN32__


90 #i‚de‡
STRICT


91 
	#STRICT


	)

100 #i‚de‡
STRINGIFY


101 
	#STRINGIFY
(
x
Ë
	`STRINGIFY1
(x)

	)

102 
	#STRINGIFY1
(
x
Ë#x

	)

104 #i‚de‡
JOIN


105 
	#JOIN
(
a
,
b
Ë
	`JOIN1
◊,b)

	)

106 
	#JOIN1
(
a
,
b
Ëa##
	)
b

118 #i‚de‡
RC_INVOKED


125 #ifde‡
TCL_THREADS


126 
	#TCL_DECLARE_MUTEX
(
«me
Ë
T˛_Muãx
Çame;

	)

128 
	#TCL_DECLARE_MUTEX
(
«me
)

	)

141 
	~<°dio.h
>

153 
	~<°d¨g.h
>

154 #i‚de‡
TCL_NO_DEPRECATED


155 
	#TCL_VARARGS
(
ty≥
, 
«me
Ë—y≥Çame, ...)

	)

156 
	#TCL_VARARGS_DEF
(
ty≥
, 
«me
Ë—y≥Çame, ...)

	)

157 
	#TCL_VARARGS_START
(
ty≥
, 
«me
, 
li°
Ë(
	`va_°¨t
÷i°,Çame),Çame)

	)

173 #i‡(
deföed
(
__WIN32__
Ë&& (deföed(
_MSC_VER
Ë|| (
__BORLANDC__
 >0x0550Ë|| deföed(
__LCC__
Ë|| deföed(
__WATCOMC__
Ë|| (deföed(
__GNUC__
Ë&& deföed(
__de˛•ec
))))

174 
	#HAVE_DECLSPEC
 1

	)

177 #ifde‡
STATIC_BUILD


178 
	#DLLIMPORT


	)

179 
	#DLLEXPORT


	)

180 #i‡
HAVE_DECLSPEC
 && 
deföed
(
_DLL
)

181 
	#CRTIMPORT
 
	`__de˛•ec
(
dŒimp‹t
)

	)

183 
	#CRTIMPORT


	)

186 #i‡
HAVE_DECLSPEC


187 
	#DLLIMPORT
 
	`__de˛•ec
(
dŒimp‹t
)

	)

188 
	#DLLEXPORT
 
	`__de˛•ec
(
dŒexp‹t
)

	)

189 
	#CRTIMPORT
 
	`__de˛•ec
(
dŒimp‹t
)

	)

191 
	#DLLIMPORT


	)

192 
	#DLLEXPORT


	)

193 
	#CRTIMPORT


	)

213 #unde‡
TCL_STORAGE_CLASS


214 #ifde‡
BUILD_t˛


215 
	#TCL_STORAGE_CLASS
 
DLLEXPORT


	)

217 #ifde‡
USE_TCL_STUBS


218 
	#TCL_STORAGE_CLASS


	)

220 
	#TCL_STORAGE_CLASS
 
DLLIMPORT


	)

229 #unde‡
_ANSI_ARGS_


230 #unde‡
CONST


231 #i‚de‡
INLINE


232 
	#INLINE


	)

235 #i‚de‡
NO_CONST


236 
	#CONST
 c⁄°

	)

238 
	#CONST


	)

241 #i‚de‡
NO_PROTOTYPES


242 
	#_ANSI_ARGS_
(
x
Ë
	)
x

244 
	#_ANSI_ARGS_
(
x
Ë()

	)

247 #ifde‡
USE_NON_CONST


248 #ifde‡
USE_COMPAT_CONST


249 #îr‹ 
deföe
 
©
 
mo°
 
⁄e
 
of
 
USE_NON_CONST
 
™d
 
USE_COMPAT_CONST


251 
	#CONST84


	)

252 
	#CONST84_RETURN


	)

254 #ifde‡
USE_COMPAT_CONST


255 
	#CONST84


	)

256 
	#CONST84_RETURN
 
CONST


	)

258 
	#CONST84
 
CONST


	)

259 
	#CONST84_RETURN
 
CONST


	)

267 #ifde‡
EXTERN


268 #unde‡
EXTERN


271 #ifde‡
__˝lu•lus


272 
	#EXTERN
 "C" 
TCL_STORAGE_CLASS


	)

274 
	#EXTERN
 
TCL_STORAGE_CLASS


	)

283 #i‡
deföed
(
__WIN32__
Ë&& !deföed(
HAVE_WINNT_IGNORE_VOID
)

284 #i‚de‡
VOID


285 
	#VOID
 

	)

286 
	tCHAR
;

287 
	tSHORT
;

288 
	tLONG
;

297 #i‚de‡
NO_VOID


298 
	#VOID
 

	)

300 
	#VOID
 

	)

307 #i‚de‡
_CLIENTDATA


308 #i‚de‡
NO_VOID


309 *
	tClõ¡D©a
;

311 *
	tClõ¡D©a
;

313 
	#_CLIENTDATA


	)

321 #ifde‡
__APPLE__


322 #ifde‡
__LP64__


323 #unde‡
TCL_WIDE_INT_TYPE


324 
	#TCL_WIDE_INT_IS_LONG
 1

	)

325 
	#TCL_CFG_DO64BIT
 1

	)

327 
	#TCL_WIDE_INT_TYPE
 

	)

328 #unde‡
TCL_WIDE_INT_IS_LONG


329 #unde‡
TCL_CFG_DO64BIT


331 #unde‡
HAVE_STRUCT_STAT64


355 #i‡!
deföed
(
TCL_WIDE_INT_TYPE
)&&!deföed(
TCL_WIDE_INT_IS_LONG
)

356 #i‡
deföed
(
__GNUC__
)

357 
	#TCL_WIDE_INT_TYPE
 

	)

358 #i‡
deföed
(
__WIN32__
Ë&& !deföed(
__CYGWIN__
)

359 
	#TCL_LL_MODIFIER
 "I64"

	)

361 
	#TCL_LL_MODIFIER
 "L"

	)

363 
°©
 
	tT˛_SètBuf
;

364 #ñi‡
deföed
(
__WIN32__
)

365 
	#TCL_WIDE_INT_TYPE
 
__öt64


	)

366 #ifde‡
__BORLANDC__


367 
°©i64
 
	tT˛_SètBuf
;

368 
	#TCL_LL_MODIFIER
 "L"

	)

370 #i‡
_MSC_VER
 < 1400 || !
deföed
(
_M_IX86
)

371 
_°©i64
 
	tT˛_SètBuf
;

373 
_°©64
 
	tT˛_SètBuf
;

375 
	#TCL_LL_MODIFIER
 "I64"

	)

382 #ifde‡
NO_LIMITS_H


383 #îr‹ 
∂ó£
 
deföe
 
eôhî
 
TCL_WIDE_INT_TYPE
 
‹
 
TCL_WIDE_INT_IS_LONG


385 
	~<limôs.h
>

386 #i‡(
INT_MAX
 < 
LONG_MAX
)

387 
	#TCL_WIDE_INT_IS_LONG
 1

	)

389 
	#TCL_WIDE_INT_TYPE
 

	)

394 #ifde‡
TCL_WIDE_INT_IS_LONG


395 #unde‡
TCL_WIDE_INT_TYPE


396 
	#TCL_WIDE_INT_TYPE
 

	)

399 
TCL_WIDE_INT_TYPE
 
	tT˛_WideI¡
;

400 
	tTCL_WIDE_INT_TYPE
 
	tT˛_WideUI¡
;

402 #ifde‡
TCL_WIDE_INT_IS_LONG


403 
°©
 
	tT˛_SètBuf
;

404 
	#T˛_WideAsL⁄g
(
vÆ
Ë(()(vÆ))

	)

405 
	#T˛_L⁄gAsWide
(
vÆ
Ë(()(vÆ))

	)

406 
	#T˛_WideAsDoubÀ
(
vÆ
Ë(()(()(vÆ)))

	)

407 
	#T˛_DoubÀAsWide
(
vÆ
Ë(()(()(vÆ)))

	)

408 #i‚de‡
TCL_LL_MODIFIER


409 
	#TCL_LL_MODIFIER
 "l"

	)

416 #i‚de‡
TCL_LL_MODIFIER


417 #ifde‡
HAVE_STRUCT_STAT64


418 
°©64
 
	tT˛_SètBuf
;

420 
°©
 
	tT˛_SètBuf
;

422 
	#TCL_LL_MODIFIER
 "Œ"

	)

424 
	#T˛_WideAsL⁄g
(
vÆ
Ë(()((
T˛_WideI¡
)(vÆ)))

	)

425 
	#T˛_L⁄gAsWide
(
vÆ
Ë((
T˛_WideI¡
)(()(vÆ)))

	)

426 
	#T˛_WideAsDoubÀ
(
vÆ
Ë(()((
T˛_WideI¡
)(vÆ)))

	)

427 
	#T˛_DoubÀAsWide
(
vÆ
Ë((
T˛_WideI¡
)(()(vÆ)))

	)

449 
	sT˛_I¡îp
 {

450 *
	gªsu…
;

452 (*
	g‰ìProc
Ë
_ANSI_ARGS_
((*
blockPå
));

460 
	gîr‹Löe
;

463 } 
	tT˛_I¡îp
;

465 
T˛_AsyncH™dÀr_
 *
	tT˛_AsyncH™dÀr
;

466 
T˛_Ch™√l_
 *
	tT˛_Ch™√l
;

467 
T˛_Ch™√lTy≥Vîsi⁄_
 *
	tT˛_Ch™√lTy≥Vîsi⁄
;

468 
T˛_Comm™d_
 *
	tT˛_Comm™d
;

469 
T˛_C⁄dôi⁄_
 *
	tT˛_C⁄dôi⁄
;

470 
T˛_Di˘_
 *
	tT˛_Di˘
;

471 
T˛_EncodögSèã_
 *
	tT˛_EncodögSèã
;

472 
T˛_Encodög_
 *
	tT˛_Encodög
;

473 
T˛_Evít
 
	tT˛_Evít
;

474 
T˛_I¡îpSèã_
 *
	tT˛_I¡îpSèã
;

475 
T˛_LﬂdH™dÀ_
 *
	tT˛_LﬂdH™dÀ
;

476 
T˛_Muãx_
 *
	tT˛_Muãx
;

477 
T˛_Pid_
 *
	tT˛_Pid
;

478 
T˛_RegExp_
 *
	tT˛_RegExp
;

479 
T˛_ThªadD©aKey_
 *
	tT˛_ThªadD©aKey
;

480 
T˛_ThªadId_
 *
	tT˛_ThªadId
;

481 
T˛_TimîTokí_
 *
	tT˛_TimîTokí
;

482 
T˛_Tø˚_
 *
	tT˛_Tø˚
;

483 
T˛_V¨_
 *
	tT˛_V¨
;

491 #i‡
deföed
 
__WIN32__


492 (
__°dˇŒ
 
	tT˛_ThªadCª©eProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

494 (
	gT˛_ThªadCª©eProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

503 #i‡
deföed
 
__WIN32__


504 
	#T˛_ThªadCª©eTy≥
 
__°dˇŒ


	)

505 
	#TCL_THREAD_CREATE_RETURN
  0

	)

507 
	#T˛_ThªadCª©eTy≥
 

	)

508 
	#TCL_THREAD_CREATE_RETURN


	)

516 
	#TCL_THREAD_STACK_DEFAULT
 (0Ë

	)

517 
	#TCL_THREAD_NOFLAGS
 (0000Ë

	)

518 
	#TCL_THREAD_JOINABLE
 (0001Ë

	)

524 
	#TCL_MATCH_NOCASE
 (1<<0)

	)

530 
	#TCL_REG_BASIC
 000000

	)

531 
	#TCL_REG_EXTENDED
 000001

	)

532 
	#TCL_REG_ADVF
 000002

	)

533 
	#TCL_REG_ADVANCED
 000003

	)

534 
	#TCL_REG_QUOTE
 000004

	)

535 
	#TCL_REG_NOCASE
 000010

	)

536 
	#TCL_REG_NOSUB
 000020

	)

537 
	#TCL_REG_EXPANDED
 000040

	)

539 
	#TCL_REG_NLSTOP
 000100

	)

540 
	#TCL_REG_NLANCH
 000200

	)

541 
	#TCL_REG_NEWLINE
 000300

	)

542 
	#TCL_REG_CANMATCH
 001000

	)

549 
	#TCL_REG_NOTBOL
 0001

	)

550 
	#TCL_REG_NOTEOL
 0002

	)

558 
	sT˛_RegExpIndi˚s
 {

559 
	g°¨t
;

561 
	gíd
;

563 } 
	tT˛_RegExpIndi˚s
;

565 
	sT˛_RegExpInfo
 {

566 
	gnsubs
;

568 
T˛_RegExpIndi˚s
 *
	gm©ches
;

569 
	gexãndSèπ
;

571 
	gª£rved
;

572 } 
	tT˛_RegExpInfo
;

579 
T˛_SètBuf
 *
	tT˛_Sèt_
;

580 
°©
 *
	tT˛_OldSèt_
;

602 
	#TCL_OK
 0

	)

603 
	#TCL_ERROR
 1

	)

604 
	#TCL_RETURN
 2

	)

605 
	#TCL_BREAK
 3

	)

606 
	#TCL_CONTINUE
 4

	)

608 
	#TCL_RESULT_SIZE
 200

	)

614 
	#TCL_SUBST_COMMANDS
 001

	)

615 
	#TCL_SUBST_VARIABLES
 002

	)

616 
	#TCL_SUBST_BACKSLASHES
 004

	)

617 
	#TCL_SUBST_ALL
 007

	)

624 
	gTCL_INT
, 
	gTCL_DOUBLE
, 
	gTCL_EITHER
, 
	gTCL_WIDE_INT


625 } 
	tT˛_VÆueTy≥
;

627 
	sT˛_VÆue
 {

628 
T˛_VÆueTy≥
 
	gty≥
;

630 
	götVÆue
;

631 
	gdoubÀVÆue
;

632 
T˛_WideI¡
 
	gwideVÆue
;

633 } 
	tT˛_VÆue
;

640 
	gT˛_Obj
;

646 (
	gT˛_AµInôProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
));

647 (
	gT˛_AsyncProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

648 
	tT˛_I¡îp
 *
	töãΩ
, 
	tcode
));

649 (
	gT˛_Ch™√lProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
, 
	tmask
));

650 (
	gT˛_Clo£Proc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	td©a
));

651 (
	gT˛_CmdDñëeProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

652 (
	gT˛_CmdProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

653 
	tT˛_I¡îp
 *
	töãΩ
, 
	t¨gc
, 
	tCONST84
 *
	t¨gv
[]));

654 (
	gT˛_CmdTø˚Proc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

655 
	tT˛_I¡îp
 *
	töãΩ
, 
	tÀvñ
, *
	tcomm™d
, 
	tT˛_CmdProc
 *
	t¥oc
,

656 
	tClõ¡D©a
 
	tcmdClõ¡D©a
, 
	t¨gc
, 
	tCONST84
 *
	t¨gv
[]));

657 (
	gT˛_CmdObjTø˚Proc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

658 
	tT˛_I¡îp
 *
	töãΩ
, 
	tÀvñ
, 
	tCONST
 *
	tcomm™d
,

659 
	tT˛_Comm™d
 
	tcomm™dInfo
, 
	tobjc
, 
	tT˛_Obj
 * 
	tCONST
 * 
	tobjv
));

660 (
	gT˛_CmdObjTø˚DñëeProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

661 (
	gT˛_DupI¡î«lRïProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t§cPå
,

662 
	tT˛_Obj
 *
	tdupPå
));

663 (
	gT˛_EncodögC⁄vîtProc
)
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

664 
	tCONST
 *
	t§c
, 
	t§cLí
, 
	tÊags
, 
	tT˛_EncodögSèã
 *
	t°©ePå
,

665 *
	td°
, 
	td°Lí
, *
	t§cRódPå
, *
	td°WrŸePå
,

666 *
	td°Ch¨sPå
));

667 (
	gT˛_EncodögFªeProc
)
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

668 (
	gT˛_EvítProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Evít
 *
	tevPå
, 
	tÊags
));

669 (
	gT˛_EvítCheckProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

670 
	tÊags
));

671 (
	gT˛_EvítDñëeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Evít
 *
	tevPå
,

672 
	tClõ¡D©a
 
	t˛õ¡D©a
));

673 (
	gT˛_EvítSëupProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

674 
	tÊags
));

675 (
	gT˛_ExôProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

676 (
	gT˛_FûeProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
, 
	tmask
));

677 (
	gT˛_FûeFªeProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

678 (
	gT˛_FªeI¡î«lRïProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	tobjPå
));

679 (
	gT˛_FªeProc
Ë
	t_ANSI_ARGS_
((*
	tblockPå
));

680 (
	gT˛_IdÀProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

681 (
	gT˛_I¡îpDñëeProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

682 
	tT˛_I¡îp
 *
	töãΩ
));

683 (
	gT˛_M©hProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

684 
	tT˛_I¡îp
 *
	töãΩ
, 
	tT˛_VÆue
 *
	t¨gs
, T˛_VÆuê*
	tªsu…På
));

685 (
	gT˛_Name•a˚DñëeProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

686 (
	gT˛_ObjCmdProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

687 
	tT˛_I¡îp
 *
	töãΩ
, 
	tobjc
, 
	tT˛_Obj
 * 
	tCONST
 * 
	tobjv
));

688 (
	gT˛_PackageInôProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
));

689 (
	gT˛_PackageU∆ﬂdProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
,

690 
	tÊags
));

691 (
	gT˛_P™icProc
Ë
	t_ANSI_ARGS_
((
	tCONST
 *
	tf‹m©
, ...));

692 (
	gT˛_T˝Ac˚±Proc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	tˇŒbackD©a
,

693 
	tT˛_Ch™√l
 
	tch™
, *
	taddªss
, 
	tp‹t
));

694 (
	gT˛_TimîProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

695 (
	gT˛_SëFromAnyProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
,

696 
	tT˛_Obj
 *
	tobjPå
));

697 (
	gT˛_Upd©eSåögProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	tobjPå
));

698 *(
	tT˛_V¨Tø˚Proc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

699 
	tT˛_I¡îp
 *
	töãΩ
, 
	tCONST84
 *
	t∑π1
, CONST84 *
	t∑π2
,

700 
	tÊags
));

701 (
	gT˛_Comm™dTø˚Proc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

702 
	tT˛_I¡îp
 *
	töãΩ
, 
	tCONST
 *
	tﬁdName
, CONST *
	t√wName
,

703 
	tÊags
));

704 (
	gT˛_Cª©eFûeH™dÀrProc
Ë
	t_ANSI_ARGS_
((
	tfd
, 
	tmask
,

705 
	tT˛_FûeProc
 *
	t¥oc
, 
	tClõ¡D©a
 
	t˛õ¡D©a
));

706 (
	gT˛_DñëeFûeH™dÀrProc
Ë
	t_ANSI_ARGS_
((
	tfd
));

707 (
	gT˛_AÀπNŸifõrProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

708 (
	gT˛_Sîvi˚ModeHookProc
Ë
	t_ANSI_ARGS_
((
	tmode
));

709 
Clõ¡D©a
 (
	tT˛_InôNŸifõrProc
Ë
	t_ANSI_ARGS_
((
	tVOID
));

710 (
	gT˛_FöÆizeNŸifõrProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

711 (
	gT˛_MaöLo›Proc
Ë
	t_ANSI_ARGS_
(());

719 
	sT˛_ObjTy≥
 {

720 *
	g«me
;

721 
T˛_FªeI¡î«lRïProc
 *
	g‰ìI¡RïProc
;

725 
T˛_DupI¡î«lRïProc
 *
	gdupI¡RïProc
;

728 
T˛_Upd©eSåögProc
 *
	gupd©eSåögProc
;

731 
T˛_SëFromAnyProc
 *
	g£tFromAnyProc
;

735 } 
	tT˛_ObjTy≥
;

743 
	sT˛_Obj
 {

744 
	gªfCou¡
;

745 *
	gbyãs
;

756 
	gÀngth
;

758 
T˛_ObjTy≥
 *
	gty≥På
;

763 
	gl⁄gVÆue
;

764 
	gdoubÀVÆue
;

765 
VOID
 *
	gŸhîVÆuePå
;

766 
T˛_WideI¡
 
	gwideVÆue
;

768 
VOID
 *
	g±r1
;

769 
VOID
 *
	g±r2
;

770 } 
	gtwoPåVÆue
;

773 
VOID
 *
	g±r
;

774 
	gvÆue
;

776 } 
	g±rAndL⁄gRï
;

777 } 
	göã∫ÆRï
;

778 } 
	tT˛_Obj
;

791 
T˛_In¸RefCou¡
 
_ANSI_ARGS_
((
T˛_Obj
 *
objPå
));

792 
T˛_De¸RefCou¡
 
_ANSI_ARGS_
((
T˛_Obj
 *
objPå
));

793 
T˛_IsSh¨ed
 
_ANSI_ARGS_
((
T˛_Obj
 *
objPå
));

801 
	sT˛_SavedResu…
 {

802 *
	gªsu…
;

803 
T˛_FªeProc
 *
	g‰ìProc
;

804 
T˛_Obj
 *
	gobjResu…På
;

805 *
	g≠≥ndResu…
;

806 
	g≠≥ndAvl
;

807 
	g≠≥ndU£d
;

808 
	gªsu…S∑˚
[
TCL_RESULT_SIZE
+1];

809 } 
	tT˛_SavedResu…
;

817 
	sT˛_Name•a˚
 {

818 *
	g«me
;

822 *
	gfuŒName
;

824 
Clõ¡D©a
 
	g˛õ¡D©a
;

826 
T˛_Name•a˚DñëeProc
 *
	gdñëeProc
;

829 
T˛_Name•a˚
 *
	g∑ª¡På
;

833 } 
	tT˛_Name•a˚
;

857 
	sT˛_CÆlFøme
 {

858 
T˛_Name•a˚
 *
	gnsPå
;

859 
	gdummy1
;

860 
	gdummy2
;

861 *
	gdummy3
;

862 *
	gdummy4
;

863 *
	gdummy5
;

864 
	gdummy6
;

865 *
	gdummy7
;

866 *
	gdummy8
;

867 
	gdummy9
;

868 *
	gdummy10
;

869 *
	gdummy11
;

870 *
	gdummy12
;

871 } 
	tT˛_CÆlFøme
;

887 
	sT˛_CmdInfo
 {

888 
	gisN©iveObje˘Proc
;

892 
T˛_ObjCmdProc
 *
	gobjProc
;

893 
Clõ¡D©a
 
	gobjClõ¡D©a
;

894 
T˛_CmdProc
 *
	g¥oc
;

895 
Clõ¡D©a
 
	g˛õ¡D©a
;

896 
T˛_CmdDñëeProc
 *
	gdñëeProc
;

899 
Clõ¡D©a
 
	gdñëeD©a
;

901 
T˛_Name•a˚
 *
	g«me•a˚På
;

906 } 
	tT˛_CmdInfo
;

914 
	#TCL_DSTRING_STATIC_SIZE
 200

	)

915 
	sT˛_DSåög
 {

916 *
	g°rög
;

918 
	gÀngth
;

920 
	g•a˚Avl
;

922 
	g°©icS∑˚
[
TCL_DSTRING_STATIC_SIZE
];

925 } 
	tT˛_DSåög
;

927 
	#T˛_DSåögLígth
(
dsPå
Ë((dsPå)->
Àngth
)

	)

928 
	#T˛_DSåögVÆue
(
dsPå
Ë((dsPå)->
°rög
)

	)

929 
	#T˛_DSåögTrunc
 
T˛_DSåögSëLígth


	)

937 
	#TCL_MAX_PREC
 17

	)

938 
	#TCL_DOUBLE_SPACE
 (
TCL_MAX_PREC
+10)

	)

946 
	#TCL_INTEGER_SPACE
 24

	)

960 
	#TCL_DONT_USE_BRACES
 1

	)

961 
	#TCL_DONT_QUOTE_HASH
 8

	)

968 
	#TCL_EXACT
 1

	)

985 
	#TCL_NO_EVAL
 0x10000

	)

986 
	#TCL_EVAL_GLOBAL
 0x20000

	)

987 
	#TCL_EVAL_DIRECT
 0x40000

	)

988 
	#TCL_EVAL_INVOKE
 0x80000

	)

995 
	#TCL_VOLATILE
 ((
T˛_FªeProc
 *Ë1)

	)

996 
	#TCL_STATIC
 ((
T˛_FªeProc
 *Ë0)

	)

997 
	#TCL_DYNAMIC
 ((
T˛_FªeProc
 *Ë3)

	)

1003 
	#TCL_GLOBAL_ONLY
 1

	)

1004 
	#TCL_NAMESPACE_ONLY
 2

	)

1005 
	#TCL_APPEND_VALUE
 4

	)

1006 
	#TCL_LIST_ELEMENT
 8

	)

1007 
	#TCL_TRACE_READS
 0x10

	)

1008 
	#TCL_TRACE_WRITES
 0x20

	)

1009 
	#TCL_TRACE_UNSETS
 0x40

	)

1010 
	#TCL_TRACE_DESTROYED
 0x80

	)

1011 
	#TCL_INTERP_DESTROYED
 0x100

	)

1012 
	#TCL_LEAVE_ERR_MSG
 0x200

	)

1013 
	#TCL_TRACE_ARRAY
 0x800

	)

1014 #i‚de‡
TCL_REMOVE_OBSOLETE_TRACES


1016 
	#TCL_TRACE_OLD_STYLE
 0x1000

	)

1019 
	#TCL_TRACE_RESULT_DYNAMIC
 0x8000

	)

1020 
	#TCL_TRACE_RESULT_OBJECT
 0x10000

	)

1026 
	#TCL_ENSEMBLE_PREFIX
 0x02

	)

1034 
	#TCL_TRACE_RENAME
 0x2000

	)

1035 
	#TCL_TRACE_DELETE
 0x4000

	)

1037 
	#TCL_ALLOW_INLINE_COMPILATION
 0x20000

	)

1046 #i‚de‡
TCL_NO_DEPRECATED


1047 
	#TCL_PARSE_PART1
 0x400

	)

1054 
	#TCL_LINK_INT
 1

	)

1055 
	#TCL_LINK_DOUBLE
 2

	)

1056 
	#TCL_LINK_BOOLEAN
 3

	)

1057 
	#TCL_LINK_STRING
 4

	)

1058 
	#TCL_LINK_WIDE_INT
 5

	)

1059 
	#TCL_LINK_CHAR
 6

	)

1060 
	#TCL_LINK_UCHAR
 7

	)

1061 
	#TCL_LINK_SHORT
 8

	)

1062 
	#TCL_LINK_USHORT
 9

	)

1063 
	#TCL_LINK_UINT
 10

	)

1064 
	#TCL_LINK_LONG
 11

	)

1065 
	#TCL_LINK_ULONG
 12

	)

1066 
	#TCL_LINK_FLOAT
 13

	)

1067 
	#TCL_LINK_WIDE_UINT
 14

	)

1068 
	#TCL_LINK_READ_ONLY
 0x80

	)

1074 
T˛_HashKeyTy≥
 
	tT˛_HashKeyTy≥
;

1075 
T˛_HashTabÀ
 
	tT˛_HashTabÀ
;

1076 
T˛_HashE¡ry
 
	tT˛_HashE¡ry
;

1078 (
	tT˛_HashKeyProc
Ë
	t_ANSI_ARGS_
((
	tT˛_HashTabÀ
 *
	tèbÀPå
,

1079 
	tVOID
 *
	tkeyPå
));

1080 (
	gT˛_Com∑ªHashKeysProc
Ë
	t_ANSI_ARGS_
((
	tVOID
 *
	tkeyPå
,

1081 
	tT˛_HashE¡ry
 *
	thPå
));

1082 
	gT˛_HashE¡ry
 *(
	tT˛_AŒocHashE¡ryProc
Ë
	t_ANSI_ARGS_
((

1083 
	tT˛_HashTabÀ
 *
	tèbÀPå
, 
	tVOID
 *
	tkeyPå
));

1084 (
	gT˛_FªeHashE¡ryProc
Ë
	t_ANSI_ARGS_
((
	tT˛_HashE¡ry
 *
	thPå
));

1094 #i‚de‡
TCL_HASH_KEY_STORE_HASH


1095 
	#TCL_HASH_KEY_STORE_HASH
 1

	)

1103 
	sT˛_HashE¡ry
 {

1104 
T˛_HashE¡ry
 *
	g√xtPå
;

1106 
T˛_HashTabÀ
 *
	gèbÀPå
;

1107 #i‡
TCL_HASH_KEY_STORE_HASH


1108 
VOID
 *
	ghash
;

1112 
T˛_HashE¡ry
 **
	gbuckëPå
;

1116 
Clõ¡D©a
 
	g˛õ¡D©a
;

1119 *
	g⁄eW‹dVÆue
;

1120 
T˛_Obj
 *
	gobjPå
;

1121 
	gw‹ds
[1];

1124 
	g°rög
[4];

1126 } 
	gkey
;

1144 
	#TCL_HASH_KEY_RANDOMIZE_HASH
 0x1

	)

1145 
	#TCL_HASH_KEY_SYSTEM_HASH
 0x2

	)

1151 
	#TCL_HASH_KEY_TYPE_VERSION
 1

	)

1152 
	sT˛_HashKeyTy≥
 {

1153 
	gvîsi⁄
;

1157 
	gÊags
;

1158 
T˛_HashKeyProc
 *
	ghashKeyProc
;

1162 
T˛_Com∑ªHashKeysProc
 *
	gcom∑ªKeysProc
;

1167 
T˛_AŒocHashE¡ryProc
 *
	gÆlocE¡ryProc
;

1181 
T˛_FªeHashE¡ryProc
 *
	g‰ìE¡ryProc
;

1196 
	#TCL_SMALL_HASH_TABLE
 4

	)

1197 
	sT˛_HashTabÀ
 {

1198 
T˛_HashE¡ry
 **
	gbuckës
;

1201 
T˛_HashE¡ry
 *
	g°©icBuckës
[
TCL_SMALL_HASH_TABLE
];

1204 
	gnumBuckës
;

1206 
	gnumE¡rõs
;

1208 
	gªbuûdSize
;

1210 
	gdownShi·
;

1213 
	gmask
;

1214 
	gkeyTy≥
;

1219 
	gT˛_HashE¡ry
 *(*
	gfödProc
Ë
_ANSI_ARGS_
((
T˛_HashTabÀ
 *
èbÀPå
,

1220 
CONST
 *
key
));

1221 
	gT˛_HashE¡ry
 *(*
	g¸óãProc
Ë
_ANSI_ARGS_
((
T˛_HashTabÀ
 *
èbÀPå
,

1222 
CONST
 *
key
, *
√wPå
));

1223 
T˛_HashKeyTy≥
 *
	gty≥På
;

1232 
	sT˛_HashSórch
 {

1233 
T˛_HashTabÀ
 *
	gèbÀPå
;

1234 
	g√xtIndex
;

1236 
T˛_HashE¡ry
 *
	g√xtE¡ryPå
;

1238 } 
	tT˛_HashSórch
;

1261 
	#TCL_STRING_KEYS
 0

	)

1262 
	#TCL_ONE_WORD_KEYS
 1

	)

1263 
	#TCL_CUSTOM_TYPE_KEYS
 -2

	)

1264 
	#TCL_CUSTOM_PTR_KEYS
 -1

	)

1273 *
	g√xt
;

1275 
	gïoch
;

1277 
T˛_Di˘
 
	gdi˘i⁄¨yPå
;

1278 } 
	tT˛_Di˘Sórch
;

1285 
	#TCL_DONT_WAIT
 (1<<1)

	)

1286 
	#TCL_WINDOW_EVENTS
 (1<<2)

	)

1287 
	#TCL_FILE_EVENTS
 (1<<3)

	)

1288 
	#TCL_TIMER_EVENTS
 (1<<4)

	)

1289 
	#TCL_IDLE_EVENTS
 (1<<5Ë

	)

1290 
	#TCL_ALL_EVENTS
 (~
TCL_DONT_WAIT
)

	)

1301 
	sT˛_Evít
 {

1302 
T˛_EvítProc
 *
	g¥oc
;

1303 
T˛_Evít
 *
	g√xtPå
;

1311 
	gTCL_QUEUE_TAIL
, 
	gTCL_QUEUE_HEAD
, 
	gTCL_QUEUE_MARK


1312 } 
	tT˛_QueuePosôi⁄
;

1319 
	#TCL_SERVICE_NONE
 0

	)

1320 
	#TCL_SERVICE_ALL
 1

	)

1328 
	sT˛_Time
 {

1329 
	g£c
;

1330 
	gu£c
;

1331 } 
	tT˛_Time
;

1333 (
	gT˛_SëTimîProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Time
 *
	ttimePå
));

1334 (
	gT˛_WaôF‹EvítProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Time
 *
	ttimePå
));

1340 (
	gT˛_GëTimeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Time
 *
	ttimebuf
,

1341 
	tClõ¡D©a
 
	t˛õ¡D©a
));

1342 (
	gT˛_SˇÀTimeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Time
 *
	ttimebuf
,

1343 
	tClõ¡D©a
 
	t˛õ¡D©a
));

1350 
	#TCL_READABLE
 (1<<1)

	)

1351 
	#TCL_WRITABLE
 (1<<2)

	)

1352 
	#TCL_EXCEPTION
 (1<<3)

	)

1360 
	#TCL_STDIN
 (1<<1)

	)

1361 
	#TCL_STDOUT
 (1<<2)

	)

1362 
	#TCL_STDERR
 (1<<3)

	)

1363 
	#TCL_ENFORCE_MODE
 (1<<4)

	)

1370 
	#TCL_CLOSE_READ
 (1<<1)

	)

1371 
	#TCL_CLOSE_WRITE
 (1<<2)

	)

1378 
	#TCL_CLOSE2PROC
 ((
T˛_DrivîClo£Proc
 *)1)

	)

1384 
	#TCL_CHANNEL_VERSION_1
 ((
T˛_Ch™√lTy≥Vîsi⁄
Ë0x1)

	)

1385 
	#TCL_CHANNEL_VERSION_2
 ((
T˛_Ch™√lTy≥Vîsi⁄
Ë0x2)

	)

1386 
	#TCL_CHANNEL_VERSION_3
 ((
T˛_Ch™√lTy≥Vîsi⁄
Ë0x3)

	)

1387 
	#TCL_CHANNEL_VERSION_4
 ((
T˛_Ch™√lTy≥Vîsi⁄
Ë0x4)

	)

1388 
	#TCL_CHANNEL_VERSION_5
 ((
T˛_Ch™√lTy≥Vîsi⁄
Ë0x5)

	)

1394 
	#TCL_CHANNEL_THREAD_INSERT
 (0)

	)

1395 
	#TCL_CHANNEL_THREAD_REMOVE
 (1)

	)

1401 (
	gT˛_DrivîBlockModeProc
Ë
	t_ANSI_ARGS_
((

1402 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	tmode
));

1403 (
	gT˛_DrivîClo£Proc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	tö°™˚D©a
,

1404 
	tT˛_I¡îp
 *
	töãΩ
));

1405 (
	gT˛_DrivîClo£2Proc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	tö°™˚D©a
,

1406 
	tT˛_I¡îp
 *
	töãΩ
, 
	tÊags
));

1407 (
	gT˛_DrivîI≈utProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	tö°™˚D©a
,

1408 *
	tbuf
, 
	ttoRód
, *
	tîr‹CodePå
));

1409 (
	gT˛_DrivîOuçutProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	tö°™˚D©a
,

1410 
	tCONST84
 *
	tbuf
, 
	ttoWrôe
, *
	tîr‹CodePå
));

1411 (
	gT˛_DrivîSìkProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	tö°™˚D©a
,

1412 
	toff£t
, 
	tmode
, *
	tîr‹CodePå
));

1413 (
	gT˛_DrivîSëO±i⁄Proc
Ë
	t_ANSI_ARGS_
((

1414 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	tT˛_I¡îp
 *
	töãΩ
,

1415 
	tCONST
 *
	t›ti⁄Name
, CONST *
	tvÆue
));

1416 (
	gT˛_DrivîGëO±i⁄Proc
Ë
	t_ANSI_ARGS_
((

1417 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	tT˛_I¡îp
 *
	töãΩ
,

1418 
	tCONST84
 *
	t›ti⁄Name
, 
	tT˛_DSåög
 *
	tdsPå
));

1419 (
	gT˛_DrivîW©chProc
Ë
	t_ANSI_ARGS_
((

1420 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	tmask
));

1421 (
	gT˛_DrivîGëH™dÀProc
Ë
	t_ANSI_ARGS_
((

1422 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	tdúe˘i⁄
,

1423 
	tClõ¡D©a
 *
	th™dÀPå
));

1424 (
	gT˛_DrivîFlushProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	tö°™˚D©a
));

1425 (
	gT˛_DrivîH™dÀrProc
Ë
	t_ANSI_ARGS_
((

1426 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	töãª°Mask
));

1427 
T˛_WideI¡
 (
	tT˛_DrivîWideSìkProc
Ë
	t_ANSI_ARGS_
((

1428 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	tT˛_WideI¡
 
	toff£t
,

1429 
	tmode
, *
	tîr‹CodePå
));

1433 (
	gT˛_DrivîThªadA˘i⁄Proc
Ë
	t_ANSI_ARGS_
 ((

1434 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	ta˘i⁄
));

1438 (
	gT˛_DrivîTrunˇãProc
Ë
	t_ANSI_ARGS_
((

1439 
	tClõ¡D©a
 
	tö°™˚D©a
, 
	tT˛_WideI¡
 
	tÀngth
));

1452 
	sT˛_Ch™√lTy≥
 {

1453 *
	gty≥Name
;

1456 
T˛_Ch™√lTy≥Vîsi⁄
 
	gvîsi⁄
;

1458 
T˛_DrivîClo£Proc
 *
	g˛o£Proc
;

1462 
T˛_DrivîI≈utProc
 *
	göputProc
;

1464 
T˛_DrivîOuçutProc
 *
	gouçutProc
;

1466 
T˛_DrivîSìkProc
 *
	g£ekProc
;

1469 
T˛_DrivîSëO±i⁄Proc
 *
	g£tO±i⁄Proc
;

1471 
T˛_DrivîGëO±i⁄Proc
 *
	ggëO±i⁄Proc
;

1473 
T˛_DrivîW©chProc
 *
	gw©chProc
;

1476 
T˛_DrivîGëH™dÀProc
 *
	ggëH™dÀProc
;

1479 
T˛_DrivîClo£2Proc
 *
	g˛o£2Proc
;

1483 
T˛_DrivîBlockModeProc
 *
	gblockModeProc
;

1489 
T˛_DrivîFlushProc
 *
	gÊushProc
;

1492 
T˛_DrivîH™dÀrProc
 *
	gh™dÀrProc
;

1499 
T˛_DrivîWideSìkProc
 *
	gwideSìkProc
;

1508 
T˛_DrivîThªadA˘i⁄Proc
 *
	gthªadA˘i⁄Proc
;

1517 
T˛_DrivîTrunˇãProc
 *
	gåunˇãProc
;

1521 } 
	tT˛_Ch™√lTy≥
;

1529 
	#TCL_MODE_BLOCKING
 0

	)

1530 
	#TCL_MODE_NONBLOCKING
 1

	)

1537 
	eT˛_P©hTy≥
 {

1538 
	gTCL_PATH_ABSOLUTE
,

1539 
	gTCL_PATH_RELATIVE
,

1540 
	gTCL_PATH_VOLUME_RELATIVE


1541 } 
	tT˛_P©hTy≥
;

1548 
	sT˛_GlobTy≥D©a
 {

1549 
	gty≥
;

1550 
	g≥rm
;

1551 
T˛_Obj
 *
	gmacTy≥
;

1552 
T˛_Obj
 *
	gmacCª©‹
;

1553 } 
	tT˛_GlobTy≥D©a
;

1559 
	#TCL_GLOB_TYPE_BLOCK
 (1<<0)

	)

1560 
	#TCL_GLOB_TYPE_CHAR
 (1<<1)

	)

1561 
	#TCL_GLOB_TYPE_DIR
 (1<<2)

	)

1562 
	#TCL_GLOB_TYPE_PIPE
 (1<<3)

	)

1563 
	#TCL_GLOB_TYPE_FILE
 (1<<4)

	)

1564 
	#TCL_GLOB_TYPE_LINK
 (1<<5)

	)

1565 
	#TCL_GLOB_TYPE_SOCK
 (1<<6)

	)

1566 
	#TCL_GLOB_TYPE_MOUNT
 (1<<7)

	)

1568 
	#TCL_GLOB_PERM_RONLY
 (1<<0)

	)

1569 
	#TCL_GLOB_PERM_HIDDEN
 (1<<1)

	)

1570 
	#TCL_GLOB_PERM_R
 (1<<2)

	)

1571 
	#TCL_GLOB_PERM_W
 (1<<3)

	)

1572 
	#TCL_GLOB_PERM_X
 (1<<4)

	)

1578 
	#TCL_UNLOAD_DETACH_FROM_INTERPRETER
 (1<<0)

	)

1579 
	#TCL_UNLOAD_DETACH_FROM_PROCESS
 (1<<1)

	)

1585 (
	gT˛_FSSètProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
, 
	tT˛_SètBuf
 *
	tbuf
));

1586 (
	gT˛_FSAc˚ssProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
, 
	tmode
));

1587 
T˛_Ch™√l
 (
	tT˛_FSO≥nFûeCh™√lProc
Ë
	t_ANSI_ARGS_
((

1588 
	tT˛_I¡îp
 *
	töãΩ
, 
	tT˛_Obj
 *
	t∑thPå
, 
	tmode
, 
	t≥rmissi⁄s
));

1589 (
	gT˛_FSM©chInDúe˘‹yProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
,

1590 
	tT˛_Obj
 *
	tªsu…
, T˛_Obj *
	t∑thPå
, 
	tCONST
 *
	t∑âîn
,

1591 
	tT˛_GlobTy≥D©a
 * 
	tty≥s
));

1592 
	gT˛_Obj
 * (
	tT˛_FSGëCwdProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
));

1593 (
	gT˛_FSChdúProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
));

1594 (
	gT˛_FSL°©Proc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
,

1595 
	tT˛_SètBuf
 *
	tbuf
));

1596 (
	gT˛_FSCª©eDúe˘‹yProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
));

1597 (
	gT˛_FSDñëeFûeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
));

1598 (
	gT˛_FSC›yDúe˘‹yProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t§cP©hPå
,

1599 
	tT˛_Obj
 *
	tde°P©hPå
, T˛_Obj **
	tîr‹På
));

1600 (
	gT˛_FSC›yFûeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t§cP©hPå
,

1601 
	tT˛_Obj
 *
	tde°P©hPå
));

1602 (
	gT˛_FSRemoveDúe˘‹yProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
,

1603 
	tªcursive
, 
	tT˛_Obj
 **
	tîr‹På
));

1604 (
	gT˛_FSRíameFûeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t§cP©hPå
,

1605 
	tT˛_Obj
 *
	tde°P©hPå
));

1606 (
	gT˛_FSU∆ﬂdFûeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_LﬂdH™dÀ
 
	tlﬂdH™dÀ
));

1607 
	gT˛_Obj
 * (
	tT˛_FSLi°VﬁumesProc
Ë
	t_ANSI_ARGS_
(());

1609 
	gutimbuf
;

1610 (
	gT˛_FSUtimeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
,

1611 
	tutimbuf
 *
	ttvÆ
));

1612 (
	gT˛_FSN‹mÆizeP©hProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
,

1613 
	tT˛_Obj
 *
	t∑thPå
, 
	t√xtCheckpoöt
));

1614 (
	gT˛_FSFûeAârsGëProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
,

1615 
	tödex
, 
	tT˛_Obj
 *
	t∑thPå
, T˛_Obj **
	tobjPåRef
));

1616 
CONST
 ** (
	tT˛_FSFûeAârSåögsProc
Ë
	t_ANSI_ARGS_
((

1617 
	tT˛_Obj
 *
	t∑thPå
, T˛_Obj **
	tobjPåRef
));

1618 (
	gT˛_FSFûeAârsSëProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 *
	töãΩ
,

1619 
	tödex
, 
	tT˛_Obj
 *
	t∑thPå
, T˛_Obj *
	tobjPå
));

1620 
	gT˛_Obj
 * (
	tT˛_FSLökProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
,

1621 
	tT˛_Obj
 *
	ttoPå
, 
	tlökTy≥
));

1622 (
	gT˛_FSLﬂdFûeProc
Ë
	t_ANSI_ARGS_
((
	tT˛_I¡îp
 * 
	töãΩ
,

1623 
	tT˛_Obj
 *
	t∑thPå
, 
	tT˛_LﬂdH™dÀ
 *
	th™dÀPå
,

1624 
	tT˛_FSU∆ﬂdFûeProc
 **
	tu∆ﬂdProcPå
));

1625 (
	gT˛_FSP©hInFûesy°emProc
Ë
	t_ANSI_ARGS_
((
	tT˛_Obj
 *
	t∑thPå
,

1626 
	tClõ¡D©a
 *
	t˛õ¡D©aPå
));

1627 
	gT˛_Obj
 * (
	tT˛_FSFûesy°emP©hTy≥Proc
Ë
	t_ANSI_ARGS_
((

1628 
	tT˛_Obj
 *
	t∑thPå
));

1629 
	gT˛_Obj
 * (
	tT˛_FSFûesy°emSï¨©‹Proc
Ë
	t_ANSI_ARGS_
((

1630 
	tT˛_Obj
 *
	t∑thPå
));

1631 (
	gT˛_FSFªeI¡î«lRïProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

1632 
Clõ¡D©a
 (
	tT˛_FSDupI¡î«lRïProc
Ë
	t_ANSI_ARGS_
((

1633 
	tClõ¡D©a
 
	t˛õ¡D©a
));

1634 
	gT˛_Obj
 * (
	tT˛_FSI¡î«lToN‹mÆizedProc
Ë
	t_ANSI_ARGS_
((

1635 
	tClõ¡D©a
 
	t˛õ¡D©a
));

1636 
Clõ¡D©a
 (
	tT˛_FSCª©eI¡î«lRïProc
Ë
	t_ANSI_ARGS_
((

1637 
	tT˛_Obj
 *
	t∑thPå
));

1639 
T˛_FSVîsi⁄_
 *
	tT˛_FSVîsi⁄
;

1650 
	#TCL_FILESYSTEM_VERSION_1
 ((
T˛_FSVîsi⁄
Ë0x1)

	)

1665 
	sT˛_Fûesy°em
 {

1666 
CONST
 *
	gty≥Name
;

1667 
	g°ru˘uªLígth
;

1669 
T˛_FSVîsi⁄
 
	gvîsi⁄
;

1670 
T˛_FSP©hInFûesy°emProc
 *
	g∑thInFûesy°emProc
;

1674 
T˛_FSDupI¡î«lRïProc
 *
	gdupI¡î«lRïProc
;

1677 
T˛_FSFªeI¡î«lRïProc
 *
	g‰ìI¡î«lRïProc
;

1681 
T˛_FSI¡î«lToN‹mÆizedProc
 *
	göã∫ÆToN‹mÆizedProc
;

1686 
T˛_FSCª©eI¡î«lRïProc
 *
	g¸óãI¡î«lRïProc
;

1694 
T˛_FSN‹mÆizeP©hProc
 *
	gn‹mÆizeP©hProc
;

1699 
T˛_FSFûesy°emP©hTy≥Proc
 *
	gfûesy°emP©hTy≥Proc
;

1702 
T˛_FSFûesy°emSï¨©‹Proc
 *
	gfûesy°emSï¨©‹Proc
;

1706 
T˛_FSSètProc
 *
	g°©Proc
;

1709 
T˛_FSAc˚ssProc
 *
	gac˚ssProc
;

1713 
T˛_FSO≥nFûeCh™√lProc
 *
	g›íFûeCh™√lProc
;

1718 
T˛_FSM©chInDúe˘‹yProc
 *
	gm©chInDúe˘‹yProc
;

1724 
T˛_FSUtimeProc
 *
	gutimeProc
;

1729 
T˛_FSLökProc
 *
	glökProc
;

1733 
T˛_FSLi°VﬁumesProc
 *
	gli°VﬁumesProc
;

1738 
T˛_FSFûeAârSåögsProc
 *
	gfûeAârSåögsProc
;

1745 
T˛_FSFûeAârsGëProc
 *
	gfûeAârsGëProc
;

1749 
T˛_FSFûeAârsSëProc
 *
	gfûeAârsSëProc
;

1753 
T˛_FSCª©eDúe˘‹yProc
 *
	g¸óãDúe˘‹yProc
;

1757 
T˛_FSRemoveDúe˘‹yProc
 *
	gªmoveDúe˘‹yProc
;

1761 
T˛_FSDñëeFûeProc
 *
	gdñëeFûeProc
;

1765 
T˛_FSC›yFûeProc
 *
	gc›yFûeProc
;

1771 
T˛_FSRíameFûeProc
 *
	gª«meFûeProc
;

1776 
T˛_FSC›yDúe˘‹yProc
 *
	gc›yDúe˘‹yProc
;

1783 
T˛_FSL°©Proc
 *
	gl°©Proc
;

1786 
T˛_FSLﬂdFûeProc
 *
	glﬂdFûeProc
;

1791 
T˛_FSGëCwdProc
 *
	ggëCwdProc
;

1797 
T˛_FSChdúProc
 *
	gchdúProc
;

1812 } 
	tT˛_Fûesy°em
;

1824 
	#TCL_CREATE_SYMBOLIC_LINK
 0x01

	)

1825 
	#TCL_CREATE_HARD_LINK
 0x02

	)

1832 
	sT˛_NŸifõrProcs
 {

1833 
T˛_SëTimîProc
 *
	g£tTimîProc
;

1834 
T˛_WaôF‹EvítProc
 *
	gwaôF‹EvítProc
;

1835 
T˛_Cª©eFûeH™dÀrProc
 *
	g¸óãFûeH™dÀrProc
;

1836 
T˛_DñëeFûeH™dÀrProc
 *
	gdñëeFûeH™dÀrProc
;

1837 
T˛_InôNŸifõrProc
 *
	göôNŸifõrProc
;

1838 
T˛_FöÆizeNŸifõrProc
 *
	gföÆizeNŸifõrProc
;

1839 
T˛_AÀπNŸifõrProc
 *
	gÆîtNŸifõrProc
;

1840 
T˛_Sîvi˚ModeHookProc
 *
	g£rvi˚ModeHookProc
;

1841 } 
	tT˛_NŸifõrProcs
;

1848 
	sT˛_EncodögTy≥
 {

1849 
CONST
 *
	gícodögName
;

1852 
T˛_EncodögC⁄vîtProc
 *
	gtoUtfProc
;

1855 
T˛_EncodögC⁄vîtProc
 *
	g‰omUtfProc
;

1858 
T˛_EncodögFªeProc
 *
	g‰ìProc
;

1861 
Clõ¡D©a
 
	g˛õ¡D©a
;

1863 
	gnuŒSize
;

1868 } 
	tT˛_EncodögTy≥
;

1900 
	#TCL_ENCODING_START
 0x01

	)

1901 
	#TCL_ENCODING_END
 0x02

	)

1902 
	#TCL_ENCODING_STOPONERROR
 0x04

	)

1914 
	sT˛_Tokí
 {

1915 
	gty≥
;

1917 
CONST
 *
	g°¨t
;

1918 
	gsize
;

1919 
	gnumComp⁄íts
;

1924 } 
	tT˛_Tokí
;

1997 
	#TCL_TOKEN_WORD
 1

	)

1998 
	#TCL_TOKEN_SIMPLE_WORD
 2

	)

1999 
	#TCL_TOKEN_TEXT
 4

	)

2000 
	#TCL_TOKEN_BS
 8

	)

2001 
	#TCL_TOKEN_COMMAND
 16

	)

2002 
	#TCL_TOKEN_VARIABLE
 32

	)

2003 
	#TCL_TOKEN_SUB_EXPR
 64

	)

2004 
	#TCL_TOKEN_OPERATOR
 128

	)

2005 
	#TCL_TOKEN_EXPAND_WORD
 256

	)

2012 
	#TCL_PARSE_SUCCESS
 0

	)

2013 
	#TCL_PARSE_QUOTE_EXTRA
 1

	)

2014 
	#TCL_PARSE_BRACE_EXTRA
 2

	)

2015 
	#TCL_PARSE_MISSING_BRACE
 3

	)

2016 
	#TCL_PARSE_MISSING_BRACKET
 4

	)

2017 
	#TCL_PARSE_MISSING_PAREN
 5

	)

2018 
	#TCL_PARSE_MISSING_QUOTE
 6

	)

2019 
	#TCL_PARSE_MISSING_VAR_BRACE
 7

	)

2020 
	#TCL_PARSE_SYNTAX
 8

	)

2021 
	#TCL_PARSE_BAD_NUMBER
 9

	)

2028 
	#NUM_STATIC_TOKENS
 20

	)

2030 
	sT˛_P¨£
 {

2031 
CONST
 *
	gcommítSèπ
;

2033 
	gcommítSize
;

2037 
CONST
 *
	gcomm™dSèπ
;

2039 
	gcomm™dSize
;

2043 
	gnumW‹ds
;

2045 
T˛_Tokí
 *
	gtokíPå
;

2050 
	gnumTokís
;

2051 
	gtokísAvaûabÀ
;

2053 
	gîr‹Ty≥
;

2061 
CONST
 *
	g°rög
;

2063 
CONST
 *
	gíd
;

2065 
T˛_I¡îp
 *
	göãΩ
;

2067 
CONST
 *
	gãrm
;

2073 
	göcom∂ëe
;

2077 
T˛_Tokí
 
	g°©icTokís
[
NUM_STATIC_TOKENS
];

2083 } 
	tT˛_P¨£
;

2113 
	#TCL_CONVERT_MULTIBYTE
 -1

	)

2114 
	#TCL_CONVERT_SYNTAX
 -2

	)

2115 
	#TCL_CONVERT_UNKNOWN
 -3

	)

2116 
	#TCL_CONVERT_NOSPACE
 -4

	)

2128 #i‚de‡
TCL_UTF_MAX


2129 
	#TCL_UTF_MAX
 3

	)

2137 #i‡
TCL_UTF_MAX
 > 3

2147 
	tT˛_UniCh¨
;

2149 
	tT˛_UniCh¨
;

2157 
	sT˛_C⁄fig
 {

2158 
CONST
 *
	gkey
;

2160 
CONST
 *
	gvÆue
;

2162 } 
	tT˛_C⁄fig
;

2169 
	#TCL_LIMIT_COMMANDS
 0x01

	)

2170 
	#TCL_LIMIT_TIME
 0x02

	)

2177 (
	gT˛_LimôH™dÀrProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
,

2178 
	tT˛_I¡îp
 *
	töãΩ
));

2179 (
	gT˛_LimôH™dÀrDñëeProc
Ë
	t_ANSI_ARGS_
((
	tClõ¡D©a
 
	t˛õ¡D©a
));

2181 #i‚de‡
MP_INT_DECLARED


2182 
mp_öt
 
	tmp_öt
;

2183 
	#MP_INT_DECLARED


	)

2185 #i‚de‡
MP_DIGIT_DECLARED


2186 
	tmp_digô
;

2187 
	#MP_DIGIT_DECLARED


	)

2198 
	#TCL_STUB_MAGIC
 (()0xFCA3BACF)

	)

2207 
EXTERN
 
CONST
 * 
T˛_InôStubs
 
_ANSI_ARGS_
((
T˛_I¡îp
 *
öãΩ
,

2208 
CONST
 *
vîsi⁄
, 
exa˘
));

2209 
EXTERN
 
CONST
 * 
T˛TomM©hInôülizeStubs
 
_ANSI_ARGS_
((

2210 
T˛_I¡îp
 *
öãΩ
, 
CONST
 *
vîsi⁄
,

2211 
ïoch
, 
ªvisi⁄
));

2213 #i‚de‡
USE_TCL_STUBS


2219 
	#T˛_InôStubs
(
öãΩ
, 
vîsi⁄
, 
exa˘
) \

2220 
	`T˛_PkgInôStubsCheck
(
öãΩ
, 
vîsi⁄
, 
exa˘
)

	)

2234 
EXTERN
 
T˛_Maö
 
_ANSI_ARGS_
((
¨gc
, **
¨gv
,

2235 
T˛_AµInôProc
 *
≠pInôProc
));

2236 
EXTERN
 
CONST
 * 
T˛_PkgInôStubsCheck
 
_ANSI_ARGS_
((
T˛_I¡îp
 *
öãΩ
,

2237 
CONST
 *
vîsi⁄
, 
exa˘
));

2238 #i‡
deföed
(
TCL_THREADS
Ë&& deföed(
USE_THREAD_ALLOC
)

2239 
EXTERN
 
T˛_GëMem‹yInfo
 
_ANSI_ARGS_
((
T˛_DSåög
 *
dsPå
));

2247 
	~"t˛De˛s.h
"

2254 
	~"t˛PœtDe˛s.h
"

2262 #ifde‡
TCL_MEM_DEBUG


2264 
	#ckÆloc
(
x
Ë
	`T˛_DbCkÆloc
(x, 
__FILE__
, 
__LINE__
)

	)

2265 
	#ck‰ì
(
x
Ë
	`T˛_DbCk‰ì
(x, 
__FILE__
, 
__LINE__
)

	)

2266 
	#ckªÆloc
(
x
,
y
Ë
	`T˛_DbCkªÆloc
((x), (y),
__FILE__
, 
__LINE__
)

	)

2267 
	#©ãm±ckÆloc
(
x
Ë
	`T˛_Aâem±DbCkÆloc
(x, 
__FILE__
, 
__LINE__
)

	)

2268 
	#©ãm±ckªÆloc
(
x
,
y
Ë
	`T˛_Aâem±DbCkªÆloc
((x), (y), 
__FILE__
, 
__LINE__
)

	)

2278 
	#ckÆloc
(
x
Ë
	`T˛_AŒoc
(x)

	)

2279 
	#ck‰ì
(
x
Ë
	`T˛_Fªe
(x)

	)

2280 
	#ckªÆloc
(
x
,
y
Ë
	`T˛_RóŒoc
(x,y)

	)

2281 
	#©ãm±ckÆloc
(
x
Ë
	`T˛_Aâem±AŒoc
(x)

	)

2282 
	#©ãm±ckªÆloc
(
x
,
y
Ë
	`T˛_Aâem±RóŒoc
(x,y)

	)

2283 #unde‡
T˛_InôMem‹y


2284 
	#T˛_InôMem‹y
(
x
)

	)

2285 #unde‡
T˛_DumpA˘iveMem‹y


2286 
	#T˛_DumpA˘iveMem‹y
(
x
)

	)

2287 #unde‡
T˛_VÆid©eAŒMem‹y


2288 
	#T˛_VÆid©eAŒMem‹y
(
x
,
y
)

	)

2292 #ifde‡
TCL_MEM_DEBUG


2293 
	#T˛_In¸RefCou¡
(
objPå
) \

2294 
	`T˛_DbIn¸RefCou¡
(
objPå
, 
__FILE__
, 
__LINE__
)

	)

2295 
	#T˛_De¸RefCou¡
(
objPå
) \

2296 
	`T˛_DbDe¸RefCou¡
(
objPå
, 
__FILE__
, 
__LINE__
)

	)

2297 
	#T˛_IsSh¨ed
(
objPå
) \

2298 
	`T˛_DbIsSh¨ed
(
objPå
, 
__FILE__
, 
__LINE__
)

	)

2300 
	#T˛_In¸RefCou¡
(
objPå
) \

2301 ++(
objPå
)->
ªfCou¡


	)

2306 
	#T˛_De¸RefCou¡
(
objPå
) \

2307 dÿ{ i‡(--(
objPå
)->
ªfCou¡
 <0Ë
	`T˛FªeObj
(objPå); } 0)

	)

2308 
	#T˛_IsSh¨ed
(
objPå
) \

2309 ((
objPå
)->
ªfCou¡
 > 1)

	)

2318 #ifde‡
TCL_MEM_DEBUG


2319 #unde‡
T˛_NewBignumObj


2320 
	#T˛_NewBignumObj
(
vÆ
) \

2321 
	`T˛_DbNewBignumObj
(
vÆ
, 
__FILE__
, 
__LINE__
)

	)

2322 #unde‡
T˛_NewBoﬁónObj


2323 
	#T˛_NewBoﬁónObj
(
vÆ
) \

2324 
	`T˛_DbNewBoﬁónObj
(
vÆ
, 
__FILE__
, 
__LINE__
)

	)

2325 #unde‡
T˛_NewByãAºayObj


2326 
	#T˛_NewByãAºayObj
(
byãs
, 
Àn
) \

2327 
	`T˛_DbNewByãAºayObj
(
byãs
, 
Àn
, 
__FILE__
, 
__LINE__
)

	)

2328 #unde‡
T˛_NewDoubÀObj


2329 
	#T˛_NewDoubÀObj
(
vÆ
) \

2330 
	`T˛_DbNewDoubÀObj
(
vÆ
, 
__FILE__
, 
__LINE__
)

	)

2331 #unde‡
T˛_NewI¡Obj


2332 
	#T˛_NewI¡Obj
(
vÆ
) \

2333 
	`T˛_DbNewL⁄gObj
(
vÆ
, 
__FILE__
, 
__LINE__
)

	)

2334 #unde‡
T˛_NewLi°Obj


2335 
	#T˛_NewLi°Obj
(
objc
, 
objv
) \

2336 
	`T˛_DbNewLi°Obj
(
objc
, 
objv
, 
__FILE__
, 
__LINE__
)

	)

2337 #unde‡
T˛_NewL⁄gObj


2338 
	#T˛_NewL⁄gObj
(
vÆ
) \

2339 
	`T˛_DbNewL⁄gObj
(
vÆ
, 
__FILE__
, 
__LINE__
)

	)

2340 #unde‡
T˛_NewObj


2341 
	#T˛_NewObj
() \

2342 
	`T˛_DbNewObj
(
__FILE__
, 
__LINE__
)

	)

2343 #unde‡
T˛_NewSåögObj


2344 
	#T˛_NewSåögObj
(
byãs
, 
Àn
) \

2345 
	`T˛_DbNewSåögObj
(
byãs
, 
Àn
, 
__FILE__
, 
__LINE__
)

	)

2346 #unde‡
T˛_NewWideI¡Obj


2347 
	#T˛_NewWideI¡Obj
(
vÆ
) \

2348 
	`T˛_DbNewWideI¡Obj
(
vÆ
, 
__FILE__
, 
__LINE__
)

	)

2355 
	#T˛_GëHashVÆue
(
h
Ë((h)->
˛õ¡D©a
)

	)

2356 
	#T˛_SëHashVÆue
(
h
, 
vÆue
Ë((h)->
˛õ¡D©a
 = (
Clõ¡D©a
Ë(vÆue))

	)

2357 
	#T˛_GëHashKey
(
èbÀPå
, 
h
) \

2358 ((*Ë(((
èbÀPå
)->
keyTy≥
 =
TCL_ONE_WORD_KEYS
 || \

2359 (
èbÀPå
)->
keyTy≥
 =
TCL_CUSTOM_PTR_KEYS
) \

2360 ? (
h
)->
key
.
⁄eW‹dVÆue
 \

2361 : (
h
)->
key
.
°rög
))

	)

2368 #unde‡
T˛_FödHashE¡ry


2369 
	#T˛_FödHashE¡ry
(
èbÀPå
, 
key
) \

2370 (*((
èbÀPå
)->
födProc
))—abÀPå, 
key
)

	)

2371 #unde‡
T˛_Cª©eHashE¡ry


2372 
	#T˛_Cª©eHashE¡ry
(
èbÀPå
, 
key
, 
√wPå
) \

2373 (*((
èbÀPå
)->
¸óãProc
))—abÀPå, 
key
, 
√wPå
)

	)

2380 #i‚de‡
TCL_THREADS


2381 #unde‡
T˛_MuãxLock


2382 
	#T˛_MuãxLock
(
muãxPå
)

	)

2383 #unde‡
T˛_MuãxU∆ock


2384 
	#T˛_MuãxU∆ock
(
muãxPå
)

	)

2385 #unde‡
T˛_MuãxFöÆize


2386 
	#T˛_MuãxFöÆize
(
muãxPå
)

	)

2387 #unde‡
T˛_C⁄dôi⁄NŸify


2388 
	#T˛_C⁄dôi⁄NŸify
(
c⁄dPå
)

	)

2389 #unde‡
T˛_C⁄dôi⁄Waô


2390 
	#T˛_C⁄dôi⁄Waô
(
c⁄dPå
, 
muãxPå
, 
timePå
)

	)

2391 #unde‡
T˛_C⁄dôi⁄FöÆize


2392 
	#T˛_C⁄dôi⁄FöÆize
(
c⁄dPå
)

	)

2395 #i‚de‡
TCL_NO_DEPRECATED


2400 #unde‡
T˛_EvÆObj


2401 
	#T˛_EvÆObj
(
öãΩ
,
objPå
) \

2402 
	`T˛_EvÆObjEx
((
öãΩ
),(
objPå
),0)

	)

2403 #unde‡
T˛_GlobÆEvÆObj


2404 
	#T˛_GlobÆEvÆObj
(
öãΩ
,
objPå
) \

2405 
	`T˛_EvÆObjEx
((
öãΩ
),(
objPå
),
TCL_EVAL_GLOBAL
)

	)

2412 
	#T˛_CkÆloc
 
T˛_AŒoc


	)

2413 
	#T˛_Ck‰ì
 
T˛_Fªe


	)

2414 
	#T˛_CkªÆloc
 
T˛_RóŒoc


	)

2415 
	#T˛_Rëu∫
 
T˛_SëResu…


	)

2416 
	#T˛_TûdeSub°
 
T˛_Tøn¶©eFûeName


	)

2417 
	#∑nic
 
T˛_P™ic


	)

2418 
	#∑nicVA
 
T˛_P™icVA


	)

2427 #unde‡
TCL_STORAGE_CLASS


2428 
	#TCL_STORAGE_CLASS


	)

2430 
EXTERN
 
T˛_AµInô
 
_ANSI_ARGS_
((
T˛_I¡îp
 *
öãΩ
));

2432 #unde‡
TCL_STORAGE_CLASS


2433 
	#TCL_STORAGE_CLASS
 
DLLIMPORT


	)

2441 #ifde‡
__˝lu•lus


	@/usr/include/bits/sched.h

22 #i‚de‡
__√ed_sched∑øm


24 #i‚de‡
_SCHED_H


30 
	#SCHED_OTHER
 0

	)

31 
	#SCHED_FIFO
 1

	)

32 
	#SCHED_RR
 2

	)

33 #ifde‡
__USE_GNU


34 
	#SCHED_BATCH
 3

	)

37 #ifde‡
__USE_MISC


39 
	#CSIGNAL
 0x000000f‡

	)

40 
	#CLONE_VM
 0x00000100

	)

41 
	#CLONE_FS
 0x00000200

	)

42 
	#CLONE_FILES
 0x00000400

	)

43 
	#CLONE_SIGHAND
 0x00000800

	)

44 
	#CLONE_PTRACE
 0x00002000

	)

45 
	#CLONE_VFORK
 0x00004000

	)

47 
	#CLONE_PARENT
 0x00008000

	)

49 
	#CLONE_THREAD
 0x00010000

	)

50 
	#CLONE_NEWNS
 0x00020000

	)

51 
	#CLONE_SYSVSEM
 0x00040000

	)

52 
	#CLONE_SETTLS
 0x00080000

	)

53 
	#CLONE_PARENT_SETTID
 0x00100000

	)

55 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

57 
	#CLONE_DETACHED
 0x00400000

	)

58 
	#CLONE_UNTRACED
 0x00800000

	)

60 
	#CLONE_CHILD_SETTID
 0x01000000

	)

62 
	#CLONE_NEWUTS
 0x04000000

	)

63 
	#CLONE_NEWIPC
 0x08000000

	)

64 
	#CLONE_NEWUSER
 0x10000000

	)

65 
	#CLONE_NEWPID
 0x20000000

	)

66 
	#CLONE_NEWNET
 0x40000000

	)

67 
	#CLONE_IO
 0x80000000

	)

71 
	ssched_∑øm


73 
	m__sched_¥i‹ôy
;

76 
	g__BEGIN_DECLS


78 #ifde‡
__USE_MISC


80 
˛⁄e
 ((*
__‚
Ë(*
__¨g
), *
__chûd_°ack
,

81 
__Êags
, *
__¨g
, ...Ë
__THROW
;

84 
	$unsh¨e
 (
__Êags
Ë
__THROW
;

87 
	$sched_gë˝u
 (Ë
__THROW
;

90 
__END_DECLS


94 #i‡!
deföed
 
__deföed_sched∑øm
 \

95 && (
deföed
 
__√ed_sched∑øm
 || deföed 
_SCHED_H
)

96 
	#__deföed_sched∑øm
 1

	)

98 
	s__sched_∑øm


100 
__sched_¥i‹ôy
;

102 #unde‡
__√ed_sched∑øm


106 #i‡
deföed
 
_SCHED_H
 && !deföed 
__˝u_£t_t_deföed


107 
	#__˝u_£t_t_deföed


	)

109 
	#__CPU_SETSIZE
 1024

	)

110 
	#__NCPUBITS
 (8 *  (
__˝u_mask
))

	)

113 
	t__˝u_mask
;

116 
	#__CPUELT
(
˝u
Ë((˝uË/ 
__NCPUBITS
)

	)

117 
	#__CPUMASK
(
˝u
Ë((
__˝u_mask
Ë1 << ((˝uË% 
__NCPUBITS
))

	)

122 
__˝u_mask
 
__bôs
[
__CPU_SETSIZE
 / 
__NCPUBITS
];

123 } 
	t˝u_£t_t
;

126 #i‡
	`__GNUC_PREREQ
 (2, 91)

127 
	#__CPU_ZERO_S
(
£tsize
, 
˝u£ç
) \

128 dÿ
	`__buûtö_mem£t
 (
˝u£ç
, '\0', 
£tsize
); 0)

	)

130 
	#__CPU_ZERO_S
(
£tsize
, 
˝u£ç
) \

132 
size_t
 
__i
; \

133 
size_t
 
__imax
 = (
£tsize
Ë/  (
__˝u_mask
); \

134 
˝u_£t_t
 *
__¨r
 = (
˝u£ç
); \

135 
__i
 = 0; __ò< 
__imax
; ++__i) \

136 
__¨r
->
__bôs
[
__i
] = 0; \

137 
	}
} 0)

	)

139 
	#__CPU_SET_S
(
˝u
, 
£tsize
, 
˝u£ç
) \

140 (
__exãnsi⁄__
 \

141 ({ 
size_t
 
__˝u
 = (
˝u
); \

142 
__˝u
 < 8 * (
£tsize
) \

143 ? ((
˝u£ç
)->
__bôs
[
	`__CPUELT
 (
__˝u
)] |
	`__CPUMASK
 (__˝u)Ë: 0; }))

	)

144 
	#__CPU_CLR_S
(
˝u
, 
£tsize
, 
˝u£ç
) \

145 (
__exãnsi⁄__
 \

146 ({ 
size_t
 
__˝u
 = (
˝u
); \

147 
__˝u
 < 8 * (
£tsize
) \

148 ? ((
˝u£ç
)->
__bôs
[
	`__CPUELT
 (
__˝u
)] &~
	`__CPUMASK
 (__˝u)Ë: 0; }))

	)

149 
	#__CPU_ISSET_S
(
˝u
, 
£tsize
, 
˝u£ç
) \

150 (
__exãnsi⁄__
 \

151 ({ 
size_t
 
__˝u
 = (
˝u
); \

152 
__˝u
 < 8 * (
£tsize
) \

153 ? (((
˝u£ç
)->
__bôs
[
	`__CPUELT
 (
__˝u
)] & 
	`__CPUMASK
 (__cpu))) != 0 \

154 : 0; }))

	)

156 
	#__CPU_COUNT_S
(
£tsize
, 
˝u£ç
) \

157 
	`__sched_˝ucou¡
 (
£tsize
, 
˝u£ç
)

	)

159 #i‡
__GNUC_PREREQ
 (2, 91)

160 
	#__CPU_EQUAL_S
(
£tsize
, 
˝u£ç1
, 
˝u£ç2
) \

161 (
	`__buûtö_memcmp
 (
˝u£ç1
, 
˝u£ç2
, 
£tsize
Ë=0)

	)

163 
	#__CPU_EQUAL_S
(
£tsize
, 
˝u£ç1
, 
˝u£ç2
) \

164 (
__exãnsi⁄__
 \

165 ({ 
˝u_£t_t
 *
__¨r1
 = (
˝u£ç1
); \

166 
˝u_£t_t
 *
__¨r2
 = (
˝u£ç2
); \

167 
size_t
 
__imax
 = (
£tsize
Ë/  (
__˝u_mask
); \

168 
size_t
 
__i
; \

169 
__i
 = 0; __ò< 
__imax
; ++__i) \

170 i‡(
__¨r1
->
__bôs
[
__i
] !
__¨r2
->__bits[__i]) \

172 
__i
 =
__imax
; }))

	)

175 
	#__CPU_OP_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, 
›
) \

176 (
__exãnsi⁄__
 \

177 ({ 
˝u_£t_t
 *
__de°
 = (
de°£t
); \

178 
˝u_£t_t
 *
__¨r1
 = (
§c£t1
); \

179 
˝u_£t_t
 *
__¨r2
 = (
§c£t2
); \

180 
size_t
 
__imax
 = (
£tsize
Ë/  (
__˝u_mask
); \

181 
size_t
 
__i
; \

182 
__i
 = 0; __ò< 
__imax
; ++__i) \

183 
__de°
->
__bôs
[
__i
] = 
__¨r1
->__bôs[__i] 
›
 
__¨r2
->__bits[__i]; \

184 
__de°
; }))

	)

186 
	#__CPU_ALLOC_SIZE
(
cou¡
) \

187 ((((
cou¡
Ë+ 
__NCPUBITS
 - 1Ë/ __NCPUBITSË* 8)

	)

188 
	#__CPU_ALLOC
(
cou¡
Ë
	`__sched_˝uÆloc
 (cou¡)

	)

189 
	#__CPU_FREE
(
˝u£t
Ë
	`__sched_˝u‰ì
 (˝u£t)

	)

191 
__BEGIN_DECLS


193 
	$__sched_˝ucou¡
 (
size_t
 
__£tsize
, c⁄° 
˝u_£t_t
 *
__£ç
)

194 
__THROW
;

195 
˝u_£t_t
 *
	$__sched_˝uÆloc
 (
size_t
 
__cou¡
Ë
__THROW
 
__wur
;

196 
	$__sched_˝u‰ì
 (
˝u_£t_t
 *
__£t
Ë
__THROW
;

198 
__END_DECLS


	@/usr/include/tclDecls.h

14 #i‚de‡
_TCLDECLS


15 
	#_TCLDECLS


	)

17 #unde‡
TCL_STORAGE_CLASS


18 #ifde‡
BUILD_t˛


19 
	#TCL_STORAGE_CLASS
 
DLLEXPORT


	)

21 #ifde‡
USE_TCL_STUBS


22 
	#TCL_STORAGE_CLASS


	)

24 
	#TCL_STORAGE_CLASS
 
DLLIMPORT


	)

40 #i‚de‡
T˛_PkgProvideEx_TCL_DECLARED


41 
	#T˛_PkgProvideEx_TCL_DECLARED


	)

43 
EXTERN
 
T˛_PkgProvideEx
 (
T˛_I¡îp
* 
öãΩ
,

44 
CONST
 * 
«me
, CONST * 
vîsi⁄
,

45 
Clõ¡D©a
 
˛õ¡D©a
);

47 #i‚de‡
T˛_PkgRequúeEx_TCL_DECLARED


48 
	#T˛_PkgRequúeEx_TCL_DECLARED


	)

50 
EXTERN
 
CONST84_RETURN
 * 
T˛_PkgRequúeEx
 (
T˛_I¡îp
 * 
öãΩ
,

51 
CONST
 * 
«me
, CONST * 
vîsi⁄
,

52 
exa˘
, 
Clõ¡D©a
 * 
˛õ¡D©aPå
);

54 #i‚de‡
T˛_P™ic_TCL_DECLARED


55 
	#T˛_P™ic_TCL_DECLARED


	)

57 
EXTERN
 
T˛_P™ic
 (
CONST
 * 
f‹m©
, ...);

59 #i‚de‡
T˛_AŒoc_TCL_DECLARED


60 
	#T˛_AŒoc_TCL_DECLARED


	)

62 
EXTERN
 * 
T˛_AŒoc
 (
size
);

64 #i‚de‡
T˛_Fªe_TCL_DECLARED


65 
	#T˛_Fªe_TCL_DECLARED


	)

67 
EXTERN
 
T˛_Fªe
 (* 
±r
);

69 #i‚de‡
T˛_RóŒoc_TCL_DECLARED


70 
	#T˛_RóŒoc_TCL_DECLARED


	)

72 
EXTERN
 * 
T˛_RóŒoc
 (* 
±r
, 
size
);

74 #i‚de‡
T˛_DbCkÆloc_TCL_DECLARED


75 
	#T˛_DbCkÆloc_TCL_DECLARED


	)

77 
EXTERN
 * 
T˛_DbCkÆloc
 (
size
, 
CONST
 * 
fûe
,

78 
löe
);

80 #i‚de‡
T˛_DbCk‰ì_TCL_DECLARED


81 
	#T˛_DbCk‰ì_TCL_DECLARED


	)

83 
EXTERN
 
T˛_DbCk‰ì
 (* 
±r
, 
CONST
 * 
fûe
,

84 
löe
);

86 #i‚de‡
T˛_DbCkªÆloc_TCL_DECLARED


87 
	#T˛_DbCkªÆloc_TCL_DECLARED


	)

89 
EXTERN
 * 
T˛_DbCkªÆloc
 (* 
±r
, 
size
,

90 
CONST
 * 
fûe
, 
löe
);

92 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

93 #i‚de‡
T˛_Cª©eFûeH™dÀr_TCL_DECLARED


94 
	#T˛_Cª©eFûeH™dÀr_TCL_DECLARED


	)

96 
EXTERN
 
T˛_Cª©eFûeH™dÀr
 (
fd
, 
mask
,

97 
T˛_FûeProc
 * 
¥oc
, 
Clõ¡D©a
 
˛õ¡D©a
);

100 #ifde‡
MAC_OSX_TCL


101 #i‚de‡
T˛_Cª©eFûeH™dÀr_TCL_DECLARED


102 
	#T˛_Cª©eFûeH™dÀr_TCL_DECLARED


	)

104 
EXTERN
 
T˛_Cª©eFûeH™dÀr
 (
fd
, 
mask
,

105 
T˛_FûeProc
 * 
¥oc
, 
Clõ¡D©a
 
˛õ¡D©a
);

108 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

109 #i‚de‡
T˛_DñëeFûeH™dÀr_TCL_DECLARED


110 
	#T˛_DñëeFûeH™dÀr_TCL_DECLARED


	)

112 
EXTERN
 
T˛_DñëeFûeH™dÀr
 (
fd
);

115 #ifde‡
MAC_OSX_TCL


116 #i‚de‡
T˛_DñëeFûeH™dÀr_TCL_DECLARED


117 
	#T˛_DñëeFûeH™dÀr_TCL_DECLARED


	)

119 
EXTERN
 
T˛_DñëeFûeH™dÀr
 (
fd
);

122 #i‚de‡
T˛_SëTimî_TCL_DECLARED


123 
	#T˛_SëTimî_TCL_DECLARED


	)

125 
EXTERN
 
T˛_SëTimî
 (
T˛_Time
 * 
timePå
);

127 #i‚de‡
T˛_SÀï_TCL_DECLARED


128 
	#T˛_SÀï_TCL_DECLARED


	)

130 
EXTERN
 
T˛_SÀï
 (
ms
);

132 #i‚de‡
T˛_WaôF‹Evít_TCL_DECLARED


133 
	#T˛_WaôF‹Evít_TCL_DECLARED


	)

135 
EXTERN
 
T˛_WaôF‹Evít
 (
T˛_Time
 * 
timePå
);

137 #i‚de‡
T˛_AµídAŒObjTy≥s_TCL_DECLARED


138 
	#T˛_AµídAŒObjTy≥s_TCL_DECLARED


	)

140 
EXTERN
 
T˛_AµídAŒObjTy≥s
 (
T˛_I¡îp
 * 
öãΩ
,

141 
T˛_Obj
 * 
objPå
);

143 #i‚de‡
T˛_AµídSåögsToObj_TCL_DECLARED


144 
	#T˛_AµídSåögsToObj_TCL_DECLARED


	)

146 
EXTERN
 
T˛_AµídSåögsToObj
 (
T˛_Obj
 * 
objPå
, ...);

148 #i‚de‡
T˛_AµídToObj_TCL_DECLARED


149 
	#T˛_AµídToObj_TCL_DECLARED


	)

151 
EXTERN
 
T˛_AµídToObj
 (
T˛_Obj
* 
objPå
, 
CONST
 * 
byãs
,

152 
Àngth
);

154 #i‚de‡
T˛_C⁄ˇtObj_TCL_DECLARED


155 
	#T˛_C⁄ˇtObj_TCL_DECLARED


	)

157 
EXTERN
 
T˛_Obj
 * 
T˛_C⁄ˇtObj
 (
objc
, T˛_Obj *
CONST
 
objv
[]);

159 #i‚de‡
T˛_C⁄vîtToTy≥_TCL_DECLARED


160 
	#T˛_C⁄vîtToTy≥_TCL_DECLARED


	)

162 
EXTERN
 
T˛_C⁄vîtToTy≥
 (
T˛_I¡îp
 * 
öãΩ
,

163 
T˛_Obj
 * 
objPå
, 
T˛_ObjTy≥
 * 
ty≥På
);

165 #i‚de‡
T˛_DbDe¸RefCou¡_TCL_DECLARED


166 
	#T˛_DbDe¸RefCou¡_TCL_DECLARED


	)

168 
EXTERN
 
T˛_DbDe¸RefCou¡
 (
T˛_Obj
 * 
objPå
,

169 
CONST
 * 
fûe
, 
löe
);

171 #i‚de‡
T˛_DbIn¸RefCou¡_TCL_DECLARED


172 
	#T˛_DbIn¸RefCou¡_TCL_DECLARED


	)

174 
EXTERN
 
T˛_DbIn¸RefCou¡
 (
T˛_Obj
 * 
objPå
,

175 
CONST
 * 
fûe
, 
löe
);

177 #i‚de‡
T˛_DbIsSh¨ed_TCL_DECLARED


178 
	#T˛_DbIsSh¨ed_TCL_DECLARED


	)

180 
EXTERN
 
T˛_DbIsSh¨ed
 (
T˛_Obj
 * 
objPå
, 
CONST
 * 
fûe
,

181 
löe
);

183 #i‚de‡
T˛_DbNewBoﬁónObj_TCL_DECLARED


184 
	#T˛_DbNewBoﬁónObj_TCL_DECLARED


	)

186 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewBoﬁónObj
 (
boﬁVÆue
,

187 
CONST
 * 
fûe
, 
löe
);

189 #i‚de‡
T˛_DbNewByãAºayObj_TCL_DECLARED


190 
	#T˛_DbNewByãAºayObj_TCL_DECLARED


	)

192 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewByãAºayObj
 (
CONST
 * 
byãs
,

193 
Àngth
, 
CONST
 * 
fûe
, 
löe
);

195 #i‚de‡
T˛_DbNewDoubÀObj_TCL_DECLARED


196 
	#T˛_DbNewDoubÀObj_TCL_DECLARED


	)

198 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewDoubÀObj
 (
doubÀVÆue
,

199 
CONST
 * 
fûe
, 
löe
);

201 #i‚de‡
T˛_DbNewLi°Obj_TCL_DECLARED


202 
	#T˛_DbNewLi°Obj_TCL_DECLARED


	)

204 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewLi°Obj
 (
objc
, T˛_Obj *
CONST
 * 
objv
,

205 
CONST
 * 
fûe
, 
löe
);

207 #i‚de‡
T˛_DbNewL⁄gObj_TCL_DECLARED


208 
	#T˛_DbNewL⁄gObj_TCL_DECLARED


	)

210 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewL⁄gObj
 (
l⁄gVÆue
, 
CONST
 * 
fûe
,

211 
löe
);

213 #i‚de‡
T˛_DbNewObj_TCL_DECLARED


214 
	#T˛_DbNewObj_TCL_DECLARED


	)

216 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewObj
 (
CONST
 * 
fûe
, 
löe
);

218 #i‚de‡
T˛_DbNewSåögObj_TCL_DECLARED


219 
	#T˛_DbNewSåögObj_TCL_DECLARED


	)

221 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewSåögObj
 (
CONST
 * 
byãs
, 
Àngth
,

222 
CONST
 * 
fûe
, 
löe
);

224 #i‚de‡
T˛_Du∂iˇãObj_TCL_DECLARED


225 
	#T˛_Du∂iˇãObj_TCL_DECLARED


	)

227 
EXTERN
 
T˛_Obj
 * 
T˛_Du∂iˇãObj
 (T˛_Obj * 
objPå
);

229 #i‚de‡
T˛FªeObj_TCL_DECLARED


230 
	#T˛FªeObj_TCL_DECLARED


	)

232 
EXTERN
 
T˛FªeObj
 (
T˛_Obj
 * 
objPå
);

234 #i‚de‡
T˛_GëBoﬁón_TCL_DECLARED


235 
	#T˛_GëBoﬁón_TCL_DECLARED


	)

237 
EXTERN
 
T˛_GëBoﬁón
 (
T˛_I¡îp
 * 
öãΩ
,

238 
CONST
 * 
§c
, * 
boﬁPå
);

240 #i‚de‡
T˛_GëBoﬁónFromObj_TCL_DECLARED


241 
	#T˛_GëBoﬁónFromObj_TCL_DECLARED


	)

243 
EXTERN
 
T˛_GëBoﬁónFromObj
 (
T˛_I¡îp
 * 
öãΩ
,

244 
T˛_Obj
 * 
objPå
, * 
boﬁPå
);

246 #i‚de‡
T˛_GëByãAºayFromObj_TCL_DECLARED


247 
	#T˛_GëByãAºayFromObj_TCL_DECLARED


	)

249 
EXTERN
 * 
T˛_GëByãAºayFromObj
 (
T˛_Obj
 * 
objPå
,

250 * 
ÀngthPå
);

252 #i‚de‡
T˛_GëDoubÀ_TCL_DECLARED


253 
	#T˛_GëDoubÀ_TCL_DECLARED


	)

255 
EXTERN
 
T˛_GëDoubÀ
 (
T˛_I¡îp
 * 
öãΩ
, 
CONST
 * 
§c
,

256 * 
doubÀPå
);

258 #i‚de‡
T˛_GëDoubÀFromObj_TCL_DECLARED


259 
	#T˛_GëDoubÀFromObj_TCL_DECLARED


	)

261 
EXTERN
 
T˛_GëDoubÀFromObj
 (
T˛_I¡îp
 * 
öãΩ
,

262 
T˛_Obj
 * 
objPå
, * 
doubÀPå
);

264 #i‚de‡
T˛_GëIndexFromObj_TCL_DECLARED


265 
	#T˛_GëIndexFromObj_TCL_DECLARED


	)

267 
EXTERN
 
T˛_GëIndexFromObj
 (
T˛_I¡îp
 * 
öãΩ
,

268 
T˛_Obj
 * 
objPå
, 
CONST84
 ** 
èbÀPå
,

269 
CONST
 * 
msg
, 
Êags
, * 
ödexPå
);

271 #i‚de‡
T˛_GëI¡_TCL_DECLARED


272 
	#T˛_GëI¡_TCL_DECLARED


	)

274 
EXTERN
 
T˛_GëI¡
 (
T˛_I¡îp
 * 
öãΩ
, 
CONST
 * 
§c
,

275 * 
ötPå
);

277 #i‚de‡
T˛_GëI¡FromObj_TCL_DECLARED


278 
	#T˛_GëI¡FromObj_TCL_DECLARED


	)

280 
EXTERN
 
T˛_GëI¡FromObj
 (
T˛_I¡îp
 * 
öãΩ
,

281 
T˛_Obj
 * 
objPå
, * 
ötPå
);

283 #i‚de‡
T˛_GëL⁄gFromObj_TCL_DECLARED


284 
	#T˛_GëL⁄gFromObj_TCL_DECLARED


	)

286 
EXTERN
 
T˛_GëL⁄gFromObj
 (
T˛_I¡îp
 * 
öãΩ
,

287 
T˛_Obj
 * 
objPå
, * 
l⁄gPå
);

289 #i‚de‡
T˛_GëObjTy≥_TCL_DECLARED


290 
	#T˛_GëObjTy≥_TCL_DECLARED


	)

292 
EXTERN
 
T˛_ObjTy≥
 * 
T˛_GëObjTy≥
 (
CONST
 * 
ty≥Name
);

294 #i‚de‡
T˛_GëSåögFromObj_TCL_DECLARED


295 
	#T˛_GëSåögFromObj_TCL_DECLARED


	)

297 
EXTERN
 * 
T˛_GëSåögFromObj
 (
T˛_Obj
 * 
objPå
,

298 * 
ÀngthPå
);

300 #i‚de‡
T˛_InvÆid©eSåögRï_TCL_DECLARED


301 
	#T˛_InvÆid©eSåögRï_TCL_DECLARED


	)

303 
EXTERN
 
T˛_InvÆid©eSåögRï
 (
T˛_Obj
 * 
objPå
);

305 #i‚de‡
T˛_Li°ObjAµídLi°_TCL_DECLARED


306 
	#T˛_Li°ObjAµídLi°_TCL_DECLARED


	)

308 
EXTERN
 
T˛_Li°ObjAµídLi°
 (
T˛_I¡îp
 * 
öãΩ
,

309 
T˛_Obj
 * 
li°På
, T˛_Obj * 
ñemLi°På
);

311 #i‚de‡
T˛_Li°ObjAµídEÀmít_TCL_DECLARED


312 
	#T˛_Li°ObjAµídEÀmít_TCL_DECLARED


	)

314 
EXTERN
 
T˛_Li°ObjAµídEÀmít
 (
T˛_I¡îp
 * 
öãΩ
,

315 
T˛_Obj
 * 
li°På
, T˛_Obj * 
objPå
);

317 #i‚de‡
T˛_Li°ObjGëEÀmíts_TCL_DECLARED


318 
	#T˛_Li°ObjGëEÀmíts_TCL_DECLARED


	)

320 
EXTERN
 
T˛_Li°ObjGëEÀmíts
 (
T˛_I¡îp
 * 
öãΩ
,

321 
T˛_Obj
 * 
li°På
, * 
objcPå
,

322 
T˛_Obj
 *** 
objvPå
);

324 #i‚de‡
T˛_Li°ObjIndex_TCL_DECLARED


325 
	#T˛_Li°ObjIndex_TCL_DECLARED


	)

327 
EXTERN
 
T˛_Li°ObjIndex
 (
T˛_I¡îp
 * 
öãΩ
,

328 
T˛_Obj
 * 
li°På
, 
ödex
,

329 
T˛_Obj
 ** 
objPåPå
);

331 #i‚de‡
T˛_Li°ObjLígth_TCL_DECLARED


332 
	#T˛_Li°ObjLígth_TCL_DECLARED


	)

334 
EXTERN
 
T˛_Li°ObjLígth
 (
T˛_I¡îp
 * 
öãΩ
,

335 
T˛_Obj
 * 
li°På
, * 
ÀngthPå
);

337 #i‚de‡
T˛_Li°ObjRïœ˚_TCL_DECLARED


338 
	#T˛_Li°ObjRïœ˚_TCL_DECLARED


	)

340 
EXTERN
 
T˛_Li°ObjRïœ˚
 (
T˛_I¡îp
 * 
öãΩ
,

341 
T˛_Obj
 * 
li°På
, 
fú°
, 
cou¡
,

342 
objc
, 
T˛_Obj
 *
CONST
 
objv
[]);

344 #i‚de‡
T˛_NewBoﬁónObj_TCL_DECLARED


345 
	#T˛_NewBoﬁónObj_TCL_DECLARED


	)

347 
EXTERN
 
T˛_Obj
 * 
T˛_NewBoﬁónObj
 (
boﬁVÆue
);

349 #i‚de‡
T˛_NewByãAºayObj_TCL_DECLARED


350 
	#T˛_NewByãAºayObj_TCL_DECLARED


	)

352 
EXTERN
 
T˛_Obj
 * 
T˛_NewByãAºayObj
 (
CONST
 * 
byãs
,

353 
Àngth
);

355 #i‚de‡
T˛_NewDoubÀObj_TCL_DECLARED


356 
	#T˛_NewDoubÀObj_TCL_DECLARED


	)

358 
EXTERN
 
T˛_Obj
 * 
T˛_NewDoubÀObj
 (
doubÀVÆue
);

360 #i‚de‡
T˛_NewI¡Obj_TCL_DECLARED


361 
	#T˛_NewI¡Obj_TCL_DECLARED


	)

363 
EXTERN
 
T˛_Obj
 * 
T˛_NewI¡Obj
 (
ötVÆue
);

365 #i‚de‡
T˛_NewLi°Obj_TCL_DECLARED


366 
	#T˛_NewLi°Obj_TCL_DECLARED


	)

368 
EXTERN
 
T˛_Obj
 * 
T˛_NewLi°Obj
 (
objc
, T˛_Obj *
CONST
 
objv
[]);

370 #i‚de‡
T˛_NewL⁄gObj_TCL_DECLARED


371 
	#T˛_NewL⁄gObj_TCL_DECLARED


	)

373 
EXTERN
 
T˛_Obj
 * 
T˛_NewL⁄gObj
 (
l⁄gVÆue
);

375 #i‚de‡
T˛_NewObj_TCL_DECLARED


376 
	#T˛_NewObj_TCL_DECLARED


	)

378 
EXTERN
 
T˛_Obj
 * 
T˛_NewObj
 ();

380 #i‚de‡
T˛_NewSåögObj_TCL_DECLARED


381 
	#T˛_NewSåögObj_TCL_DECLARED


	)

383 
EXTERN
 
T˛_Obj
 * 
T˛_NewSåögObj
 (
CONST
 * 
byãs
, 
Àngth
);

385 #i‚de‡
T˛_SëBoﬁónObj_TCL_DECLARED


386 
	#T˛_SëBoﬁónObj_TCL_DECLARED


	)

388 
EXTERN
 
T˛_SëBoﬁónObj
 (
T˛_Obj
 * 
objPå
, 
boﬁVÆue
);

390 #i‚de‡
T˛_SëByãAºayLígth_TCL_DECLARED


391 
	#T˛_SëByãAºayLígth_TCL_DECLARED


	)

393 
EXTERN
 * 
T˛_SëByãAºayLígth
 (
T˛_Obj
 * 
objPå
, 
Àngth
);

395 #i‚de‡
T˛_SëByãAºayObj_TCL_DECLARED


396 
	#T˛_SëByãAºayObj_TCL_DECLARED


	)

398 
EXTERN
 
T˛_SëByãAºayObj
 (
T˛_Obj
 * 
objPå
,

399 
CONST
 * 
byãs
, 
Àngth
);

401 #i‚de‡
T˛_SëDoubÀObj_TCL_DECLARED


402 
	#T˛_SëDoubÀObj_TCL_DECLARED


	)

404 
EXTERN
 
T˛_SëDoubÀObj
 (
T˛_Obj
 * 
objPå
,

405 
doubÀVÆue
);

407 #i‚de‡
T˛_SëI¡Obj_TCL_DECLARED


408 
	#T˛_SëI¡Obj_TCL_DECLARED


	)

410 
EXTERN
 
T˛_SëI¡Obj
 (
T˛_Obj
 * 
objPå
, 
ötVÆue
);

412 #i‚de‡
T˛_SëLi°Obj_TCL_DECLARED


413 
	#T˛_SëLi°Obj_TCL_DECLARED


	)

415 
EXTERN
 
T˛_SëLi°Obj
 (
T˛_Obj
 * 
objPå
, 
objc
,

416 
T˛_Obj
 *
CONST
 
objv
[]);

418 #i‚de‡
T˛_SëL⁄gObj_TCL_DECLARED


419 
	#T˛_SëL⁄gObj_TCL_DECLARED


	)

421 
EXTERN
 
T˛_SëL⁄gObj
 (
T˛_Obj
 * 
objPå
, 
l⁄gVÆue
);

423 #i‚de‡
T˛_SëObjLígth_TCL_DECLARED


424 
	#T˛_SëObjLígth_TCL_DECLARED


	)

426 
EXTERN
 
T˛_SëObjLígth
 (
T˛_Obj
 * 
objPå
, 
Àngth
);

428 #i‚de‡
T˛_SëSåögObj_TCL_DECLARED


429 
	#T˛_SëSåögObj_TCL_DECLARED


	)

431 
EXTERN
 
T˛_SëSåögObj
 (
T˛_Obj
* 
objPå
, 
CONST
 * 
byãs
,

432 
Àngth
);

434 #i‚de‡
T˛_AddEº‹Info_TCL_DECLARED


435 
	#T˛_AddEº‹Info_TCL_DECLARED


	)

437 
EXTERN
 
T˛_AddEº‹Info
 (
T˛_I¡îp
 * 
öãΩ
,

438 
CONST
 * 
mesßge
);

440 #i‚de‡
T˛_AddObjEº‹Info_TCL_DECLARED


441 
	#T˛_AddObjEº‹Info_TCL_DECLARED


	)

443 
EXTERN
 
T˛_AddObjEº‹Info
 (
T˛_I¡îp
 * 
öãΩ
,

444 
CONST
 * 
mesßge
, 
Àngth
);

446 #i‚de‡
T˛_AŒowEx˚±i⁄s_TCL_DECLARED


447 
	#T˛_AŒowEx˚±i⁄s_TCL_DECLARED


	)

449 
EXTERN
 
T˛_AŒowEx˚±i⁄s
 (
T˛_I¡îp
 * 
öãΩ
);

451 #i‚de‡
T˛_AµídEÀmít_TCL_DECLARED


452 
	#T˛_AµídEÀmít_TCL_DECLARED


	)

454 
EXTERN
 
T˛_AµídEÀmít
 (
T˛_I¡îp
 * 
öãΩ
,

455 
CONST
 * 
ñemít
);

457 #i‚de‡
T˛_AµídResu…_TCL_DECLARED


458 
	#T˛_AµídResu…_TCL_DECLARED


	)

460 
EXTERN
 
T˛_AµídResu…
 (
T˛_I¡îp
 * 
öãΩ
, ...);

462 #i‚de‡
T˛_AsyncCª©e_TCL_DECLARED


463 
	#T˛_AsyncCª©e_TCL_DECLARED


	)

465 
EXTERN
 
T˛_AsyncH™dÀr
 
T˛_AsyncCª©e
 (
T˛_AsyncProc
 * 
¥oc
,

466 
Clõ¡D©a
 
˛õ¡D©a
);

468 #i‚de‡
T˛_AsyncDñëe_TCL_DECLARED


469 
	#T˛_AsyncDñëe_TCL_DECLARED


	)

471 
EXTERN
 
T˛_AsyncDñëe
 (
T˛_AsyncH™dÀr
 
async
);

473 #i‚de‡
T˛_AsyncInvoke_TCL_DECLARED


474 
	#T˛_AsyncInvoke_TCL_DECLARED


	)

476 
EXTERN
 
T˛_AsyncInvoke
 (
T˛_I¡îp
 * 
öãΩ
, 
code
);

478 #i‚de‡
T˛_AsyncM¨k_TCL_DECLARED


479 
	#T˛_AsyncM¨k_TCL_DECLARED


	)

481 
EXTERN
 
T˛_AsyncM¨k
 (
T˛_AsyncH™dÀr
 
async
);

483 #i‚de‡
T˛_AsyncRódy_TCL_DECLARED


484 
	#T˛_AsyncRódy_TCL_DECLARED


	)

486 
EXTERN
 
T˛_AsyncRódy
 ();

488 #i‚de‡
T˛_BackgroundEº‹_TCL_DECLARED


489 
	#T˛_BackgroundEº‹_TCL_DECLARED


	)

491 
EXTERN
 
T˛_BackgroundEº‹
 (
T˛_I¡îp
 * 
öãΩ
);

493 #i‚de‡
T˛_Back¶ash_TCL_DECLARED


494 
	#T˛_Back¶ash_TCL_DECLARED


	)

496 
EXTERN
 
T˛_Back¶ash
 (
CONST
 * 
§c
, * 
ªadPå
);

498 #i‚de‡
T˛_BadCh™√lO±i⁄_TCL_DECLARED


499 
	#T˛_BadCh™√lO±i⁄_TCL_DECLARED


	)

501 
EXTERN
 
T˛_BadCh™√lO±i⁄
 (
T˛_I¡îp
 * 
öãΩ
,

502 
CONST
 * 
›ti⁄Name
,

503 
CONST
 * 
›ti⁄Li°
);

505 #i‚de‡
T˛_CÆlWhíDñëed_TCL_DECLARED


506 
	#T˛_CÆlWhíDñëed_TCL_DECLARED


	)

508 
EXTERN
 
T˛_CÆlWhíDñëed
 (
T˛_I¡îp
 * 
öãΩ
,

509 
T˛_I¡îpDñëeProc
 * 
¥oc
,

510 
Clõ¡D©a
 
˛õ¡D©a
);

512 #i‚de‡
T˛_C™˚lIdÀCÆl_TCL_DECLARED


513 
	#T˛_C™˚lIdÀCÆl_TCL_DECLARED


	)

515 
EXTERN
 
T˛_C™˚lIdÀCÆl
 (
T˛_IdÀProc
 * 
idÀProc
,

516 
Clõ¡D©a
 
˛õ¡D©a
);

518 #i‚de‡
T˛_Clo£_TCL_DECLARED


519 
	#T˛_Clo£_TCL_DECLARED


	)

521 
EXTERN
 
T˛_Clo£
 (
T˛_I¡îp
 * 
öãΩ
, 
T˛_Ch™√l
 
ch™
);

523 #i‚de‡
T˛_Comm™dCom∂ëe_TCL_DECLARED


524 
	#T˛_Comm™dCom∂ëe_TCL_DECLARED


	)

526 
EXTERN
 
T˛_Comm™dCom∂ëe
 (
CONST
 * 
cmd
);

528 #i‚de‡
T˛_C⁄ˇt_TCL_DECLARED


529 
	#T˛_C⁄ˇt_TCL_DECLARED


	)

531 
EXTERN
 * 
T˛_C⁄ˇt
 (
¨gc
, 
CONST84
 * 
CONST
 * 
¨gv
);

533 #i‚de‡
T˛_C⁄vîtEÀmít_TCL_DECLARED


534 
	#T˛_C⁄vîtEÀmít_TCL_DECLARED


	)

536 
EXTERN
 
T˛_C⁄vîtEÀmít
 (
CONST
 * 
§c
, * 
d°
,

537 
Êags
);

539 #i‚de‡
T˛_C⁄vîtCou¡edEÀmít_TCL_DECLARED


540 
	#T˛_C⁄vîtCou¡edEÀmít_TCL_DECLARED


	)

542 
EXTERN
 
T˛_C⁄vîtCou¡edEÀmít
 (
CONST
 * 
§c
,

543 
Àngth
, * 
d°
, 
Êags
);

545 #i‚de‡
T˛_Cª©eAlüs_TCL_DECLARED


546 
	#T˛_Cª©eAlüs_TCL_DECLARED


	)

548 
EXTERN
 
T˛_Cª©eAlüs
 (
T˛_I¡îp
 * 
¶ave
,

549 
CONST
 * 
¶aveCmd
, 
T˛_I¡îp
 * 
èrgë
,

550 
CONST
 * 
èrgëCmd
, 
¨gc
,

551 
CONST84
 * 
CONST
 * 
¨gv
);

553 #i‚de‡
T˛_Cª©eAlüsObj_TCL_DECLARED


554 
	#T˛_Cª©eAlüsObj_TCL_DECLARED


	)

556 
EXTERN
 
T˛_Cª©eAlüsObj
 (
T˛_I¡îp
 * 
¶ave
,

557 
CONST
 * 
¶aveCmd
, 
T˛_I¡îp
 * 
èrgë
,

558 
CONST
 * 
èrgëCmd
, 
objc
,

559 
T˛_Obj
 *
CONST
 
objv
[]);

561 #i‚de‡
T˛_Cª©eCh™√l_TCL_DECLARED


562 
	#T˛_Cª©eCh™√l_TCL_DECLARED


	)

564 
EXTERN
 
T˛_Ch™√l
 
T˛_Cª©eCh™√l
 (
T˛_Ch™√lTy≥
 * 
ty≥På
,

565 
CONST
 * 
ch™Name
,

566 
Clõ¡D©a
 
ö°™˚D©a
, 
mask
);

568 #i‚de‡
T˛_Cª©eCh™√lH™dÀr_TCL_DECLARED


569 
	#T˛_Cª©eCh™√lH™dÀr_TCL_DECLARED


	)

571 
EXTERN
 
T˛_Cª©eCh™√lH™dÀr
 (
T˛_Ch™√l
 
ch™
, 
mask
,

572 
T˛_Ch™√lProc
 * 
¥oc
,

573 
Clõ¡D©a
 
˛õ¡D©a
);

575 #i‚de‡
T˛_Cª©eClo£H™dÀr_TCL_DECLARED


576 
	#T˛_Cª©eClo£H™dÀr_TCL_DECLARED


	)

578 
EXTERN
 
T˛_Cª©eClo£H™dÀr
 (
T˛_Ch™√l
 
ch™
,

579 
T˛_Clo£Proc
 * 
¥oc
, 
Clõ¡D©a
 
˛õ¡D©a
);

581 #i‚de‡
T˛_Cª©eComm™d_TCL_DECLARED


582 
	#T˛_Cª©eComm™d_TCL_DECLARED


	)

584 
EXTERN
 
T˛_Comm™d
 
T˛_Cª©eComm™d
 (
T˛_I¡îp
 * 
öãΩ
,

585 
CONST
 * 
cmdName
, 
T˛_CmdProc
 * 
¥oc
,

586 
Clõ¡D©a
 
˛õ¡D©a
,

587 
T˛_CmdDñëeProc
 * 
dñëeProc
);

589 #i‚de‡
T˛_Cª©eEvítSour˚_TCL_DECLARED


590 
	#T˛_Cª©eEvítSour˚_TCL_DECLARED


	)

592 
EXTERN
 
T˛_Cª©eEvítSour˚
 (

593 
T˛_EvítSëupProc
 * 
£tupProc
,

594 
T˛_EvítCheckProc
 * 
checkProc
,

595 
Clõ¡D©a
 
˛õ¡D©a
);

597 #i‚de‡
T˛_Cª©eExôH™dÀr_TCL_DECLARED


598 
	#T˛_Cª©eExôH™dÀr_TCL_DECLARED


	)

600 
EXTERN
 
T˛_Cª©eExôH™dÀr
 (
T˛_ExôProc
 * 
¥oc
,

601 
Clõ¡D©a
 
˛õ¡D©a
);

603 #i‚de‡
T˛_Cª©eI¡îp_TCL_DECLARED


604 
	#T˛_Cª©eI¡îp_TCL_DECLARED


	)

606 
EXTERN
 
T˛_I¡îp
 * 
T˛_Cª©eI¡îp
 ();

608 #i‚de‡
T˛_Cª©eM©hFunc_TCL_DECLARED


609 
	#T˛_Cª©eM©hFunc_TCL_DECLARED


	)

611 
EXTERN
 
T˛_Cª©eM©hFunc
 (
T˛_I¡îp
 * 
öãΩ
,

612 
CONST
 * 
«me
, 
numArgs
,

613 
T˛_VÆueTy≥
 * 
¨gTy≥s
,

614 
T˛_M©hProc
 * 
¥oc
, 
Clõ¡D©a
 
˛õ¡D©a
);

616 #i‚de‡
T˛_Cª©eObjComm™d_TCL_DECLARED


617 
	#T˛_Cª©eObjComm™d_TCL_DECLARED


	)

619 
EXTERN
 
T˛_Comm™d
 
T˛_Cª©eObjComm™d
 (
T˛_I¡îp
 * 
öãΩ
,

620 
CONST
 * 
cmdName
, 
T˛_ObjCmdProc
 * 
¥oc
,

621 
Clõ¡D©a
 
˛õ¡D©a
,

622 
T˛_CmdDñëeProc
 * 
dñëeProc
);

624 #i‚de‡
T˛_Cª©eSœve_TCL_DECLARED


625 
	#T˛_Cª©eSœve_TCL_DECLARED


	)

627 
EXTERN
 
T˛_I¡îp
 * 
T˛_Cª©eSœve
 (T˛_I¡î∞* 
öãΩ
,

628 
CONST
 * 
¶aveName
, 
isSa„
);

630 #i‚de‡
T˛_Cª©eTimîH™dÀr_TCL_DECLARED


631 
	#T˛_Cª©eTimîH™dÀr_TCL_DECLARED


	)

633 
EXTERN
 
T˛_TimîTokí
 
T˛_Cª©eTimîH™dÀr
 (
mûli£c⁄ds
,

634 
T˛_TimîProc
 * 
¥oc
, 
Clõ¡D©a
 
˛õ¡D©a
);

636 #i‚de‡
T˛_Cª©eTø˚_TCL_DECLARED


637 
	#T˛_Cª©eTø˚_TCL_DECLARED


	)

639 
EXTERN
 
T˛_Tø˚
 
T˛_Cª©eTø˚
 (
T˛_I¡îp
 * 
öãΩ
, 
Àvñ
,

640 
T˛_CmdTø˚Proc
 * 
¥oc
,

641 
Clõ¡D©a
 
˛õ¡D©a
);

643 #i‚de‡
T˛_DñëeAssocD©a_TCL_DECLARED


644 
	#T˛_DñëeAssocD©a_TCL_DECLARED


	)

646 
EXTERN
 
T˛_DñëeAssocD©a
 (
T˛_I¡îp
 * 
öãΩ
,

647 
CONST
 * 
«me
);

649 #i‚de‡
T˛_DñëeCh™√lH™dÀr_TCL_DECLARED


650 
	#T˛_DñëeCh™√lH™dÀr_TCL_DECLARED


	)

652 
EXTERN
 
T˛_DñëeCh™√lH™dÀr
 (
T˛_Ch™√l
 
ch™
,

653 
T˛_Ch™√lProc
 * 
¥oc
,

654 
Clõ¡D©a
 
˛õ¡D©a
);

656 #i‚de‡
T˛_DñëeClo£H™dÀr_TCL_DECLARED


657 
	#T˛_DñëeClo£H™dÀr_TCL_DECLARED


	)

659 
EXTERN
 
T˛_DñëeClo£H™dÀr
 (
T˛_Ch™√l
 
ch™
,

660 
T˛_Clo£Proc
 * 
¥oc
, 
Clõ¡D©a
 
˛õ¡D©a
);

662 #i‚de‡
T˛_DñëeComm™d_TCL_DECLARED


663 
	#T˛_DñëeComm™d_TCL_DECLARED


	)

665 
EXTERN
 
T˛_DñëeComm™d
 (
T˛_I¡îp
 * 
öãΩ
,

666 
CONST
 * 
cmdName
);

668 #i‚de‡
T˛_DñëeComm™dFromTokí_TCL_DECLARED


669 
	#T˛_DñëeComm™dFromTokí_TCL_DECLARED


	)

671 
EXTERN
 
T˛_DñëeComm™dFromTokí
 (
T˛_I¡îp
 * 
öãΩ
,

672 
T˛_Comm™d
 
comm™d
);

674 #i‚de‡
T˛_DñëeEvíts_TCL_DECLARED


675 
	#T˛_DñëeEvíts_TCL_DECLARED


	)

677 
EXTERN
 
T˛_DñëeEvíts
 (
T˛_EvítDñëeProc
 * 
¥oc
,

678 
Clõ¡D©a
 
˛õ¡D©a
);

680 #i‚de‡
T˛_DñëeEvítSour˚_TCL_DECLARED


681 
	#T˛_DñëeEvítSour˚_TCL_DECLARED


	)

683 
EXTERN
 
T˛_DñëeEvítSour˚
 (

684 
T˛_EvítSëupProc
 * 
£tupProc
,

685 
T˛_EvítCheckProc
 * 
checkProc
,

686 
Clõ¡D©a
 
˛õ¡D©a
);

688 #i‚de‡
T˛_DñëeExôH™dÀr_TCL_DECLARED


689 
	#T˛_DñëeExôH™dÀr_TCL_DECLARED


	)

691 
EXTERN
 
T˛_DñëeExôH™dÀr
 (
T˛_ExôProc
 * 
¥oc
,

692 
Clõ¡D©a
 
˛õ¡D©a
);

694 #i‚de‡
T˛_DñëeHashE¡ry_TCL_DECLARED


695 
	#T˛_DñëeHashE¡ry_TCL_DECLARED


	)

697 
EXTERN
 
T˛_DñëeHashE¡ry
 (
T˛_HashE¡ry
 * 
íåyPå
);

699 #i‚de‡
T˛_DñëeHashTabÀ_TCL_DECLARED


700 
	#T˛_DñëeHashTabÀ_TCL_DECLARED


	)

702 
EXTERN
 
T˛_DñëeHashTabÀ
 (
T˛_HashTabÀ
 * 
èbÀPå
);

704 #i‚de‡
T˛_DñëeI¡îp_TCL_DECLARED


705 
	#T˛_DñëeI¡îp_TCL_DECLARED


	)

707 
EXTERN
 
T˛_DñëeI¡îp
 (
T˛_I¡îp
 * 
öãΩ
);

709 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

710 #i‚de‡
T˛_DëachPids_TCL_DECLARED


711 
	#T˛_DëachPids_TCL_DECLARED


	)

713 
EXTERN
 
T˛_DëachPids
 (
numPids
, 
T˛_Pid
 * 
pidPå
);

716 #ifde‡
__WIN32__


717 #i‚de‡
T˛_DëachPids_TCL_DECLARED


718 
	#T˛_DëachPids_TCL_DECLARED


	)

720 
EXTERN
 
T˛_DëachPids
 (
numPids
, 
T˛_Pid
 * 
pidPå
);

723 #ifde‡
MAC_OSX_TCL


724 #i‚de‡
T˛_DëachPids_TCL_DECLARED


725 
	#T˛_DëachPids_TCL_DECLARED


	)

727 
EXTERN
 
T˛_DëachPids
 (
numPids
, 
T˛_Pid
 * 
pidPå
);

730 #i‚de‡
T˛_DñëeTimîH™dÀr_TCL_DECLARED


731 
	#T˛_DñëeTimîH™dÀr_TCL_DECLARED


	)

733 
EXTERN
 
T˛_DñëeTimîH™dÀr
 (
T˛_TimîTokí
 
tokí
);

735 #i‚de‡
T˛_DñëeTø˚_TCL_DECLARED


736 
	#T˛_DñëeTø˚_TCL_DECLARED


	)

738 
EXTERN
 
T˛_DñëeTø˚
 (
T˛_I¡îp
 * 
öãΩ
,

739 
T˛_Tø˚
 
åa˚
);

741 #i‚de‡
T˛_D⁄tCÆlWhíDñëed_TCL_DECLARED


742 
	#T˛_D⁄tCÆlWhíDñëed_TCL_DECLARED


	)

744 
EXTERN
 
T˛_D⁄tCÆlWhíDñëed
 (
T˛_I¡îp
 * 
öãΩ
,

745 
T˛_I¡îpDñëeProc
 * 
¥oc
,

746 
Clõ¡D©a
 
˛õ¡D©a
);

748 #i‚de‡
T˛_DoO√Evít_TCL_DECLARED


749 
	#T˛_DoO√Evít_TCL_DECLARED


	)

751 
EXTERN
 
T˛_DoO√Evít
 (
Êags
);

753 #i‚de‡
T˛_DoWhíIdÀ_TCL_DECLARED


754 
	#T˛_DoWhíIdÀ_TCL_DECLARED


	)

756 
EXTERN
 
T˛_DoWhíIdÀ
 (
T˛_IdÀProc
 * 
¥oc
,

757 
Clõ¡D©a
 
˛õ¡D©a
);

759 #i‚de‡
T˛_DSåögAµíd_TCL_DECLARED


760 
	#T˛_DSåögAµíd_TCL_DECLARED


	)

762 
EXTERN
 * 
T˛_DSåögAµíd
 (
T˛_DSåög
 * 
dsPå
,

763 
CONST
 * 
byãs
, 
Àngth
);

765 #i‚de‡
T˛_DSåögAµídEÀmít_TCL_DECLARED


766 
	#T˛_DSåögAµídEÀmít_TCL_DECLARED


	)

768 
EXTERN
 * 
T˛_DSåögAµídEÀmít
 (
T˛_DSåög
 * 
dsPå
,

769 
CONST
 * 
ñemít
);

771 #i‚de‡
T˛_DSåögEndSubli°_TCL_DECLARED


772 
	#T˛_DSåögEndSubli°_TCL_DECLARED


	)

774 
EXTERN
 
T˛_DSåögEndSubli°
 (
T˛_DSåög
 * 
dsPå
);

776 #i‚de‡
T˛_DSåögFªe_TCL_DECLARED


777 
	#T˛_DSåögFªe_TCL_DECLARED


	)

779 
EXTERN
 
T˛_DSåögFªe
 (
T˛_DSåög
 * 
dsPå
);

781 #i‚de‡
T˛_DSåögGëResu…_TCL_DECLARED


782 
	#T˛_DSåögGëResu…_TCL_DECLARED


	)

784 
EXTERN
 
T˛_DSåögGëResu…
 (
T˛_I¡îp
 * 
öãΩ
,

785 
T˛_DSåög
 * 
dsPå
);

787 #i‚de‡
T˛_DSåögInô_TCL_DECLARED


788 
	#T˛_DSåögInô_TCL_DECLARED


	)

790 
EXTERN
 
T˛_DSåögInô
 (
T˛_DSåög
 * 
dsPå
);

792 #i‚de‡
T˛_DSåögResu…_TCL_DECLARED


793 
	#T˛_DSåögResu…_TCL_DECLARED


	)

795 
EXTERN
 
T˛_DSåögResu…
 (
T˛_I¡îp
 * 
öãΩ
,

796 
T˛_DSåög
 * 
dsPå
);

798 #i‚de‡
T˛_DSåögSëLígth_TCL_DECLARED


799 
	#T˛_DSåögSëLígth_TCL_DECLARED


	)

801 
EXTERN
 
T˛_DSåögSëLígth
 (
T˛_DSåög
 * 
dsPå
,

802 
Àngth
);

804 #i‚de‡
T˛_DSåögSèπSubli°_TCL_DECLARED


805 
	#T˛_DSåögSèπSubli°_TCL_DECLARED


	)

807 
EXTERN
 
T˛_DSåögSèπSubli°
 (
T˛_DSåög
 * 
dsPå
);

809 #i‚de‡
T˛_Eof_TCL_DECLARED


810 
	#T˛_Eof_TCL_DECLARED


	)

812 
EXTERN
 
T˛_Eof
 (
T˛_Ch™√l
 
ch™
);

814 #i‚de‡
T˛_EºnoId_TCL_DECLARED


815 
	#T˛_EºnoId_TCL_DECLARED


	)

817 
EXTERN
 
CONST84_RETURN
 * 
T˛_EºnoId
 ();

819 #i‚de‡
T˛_EºnoMsg_TCL_DECLARED


820 
	#T˛_EºnoMsg_TCL_DECLARED


	)

822 
EXTERN
 
CONST84_RETURN
 * 
T˛_EºnoMsg
 (
îr
);

824 #i‚de‡
T˛_EvÆ_TCL_DECLARED


825 
	#T˛_EvÆ_TCL_DECLARED


	)

827 
EXTERN
 
T˛_EvÆ
 (
T˛_I¡îp
 * 
öãΩ
, 
CONST
 * 
s¸ùt
);

829 #i‚de‡
T˛_EvÆFûe_TCL_DECLARED


830 
	#T˛_EvÆFûe_TCL_DECLARED


	)

832 
EXTERN
 
T˛_EvÆFûe
 (
T˛_I¡îp
 * 
öãΩ
,

833 
CONST
 * 
fûeName
);

835 #i‚de‡
T˛_EvÆObj_TCL_DECLARED


836 
	#T˛_EvÆObj_TCL_DECLARED


	)

838 
EXTERN
 
T˛_EvÆObj
 (
T˛_I¡îp
 * 
öãΩ
, 
T˛_Obj
 * 
objPå
);

840 #i‚de‡
T˛_EvítuÆlyFªe_TCL_DECLARED


841 
	#T˛_EvítuÆlyFªe_TCL_DECLARED


	)

843 
EXTERN
 
T˛_EvítuÆlyFªe
 (
Clõ¡D©a
 
˛õ¡D©a
,

844 
T˛_FªeProc
 * 
‰ìProc
);

846 #i‚de‡
T˛_Exô_TCL_DECLARED


847 
	#T˛_Exô_TCL_DECLARED


	)

849 
EXTERN
 
T˛_Exô
 (
°©us
);

851 #i‚de‡
T˛_Expo£Comm™d_TCL_DECLARED


852 
	#T˛_Expo£Comm™d_TCL_DECLARED


	)

854 
EXTERN
 
T˛_Expo£Comm™d
 (
T˛_I¡îp
 * 
öãΩ
,

855 
CONST
 * 
hiddíCmdTokí
,

856 
CONST
 * 
cmdName
);

858 #i‚de‡
T˛_Ex¥Boﬁón_TCL_DECLARED


859 
	#T˛_Ex¥Boﬁón_TCL_DECLARED


	)

861 
EXTERN
 
T˛_Ex¥Boﬁón
 (
T˛_I¡îp
 * 
öãΩ
,

862 
CONST
 * 
ex¥
, * 
±r
);

864 #i‚de‡
T˛_Ex¥BoﬁónObj_TCL_DECLARED


865 
	#T˛_Ex¥BoﬁónObj_TCL_DECLARED


	)

867 
EXTERN
 
T˛_Ex¥BoﬁónObj
 (
T˛_I¡îp
 * 
öãΩ
,

868 
T˛_Obj
 * 
objPå
, * 
±r
);

870 #i‚de‡
T˛_Ex¥DoubÀ_TCL_DECLARED


871 
	#T˛_Ex¥DoubÀ_TCL_DECLARED


	)

873 
EXTERN
 
T˛_Ex¥DoubÀ
 (
T˛_I¡îp
 * 
öãΩ
,

874 
CONST
 * 
ex¥
, * 
±r
);

876 #i‚de‡
T˛_Ex¥DoubÀObj_TCL_DECLARED


877 
	#T˛_Ex¥DoubÀObj_TCL_DECLARED


	)

879 
EXTERN
 
T˛_Ex¥DoubÀObj
 (
T˛_I¡îp
 * 
öãΩ
,

880 
T˛_Obj
 * 
objPå
, * 
±r
);

882 #i‚de‡
T˛_Ex¥L⁄g_TCL_DECLARED


883 
	#T˛_Ex¥L⁄g_TCL_DECLARED


	)

885 
EXTERN
 
T˛_Ex¥L⁄g
 (
T˛_I¡îp
 * 
öãΩ
, 
CONST
 * 
ex¥
,

886 * 
±r
);

888 #i‚de‡
T˛_Ex¥L⁄gObj_TCL_DECLARED


889 
	#T˛_Ex¥L⁄gObj_TCL_DECLARED


	)

891 
EXTERN
 
T˛_Ex¥L⁄gObj
 (
T˛_I¡îp
 * 
öãΩ
,

892 
T˛_Obj
 * 
objPå
, * 
±r
);

894 #i‚de‡
T˛_Ex¥Obj_TCL_DECLARED


895 
	#T˛_Ex¥Obj_TCL_DECLARED


	)

897 
EXTERN
 
T˛_Ex¥Obj
 (
T˛_I¡îp
 * 
öãΩ
, 
T˛_Obj
 * 
objPå
,

898 
T˛_Obj
 ** 
ªsu…PåPå
);

900 #i‚de‡
T˛_Ex¥Såög_TCL_DECLARED


901 
	#T˛_Ex¥Såög_TCL_DECLARED


	)

903 
EXTERN
 
T˛_Ex¥Såög
 (
T˛_I¡îp
 * 
öãΩ
,

904 
CONST
 * 
ex¥
);

906 #i‚de‡
T˛_FöÆize_TCL_DECLARED


907 
	#T˛_FöÆize_TCL_DECLARED


	)

909 
EXTERN
 
T˛_FöÆize
 ();

911 #i‚de‡
T˛_FödExecuèbÀ_TCL_DECLARED


912 
	#T˛_FödExecuèbÀ_TCL_DECLARED


	)

914 
EXTERN
 
T˛_FödExecuèbÀ
 (
CONST
 * 
¨gv0
);

916 #i‚de‡
T˛_Fú°HashE¡ry_TCL_DECLARED


917 
	#T˛_Fú°HashE¡ry_TCL_DECLARED


	)

919 
EXTERN
 
T˛_HashE¡ry
 * 
T˛_Fú°HashE¡ry
 (
T˛_HashTabÀ
 * 
èbÀPå
,

920 
T˛_HashSórch
 * 
£¨chPå
);

922 #i‚de‡
T˛_Flush_TCL_DECLARED


923 
	#T˛_Flush_TCL_DECLARED


	)

925 
EXTERN
 
T˛_Flush
 (
T˛_Ch™√l
 
ch™
);

927 #i‚de‡
T˛_FªeResu…_TCL_DECLARED


928 
	#T˛_FªeResu…_TCL_DECLARED


	)

930 
EXTERN
 
T˛_FªeResu…
 (
T˛_I¡îp
 * 
öãΩ
);

932 #i‚de‡
T˛_GëAlüs_TCL_DECLARED


933 
	#T˛_GëAlüs_TCL_DECLARED


	)

935 
EXTERN
 
T˛_GëAlüs
 (
T˛_I¡îp
 * 
öãΩ
,

936 
CONST
 * 
¶aveCmd
,

937 
T˛_I¡îp
 ** 
èrgëI¡îpPå
,

938 
CONST84
 ** 
èrgëCmdPå
, * 
¨gcPå
,

939 
CONST84
 *** 
¨gvPå
);

941 #i‚de‡
T˛_GëAlüsObj_TCL_DECLARED


942 
	#T˛_GëAlüsObj_TCL_DECLARED


	)

944 
EXTERN
 
T˛_GëAlüsObj
 (
T˛_I¡îp
 * 
öãΩ
,

945 
CONST
 * 
¶aveCmd
,

946 
T˛_I¡îp
 ** 
èrgëI¡îpPå
,

947 
CONST84
 ** 
èrgëCmdPå
, * 
objcPå
,

948 
T˛_Obj
 *** 
objv
);

950 #i‚de‡
T˛_GëAssocD©a_TCL_DECLARED


951 
	#T˛_GëAssocD©a_TCL_DECLARED


	)

953 
EXTERN
 
Clõ¡D©a
 
T˛_GëAssocD©a
 (
T˛_I¡îp
 * 
öãΩ
,

954 
CONST
 * 
«me
,

955 
T˛_I¡îpDñëeProc
 ** 
¥ocPå
);

957 #i‚de‡
T˛_GëCh™√l_TCL_DECLARED


958 
	#T˛_GëCh™√l_TCL_DECLARED


	)

960 
EXTERN
 
T˛_Ch™√l
 
T˛_GëCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

961 
CONST
 * 
ch™Name
, * 
modePå
);

963 #i‚de‡
T˛_GëCh™√lBuf„rSize_TCL_DECLARED


964 
	#T˛_GëCh™√lBuf„rSize_TCL_DECLARED


	)

966 
EXTERN
 
T˛_GëCh™√lBuf„rSize
 (
T˛_Ch™√l
 
ch™
);

968 #i‚de‡
T˛_GëCh™√lH™dÀ_TCL_DECLARED


969 
	#T˛_GëCh™√lH™dÀ_TCL_DECLARED


	)

971 
EXTERN
 
T˛_GëCh™√lH™dÀ
 (
T˛_Ch™√l
 
ch™
,

972 
dúe˘i⁄
, 
Clõ¡D©a
 * 
h™dÀPå
);

974 #i‚de‡
T˛_GëCh™√lIn°™˚D©a_TCL_DECLARED


975 
	#T˛_GëCh™√lIn°™˚D©a_TCL_DECLARED


	)

977 
EXTERN
 
Clõ¡D©a
 
T˛_GëCh™√lIn°™˚D©a
 (
T˛_Ch™√l
 
ch™
);

979 #i‚de‡
T˛_GëCh™√lMode_TCL_DECLARED


980 
	#T˛_GëCh™√lMode_TCL_DECLARED


	)

982 
EXTERN
 
T˛_GëCh™√lMode
 (
T˛_Ch™√l
 
ch™
);

984 #i‚de‡
T˛_GëCh™√lName_TCL_DECLARED


985 
	#T˛_GëCh™√lName_TCL_DECLARED


	)

987 
EXTERN
 
CONST84_RETURN
 * 
T˛_GëCh™√lName
 (
T˛_Ch™√l
 
ch™
);

989 #i‚de‡
T˛_GëCh™√lO±i⁄_TCL_DECLARED


990 
	#T˛_GëCh™√lO±i⁄_TCL_DECLARED


	)

992 
EXTERN
 
T˛_GëCh™√lO±i⁄
 (
T˛_I¡îp
 * 
öãΩ
,

993 
T˛_Ch™√l
 
ch™
, 
CONST
 * 
›ti⁄Name
,

994 
T˛_DSåög
 * 
dsPå
);

996 #i‚de‡
T˛_GëCh™√lTy≥_TCL_DECLARED


997 
	#T˛_GëCh™√lTy≥_TCL_DECLARED


	)

999 
EXTERN
 
T˛_Ch™√lTy≥
 * 
T˛_GëCh™√lTy≥
 (
T˛_Ch™√l
 
ch™
);

1001 #i‚de‡
T˛_GëComm™dInfo_TCL_DECLARED


1002 
	#T˛_GëComm™dInfo_TCL_DECLARED


	)

1004 
EXTERN
 
T˛_GëComm™dInfo
 (
T˛_I¡îp
 * 
öãΩ
,

1005 
CONST
 * 
cmdName
, 
T˛_CmdInfo
 * 
öfoPå
);

1007 #i‚de‡
T˛_GëComm™dName_TCL_DECLARED


1008 
	#T˛_GëComm™dName_TCL_DECLARED


	)

1010 
EXTERN
 
CONST84_RETURN
 * 
T˛_GëComm™dName
 (
T˛_I¡îp
 * 
öãΩ
,

1011 
T˛_Comm™d
 
comm™d
);

1013 #i‚de‡
T˛_GëEºno_TCL_DECLARED


1014 
	#T˛_GëEºno_TCL_DECLARED


	)

1016 
EXTERN
 
T˛_GëEºno
 ();

1018 #i‚de‡
T˛_GëHo°Name_TCL_DECLARED


1019 
	#T˛_GëHo°Name_TCL_DECLARED


	)

1021 
EXTERN
 
CONST84_RETURN
 * 
T˛_GëHo°Name
 ();

1023 #i‚de‡
T˛_GëI¡îpP©h_TCL_DECLARED


1024 
	#T˛_GëI¡îpP©h_TCL_DECLARED


	)

1026 
EXTERN
 
T˛_GëI¡îpP©h
 (
T˛_I¡îp
 * 
askI¡îp
,

1027 
T˛_I¡îp
 * 
¶aveI¡îp
);

1029 #i‚de‡
T˛_GëMa°î_TCL_DECLARED


1030 
	#T˛_GëMa°î_TCL_DECLARED


	)

1032 
EXTERN
 
T˛_I¡îp
 * 
T˛_GëMa°î
 (T˛_I¡î∞* 
öãΩ
);

1034 #i‚de‡
T˛_GëNameOfExecuèbÀ_TCL_DECLARED


1035 
	#T˛_GëNameOfExecuèbÀ_TCL_DECLARED


	)

1037 
EXTERN
 
CONST
 * 
T˛_GëNameOfExecuèbÀ
 ();

1039 #i‚de‡
T˛_GëObjResu…_TCL_DECLARED


1040 
	#T˛_GëObjResu…_TCL_DECLARED


	)

1042 
EXTERN
 
T˛_Obj
 * 
T˛_GëObjResu…
 (
T˛_I¡îp
 * 
öãΩ
);

1044 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

1045 #i‚de‡
T˛_GëO≥nFûe_TCL_DECLARED


1046 
	#T˛_GëO≥nFûe_TCL_DECLARED


	)

1048 
EXTERN
 
T˛_GëO≥nFûe
 (
T˛_I¡îp
 * 
öãΩ
,

1049 
CONST
 * 
ch™ID
, 
f‹Wrôög
,

1050 
checkUßge
, 
Clõ¡D©a
 * 
fûePå
);

1053 #ifde‡
MAC_OSX_TCL


1054 #i‚de‡
T˛_GëO≥nFûe_TCL_DECLARED


1055 
	#T˛_GëO≥nFûe_TCL_DECLARED


	)

1057 
EXTERN
 
T˛_GëO≥nFûe
 (
T˛_I¡îp
 * 
öãΩ
,

1058 
CONST
 * 
ch™ID
, 
f‹Wrôög
,

1059 
checkUßge
, 
Clõ¡D©a
 * 
fûePå
);

1062 #i‚de‡
T˛_GëP©hTy≥_TCL_DECLARED


1063 
	#T˛_GëP©hTy≥_TCL_DECLARED


	)

1065 
EXTERN
 
T˛_P©hTy≥
 
T˛_GëP©hTy≥
 (
CONST
 * 
∑th
);

1067 #i‚de‡
T˛_Gës_TCL_DECLARED


1068 
	#T˛_Gës_TCL_DECLARED


	)

1070 
EXTERN
 
T˛_Gës
 (
T˛_Ch™√l
 
ch™
, 
T˛_DSåög
 * 
dsPå
);

1072 #i‚de‡
T˛_GësObj_TCL_DECLARED


1073 
	#T˛_GësObj_TCL_DECLARED


	)

1075 
EXTERN
 
T˛_GësObj
 (
T˛_Ch™√l
 
ch™
, 
T˛_Obj
 * 
objPå
);

1077 #i‚de‡
T˛_GëSîvi˚Mode_TCL_DECLARED


1078 
	#T˛_GëSîvi˚Mode_TCL_DECLARED


	)

1080 
EXTERN
 
T˛_GëSîvi˚Mode
 ();

1082 #i‚de‡
T˛_GëSœve_TCL_DECLARED


1083 
	#T˛_GëSœve_TCL_DECLARED


	)

1085 
EXTERN
 
T˛_I¡îp
 * 
T˛_GëSœve
 (T˛_I¡î∞* 
öãΩ
,

1086 
CONST
 * 
¶aveName
);

1088 #i‚de‡
T˛_GëStdCh™√l_TCL_DECLARED


1089 
	#T˛_GëStdCh™√l_TCL_DECLARED


	)

1091 
EXTERN
 
T˛_Ch™√l
 
T˛_GëStdCh™√l
 (
ty≥
);

1093 #i‚de‡
T˛_GëSåögResu…_TCL_DECLARED


1094 
	#T˛_GëSåögResu…_TCL_DECLARED


	)

1096 
EXTERN
 
CONST84_RETURN
 * 
T˛_GëSåögResu…
 (
T˛_I¡îp
 * 
öãΩ
);

1098 #i‚de‡
T˛_GëV¨_TCL_DECLARED


1099 
	#T˛_GëV¨_TCL_DECLARED


	)

1101 
EXTERN
 
CONST84_RETURN
 * 
T˛_GëV¨
 (
T˛_I¡îp
 * 
öãΩ
,

1102 
CONST
 * 
v¨Name
, 
Êags
);

1104 #i‚de‡
T˛_GëV¨2_TCL_DECLARED


1105 
	#T˛_GëV¨2_TCL_DECLARED


	)

1107 
EXTERN
 
CONST84_RETURN
 * 
T˛_GëV¨2
 (
T˛_I¡îp
 * 
öãΩ
,

1108 
CONST
 * 
∑π1
, CONST * 
∑π2
,

1109 
Êags
);

1111 #i‚de‡
T˛_GlobÆEvÆ_TCL_DECLARED


1112 
	#T˛_GlobÆEvÆ_TCL_DECLARED


	)

1114 
EXTERN
 
T˛_GlobÆEvÆ
 (
T˛_I¡îp
 * 
öãΩ
,

1115 
CONST
 * 
comm™d
);

1117 #i‚de‡
T˛_GlobÆEvÆObj_TCL_DECLARED


1118 
	#T˛_GlobÆEvÆObj_TCL_DECLARED


	)

1120 
EXTERN
 
T˛_GlobÆEvÆObj
 (
T˛_I¡îp
 * 
öãΩ
,

1121 
T˛_Obj
 * 
objPå
);

1123 #i‚de‡
T˛_HideComm™d_TCL_DECLARED


1124 
	#T˛_HideComm™d_TCL_DECLARED


	)

1126 
EXTERN
 
T˛_HideComm™d
 (
T˛_I¡îp
 * 
öãΩ
,

1127 
CONST
 * 
cmdName
,

1128 
CONST
 * 
hiddíCmdTokí
);

1130 #i‚de‡
T˛_Inô_TCL_DECLARED


1131 
	#T˛_Inô_TCL_DECLARED


	)

1133 
EXTERN
 
T˛_Inô
 (
T˛_I¡îp
 * 
öãΩ
);

1135 #i‚de‡
T˛_InôHashTabÀ_TCL_DECLARED


1136 
	#T˛_InôHashTabÀ_TCL_DECLARED


	)

1138 
EXTERN
 
T˛_InôHashTabÀ
 (
T˛_HashTabÀ
 * 
èbÀPå
,

1139 
keyTy≥
);

1141 #i‚de‡
T˛_I≈utBlocked_TCL_DECLARED


1142 
	#T˛_I≈utBlocked_TCL_DECLARED


	)

1144 
EXTERN
 
T˛_I≈utBlocked
 (
T˛_Ch™√l
 
ch™
);

1146 #i‚de‡
T˛_I≈utBuf„ªd_TCL_DECLARED


1147 
	#T˛_I≈utBuf„ªd_TCL_DECLARED


	)

1149 
EXTERN
 
T˛_I≈utBuf„ªd
 (
T˛_Ch™√l
 
ch™
);

1151 #i‚de‡
T˛_I¡îpDñëed_TCL_DECLARED


1152 
	#T˛_I¡îpDñëed_TCL_DECLARED


	)

1154 
EXTERN
 
T˛_I¡îpDñëed
 (
T˛_I¡îp
 * 
öãΩ
);

1156 #i‚de‡
T˛_IsSa„_TCL_DECLARED


1157 
	#T˛_IsSa„_TCL_DECLARED


	)

1159 
EXTERN
 
T˛_IsSa„
 (
T˛_I¡îp
 * 
öãΩ
);

1161 #i‚de‡
T˛_JoöP©h_TCL_DECLARED


1162 
	#T˛_JoöP©h_TCL_DECLARED


	)

1164 
EXTERN
 * 
T˛_JoöP©h
 (
¨gc
, 
CONST84
 * 
CONST
 * 
¨gv
,

1165 
T˛_DSåög
 * 
ªsu…På
);

1167 #i‚de‡
T˛_LökV¨_TCL_DECLARED


1168 
	#T˛_LökV¨_TCL_DECLARED


	)

1170 
EXTERN
 
T˛_LökV¨
 (
T˛_I¡îp
 * 
öãΩ
,

1171 
CONST
 * 
v¨Name
, * 
addr
, 
ty≥
);

1174 #i‚de‡
T˛_MakeFûeCh™√l_TCL_DECLARED


1175 
	#T˛_MakeFûeCh™√l_TCL_DECLARED


	)

1177 
EXTERN
 
T˛_Ch™√l
 
T˛_MakeFûeCh™√l
 (
Clõ¡D©a
 
h™dÀ
, 
mode
);

1179 #i‚de‡
T˛_MakeSa„_TCL_DECLARED


1180 
	#T˛_MakeSa„_TCL_DECLARED


	)

1182 
EXTERN
 
T˛_MakeSa„
 (
T˛_I¡îp
 * 
öãΩ
);

1184 #i‚de‡
T˛_MakeT˝Clõ¡Ch™√l_TCL_DECLARED


1185 
	#T˛_MakeT˝Clõ¡Ch™√l_TCL_DECLARED


	)

1187 
EXTERN
 
T˛_Ch™√l
 
T˛_MakeT˝Clõ¡Ch™√l
 (
Clõ¡D©a
 
t˝Sockë
);

1189 #i‚de‡
T˛_Mîge_TCL_DECLARED


1190 
	#T˛_Mîge_TCL_DECLARED


	)

1192 
EXTERN
 * 
T˛_Mîge
 (
¨gc
, 
CONST84
 * 
CONST
 * 
¨gv
);

1194 #i‚de‡
T˛_NextHashE¡ry_TCL_DECLARED


1195 
	#T˛_NextHashE¡ry_TCL_DECLARED


	)

1197 
EXTERN
 
T˛_HashE¡ry
 * 
T˛_NextHashE¡ry
 (
T˛_HashSórch
 * 
£¨chPå
);

1199 #i‚de‡
T˛_NŸifyCh™√l_TCL_DECLARED


1200 
	#T˛_NŸifyCh™√l_TCL_DECLARED


	)

1202 
EXTERN
 
T˛_NŸifyCh™√l
 (
T˛_Ch™√l
 
ch™√l
, 
mask
);

1204 #i‚de‡
T˛_ObjGëV¨2_TCL_DECLARED


1205 
	#T˛_ObjGëV¨2_TCL_DECLARED


	)

1207 
EXTERN
 
T˛_Obj
 * 
T˛_ObjGëV¨2
 (
T˛_I¡îp
 * 
öãΩ
,

1208 
T˛_Obj
 * 
∑π1På
, T˛_Obj * 
∑π2På
,

1209 
Êags
);

1211 #i‚de‡
T˛_ObjSëV¨2_TCL_DECLARED


1212 
	#T˛_ObjSëV¨2_TCL_DECLARED


	)

1214 
EXTERN
 
T˛_Obj
 * 
T˛_ObjSëV¨2
 (
T˛_I¡îp
 * 
öãΩ
,

1215 
T˛_Obj
 * 
∑π1På
, T˛_Obj * 
∑π2På
,

1216 
T˛_Obj
 * 
√wVÆuePå
, 
Êags
);

1218 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

1219 #i‚de‡
T˛_O≥nComm™dCh™√l_TCL_DECLARED


1220 
	#T˛_O≥nComm™dCh™√l_TCL_DECLARED


	)

1222 
EXTERN
 
T˛_Ch™√l
 
T˛_O≥nComm™dCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

1223 
¨gc
, 
CONST84
 ** 
¨gv
, 
Êags
);

1226 #ifde‡
__WIN32__


1227 #i‚de‡
T˛_O≥nComm™dCh™√l_TCL_DECLARED


1228 
	#T˛_O≥nComm™dCh™√l_TCL_DECLARED


	)

1230 
EXTERN
 
T˛_Ch™√l
 
T˛_O≥nComm™dCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

1231 
¨gc
, 
CONST84
 ** 
¨gv
, 
Êags
);

1234 #ifde‡
MAC_OSX_TCL


1235 #i‚de‡
T˛_O≥nComm™dCh™√l_TCL_DECLARED


1236 
	#T˛_O≥nComm™dCh™√l_TCL_DECLARED


	)

1238 
EXTERN
 
T˛_Ch™√l
 
T˛_O≥nComm™dCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

1239 
¨gc
, 
CONST84
 ** 
¨gv
, 
Êags
);

1242 #i‚de‡
T˛_O≥nFûeCh™√l_TCL_DECLARED


1243 
	#T˛_O≥nFûeCh™√l_TCL_DECLARED


	)

1245 
EXTERN
 
T˛_Ch™√l
 
T˛_O≥nFûeCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

1246 
CONST
 * 
fûeName
,

1247 
CONST
 * 
modeSåög
, 
≥rmissi⁄s
);

1249 #i‚de‡
T˛_O≥nT˝Clõ¡_TCL_DECLARED


1250 
	#T˛_O≥nT˝Clõ¡_TCL_DECLARED


	)

1252 
EXTERN
 
T˛_Ch™√l
 
T˛_O≥nT˝Clõ¡
 (
T˛_I¡îp
 * 
öãΩ
, 
p‹t
,

1253 
CONST
 * 
addªss
, CONST * 
myaddr
,

1254 
myp‹t
, 
async
);

1256 #i‚de‡
T˛_O≥nT˝Sîvî_TCL_DECLARED


1257 
	#T˛_O≥nT˝Sîvî_TCL_DECLARED


	)

1259 
EXTERN
 
T˛_Ch™√l
 
T˛_O≥nT˝Sîvî
 (
T˛_I¡îp
 * 
öãΩ
, 
p‹t
,

1260 
CONST
 * 
ho°
,

1261 
T˛_T˝Ac˚±Proc
 * 
ac˚±Proc
,

1262 
Clõ¡D©a
 
ˇŒbackD©a
);

1264 #i‚de‡
T˛_Pª£rve_TCL_DECLARED


1265 
	#T˛_Pª£rve_TCL_DECLARED


	)

1267 
EXTERN
 
T˛_Pª£rve
 (
Clõ¡D©a
 
d©a
);

1269 #i‚de‡
T˛_PrötDoubÀ_TCL_DECLARED


1270 
	#T˛_PrötDoubÀ_TCL_DECLARED


	)

1272 
EXTERN
 
T˛_PrötDoubÀ
 (
T˛_I¡îp
 * 
öãΩ
, 
vÆue
,

1273 * 
d°
);

1275 #i‚de‡
T˛_PutEnv_TCL_DECLARED


1276 
	#T˛_PutEnv_TCL_DECLARED


	)

1278 
EXTERN
 
T˛_PutEnv
 (
CONST
 * 
assignmít
);

1280 #i‚de‡
T˛_PosixEº‹_TCL_DECLARED


1281 
	#T˛_PosixEº‹_TCL_DECLARED


	)

1283 
EXTERN
 
CONST84_RETURN
 * 
T˛_PosixEº‹
 (
T˛_I¡îp
 * 
öãΩ
);

1285 #i‚de‡
T˛_QueueEvít_TCL_DECLARED


1286 
	#T˛_QueueEvít_TCL_DECLARED


	)

1288 
EXTERN
 
T˛_QueueEvít
 (
T˛_Evít
 * 
evPå
,

1289 
T˛_QueuePosôi⁄
 
posôi⁄
);

1291 #i‚de‡
T˛_Ród_TCL_DECLARED


1292 
	#T˛_Ród_TCL_DECLARED


	)

1294 
EXTERN
 
T˛_Ród
 (
T˛_Ch™√l
 
ch™
, * 
bufPå
,

1295 
toRód
);

1297 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

1298 #i‚de‡
T˛_RópDëachedProcs_TCL_DECLARED


1299 
	#T˛_RópDëachedProcs_TCL_DECLARED


	)

1301 
EXTERN
 
T˛_RópDëachedProcs
 ();

1304 #ifde‡
__WIN32__


1305 #i‚de‡
T˛_RópDëachedProcs_TCL_DECLARED


1306 
	#T˛_RópDëachedProcs_TCL_DECLARED


	)

1308 
EXTERN
 
T˛_RópDëachedProcs
 ();

1311 #ifde‡
MAC_OSX_TCL


1312 #i‚de‡
T˛_RópDëachedProcs_TCL_DECLARED


1313 
	#T˛_RópDëachedProcs_TCL_DECLARED


	)

1315 
EXTERN
 
T˛_RópDëachedProcs
 ();

1318 #i‚de‡
T˛_Rec‹dAndEvÆ_TCL_DECLARED


1319 
	#T˛_Rec‹dAndEvÆ_TCL_DECLARED


	)

1321 
EXTERN
 
T˛_Rec‹dAndEvÆ
 (
T˛_I¡îp
 * 
öãΩ
,

1322 
CONST
 * 
cmd
, 
Êags
);

1324 #i‚de‡
T˛_Rec‹dAndEvÆObj_TCL_DECLARED


1325 
	#T˛_Rec‹dAndEvÆObj_TCL_DECLARED


	)

1327 
EXTERN
 
T˛_Rec‹dAndEvÆObj
 (
T˛_I¡îp
 * 
öãΩ
,

1328 
T˛_Obj
 * 
cmdPå
, 
Êags
);

1330 #i‚de‡
T˛_Regi°îCh™√l_TCL_DECLARED


1331 
	#T˛_Regi°îCh™√l_TCL_DECLARED


	)

1333 
EXTERN
 
T˛_Regi°îCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

1334 
T˛_Ch™√l
 
ch™
);

1336 #i‚de‡
T˛_Regi°îObjTy≥_TCL_DECLARED


1337 
	#T˛_Regi°îObjTy≥_TCL_DECLARED


	)

1339 
EXTERN
 
T˛_Regi°îObjTy≥
 (
T˛_ObjTy≥
 * 
ty≥På
);

1341 #i‚de‡
T˛_RegExpCompûe_TCL_DECLARED


1342 
	#T˛_RegExpCompûe_TCL_DECLARED


	)

1344 
EXTERN
 
T˛_RegExp
 
T˛_RegExpCompûe
 (
T˛_I¡îp
 * 
öãΩ
,

1345 
CONST
 * 
∑âîn
);

1347 #i‚de‡
T˛_RegExpExec_TCL_DECLARED


1348 
	#T˛_RegExpExec_TCL_DECLARED


	)

1350 
EXTERN
 
T˛_RegExpExec
 (
T˛_I¡îp
 * 
öãΩ
,

1351 
T˛_RegExp
 
ªgexp
, 
CONST
 * 
ãxt
,

1352 
CONST
 * 
°¨t
);

1354 #i‚de‡
T˛_RegExpM©ch_TCL_DECLARED


1355 
	#T˛_RegExpM©ch_TCL_DECLARED


	)

1357 
EXTERN
 
T˛_RegExpM©ch
 (
T˛_I¡îp
 * 
öãΩ
,

1358 
CONST
 * 
ãxt
, CONST * 
∑âîn
);

1360 #i‚de‡
T˛_RegExpR™ge_TCL_DECLARED


1361 
	#T˛_RegExpR™ge_TCL_DECLARED


	)

1363 
EXTERN
 
T˛_RegExpR™ge
 (
T˛_RegExp
 
ªgexp
, 
ödex
,

1364 
CONST84
 ** 
°¨tPå
,

1365 
CONST84
 ** 
ídPå
);

1367 #i‚de‡
T˛_Rñó£_TCL_DECLARED


1368 
	#T˛_Rñó£_TCL_DECLARED


	)

1370 
EXTERN
 
T˛_Rñó£
 (
Clõ¡D©a
 
˛õ¡D©a
);

1372 #i‚de‡
T˛_Re£tResu…_TCL_DECLARED


1373 
	#T˛_Re£tResu…_TCL_DECLARED


	)

1375 
EXTERN
 
T˛_Re£tResu…
 (
T˛_I¡îp
 * 
öãΩ
);

1377 #i‚de‡
T˛_SˇnEÀmít_TCL_DECLARED


1378 
	#T˛_SˇnEÀmít_TCL_DECLARED


	)

1380 
EXTERN
 
T˛_SˇnEÀmít
 (
CONST
 * 
°r
, * 
ÊagPå
);

1382 #i‚de‡
T˛_SˇnCou¡edEÀmít_TCL_DECLARED


1383 
	#T˛_SˇnCou¡edEÀmít_TCL_DECLARED


	)

1385 
EXTERN
 
T˛_SˇnCou¡edEÀmít
 (
CONST
 * 
°r
, 
Àngth
,

1386 * 
ÊagPå
);

1388 #i‚de‡
T˛_SìkOld_TCL_DECLARED


1389 
	#T˛_SìkOld_TCL_DECLARED


	)

1391 
EXTERN
 
T˛_SìkOld
 (
T˛_Ch™√l
 
ch™
, 
off£t
, 
mode
);

1393 #i‚de‡
T˛_Sîvi˚AŒ_TCL_DECLARED


1394 
	#T˛_Sîvi˚AŒ_TCL_DECLARED


	)

1396 
EXTERN
 
T˛_Sîvi˚AŒ
 ();

1398 #i‚de‡
T˛_Sîvi˚Evít_TCL_DECLARED


1399 
	#T˛_Sîvi˚Evít_TCL_DECLARED


	)

1401 
EXTERN
 
T˛_Sîvi˚Evít
 (
Êags
);

1403 #i‚de‡
T˛_SëAssocD©a_TCL_DECLARED


1404 
	#T˛_SëAssocD©a_TCL_DECLARED


	)

1406 
EXTERN
 
T˛_SëAssocD©a
 (
T˛_I¡îp
 * 
öãΩ
,

1407 
CONST
 * 
«me
,

1408 
T˛_I¡îpDñëeProc
 * 
¥oc
,

1409 
Clõ¡D©a
 
˛õ¡D©a
);

1411 #i‚de‡
T˛_SëCh™√lBuf„rSize_TCL_DECLARED


1412 
	#T˛_SëCh™√lBuf„rSize_TCL_DECLARED


	)

1414 
EXTERN
 
T˛_SëCh™√lBuf„rSize
 (
T˛_Ch™√l
 
ch™
, 
sz
);

1416 #i‚de‡
T˛_SëCh™√lO±i⁄_TCL_DECLARED


1417 
	#T˛_SëCh™√lO±i⁄_TCL_DECLARED


	)

1419 
EXTERN
 
T˛_SëCh™√lO±i⁄
 (
T˛_I¡îp
 * 
öãΩ
,

1420 
T˛_Ch™√l
 
ch™
, 
CONST
 * 
›ti⁄Name
,

1421 
CONST
 * 
√wVÆue
);

1423 #i‚de‡
T˛_SëComm™dInfo_TCL_DECLARED


1424 
	#T˛_SëComm™dInfo_TCL_DECLARED


	)

1426 
EXTERN
 
T˛_SëComm™dInfo
 (
T˛_I¡îp
 * 
öãΩ
,

1427 
CONST
 * 
cmdName
,

1428 
CONST
 
T˛_CmdInfo
 * 
öfoPå
);

1430 #i‚de‡
T˛_SëEºno_TCL_DECLARED


1431 
	#T˛_SëEºno_TCL_DECLARED


	)

1433 
EXTERN
 
T˛_SëEºno
 (
îr
);

1435 #i‚de‡
T˛_SëEº‹Code_TCL_DECLARED


1436 
	#T˛_SëEº‹Code_TCL_DECLARED


	)

1438 
EXTERN
 
T˛_SëEº‹Code
 (
T˛_I¡îp
 * 
öãΩ
, ...);

1440 #i‚de‡
T˛_SëMaxBlockTime_TCL_DECLARED


1441 
	#T˛_SëMaxBlockTime_TCL_DECLARED


	)

1443 
EXTERN
 
T˛_SëMaxBlockTime
 (
T˛_Time
 * 
timePå
);

1445 #i‚de‡
T˛_SëP™icProc_TCL_DECLARED


1446 
	#T˛_SëP™icProc_TCL_DECLARED


	)

1448 
EXTERN
 
T˛_SëP™icProc
 (
T˛_P™icProc
 * 
∑nicProc
);

1450 #i‚de‡
T˛_SëRecursi⁄Limô_TCL_DECLARED


1451 
	#T˛_SëRecursi⁄Limô_TCL_DECLARED


	)

1453 
EXTERN
 
T˛_SëRecursi⁄Limô
 (
T˛_I¡îp
 * 
öãΩ
,

1454 
dïth
);

1456 #i‚de‡
T˛_SëResu…_TCL_DECLARED


1457 
	#T˛_SëResu…_TCL_DECLARED


	)

1459 
EXTERN
 
T˛_SëResu…
 (
T˛_I¡îp
 * 
öãΩ
, * 
ªsu…
,

1460 
T˛_FªeProc
 * 
‰ìProc
);

1462 #i‚de‡
T˛_SëSîvi˚Mode_TCL_DECLARED


1463 
	#T˛_SëSîvi˚Mode_TCL_DECLARED


	)

1465 
EXTERN
 
T˛_SëSîvi˚Mode
 (
mode
);

1467 #i‚de‡
T˛_SëObjEº‹Code_TCL_DECLARED


1468 
	#T˛_SëObjEº‹Code_TCL_DECLARED


	)

1470 
EXTERN
 
T˛_SëObjEº‹Code
 (
T˛_I¡îp
 * 
öãΩ
,

1471 
T˛_Obj
 * 
îr‹ObjPå
);

1473 #i‚de‡
T˛_SëObjResu…_TCL_DECLARED


1474 
	#T˛_SëObjResu…_TCL_DECLARED


	)

1476 
EXTERN
 
T˛_SëObjResu…
 (
T˛_I¡îp
 * 
öãΩ
,

1477 
T˛_Obj
 * 
ªsu…ObjPå
);

1479 #i‚de‡
T˛_SëStdCh™√l_TCL_DECLARED


1480 
	#T˛_SëStdCh™√l_TCL_DECLARED


	)

1482 
EXTERN
 
T˛_SëStdCh™√l
 (
T˛_Ch™√l
 
ch™√l
, 
ty≥
);

1484 #i‚de‡
T˛_SëV¨_TCL_DECLARED


1485 
	#T˛_SëV¨_TCL_DECLARED


	)

1487 
EXTERN
 
CONST84_RETURN
 * 
T˛_SëV¨
 (
T˛_I¡îp
 * 
öãΩ
,

1488 
CONST
 * 
v¨Name
, CONST * 
√wVÆue
,

1489 
Êags
);

1491 #i‚de‡
T˛_SëV¨2_TCL_DECLARED


1492 
	#T˛_SëV¨2_TCL_DECLARED


	)

1494 
EXTERN
 
CONST84_RETURN
 * 
T˛_SëV¨2
 (
T˛_I¡îp
 * 
öãΩ
,

1495 
CONST
 * 
∑π1
, CONST * 
∑π2
,

1496 
CONST
 * 
√wVÆue
, 
Êags
);

1498 #i‚de‡
T˛_Sig«lId_TCL_DECLARED


1499 
	#T˛_Sig«lId_TCL_DECLARED


	)

1501 
EXTERN
 
CONST84_RETURN
 * 
T˛_Sig«lId
 (
sig
);

1503 #i‚de‡
T˛_Sig«lMsg_TCL_DECLARED


1504 
	#T˛_Sig«lMsg_TCL_DECLARED


	)

1506 
EXTERN
 
CONST84_RETURN
 * 
T˛_Sig«lMsg
 (
sig
);

1508 #i‚de‡
T˛_Sour˚RCFûe_TCL_DECLARED


1509 
	#T˛_Sour˚RCFûe_TCL_DECLARED


	)

1511 
EXTERN
 
T˛_Sour˚RCFûe
 (
T˛_I¡îp
 * 
öãΩ
);

1513 #i‚de‡
T˛_S∂ôLi°_TCL_DECLARED


1514 
	#T˛_S∂ôLi°_TCL_DECLARED


	)

1516 
EXTERN
 
T˛_S∂ôLi°
 (
T˛_I¡îp
 * 
öãΩ
,

1517 
CONST
 * 
li°Så
, * 
¨gcPå
,

1518 
CONST84
 *** 
¨gvPå
);

1520 #i‚de‡
T˛_S∂ôP©h_TCL_DECLARED


1521 
	#T˛_S∂ôP©h_TCL_DECLARED


	)

1523 
EXTERN
 
T˛_S∂ôP©h
 (
CONST
 * 
∑th
, * 
¨gcPå
,

1524 
CONST84
 *** 
¨gvPå
);

1526 #i‚de‡
T˛_SèticPackage_TCL_DECLARED


1527 
	#T˛_SèticPackage_TCL_DECLARED


	)

1529 
EXTERN
 
T˛_SèticPackage
 (
T˛_I¡îp
 * 
öãΩ
,

1530 
CONST
 * 
pkgName
,

1531 
T˛_PackageInôProc
 * 
öôProc
,

1532 
T˛_PackageInôProc
 * 
ß„InôProc
);

1534 #i‚de‡
T˛_SåögM©ch_TCL_DECLARED


1535 
	#T˛_SåögM©ch_TCL_DECLARED


	)

1537 
EXTERN
 
T˛_SåögM©ch
 (
CONST
 * 
°r
,

1538 
CONST
 * 
∑âîn
);

1540 #i‚de‡
T˛_TñlOld_TCL_DECLARED


1541 
	#T˛_TñlOld_TCL_DECLARED


	)

1543 
EXTERN
 
T˛_TñlOld
 (
T˛_Ch™√l
 
ch™
);

1545 #i‚de‡
T˛_Tø˚V¨_TCL_DECLARED


1546 
	#T˛_Tø˚V¨_TCL_DECLARED


	)

1548 
EXTERN
 
T˛_Tø˚V¨
 (
T˛_I¡îp
 * 
öãΩ
,

1549 
CONST
 * 
v¨Name
, 
Êags
,

1550 
T˛_V¨Tø˚Proc
 * 
¥oc
,

1551 
Clõ¡D©a
 
˛õ¡D©a
);

1553 #i‚de‡
T˛_Tø˚V¨2_TCL_DECLARED


1554 
	#T˛_Tø˚V¨2_TCL_DECLARED


	)

1556 
EXTERN
 
T˛_Tø˚V¨2
 (
T˛_I¡îp
 * 
öãΩ
,

1557 
CONST
 * 
∑π1
, CONST * 
∑π2
,

1558 
Êags
, 
T˛_V¨Tø˚Proc
 * 
¥oc
,

1559 
Clõ¡D©a
 
˛õ¡D©a
);

1561 #i‚de‡
T˛_Tøn¶©eFûeName_TCL_DECLARED


1562 
	#T˛_Tøn¶©eFûeName_TCL_DECLARED


	)

1564 
EXTERN
 * 
T˛_Tøn¶©eFûeName
 (
T˛_I¡îp
 * 
öãΩ
,

1565 
CONST
 * 
«me
, 
T˛_DSåög
 * 
buf„rPå
);

1567 #i‚de‡
T˛_Ungës_TCL_DECLARED


1568 
	#T˛_Ungës_TCL_DECLARED


	)

1570 
EXTERN
 
T˛_Ungës
 (
T˛_Ch™√l
 
ch™
, 
CONST
 * 
°r
,

1571 
Àn
, 
©Hód
);

1573 #i‚de‡
T˛_U∆ökV¨_TCL_DECLARED


1574 
	#T˛_U∆ökV¨_TCL_DECLARED


	)

1576 
EXTERN
 
T˛_U∆ökV¨
 (
T˛_I¡îp
 * 
öãΩ
,

1577 
CONST
 * 
v¨Name
);

1579 #i‚de‡
T˛_Uƒegi°îCh™√l_TCL_DECLARED


1580 
	#T˛_Uƒegi°îCh™√l_TCL_DECLARED


	)

1582 
EXTERN
 
T˛_Uƒegi°îCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

1583 
T˛_Ch™√l
 
ch™
);

1585 #i‚de‡
T˛_Un£tV¨_TCL_DECLARED


1586 
	#T˛_Un£tV¨_TCL_DECLARED


	)

1588 
EXTERN
 
T˛_Un£tV¨
 (
T˛_I¡îp
 * 
öãΩ
,

1589 
CONST
 * 
v¨Name
, 
Êags
);

1591 #i‚de‡
T˛_Un£tV¨2_TCL_DECLARED


1592 
	#T˛_Un£tV¨2_TCL_DECLARED


	)

1594 
EXTERN
 
T˛_Un£tV¨2
 (
T˛_I¡îp
 * 
öãΩ
,

1595 
CONST
 * 
∑π1
, CONST * 
∑π2
,

1596 
Êags
);

1598 #i‚de‡
T˛_U¡ø˚V¨_TCL_DECLARED


1599 
	#T˛_U¡ø˚V¨_TCL_DECLARED


	)

1601 
EXTERN
 
T˛_U¡ø˚V¨
 (
T˛_I¡îp
 * 
öãΩ
,

1602 
CONST
 * 
v¨Name
, 
Êags
,

1603 
T˛_V¨Tø˚Proc
 * 
¥oc
,

1604 
Clõ¡D©a
 
˛õ¡D©a
);

1606 #i‚de‡
T˛_U¡ø˚V¨2_TCL_DECLARED


1607 
	#T˛_U¡ø˚V¨2_TCL_DECLARED


	)

1609 
EXTERN
 
T˛_U¡ø˚V¨2
 (
T˛_I¡îp
 * 
öãΩ
,

1610 
CONST
 * 
∑π1
, CONST * 
∑π2
,

1611 
Êags
, 
T˛_V¨Tø˚Proc
 * 
¥oc
,

1612 
Clõ¡D©a
 
˛õ¡D©a
);

1614 #i‚de‡
T˛_Upd©eLökedV¨_TCL_DECLARED


1615 
	#T˛_Upd©eLökedV¨_TCL_DECLARED


	)

1617 
EXTERN
 
T˛_Upd©eLökedV¨
 (
T˛_I¡îp
 * 
öãΩ
,

1618 
CONST
 * 
v¨Name
);

1620 #i‚de‡
T˛_UpV¨_TCL_DECLARED


1621 
	#T˛_UpV¨_TCL_DECLARED


	)

1623 
EXTERN
 
T˛_UpV¨
 (
T˛_I¡îp
 * 
öãΩ
,

1624 
CONST
 * 
‰ameName
, CONST * 
v¨Name
,

1625 
CONST
 * 
loˇlName
, 
Êags
);

1627 #i‚de‡
T˛_UpV¨2_TCL_DECLARED


1628 
	#T˛_UpV¨2_TCL_DECLARED


	)

1630 
EXTERN
 
T˛_UpV¨2
 (
T˛_I¡îp
 * 
öãΩ
,

1631 
CONST
 * 
‰ameName
, CONST * 
∑π1
,

1632 
CONST
 * 
∑π2
, CONST * 
loˇlName
,

1633 
Êags
);

1635 #i‚de‡
T˛_V¨EvÆ_TCL_DECLARED


1636 
	#T˛_V¨EvÆ_TCL_DECLARED


	)

1638 
EXTERN
 
T˛_V¨EvÆ
 (
T˛_I¡îp
 * 
öãΩ
, ...);

1640 #i‚de‡
T˛_V¨Tø˚Info_TCL_DECLARED


1641 
	#T˛_V¨Tø˚Info_TCL_DECLARED


	)

1643 
EXTERN
 
Clõ¡D©a
 
T˛_V¨Tø˚Info
 (
T˛_I¡îp
 * 
öãΩ
,

1644 
CONST
 * 
v¨Name
, 
Êags
,

1645 
T˛_V¨Tø˚Proc
 * 
¥ocPå
,

1646 
Clõ¡D©a
 
¥evClõ¡D©a
);

1648 #i‚de‡
T˛_V¨Tø˚Info2_TCL_DECLARED


1649 
	#T˛_V¨Tø˚Info2_TCL_DECLARED


	)

1651 
EXTERN
 
Clõ¡D©a
 
T˛_V¨Tø˚Info2
 (
T˛_I¡îp
 * 
öãΩ
,

1652 
CONST
 * 
∑π1
, CONST * 
∑π2
,

1653 
Êags
, 
T˛_V¨Tø˚Proc
 * 
¥ocPå
,

1654 
Clõ¡D©a
 
¥evClõ¡D©a
);

1656 #i‚de‡
T˛_Wrôe_TCL_DECLARED


1657 
	#T˛_Wrôe_TCL_DECLARED


	)

1659 
EXTERN
 
T˛_Wrôe
 (
T˛_Ch™√l
 
ch™
, 
CONST
 * 
s
,

1660 
¶í
);

1662 #i‚de‡
T˛_Wr⁄gNumArgs_TCL_DECLARED


1663 
	#T˛_Wr⁄gNumArgs_TCL_DECLARED


	)

1665 
EXTERN
 
T˛_Wr⁄gNumArgs
 (
T˛_I¡îp
 * 
öãΩ
, 
objc
,

1666 
T˛_Obj
 *
CONST
 
objv
[], CONST * 
mesßge
);

1668 #i‚de‡
T˛_DumpA˘iveMem‹y_TCL_DECLARED


1669 
	#T˛_DumpA˘iveMem‹y_TCL_DECLARED


	)

1671 
EXTERN
 
T˛_DumpA˘iveMem‹y
 (
CONST
 * 
fûeName
);

1673 #i‚de‡
T˛_VÆid©eAŒMem‹y_TCL_DECLARED


1674 
	#T˛_VÆid©eAŒMem‹y_TCL_DECLARED


	)

1676 
EXTERN
 
T˛_VÆid©eAŒMem‹y
 (
CONST
 * 
fûe
, 
löe
);

1678 #i‚de‡
T˛_AµídResu…VA_TCL_DECLARED


1679 
	#T˛_AµídResu…VA_TCL_DECLARED


	)

1681 
EXTERN
 
T˛_AµídResu…VA
 (
T˛_I¡îp
 * 
öãΩ
,

1682 
va_li°
 
¨gLi°
);

1684 #i‚de‡
T˛_AµídSåögsToObjVA_TCL_DECLARED


1685 
	#T˛_AµídSåögsToObjVA_TCL_DECLARED


	)

1687 
EXTERN
 
T˛_AµídSåögsToObjVA
 (
T˛_Obj
 * 
objPå
,

1688 
va_li°
 
¨gLi°
);

1690 #i‚de‡
T˛_HashSèts_TCL_DECLARED


1691 
	#T˛_HashSèts_TCL_DECLARED


	)

1693 
EXTERN
 
CONST84_RETURN
 * 
T˛_HashSèts
 (
T˛_HashTabÀ
 * 
èbÀPå
);

1695 #i‚de‡
T˛_P¨£V¨_TCL_DECLARED


1696 
	#T˛_P¨£V¨_TCL_DECLARED


	)

1698 
EXTERN
 
CONST84_RETURN
 * 
T˛_P¨£V¨
 (
T˛_I¡îp
 * 
öãΩ
,

1699 
CONST
 * 
°¨t
, 
CONST84
 ** 
ãrmPå
);

1701 #i‚de‡
T˛_PkgPª£¡_TCL_DECLARED


1702 
	#T˛_PkgPª£¡_TCL_DECLARED


	)

1704 
EXTERN
 
CONST84_RETURN
 * 
T˛_PkgPª£¡
 (
T˛_I¡îp
 * 
öãΩ
,

1705 
CONST
 * 
«me
, CONST * 
vîsi⁄
,

1706 
exa˘
);

1708 #i‚de‡
T˛_PkgPª£¡Ex_TCL_DECLARED


1709 
	#T˛_PkgPª£¡Ex_TCL_DECLARED


	)

1711 
EXTERN
 
CONST84_RETURN
 * 
T˛_PkgPª£¡Ex
 (
T˛_I¡îp
 * 
öãΩ
,

1712 
CONST
 * 
«me
, CONST * 
vîsi⁄
,

1713 
exa˘
, 
Clõ¡D©a
 * 
˛õ¡D©aPå
);

1715 #i‚de‡
T˛_PkgProvide_TCL_DECLARED


1716 
	#T˛_PkgProvide_TCL_DECLARED


	)

1718 
EXTERN
 
T˛_PkgProvide
 (
T˛_I¡îp
 * 
öãΩ
,

1719 
CONST
 * 
«me
, CONST * 
vîsi⁄
);

1721 #i‚de‡
T˛_PkgRequúe_TCL_DECLARED


1722 
	#T˛_PkgRequúe_TCL_DECLARED


	)

1724 
EXTERN
 
CONST84_RETURN
 * 
T˛_PkgRequúe
 (
T˛_I¡îp
 * 
öãΩ
,

1725 
CONST
 * 
«me
, CONST * 
vîsi⁄
,

1726 
exa˘
);

1728 #i‚de‡
T˛_SëEº‹CodeVA_TCL_DECLARED


1729 
	#T˛_SëEº‹CodeVA_TCL_DECLARED


	)

1731 
EXTERN
 
T˛_SëEº‹CodeVA
 (
T˛_I¡îp
 * 
öãΩ
,

1732 
va_li°
 
¨gLi°
);

1734 #i‚de‡
T˛_V¨EvÆVA_TCL_DECLARED


1735 
	#T˛_V¨EvÆVA_TCL_DECLARED


	)

1737 
EXTERN
 
T˛_V¨EvÆVA
 (
T˛_I¡îp
 * 
öãΩ
, 
va_li°
 
¨gLi°
);

1739 #i‚de‡
T˛_WaôPid_TCL_DECLARED


1740 
	#T˛_WaôPid_TCL_DECLARED


	)

1742 
EXTERN
 
T˛_Pid
 
T˛_WaôPid
 (T˛_Pid 
pid
, * 
°©På
, 
›ti⁄s
);

1744 #i‚de‡
T˛_P™icVA_TCL_DECLARED


1745 
	#T˛_P™icVA_TCL_DECLARED


	)

1747 
EXTERN
 
T˛_P™icVA
 (
CONST
 * 
f‹m©
, 
va_li°
 
¨gLi°
);

1749 #i‚de‡
T˛_GëVîsi⁄_TCL_DECLARED


1750 
	#T˛_GëVîsi⁄_TCL_DECLARED


	)

1752 
EXTERN
 
T˛_GëVîsi⁄
 (* 
maj‹
, * 
mö‹
,

1753 * 
∑tchLevñ
, * 
ty≥
);

1755 #i‚de‡
T˛_InôMem‹y_TCL_DECLARED


1756 
	#T˛_InôMem‹y_TCL_DECLARED


	)

1758 
EXTERN
 
T˛_InôMem‹y
 (
T˛_I¡îp
 * 
öãΩ
);

1760 #i‚de‡
T˛_SèckCh™√l_TCL_DECLARED


1761 
	#T˛_SèckCh™√l_TCL_DECLARED


	)

1763 
EXTERN
 
T˛_Ch™√l
 
T˛_SèckCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

1764 
T˛_Ch™√lTy≥
 * 
ty≥På
,

1765 
Clõ¡D©a
 
ö°™˚D©a
, 
mask
,

1766 
T˛_Ch™√l
 
¥evCh™
);

1768 #i‚de‡
T˛_Un°ackCh™√l_TCL_DECLARED


1769 
	#T˛_Un°ackCh™√l_TCL_DECLARED


	)

1771 
EXTERN
 
T˛_Un°ackCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

1772 
T˛_Ch™√l
 
ch™
);

1774 #i‚de‡
T˛_GëSèckedCh™√l_TCL_DECLARED


1775 
	#T˛_GëSèckedCh™√l_TCL_DECLARED


	)

1777 
EXTERN
 
T˛_Ch™√l
 
T˛_GëSèckedCh™√l
 (T˛_Ch™√»
ch™
);

1779 #i‚de‡
T˛_SëMaöLo›_TCL_DECLARED


1780 
	#T˛_SëMaöLo›_TCL_DECLARED


	)

1782 
EXTERN
 
T˛_SëMaöLo›
 (
T˛_MaöLo›Proc
 * 
¥oc
);

1785 #i‚de‡
T˛_AµídObjToObj_TCL_DECLARED


1786 
	#T˛_AµídObjToObj_TCL_DECLARED


	)

1788 
EXTERN
 
T˛_AµídObjToObj
 (
T˛_Obj
 * 
objPå
,

1789 
T˛_Obj
 * 
≠≥ndObjPå
);

1791 #i‚de‡
T˛_Cª©eEncodög_TCL_DECLARED


1792 
	#T˛_Cª©eEncodög_TCL_DECLARED


	)

1794 
EXTERN
 
T˛_Encodög
 
T˛_Cª©eEncodög
 (c⁄° 
T˛_EncodögTy≥
 * 
ty≥På
);

1796 #i‚de‡
T˛_Cª©eThªadExôH™dÀr_TCL_DECLARED


1797 
	#T˛_Cª©eThªadExôH™dÀr_TCL_DECLARED


	)

1799 
EXTERN
 
T˛_Cª©eThªadExôH™dÀr
 (
T˛_ExôProc
 * 
¥oc
,

1800 
Clõ¡D©a
 
˛õ¡D©a
);

1802 #i‚de‡
T˛_DñëeThªadExôH™dÀr_TCL_DECLARED


1803 
	#T˛_DñëeThªadExôH™dÀr_TCL_DECLARED


	)

1805 
EXTERN
 
T˛_DñëeThªadExôH™dÀr
 (
T˛_ExôProc
 * 
¥oc
,

1806 
Clõ¡D©a
 
˛õ¡D©a
);

1808 #i‚de‡
T˛_DisˇrdResu…_TCL_DECLARED


1809 
	#T˛_DisˇrdResu…_TCL_DECLARED


	)

1811 
EXTERN
 
T˛_DisˇrdResu…
 (
T˛_SavedResu…
 * 
°©ePå
);

1813 #i‚de‡
T˛_EvÆEx_TCL_DECLARED


1814 
	#T˛_EvÆEx_TCL_DECLARED


	)

1816 
EXTERN
 
T˛_EvÆEx
 (
T˛_I¡îp
 * 
öãΩ
, 
CONST
 * 
s¸ùt
,

1817 
numByãs
, 
Êags
);

1819 #i‚de‡
T˛_EvÆObjv_TCL_DECLARED


1820 
	#T˛_EvÆObjv_TCL_DECLARED


	)

1822 
EXTERN
 
T˛_EvÆObjv
 (
T˛_I¡îp
 * 
öãΩ
, 
objc
,

1823 
T˛_Obj
 *
CONST
 
objv
[], 
Êags
);

1825 #i‚de‡
T˛_EvÆObjEx_TCL_DECLARED


1826 
	#T˛_EvÆObjEx_TCL_DECLARED


	)

1828 
EXTERN
 
T˛_EvÆObjEx
 (
T˛_I¡îp
 * 
öãΩ
, 
T˛_Obj
 * 
objPå
,

1829 
Êags
);

1831 #i‚de‡
T˛_ExôThªad_TCL_DECLARED


1832 
	#T˛_ExôThªad_TCL_DECLARED


	)

1834 
EXTERN
 
T˛_ExôThªad
 (
°©us
);

1836 #i‚de‡
T˛_Exã∫ÆToUtf_TCL_DECLARED


1837 
	#T˛_Exã∫ÆToUtf_TCL_DECLARED


	)

1839 
EXTERN
 
T˛_Exã∫ÆToUtf
 (
T˛_I¡îp
 * 
öãΩ
,

1840 
T˛_Encodög
 
ícodög
, 
CONST
 * 
§c
,

1841 
§cLí
, 
Êags
,

1842 
T˛_EncodögSèã
 * 
°©ePå
, * 
d°
,

1843 
d°Lí
, * 
§cRódPå
,

1844 * 
d°WrŸePå
, * 
d°Ch¨sPå
);

1846 #i‚de‡
T˛_Exã∫ÆToUtfDSåög_TCL_DECLARED


1847 
	#T˛_Exã∫ÆToUtfDSåög_TCL_DECLARED


	)

1849 
EXTERN
 * 
T˛_Exã∫ÆToUtfDSåög
 (
T˛_Encodög
 
ícodög
,

1850 
CONST
 * 
§c
, 
§cLí
,

1851 
T˛_DSåög
 * 
dsPå
);

1853 #i‚de‡
T˛_FöÆizeThªad_TCL_DECLARED


1854 
	#T˛_FöÆizeThªad_TCL_DECLARED


	)

1856 
EXTERN
 
T˛_FöÆizeThªad
 ();

1858 #i‚de‡
T˛_FöÆizeNŸifõr_TCL_DECLARED


1859 
	#T˛_FöÆizeNŸifõr_TCL_DECLARED


	)

1861 
EXTERN
 
T˛_FöÆizeNŸifõr
 (
Clõ¡D©a
 
˛õ¡D©a
);

1863 #i‚de‡
T˛_FªeEncodög_TCL_DECLARED


1864 
	#T˛_FªeEncodög_TCL_DECLARED


	)

1866 
EXTERN
 
T˛_FªeEncodög
 (
T˛_Encodög
 
ícodög
);

1868 #i‚de‡
T˛_GëCuºítThªad_TCL_DECLARED


1869 
	#T˛_GëCuºítThªad_TCL_DECLARED


	)

1871 
EXTERN
 
T˛_ThªadId
 
T˛_GëCuºítThªad
 ();

1873 #i‚de‡
T˛_GëEncodög_TCL_DECLARED


1874 
	#T˛_GëEncodög_TCL_DECLARED


	)

1876 
EXTERN
 
T˛_Encodög
 
T˛_GëEncodög
 (
T˛_I¡îp
 * 
öãΩ
,

1877 
CONST
 * 
«me
);

1879 #i‚de‡
T˛_GëEncodögName_TCL_DECLARED


1880 
	#T˛_GëEncodögName_TCL_DECLARED


	)

1882 
EXTERN
 
CONST84_RETURN
 * 
T˛_GëEncodögName
 (
T˛_Encodög
 
ícodög
);

1884 #i‚de‡
T˛_GëEncodögNames_TCL_DECLARED


1885 
	#T˛_GëEncodögNames_TCL_DECLARED


	)

1887 
EXTERN
 
T˛_GëEncodögNames
 (
T˛_I¡îp
 * 
öãΩ
);

1889 #i‚de‡
T˛_GëIndexFromObjSåu˘_TCL_DECLARED


1890 
	#T˛_GëIndexFromObjSåu˘_TCL_DECLARED


	)

1892 
EXTERN
 
T˛_GëIndexFromObjSåu˘
 (
T˛_I¡îp
 * 
öãΩ
,

1893 
T˛_Obj
 * 
objPå
, 
CONST
 
VOID
 * 
èbÀPå
,

1894 
off£t
, 
CONST
 * 
msg
, 
Êags
,

1895 * 
ödexPå
);

1897 #i‚de‡
T˛_GëThªadD©a_TCL_DECLARED


1898 
	#T˛_GëThªadD©a_TCL_DECLARED


	)

1900 
EXTERN
 
VOID
 * 
T˛_GëThªadD©a
 (
T˛_ThªadD©aKey
 * 
keyPå
,

1901 
size
);

1903 #i‚de‡
T˛_GëV¨2Ex_TCL_DECLARED


1904 
	#T˛_GëV¨2Ex_TCL_DECLARED


	)

1906 
EXTERN
 
T˛_Obj
 * 
T˛_GëV¨2Ex
 (
T˛_I¡îp
 * 
öãΩ
,

1907 
CONST
 * 
∑π1
, CONST * 
∑π2
,

1908 
Êags
);

1910 #i‚de‡
T˛_InôNŸifõr_TCL_DECLARED


1911 
	#T˛_InôNŸifõr_TCL_DECLARED


	)

1913 
EXTERN
 
Clõ¡D©a
 
T˛_InôNŸifõr
 ();

1915 #i‚de‡
T˛_MuãxLock_TCL_DECLARED


1916 
	#T˛_MuãxLock_TCL_DECLARED


	)

1918 
EXTERN
 
T˛_MuãxLock
 (
T˛_Muãx
 * 
muãxPå
);

1920 #i‚de‡
T˛_MuãxU∆ock_TCL_DECLARED


1921 
	#T˛_MuãxU∆ock_TCL_DECLARED


	)

1923 
EXTERN
 
T˛_MuãxU∆ock
 (
T˛_Muãx
 * 
muãxPå
);

1925 #i‚de‡
T˛_C⁄dôi⁄NŸify_TCL_DECLARED


1926 
	#T˛_C⁄dôi⁄NŸify_TCL_DECLARED


	)

1928 
EXTERN
 
T˛_C⁄dôi⁄NŸify
 (
T˛_C⁄dôi⁄
 * 
c⁄dPå
);

1930 #i‚de‡
T˛_C⁄dôi⁄Waô_TCL_DECLARED


1931 
	#T˛_C⁄dôi⁄Waô_TCL_DECLARED


	)

1933 
EXTERN
 
T˛_C⁄dôi⁄Waô
 (
T˛_C⁄dôi⁄
 * 
c⁄dPå
,

1934 
T˛_Muãx
 * 
muãxPå
, 
T˛_Time
 * 
timePå
);

1936 #i‚de‡
T˛_NumUtfCh¨s_TCL_DECLARED


1937 
	#T˛_NumUtfCh¨s_TCL_DECLARED


	)

1939 
EXTERN
 
T˛_NumUtfCh¨s
 (
CONST
 * 
§c
, 
Àngth
);

1941 #i‚de‡
T˛_RódCh¨s_TCL_DECLARED


1942 
	#T˛_RódCh¨s_TCL_DECLARED


	)

1944 
EXTERN
 
T˛_RódCh¨s
 (
T˛_Ch™√l
 
ch™√l
, 
T˛_Obj
 * 
objPå
,

1945 
ch¨sToRód
, 
≠≥ndFœg
);

1947 #i‚de‡
T˛_Re°‹eResu…_TCL_DECLARED


1948 
	#T˛_Re°‹eResu…_TCL_DECLARED


	)

1950 
EXTERN
 
T˛_Re°‹eResu…
 (
T˛_I¡îp
 * 
öãΩ
,

1951 
T˛_SavedResu…
 * 
°©ePå
);

1953 #i‚de‡
T˛_SaveResu…_TCL_DECLARED


1954 
	#T˛_SaveResu…_TCL_DECLARED


	)

1956 
EXTERN
 
T˛_SaveResu…
 (
T˛_I¡îp
 * 
öãΩ
,

1957 
T˛_SavedResu…
 * 
°©ePå
);

1959 #i‚de‡
T˛_SëSy°emEncodög_TCL_DECLARED


1960 
	#T˛_SëSy°emEncodög_TCL_DECLARED


	)

1962 
EXTERN
 
T˛_SëSy°emEncodög
 (
T˛_I¡îp
 * 
öãΩ
,

1963 
CONST
 * 
«me
);

1965 #i‚de‡
T˛_SëV¨2Ex_TCL_DECLARED


1966 
	#T˛_SëV¨2Ex_TCL_DECLARED


	)

1968 
EXTERN
 
T˛_Obj
 * 
T˛_SëV¨2Ex
 (
T˛_I¡îp
 * 
öãΩ
,

1969 
CONST
 * 
∑π1
, CONST * 
∑π2
,

1970 
T˛_Obj
 * 
√wVÆuePå
, 
Êags
);

1972 #i‚de‡
T˛_ThªadAÀπ_TCL_DECLARED


1973 
	#T˛_ThªadAÀπ_TCL_DECLARED


	)

1975 
EXTERN
 
T˛_ThªadAÀπ
 (
T˛_ThªadId
 
thªadId
);

1977 #i‚de‡
T˛_ThªadQueueEvít_TCL_DECLARED


1978 
	#T˛_ThªadQueueEvít_TCL_DECLARED


	)

1980 
EXTERN
 
T˛_ThªadQueueEvít
 (
T˛_ThªadId
 
thªadId
,

1981 
T˛_Evít
* 
evPå
, 
T˛_QueuePosôi⁄
 
posôi⁄
);

1983 #i‚de‡
T˛_UniCh¨AtIndex_TCL_DECLARED


1984 
	#T˛_UniCh¨AtIndex_TCL_DECLARED


	)

1986 
EXTERN
 
T˛_UniCh¨
 
T˛_UniCh¨AtIndex
 (
CONST
 * 
§c
, 
ödex
);

1988 #i‚de‡
T˛_UniCh¨ToLowî_TCL_DECLARED


1989 
	#T˛_UniCh¨ToLowî_TCL_DECLARED


	)

1991 
EXTERN
 
T˛_UniCh¨
 
T˛_UniCh¨ToLowî
 (
ch
);

1993 #i‚de‡
T˛_UniCh¨ToTôÀ_TCL_DECLARED


1994 
	#T˛_UniCh¨ToTôÀ_TCL_DECLARED


	)

1996 
EXTERN
 
T˛_UniCh¨
 
T˛_UniCh¨ToTôÀ
 (
ch
);

1998 #i‚de‡
T˛_UniCh¨ToUµî_TCL_DECLARED


1999 
	#T˛_UniCh¨ToUµî_TCL_DECLARED


	)

2001 
EXTERN
 
T˛_UniCh¨
 
T˛_UniCh¨ToUµî
 (
ch
);

2003 #i‚de‡
T˛_UniCh¨ToUtf_TCL_DECLARED


2004 
	#T˛_UniCh¨ToUtf_TCL_DECLARED


	)

2006 
EXTERN
 
T˛_UniCh¨ToUtf
 (
ch
, * 
buf
);

2008 #i‚de‡
T˛_UtfAtIndex_TCL_DECLARED


2009 
	#T˛_UtfAtIndex_TCL_DECLARED


	)

2011 
EXTERN
 
CONST84_RETURN
 * 
T˛_UtfAtIndex
 (
CONST
 * 
§c
, 
ödex
);

2013 #i‚de‡
T˛_UtfCh¨Com∂ëe_TCL_DECLARED


2014 
	#T˛_UtfCh¨Com∂ëe_TCL_DECLARED


	)

2016 
EXTERN
 
T˛_UtfCh¨Com∂ëe
 (
CONST
 * 
§c
, 
Àngth
);

2018 #i‚de‡
T˛_UtfBack¶ash_TCL_DECLARED


2019 
	#T˛_UtfBack¶ash_TCL_DECLARED


	)

2021 
EXTERN
 
T˛_UtfBack¶ash
 (
CONST
 * 
§c
, * 
ªadPå
,

2022 * 
d°
);

2024 #i‚de‡
T˛_UtfFödFú°_TCL_DECLARED


2025 
	#T˛_UtfFödFú°_TCL_DECLARED


	)

2027 
EXTERN
 
CONST84_RETURN
 * 
T˛_UtfFödFú°
 (
CONST
 * 
§c
, 
ch
);

2029 #i‚de‡
T˛_UtfFödLa°_TCL_DECLARED


2030 
	#T˛_UtfFödLa°_TCL_DECLARED


	)

2032 
EXTERN
 
CONST84_RETURN
 * 
T˛_UtfFödLa°
 (
CONST
 * 
§c
, 
ch
);

2034 #i‚de‡
T˛_UtfNext_TCL_DECLARED


2035 
	#T˛_UtfNext_TCL_DECLARED


	)

2037 
EXTERN
 
CONST84_RETURN
 * 
T˛_UtfNext
 (
CONST
 * 
§c
);

2039 #i‚de‡
T˛_UtfPªv_TCL_DECLARED


2040 
	#T˛_UtfPªv_TCL_DECLARED


	)

2042 
EXTERN
 
CONST84_RETURN
 * 
T˛_UtfPªv
 (
CONST
 * 
§c
,

2043 
CONST
 * 
°¨t
);

2045 #i‚de‡
T˛_UtfToExã∫Æ_TCL_DECLARED


2046 
	#T˛_UtfToExã∫Æ_TCL_DECLARED


	)

2048 
EXTERN
 
T˛_UtfToExã∫Æ
 (
T˛_I¡îp
 * 
öãΩ
,

2049 
T˛_Encodög
 
ícodög
, 
CONST
 * 
§c
,

2050 
§cLí
, 
Êags
,

2051 
T˛_EncodögSèã
 * 
°©ePå
, * 
d°
,

2052 
d°Lí
, * 
§cRódPå
,

2053 * 
d°WrŸePå
, * 
d°Ch¨sPå
);

2055 #i‚de‡
T˛_UtfToExã∫ÆDSåög_TCL_DECLARED


2056 
	#T˛_UtfToExã∫ÆDSåög_TCL_DECLARED


	)

2058 
EXTERN
 * 
T˛_UtfToExã∫ÆDSåög
 (
T˛_Encodög
 
ícodög
,

2059 
CONST
 * 
§c
, 
§cLí
,

2060 
T˛_DSåög
 * 
dsPå
);

2062 #i‚de‡
T˛_UtfToLowî_TCL_DECLARED


2063 
	#T˛_UtfToLowî_TCL_DECLARED


	)

2065 
EXTERN
 
T˛_UtfToLowî
 (* 
§c
);

2067 #i‚de‡
T˛_UtfToTôÀ_TCL_DECLARED


2068 
	#T˛_UtfToTôÀ_TCL_DECLARED


	)

2070 
EXTERN
 
T˛_UtfToTôÀ
 (* 
§c
);

2072 #i‚de‡
T˛_UtfToUniCh¨_TCL_DECLARED


2073 
	#T˛_UtfToUniCh¨_TCL_DECLARED


	)

2075 
EXTERN
 
T˛_UtfToUniCh¨
 (
CONST
 * 
§c
,

2076 
T˛_UniCh¨
 * 
chPå
);

2078 #i‚de‡
T˛_UtfToUµî_TCL_DECLARED


2079 
	#T˛_UtfToUµî_TCL_DECLARED


	)

2081 
EXTERN
 
T˛_UtfToUµî
 (* 
§c
);

2083 #i‚de‡
T˛_WrôeCh¨s_TCL_DECLARED


2084 
	#T˛_WrôeCh¨s_TCL_DECLARED


	)

2086 
EXTERN
 
T˛_WrôeCh¨s
 (
T˛_Ch™√l
 
ch™
, 
CONST
 * 
§c
,

2087 
§cLí
);

2089 #i‚de‡
T˛_WrôeObj_TCL_DECLARED


2090 
	#T˛_WrôeObj_TCL_DECLARED


	)

2092 
EXTERN
 
T˛_WrôeObj
 (
T˛_Ch™√l
 
ch™
, 
T˛_Obj
 * 
objPå
);

2094 #i‚de‡
T˛_GëSåög_TCL_DECLARED


2095 
	#T˛_GëSåög_TCL_DECLARED


	)

2097 
EXTERN
 * 
T˛_GëSåög
 (
T˛_Obj
 * 
objPå
);

2099 #i‚de‡
T˛_GëDeÁu…EncodögDú_TCL_DECLARED


2100 
	#T˛_GëDeÁu…EncodögDú_TCL_DECLARED


	)

2102 
EXTERN
 
CONST84_RETURN
 * 
T˛_GëDeÁu…EncodögDú
 ();

2104 #i‚de‡
T˛_SëDeÁu…EncodögDú_TCL_DECLARED


2105 
	#T˛_SëDeÁu…EncodögDú_TCL_DECLARED


	)

2107 
EXTERN
 
T˛_SëDeÁu…EncodögDú
 (
CONST
 * 
∑th
);

2109 #i‚de‡
T˛_AÀπNŸifõr_TCL_DECLARED


2110 
	#T˛_AÀπNŸifõr_TCL_DECLARED


	)

2112 
EXTERN
 
T˛_AÀπNŸifõr
 (
Clõ¡D©a
 
˛õ¡D©a
);

2114 #i‚de‡
T˛_Sîvi˚ModeHook_TCL_DECLARED


2115 
	#T˛_Sîvi˚ModeHook_TCL_DECLARED


	)

2117 
EXTERN
 
T˛_Sîvi˚ModeHook
 (
mode
);

2119 #i‚de‡
T˛_UniCh¨IsA um_TCL_DECLARED


2120 
	#T˛_UniCh¨IsA um_TCL_DECLARED


	)

2122 
EXTERN
 
T˛_UniCh¨IsA um
 (
ch
);

2124 #i‚de‡
T˛_UniCh¨IsAÕha_TCL_DECLARED


2125 
	#T˛_UniCh¨IsAÕha_TCL_DECLARED


	)

2127 
EXTERN
 
T˛_UniCh¨IsAÕha
 (
ch
);

2129 #i‚de‡
T˛_UniCh¨IsDigô_TCL_DECLARED


2130 
	#T˛_UniCh¨IsDigô_TCL_DECLARED


	)

2132 
EXTERN
 
T˛_UniCh¨IsDigô
 (
ch
);

2134 #i‚de‡
T˛_UniCh¨IsLowî_TCL_DECLARED


2135 
	#T˛_UniCh¨IsLowî_TCL_DECLARED


	)

2137 
EXTERN
 
T˛_UniCh¨IsLowî
 (
ch
);

2139 #i‚de‡
T˛_UniCh¨IsS∑˚_TCL_DECLARED


2140 
	#T˛_UniCh¨IsS∑˚_TCL_DECLARED


	)

2142 
EXTERN
 
T˛_UniCh¨IsS∑˚
 (
ch
);

2144 #i‚de‡
T˛_UniCh¨IsUµî_TCL_DECLARED


2145 
	#T˛_UniCh¨IsUµî_TCL_DECLARED


	)

2147 
EXTERN
 
T˛_UniCh¨IsUµî
 (
ch
);

2149 #i‚de‡
T˛_UniCh¨IsW‹dCh¨_TCL_DECLARED


2150 
	#T˛_UniCh¨IsW‹dCh¨_TCL_DECLARED


	)

2152 
EXTERN
 
T˛_UniCh¨IsW‹dCh¨
 (
ch
);

2154 #i‚de‡
T˛_UniCh¨Lí_TCL_DECLARED


2155 
	#T˛_UniCh¨Lí_TCL_DECLARED


	)

2157 
EXTERN
 
T˛_UniCh¨Lí
 (
CONST
 
T˛_UniCh¨
 * 
uniSå
);

2159 #i‚de‡
T˛_UniCh¨Ncmp_TCL_DECLARED


2160 
	#T˛_UniCh¨Ncmp_TCL_DECLARED


	)

2162 
EXTERN
 
T˛_UniCh¨Ncmp
 (
CONST
 
T˛_UniCh¨
 * 
ucs
,

2163 
CONST
 
T˛_UniCh¨
 * 
u˘
,

2164 
numCh¨s
);

2166 #i‚de‡
T˛_UniCh¨ToUtfDSåög_TCL_DECLARED


2167 
	#T˛_UniCh¨ToUtfDSåög_TCL_DECLARED


	)

2169 
EXTERN
 * 
T˛_UniCh¨ToUtfDSåög
 (
CONST
 
T˛_UniCh¨
 * 
uniSå
,

2170 
uniLígth
, 
T˛_DSåög
 * 
dsPå
);

2172 #i‚de‡
T˛_UtfToUniCh¨DSåög_TCL_DECLARED


2173 
	#T˛_UtfToUniCh¨DSåög_TCL_DECLARED


	)

2175 
EXTERN
 
T˛_UniCh¨
 * 
T˛_UtfToUniCh¨DSåög
 (
CONST
 * 
§c
,

2176 
Àngth
, 
T˛_DSåög
 * 
dsPå
);

2178 #i‚de‡
T˛_GëRegExpFromObj_TCL_DECLARED


2179 
	#T˛_GëRegExpFromObj_TCL_DECLARED


	)

2181 
EXTERN
 
T˛_RegExp
 
T˛_GëRegExpFromObj
 (
T˛_I¡îp
 * 
öãΩ
,

2182 
T˛_Obj
 * 
∑tObj
, 
Êags
);

2184 #i‚de‡
T˛_EvÆTokís_TCL_DECLARED


2185 
	#T˛_EvÆTokís_TCL_DECLARED


	)

2187 
EXTERN
 
T˛_Obj
 * 
T˛_EvÆTokís
 (
T˛_I¡îp
 * 
öãΩ
,

2188 
T˛_Tokí
 * 
tokíPå
, 
cou¡
);

2190 #i‚de‡
T˛_FªeP¨£_TCL_DECLARED


2191 
	#T˛_FªeP¨£_TCL_DECLARED


	)

2193 
EXTERN
 
T˛_FªeP¨£
 (
T˛_P¨£
 * 
∑r£På
);

2195 #i‚de‡
T˛_LogComm™dInfo_TCL_DECLARED


2196 
	#T˛_LogComm™dInfo_TCL_DECLARED


	)

2198 
EXTERN
 
T˛_LogComm™dInfo
 (
T˛_I¡îp
 * 
öãΩ
,

2199 
CONST
 * 
s¸ùt
, CONST * 
comm™d
,

2200 
Àngth
);

2202 #i‚de‡
T˛_P¨£Bø˚s_TCL_DECLARED


2203 
	#T˛_P¨£Bø˚s_TCL_DECLARED


	)

2205 
EXTERN
 
T˛_P¨£Bø˚s
 (
T˛_I¡îp
 * 
öãΩ
,

2206 
CONST
 * 
°¨t
, 
numByãs
,

2207 
T˛_P¨£
 * 
∑r£På
, 
≠≥nd
,

2208 
CONST84
 ** 
ãrmPå
);

2210 #i‚de‡
T˛_P¨£Comm™d_TCL_DECLARED


2211 
	#T˛_P¨£Comm™d_TCL_DECLARED


	)

2213 
EXTERN
 
T˛_P¨£Comm™d
 (
T˛_I¡îp
 * 
öãΩ
,

2214 
CONST
 * 
°¨t
, 
numByãs
, 
√°ed
,

2215 
T˛_P¨£
 * 
∑r£På
);

2217 #i‚de‡
T˛_P¨£Ex¥_TCL_DECLARED


2218 
	#T˛_P¨£Ex¥_TCL_DECLARED


	)

2220 
EXTERN
 
T˛_P¨£Ex¥
 (
T˛_I¡îp
 * 
öãΩ
,

2221 
CONST
 * 
°¨t
, 
numByãs
,

2222 
T˛_P¨£
 * 
∑r£På
);

2224 #i‚de‡
T˛_P¨£QuŸedSåög_TCL_DECLARED


2225 
	#T˛_P¨£QuŸedSåög_TCL_DECLARED


	)

2227 
EXTERN
 
T˛_P¨£QuŸedSåög
 (
T˛_I¡îp
 * 
öãΩ
,

2228 
CONST
 * 
°¨t
, 
numByãs
,

2229 
T˛_P¨£
 * 
∑r£På
, 
≠≥nd
,

2230 
CONST84
 ** 
ãrmPå
);

2232 #i‚de‡
T˛_P¨£V¨Name_TCL_DECLARED


2233 
	#T˛_P¨£V¨Name_TCL_DECLARED


	)

2235 
EXTERN
 
T˛_P¨£V¨Name
 (
T˛_I¡îp
 * 
öãΩ
,

2236 
CONST
 * 
°¨t
, 
numByãs
,

2237 
T˛_P¨£
 * 
∑r£På
, 
≠≥nd
);

2239 #i‚de‡
T˛_GëCwd_TCL_DECLARED


2240 
	#T˛_GëCwd_TCL_DECLARED


	)

2242 
EXTERN
 * 
T˛_GëCwd
 (
T˛_I¡îp
 * 
öãΩ
,

2243 
T˛_DSåög
 * 
cwdPå
);

2245 #i‚de‡
T˛_Chdú_TCL_DECLARED


2246 
	#T˛_Chdú_TCL_DECLARED


	)

2248 
EXTERN
 
T˛_Chdú
 (
CONST
 * 
dúName
);

2250 #i‚de‡
T˛_Ac˚ss_TCL_DECLARED


2251 
	#T˛_Ac˚ss_TCL_DECLARED


	)

2253 
EXTERN
 
T˛_Ac˚ss
 (
CONST
 * 
∑th
, 
mode
);

2255 #i‚de‡
T˛_Sèt_TCL_DECLARED


2256 
	#T˛_Sèt_TCL_DECLARED


	)

2258 
EXTERN
 
T˛_Sèt
 (
CONST
 * 
∑th
, 
°©
 * 
bufPå
);

2260 #i‚de‡
T˛_UtfNcmp_TCL_DECLARED


2261 
	#T˛_UtfNcmp_TCL_DECLARED


	)

2263 
EXTERN
 
T˛_UtfNcmp
 (
CONST
 * 
s1
, CONST * 
s2
,

2264 
n
);

2266 #i‚de‡
T˛_UtfNˇ£cmp_TCL_DECLARED


2267 
	#T˛_UtfNˇ£cmp_TCL_DECLARED


	)

2269 
EXTERN
 
T˛_UtfNˇ£cmp
 (
CONST
 * 
s1
, CONST * 
s2
,

2270 
n
);

2272 #i‚de‡
T˛_SåögCa£M©ch_TCL_DECLARED


2273 
	#T˛_SåögCa£M©ch_TCL_DECLARED


	)

2275 
EXTERN
 
T˛_SåögCa£M©ch
 (
CONST
 * 
°r
,

2276 
CONST
 * 
∑âîn
, 
noˇ£
);

2278 #i‚de‡
T˛_UniCh¨IsC⁄åﬁ_TCL_DECLARED


2279 
	#T˛_UniCh¨IsC⁄åﬁ_TCL_DECLARED


	)

2281 
EXTERN
 
T˛_UniCh¨IsC⁄åﬁ
 (
ch
);

2283 #i‚de‡
T˛_UniCh¨IsGøph_TCL_DECLARED


2284 
	#T˛_UniCh¨IsGøph_TCL_DECLARED


	)

2286 
EXTERN
 
T˛_UniCh¨IsGøph
 (
ch
);

2288 #i‚de‡
T˛_UniCh¨IsPröt_TCL_DECLARED


2289 
	#T˛_UniCh¨IsPröt_TCL_DECLARED


	)

2291 
EXTERN
 
T˛_UniCh¨IsPröt
 (
ch
);

2293 #i‚de‡
T˛_UniCh¨IsPun˘_TCL_DECLARED


2294 
	#T˛_UniCh¨IsPun˘_TCL_DECLARED


	)

2296 
EXTERN
 
T˛_UniCh¨IsPun˘
 (
ch
);

2298 #i‚de‡
T˛_RegExpExecObj_TCL_DECLARED


2299 
	#T˛_RegExpExecObj_TCL_DECLARED


	)

2301 
EXTERN
 
T˛_RegExpExecObj
 (
T˛_I¡îp
 * 
öãΩ
,

2302 
T˛_RegExp
 
ªgexp
, 
T˛_Obj
 * 
ãxtObj
,

2303 
off£t
, 
nm©ches
, 
Êags
);

2305 #i‚de‡
T˛_RegExpGëInfo_TCL_DECLARED


2306 
	#T˛_RegExpGëInfo_TCL_DECLARED


	)

2308 
EXTERN
 
T˛_RegExpGëInfo
 (
T˛_RegExp
 
ªgexp
,

2309 
T˛_RegExpInfo
 * 
öfoPå
);

2311 #i‚de‡
T˛_NewUnicodeObj_TCL_DECLARED


2312 
	#T˛_NewUnicodeObj_TCL_DECLARED


	)

2314 
EXTERN
 
T˛_Obj
 * 
T˛_NewUnicodeObj
 (
CONST
 
T˛_UniCh¨
 * 
unicode
,

2315 
numCh¨s
);

2317 #i‚de‡
T˛_SëUnicodeObj_TCL_DECLARED


2318 
	#T˛_SëUnicodeObj_TCL_DECLARED


	)

2320 
EXTERN
 
T˛_SëUnicodeObj
 (
T˛_Obj
 * 
objPå
,

2321 
CONST
 
T˛_UniCh¨
 * 
unicode
, 
numCh¨s
);

2323 #i‚de‡
T˛_GëCh¨Lígth_TCL_DECLARED


2324 
	#T˛_GëCh¨Lígth_TCL_DECLARED


	)

2326 
EXTERN
 
T˛_GëCh¨Lígth
 (
T˛_Obj
 * 
objPå
);

2328 #i‚de‡
T˛_GëUniCh¨_TCL_DECLARED


2329 
	#T˛_GëUniCh¨_TCL_DECLARED


	)

2331 
EXTERN
 
T˛_UniCh¨
 
T˛_GëUniCh¨
 (
T˛_Obj
 * 
objPå
, 
ödex
);

2333 #i‚de‡
T˛_GëUnicode_TCL_DECLARED


2334 
	#T˛_GëUnicode_TCL_DECLARED


	)

2336 
EXTERN
 
T˛_UniCh¨
 * 
T˛_GëUnicode
 (
T˛_Obj
 * 
objPå
);

2338 #i‚de‡
T˛_GëR™ge_TCL_DECLARED


2339 
	#T˛_GëR™ge_TCL_DECLARED


	)

2341 
EXTERN
 
T˛_Obj
 * 
T˛_GëR™ge
 (T˛_Obj * 
objPå
, 
fú°
, 
œ°
);

2343 #i‚de‡
T˛_AµídUnicodeToObj_TCL_DECLARED


2344 
	#T˛_AµídUnicodeToObj_TCL_DECLARED


	)

2346 
EXTERN
 
T˛_AµídUnicodeToObj
 (
T˛_Obj
 * 
objPå
,

2347 
CONST
 
T˛_UniCh¨
 * 
unicode
, 
Àngth
);

2349 #i‚de‡
T˛_RegExpM©chObj_TCL_DECLARED


2350 
	#T˛_RegExpM©chObj_TCL_DECLARED


	)

2352 
EXTERN
 
T˛_RegExpM©chObj
 (
T˛_I¡îp
 * 
öãΩ
,

2353 
T˛_Obj
 * 
ãxtObj
, T˛_Obj * 
∑âînObj
);

2355 #i‚de‡
T˛_SëNŸifõr_TCL_DECLARED


2356 
	#T˛_SëNŸifõr_TCL_DECLARED


	)

2358 
EXTERN
 
T˛_SëNŸifõr
 (
T˛_NŸifõrProcs
 * 
nŸifõrProcPå
);

2360 #i‚de‡
T˛_GëAŒocMuãx_TCL_DECLARED


2361 
	#T˛_GëAŒocMuãx_TCL_DECLARED


	)

2363 
EXTERN
 
T˛_Muãx
 * 
T˛_GëAŒocMuãx
 ();

2365 #i‚de‡
T˛_GëCh™√lNames_TCL_DECLARED


2366 
	#T˛_GëCh™√lNames_TCL_DECLARED


	)

2368 
EXTERN
 
T˛_GëCh™√lNames
 (
T˛_I¡îp
 * 
öãΩ
);

2370 #i‚de‡
T˛_GëCh™√lNamesEx_TCL_DECLARED


2371 
	#T˛_GëCh™√lNamesEx_TCL_DECLARED


	)

2373 
EXTERN
 
T˛_GëCh™√lNamesEx
 (
T˛_I¡îp
 * 
öãΩ
,

2374 
CONST
 * 
∑âîn
);

2376 #i‚de‡
T˛_ProcObjCmd_TCL_DECLARED


2377 
	#T˛_ProcObjCmd_TCL_DECLARED


	)

2379 
EXTERN
 
T˛_ProcObjCmd
 (
Clõ¡D©a
 
˛õ¡D©a
,

2380 
T˛_I¡îp
 * 
öãΩ
, 
objc
,

2381 
T˛_Obj
 *
CONST
 
objv
[]);

2383 #i‚de‡
T˛_C⁄dôi⁄FöÆize_TCL_DECLARED


2384 
	#T˛_C⁄dôi⁄FöÆize_TCL_DECLARED


	)

2386 
EXTERN
 
T˛_C⁄dôi⁄FöÆize
 (
T˛_C⁄dôi⁄
 * 
c⁄dPå
);

2388 #i‚de‡
T˛_MuãxFöÆize_TCL_DECLARED


2389 
	#T˛_MuãxFöÆize_TCL_DECLARED


	)

2391 
EXTERN
 
T˛_MuãxFöÆize
 (
T˛_Muãx
 * 
muãx
);

2393 #i‚de‡
T˛_Cª©eThªad_TCL_DECLARED


2394 
	#T˛_Cª©eThªad_TCL_DECLARED


	)

2396 
EXTERN
 
T˛_Cª©eThªad
 (
T˛_ThªadId
 * 
idPå
,

2397 
T˛_ThªadCª©eProc
 
¥oc
,

2398 
Clõ¡D©a
 
˛õ¡D©a
, 
°ackSize
,

2399 
Êags
);

2401 #i‚de‡
T˛_RódRaw_TCL_DECLARED


2402 
	#T˛_RódRaw_TCL_DECLARED


	)

2404 
EXTERN
 
T˛_RódRaw
 (
T˛_Ch™√l
 
ch™
, * 
d°
,

2405 
byãsToRód
);

2407 #i‚de‡
T˛_WrôeRaw_TCL_DECLARED


2408 
	#T˛_WrôeRaw_TCL_DECLARED


	)

2410 
EXTERN
 
T˛_WrôeRaw
 (
T˛_Ch™√l
 
ch™
, 
CONST
 * 
§c
,

2411 
§cLí
);

2413 #i‚de‡
T˛_GëT›Ch™√l_TCL_DECLARED


2414 
	#T˛_GëT›Ch™√l_TCL_DECLARED


	)

2416 
EXTERN
 
T˛_Ch™√l
 
T˛_GëT›Ch™√l
 (T˛_Ch™√»
ch™
);

2418 #i‚de‡
T˛_Ch™√lBuf„ªd_TCL_DECLARED


2419 
	#T˛_Ch™√lBuf„ªd_TCL_DECLARED


	)

2421 
EXTERN
 
T˛_Ch™√lBuf„ªd
 (
T˛_Ch™√l
 
ch™
);

2423 #i‚de‡
T˛_Ch™√lName_TCL_DECLARED


2424 
	#T˛_Ch™√lName_TCL_DECLARED


	)

2426 
EXTERN
 
CONST84_RETURN
 * 
T˛_Ch™√lName
 (

2427 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2429 #i‚de‡
T˛_Ch™√lVîsi⁄_TCL_DECLARED


2430 
	#T˛_Ch™√lVîsi⁄_TCL_DECLARED


	)

2432 
EXTERN
 
T˛_Ch™√lTy≥Vîsi⁄
 
T˛_Ch™√lVîsi⁄
 (

2433 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2435 #i‚de‡
T˛_Ch™√lBlockModeProc_TCL_DECLARED


2436 
	#T˛_Ch™√lBlockModeProc_TCL_DECLARED


	)

2438 
EXTERN
 
T˛_DrivîBlockModeProc
 * 
T˛_Ch™√lBlockModeProc
 (

2439 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2441 #i‚de‡
T˛_Ch™√lClo£Proc_TCL_DECLARED


2442 
	#T˛_Ch™√lClo£Proc_TCL_DECLARED


	)

2444 
EXTERN
 
T˛_DrivîClo£Proc
 * 
T˛_Ch™√lClo£Proc
 (

2445 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2447 #i‚de‡
T˛_Ch™√lClo£2Proc_TCL_DECLARED


2448 
	#T˛_Ch™√lClo£2Proc_TCL_DECLARED


	)

2450 
EXTERN
 
T˛_DrivîClo£2Proc
 * 
T˛_Ch™√lClo£2Proc
 (

2451 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2453 #i‚de‡
T˛_Ch™√lI≈utProc_TCL_DECLARED


2454 
	#T˛_Ch™√lI≈utProc_TCL_DECLARED


	)

2456 
EXTERN
 
T˛_DrivîI≈utProc
 * 
T˛_Ch™√lI≈utProc
 (

2457 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2459 #i‚de‡
T˛_Ch™√lOuçutProc_TCL_DECLARED


2460 
	#T˛_Ch™√lOuçutProc_TCL_DECLARED


	)

2462 
EXTERN
 
T˛_DrivîOuçutProc
 * 
T˛_Ch™√lOuçutProc
 (

2463 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2465 #i‚de‡
T˛_Ch™√lSìkProc_TCL_DECLARED


2466 
	#T˛_Ch™√lSìkProc_TCL_DECLARED


	)

2468 
EXTERN
 
T˛_DrivîSìkProc
 * 
T˛_Ch™√lSìkProc
 (

2469 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2471 #i‚de‡
T˛_Ch™√lSëO±i⁄Proc_TCL_DECLARED


2472 
	#T˛_Ch™√lSëO±i⁄Proc_TCL_DECLARED


	)

2474 
EXTERN
 
T˛_DrivîSëO±i⁄Proc
 * 
T˛_Ch™√lSëO±i⁄Proc
 (

2475 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2477 #i‚de‡
T˛_Ch™√lGëO±i⁄Proc_TCL_DECLARED


2478 
	#T˛_Ch™√lGëO±i⁄Proc_TCL_DECLARED


	)

2480 
EXTERN
 
T˛_DrivîGëO±i⁄Proc
 * 
T˛_Ch™√lGëO±i⁄Proc
 (

2481 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2483 #i‚de‡
T˛_Ch™√lW©chProc_TCL_DECLARED


2484 
	#T˛_Ch™√lW©chProc_TCL_DECLARED


	)

2486 
EXTERN
 
T˛_DrivîW©chProc
 * 
T˛_Ch™√lW©chProc
 (

2487 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2489 #i‚de‡
T˛_Ch™√lGëH™dÀProc_TCL_DECLARED


2490 
	#T˛_Ch™√lGëH™dÀProc_TCL_DECLARED


	)

2492 
EXTERN
 
T˛_DrivîGëH™dÀProc
 * 
T˛_Ch™√lGëH™dÀProc
 (

2493 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2495 #i‚de‡
T˛_Ch™√lFlushProc_TCL_DECLARED


2496 
	#T˛_Ch™√lFlushProc_TCL_DECLARED


	)

2498 
EXTERN
 
T˛_DrivîFlushProc
 * 
T˛_Ch™√lFlushProc
 (

2499 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2501 #i‚de‡
T˛_Ch™√lH™dÀrProc_TCL_DECLARED


2502 
	#T˛_Ch™√lH™dÀrProc_TCL_DECLARED


	)

2504 
EXTERN
 
T˛_DrivîH™dÀrProc
 * 
T˛_Ch™√lH™dÀrProc
 (

2505 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2507 #i‚de‡
T˛_JoöThªad_TCL_DECLARED


2508 
	#T˛_JoöThªad_TCL_DECLARED


	)

2510 
EXTERN
 
T˛_JoöThªad
 (
T˛_ThªadId
 
thªadId
, * 
ªsu…
);

2512 #i‚de‡
T˛_IsCh™√lSh¨ed_TCL_DECLARED


2513 
	#T˛_IsCh™√lSh¨ed_TCL_DECLARED


	)

2515 
EXTERN
 
T˛_IsCh™√lSh¨ed
 (
T˛_Ch™√l
 
ch™√l
);

2517 #i‚de‡
T˛_IsCh™√lRegi°îed_TCL_DECLARED


2518 
	#T˛_IsCh™√lRegi°îed_TCL_DECLARED


	)

2520 
EXTERN
 
T˛_IsCh™√lRegi°îed
 (
T˛_I¡îp
* 
öãΩ
,

2521 
T˛_Ch™√l
 
ch™√l
);

2523 #i‚de‡
T˛_CutCh™√l_TCL_DECLARED


2524 
	#T˛_CutCh™√l_TCL_DECLARED


	)

2526 
EXTERN
 
T˛_CutCh™√l
 (
T˛_Ch™√l
 
ch™√l
);

2528 #i‚de‡
T˛_S∂i˚Ch™√l_TCL_DECLARED


2529 
	#T˛_S∂i˚Ch™√l_TCL_DECLARED


	)

2531 
EXTERN
 
T˛_S∂i˚Ch™√l
 (
T˛_Ch™√l
 
ch™√l
);

2533 #i‚de‡
T˛_CÀ¨Ch™√lH™dÀrs_TCL_DECLARED


2534 
	#T˛_CÀ¨Ch™√lH™dÀrs_TCL_DECLARED


	)

2536 
EXTERN
 
T˛_CÀ¨Ch™√lH™dÀrs
 (
T˛_Ch™√l
 
ch™√l
);

2538 #i‚de‡
T˛_IsCh™√lExi°ög_TCL_DECLARED


2539 
	#T˛_IsCh™√lExi°ög_TCL_DECLARED


	)

2541 
EXTERN
 
T˛_IsCh™√lExi°ög
 (
CONST
 * 
ch™√lName
);

2543 #i‚de‡
T˛_UniCh¨Nˇ£cmp_TCL_DECLARED


2544 
	#T˛_UniCh¨Nˇ£cmp_TCL_DECLARED


	)

2546 
EXTERN
 
T˛_UniCh¨Nˇ£cmp
 (
CONST
 
T˛_UniCh¨
 * 
ucs
,

2547 
CONST
 
T˛_UniCh¨
 * 
u˘
,

2548 
numCh¨s
);

2550 #i‚de‡
T˛_UniCh¨Ca£M©ch_TCL_DECLARED


2551 
	#T˛_UniCh¨Ca£M©ch_TCL_DECLARED


	)

2553 
EXTERN
 
T˛_UniCh¨Ca£M©ch
 (
CONST
 
T˛_UniCh¨
 * 
uniSå
,

2554 
CONST
 
T˛_UniCh¨
 * 
uniP©ã∫
, 
noˇ£
);

2556 #i‚de‡
T˛_FödHashE¡ry_TCL_DECLARED


2557 
	#T˛_FödHashE¡ry_TCL_DECLARED


	)

2559 
EXTERN
 
T˛_HashE¡ry
 * 
T˛_FödHashE¡ry
 (
T˛_HashTabÀ
 * 
èbÀPå
,

2560 
CONST
 * 
key
);

2562 #i‚de‡
T˛_Cª©eHashE¡ry_TCL_DECLARED


2563 
	#T˛_Cª©eHashE¡ry_TCL_DECLARED


	)

2565 
EXTERN
 
T˛_HashE¡ry
 * 
T˛_Cª©eHashE¡ry
 (
T˛_HashTabÀ
 * 
èbÀPå
,

2566 
CONST
 * 
key
, * 
√wPå
);

2568 #i‚de‡
T˛_InôCu°omHashTabÀ_TCL_DECLARED


2569 
	#T˛_InôCu°omHashTabÀ_TCL_DECLARED


	)

2571 
EXTERN
 
T˛_InôCu°omHashTabÀ
 (
T˛_HashTabÀ
 * 
èbÀPå
,

2572 
keyTy≥
, 
T˛_HashKeyTy≥
 * 
ty≥På
);

2574 #i‚de‡
T˛_InôObjHashTabÀ_TCL_DECLARED


2575 
	#T˛_InôObjHashTabÀ_TCL_DECLARED


	)

2577 
EXTERN
 
T˛_InôObjHashTabÀ
 (
T˛_HashTabÀ
 * 
èbÀPå
);

2579 #i‚de‡
T˛_Comm™dTø˚Info_TCL_DECLARED


2580 
	#T˛_Comm™dTø˚Info_TCL_DECLARED


	)

2582 
EXTERN
 
Clõ¡D©a
 
T˛_Comm™dTø˚Info
 (
T˛_I¡îp
 * 
öãΩ
,

2583 
CONST
 * 
v¨Name
, 
Êags
,

2584 
T˛_Comm™dTø˚Proc
 * 
¥ocPå
,

2585 
Clõ¡D©a
 
¥evClõ¡D©a
);

2587 #i‚de‡
T˛_Tø˚Comm™d_TCL_DECLARED


2588 
	#T˛_Tø˚Comm™d_TCL_DECLARED


	)

2590 
EXTERN
 
T˛_Tø˚Comm™d
 (
T˛_I¡îp
 * 
öãΩ
,

2591 
CONST
 * 
v¨Name
, 
Êags
,

2592 
T˛_Comm™dTø˚Proc
 * 
¥oc
,

2593 
Clõ¡D©a
 
˛õ¡D©a
);

2595 #i‚de‡
T˛_U¡ø˚Comm™d_TCL_DECLARED


2596 
	#T˛_U¡ø˚Comm™d_TCL_DECLARED


	)

2598 
EXTERN
 
T˛_U¡ø˚Comm™d
 (
T˛_I¡îp
 * 
öãΩ
,

2599 
CONST
 * 
v¨Name
, 
Êags
,

2600 
T˛_Comm™dTø˚Proc
 * 
¥oc
,

2601 
Clõ¡D©a
 
˛õ¡D©a
);

2603 #i‚de‡
T˛_Aâem±AŒoc_TCL_DECLARED


2604 
	#T˛_Aâem±AŒoc_TCL_DECLARED


	)

2606 
EXTERN
 * 
T˛_Aâem±AŒoc
 (
size
);

2608 #i‚de‡
T˛_Aâem±DbCkÆloc_TCL_DECLARED


2609 
	#T˛_Aâem±DbCkÆloc_TCL_DECLARED


	)

2611 
EXTERN
 * 
T˛_Aâem±DbCkÆloc
 (
size
,

2612 
CONST
 * 
fûe
, 
löe
);

2614 #i‚de‡
T˛_Aâem±RóŒoc_TCL_DECLARED


2615 
	#T˛_Aâem±RóŒoc_TCL_DECLARED


	)

2617 
EXTERN
 * 
T˛_Aâem±RóŒoc
 (* 
±r
, 
size
);

2619 #i‚de‡
T˛_Aâem±DbCkªÆloc_TCL_DECLARED


2620 
	#T˛_Aâem±DbCkªÆloc_TCL_DECLARED


	)

2622 
EXTERN
 * 
T˛_Aâem±DbCkªÆloc
 (* 
±r
,

2623 
size
, 
CONST
 * 
fûe
,

2624 
löe
);

2626 #i‚de‡
T˛_Aâem±SëObjLígth_TCL_DECLARED


2627 
	#T˛_Aâem±SëObjLígth_TCL_DECLARED


	)

2629 
EXTERN
 
T˛_Aâem±SëObjLígth
 (
T˛_Obj
 * 
objPå
,

2630 
Àngth
);

2632 #i‚de‡
T˛_GëCh™√lThªad_TCL_DECLARED


2633 
	#T˛_GëCh™√lThªad_TCL_DECLARED


	)

2635 
EXTERN
 
T˛_ThªadId
 
T˛_GëCh™√lThªad
 (
T˛_Ch™√l
 
ch™√l
);

2637 #i‚de‡
T˛_GëUnicodeFromObj_TCL_DECLARED


2638 
	#T˛_GëUnicodeFromObj_TCL_DECLARED


	)

2640 
EXTERN
 
T˛_UniCh¨
 * 
T˛_GëUnicodeFromObj
 (
T˛_Obj
 * 
objPå
,

2641 * 
ÀngthPå
);

2643 #i‚de‡
T˛_GëM©hFuncInfo_TCL_DECLARED


2644 
	#T˛_GëM©hFuncInfo_TCL_DECLARED


	)

2646 
EXTERN
 
T˛_GëM©hFuncInfo
 (
T˛_I¡îp
 * 
öãΩ
,

2647 
CONST
 * 
«me
, * 
numArgsPå
,

2648 
T˛_VÆueTy≥
 ** 
¨gTy≥sPå
,

2649 
T˛_M©hProc
 ** 
¥ocPå
,

2650 
Clõ¡D©a
 * 
˛õ¡D©aPå
);

2652 #i‚de‡
T˛_Li°M©hFuncs_TCL_DECLARED


2653 
	#T˛_Li°M©hFuncs_TCL_DECLARED


	)

2655 
EXTERN
 
T˛_Obj
 * 
T˛_Li°M©hFuncs
 (
T˛_I¡îp
 * 
öãΩ
,

2656 
CONST
 * 
∑âîn
);

2658 #i‚de‡
T˛_Sub°Obj_TCL_DECLARED


2659 
	#T˛_Sub°Obj_TCL_DECLARED


	)

2661 
EXTERN
 
T˛_Obj
 * 
T˛_Sub°Obj
 (
T˛_I¡îp
 * 
öãΩ
, T˛_Obj * 
objPå
,

2662 
Êags
);

2664 #i‚de‡
T˛_DëachCh™√l_TCL_DECLARED


2665 
	#T˛_DëachCh™√l_TCL_DECLARED


	)

2667 
EXTERN
 
T˛_DëachCh™√l
 (
T˛_I¡îp
* 
öãΩ
,

2668 
T˛_Ch™√l
 
ch™√l
);

2670 #i‚de‡
T˛_IsSènd¨dCh™√l_TCL_DECLARED


2671 
	#T˛_IsSènd¨dCh™√l_TCL_DECLARED


	)

2673 
EXTERN
 
T˛_IsSènd¨dCh™√l
 (
T˛_Ch™√l
 
ch™√l
);

2675 #i‚de‡
T˛_FSC›yFûe_TCL_DECLARED


2676 
	#T˛_FSC›yFûe_TCL_DECLARED


	)

2678 
EXTERN
 
T˛_FSC›yFûe
 (
T˛_Obj
 * 
§cP©hPå
,

2679 
T˛_Obj
 * 
de°P©hPå
);

2681 #i‚de‡
T˛_FSC›yDúe˘‹y_TCL_DECLARED


2682 
	#T˛_FSC›yDúe˘‹y_TCL_DECLARED


	)

2684 
EXTERN
 
T˛_FSC›yDúe˘‹y
 (
T˛_Obj
 * 
§cP©hPå
,

2685 
T˛_Obj
 * 
de°P©hPå
, T˛_Obj ** 
îr‹På
);

2687 #i‚de‡
T˛_FSCª©eDúe˘‹y_TCL_DECLARED


2688 
	#T˛_FSCª©eDúe˘‹y_TCL_DECLARED


	)

2690 
EXTERN
 
T˛_FSCª©eDúe˘‹y
 (
T˛_Obj
 * 
∑thPå
);

2692 #i‚de‡
T˛_FSDñëeFûe_TCL_DECLARED


2693 
	#T˛_FSDñëeFûe_TCL_DECLARED


	)

2695 
EXTERN
 
T˛_FSDñëeFûe
 (
T˛_Obj
 * 
∑thPå
);

2697 #i‚de‡
T˛_FSLﬂdFûe_TCL_DECLARED


2698 
	#T˛_FSLﬂdFûe_TCL_DECLARED


	)

2700 
EXTERN
 
T˛_FSLﬂdFûe
 (
T˛_I¡îp
 * 
öãΩ
,

2701 
T˛_Obj
 * 
∑thPå
, 
CONST
 * 
sym1
,

2702 
CONST
 * 
sym2
,

2703 
T˛_PackageInôProc
 ** 
¥oc1På
,

2704 
T˛_PackageInôProc
 ** 
¥oc2På
,

2705 
T˛_LﬂdH™dÀ
 * 
h™dÀPå
,

2706 
T˛_FSU∆ﬂdFûeProc
 ** 
u∆ﬂdProcPå
);

2708 #i‚de‡
T˛_FSM©chInDúe˘‹y_TCL_DECLARED


2709 
	#T˛_FSM©chInDúe˘‹y_TCL_DECLARED


	)

2711 
EXTERN
 
T˛_FSM©chInDúe˘‹y
 (
T˛_I¡îp
 * 
öãΩ
,

2712 
T˛_Obj
 * 
ªsu…
, T˛_Obj * 
∑thPå
,

2713 
CONST
 * 
∑âîn
,

2714 
T˛_GlobTy≥D©a
 * 
ty≥s
);

2716 #i‚de‡
T˛_FSLök_TCL_DECLARED


2717 
	#T˛_FSLök_TCL_DECLARED


	)

2719 
EXTERN
 
T˛_Obj
 * 
T˛_FSLök
 (T˛_Obj * 
∑thPå
, T˛_Obj * 
toPå
,

2720 
lökA˘i⁄
);

2722 #i‚de‡
T˛_FSRemoveDúe˘‹y_TCL_DECLARED


2723 
	#T˛_FSRemoveDúe˘‹y_TCL_DECLARED


	)

2725 
EXTERN
 
T˛_FSRemoveDúe˘‹y
 (
T˛_Obj
 * 
∑thPå
,

2726 
ªcursive
, 
T˛_Obj
 ** 
îr‹På
);

2728 #i‚de‡
T˛_FSRíameFûe_TCL_DECLARED


2729 
	#T˛_FSRíameFûe_TCL_DECLARED


	)

2731 
EXTERN
 
T˛_FSRíameFûe
 (
T˛_Obj
 * 
§cP©hPå
,

2732 
T˛_Obj
 * 
de°P©hPå
);

2734 #i‚de‡
T˛_FSL°©_TCL_DECLARED


2735 
	#T˛_FSL°©_TCL_DECLARED


	)

2737 
EXTERN
 
T˛_FSL°©
 (
T˛_Obj
 * 
∑thPå
, 
T˛_SètBuf
 * 
buf
);

2739 #i‚de‡
T˛_FSUtime_TCL_DECLARED


2740 
	#T˛_FSUtime_TCL_DECLARED


	)

2742 
EXTERN
 
T˛_FSUtime
 (
T˛_Obj
 * 
∑thPå
,

2743 
utimbuf
 * 
tvÆ
);

2745 #i‚de‡
T˛_FSFûeAârsGë_TCL_DECLARED


2746 
	#T˛_FSFûeAârsGë_TCL_DECLARED


	)

2748 
EXTERN
 
T˛_FSFûeAârsGë
 (
T˛_I¡îp
 * 
öãΩ
, 
ödex
,

2749 
T˛_Obj
 * 
∑thPå
, T˛_Obj ** 
objPåRef
);

2751 #i‚de‡
T˛_FSFûeAârsSë_TCL_DECLARED


2752 
	#T˛_FSFûeAârsSë_TCL_DECLARED


	)

2754 
EXTERN
 
T˛_FSFûeAârsSë
 (
T˛_I¡îp
 * 
öãΩ
, 
ödex
,

2755 
T˛_Obj
 * 
∑thPå
, T˛_Obj * 
objPå
);

2757 #i‚de‡
T˛_FSFûeAârSåögs_TCL_DECLARED


2758 
	#T˛_FSFûeAârSåögs_TCL_DECLARED


	)

2760 
EXTERN
 
CONST
 ** 
T˛_FSFûeAârSåögs
 (
T˛_Obj
 * 
∑thPå
,

2761 
T˛_Obj
 ** 
objPåRef
);

2763 #i‚de‡
T˛_FSSèt_TCL_DECLARED


2764 
	#T˛_FSSèt_TCL_DECLARED


	)

2766 
EXTERN
 
T˛_FSSèt
 (
T˛_Obj
 * 
∑thPå
, 
T˛_SètBuf
 * 
buf
);

2768 #i‚de‡
T˛_FSAc˚ss_TCL_DECLARED


2769 
	#T˛_FSAc˚ss_TCL_DECLARED


	)

2771 
EXTERN
 
T˛_FSAc˚ss
 (
T˛_Obj
 * 
∑thPå
, 
mode
);

2773 #i‚de‡
T˛_FSO≥nFûeCh™√l_TCL_DECLARED


2774 
	#T˛_FSO≥nFûeCh™√l_TCL_DECLARED


	)

2776 
EXTERN
 
T˛_Ch™√l
 
T˛_FSO≥nFûeCh™√l
 (
T˛_I¡îp
 * 
öãΩ
,

2777 
T˛_Obj
 * 
∑thPå
, 
CONST
 * 
modeSåög
,

2778 
≥rmissi⁄s
);

2780 #i‚de‡
T˛_FSGëCwd_TCL_DECLARED


2781 
	#T˛_FSGëCwd_TCL_DECLARED


	)

2783 
EXTERN
 
T˛_Obj
* 
T˛_FSGëCwd
 (
T˛_I¡îp
 * 
öãΩ
);

2785 #i‚de‡
T˛_FSChdú_TCL_DECLARED


2786 
	#T˛_FSChdú_TCL_DECLARED


	)

2788 
EXTERN
 
T˛_FSChdú
 (
T˛_Obj
 * 
∑thPå
);

2790 #i‚de‡
T˛_FSC⁄vîtToP©hTy≥_TCL_DECLARED


2791 
	#T˛_FSC⁄vîtToP©hTy≥_TCL_DECLARED


	)

2793 
EXTERN
 
T˛_FSC⁄vîtToP©hTy≥
 (
T˛_I¡îp
 * 
öãΩ
,

2794 
T˛_Obj
 * 
∑thPå
);

2796 #i‚de‡
T˛_FSJoöP©h_TCL_DECLARED


2797 
	#T˛_FSJoöP©h_TCL_DECLARED


	)

2799 
EXTERN
 
T˛_Obj
* 
T˛_FSJoöP©h
 (T˛_Obj * 
li°Obj
, 
ñemíts
);

2801 #i‚de‡
T˛_FSS∂ôP©h_TCL_DECLARED


2802 
	#T˛_FSS∂ôP©h_TCL_DECLARED


	)

2804 
EXTERN
 
T˛_Obj
* 
T˛_FSS∂ôP©h
 (T˛_Obj* 
∑thPå
, * 
ÀnPå
);

2806 #i‚de‡
T˛_FSEquÆP©hs_TCL_DECLARED


2807 
	#T˛_FSEquÆP©hs_TCL_DECLARED


	)

2809 
EXTERN
 
T˛_FSEquÆP©hs
 (
T˛_Obj
* 
fú°På
,

2810 
T˛_Obj
* 
£c⁄dPå
);

2812 #i‚de‡
T˛_FSGëN‹mÆizedP©h_TCL_DECLARED


2813 
	#T˛_FSGëN‹mÆizedP©h_TCL_DECLARED


	)

2815 
EXTERN
 
T˛_Obj
* 
T˛_FSGëN‹mÆizedP©h
 (
T˛_I¡îp
 * 
öãΩ
,

2816 
T˛_Obj
* 
∑thPå
);

2818 #i‚de‡
T˛_FSJoöToP©h_TCL_DECLARED


2819 
	#T˛_FSJoöToP©h_TCL_DECLARED


	)

2821 
EXTERN
 
T˛_Obj
* 
T˛_FSJoöToP©h
 (T˛_Obj * 
∑thPå
, 
objc
,

2822 
T˛_Obj
 *
CONST
 
objv
[]);

2824 #i‚de‡
T˛_FSGëI¡î«lRï_TCL_DECLARED


2825 
	#T˛_FSGëI¡î«lRï_TCL_DECLARED


	)

2827 
EXTERN
 
Clõ¡D©a
 
T˛_FSGëI¡î«lRï
 (
T˛_Obj
* 
∑thPå
,

2828 
T˛_Fûesy°em
 * 
fsPå
);

2830 #i‚de‡
T˛_FSGëTøn¶©edP©h_TCL_DECLARED


2831 
	#T˛_FSGëTøn¶©edP©h_TCL_DECLARED


	)

2833 
EXTERN
 
T˛_Obj
* 
T˛_FSGëTøn¶©edP©h
 (
T˛_I¡îp
 * 
öãΩ
,

2834 
T˛_Obj
* 
∑thPå
);

2836 #i‚de‡
T˛_FSEvÆFûe_TCL_DECLARED


2837 
	#T˛_FSEvÆFûe_TCL_DECLARED


	)

2839 
EXTERN
 
T˛_FSEvÆFûe
 (
T˛_I¡îp
 * 
öãΩ
,

2840 
T˛_Obj
 * 
fûeName
);

2842 #i‚de‡
T˛_FSNewN©iveP©h_TCL_DECLARED


2843 
	#T˛_FSNewN©iveP©h_TCL_DECLARED


	)

2845 
EXTERN
 
T˛_Obj
* 
T˛_FSNewN©iveP©h
 (
T˛_Fûesy°em
* 
‰omFûesy°em
,

2846 
Clõ¡D©a
 
˛õ¡D©a
);

2848 #i‚de‡
T˛_FSGëN©iveP©h_TCL_DECLARED


2849 
	#T˛_FSGëN©iveP©h_TCL_DECLARED


	)

2851 
EXTERN
 
CONST
 * 
T˛_FSGëN©iveP©h
 (
T˛_Obj
* 
∑thPå
);

2853 #i‚de‡
T˛_FSFûeSy°emInfo_TCL_DECLARED


2854 
	#T˛_FSFûeSy°emInfo_TCL_DECLARED


	)

2856 
EXTERN
 
T˛_Obj
* 
T˛_FSFûeSy°emInfo
 (T˛_Obj* 
∑thPå
);

2858 #i‚de‡
T˛_FSP©hSï¨©‹_TCL_DECLARED


2859 
	#T˛_FSP©hSï¨©‹_TCL_DECLARED


	)

2861 
EXTERN
 
T˛_Obj
* 
T˛_FSP©hSï¨©‹
 (T˛_Obj* 
∑thPå
);

2863 #i‚de‡
T˛_FSLi°Vﬁumes_TCL_DECLARED


2864 
	#T˛_FSLi°Vﬁumes_TCL_DECLARED


	)

2866 
EXTERN
 
T˛_Obj
* 
T˛_FSLi°Vﬁumes
 ();

2868 #i‚de‡
T˛_FSRegi°î_TCL_DECLARED


2869 
	#T˛_FSRegi°î_TCL_DECLARED


	)

2871 
EXTERN
 
T˛_FSRegi°î
 (
Clõ¡D©a
 
˛õ¡D©a
,

2872 
T˛_Fûesy°em
 * 
fsPå
);

2874 #i‚de‡
T˛_FSUƒegi°î_TCL_DECLARED


2875 
	#T˛_FSUƒegi°î_TCL_DECLARED


	)

2877 
EXTERN
 
T˛_FSUƒegi°î
 (
T˛_Fûesy°em
 * 
fsPå
);

2879 #i‚de‡
T˛_FSD©a_TCL_DECLARED


2880 
	#T˛_FSD©a_TCL_DECLARED


	)

2882 
EXTERN
 
Clõ¡D©a
 
T˛_FSD©a
 (
T˛_Fûesy°em
 * 
fsPå
);

2884 #i‚de‡
T˛_FSGëTøn¶©edSåögP©h_TCL_DECLARED


2885 
	#T˛_FSGëTøn¶©edSåögP©h_TCL_DECLARED


	)

2887 
EXTERN
 
CONST
 * 
T˛_FSGëTøn¶©edSåögP©h
 (
T˛_I¡îp
 * 
öãΩ
,

2888 
T˛_Obj
* 
∑thPå
);

2890 #i‚de‡
T˛_FSGëFûeSy°emF‹P©h_TCL_DECLARED


2891 
	#T˛_FSGëFûeSy°emF‹P©h_TCL_DECLARED


	)

2893 
EXTERN
 
T˛_Fûesy°em
* 
T˛_FSGëFûeSy°emF‹P©h
 (
T˛_Obj
* 
∑thPå
);

2895 #i‚de‡
T˛_FSGëP©hTy≥_TCL_DECLARED


2896 
	#T˛_FSGëP©hTy≥_TCL_DECLARED


	)

2898 
EXTERN
 
T˛_P©hTy≥
 
T˛_FSGëP©hTy≥
 (
T˛_Obj
 * 
∑thPå
);

2900 #i‚de‡
T˛_OuçutBuf„ªd_TCL_DECLARED


2901 
	#T˛_OuçutBuf„ªd_TCL_DECLARED


	)

2903 
EXTERN
 
T˛_OuçutBuf„ªd
 (
T˛_Ch™√l
 
ch™
);

2905 #i‚de‡
T˛_FSMou¡sCh™ged_TCL_DECLARED


2906 
	#T˛_FSMou¡sCh™ged_TCL_DECLARED


	)

2908 
EXTERN
 
T˛_FSMou¡sCh™ged
 (
T˛_Fûesy°em
 * 
fsPå
);

2910 #i‚de‡
T˛_EvÆTokísSènd¨d_TCL_DECLARED


2911 
	#T˛_EvÆTokísSènd¨d_TCL_DECLARED


	)

2913 
EXTERN
 
T˛_EvÆTokísSènd¨d
 (
T˛_I¡îp
 * 
öãΩ
,

2914 
T˛_Tokí
 * 
tokíPå
, 
cou¡
);

2916 #i‚de‡
T˛_GëTime_TCL_DECLARED


2917 
	#T˛_GëTime_TCL_DECLARED


	)

2919 
EXTERN
 
T˛_GëTime
 (
T˛_Time
* 
timeBuf
);

2921 #i‚de‡
T˛_Cª©eObjTø˚_TCL_DECLARED


2922 
	#T˛_Cª©eObjTø˚_TCL_DECLARED


	)

2924 
EXTERN
 
T˛_Tø˚
 
T˛_Cª©eObjTø˚
 (
T˛_I¡îp
* 
öãΩ
, 
Àvñ
,

2925 
Êags
, 
T˛_CmdObjTø˚Proc
* 
objProc
,

2926 
Clõ¡D©a
 
˛õ¡D©a
,

2927 
T˛_CmdObjTø˚DñëeProc
* 
dñProc
);

2929 #i‚de‡
T˛_GëComm™dInfoFromTokí_TCL_DECLARED


2930 
	#T˛_GëComm™dInfoFromTokí_TCL_DECLARED


	)

2932 
EXTERN
 
T˛_GëComm™dInfoFromTokí
 (
T˛_Comm™d
 
tokí
,

2933 
T˛_CmdInfo
* 
öfoPå
);

2935 #i‚de‡
T˛_SëComm™dInfoFromTokí_TCL_DECLARED


2936 
	#T˛_SëComm™dInfoFromTokí_TCL_DECLARED


	)

2938 
EXTERN
 
T˛_SëComm™dInfoFromTokí
 (
T˛_Comm™d
 
tokí
,

2939 
CONST
 
T˛_CmdInfo
* 
öfoPå
);

2941 #i‚de‡
T˛_DbNewWideI¡Obj_TCL_DECLARED


2942 
	#T˛_DbNewWideI¡Obj_TCL_DECLARED


	)

2944 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewWideI¡Obj
 (
T˛_WideI¡
 
wideVÆue
,

2945 
CONST
 * 
fûe
, 
löe
);

2947 #i‚de‡
T˛_GëWideI¡FromObj_TCL_DECLARED


2948 
	#T˛_GëWideI¡FromObj_TCL_DECLARED


	)

2950 
EXTERN
 
T˛_GëWideI¡FromObj
 (
T˛_I¡îp
 * 
öãΩ
,

2951 
T˛_Obj
 * 
objPå
, 
T˛_WideI¡
 * 
widePå
);

2953 #i‚de‡
T˛_NewWideI¡Obj_TCL_DECLARED


2954 
	#T˛_NewWideI¡Obj_TCL_DECLARED


	)

2956 
EXTERN
 
T˛_Obj
 * 
T˛_NewWideI¡Obj
 (
T˛_WideI¡
 
wideVÆue
);

2958 #i‚de‡
T˛_SëWideI¡Obj_TCL_DECLARED


2959 
	#T˛_SëWideI¡Obj_TCL_DECLARED


	)

2961 
EXTERN
 
T˛_SëWideI¡Obj
 (
T˛_Obj
 * 
objPå
,

2962 
T˛_WideI¡
 
wideVÆue
);

2964 #i‚de‡
T˛_AŒocSètBuf_TCL_DECLARED


2965 
	#T˛_AŒocSètBuf_TCL_DECLARED


	)

2967 
EXTERN
 
T˛_SètBuf
 * 
T˛_AŒocSètBuf
 ();

2969 #i‚de‡
T˛_Sìk_TCL_DECLARED


2970 
	#T˛_Sìk_TCL_DECLARED


	)

2972 
EXTERN
 
T˛_WideI¡
 
T˛_Sìk
 (
T˛_Ch™√l
 
ch™
, T˛_WideI¡ 
off£t
,

2973 
mode
);

2975 #i‚de‡
T˛_Tñl_TCL_DECLARED


2976 
	#T˛_Tñl_TCL_DECLARED


	)

2978 
EXTERN
 
T˛_WideI¡
 
T˛_Tñl
 (
T˛_Ch™√l
 
ch™
);

2980 #i‚de‡
T˛_Ch™√lWideSìkProc_TCL_DECLARED


2981 
	#T˛_Ch™√lWideSìkProc_TCL_DECLARED


	)

2983 
EXTERN
 
T˛_DrivîWideSìkProc
 * 
T˛_Ch™√lWideSìkProc
 (

2984 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

2986 #i‚de‡
T˛_Di˘ObjPut_TCL_DECLARED


2987 
	#T˛_Di˘ObjPut_TCL_DECLARED


	)

2989 
EXTERN
 
T˛_Di˘ObjPut
 (
T˛_I¡îp
 * 
öãΩ
,

2990 
T˛_Obj
 * 
di˘På
, T˛_Obj * 
keyPå
,

2991 
T˛_Obj
 * 
vÆuePå
);

2993 #i‚de‡
T˛_Di˘ObjGë_TCL_DECLARED


2994 
	#T˛_Di˘ObjGë_TCL_DECLARED


	)

2996 
EXTERN
 
T˛_Di˘ObjGë
 (
T˛_I¡îp
 * 
öãΩ
,

2997 
T˛_Obj
 * 
di˘På
, T˛_Obj * 
keyPå
,

2998 
T˛_Obj
 ** 
vÆuePåPå
);

3000 #i‚de‡
T˛_Di˘ObjRemove_TCL_DECLARED


3001 
	#T˛_Di˘ObjRemove_TCL_DECLARED


	)

3003 
EXTERN
 
T˛_Di˘ObjRemove
 (
T˛_I¡îp
 * 
öãΩ
,

3004 
T˛_Obj
 * 
di˘På
, T˛_Obj * 
keyPå
);

3006 #i‚de‡
T˛_Di˘ObjSize_TCL_DECLARED


3007 
	#T˛_Di˘ObjSize_TCL_DECLARED


	)

3009 
EXTERN
 
T˛_Di˘ObjSize
 (
T˛_I¡îp
 * 
öãΩ
,

3010 
T˛_Obj
 * 
di˘På
, * 
sizePå
);

3012 #i‚de‡
T˛_Di˘ObjFú°_TCL_DECLARED


3013 
	#T˛_Di˘ObjFú°_TCL_DECLARED


	)

3015 
EXTERN
 
T˛_Di˘ObjFú°
 (
T˛_I¡îp
 * 
öãΩ
,

3016 
T˛_Obj
 * 
di˘På
,

3017 
T˛_Di˘Sórch
 * 
£¨chPå
,

3018 
T˛_Obj
 ** 
keyPåPå
, T˛_Obj ** 
vÆuePåPå
,

3019 * 
d⁄ePå
);

3021 #i‚de‡
T˛_Di˘ObjNext_TCL_DECLARED


3022 
	#T˛_Di˘ObjNext_TCL_DECLARED


	)

3024 
EXTERN
 
T˛_Di˘ObjNext
 (
T˛_Di˘Sórch
 * 
£¨chPå
,

3025 
T˛_Obj
 ** 
keyPåPå
, T˛_Obj ** 
vÆuePåPå
,

3026 * 
d⁄ePå
);

3028 #i‚de‡
T˛_Di˘ObjD⁄e_TCL_DECLARED


3029 
	#T˛_Di˘ObjD⁄e_TCL_DECLARED


	)

3031 
EXTERN
 
T˛_Di˘ObjD⁄e
 (
T˛_Di˘Sórch
 * 
£¨chPå
);

3033 #i‚de‡
T˛_Di˘ObjPutKeyLi°_TCL_DECLARED


3034 
	#T˛_Di˘ObjPutKeyLi°_TCL_DECLARED


	)

3036 
EXTERN
 
T˛_Di˘ObjPutKeyLi°
 (
T˛_I¡îp
 * 
öãΩ
,

3037 
T˛_Obj
 * 
di˘På
, 
keyc
,

3038 
T˛_Obj
 *
CONST
 * 
keyv
, T˛_Obj * 
vÆuePå
);

3040 #i‚de‡
T˛_Di˘ObjRemoveKeyLi°_TCL_DECLARED


3041 
	#T˛_Di˘ObjRemoveKeyLi°_TCL_DECLARED


	)

3043 
EXTERN
 
T˛_Di˘ObjRemoveKeyLi°
 (
T˛_I¡îp
 * 
öãΩ
,

3044 
T˛_Obj
 * 
di˘På
, 
keyc
,

3045 
T˛_Obj
 *
CONST
 * 
keyv
);

3047 #i‚de‡
T˛_NewDi˘Obj_TCL_DECLARED


3048 
	#T˛_NewDi˘Obj_TCL_DECLARED


	)

3050 
EXTERN
 
T˛_Obj
 * 
T˛_NewDi˘Obj
 ();

3052 #i‚de‡
T˛_DbNewDi˘Obj_TCL_DECLARED


3053 
	#T˛_DbNewDi˘Obj_TCL_DECLARED


	)

3055 
EXTERN
 
T˛_Obj
 * 
T˛_DbNewDi˘Obj
 (
CONST
 * 
fûe
, 
löe
);

3057 #i‚de‡
T˛_Regi°îC⁄fig_TCL_DECLARED


3058 
	#T˛_Regi°îC⁄fig_TCL_DECLARED


	)

3060 
EXTERN
 
T˛_Regi°îC⁄fig
 (
T˛_I¡îp
* 
öãΩ
,

3061 
CONST
 * 
pkgName
,

3062 
T˛_C⁄fig
* 
c⁄figuøti⁄
,

3063 
CONST
 * 
vÆEncodög
);

3065 #i‚de‡
T˛_Cª©eName•a˚_TCL_DECLARED


3066 
	#T˛_Cª©eName•a˚_TCL_DECLARED


	)

3068 
EXTERN
 
T˛_Name•a˚
 * 
T˛_Cª©eName•a˚
 (
T˛_I¡îp
 * 
öãΩ
,

3069 
CONST
 * 
«me
, 
Clõ¡D©a
 
˛õ¡D©a
,

3070 
T˛_Name•a˚DñëeProc
 * 
dñëeProc
);

3072 #i‚de‡
T˛_DñëeName•a˚_TCL_DECLARED


3073 
	#T˛_DñëeName•a˚_TCL_DECLARED


	)

3075 
EXTERN
 
T˛_DñëeName•a˚
 (
T˛_Name•a˚
 * 
nsPå
);

3077 #i‚de‡
T˛_AµídExp‹tLi°_TCL_DECLARED


3078 
	#T˛_AµídExp‹tLi°_TCL_DECLARED


	)

3080 
EXTERN
 
T˛_AµídExp‹tLi°
 (
T˛_I¡îp
 * 
öãΩ
,

3081 
T˛_Name•a˚
 * 
nsPå
, 
T˛_Obj
 * 
objPå
);

3083 #i‚de‡
T˛_Exp‹t_TCL_DECLARED


3084 
	#T˛_Exp‹t_TCL_DECLARED


	)

3086 
EXTERN
 
T˛_Exp‹t
 (
T˛_I¡îp
 * 
öãΩ
,

3087 
T˛_Name•a˚
 * 
nsPå
, 
CONST
 * 
∑âîn
,

3088 
ª£tLi°Fú°
);

3090 #i‚de‡
T˛_Imp‹t_TCL_DECLARED


3091 
	#T˛_Imp‹t_TCL_DECLARED


	)

3093 
EXTERN
 
T˛_Imp‹t
 (
T˛_I¡îp
 * 
öãΩ
,

3094 
T˛_Name•a˚
 * 
nsPå
, 
CONST
 * 
∑âîn
,

3095 
ÆlowOvîwrôe
);

3097 #i‚de‡
T˛_F‹gëImp‹t_TCL_DECLARED


3098 
	#T˛_F‹gëImp‹t_TCL_DECLARED


	)

3100 
EXTERN
 
T˛_F‹gëImp‹t
 (
T˛_I¡îp
 * 
öãΩ
,

3101 
T˛_Name•a˚
 * 
nsPå
, 
CONST
 * 
∑âîn
);

3103 #i‚de‡
T˛_GëCuºítName•a˚_TCL_DECLARED


3104 
	#T˛_GëCuºítName•a˚_TCL_DECLARED


	)

3106 
EXTERN
 
T˛_Name•a˚
 * 
T˛_GëCuºítName•a˚
 (
T˛_I¡îp
 * 
öãΩ
);

3108 #i‚de‡
T˛_GëGlobÆName•a˚_TCL_DECLARED


3109 
	#T˛_GëGlobÆName•a˚_TCL_DECLARED


	)

3111 
EXTERN
 
T˛_Name•a˚
 * 
T˛_GëGlobÆName•a˚
 (
T˛_I¡îp
 * 
öãΩ
);

3113 #i‚de‡
T˛_FödName•a˚_TCL_DECLARED


3114 
	#T˛_FödName•a˚_TCL_DECLARED


	)

3116 
EXTERN
 
T˛_Name•a˚
 * 
T˛_FödName•a˚
 (
T˛_I¡îp
 * 
öãΩ
,

3117 
CONST
 * 
«me
,

3118 
T˛_Name•a˚
 * 
c⁄ãxtNsPå
, 
Êags
);

3120 #i‚de‡
T˛_FödComm™d_TCL_DECLARED


3121 
	#T˛_FödComm™d_TCL_DECLARED


	)

3123 
EXTERN
 
T˛_Comm™d
 
T˛_FödComm™d
 (
T˛_I¡îp
 * 
öãΩ
,

3124 
CONST
 * 
«me
,

3125 
T˛_Name•a˚
 * 
c⁄ãxtNsPå
, 
Êags
);

3127 #i‚de‡
T˛_GëComm™dFromObj_TCL_DECLARED


3128 
	#T˛_GëComm™dFromObj_TCL_DECLARED


	)

3130 
EXTERN
 
T˛_Comm™d
 
T˛_GëComm™dFromObj
 (
T˛_I¡îp
 * 
öãΩ
,

3131 
T˛_Obj
 * 
objPå
);

3133 #i‚de‡
T˛_GëComm™dFuŒName_TCL_DECLARED


3134 
	#T˛_GëComm™dFuŒName_TCL_DECLARED


	)

3136 
EXTERN
 
T˛_GëComm™dFuŒName
 (
T˛_I¡îp
 * 
öãΩ
,

3137 
T˛_Comm™d
 
comm™d
, 
T˛_Obj
 * 
objPå
);

3139 #i‚de‡
T˛_FSEvÆFûeEx_TCL_DECLARED


3140 
	#T˛_FSEvÆFûeEx_TCL_DECLARED


	)

3142 
EXTERN
 
T˛_FSEvÆFûeEx
 (
T˛_I¡îp
 * 
öãΩ
,

3143 
T˛_Obj
 * 
fûeName
,

3144 
CONST
 * 
ícodögName
);

3146 #i‚de‡
T˛_SëExôProc_TCL_DECLARED


3147 
	#T˛_SëExôProc_TCL_DECLARED


	)

3149 
EXTERN
 
T˛_ExôProc
 * 
T˛_SëExôProc
 (T˛_ExôPro¯* 
¥oc
);

3151 #i‚de‡
T˛_LimôAddH™dÀr_TCL_DECLARED


3152 
	#T˛_LimôAddH™dÀr_TCL_DECLARED


	)

3154 
EXTERN
 
T˛_LimôAddH™dÀr
 (
T˛_I¡îp
 * 
öãΩ
, 
ty≥
,

3155 
T˛_LimôH™dÀrProc
 * 
h™dÀrProc
,

3156 
Clõ¡D©a
 
˛õ¡D©a
,

3157 
T˛_LimôH™dÀrDñëeProc
 * 
dñëeProc
);

3159 #i‚de‡
T˛_LimôRemoveH™dÀr_TCL_DECLARED


3160 
	#T˛_LimôRemoveH™dÀr_TCL_DECLARED


	)

3162 
EXTERN
 
T˛_LimôRemoveH™dÀr
 (
T˛_I¡îp
 * 
öãΩ
,

3163 
ty≥
, 
T˛_LimôH™dÀrProc
 * 
h™dÀrProc
,

3164 
Clõ¡D©a
 
˛õ¡D©a
);

3166 #i‚de‡
T˛_LimôRódy_TCL_DECLARED


3167 
	#T˛_LimôRódy_TCL_DECLARED


	)

3169 
EXTERN
 
T˛_LimôRódy
 (
T˛_I¡îp
 * 
öãΩ
);

3171 #i‚de‡
T˛_LimôCheck_TCL_DECLARED


3172 
	#T˛_LimôCheck_TCL_DECLARED


	)

3174 
EXTERN
 
T˛_LimôCheck
 (
T˛_I¡îp
 * 
öãΩ
);

3176 #i‚de‡
T˛_LimôEx˚eded_TCL_DECLARED


3177 
	#T˛_LimôEx˚eded_TCL_DECLARED


	)

3179 
EXTERN
 
T˛_LimôEx˚eded
 (
T˛_I¡îp
 * 
öãΩ
);

3181 #i‚de‡
T˛_LimôSëComm™ds_TCL_DECLARED


3182 
	#T˛_LimôSëComm™ds_TCL_DECLARED


	)

3184 
EXTERN
 
T˛_LimôSëComm™ds
 (
T˛_I¡îp
 * 
öãΩ
,

3185 
comm™dLimô
);

3187 #i‚de‡
T˛_LimôSëTime_TCL_DECLARED


3188 
	#T˛_LimôSëTime_TCL_DECLARED


	)

3190 
EXTERN
 
T˛_LimôSëTime
 (
T˛_I¡îp
 * 
öãΩ
,

3191 
T˛_Time
 * 
timeLimôPå
);

3193 #i‚de‡
T˛_LimôSëGønuœrôy_TCL_DECLARED


3194 
	#T˛_LimôSëGønuœrôy_TCL_DECLARED


	)

3196 
EXTERN
 
T˛_LimôSëGønuœrôy
 (
T˛_I¡îp
 * 
öãΩ
,

3197 
ty≥
, 
gønuœrôy
);

3199 #i‚de‡
T˛_LimôTy≥E«bÀd_TCL_DECLARED


3200 
	#T˛_LimôTy≥E«bÀd_TCL_DECLARED


	)

3202 
EXTERN
 
T˛_LimôTy≥E«bÀd
 (
T˛_I¡îp
 * 
öãΩ
, 
ty≥
);

3204 #i‚de‡
T˛_LimôTy≥Ex˚eded_TCL_DECLARED


3205 
	#T˛_LimôTy≥Ex˚eded_TCL_DECLARED


	)

3207 
EXTERN
 
T˛_LimôTy≥Ex˚eded
 (
T˛_I¡îp
 * 
öãΩ
, 
ty≥
);

3209 #i‚de‡
T˛_LimôTy≥Së_TCL_DECLARED


3210 
	#T˛_LimôTy≥Së_TCL_DECLARED


	)

3212 
EXTERN
 
T˛_LimôTy≥Së
 (
T˛_I¡îp
 * 
öãΩ
, 
ty≥
);

3214 #i‚de‡
T˛_LimôTy≥Re£t_TCL_DECLARED


3215 
	#T˛_LimôTy≥Re£t_TCL_DECLARED


	)

3217 
EXTERN
 
T˛_LimôTy≥Re£t
 (
T˛_I¡îp
 * 
öãΩ
, 
ty≥
);

3219 #i‚de‡
T˛_LimôGëComm™ds_TCL_DECLARED


3220 
	#T˛_LimôGëComm™ds_TCL_DECLARED


	)

3222 
EXTERN
 
T˛_LimôGëComm™ds
 (
T˛_I¡îp
 * 
öãΩ
);

3224 #i‚de‡
T˛_LimôGëTime_TCL_DECLARED


3225 
	#T˛_LimôGëTime_TCL_DECLARED


	)

3227 
EXTERN
 
T˛_LimôGëTime
 (
T˛_I¡îp
 * 
öãΩ
,

3228 
T˛_Time
 * 
timeLimôPå
);

3230 #i‚de‡
T˛_LimôGëGønuœrôy_TCL_DECLARED


3231 
	#T˛_LimôGëGønuœrôy_TCL_DECLARED


	)

3233 
EXTERN
 
T˛_LimôGëGønuœrôy
 (
T˛_I¡îp
 * 
öãΩ
,

3234 
ty≥
);

3236 #i‚de‡
T˛_SaveI¡îpSèã_TCL_DECLARED


3237 
	#T˛_SaveI¡îpSèã_TCL_DECLARED


	)

3239 
EXTERN
 
T˛_I¡îpSèã
 
T˛_SaveI¡îpSèã
 (
T˛_I¡îp
 * 
öãΩ
, 
°©us
);

3241 #i‚de‡
T˛_Re°‹eI¡îpSèã_TCL_DECLARED


3242 
	#T˛_Re°‹eI¡îpSèã_TCL_DECLARED


	)

3244 
EXTERN
 
T˛_Re°‹eI¡îpSèã
 (
T˛_I¡îp
 * 
öãΩ
,

3245 
T˛_I¡îpSèã
 
°©e
);

3247 #i‚de‡
T˛_DisˇrdI¡îpSèã_TCL_DECLARED


3248 
	#T˛_DisˇrdI¡îpSèã_TCL_DECLARED


	)

3250 
EXTERN
 
T˛_DisˇrdI¡îpSèã
 (
T˛_I¡îpSèã
 
°©e
);

3252 #i‚de‡
T˛_SëRëu∫O±i⁄s_TCL_DECLARED


3253 
	#T˛_SëRëu∫O±i⁄s_TCL_DECLARED


	)

3255 
EXTERN
 
T˛_SëRëu∫O±i⁄s
 (
T˛_I¡îp
 * 
öãΩ
,

3256 
T˛_Obj
 * 
›ti⁄s
);

3258 #i‚de‡
T˛_GëRëu∫O±i⁄s_TCL_DECLARED


3259 
	#T˛_GëRëu∫O±i⁄s_TCL_DECLARED


	)

3261 
EXTERN
 
T˛_Obj
 * 
T˛_GëRëu∫O±i⁄s
 (
T˛_I¡îp
 * 
öãΩ
,

3262 
ªsu…
);

3264 #i‚de‡
T˛_IsEn£mbÀ_TCL_DECLARED


3265 
	#T˛_IsEn£mbÀ_TCL_DECLARED


	)

3267 
EXTERN
 
T˛_IsEn£mbÀ
 (
T˛_Comm™d
 
tokí
);

3269 #i‚de‡
T˛_Cª©eEn£mbÀ_TCL_DECLARED


3270 
	#T˛_Cª©eEn£mbÀ_TCL_DECLARED


	)

3272 
EXTERN
 
T˛_Comm™d
 
T˛_Cª©eEn£mbÀ
 (
T˛_I¡îp
 * 
öãΩ
,

3273 
CONST
 * 
«me
,

3274 
T˛_Name•a˚
 * 
«me•a˚På
, 
Êags
);

3276 #i‚de‡
T˛_FödEn£mbÀ_TCL_DECLARED


3277 
	#T˛_FödEn£mbÀ_TCL_DECLARED


	)

3279 
EXTERN
 
T˛_Comm™d
 
T˛_FödEn£mbÀ
 (
T˛_I¡îp
 * 
öãΩ
,

3280 
T˛_Obj
 * 
cmdNameObj
, 
Êags
);

3282 #i‚de‡
T˛_SëEn£mbÀSubcomm™dLi°_TCL_DECLARED


3283 
	#T˛_SëEn£mbÀSubcomm™dLi°_TCL_DECLARED


	)

3285 
EXTERN
 
T˛_SëEn£mbÀSubcomm™dLi°
 (
T˛_I¡îp
 * 
öãΩ
,

3286 
T˛_Comm™d
 
tokí
, 
T˛_Obj
 * 
subcmdLi°
);

3288 #i‚de‡
T˛_SëEn£mbÀM≠pögDi˘_TCL_DECLARED


3289 
	#T˛_SëEn£mbÀM≠pögDi˘_TCL_DECLARED


	)

3291 
EXTERN
 
T˛_SëEn£mbÀM≠pögDi˘
 (
T˛_I¡îp
 * 
öãΩ
,

3292 
T˛_Comm™d
 
tokí
, 
T˛_Obj
 * 
m≠Di˘
);

3294 #i‚de‡
T˛_SëEn£mbÀUnknownH™dÀr_TCL_DECLARED


3295 
	#T˛_SëEn£mbÀUnknownH™dÀr_TCL_DECLARED


	)

3297 
EXTERN
 
T˛_SëEn£mbÀUnknownH™dÀr
 (
T˛_I¡îp
 * 
öãΩ
,

3298 
T˛_Comm™d
 
tokí
, 
T˛_Obj
 * 
unknownLi°
);

3300 #i‚de‡
T˛_SëEn£mbÀFœgs_TCL_DECLARED


3301 
	#T˛_SëEn£mbÀFœgs_TCL_DECLARED


	)

3303 
EXTERN
 
T˛_SëEn£mbÀFœgs
 (
T˛_I¡îp
 * 
öãΩ
,

3304 
T˛_Comm™d
 
tokí
, 
Êags
);

3306 #i‚de‡
T˛_GëEn£mbÀSubcomm™dLi°_TCL_DECLARED


3307 
	#T˛_GëEn£mbÀSubcomm™dLi°_TCL_DECLARED


	)

3309 
EXTERN
 
T˛_GëEn£mbÀSubcomm™dLi°
 (
T˛_I¡îp
 * 
öãΩ
,

3310 
T˛_Comm™d
 
tokí
, 
T˛_Obj
 ** 
subcmdLi°På
);

3312 #i‚de‡
T˛_GëEn£mbÀM≠pögDi˘_TCL_DECLARED


3313 
	#T˛_GëEn£mbÀM≠pögDi˘_TCL_DECLARED


	)

3315 
EXTERN
 
T˛_GëEn£mbÀM≠pögDi˘
 (
T˛_I¡îp
 * 
öãΩ
,

3316 
T˛_Comm™d
 
tokí
, 
T˛_Obj
 ** 
m≠Di˘På
);

3318 #i‚de‡
T˛_GëEn£mbÀUnknownH™dÀr_TCL_DECLARED


3319 
	#T˛_GëEn£mbÀUnknownH™dÀr_TCL_DECLARED


	)

3321 
EXTERN
 
T˛_GëEn£mbÀUnknownH™dÀr
 (
T˛_I¡îp
 * 
öãΩ
,

3322 
T˛_Comm™d
 
tokí
, 
T˛_Obj
 ** 
unknownLi°På
);

3324 #i‚de‡
T˛_GëEn£mbÀFœgs_TCL_DECLARED


3325 
	#T˛_GëEn£mbÀFœgs_TCL_DECLARED


	)

3327 
EXTERN
 
T˛_GëEn£mbÀFœgs
 (
T˛_I¡îp
 * 
öãΩ
,

3328 
T˛_Comm™d
 
tokí
, * 
ÊagsPå
);

3330 #i‚de‡
T˛_GëEn£mbÀName•a˚_TCL_DECLARED


3331 
	#T˛_GëEn£mbÀName•a˚_TCL_DECLARED


	)

3333 
EXTERN
 
T˛_GëEn£mbÀName•a˚
 (
T˛_I¡îp
 * 
öãΩ
,

3334 
T˛_Comm™d
 
tokí
,

3335 
T˛_Name•a˚
 ** 
«me•a˚PåPå
);

3337 #i‚de‡
T˛_SëTimeProc_TCL_DECLARED


3338 
	#T˛_SëTimeProc_TCL_DECLARED


	)

3340 
EXTERN
 
T˛_SëTimeProc
 (
T˛_GëTimeProc
* 
gëProc
,

3341 
T˛_SˇÀTimeProc
* 
sˇÀProc
,

3342 
Clõ¡D©a
 
˛õ¡D©a
);

3344 #i‚de‡
T˛_QuîyTimeProc_TCL_DECLARED


3345 
	#T˛_QuîyTimeProc_TCL_DECLARED


	)

3347 
EXTERN
 
T˛_QuîyTimeProc
 (
T˛_GëTimeProc
** 
gëProc
,

3348 
T˛_SˇÀTimeProc
** 
sˇÀProc
,

3349 
Clõ¡D©a
* 
˛õ¡D©a
);

3351 #i‚de‡
T˛_Ch™√lThªadA˘i⁄Proc_TCL_DECLARED


3352 
	#T˛_Ch™√lThªadA˘i⁄Proc_TCL_DECLARED


	)

3354 
EXTERN
 
T˛_DrivîThªadA˘i⁄Proc
 * 
T˛_Ch™√lThªadA˘i⁄Proc
 (

3355 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

3357 #i‚de‡
T˛_NewBignumObj_TCL_DECLARED


3358 
	#T˛_NewBignumObj_TCL_DECLARED


	)

3360 
EXTERN
 
T˛_Obj
* 
T˛_NewBignumObj
 (
mp_öt
* 
vÆue
);

3362 #i‚de‡
T˛_DbNewBignumObj_TCL_DECLARED


3363 
	#T˛_DbNewBignumObj_TCL_DECLARED


	)

3365 
EXTERN
 
T˛_Obj
* 
T˛_DbNewBignumObj
 (
mp_öt
* 
vÆue
, 
CONST
 * 
fûe
,

3366 
löe
);

3368 #i‚de‡
T˛_SëBignumObj_TCL_DECLARED


3369 
	#T˛_SëBignumObj_TCL_DECLARED


	)

3371 
EXTERN
 
T˛_SëBignumObj
 (
T˛_Obj
* 
obj
, 
mp_öt
* 
vÆue
);

3373 #i‚de‡
T˛_GëBignumFromObj_TCL_DECLARED


3374 
	#T˛_GëBignumFromObj_TCL_DECLARED


	)

3376 
EXTERN
 
T˛_GëBignumFromObj
 (
T˛_I¡îp
* 
öãΩ
,

3377 
T˛_Obj
* 
obj
, 
mp_öt
* 
vÆue
);

3379 #i‚de‡
T˛_TakeBignumFromObj_TCL_DECLARED


3380 
	#T˛_TakeBignumFromObj_TCL_DECLARED


	)

3382 
EXTERN
 
T˛_TakeBignumFromObj
 (
T˛_I¡îp
* 
öãΩ
,

3383 
T˛_Obj
* 
obj
, 
mp_öt
* 
vÆue
);

3385 #i‚de‡
T˛_TrunˇãCh™√l_TCL_DECLARED


3386 
	#T˛_TrunˇãCh™√l_TCL_DECLARED


	)

3388 
EXTERN
 
T˛_TrunˇãCh™√l
 (
T˛_Ch™√l
 
ch™
,

3389 
T˛_WideI¡
 
Àngth
);

3391 #i‚de‡
T˛_Ch™√lTrunˇãProc_TCL_DECLARED


3392 
	#T˛_Ch™√lTrunˇãProc_TCL_DECLARED


	)

3394 
EXTERN
 
T˛_DrivîTrunˇãProc
 * 
T˛_Ch™√lTrunˇãProc
 (

3395 
CONST
 
T˛_Ch™√lTy≥
 * 
ch™Ty≥På
);

3397 #i‚de‡
T˛_SëCh™√lEº‹I¡îp_TCL_DECLARED


3398 
	#T˛_SëCh™√lEº‹I¡îp_TCL_DECLARED


	)

3400 
EXTERN
 
T˛_SëCh™√lEº‹I¡îp
 (
T˛_I¡îp
* 
öãΩ
,

3401 
T˛_Obj
* 
msg
);

3403 #i‚de‡
T˛_GëCh™√lEº‹I¡îp_TCL_DECLARED


3404 
	#T˛_GëCh™√lEº‹I¡îp_TCL_DECLARED


	)

3406 
EXTERN
 
T˛_GëCh™√lEº‹I¡îp
 (
T˛_I¡îp
* 
öãΩ
,

3407 
T˛_Obj
** 
msg
);

3409 #i‚de‡
T˛_SëCh™√lEº‹_TCL_DECLARED


3410 
	#T˛_SëCh™√lEº‹_TCL_DECLARED


	)

3412 
EXTERN
 
T˛_SëCh™√lEº‹
 (
T˛_Ch™√l
 
ch™
, 
T˛_Obj
* 
msg
);

3414 #i‚de‡
T˛_GëCh™√lEº‹_TCL_DECLARED


3415 
	#T˛_GëCh™√lEº‹_TCL_DECLARED


	)

3417 
EXTERN
 
T˛_GëCh™√lEº‹
 (
T˛_Ch™√l
 
ch™
, 
T˛_Obj
** 
msg
);

3419 #i‚de‡
T˛_InôBignumFromDoubÀ_TCL_DECLARED


3420 
	#T˛_InôBignumFromDoubÀ_TCL_DECLARED


	)

3422 
EXTERN
 
T˛_InôBignumFromDoubÀ
 (
T˛_I¡îp
* 
öãΩ
,

3423 
öôvÆ
, 
mp_öt
 * 
toInô
);

3425 #i‚de‡
T˛_GëName•a˚UnknownH™dÀr_TCL_DECLARED


3426 
	#T˛_GëName•a˚UnknownH™dÀr_TCL_DECLARED


	)

3428 
EXTERN
 
T˛_Obj
 * 
T˛_GëName•a˚UnknownH™dÀr
 (
T˛_I¡îp
 * 
öãΩ
,

3429 
T˛_Name•a˚
 * 
nsPå
);

3431 #i‚de‡
T˛_SëName•a˚UnknownH™dÀr_TCL_DECLARED


3432 
	#T˛_SëName•a˚UnknownH™dÀr_TCL_DECLARED


	)

3434 
EXTERN
 
T˛_SëName•a˚UnknownH™dÀr
 (
T˛_I¡îp
 * 
öãΩ
,

3435 
T˛_Name•a˚
 * 
nsPå
, 
T˛_Obj
 * 
h™dÀrPå
);

3437 #i‚de‡
T˛_GëEncodögFromObj_TCL_DECLARED


3438 
	#T˛_GëEncodögFromObj_TCL_DECLARED


	)

3440 
EXTERN
 
T˛_GëEncodögFromObj
 (
T˛_I¡îp
* 
öãΩ
,

3441 
T˛_Obj
* 
objPå
, 
T˛_Encodög
* 
ícodögPå
);

3443 #i‚de‡
T˛_GëEncodögSórchP©h_TCL_DECLARED


3444 
	#T˛_GëEncodögSórchP©h_TCL_DECLARED


	)

3446 
EXTERN
 
T˛_Obj
* 
T˛_GëEncodögSórchP©h
 ();

3448 #i‚de‡
T˛_SëEncodögSórchP©h_TCL_DECLARED


3449 
	#T˛_SëEncodögSórchP©h_TCL_DECLARED


	)

3451 
EXTERN
 
T˛_SëEncodögSórchP©h
 (
T˛_Obj
* 
£¨chP©h
);

3453 #i‚de‡
T˛_GëEncodögNameFromEnvú⁄mít_TCL_DECLARED


3454 
	#T˛_GëEncodögNameFromEnvú⁄mít_TCL_DECLARED


	)

3456 
EXTERN
 
CONST
 * 
T˛_GëEncodögNameFromEnvú⁄mít
 (

3457 
T˛_DSåög
* 
bufPå
);

3459 #i‚de‡
T˛_PkgRequúeProc_TCL_DECLARED


3460 
	#T˛_PkgRequúeProc_TCL_DECLARED


	)

3462 
EXTERN
 
T˛_PkgRequúeProc
 (
T˛_I¡îp
 * 
öãΩ
,

3463 
CONST
 * 
«me
, 
objc
,

3464 
T˛_Obj
 *
CONST
 
objv
[],

3465 
Clõ¡D©a
 * 
˛õ¡D©aPå
);

3467 #i‚de‡
T˛_AµídObjToEº‹Info_TCL_DECLARED


3468 
	#T˛_AµídObjToEº‹Info_TCL_DECLARED


	)

3470 
EXTERN
 
T˛_AµídObjToEº‹Info
 (
T˛_I¡îp
 * 
öãΩ
,

3471 
T˛_Obj
 * 
objPå
);

3473 #i‚de‡
T˛_AµídLimôedToObj_TCL_DECLARED


3474 
	#T˛_AµídLimôedToObj_TCL_DECLARED


	)

3476 
EXTERN
 
T˛_AµídLimôedToObj
 (
T˛_Obj
 * 
objPå
,

3477 
CONST
 * 
byãs
, 
Àngth
, 
limô
,

3478 
CONST
 * 
ñlùsis
);

3480 #i‚de‡
T˛_F‹m©_TCL_DECLARED


3481 
	#T˛_F‹m©_TCL_DECLARED


	)

3483 
EXTERN
 
T˛_Obj
 * 
T˛_F‹m©
 (
T˛_I¡îp
 * 
öãΩ
, 
CONST
 * 
f‹m©
,

3484 
objc
, 
T˛_Obj
 * 
CONST
 
objv
[]);

3486 #i‚de‡
T˛_AµídF‹m©ToObj_TCL_DECLARED


3487 
	#T˛_AµídF‹m©ToObj_TCL_DECLARED


	)

3489 
EXTERN
 
T˛_AµídF‹m©ToObj
 (
T˛_I¡îp
 * 
öãΩ
,

3490 
T˛_Obj
 * 
objPå
, 
CONST
 * 
f‹m©
,

3491 
objc
, 
T˛_Obj
 * 
CONST
 
objv
[]);

3493 #i‚de‡
T˛_ObjPrötf_TCL_DECLARED


3494 
	#T˛_ObjPrötf_TCL_DECLARED


	)

3496 
EXTERN
 
T˛_Obj
 * 
T˛_ObjPrötf
 (
CONST
 * 
f‹m©
, ...);

3498 #i‚de‡
T˛_AµídPrötfToObj_TCL_DECLARED


3499 
	#T˛_AµídPrötfToObj_TCL_DECLARED


	)

3501 
EXTERN
 
T˛_AµídPrötfToObj
 (
T˛_Obj
 * 
objPå
,

3502 
CONST
 * 
f‹m©
, ...);

3505 
	sT˛StubHooks
 {

3506 
T˛PœtStubs
 *
	mt˛PœtStubs
;

3507 
T˛I¡Stubs
 *
	mt˛I¡Stubs
;

3508 
T˛I¡PœtStubs
 *
	mt˛I¡PœtStubs
;

3509 } 
	tT˛StubHooks
;

3511 
	sT˛Stubs
 {

3512 
	mmagic
;

3513 
T˛StubHooks
 *
	mhooks
;

3515 (*
	mt˛_PkgProvideEx
Ë(
T˛_I¡îp
* 
	möãΩ
, 
CONST
 * 
	m«me
, CONST * 
	mvîsi⁄
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3516 
CONST84_RETURN
 * (*
	mt˛_PkgRequúeEx
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, CONST * 
	mvîsi⁄
, 
	mexa˘
, 
Clõ¡D©a
 * 
	m˛õ¡D©aPå
);

3517 (*
	mt˛_P™ic
Ë(
CONST
 * 
	mf‹m©
, ...);

3518 * (*
	mt˛_AŒoc
Ë(
	msize
);

3519 (*
	mt˛_Fªe
Ë(* 
	m±r
);

3520 * (*
	mt˛_RóŒoc
Ë(* 
	m±r
, 
	msize
);

3521 * (*
	mt˛_DbCkÆloc
Ë(
	msize
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3522 (*
	mt˛_DbCk‰ì
Ë(* 
	m±r
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3523 * (*
	mt˛_DbCkªÆloc
Ë(* 
	m±r
, 
	msize
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3524 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

3525 (*
	mt˛_Cª©eFûeH™dÀr
Ë(
	mfd
, 
	mmask
, 
T˛_FûeProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3527 #ifde‡
__WIN32__


3528 *
	mª£rved9
;

3530 #ifde‡
MAC_OSX_TCL


3531 (*
	mt˛_Cª©eFûeH™dÀr
Ë(
	mfd
, 
	mmask
, 
T˛_FûeProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3533 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

3534 (*
	mt˛_DñëeFûeH™dÀr
Ë(
	mfd
);

3536 #ifde‡
__WIN32__


3537 *
	mª£rved10
;

3539 #ifde‡
MAC_OSX_TCL


3540 (*
	mt˛_DñëeFûeH™dÀr
Ë(
	mfd
);

3542 (*
	mt˛_SëTimî
Ë(
T˛_Time
 * 
	mtimePå
);

3543 (*
	mt˛_SÀï
Ë(
	mms
);

3544 (*
	mt˛_WaôF‹Evít
Ë(
T˛_Time
 * 
	mtimePå
);

3545 (*
	mt˛_AµídAŒObjTy≥s
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
);

3546 (*
	mt˛_AµídSåögsToObj
Ë(
T˛_Obj
 * 
	mobjPå
, ...);

3547 (*
	mt˛_AµídToObj
Ë(
T˛_Obj
* 
	mobjPå
, 
CONST
 * 
	mbyãs
, 
	mÀngth
);

3548 
	mT˛_Obj
 * (*
	mt˛_C⁄ˇtObj
Ë(
	mobjc
, 
T˛_Obj
 *
CONST
 
	mobjv
[]);

3549 (*
	mt˛_C⁄vîtToTy≥
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, 
T˛_ObjTy≥
 * 
	mty≥På
);

3550 (*
	mt˛_DbDe¸RefCou¡
Ë(
T˛_Obj
 * 
	mobjPå
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3551 (*
	mt˛_DbIn¸RefCou¡
Ë(
T˛_Obj
 * 
	mobjPå
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3552 (*
	mt˛_DbIsSh¨ed
Ë(
T˛_Obj
 * 
	mobjPå
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3553 
	mT˛_Obj
 * (*
	mt˛_DbNewBoﬁónObj
Ë(
	mboﬁVÆue
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3554 
	mT˛_Obj
 * (*
	mt˛_DbNewByãAºayObj
Ë(
CONST
 * 
	mbyãs
, 
	mÀngth
, CONST * 
	mfûe
, 
	mlöe
);

3555 
	mT˛_Obj
 * (*
	mt˛_DbNewDoubÀObj
Ë(
	mdoubÀVÆue
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3556 
	mT˛_Obj
 * (*
	mt˛_DbNewLi°Obj
Ë(
	mobjc
, 
T˛_Obj
 *
CONST
 * 
	mobjv
, CONST * 
	mfûe
, 
	mlöe
);

3557 
	mT˛_Obj
 * (*
	mt˛_DbNewL⁄gObj
Ë(
	ml⁄gVÆue
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3558 
	mT˛_Obj
 * (*
	mt˛_DbNewObj
Ë(
CONST
 * 
	mfûe
, 
	mlöe
);

3559 
	mT˛_Obj
 * (*
	mt˛_DbNewSåögObj
Ë(
CONST
 * 
	mbyãs
, 
	mÀngth
, CONST * 
	mfûe
, 
	mlöe
);

3560 
	mT˛_Obj
 * (*
	mt˛_Du∂iˇãObj
Ë(
T˛_Obj
 * 
	mobjPå
);

3561 (*
	mt˛FªeObj
Ë(
T˛_Obj
 * 
	mobjPå
);

3562 (*
	mt˛_GëBoﬁón
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m§c
, * 
	mboﬁPå
);

3563 (*
	mt˛_GëBoﬁónFromObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, * 
	mboﬁPå
);

3564 * (*
	mt˛_GëByãAºayFromObj
Ë(
T˛_Obj
 * 
	mobjPå
, * 
	mÀngthPå
);

3565 (*
	mt˛_GëDoubÀ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m§c
, * 
	mdoubÀPå
);

3566 (*
	mt˛_GëDoubÀFromObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, * 
	mdoubÀPå
);

3567 (*
	mt˛_GëIndexFromObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, 
CONST84
 ** 
	mèbÀPå
, 
CONST
 * 
	mmsg
, 
	mÊags
, * 
	mödexPå
);

3568 (*
	mt˛_GëI¡
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m§c
, * 
	mötPå
);

3569 (*
	mt˛_GëI¡FromObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, * 
	mötPå
);

3570 (*
	mt˛_GëL⁄gFromObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, * 
	ml⁄gPå
);

3571 
	mT˛_ObjTy≥
 * (*
	mt˛_GëObjTy≥
Ë(
CONST
 * 
	mty≥Name
);

3572 * (*
	mt˛_GëSåögFromObj
Ë(
T˛_Obj
 * 
	mobjPå
, * 
	mÀngthPå
);

3573 (*
	mt˛_InvÆid©eSåögRï
Ë(
T˛_Obj
 * 
	mobjPå
);

3574 (*
	mt˛_Li°ObjAµídLi°
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mli°På
, T˛_Obj * 
	mñemLi°På
);

3575 (*
	mt˛_Li°ObjAµídEÀmít
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mli°På
, T˛_Obj * 
	mobjPå
);

3576 (*
	mt˛_Li°ObjGëEÀmíts
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mli°På
, * 
	mobjcPå
, T˛_Obj *** 
	mobjvPå
);

3577 (*
	mt˛_Li°ObjIndex
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mli°På
, 
	mödex
, T˛_Obj ** 
	mobjPåPå
);

3578 (*
	mt˛_Li°ObjLígth
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mli°På
, * 
	mÀngthPå
);

3579 (*
	mt˛_Li°ObjRïœ˚
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mli°På
, 
	mfú°
, 
	mcou¡
, 
	mobjc
, T˛_Obj *
CONST
 
	mobjv
[]);

3580 
	mT˛_Obj
 * (*
	mt˛_NewBoﬁónObj
Ë(
	mboﬁVÆue
);

3581 
	mT˛_Obj
 * (*
	mt˛_NewByãAºayObj
Ë(
CONST
 * 
	mbyãs
, 
	mÀngth
);

3582 
	mT˛_Obj
 * (*
	mt˛_NewDoubÀObj
Ë(
	mdoubÀVÆue
);

3583 
	mT˛_Obj
 * (*
	mt˛_NewI¡Obj
Ë(
	mötVÆue
);

3584 
	mT˛_Obj
 * (*
	mt˛_NewLi°Obj
Ë(
	mobjc
, 
T˛_Obj
 *
CONST
 
	mobjv
[]);

3585 
	mT˛_Obj
 * (*
	mt˛_NewL⁄gObj
Ë(
	ml⁄gVÆue
);

3586 
	mT˛_Obj
 * (*
	mt˛_NewObj
) ();

3587 
	mT˛_Obj
 * (*
	mt˛_NewSåögObj
Ë(
CONST
 * 
	mbyãs
, 
	mÀngth
);

3588 (*
	mt˛_SëBoﬁónObj
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mboﬁVÆue
);

3589 * (*
	mt˛_SëByãAºayLígth
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mÀngth
);

3590 (*
	mt˛_SëByãAºayObj
Ë(
T˛_Obj
 * 
	mobjPå
, 
CONST
 * 
	mbyãs
, 
	mÀngth
);

3591 (*
	mt˛_SëDoubÀObj
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mdoubÀVÆue
);

3592 (*
	mt˛_SëI¡Obj
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mötVÆue
);

3593 (*
	mt˛_SëLi°Obj
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mobjc
, T˛_Obj *
CONST
 
	mobjv
[]);

3594 (*
	mt˛_SëL⁄gObj
Ë(
T˛_Obj
 * 
	mobjPå
, 
	ml⁄gVÆue
);

3595 (*
	mt˛_SëObjLígth
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mÀngth
);

3596 (*
	mt˛_SëSåögObj
Ë(
T˛_Obj
* 
	mobjPå
, 
CONST
 * 
	mbyãs
, 
	mÀngth
);

3597 (*
	mt˛_AddEº‹Info
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mmesßge
);

3598 (*
	mt˛_AddObjEº‹Info
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mmesßge
, 
	mÀngth
);

3599 (*
	mt˛_AŒowEx˚±i⁄s
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3600 (*
	mt˛_AµídEÀmít
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mñemít
);

3601 (*
	mt˛_AµídResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
, ...);

3602 
T˛_AsyncH™dÀr
 (*
t˛_AsyncCª©e
Ë(
T˛_AsyncProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3603 (*
	mt˛_AsyncDñëe
Ë(
T˛_AsyncH™dÀr
 
	masync
);

3604 (*
	mt˛_AsyncInvoke
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mcode
);

3605 (*
	mt˛_AsyncM¨k
Ë(
T˛_AsyncH™dÀr
 
	masync
);

3606 (*
	mt˛_AsyncRódy
) ();

3607 (*
	mt˛_BackgroundEº‹
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3608 (*
	mt˛_Back¶ash
Ë(
CONST
 * 
	m§c
, * 
	mªadPå
);

3609 (*
	mt˛_BadCh™√lO±i⁄
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m›ti⁄Name
, CONST * 
	m›ti⁄Li°
);

3610 (*
	mt˛_CÆlWhíDñëed
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_I¡îpDñëeProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3611 (*
	mt˛_C™˚lIdÀCÆl
Ë(
T˛_IdÀProc
 * 
	midÀProc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3612 (*
	mt˛_Clo£
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Ch™√l
 
	mch™
);

3613 (*
	mt˛_Comm™dCom∂ëe
Ë(
CONST
 * 
	mcmd
);

3614 * (*
	mt˛_C⁄ˇt
Ë(
	m¨gc
, 
CONST84
 * 
CONST
 * 
	m¨gv
);

3615 (*
	mt˛_C⁄vîtEÀmít
Ë(
CONST
 * 
	m§c
, * 
	md°
, 
	mÊags
);

3616 (*
	mt˛_C⁄vîtCou¡edEÀmít
Ë(
CONST
 * 
	m§c
, 
	mÀngth
, * 
	md°
, 
	mÊags
);

3617 (*
	mt˛_Cª©eAlüs
Ë(
T˛_I¡îp
 * 
	m¶ave
, 
CONST
 * 
	m¶aveCmd
, T˛_I¡î∞* 
	mèrgë
, CONST * 
	mèrgëCmd
, 
	m¨gc
, 
CONST84
 * CONST * 
	m¨gv
);

3618 (*
	mt˛_Cª©eAlüsObj
Ë(
T˛_I¡îp
 * 
	m¶ave
, 
CONST
 * 
	m¶aveCmd
, T˛_I¡î∞* 
	mèrgë
, CONST * 
	mèrgëCmd
, 
	mobjc
, 
T˛_Obj
 *CONST 
	mobjv
[]);

3619 
T˛_Ch™√l
 (*
t˛_Cª©eCh™√l
Ë(
T˛_Ch™√lTy≥
 * 
	mty≥På
, 
CONST
 * 
	mch™Name
, 
Clõ¡D©a
 
	mö°™˚D©a
, 
	mmask
);

3620 (*
	mt˛_Cª©eCh™√lH™dÀr
Ë(
T˛_Ch™√l
 
	mch™
, 
	mmask
, 
T˛_Ch™√lProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3621 (*
	mt˛_Cª©eClo£H™dÀr
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_Clo£Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3622 
T˛_Comm™d
 (*
t˛_Cª©eComm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mcmdName
, 
T˛_CmdProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
, 
T˛_CmdDñëeProc
 * 
	mdñëeProc
);

3623 (*
	mt˛_Cª©eEvítSour˚
Ë(
T˛_EvítSëupProc
 * 
	m£tupProc
, 
T˛_EvítCheckProc
 * 
	mcheckProc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3624 (*
	mt˛_Cª©eExôH™dÀr
Ë(
T˛_ExôProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3625 
	mT˛_I¡îp
 * (*
	mt˛_Cª©eI¡îp
) ();

3626 (*
	mt˛_Cª©eM©hFunc
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
	mnumArgs
, 
T˛_VÆueTy≥
 * 
	m¨gTy≥s
, 
T˛_M©hProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3627 
T˛_Comm™d
 (*
t˛_Cª©eObjComm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mcmdName
, 
T˛_ObjCmdProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
, 
T˛_CmdDñëeProc
 * 
	mdñëeProc
);

3628 
	mT˛_I¡îp
 * (*
	mt˛_Cª©eSœve
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m¶aveName
, 
	misSa„
);

3629 
T˛_TimîTokí
 (*
t˛_Cª©eTimîH™dÀr
Ë(
	mmûli£c⁄ds
, 
T˛_TimîProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3630 
T˛_Tø˚
 (*
t˛_Cª©eTø˚
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mÀvñ
, 
T˛_CmdTø˚Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3631 (*
	mt˛_DñëeAssocD©a
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
);

3632 (*
	mt˛_DñëeCh™√lH™dÀr
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_Ch™√lProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3633 (*
	mt˛_DñëeClo£H™dÀr
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_Clo£Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3634 (*
	mt˛_DñëeComm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mcmdName
);

3635 (*
	mt˛_DñëeComm™dFromTokí
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mcomm™d
);

3636 (*
	mt˛_DñëeEvíts
Ë(
T˛_EvítDñëeProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3637 (*
	mt˛_DñëeEvítSour˚
Ë(
T˛_EvítSëupProc
 * 
	m£tupProc
, 
T˛_EvítCheckProc
 * 
	mcheckProc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3638 (*
	mt˛_DñëeExôH™dÀr
Ë(
T˛_ExôProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3639 (*
	mt˛_DñëeHashE¡ry
Ë(
T˛_HashE¡ry
 * 
	míåyPå
);

3640 (*
	mt˛_DñëeHashTabÀ
Ë(
T˛_HashTabÀ
 * 
	mèbÀPå
);

3641 (*
	mt˛_DñëeI¡îp
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3642 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

3643 (*
	mt˛_DëachPids
Ë(
	mnumPids
, 
T˛_Pid
 * 
	mpidPå
);

3645 #ifde‡
__WIN32__


3646 (*
	mt˛_DëachPids
Ë(
	mnumPids
, 
T˛_Pid
 * 
	mpidPå
);

3648 #ifde‡
MAC_OSX_TCL


3649 (*
	mt˛_DëachPids
Ë(
	mnumPids
, 
T˛_Pid
 * 
	mpidPå
);

3651 (*
	mt˛_DñëeTimîH™dÀr
Ë(
T˛_TimîTokí
 
	mtokí
);

3652 (*
	mt˛_DñëeTø˚
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Tø˚
 
	måa˚
);

3653 (*
	mt˛_D⁄tCÆlWhíDñëed
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_I¡îpDñëeProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3654 (*
	mt˛_DoO√Evít
Ë(
	mÊags
);

3655 (*
	mt˛_DoWhíIdÀ
Ë(
T˛_IdÀProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3656 * (*
	mt˛_DSåögAµíd
Ë(
T˛_DSåög
 * 
	mdsPå
, 
CONST
 * 
	mbyãs
, 
	mÀngth
);

3657 * (*
	mt˛_DSåögAµídEÀmít
Ë(
T˛_DSåög
 * 
	mdsPå
, 
CONST
 * 
	mñemít
);

3658 (*
	mt˛_DSåögEndSubli°
Ë(
T˛_DSåög
 * 
	mdsPå
);

3659 (*
	mt˛_DSåögFªe
Ë(
T˛_DSåög
 * 
	mdsPå
);

3660 (*
	mt˛_DSåögGëResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_DSåög
 * 
	mdsPå
);

3661 (*
	mt˛_DSåögInô
Ë(
T˛_DSåög
 * 
	mdsPå
);

3662 (*
	mt˛_DSåögResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_DSåög
 * 
	mdsPå
);

3663 (*
	mt˛_DSåögSëLígth
Ë(
T˛_DSåög
 * 
	mdsPå
, 
	mÀngth
);

3664 (*
	mt˛_DSåögSèπSubli°
Ë(
T˛_DSåög
 * 
	mdsPå
);

3665 (*
	mt˛_Eof
Ë(
T˛_Ch™√l
 
	mch™
);

3666 
CONST84_RETURN
 * (*
	mt˛_EºnoId
) ();

3667 
CONST84_RETURN
 * (*
	mt˛_EºnoMsg
Ë(
	mîr
);

3668 (*
	mt˛_EvÆ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	ms¸ùt
);

3669 (*
	mt˛_EvÆFûe
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mfûeName
);

3670 (*
	mt˛_EvÆObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
);

3671 (*
	mt˛_EvítuÆlyFªe
Ë(
Clõ¡D©a
 
	m˛õ¡D©a
, 
T˛_FªeProc
 * 
	m‰ìProc
);

3672 (*
	mt˛_Exô
Ë(
	m°©us
);

3673 (*
	mt˛_Expo£Comm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mhiddíCmdTokí
, CONST * 
	mcmdName
);

3674 (*
	mt˛_Ex¥Boﬁón
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mex¥
, * 
	m±r
);

3675 (*
	mt˛_Ex¥BoﬁónObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, * 
	m±r
);

3676 (*
	mt˛_Ex¥DoubÀ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mex¥
, * 
	m±r
);

3677 (*
	mt˛_Ex¥DoubÀObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, * 
	m±r
);

3678 (*
	mt˛_Ex¥L⁄g
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mex¥
, * 
	m±r
);

3679 (*
	mt˛_Ex¥L⁄gObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, * 
	m±r
);

3680 (*
	mt˛_Ex¥Obj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, T˛_Obj ** 
	mªsu…PåPå
);

3681 (*
	mt˛_Ex¥Såög
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mex¥
);

3682 (*
	mt˛_FöÆize
) ();

3683 (*
	mt˛_FödExecuèbÀ
Ë(
CONST
 * 
	m¨gv0
);

3684 
	mT˛_HashE¡ry
 * (*
	mt˛_Fú°HashE¡ry
Ë(
T˛_HashTabÀ
 * 
	mèbÀPå
, 
T˛_HashSórch
 * 
	m£¨chPå
);

3685 (*
	mt˛_Flush
Ë(
T˛_Ch™√l
 
	mch™
);

3686 (*
	mt˛_FªeResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3687 (*
	mt˛_GëAlüs
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m¶aveCmd
, T˛_I¡î∞** 
	mèrgëI¡îpPå
, 
CONST84
 ** 
	mèrgëCmdPå
, * 
	m¨gcPå
, CONST84 *** 
	m¨gvPå
);

3688 (*
	mt˛_GëAlüsObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m¶aveCmd
, T˛_I¡î∞** 
	mèrgëI¡îpPå
, 
CONST84
 ** 
	mèrgëCmdPå
, * 
	mobjcPå
, 
T˛_Obj
 *** 
	mobjv
);

3689 
Clõ¡D©a
 (*
t˛_GëAssocD©a
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
T˛_I¡îpDñëeProc
 ** 
	m¥ocPå
);

3690 
T˛_Ch™√l
 (*
t˛_GëCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mch™Name
, * 
	mmodePå
);

3691 (*
	mt˛_GëCh™√lBuf„rSize
Ë(
T˛_Ch™√l
 
	mch™
);

3692 (*
	mt˛_GëCh™√lH™dÀ
Ë(
T˛_Ch™√l
 
	mch™
, 
	mdúe˘i⁄
, 
Clõ¡D©a
 * 
	mh™dÀPå
);

3693 
Clõ¡D©a
 (*
t˛_GëCh™√lIn°™˚D©a
Ë(
T˛_Ch™√l
 
	mch™
);

3694 (*
	mt˛_GëCh™√lMode
Ë(
T˛_Ch™√l
 
	mch™
);

3695 
CONST84_RETURN
 * (*
	mt˛_GëCh™√lName
Ë(
T˛_Ch™√l
 
	mch™
);

3696 (*
	mt˛_GëCh™√lO±i⁄
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Ch™√l
 
	mch™
, 
CONST
 * 
	m›ti⁄Name
, 
T˛_DSåög
 * 
	mdsPå
);

3697 
	mT˛_Ch™√lTy≥
 * (*
	mt˛_GëCh™√lTy≥
Ë(
T˛_Ch™√l
 
	mch™
);

3698 (*
	mt˛_GëComm™dInfo
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mcmdName
, 
T˛_CmdInfo
 * 
	möfoPå
);

3699 
CONST84_RETURN
 * (*
	mt˛_GëComm™dName
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mcomm™d
);

3700 (*
	mt˛_GëEºno
) ();

3701 
CONST84_RETURN
 * (*
	mt˛_GëHo°Name
) ();

3702 (*
	mt˛_GëI¡îpP©h
Ë(
T˛_I¡îp
 * 
	maskI¡îp
, T˛_I¡î∞* 
	m¶aveI¡îp
);

3703 
	mT˛_I¡îp
 * (*
	mt˛_GëMa°î
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3704 
CONST
 * (*
	mt˛_GëNameOfExecuèbÀ
) ();

3705 
	mT˛_Obj
 * (*
	mt˛_GëObjResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3706 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

3707 (*
	mt˛_GëO≥nFûe
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mch™ID
, 
	mf‹Wrôög
, 
	mcheckUßge
, 
Clõ¡D©a
 * 
	mfûePå
);

3709 #ifde‡
__WIN32__


3710 *
	mª£rved167
;

3712 #ifde‡
MAC_OSX_TCL


3713 (*
	mt˛_GëO≥nFûe
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mch™ID
, 
	mf‹Wrôög
, 
	mcheckUßge
, 
Clõ¡D©a
 * 
	mfûePå
);

3715 
T˛_P©hTy≥
 (*
t˛_GëP©hTy≥
Ë(
CONST
 * 
	m∑th
);

3716 (*
	mt˛_Gës
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_DSåög
 * 
	mdsPå
);

3717 (*
	mt˛_GësObj
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_Obj
 * 
	mobjPå
);

3718 (*
	mt˛_GëSîvi˚Mode
) ();

3719 
	mT˛_I¡îp
 * (*
	mt˛_GëSœve
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m¶aveName
);

3720 
T˛_Ch™√l
 (*
t˛_GëStdCh™√l
Ë(
	mty≥
);

3721 
CONST84_RETURN
 * (*
	mt˛_GëSåögResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3722 
CONST84_RETURN
 * (*
	mt˛_GëV¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, 
	mÊags
);

3723 
CONST84_RETURN
 * (*
	mt˛_GëV¨2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑π1
, CONST * 
	m∑π2
, 
	mÊags
);

3724 (*
	mt˛_GlobÆEvÆ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mcomm™d
);

3725 (*
	mt˛_GlobÆEvÆObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
);

3726 (*
	mt˛_HideComm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mcmdName
, CONST * 
	mhiddíCmdTokí
);

3727 (*
	mt˛_Inô
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3728 (*
	mt˛_InôHashTabÀ
Ë(
T˛_HashTabÀ
 * 
	mèbÀPå
, 
	mkeyTy≥
);

3729 (*
	mt˛_I≈utBlocked
Ë(
T˛_Ch™√l
 
	mch™
);

3730 (*
	mt˛_I≈utBuf„ªd
Ë(
T˛_Ch™√l
 
	mch™
);

3731 (*
	mt˛_I¡îpDñëed
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3732 (*
	mt˛_IsSa„
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3733 * (*
	mt˛_JoöP©h
Ë(
	m¨gc
, 
CONST84
 * 
CONST
 * 
	m¨gv
, 
T˛_DSåög
 * 
	mªsu…På
);

3734 (*
	mt˛_LökV¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, * 
	maddr
, 
	mty≥
);

3735 *
	mª£rved188
;

3736 
T˛_Ch™√l
 (*
t˛_MakeFûeCh™√l
Ë(
Clõ¡D©a
 
	mh™dÀ
, 
	mmode
);

3737 (*
	mt˛_MakeSa„
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3738 
T˛_Ch™√l
 (*
t˛_MakeT˝Clõ¡Ch™√l
Ë(
Clõ¡D©a
 
	mt˝Sockë
);

3739 * (*
	mt˛_Mîge
Ë(
	m¨gc
, 
CONST84
 * 
CONST
 * 
	m¨gv
);

3740 
	mT˛_HashE¡ry
 * (*
	mt˛_NextHashE¡ry
Ë(
T˛_HashSórch
 * 
	m£¨chPå
);

3741 (*
	mt˛_NŸifyCh™√l
Ë(
T˛_Ch™√l
 
	mch™√l
, 
	mmask
);

3742 
	mT˛_Obj
 * (*
	mt˛_ObjGëV¨2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	m∑π1På
, T˛_Obj * 
	m∑π2På
, 
	mÊags
);

3743 
	mT˛_Obj
 * (*
	mt˛_ObjSëV¨2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	m∑π1På
, T˛_Obj * 
	m∑π2På
, T˛_Obj * 
	m√wVÆuePå
, 
	mÊags
);

3744 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

3745 
T˛_Ch™√l
 (*
t˛_O≥nComm™dCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	m¨gc
, 
CONST84
 ** 
	m¨gv
, 
	mÊags
);

3747 #ifde‡
__WIN32__


3748 
T˛_Ch™√l
 (*
t˛_O≥nComm™dCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	m¨gc
, 
CONST84
 ** 
	m¨gv
, 
	mÊags
);

3750 #ifde‡
MAC_OSX_TCL


3751 
T˛_Ch™√l
 (*
t˛_O≥nComm™dCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	m¨gc
, 
CONST84
 ** 
	m¨gv
, 
	mÊags
);

3753 
T˛_Ch™√l
 (*
t˛_O≥nFûeCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mfûeName
, CONST * 
	mmodeSåög
, 
	m≥rmissi⁄s
);

3754 
T˛_Ch™√l
 (*
t˛_O≥nT˝Clõ¡
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mp‹t
, 
CONST
 * 
	maddªss
, CONST * 
	mmyaddr
, 
	mmyp‹t
, 
	masync
);

3755 
T˛_Ch™√l
 (*
t˛_O≥nT˝Sîvî
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mp‹t
, 
CONST
 * 
	mho°
, 
T˛_T˝Ac˚±Proc
 * 
	mac˚±Proc
, 
Clõ¡D©a
 
	mˇŒbackD©a
);

3756 (*
	mt˛_Pª£rve
Ë(
Clõ¡D©a
 
	md©a
);

3757 (*
	mt˛_PrötDoubÀ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mvÆue
, * 
	md°
);

3758 (*
	mt˛_PutEnv
Ë(
CONST
 * 
	massignmít
);

3759 
CONST84_RETURN
 * (*
	mt˛_PosixEº‹
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3760 (*
	mt˛_QueueEvít
Ë(
T˛_Evít
 * 
	mevPå
, 
T˛_QueuePosôi⁄
 
	mposôi⁄
);

3761 (*
	mt˛_Ród
Ë(
T˛_Ch™√l
 
	mch™
, * 
	mbufPå
, 
	mtoRód
);

3762 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

3763 (*
	mt˛_RópDëachedProcs
) ();

3765 #ifde‡
__WIN32__


3766 (*
	mt˛_RópDëachedProcs
) ();

3768 #ifde‡
MAC_OSX_TCL


3769 (*
	mt˛_RópDëachedProcs
) ();

3771 (*
	mt˛_Rec‹dAndEvÆ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mcmd
, 
	mÊags
);

3772 (*
	mt˛_Rec‹dAndEvÆObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mcmdPå
, 
	mÊags
);

3773 (*
	mt˛_Regi°îCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Ch™√l
 
	mch™
);

3774 (*
	mt˛_Regi°îObjTy≥
Ë(
T˛_ObjTy≥
 * 
	mty≥På
);

3775 
T˛_RegExp
 (*
t˛_RegExpCompûe
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑âîn
);

3776 (*
	mt˛_RegExpExec
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_RegExp
 
	mªgexp
, 
CONST
 * 
	mãxt
, CONST * 
	m°¨t
);

3777 (*
	mt˛_RegExpM©ch
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mãxt
, CONST * 
	m∑âîn
);

3778 (*
	mt˛_RegExpR™ge
Ë(
T˛_RegExp
 
	mªgexp
, 
	mödex
, 
CONST84
 ** 
	m°¨tPå
, CONST84 ** 
	mídPå
);

3779 (*
	mt˛_Rñó£
Ë(
Clõ¡D©a
 
	m˛õ¡D©a
);

3780 (*
	mt˛_Re£tResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3781 (*
	mt˛_SˇnEÀmít
Ë(
CONST
 * 
	m°r
, * 
	mÊagPå
);

3782 (*
	mt˛_SˇnCou¡edEÀmít
Ë(
CONST
 * 
	m°r
, 
	mÀngth
, * 
	mÊagPå
);

3783 (*
	mt˛_SìkOld
Ë(
T˛_Ch™√l
 
	mch™
, 
	moff£t
, 
	mmode
);

3784 (*
	mt˛_Sîvi˚AŒ
) ();

3785 (*
	mt˛_Sîvi˚Evít
Ë(
	mÊags
);

3786 (*
	mt˛_SëAssocD©a
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
T˛_I¡îpDñëeProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3787 (*
	mt˛_SëCh™√lBuf„rSize
Ë(
T˛_Ch™√l
 
	mch™
, 
	msz
);

3788 (*
	mt˛_SëCh™√lO±i⁄
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Ch™√l
 
	mch™
, 
CONST
 * 
	m›ti⁄Name
, CONST * 
	m√wVÆue
);

3789 (*
	mt˛_SëComm™dInfo
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mcmdName
, CONST 
T˛_CmdInfo
 * 
	möfoPå
);

3790 (*
	mt˛_SëEºno
Ë(
	mîr
);

3791 (*
	mt˛_SëEº‹Code
Ë(
T˛_I¡îp
 * 
	möãΩ
, ...);

3792 (*
	mt˛_SëMaxBlockTime
Ë(
T˛_Time
 * 
	mtimePå
);

3793 (*
	mt˛_SëP™icProc
Ë(
T˛_P™icProc
 * 
	m∑nicProc
);

3794 (*
	mt˛_SëRecursi⁄Limô
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mdïth
);

3795 (*
	mt˛_SëResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
, * 
	mªsu…
, 
T˛_FªeProc
 * 
	m‰ìProc
);

3796 (*
	mt˛_SëSîvi˚Mode
Ë(
	mmode
);

3797 (*
	mt˛_SëObjEº‹Code
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mîr‹ObjPå
);

3798 (*
	mt˛_SëObjResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mªsu…ObjPå
);

3799 (*
	mt˛_SëStdCh™√l
Ë(
T˛_Ch™√l
 
	mch™√l
, 
	mty≥
);

3800 
CONST84_RETURN
 * (*
	mt˛_SëV¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, CONST * 
	m√wVÆue
, 
	mÊags
);

3801 
CONST84_RETURN
 * (*
	mt˛_SëV¨2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑π1
, CONST * 
	m∑π2
, CONST * 
	m√wVÆue
, 
	mÊags
);

3802 
CONST84_RETURN
 * (*
	mt˛_Sig«lId
Ë(
	msig
);

3803 
CONST84_RETURN
 * (*
	mt˛_Sig«lMsg
Ë(
	msig
);

3804 (*
	mt˛_Sour˚RCFûe
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3805 (*
	mt˛_S∂ôLi°
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mli°Så
, * 
	m¨gcPå
, 
CONST84
 *** 
	m¨gvPå
);

3806 (*
	mt˛_S∂ôP©h
Ë(
CONST
 * 
	m∑th
, * 
	m¨gcPå
, 
CONST84
 *** 
	m¨gvPå
);

3807 (*
	mt˛_SèticPackage
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mpkgName
, 
T˛_PackageInôProc
 * 
	möôProc
, T˛_PackageInôPro¯* 
	mß„InôProc
);

3808 (*
	mt˛_SåögM©ch
Ë(
CONST
 * 
	m°r
, CONST * 
	m∑âîn
);

3809 (*
	mt˛_TñlOld
Ë(
T˛_Ch™√l
 
	mch™
);

3810 (*
	mt˛_Tø˚V¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, 
	mÊags
, 
T˛_V¨Tø˚Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3811 (*
	mt˛_Tø˚V¨2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑π1
, CONST * 
	m∑π2
, 
	mÊags
, 
T˛_V¨Tø˚Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3812 * (*
	mt˛_Tøn¶©eFûeName
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
T˛_DSåög
 * 
	mbuf„rPå
);

3813 (*
	mt˛_Ungës
Ë(
T˛_Ch™√l
 
	mch™
, 
CONST
 * 
	m°r
, 
	mÀn
, 
	m©Hód
);

3814 (*
	mt˛_U∆ökV¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
);

3815 (*
	mt˛_Uƒegi°îCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Ch™√l
 
	mch™
);

3816 (*
	mt˛_Un£tV¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, 
	mÊags
);

3817 (*
	mt˛_Un£tV¨2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑π1
, CONST * 
	m∑π2
, 
	mÊags
);

3818 (*
	mt˛_U¡ø˚V¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, 
	mÊags
, 
T˛_V¨Tø˚Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3819 (*
	mt˛_U¡ø˚V¨2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑π1
, CONST * 
	m∑π2
, 
	mÊags
, 
T˛_V¨Tø˚Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3820 (*
	mt˛_Upd©eLökedV¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
);

3821 (*
	mt˛_UpV¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m‰ameName
, CONST * 
	mv¨Name
, CONST * 
	mloˇlName
, 
	mÊags
);

3822 (*
	mt˛_UpV¨2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m‰ameName
, CONST * 
	m∑π1
, CONST * 
	m∑π2
, CONST * 
	mloˇlName
, 
	mÊags
);

3823 (*
	mt˛_V¨EvÆ
Ë(
T˛_I¡îp
 * 
	möãΩ
, ...);

3824 
Clõ¡D©a
 (*
t˛_V¨Tø˚Info
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, 
	mÊags
, 
T˛_V¨Tø˚Proc
 * 
	m¥ocPå
, Clõ¡D©®
	m¥evClõ¡D©a
);

3825 
Clõ¡D©a
 (*
t˛_V¨Tø˚Info2
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑π1
, CONST * 
	m∑π2
, 
	mÊags
, 
T˛_V¨Tø˚Proc
 * 
	m¥ocPå
, Clõ¡D©®
	m¥evClõ¡D©a
);

3826 (*
	mt˛_Wrôe
Ë(
T˛_Ch™√l
 
	mch™
, 
CONST
 * 
	ms
, 
	m¶í
);

3827 (*
	mt˛_Wr⁄gNumArgs
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mobjc
, 
T˛_Obj
 *
CONST
 
	mobjv
[], CONST * 
	mmesßge
);

3828 (*
	mt˛_DumpA˘iveMem‹y
Ë(
CONST
 * 
	mfûeName
);

3829 (*
	mt˛_VÆid©eAŒMem‹y
Ë(
CONST
 * 
	mfûe
, 
	mlöe
);

3830 (*
	mt˛_AµídResu…VA
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
va_li°
 
	m¨gLi°
);

3831 (*
	mt˛_AµídSåögsToObjVA
Ë(
T˛_Obj
 * 
	mobjPå
, 
va_li°
 
	m¨gLi°
);

3832 
CONST84_RETURN
 * (*
	mt˛_HashSèts
Ë(
T˛_HashTabÀ
 * 
	mèbÀPå
);

3833 
CONST84_RETURN
 * (*
	mt˛_P¨£V¨
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m°¨t
, 
CONST84
 ** 
	mãrmPå
);

3834 
CONST84_RETURN
 * (*
	mt˛_PkgPª£¡
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, CONST * 
	mvîsi⁄
, 
	mexa˘
);

3835 
CONST84_RETURN
 * (*
	mt˛_PkgPª£¡Ex
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, CONST * 
	mvîsi⁄
, 
	mexa˘
, 
Clõ¡D©a
 * 
	m˛õ¡D©aPå
);

3836 (*
	mt˛_PkgProvide
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, CONST * 
	mvîsi⁄
);

3837 
CONST84_RETURN
 * (*
	mt˛_PkgRequúe
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, CONST * 
	mvîsi⁄
, 
	mexa˘
);

3838 (*
	mt˛_SëEº‹CodeVA
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
va_li°
 
	m¨gLi°
);

3839 (*
	mt˛_V¨EvÆVA
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
va_li°
 
	m¨gLi°
);

3840 
T˛_Pid
 (*
t˛_WaôPid
Ë(T˛_Pid 
	mpid
, * 
	m°©På
, 
	m›ti⁄s
);

3841 (*
	mt˛_P™icVA
Ë(
CONST
 * 
	mf‹m©
, 
va_li°
 
	m¨gLi°
);

3842 (*
	mt˛_GëVîsi⁄
Ë(* 
	mmaj‹
, * 
	mmö‹
, * 
	m∑tchLevñ
, * 
	mty≥
);

3843 (*
	mt˛_InôMem‹y
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3844 
T˛_Ch™√l
 (*
t˛_SèckCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Ch™√lTy≥
 * 
	mty≥På
, 
Clõ¡D©a
 
	mö°™˚D©a
, 
	mmask
, T˛_Ch™√»
	m¥evCh™
);

3845 (*
	mt˛_Un°ackCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Ch™√l
 
	mch™
);

3846 
T˛_Ch™√l
 (*
t˛_GëSèckedCh™√l
Ë(T˛_Ch™√»
	mch™
);

3847 (*
	mt˛_SëMaöLo›
Ë(
T˛_MaöLo›Proc
 * 
	m¥oc
);

3848 *
	mª£rved285
;

3849 (*
	mt˛_AµídObjToObj
Ë(
T˛_Obj
 * 
	mobjPå
, T˛_Obj * 
	m≠≥ndObjPå
);

3850 
T˛_Encodög
 (*
t˛_Cª©eEncodög
Ë(c⁄° 
T˛_EncodögTy≥
 * 
	mty≥På
);

3851 (*
	mt˛_Cª©eThªadExôH™dÀr
Ë(
T˛_ExôProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3852 (*
	mt˛_DñëeThªadExôH™dÀr
Ë(
T˛_ExôProc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3853 (*
	mt˛_DisˇrdResu…
Ë(
T˛_SavedResu…
 * 
	m°©ePå
);

3854 (*
	mt˛_EvÆEx
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	ms¸ùt
, 
	mnumByãs
, 
	mÊags
);

3855 (*
	mt˛_EvÆObjv
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mobjc
, 
T˛_Obj
 *
CONST
 
	mobjv
[], 
	mÊags
);

3856 (*
	mt˛_EvÆObjEx
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, 
	mÊags
);

3857 (*
	mt˛_ExôThªad
Ë(
	m°©us
);

3858 (*
	mt˛_Exã∫ÆToUtf
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Encodög
 
	mícodög
, 
CONST
 * 
	m§c
, 
	m§cLí
, 
	mÊags
, 
T˛_EncodögSèã
 * 
	m°©ePå
, * 
	md°
, 
	md°Lí
, * 
	m§cRódPå
, * 
	md°WrŸePå
, * 
	md°Ch¨sPå
);

3859 * (*
	mt˛_Exã∫ÆToUtfDSåög
Ë(
T˛_Encodög
 
	mícodög
, 
CONST
 * 
	m§c
, 
	m§cLí
, 
T˛_DSåög
 * 
	mdsPå
);

3860 (*
	mt˛_FöÆizeThªad
) ();

3861 (*
	mt˛_FöÆizeNŸifõr
Ë(
Clõ¡D©a
 
	m˛õ¡D©a
);

3862 (*
	mt˛_FªeEncodög
Ë(
T˛_Encodög
 
	mícodög
);

3863 
T˛_ThªadId
 (*
t˛_GëCuºítThªad
) ();

3864 
T˛_Encodög
 (*
t˛_GëEncodög
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
);

3865 
CONST84_RETURN
 * (*
	mt˛_GëEncodögName
Ë(
T˛_Encodög
 
	mícodög
);

3866 (*
	mt˛_GëEncodögNames
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3867 (*
	mt˛_GëIndexFromObjSåu˘
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, 
CONST
 
VOID
 * 
	mèbÀPå
, 
	moff£t
, CONST * 
	mmsg
, 
	mÊags
, * 
	mödexPå
);

3868 
	mVOID
 * (*
	mt˛_GëThªadD©a
Ë(
T˛_ThªadD©aKey
 * 
	mkeyPå
, 
	msize
);

3869 
	mT˛_Obj
 * (*
	mt˛_GëV¨2Ex
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑π1
, CONST * 
	m∑π2
, 
	mÊags
);

3870 
Clõ¡D©a
 (*
t˛_InôNŸifõr
) ();

3871 (*
	mt˛_MuãxLock
Ë(
T˛_Muãx
 * 
	mmuãxPå
);

3872 (*
	mt˛_MuãxU∆ock
Ë(
T˛_Muãx
 * 
	mmuãxPå
);

3873 (*
	mt˛_C⁄dôi⁄NŸify
Ë(
T˛_C⁄dôi⁄
 * 
	mc⁄dPå
);

3874 (*
	mt˛_C⁄dôi⁄Waô
Ë(
T˛_C⁄dôi⁄
 * 
	mc⁄dPå
, 
T˛_Muãx
 * 
	mmuãxPå
, 
T˛_Time
 * 
	mtimePå
);

3875 (*
	mt˛_NumUtfCh¨s
Ë(
CONST
 * 
	m§c
, 
	mÀngth
);

3876 (*
	mt˛_RódCh¨s
Ë(
T˛_Ch™√l
 
	mch™√l
, 
T˛_Obj
 * 
	mobjPå
, 
	mch¨sToRód
, 
	m≠≥ndFœg
);

3877 (*
	mt˛_Re°‹eResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_SavedResu…
 * 
	m°©ePå
);

3878 (*
	mt˛_SaveResu…
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_SavedResu…
 * 
	m°©ePå
);

3879 (*
	mt˛_SëSy°emEncodög
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
);

3880 
	mT˛_Obj
 * (*
	mt˛_SëV¨2Ex
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑π1
, CONST * 
	m∑π2
, 
T˛_Obj
 * 
	m√wVÆuePå
, 
	mÊags
);

3881 (*
	mt˛_ThªadAÀπ
Ë(
T˛_ThªadId
 
	mthªadId
);

3882 (*
	mt˛_ThªadQueueEvít
Ë(
T˛_ThªadId
 
	mthªadId
, 
T˛_Evít
* 
	mevPå
, 
T˛_QueuePosôi⁄
 
	mposôi⁄
);

3883 
T˛_UniCh¨
 (*
t˛_UniCh¨AtIndex
Ë(
CONST
 * 
	m§c
, 
	mödex
);

3884 
T˛_UniCh¨
 (*
t˛_UniCh¨ToLowî
Ë(
	mch
);

3885 
T˛_UniCh¨
 (*
t˛_UniCh¨ToTôÀ
Ë(
	mch
);

3886 
T˛_UniCh¨
 (*
t˛_UniCh¨ToUµî
Ë(
	mch
);

3887 (*
	mt˛_UniCh¨ToUtf
Ë(
	mch
, * 
	mbuf
);

3888 
CONST84_RETURN
 * (*
	mt˛_UtfAtIndex
Ë(
CONST
 * 
	m§c
, 
	mödex
);

3889 (*
	mt˛_UtfCh¨Com∂ëe
Ë(
CONST
 * 
	m§c
, 
	mÀngth
);

3890 (*
	mt˛_UtfBack¶ash
Ë(
CONST
 * 
	m§c
, * 
	mªadPå
, * 
	md°
);

3891 
CONST84_RETURN
 * (*
	mt˛_UtfFödFú°
Ë(
CONST
 * 
	m§c
, 
	mch
);

3892 
CONST84_RETURN
 * (*
	mt˛_UtfFödLa°
Ë(
CONST
 * 
	m§c
, 
	mch
);

3893 
CONST84_RETURN
 * (*
	mt˛_UtfNext
Ë(
CONST
 * 
	m§c
);

3894 
CONST84_RETURN
 * (*
	mt˛_UtfPªv
Ë(
CONST
 * 
	m§c
, CONST * 
	m°¨t
);

3895 (*
	mt˛_UtfToExã∫Æ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Encodög
 
	mícodög
, 
CONST
 * 
	m§c
, 
	m§cLí
, 
	mÊags
, 
T˛_EncodögSèã
 * 
	m°©ePå
, * 
	md°
, 
	md°Lí
, * 
	m§cRódPå
, * 
	md°WrŸePå
, * 
	md°Ch¨sPå
);

3896 * (*
	mt˛_UtfToExã∫ÆDSåög
Ë(
T˛_Encodög
 
	mícodög
, 
CONST
 * 
	m§c
, 
	m§cLí
, 
T˛_DSåög
 * 
	mdsPå
);

3897 (*
	mt˛_UtfToLowî
Ë(* 
	m§c
);

3898 (*
	mt˛_UtfToTôÀ
Ë(* 
	m§c
);

3899 (*
	mt˛_UtfToUniCh¨
Ë(
CONST
 * 
	m§c
, 
T˛_UniCh¨
 * 
	mchPå
);

3900 (*
	mt˛_UtfToUµî
Ë(* 
	m§c
);

3901 (*
	mt˛_WrôeCh¨s
Ë(
T˛_Ch™√l
 
	mch™
, 
CONST
 * 
	m§c
, 
	m§cLí
);

3902 (*
	mt˛_WrôeObj
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_Obj
 * 
	mobjPå
);

3903 * (*
	mt˛_GëSåög
Ë(
T˛_Obj
 * 
	mobjPå
);

3904 
CONST84_RETURN
 * (*
	mt˛_GëDeÁu…EncodögDú
) ();

3905 (*
	mt˛_SëDeÁu…EncodögDú
Ë(
CONST
 * 
	m∑th
);

3906 (*
	mt˛_AÀπNŸifõr
Ë(
Clõ¡D©a
 
	m˛õ¡D©a
);

3907 (*
	mt˛_Sîvi˚ModeHook
Ë(
	mmode
);

3908 (*
	mt˛_UniCh¨IsA um
Ë(
	mch
);

3909 (*
	mt˛_UniCh¨IsAÕha
Ë(
	mch
);

3910 (*
	mt˛_UniCh¨IsDigô
Ë(
	mch
);

3911 (*
	mt˛_UniCh¨IsLowî
Ë(
	mch
);

3912 (*
	mt˛_UniCh¨IsS∑˚
Ë(
	mch
);

3913 (*
	mt˛_UniCh¨IsUµî
Ë(
	mch
);

3914 (*
	mt˛_UniCh¨IsW‹dCh¨
Ë(
	mch
);

3915 (*
	mt˛_UniCh¨Lí
Ë(
CONST
 
T˛_UniCh¨
 * 
	muniSå
);

3916 (*
	mt˛_UniCh¨Ncmp
Ë(
CONST
 
T˛_UniCh¨
 * 
	mucs
, CONST T˛_UniCh¨ * 
	mu˘
, 
	mnumCh¨s
);

3917 * (*
	mt˛_UniCh¨ToUtfDSåög
Ë(
CONST
 
T˛_UniCh¨
 * 
	muniSå
, 
	muniLígth
, 
T˛_DSåög
 * 
	mdsPå
);

3918 
	mT˛_UniCh¨
 * (*
	mt˛_UtfToUniCh¨DSåög
Ë(
CONST
 * 
	m§c
, 
	mÀngth
, 
T˛_DSåög
 * 
	mdsPå
);

3919 
T˛_RegExp
 (*
t˛_GëRegExpFromObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	m∑tObj
, 
	mÊags
);

3920 
	mT˛_Obj
 * (*
	mt˛_EvÆTokís
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Tokí
 * 
	mtokíPå
, 
	mcou¡
);

3921 (*
	mt˛_FªeP¨£
Ë(
T˛_P¨£
 * 
	m∑r£På
);

3922 (*
	mt˛_LogComm™dInfo
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	ms¸ùt
, CONST * 
	mcomm™d
, 
	mÀngth
);

3923 (*
	mt˛_P¨£Bø˚s
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m°¨t
, 
	mnumByãs
, 
T˛_P¨£
 * 
	m∑r£På
, 
	m≠≥nd
, 
CONST84
 ** 
	mãrmPå
);

3924 (*
	mt˛_P¨£Comm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m°¨t
, 
	mnumByãs
, 
	m√°ed
, 
T˛_P¨£
 * 
	m∑r£På
);

3925 (*
	mt˛_P¨£Ex¥
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m°¨t
, 
	mnumByãs
, 
T˛_P¨£
 * 
	m∑r£På
);

3926 (*
	mt˛_P¨£QuŸedSåög
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m°¨t
, 
	mnumByãs
, 
T˛_P¨£
 * 
	m∑r£På
, 
	m≠≥nd
, 
CONST84
 ** 
	mãrmPå
);

3927 (*
	mt˛_P¨£V¨Name
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m°¨t
, 
	mnumByãs
, 
T˛_P¨£
 * 
	m∑r£På
, 
	m≠≥nd
);

3928 * (*
	mt˛_GëCwd
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_DSåög
 * 
	mcwdPå
);

3929 (*
	mt˛_Chdú
Ë(
CONST
 * 
	mdúName
);

3930 (*
	mt˛_Ac˚ss
Ë(
CONST
 * 
	m∑th
, 
	mmode
);

3931 (*
	mt˛_Sèt
Ë(
CONST
 * 
	m∑th
, 
°©
 * 
	mbufPå
);

3932 (*
	mt˛_UtfNcmp
Ë(
CONST
 * 
	ms1
, CONST * 
	ms2
, 
	mn
);

3933 (*
	mt˛_UtfNˇ£cmp
Ë(
CONST
 * 
	ms1
, CONST * 
	ms2
, 
	mn
);

3934 (*
	mt˛_SåögCa£M©ch
Ë(
CONST
 * 
	m°r
, CONST * 
	m∑âîn
, 
	mnoˇ£
);

3935 (*
	mt˛_UniCh¨IsC⁄åﬁ
Ë(
	mch
);

3936 (*
	mt˛_UniCh¨IsGøph
Ë(
	mch
);

3937 (*
	mt˛_UniCh¨IsPröt
Ë(
	mch
);

3938 (*
	mt˛_UniCh¨IsPun˘
Ë(
	mch
);

3939 (*
	mt˛_RegExpExecObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_RegExp
 
	mªgexp
, 
T˛_Obj
 * 
	mãxtObj
, 
	moff£t
, 
	mnm©ches
, 
	mÊags
);

3940 (*
	mt˛_RegExpGëInfo
Ë(
T˛_RegExp
 
	mªgexp
, 
T˛_RegExpInfo
 * 
	möfoPå
);

3941 
	mT˛_Obj
 * (*
	mt˛_NewUnicodeObj
Ë(
CONST
 
T˛_UniCh¨
 * 
	municode
, 
	mnumCh¨s
);

3942 (*
	mt˛_SëUnicodeObj
Ë(
T˛_Obj
 * 
	mobjPå
, 
CONST
 
T˛_UniCh¨
 * 
	municode
, 
	mnumCh¨s
);

3943 (*
	mt˛_GëCh¨Lígth
Ë(
T˛_Obj
 * 
	mobjPå
);

3944 
T˛_UniCh¨
 (*
t˛_GëUniCh¨
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mödex
);

3945 
	mT˛_UniCh¨
 * (*
	mt˛_GëUnicode
Ë(
T˛_Obj
 * 
	mobjPå
);

3946 
	mT˛_Obj
 * (*
	mt˛_GëR™ge
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mfú°
, 
	mœ°
);

3947 (*
	mt˛_AµídUnicodeToObj
Ë(
T˛_Obj
 * 
	mobjPå
, 
CONST
 
T˛_UniCh¨
 * 
	municode
, 
	mÀngth
);

3948 (*
	mt˛_RegExpM©chObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mãxtObj
, T˛_Obj * 
	m∑âînObj
);

3949 (*
	mt˛_SëNŸifõr
Ë(
T˛_NŸifõrProcs
 * 
	mnŸifõrProcPå
);

3950 
	mT˛_Muãx
 * (*
	mt˛_GëAŒocMuãx
) ();

3951 (*
	mt˛_GëCh™√lNames
Ë(
T˛_I¡îp
 * 
	möãΩ
);

3952 (*
	mt˛_GëCh™√lNamesEx
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑âîn
);

3953 (*
	mt˛_ProcObjCmd
Ë(
Clõ¡D©a
 
	m˛õ¡D©a
, 
T˛_I¡îp
 * 
	möãΩ
, 
	mobjc
, 
T˛_Obj
 *
CONST
 
	mobjv
[]);

3954 (*
	mt˛_C⁄dôi⁄FöÆize
Ë(
T˛_C⁄dôi⁄
 * 
	mc⁄dPå
);

3955 (*
	mt˛_MuãxFöÆize
Ë(
T˛_Muãx
 * 
	mmuãx
);

3956 (*
	mt˛_Cª©eThªad
Ë(
T˛_ThªadId
 * 
	midPå
, 
T˛_ThªadCª©eProc
 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
, 
	m°ackSize
, 
	mÊags
);

3957 (*
	mt˛_RódRaw
Ë(
T˛_Ch™√l
 
	mch™
, * 
	md°
, 
	mbyãsToRód
);

3958 (*
	mt˛_WrôeRaw
Ë(
T˛_Ch™√l
 
	mch™
, 
CONST
 * 
	m§c
, 
	m§cLí
);

3959 
T˛_Ch™√l
 (*
t˛_GëT›Ch™√l
Ë(T˛_Ch™√»
	mch™
);

3960 (*
	mt˛_Ch™√lBuf„ªd
Ë(
T˛_Ch™√l
 
	mch™
);

3961 
CONST84_RETURN
 * (*
	mt˛_Ch™√lName
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3962 
T˛_Ch™√lTy≥Vîsi⁄
 (*
t˛_Ch™√lVîsi⁄
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3963 
	mT˛_DrivîBlockModeProc
 * (*
	mt˛_Ch™√lBlockModeProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3964 
	mT˛_DrivîClo£Proc
 * (*
	mt˛_Ch™√lClo£Proc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3965 
	mT˛_DrivîClo£2Proc
 * (*
	mt˛_Ch™√lClo£2Proc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3966 
	mT˛_DrivîI≈utProc
 * (*
	mt˛_Ch™√lI≈utProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3967 
	mT˛_DrivîOuçutProc
 * (*
	mt˛_Ch™√lOuçutProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3968 
	mT˛_DrivîSìkProc
 * (*
	mt˛_Ch™√lSìkProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3969 
	mT˛_DrivîSëO±i⁄Proc
 * (*
	mt˛_Ch™√lSëO±i⁄Proc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3970 
	mT˛_DrivîGëO±i⁄Proc
 * (*
	mt˛_Ch™√lGëO±i⁄Proc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3971 
	mT˛_DrivîW©chProc
 * (*
	mt˛_Ch™√lW©chProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3972 
	mT˛_DrivîGëH™dÀProc
 * (*
	mt˛_Ch™√lGëH™dÀProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3973 
	mT˛_DrivîFlushProc
 * (*
	mt˛_Ch™√lFlushProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3974 
	mT˛_DrivîH™dÀrProc
 * (*
	mt˛_Ch™√lH™dÀrProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

3975 (*
	mt˛_JoöThªad
Ë(
T˛_ThªadId
 
	mthªadId
, * 
	mªsu…
);

3976 (*
	mt˛_IsCh™√lSh¨ed
Ë(
T˛_Ch™√l
 
	mch™√l
);

3977 (*
	mt˛_IsCh™√lRegi°îed
Ë(
T˛_I¡îp
* 
	möãΩ
, 
T˛_Ch™√l
 
	mch™√l
);

3978 (*
	mt˛_CutCh™√l
Ë(
T˛_Ch™√l
 
	mch™√l
);

3979 (*
	mt˛_S∂i˚Ch™√l
Ë(
T˛_Ch™√l
 
	mch™√l
);

3980 (*
	mt˛_CÀ¨Ch™√lH™dÀrs
Ë(
T˛_Ch™√l
 
	mch™√l
);

3981 (*
	mt˛_IsCh™√lExi°ög
Ë(
CONST
 * 
	mch™√lName
);

3982 (*
	mt˛_UniCh¨Nˇ£cmp
Ë(
CONST
 
T˛_UniCh¨
 * 
	mucs
, CONST T˛_UniCh¨ * 
	mu˘
, 
	mnumCh¨s
);

3983 (*
	mt˛_UniCh¨Ca£M©ch
Ë(
CONST
 
T˛_UniCh¨
 * 
	muniSå
, CONST T˛_UniCh¨ * 
	muniP©ã∫
, 
	mnoˇ£
);

3984 
	mT˛_HashE¡ry
 * (*
	mt˛_FödHashE¡ry
Ë(
T˛_HashTabÀ
 * 
	mèbÀPå
, 
CONST
 * 
	mkey
);

3985 
	mT˛_HashE¡ry
 * (*
	mt˛_Cª©eHashE¡ry
Ë(
T˛_HashTabÀ
 * 
	mèbÀPå
, 
CONST
 * 
	mkey
, * 
	m√wPå
);

3986 (*
	mt˛_InôCu°omHashTabÀ
Ë(
T˛_HashTabÀ
 * 
	mèbÀPå
, 
	mkeyTy≥
, 
T˛_HashKeyTy≥
 * 
	mty≥På
);

3987 (*
	mt˛_InôObjHashTabÀ
Ë(
T˛_HashTabÀ
 * 
	mèbÀPå
);

3988 
Clõ¡D©a
 (*
t˛_Comm™dTø˚Info
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, 
	mÊags
, 
T˛_Comm™dTø˚Proc
 * 
	m¥ocPå
, Clõ¡D©®
	m¥evClõ¡D©a
);

3989 (*
	mt˛_Tø˚Comm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, 
	mÊags
, 
T˛_Comm™dTø˚Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3990 (*
	mt˛_U¡ø˚Comm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mv¨Name
, 
	mÊags
, 
T˛_Comm™dTø˚Proc
 * 
	m¥oc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

3991 * (*
	mt˛_Aâem±AŒoc
Ë(
	msize
);

3992 * (*
	mt˛_Aâem±DbCkÆloc
Ë(
	msize
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3993 * (*
	mt˛_Aâem±RóŒoc
Ë(* 
	m±r
, 
	msize
);

3994 * (*
	mt˛_Aâem±DbCkªÆloc
Ë(* 
	m±r
, 
	msize
, 
CONST
 * 
	mfûe
, 
	mlöe
);

3995 (*
	mt˛_Aâem±SëObjLígth
Ë(
T˛_Obj
 * 
	mobjPå
, 
	mÀngth
);

3996 
T˛_ThªadId
 (*
t˛_GëCh™√lThªad
Ë(
T˛_Ch™√l
 
	mch™√l
);

3997 
	mT˛_UniCh¨
 * (*
	mt˛_GëUnicodeFromObj
Ë(
T˛_Obj
 * 
	mobjPå
, * 
	mÀngthPå
);

3998 (*
	mt˛_GëM©hFuncInfo
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, * 
	mnumArgsPå
, 
T˛_VÆueTy≥
 ** 
	m¨gTy≥sPå
, 
T˛_M©hProc
 ** 
	m¥ocPå
, 
Clõ¡D©a
 * 
	m˛õ¡D©aPå
);

3999 
	mT˛_Obj
 * (*
	mt˛_Li°M©hFuncs
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m∑âîn
);

4000 
	mT˛_Obj
 * (*
	mt˛_Sub°Obj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, 
	mÊags
);

4001 (*
	mt˛_DëachCh™√l
Ë(
T˛_I¡îp
* 
	möãΩ
, 
T˛_Ch™√l
 
	mch™√l
);

4002 (*
	mt˛_IsSènd¨dCh™√l
Ë(
T˛_Ch™√l
 
	mch™√l
);

4003 (*
	mt˛_FSC›yFûe
Ë(
T˛_Obj
 * 
	m§cP©hPå
, T˛_Obj * 
	mde°P©hPå
);

4004 (*
	mt˛_FSC›yDúe˘‹y
Ë(
T˛_Obj
 * 
	m§cP©hPå
, T˛_Obj * 
	mde°P©hPå
, T˛_Obj ** 
	mîr‹På
);

4005 (*
	mt˛_FSCª©eDúe˘‹y
Ë(
T˛_Obj
 * 
	m∑thPå
);

4006 (*
	mt˛_FSDñëeFûe
Ë(
T˛_Obj
 * 
	m∑thPå
);

4007 (*
	mt˛_FSLﬂdFûe
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	m∑thPå
, 
CONST
 * 
	msym1
, CONST * 
	msym2
, 
T˛_PackageInôProc
 ** 
	m¥oc1På
, T˛_PackageInôPro¯** 
	m¥oc2På
, 
T˛_LﬂdH™dÀ
 * 
	mh™dÀPå
, 
T˛_FSU∆ﬂdFûeProc
 ** 
	mu∆ﬂdProcPå
);

4008 (*
	mt˛_FSM©chInDúe˘‹y
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mªsu…
, T˛_Obj * 
	m∑thPå
, 
CONST
 * 
	m∑âîn
, 
T˛_GlobTy≥D©a
 * 
	mty≥s
);

4009 
	mT˛_Obj
 * (*
	mt˛_FSLök
Ë(
T˛_Obj
 * 
	m∑thPå
, T˛_Obj * 
	mtoPå
, 
	mlökA˘i⁄
);

4010 (*
	mt˛_FSRemoveDúe˘‹y
Ë(
T˛_Obj
 * 
	m∑thPå
, 
	mªcursive
, T˛_Obj ** 
	mîr‹På
);

4011 (*
	mt˛_FSRíameFûe
Ë(
T˛_Obj
 * 
	m§cP©hPå
, T˛_Obj * 
	mde°P©hPå
);

4012 (*
	mt˛_FSL°©
Ë(
T˛_Obj
 * 
	m∑thPå
, 
T˛_SètBuf
 * 
	mbuf
);

4013 (*
	mt˛_FSUtime
Ë(
T˛_Obj
 * 
	m∑thPå
, 
utimbuf
 * 
	mtvÆ
);

4014 (*
	mt˛_FSFûeAârsGë
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mödex
, 
T˛_Obj
 * 
	m∑thPå
, T˛_Obj ** 
	mobjPåRef
);

4015 (*
	mt˛_FSFûeAârsSë
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mödex
, 
T˛_Obj
 * 
	m∑thPå
, T˛_Obj * 
	mobjPå
);

4016 
CONST
 ** (*
	mt˛_FSFûeAârSåögs
Ë(
T˛_Obj
 * 
	m∑thPå
, T˛_Obj ** 
	mobjPåRef
);

4017 (*
	mt˛_FSSèt
Ë(
T˛_Obj
 * 
	m∑thPå
, 
T˛_SètBuf
 * 
	mbuf
);

4018 (*
	mt˛_FSAc˚ss
Ë(
T˛_Obj
 * 
	m∑thPå
, 
	mmode
);

4019 
T˛_Ch™√l
 (*
t˛_FSO≥nFûeCh™√l
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	m∑thPå
, 
CONST
 * 
	mmodeSåög
, 
	m≥rmissi⁄s
);

4020 
	mT˛_Obj
* (*
	mt˛_FSGëCwd
Ë(
T˛_I¡îp
 * 
	möãΩ
);

4021 (*
	mt˛_FSChdú
Ë(
T˛_Obj
 * 
	m∑thPå
);

4022 (*
	mt˛_FSC⁄vîtToP©hTy≥
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	m∑thPå
);

4023 
	mT˛_Obj
* (*
	mt˛_FSJoöP©h
Ë(
T˛_Obj
 * 
	mli°Obj
, 
	mñemíts
);

4024 
	mT˛_Obj
* (*
	mt˛_FSS∂ôP©h
Ë(
T˛_Obj
* 
	m∑thPå
, * 
	mÀnPå
);

4025 (*
	mt˛_FSEquÆP©hs
Ë(
T˛_Obj
* 
	mfú°På
, T˛_Obj* 
	m£c⁄dPå
);

4026 
	mT˛_Obj
* (*
	mt˛_FSGëN‹mÆizedP©h
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
* 
	m∑thPå
);

4027 
	mT˛_Obj
* (*
	mt˛_FSJoöToP©h
Ë(
T˛_Obj
 * 
	m∑thPå
, 
	mobjc
, T˛_Obj *
CONST
 
	mobjv
[]);

4028 
Clõ¡D©a
 (*
t˛_FSGëI¡î«lRï
Ë(
T˛_Obj
* 
	m∑thPå
, 
T˛_Fûesy°em
 * 
	mfsPå
);

4029 
	mT˛_Obj
* (*
	mt˛_FSGëTøn¶©edP©h
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
* 
	m∑thPå
);

4030 (*
	mt˛_FSEvÆFûe
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mfûeName
);

4031 
	mT˛_Obj
* (*
	mt˛_FSNewN©iveP©h
Ë(
T˛_Fûesy°em
* 
	m‰omFûesy°em
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

4032 
CONST
 * (*
	mt˛_FSGëN©iveP©h
Ë(
T˛_Obj
* 
	m∑thPå
);

4033 
	mT˛_Obj
* (*
	mt˛_FSFûeSy°emInfo
Ë(
T˛_Obj
* 
	m∑thPå
);

4034 
	mT˛_Obj
* (*
	mt˛_FSP©hSï¨©‹
Ë(
T˛_Obj
* 
	m∑thPå
);

4035 
	mT˛_Obj
* (*
	mt˛_FSLi°Vﬁumes
) ();

4036 (*
	mt˛_FSRegi°î
Ë(
Clõ¡D©a
 
	m˛õ¡D©a
, 
T˛_Fûesy°em
 * 
	mfsPå
);

4037 (*
	mt˛_FSUƒegi°î
Ë(
T˛_Fûesy°em
 * 
	mfsPå
);

4038 
Clõ¡D©a
 (*
t˛_FSD©a
Ë(
T˛_Fûesy°em
 * 
	mfsPå
);

4039 
CONST
 * (*
	mt˛_FSGëTøn¶©edSåögP©h
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
* 
	m∑thPå
);

4040 
	mT˛_Fûesy°em
* (*
	mt˛_FSGëFûeSy°emF‹P©h
Ë(
T˛_Obj
* 
	m∑thPå
);

4041 
T˛_P©hTy≥
 (*
t˛_FSGëP©hTy≥
Ë(
T˛_Obj
 * 
	m∑thPå
);

4042 (*
	mt˛_OuçutBuf„ªd
Ë(
T˛_Ch™√l
 
	mch™
);

4043 (*
	mt˛_FSMou¡sCh™ged
Ë(
T˛_Fûesy°em
 * 
	mfsPå
);

4044 (*
	mt˛_EvÆTokísSènd¨d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Tokí
 * 
	mtokíPå
, 
	mcou¡
);

4045 (*
	mt˛_GëTime
Ë(
T˛_Time
* 
	mtimeBuf
);

4046 
T˛_Tø˚
 (*
t˛_Cª©eObjTø˚
Ë(
T˛_I¡îp
* 
	möãΩ
, 
	mÀvñ
, 
	mÊags
, 
T˛_CmdObjTø˚Proc
* 
	mobjProc
, 
Clõ¡D©a
 
	m˛õ¡D©a
, 
T˛_CmdObjTø˚DñëeProc
* 
	mdñProc
);

4047 (*
	mt˛_GëComm™dInfoFromTokí
Ë(
T˛_Comm™d
 
	mtokí
, 
T˛_CmdInfo
* 
	möfoPå
);

4048 (*
	mt˛_SëComm™dInfoFromTokí
Ë(
T˛_Comm™d
 
	mtokí
, 
CONST
 
T˛_CmdInfo
* 
	möfoPå
);

4049 
	mT˛_Obj
 * (*
	mt˛_DbNewWideI¡Obj
Ë(
T˛_WideI¡
 
	mwideVÆue
, 
CONST
 * 
	mfûe
, 
	mlöe
);

4050 (*
	mt˛_GëWideI¡FromObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, 
T˛_WideI¡
 * 
	mwidePå
);

4051 
	mT˛_Obj
 * (*
	mt˛_NewWideI¡Obj
Ë(
T˛_WideI¡
 
	mwideVÆue
);

4052 (*
	mt˛_SëWideI¡Obj
Ë(
T˛_Obj
 * 
	mobjPå
, 
T˛_WideI¡
 
	mwideVÆue
);

4053 
	mT˛_SètBuf
 * (*
	mt˛_AŒocSètBuf
) ();

4054 
T˛_WideI¡
 (*
t˛_Sìk
Ë(
T˛_Ch™√l
 
	mch™
, T˛_WideI¡ 
	moff£t
, 
	mmode
);

4055 
T˛_WideI¡
 (*
t˛_Tñl
Ë(
T˛_Ch™√l
 
	mch™
);

4056 
	mT˛_DrivîWideSìkProc
 * (*
	mt˛_Ch™√lWideSìkProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

4057 (*
	mt˛_Di˘ObjPut
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mdi˘På
, T˛_Obj * 
	mkeyPå
, T˛_Obj * 
	mvÆuePå
);

4058 (*
	mt˛_Di˘ObjGë
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mdi˘På
, T˛_Obj * 
	mkeyPå
, T˛_Obj ** 
	mvÆuePåPå
);

4059 (*
	mt˛_Di˘ObjRemove
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mdi˘På
, T˛_Obj * 
	mkeyPå
);

4060 (*
	mt˛_Di˘ObjSize
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mdi˘På
, * 
	msizePå
);

4061 (*
	mt˛_Di˘ObjFú°
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mdi˘På
, 
T˛_Di˘Sórch
 * 
	m£¨chPå
, T˛_Obj ** 
	mkeyPåPå
, T˛_Obj ** 
	mvÆuePåPå
, * 
	md⁄ePå
);

4062 (*
	mt˛_Di˘ObjNext
Ë(
T˛_Di˘Sórch
 * 
	m£¨chPå
, 
T˛_Obj
 ** 
	mkeyPåPå
, T˛_Obj ** 
	mvÆuePåPå
, * 
	md⁄ePå
);

4063 (*
	mt˛_Di˘ObjD⁄e
Ë(
T˛_Di˘Sórch
 * 
	m£¨chPå
);

4064 (*
	mt˛_Di˘ObjPutKeyLi°
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mdi˘På
, 
	mkeyc
, T˛_Obj *
CONST
 * 
	mkeyv
, T˛_Obj * 
	mvÆuePå
);

4065 (*
	mt˛_Di˘ObjRemoveKeyLi°
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mdi˘På
, 
	mkeyc
, T˛_Obj *
CONST
 * 
	mkeyv
);

4066 
	mT˛_Obj
 * (*
	mt˛_NewDi˘Obj
) ();

4067 
	mT˛_Obj
 * (*
	mt˛_DbNewDi˘Obj
Ë(
CONST
 * 
	mfûe
, 
	mlöe
);

4068 (*
	mt˛_Regi°îC⁄fig
Ë(
T˛_I¡îp
* 
	möãΩ
, 
CONST
 * 
	mpkgName
, 
T˛_C⁄fig
* 
	mc⁄figuøti⁄
, CONST * 
	mvÆEncodög
);

4069 
	mT˛_Name•a˚
 * (*
	mt˛_Cª©eName•a˚
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
Clõ¡D©a
 
	m˛õ¡D©a
, 
T˛_Name•a˚DñëeProc
 * 
	mdñëeProc
);

4070 (*
	mt˛_DñëeName•a˚
Ë(
T˛_Name•a˚
 * 
	mnsPå
);

4071 (*
	mt˛_AµídExp‹tLi°
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Name•a˚
 * 
	mnsPå
, 
T˛_Obj
 * 
	mobjPå
);

4072 (*
	mt˛_Exp‹t
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Name•a˚
 * 
	mnsPå
, 
CONST
 * 
	m∑âîn
, 
	mª£tLi°Fú°
);

4073 (*
	mt˛_Imp‹t
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Name•a˚
 * 
	mnsPå
, 
CONST
 * 
	m∑âîn
, 
	mÆlowOvîwrôe
);

4074 (*
	mt˛_F‹gëImp‹t
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Name•a˚
 * 
	mnsPå
, 
CONST
 * 
	m∑âîn
);

4075 
	mT˛_Name•a˚
 * (*
	mt˛_GëCuºítName•a˚
Ë(
T˛_I¡îp
 * 
	möãΩ
);

4076 
	mT˛_Name•a˚
 * (*
	mt˛_GëGlobÆName•a˚
Ë(
T˛_I¡îp
 * 
	möãΩ
);

4077 
	mT˛_Name•a˚
 * (*
	mt˛_FödName•a˚
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
T˛_Name•a˚
 * 
	mc⁄ãxtNsPå
, 
	mÊags
);

4078 
T˛_Comm™d
 (*
t˛_FödComm™d
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
T˛_Name•a˚
 * 
	mc⁄ãxtNsPå
, 
	mÊags
);

4079 
T˛_Comm™d
 (*
t˛_GëComm™dFromObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
);

4080 (*
	mt˛_GëComm™dFuŒName
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mcomm™d
, 
T˛_Obj
 * 
	mobjPå
);

4081 (*
	mt˛_FSEvÆFûeEx
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mfûeName
, 
CONST
 * 
	mícodögName
);

4082 
	mT˛_ExôProc
 * (*
	mt˛_SëExôProc
Ë(
T˛_ExôProc
 * 
	m¥oc
);

4083 (*
	mt˛_LimôAddH™dÀr
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mty≥
, 
T˛_LimôH™dÀrProc
 * 
	mh™dÀrProc
, 
Clõ¡D©a
 
	m˛õ¡D©a
, 
T˛_LimôH™dÀrDñëeProc
 * 
	mdñëeProc
);

4084 (*
	mt˛_LimôRemoveH™dÀr
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mty≥
, 
T˛_LimôH™dÀrProc
 * 
	mh™dÀrProc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

4085 (*
	mt˛_LimôRódy
Ë(
T˛_I¡îp
 * 
	möãΩ
);

4086 (*
	mt˛_LimôCheck
Ë(
T˛_I¡îp
 * 
	möãΩ
);

4087 (*
	mt˛_LimôEx˚eded
Ë(
T˛_I¡îp
 * 
	möãΩ
);

4088 (*
	mt˛_LimôSëComm™ds
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mcomm™dLimô
);

4089 (*
	mt˛_LimôSëTime
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Time
 * 
	mtimeLimôPå
);

4090 (*
	mt˛_LimôSëGønuœrôy
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mty≥
, 
	mgønuœrôy
);

4091 (*
	mt˛_LimôTy≥E«bÀd
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mty≥
);

4092 (*
	mt˛_LimôTy≥Ex˚eded
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mty≥
);

4093 (*
	mt˛_LimôTy≥Së
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mty≥
);

4094 (*
	mt˛_LimôTy≥Re£t
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mty≥
);

4095 (*
	mt˛_LimôGëComm™ds
Ë(
T˛_I¡îp
 * 
	möãΩ
);

4096 (*
	mt˛_LimôGëTime
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Time
 * 
	mtimeLimôPå
);

4097 (*
	mt˛_LimôGëGønuœrôy
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mty≥
);

4098 
T˛_I¡îpSèã
 (*
t˛_SaveI¡îpSèã
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	m°©us
);

4099 (*
	mt˛_Re°‹eI¡îpSèã
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_I¡îpSèã
 
	m°©e
);

4100 (*
	mt˛_DisˇrdI¡îpSèã
Ë(
T˛_I¡îpSèã
 
	m°©e
);

4101 (*
	mt˛_SëRëu∫O±i⁄s
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	m›ti⁄s
);

4102 
	mT˛_Obj
 * (*
	mt˛_GëRëu∫O±i⁄s
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
	mªsu…
);

4103 (*
	mt˛_IsEn£mbÀ
Ë(
T˛_Comm™d
 
	mtokí
);

4104 
T˛_Comm™d
 (*
t˛_Cª©eEn£mbÀ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
T˛_Name•a˚
 * 
	m«me•a˚På
, 
	mÊags
);

4105 
T˛_Comm™d
 (*
t˛_FödEn£mbÀ
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mcmdNameObj
, 
	mÊags
);

4106 (*
	mt˛_SëEn£mbÀSubcomm™dLi°
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, 
T˛_Obj
 * 
	msubcmdLi°
);

4107 (*
	mt˛_SëEn£mbÀM≠pögDi˘
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, 
T˛_Obj
 * 
	mm≠Di˘
);

4108 (*
	mt˛_SëEn£mbÀUnknownH™dÀr
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, 
T˛_Obj
 * 
	munknownLi°
);

4109 (*
	mt˛_SëEn£mbÀFœgs
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, 
	mÊags
);

4110 (*
	mt˛_GëEn£mbÀSubcomm™dLi°
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, 
T˛_Obj
 ** 
	msubcmdLi°På
);

4111 (*
	mt˛_GëEn£mbÀM≠pögDi˘
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, 
T˛_Obj
 ** 
	mm≠Di˘På
);

4112 (*
	mt˛_GëEn£mbÀUnknownH™dÀr
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, 
T˛_Obj
 ** 
	munknownLi°På
);

4113 (*
	mt˛_GëEn£mbÀFœgs
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, * 
	mÊagsPå
);

4114 (*
	mt˛_GëEn£mbÀName•a˚
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Comm™d
 
	mtokí
, 
T˛_Name•a˚
 ** 
	m«me•a˚PåPå
);

4115 (*
	mt˛_SëTimeProc
Ë(
T˛_GëTimeProc
* 
	mgëProc
, 
T˛_SˇÀTimeProc
* 
	msˇÀProc
, 
Clõ¡D©a
 
	m˛õ¡D©a
);

4116 (*
	mt˛_QuîyTimeProc
Ë(
T˛_GëTimeProc
** 
	mgëProc
, 
T˛_SˇÀTimeProc
** 
	msˇÀProc
, 
Clõ¡D©a
* 
	m˛õ¡D©a
);

4117 
	mT˛_DrivîThªadA˘i⁄Proc
 * (*
	mt˛_Ch™√lThªadA˘i⁄Proc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

4118 
	mT˛_Obj
* (*
	mt˛_NewBignumObj
Ë(
mp_öt
* 
	mvÆue
);

4119 
	mT˛_Obj
* (*
	mt˛_DbNewBignumObj
Ë(
mp_öt
* 
	mvÆue
, 
CONST
 * 
	mfûe
, 
	mlöe
);

4120 (*
	mt˛_SëBignumObj
Ë(
T˛_Obj
* 
	mobj
, 
mp_öt
* 
	mvÆue
);

4121 (*
	mt˛_GëBignumFromObj
Ë(
T˛_I¡îp
* 
	möãΩ
, 
T˛_Obj
* 
	mobj
, 
mp_öt
* 
	mvÆue
);

4122 (*
	mt˛_TakeBignumFromObj
Ë(
T˛_I¡îp
* 
	möãΩ
, 
T˛_Obj
* 
	mobj
, 
mp_öt
* 
	mvÆue
);

4123 (*
	mt˛_TrunˇãCh™√l
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_WideI¡
 
	mÀngth
);

4124 
	mT˛_DrivîTrunˇãProc
 * (*
	mt˛_Ch™√lTrunˇãProc
Ë(
CONST
 
T˛_Ch™√lTy≥
 * 
	mch™Ty≥På
);

4125 (*
	mt˛_SëCh™√lEº‹I¡îp
Ë(
T˛_I¡îp
* 
	möãΩ
, 
T˛_Obj
* 
	mmsg
);

4126 (*
	mt˛_GëCh™√lEº‹I¡îp
Ë(
T˛_I¡îp
* 
	möãΩ
, 
T˛_Obj
** 
	mmsg
);

4127 (*
	mt˛_SëCh™√lEº‹
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_Obj
* 
	mmsg
);

4128 (*
	mt˛_GëCh™√lEº‹
Ë(
T˛_Ch™√l
 
	mch™
, 
T˛_Obj
** 
	mmsg
);

4129 (*
	mt˛_InôBignumFromDoubÀ
Ë(
T˛_I¡îp
* 
	möãΩ
, 
	möôvÆ
, 
mp_öt
 * 
	mtoInô
);

4130 
	mT˛_Obj
 * (*
	mt˛_GëName•a˚UnknownH™dÀr
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Name•a˚
 * 
	mnsPå
);

4131 (*
	mt˛_SëName•a˚UnknownH™dÀr
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Name•a˚
 * 
	mnsPå
, 
T˛_Obj
 * 
	mh™dÀrPå
);

4132 (*
	mt˛_GëEncodögFromObj
Ë(
T˛_I¡îp
* 
	möãΩ
, 
T˛_Obj
* 
	mobjPå
, 
T˛_Encodög
* 
	mícodögPå
);

4133 
	mT˛_Obj
* (*
	mt˛_GëEncodögSórchP©h
) ();

4134 (*
	mt˛_SëEncodögSórchP©h
Ë(
T˛_Obj
* 
	m£¨chP©h
);

4135 
CONST
 * (*
	mt˛_GëEncodögNameFromEnvú⁄mít
Ë(
T˛_DSåög
* 
	mbufPå
);

4136 (*
	mt˛_PkgRequúeProc
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	m«me
, 
	mobjc
, 
T˛_Obj
 *CONST 
	mobjv
[], 
Clõ¡D©a
 * 
	m˛õ¡D©aPå
);

4137 (*
	mt˛_AµídObjToEº‹Info
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
);

4138 (*
	mt˛_AµídLimôedToObj
Ë(
T˛_Obj
 * 
	mobjPå
, 
CONST
 * 
	mbyãs
, 
	mÀngth
, 
	mlimô
, CONST * 
	mñlùsis
);

4139 
	mT˛_Obj
 * (*
	mt˛_F‹m©
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mf‹m©
, 
	mobjc
, 
T˛_Obj
 * CONST 
	mobjv
[]);

4140 (*
	mt˛_AµídF‹m©ToObj
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
T˛_Obj
 * 
	mobjPå
, 
CONST
 * 
	mf‹m©
, 
	mobjc
, T˛_Obj * CONST 
	mobjv
[]);

4141 
	mT˛_Obj
 * (*
	mt˛_ObjPrötf
Ë(
CONST
 * 
	mf‹m©
, ...);

4142 (*
	mt˛_AµídPrötfToObj
Ë(
T˛_Obj
 * 
	mobjPå
, 
CONST
 * 
	mf‹m©
, ...);

4143 } 
	tT˛Stubs
;

4145 #ifde‡
__˝lu•lus


4148 
T˛Stubs
 *
t˛StubsPå
;

4149 #ifde‡
__˝lu•lus


4153 #i‡
deföed
(
USE_TCL_STUBS
Ë&& !deföed(
USE_TCL_STUB_PROCS
)

4159 #i‚de‡
T˛_PkgProvideEx


4160 
	#T˛_PkgProvideEx
 \

4161 (
t˛StubsPå
->
t˛_PkgProvideEx
Ë

	)

4163 #i‚de‡
T˛_PkgRequúeEx


4164 
	#T˛_PkgRequúeEx
 \

4165 (
t˛StubsPå
->
t˛_PkgRequúeEx
Ë

	)

4167 #i‚de‡
T˛_P™ic


4168 
	#T˛_P™ic
 \

4169 (
t˛StubsPå
->
t˛_P™ic
Ë

	)

4171 #i‚de‡
T˛_AŒoc


4172 
	#T˛_AŒoc
 \

4173 (
t˛StubsPå
->
t˛_AŒoc
Ë

	)

4175 #i‚de‡
T˛_Fªe


4176 
	#T˛_Fªe
 \

4177 (
t˛StubsPå
->
t˛_Fªe
Ë

	)

4179 #i‚de‡
T˛_RóŒoc


4180 
	#T˛_RóŒoc
 \

4181 (
t˛StubsPå
->
t˛_RóŒoc
Ë

	)

4183 #i‚de‡
T˛_DbCkÆloc


4184 
	#T˛_DbCkÆloc
 \

4185 (
t˛StubsPå
->
t˛_DbCkÆloc
Ë

	)

4187 #i‚de‡
T˛_DbCk‰ì


4188 
	#T˛_DbCk‰ì
 \

4189 (
t˛StubsPå
->
t˛_DbCk‰ì
Ë

	)

4191 #i‚de‡
T˛_DbCkªÆloc


4192 
	#T˛_DbCkªÆloc
 \

4193 (
t˛StubsPå
->
t˛_DbCkªÆloc
Ë

	)

4195 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

4196 #i‚de‡
T˛_Cª©eFûeH™dÀr


4197 
	#T˛_Cª©eFûeH™dÀr
 \

4198 (
t˛StubsPå
->
t˛_Cª©eFûeH™dÀr
Ë

	)

4201 #ifde‡
MAC_OSX_TCL


4202 #i‚de‡
T˛_Cª©eFûeH™dÀr


4203 
	#T˛_Cª©eFûeH™dÀr
 \

4204 (
t˛StubsPå
->
t˛_Cª©eFûeH™dÀr
Ë

	)

4207 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

4208 #i‚de‡
T˛_DñëeFûeH™dÀr


4209 
	#T˛_DñëeFûeH™dÀr
 \

4210 (
t˛StubsPå
->
t˛_DñëeFûeH™dÀr
Ë

	)

4213 #ifde‡
MAC_OSX_TCL


4214 #i‚de‡
T˛_DñëeFûeH™dÀr


4215 
	#T˛_DñëeFûeH™dÀr
 \

4216 (
t˛StubsPå
->
t˛_DñëeFûeH™dÀr
Ë

	)

4219 #i‚de‡
T˛_SëTimî


4220 
	#T˛_SëTimî
 \

4221 (
t˛StubsPå
->
t˛_SëTimî
Ë

	)

4223 #i‚de‡
T˛_SÀï


4224 
	#T˛_SÀï
 \

4225 (
t˛StubsPå
->
t˛_SÀï
Ë

	)

4227 #i‚de‡
T˛_WaôF‹Evít


4228 
	#T˛_WaôF‹Evít
 \

4229 (
t˛StubsPå
->
t˛_WaôF‹Evít
Ë

	)

4231 #i‚de‡
T˛_AµídAŒObjTy≥s


4232 
	#T˛_AµídAŒObjTy≥s
 \

4233 (
t˛StubsPå
->
t˛_AµídAŒObjTy≥s
Ë

	)

4235 #i‚de‡
T˛_AµídSåögsToObj


4236 
	#T˛_AµídSåögsToObj
 \

4237 (
t˛StubsPå
->
t˛_AµídSåögsToObj
Ë

	)

4239 #i‚de‡
T˛_AµídToObj


4240 
	#T˛_AµídToObj
 \

4241 (
t˛StubsPå
->
t˛_AµídToObj
Ë

	)

4243 #i‚de‡
T˛_C⁄ˇtObj


4244 
	#T˛_C⁄ˇtObj
 \

4245 (
t˛StubsPå
->
t˛_C⁄ˇtObj
Ë

	)

4247 #i‚de‡
T˛_C⁄vîtToTy≥


4248 
	#T˛_C⁄vîtToTy≥
 \

4249 (
t˛StubsPå
->
t˛_C⁄vîtToTy≥
Ë

	)

4251 #i‚de‡
T˛_DbDe¸RefCou¡


4252 
	#T˛_DbDe¸RefCou¡
 \

4253 (
t˛StubsPå
->
t˛_DbDe¸RefCou¡
Ë

	)

4255 #i‚de‡
T˛_DbIn¸RefCou¡


4256 
	#T˛_DbIn¸RefCou¡
 \

4257 (
t˛StubsPå
->
t˛_DbIn¸RefCou¡
Ë

	)

4259 #i‚de‡
T˛_DbIsSh¨ed


4260 
	#T˛_DbIsSh¨ed
 \

4261 (
t˛StubsPå
->
t˛_DbIsSh¨ed
Ë

	)

4263 #i‚de‡
T˛_DbNewBoﬁónObj


4264 
	#T˛_DbNewBoﬁónObj
 \

4265 (
t˛StubsPå
->
t˛_DbNewBoﬁónObj
Ë

	)

4267 #i‚de‡
T˛_DbNewByãAºayObj


4268 
	#T˛_DbNewByãAºayObj
 \

4269 (
t˛StubsPå
->
t˛_DbNewByãAºayObj
Ë

	)

4271 #i‚de‡
T˛_DbNewDoubÀObj


4272 
	#T˛_DbNewDoubÀObj
 \

4273 (
t˛StubsPå
->
t˛_DbNewDoubÀObj
Ë

	)

4275 #i‚de‡
T˛_DbNewLi°Obj


4276 
	#T˛_DbNewLi°Obj
 \

4277 (
t˛StubsPå
->
t˛_DbNewLi°Obj
Ë

	)

4279 #i‚de‡
T˛_DbNewL⁄gObj


4280 
	#T˛_DbNewL⁄gObj
 \

4281 (
t˛StubsPå
->
t˛_DbNewL⁄gObj
Ë

	)

4283 #i‚de‡
T˛_DbNewObj


4284 
	#T˛_DbNewObj
 \

4285 (
t˛StubsPå
->
t˛_DbNewObj
Ë

	)

4287 #i‚de‡
T˛_DbNewSåögObj


4288 
	#T˛_DbNewSåögObj
 \

4289 (
t˛StubsPå
->
t˛_DbNewSåögObj
Ë

	)

4291 #i‚de‡
T˛_Du∂iˇãObj


4292 
	#T˛_Du∂iˇãObj
 \

4293 (
t˛StubsPå
->
t˛_Du∂iˇãObj
Ë

	)

4295 #i‚de‡
T˛FªeObj


4296 
	#T˛FªeObj
 \

4297 (
t˛StubsPå
->
t˛FªeObj
Ë

	)

4299 #i‚de‡
T˛_GëBoﬁón


4300 
	#T˛_GëBoﬁón
 \

4301 (
t˛StubsPå
->
t˛_GëBoﬁón
Ë

	)

4303 #i‚de‡
T˛_GëBoﬁónFromObj


4304 
	#T˛_GëBoﬁónFromObj
 \

4305 (
t˛StubsPå
->
t˛_GëBoﬁónFromObj
Ë

	)

4307 #i‚de‡
T˛_GëByãAºayFromObj


4308 
	#T˛_GëByãAºayFromObj
 \

4309 (
t˛StubsPå
->
t˛_GëByãAºayFromObj
Ë

	)

4311 #i‚de‡
T˛_GëDoubÀ


4312 
	#T˛_GëDoubÀ
 \

4313 (
t˛StubsPå
->
t˛_GëDoubÀ
Ë

	)

4315 #i‚de‡
T˛_GëDoubÀFromObj


4316 
	#T˛_GëDoubÀFromObj
 \

4317 (
t˛StubsPå
->
t˛_GëDoubÀFromObj
Ë

	)

4319 #i‚de‡
T˛_GëIndexFromObj


4320 
	#T˛_GëIndexFromObj
 \

4321 (
t˛StubsPå
->
t˛_GëIndexFromObj
Ë

	)

4323 #i‚de‡
T˛_GëI¡


4324 
	#T˛_GëI¡
 \

4325 (
t˛StubsPå
->
t˛_GëI¡
Ë

	)

4327 #i‚de‡
T˛_GëI¡FromObj


4328 
	#T˛_GëI¡FromObj
 \

4329 (
t˛StubsPå
->
t˛_GëI¡FromObj
Ë

	)

4331 #i‚de‡
T˛_GëL⁄gFromObj


4332 
	#T˛_GëL⁄gFromObj
 \

4333 (
t˛StubsPå
->
t˛_GëL⁄gFromObj
Ë

	)

4335 #i‚de‡
T˛_GëObjTy≥


4336 
	#T˛_GëObjTy≥
 \

4337 (
t˛StubsPå
->
t˛_GëObjTy≥
Ë

	)

4339 #i‚de‡
T˛_GëSåögFromObj


4340 
	#T˛_GëSåögFromObj
 \

4341 (
t˛StubsPå
->
t˛_GëSåögFromObj
Ë

	)

4343 #i‚de‡
T˛_InvÆid©eSåögRï


4344 
	#T˛_InvÆid©eSåögRï
 \

4345 (
t˛StubsPå
->
t˛_InvÆid©eSåögRï
Ë

	)

4347 #i‚de‡
T˛_Li°ObjAµídLi°


4348 
	#T˛_Li°ObjAµídLi°
 \

4349 (
t˛StubsPå
->
t˛_Li°ObjAµídLi°
Ë

	)

4351 #i‚de‡
T˛_Li°ObjAµídEÀmít


4352 
	#T˛_Li°ObjAµídEÀmít
 \

4353 (
t˛StubsPå
->
t˛_Li°ObjAµídEÀmít
Ë

	)

4355 #i‚de‡
T˛_Li°ObjGëEÀmíts


4356 
	#T˛_Li°ObjGëEÀmíts
 \

4357 (
t˛StubsPå
->
t˛_Li°ObjGëEÀmíts
Ë

	)

4359 #i‚de‡
T˛_Li°ObjIndex


4360 
	#T˛_Li°ObjIndex
 \

4361 (
t˛StubsPå
->
t˛_Li°ObjIndex
Ë

	)

4363 #i‚de‡
T˛_Li°ObjLígth


4364 
	#T˛_Li°ObjLígth
 \

4365 (
t˛StubsPå
->
t˛_Li°ObjLígth
Ë

	)

4367 #i‚de‡
T˛_Li°ObjRïœ˚


4368 
	#T˛_Li°ObjRïœ˚
 \

4369 (
t˛StubsPå
->
t˛_Li°ObjRïœ˚
Ë

	)

4371 #i‚de‡
T˛_NewBoﬁónObj


4372 
	#T˛_NewBoﬁónObj
 \

4373 (
t˛StubsPå
->
t˛_NewBoﬁónObj
Ë

	)

4375 #i‚de‡
T˛_NewByãAºayObj


4376 
	#T˛_NewByãAºayObj
 \

4377 (
t˛StubsPå
->
t˛_NewByãAºayObj
Ë

	)

4379 #i‚de‡
T˛_NewDoubÀObj


4380 
	#T˛_NewDoubÀObj
 \

4381 (
t˛StubsPå
->
t˛_NewDoubÀObj
Ë

	)

4383 #i‚de‡
T˛_NewI¡Obj


4384 
	#T˛_NewI¡Obj
 \

4385 (
t˛StubsPå
->
t˛_NewI¡Obj
Ë

	)

4387 #i‚de‡
T˛_NewLi°Obj


4388 
	#T˛_NewLi°Obj
 \

4389 (
t˛StubsPå
->
t˛_NewLi°Obj
Ë

	)

4391 #i‚de‡
T˛_NewL⁄gObj


4392 
	#T˛_NewL⁄gObj
 \

4393 (
t˛StubsPå
->
t˛_NewL⁄gObj
Ë

	)

4395 #i‚de‡
T˛_NewObj


4396 
	#T˛_NewObj
 \

4397 (
t˛StubsPå
->
t˛_NewObj
Ë

	)

4399 #i‚de‡
T˛_NewSåögObj


4400 
	#T˛_NewSåögObj
 \

4401 (
t˛StubsPå
->
t˛_NewSåögObj
Ë

	)

4403 #i‚de‡
T˛_SëBoﬁónObj


4404 
	#T˛_SëBoﬁónObj
 \

4405 (
t˛StubsPå
->
t˛_SëBoﬁónObj
Ë

	)

4407 #i‚de‡
T˛_SëByãAºayLígth


4408 
	#T˛_SëByãAºayLígth
 \

4409 (
t˛StubsPå
->
t˛_SëByãAºayLígth
Ë

	)

4411 #i‚de‡
T˛_SëByãAºayObj


4412 
	#T˛_SëByãAºayObj
 \

4413 (
t˛StubsPå
->
t˛_SëByãAºayObj
Ë

	)

4415 #i‚de‡
T˛_SëDoubÀObj


4416 
	#T˛_SëDoubÀObj
 \

4417 (
t˛StubsPå
->
t˛_SëDoubÀObj
Ë

	)

4419 #i‚de‡
T˛_SëI¡Obj


4420 
	#T˛_SëI¡Obj
 \

4421 (
t˛StubsPå
->
t˛_SëI¡Obj
Ë

	)

4423 #i‚de‡
T˛_SëLi°Obj


4424 
	#T˛_SëLi°Obj
 \

4425 (
t˛StubsPå
->
t˛_SëLi°Obj
Ë

	)

4427 #i‚de‡
T˛_SëL⁄gObj


4428 
	#T˛_SëL⁄gObj
 \

4429 (
t˛StubsPå
->
t˛_SëL⁄gObj
Ë

	)

4431 #i‚de‡
T˛_SëObjLígth


4432 
	#T˛_SëObjLígth
 \

4433 (
t˛StubsPå
->
t˛_SëObjLígth
Ë

	)

4435 #i‚de‡
T˛_SëSåögObj


4436 
	#T˛_SëSåögObj
 \

4437 (
t˛StubsPå
->
t˛_SëSåögObj
Ë

	)

4439 #i‚de‡
T˛_AddEº‹Info


4440 
	#T˛_AddEº‹Info
 \

4441 (
t˛StubsPå
->
t˛_AddEº‹Info
Ë

	)

4443 #i‚de‡
T˛_AddObjEº‹Info


4444 
	#T˛_AddObjEº‹Info
 \

4445 (
t˛StubsPå
->
t˛_AddObjEº‹Info
Ë

	)

4447 #i‚de‡
T˛_AŒowEx˚±i⁄s


4448 
	#T˛_AŒowEx˚±i⁄s
 \

4449 (
t˛StubsPå
->
t˛_AŒowEx˚±i⁄s
Ë

	)

4451 #i‚de‡
T˛_AµídEÀmít


4452 
	#T˛_AµídEÀmít
 \

4453 (
t˛StubsPå
->
t˛_AµídEÀmít
Ë

	)

4455 #i‚de‡
T˛_AµídResu…


4456 
	#T˛_AµídResu…
 \

4457 (
t˛StubsPå
->
t˛_AµídResu…
Ë

	)

4459 #i‚de‡
T˛_AsyncCª©e


4460 
	#T˛_AsyncCª©e
 \

4461 (
t˛StubsPå
->
t˛_AsyncCª©e
Ë

	)

4463 #i‚de‡
T˛_AsyncDñëe


4464 
	#T˛_AsyncDñëe
 \

4465 (
t˛StubsPå
->
t˛_AsyncDñëe
Ë

	)

4467 #i‚de‡
T˛_AsyncInvoke


4468 
	#T˛_AsyncInvoke
 \

4469 (
t˛StubsPå
->
t˛_AsyncInvoke
Ë

	)

4471 #i‚de‡
T˛_AsyncM¨k


4472 
	#T˛_AsyncM¨k
 \

4473 (
t˛StubsPå
->
t˛_AsyncM¨k
Ë

	)

4475 #i‚de‡
T˛_AsyncRódy


4476 
	#T˛_AsyncRódy
 \

4477 (
t˛StubsPå
->
t˛_AsyncRódy
Ë

	)

4479 #i‚de‡
T˛_BackgroundEº‹


4480 
	#T˛_BackgroundEº‹
 \

4481 (
t˛StubsPå
->
t˛_BackgroundEº‹
Ë

	)

4483 #i‚de‡
T˛_Back¶ash


4484 
	#T˛_Back¶ash
 \

4485 (
t˛StubsPå
->
t˛_Back¶ash
Ë

	)

4487 #i‚de‡
T˛_BadCh™√lO±i⁄


4488 
	#T˛_BadCh™√lO±i⁄
 \

4489 (
t˛StubsPå
->
t˛_BadCh™√lO±i⁄
Ë

	)

4491 #i‚de‡
T˛_CÆlWhíDñëed


4492 
	#T˛_CÆlWhíDñëed
 \

4493 (
t˛StubsPå
->
t˛_CÆlWhíDñëed
Ë

	)

4495 #i‚de‡
T˛_C™˚lIdÀCÆl


4496 
	#T˛_C™˚lIdÀCÆl
 \

4497 (
t˛StubsPå
->
t˛_C™˚lIdÀCÆl
Ë

	)

4499 #i‚de‡
T˛_Clo£


4500 
	#T˛_Clo£
 \

4501 (
t˛StubsPå
->
t˛_Clo£
Ë

	)

4503 #i‚de‡
T˛_Comm™dCom∂ëe


4504 
	#T˛_Comm™dCom∂ëe
 \

4505 (
t˛StubsPå
->
t˛_Comm™dCom∂ëe
Ë

	)

4507 #i‚de‡
T˛_C⁄ˇt


4508 
	#T˛_C⁄ˇt
 \

4509 (
t˛StubsPå
->
t˛_C⁄ˇt
Ë

	)

4511 #i‚de‡
T˛_C⁄vîtEÀmít


4512 
	#T˛_C⁄vîtEÀmít
 \

4513 (
t˛StubsPå
->
t˛_C⁄vîtEÀmít
Ë

	)

4515 #i‚de‡
T˛_C⁄vîtCou¡edEÀmít


4516 
	#T˛_C⁄vîtCou¡edEÀmít
 \

4517 (
t˛StubsPå
->
t˛_C⁄vîtCou¡edEÀmít
Ë

	)

4519 #i‚de‡
T˛_Cª©eAlüs


4520 
	#T˛_Cª©eAlüs
 \

4521 (
t˛StubsPå
->
t˛_Cª©eAlüs
Ë

	)

4523 #i‚de‡
T˛_Cª©eAlüsObj


4524 
	#T˛_Cª©eAlüsObj
 \

4525 (
t˛StubsPå
->
t˛_Cª©eAlüsObj
Ë

	)

4527 #i‚de‡
T˛_Cª©eCh™√l


4528 
	#T˛_Cª©eCh™√l
 \

4529 (
t˛StubsPå
->
t˛_Cª©eCh™√l
Ë

	)

4531 #i‚de‡
T˛_Cª©eCh™√lH™dÀr


4532 
	#T˛_Cª©eCh™√lH™dÀr
 \

4533 (
t˛StubsPå
->
t˛_Cª©eCh™√lH™dÀr
Ë

	)

4535 #i‚de‡
T˛_Cª©eClo£H™dÀr


4536 
	#T˛_Cª©eClo£H™dÀr
 \

4537 (
t˛StubsPå
->
t˛_Cª©eClo£H™dÀr
Ë

	)

4539 #i‚de‡
T˛_Cª©eComm™d


4540 
	#T˛_Cª©eComm™d
 \

4541 (
t˛StubsPå
->
t˛_Cª©eComm™d
Ë

	)

4543 #i‚de‡
T˛_Cª©eEvítSour˚


4544 
	#T˛_Cª©eEvítSour˚
 \

4545 (
t˛StubsPå
->
t˛_Cª©eEvítSour˚
Ë

	)

4547 #i‚de‡
T˛_Cª©eExôH™dÀr


4548 
	#T˛_Cª©eExôH™dÀr
 \

4549 (
t˛StubsPå
->
t˛_Cª©eExôH™dÀr
Ë

	)

4551 #i‚de‡
T˛_Cª©eI¡îp


4552 
	#T˛_Cª©eI¡îp
 \

4553 (
t˛StubsPå
->
t˛_Cª©eI¡îp
Ë

	)

4555 #i‚de‡
T˛_Cª©eM©hFunc


4556 
	#T˛_Cª©eM©hFunc
 \

4557 (
t˛StubsPå
->
t˛_Cª©eM©hFunc
Ë

	)

4559 #i‚de‡
T˛_Cª©eObjComm™d


4560 
	#T˛_Cª©eObjComm™d
 \

4561 (
t˛StubsPå
->
t˛_Cª©eObjComm™d
Ë

	)

4563 #i‚de‡
T˛_Cª©eSœve


4564 
	#T˛_Cª©eSœve
 \

4565 (
t˛StubsPå
->
t˛_Cª©eSœve
Ë

	)

4567 #i‚de‡
T˛_Cª©eTimîH™dÀr


4568 
	#T˛_Cª©eTimîH™dÀr
 \

4569 (
t˛StubsPå
->
t˛_Cª©eTimîH™dÀr
Ë

	)

4571 #i‚de‡
T˛_Cª©eTø˚


4572 
	#T˛_Cª©eTø˚
 \

4573 (
t˛StubsPå
->
t˛_Cª©eTø˚
Ë

	)

4575 #i‚de‡
T˛_DñëeAssocD©a


4576 
	#T˛_DñëeAssocD©a
 \

4577 (
t˛StubsPå
->
t˛_DñëeAssocD©a
Ë

	)

4579 #i‚de‡
T˛_DñëeCh™√lH™dÀr


4580 
	#T˛_DñëeCh™√lH™dÀr
 \

4581 (
t˛StubsPå
->
t˛_DñëeCh™√lH™dÀr
Ë

	)

4583 #i‚de‡
T˛_DñëeClo£H™dÀr


4584 
	#T˛_DñëeClo£H™dÀr
 \

4585 (
t˛StubsPå
->
t˛_DñëeClo£H™dÀr
Ë

	)

4587 #i‚de‡
T˛_DñëeComm™d


4588 
	#T˛_DñëeComm™d
 \

4589 (
t˛StubsPå
->
t˛_DñëeComm™d
Ë

	)

4591 #i‚de‡
T˛_DñëeComm™dFromTokí


4592 
	#T˛_DñëeComm™dFromTokí
 \

4593 (
t˛StubsPå
->
t˛_DñëeComm™dFromTokí
Ë

	)

4595 #i‚de‡
T˛_DñëeEvíts


4596 
	#T˛_DñëeEvíts
 \

4597 (
t˛StubsPå
->
t˛_DñëeEvíts
Ë

	)

4599 #i‚de‡
T˛_DñëeEvítSour˚


4600 
	#T˛_DñëeEvítSour˚
 \

4601 (
t˛StubsPå
->
t˛_DñëeEvítSour˚
Ë

	)

4603 #i‚de‡
T˛_DñëeExôH™dÀr


4604 
	#T˛_DñëeExôH™dÀr
 \

4605 (
t˛StubsPå
->
t˛_DñëeExôH™dÀr
Ë

	)

4607 #i‚de‡
T˛_DñëeHashE¡ry


4608 
	#T˛_DñëeHashE¡ry
 \

4609 (
t˛StubsPå
->
t˛_DñëeHashE¡ry
Ë

	)

4611 #i‚de‡
T˛_DñëeHashTabÀ


4612 
	#T˛_DñëeHashTabÀ
 \

4613 (
t˛StubsPå
->
t˛_DñëeHashTabÀ
Ë

	)

4615 #i‚de‡
T˛_DñëeI¡îp


4616 
	#T˛_DñëeI¡îp
 \

4617 (
t˛StubsPå
->
t˛_DñëeI¡îp
Ë

	)

4619 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

4620 #i‚de‡
T˛_DëachPids


4621 
	#T˛_DëachPids
 \

4622 (
t˛StubsPå
->
t˛_DëachPids
Ë

	)

4625 #ifde‡
__WIN32__


4626 #i‚de‡
T˛_DëachPids


4627 
	#T˛_DëachPids
 \

4628 (
t˛StubsPå
->
t˛_DëachPids
Ë

	)

4631 #ifde‡
MAC_OSX_TCL


4632 #i‚de‡
T˛_DëachPids


4633 
	#T˛_DëachPids
 \

4634 (
t˛StubsPå
->
t˛_DëachPids
Ë

	)

4637 #i‚de‡
T˛_DñëeTimîH™dÀr


4638 
	#T˛_DñëeTimîH™dÀr
 \

4639 (
t˛StubsPå
->
t˛_DñëeTimîH™dÀr
Ë

	)

4641 #i‚de‡
T˛_DñëeTø˚


4642 
	#T˛_DñëeTø˚
 \

4643 (
t˛StubsPå
->
t˛_DñëeTø˚
Ë

	)

4645 #i‚de‡
T˛_D⁄tCÆlWhíDñëed


4646 
	#T˛_D⁄tCÆlWhíDñëed
 \

4647 (
t˛StubsPå
->
t˛_D⁄tCÆlWhíDñëed
Ë

	)

4649 #i‚de‡
T˛_DoO√Evít


4650 
	#T˛_DoO√Evít
 \

4651 (
t˛StubsPå
->
t˛_DoO√Evít
Ë

	)

4653 #i‚de‡
T˛_DoWhíIdÀ


4654 
	#T˛_DoWhíIdÀ
 \

4655 (
t˛StubsPå
->
t˛_DoWhíIdÀ
Ë

	)

4657 #i‚de‡
T˛_DSåögAµíd


4658 
	#T˛_DSåögAµíd
 \

4659 (
t˛StubsPå
->
t˛_DSåögAµíd
Ë

	)

4661 #i‚de‡
T˛_DSåögAµídEÀmít


4662 
	#T˛_DSåögAµídEÀmít
 \

4663 (
t˛StubsPå
->
t˛_DSåögAµídEÀmít
Ë

	)

4665 #i‚de‡
T˛_DSåögEndSubli°


4666 
	#T˛_DSåögEndSubli°
 \

4667 (
t˛StubsPå
->
t˛_DSåögEndSubli°
Ë

	)

4669 #i‚de‡
T˛_DSåögFªe


4670 
	#T˛_DSåögFªe
 \

4671 (
t˛StubsPå
->
t˛_DSåögFªe
Ë

	)

4673 #i‚de‡
T˛_DSåögGëResu…


4674 
	#T˛_DSåögGëResu…
 \

4675 (
t˛StubsPå
->
t˛_DSåögGëResu…
Ë

	)

4677 #i‚de‡
T˛_DSåögInô


4678 
	#T˛_DSåögInô
 \

4679 (
t˛StubsPå
->
t˛_DSåögInô
Ë

	)

4681 #i‚de‡
T˛_DSåögResu…


4682 
	#T˛_DSåögResu…
 \

4683 (
t˛StubsPå
->
t˛_DSåögResu…
Ë

	)

4685 #i‚de‡
T˛_DSåögSëLígth


4686 
	#T˛_DSåögSëLígth
 \

4687 (
t˛StubsPå
->
t˛_DSåögSëLígth
Ë

	)

4689 #i‚de‡
T˛_DSåögSèπSubli°


4690 
	#T˛_DSåögSèπSubli°
 \

4691 (
t˛StubsPå
->
t˛_DSåögSèπSubli°
Ë

	)

4693 #i‚de‡
T˛_Eof


4694 
	#T˛_Eof
 \

4695 (
t˛StubsPå
->
t˛_Eof
Ë

	)

4697 #i‚de‡
T˛_EºnoId


4698 
	#T˛_EºnoId
 \

4699 (
t˛StubsPå
->
t˛_EºnoId
Ë

	)

4701 #i‚de‡
T˛_EºnoMsg


4702 
	#T˛_EºnoMsg
 \

4703 (
t˛StubsPå
->
t˛_EºnoMsg
Ë

	)

4705 #i‚de‡
T˛_EvÆ


4706 
	#T˛_EvÆ
 \

4707 (
t˛StubsPå
->
t˛_EvÆ
Ë

	)

4709 #i‚de‡
T˛_EvÆFûe


4710 
	#T˛_EvÆFûe
 \

4711 (
t˛StubsPå
->
t˛_EvÆFûe
Ë

	)

4713 #i‚de‡
T˛_EvÆObj


4714 
	#T˛_EvÆObj
 \

4715 (
t˛StubsPå
->
t˛_EvÆObj
Ë

	)

4717 #i‚de‡
T˛_EvítuÆlyFªe


4718 
	#T˛_EvítuÆlyFªe
 \

4719 (
t˛StubsPå
->
t˛_EvítuÆlyFªe
Ë

	)

4721 #i‚de‡
T˛_Exô


4722 
	#T˛_Exô
 \

4723 (
t˛StubsPå
->
t˛_Exô
Ë

	)

4725 #i‚de‡
T˛_Expo£Comm™d


4726 
	#T˛_Expo£Comm™d
 \

4727 (
t˛StubsPå
->
t˛_Expo£Comm™d
Ë

	)

4729 #i‚de‡
T˛_Ex¥Boﬁón


4730 
	#T˛_Ex¥Boﬁón
 \

4731 (
t˛StubsPå
->
t˛_Ex¥Boﬁón
Ë

	)

4733 #i‚de‡
T˛_Ex¥BoﬁónObj


4734 
	#T˛_Ex¥BoﬁónObj
 \

4735 (
t˛StubsPå
->
t˛_Ex¥BoﬁónObj
Ë

	)

4737 #i‚de‡
T˛_Ex¥DoubÀ


4738 
	#T˛_Ex¥DoubÀ
 \

4739 (
t˛StubsPå
->
t˛_Ex¥DoubÀ
Ë

	)

4741 #i‚de‡
T˛_Ex¥DoubÀObj


4742 
	#T˛_Ex¥DoubÀObj
 \

4743 (
t˛StubsPå
->
t˛_Ex¥DoubÀObj
Ë

	)

4745 #i‚de‡
T˛_Ex¥L⁄g


4746 
	#T˛_Ex¥L⁄g
 \

4747 (
t˛StubsPå
->
t˛_Ex¥L⁄g
Ë

	)

4749 #i‚de‡
T˛_Ex¥L⁄gObj


4750 
	#T˛_Ex¥L⁄gObj
 \

4751 (
t˛StubsPå
->
t˛_Ex¥L⁄gObj
Ë

	)

4753 #i‚de‡
T˛_Ex¥Obj


4754 
	#T˛_Ex¥Obj
 \

4755 (
t˛StubsPå
->
t˛_Ex¥Obj
Ë

	)

4757 #i‚de‡
T˛_Ex¥Såög


4758 
	#T˛_Ex¥Såög
 \

4759 (
t˛StubsPå
->
t˛_Ex¥Såög
Ë

	)

4761 #i‚de‡
T˛_FöÆize


4762 
	#T˛_FöÆize
 \

4763 (
t˛StubsPå
->
t˛_FöÆize
Ë

	)

4765 #i‚de‡
T˛_FödExecuèbÀ


4766 
	#T˛_FödExecuèbÀ
 \

4767 (
t˛StubsPå
->
t˛_FödExecuèbÀ
Ë

	)

4769 #i‚de‡
T˛_Fú°HashE¡ry


4770 
	#T˛_Fú°HashE¡ry
 \

4771 (
t˛StubsPå
->
t˛_Fú°HashE¡ry
Ë

	)

4773 #i‚de‡
T˛_Flush


4774 
	#T˛_Flush
 \

4775 (
t˛StubsPå
->
t˛_Flush
Ë

	)

4777 #i‚de‡
T˛_FªeResu…


4778 
	#T˛_FªeResu…
 \

4779 (
t˛StubsPå
->
t˛_FªeResu…
Ë

	)

4781 #i‚de‡
T˛_GëAlüs


4782 
	#T˛_GëAlüs
 \

4783 (
t˛StubsPå
->
t˛_GëAlüs
Ë

	)

4785 #i‚de‡
T˛_GëAlüsObj


4786 
	#T˛_GëAlüsObj
 \

4787 (
t˛StubsPå
->
t˛_GëAlüsObj
Ë

	)

4789 #i‚de‡
T˛_GëAssocD©a


4790 
	#T˛_GëAssocD©a
 \

4791 (
t˛StubsPå
->
t˛_GëAssocD©a
Ë

	)

4793 #i‚de‡
T˛_GëCh™√l


4794 
	#T˛_GëCh™√l
 \

4795 (
t˛StubsPå
->
t˛_GëCh™√l
Ë

	)

4797 #i‚de‡
T˛_GëCh™√lBuf„rSize


4798 
	#T˛_GëCh™√lBuf„rSize
 \

4799 (
t˛StubsPå
->
t˛_GëCh™√lBuf„rSize
Ë

	)

4801 #i‚de‡
T˛_GëCh™√lH™dÀ


4802 
	#T˛_GëCh™√lH™dÀ
 \

4803 (
t˛StubsPå
->
t˛_GëCh™√lH™dÀ
Ë

	)

4805 #i‚de‡
T˛_GëCh™√lIn°™˚D©a


4806 
	#T˛_GëCh™√lIn°™˚D©a
 \

4807 (
t˛StubsPå
->
t˛_GëCh™√lIn°™˚D©a
Ë

	)

4809 #i‚de‡
T˛_GëCh™√lMode


4810 
	#T˛_GëCh™√lMode
 \

4811 (
t˛StubsPå
->
t˛_GëCh™√lMode
Ë

	)

4813 #i‚de‡
T˛_GëCh™√lName


4814 
	#T˛_GëCh™√lName
 \

4815 (
t˛StubsPå
->
t˛_GëCh™√lName
Ë

	)

4817 #i‚de‡
T˛_GëCh™√lO±i⁄


4818 
	#T˛_GëCh™√lO±i⁄
 \

4819 (
t˛StubsPå
->
t˛_GëCh™√lO±i⁄
Ë

	)

4821 #i‚de‡
T˛_GëCh™√lTy≥


4822 
	#T˛_GëCh™√lTy≥
 \

4823 (
t˛StubsPå
->
t˛_GëCh™√lTy≥
Ë

	)

4825 #i‚de‡
T˛_GëComm™dInfo


4826 
	#T˛_GëComm™dInfo
 \

4827 (
t˛StubsPå
->
t˛_GëComm™dInfo
Ë

	)

4829 #i‚de‡
T˛_GëComm™dName


4830 
	#T˛_GëComm™dName
 \

4831 (
t˛StubsPå
->
t˛_GëComm™dName
Ë

	)

4833 #i‚de‡
T˛_GëEºno


4834 
	#T˛_GëEºno
 \

4835 (
t˛StubsPå
->
t˛_GëEºno
Ë

	)

4837 #i‚de‡
T˛_GëHo°Name


4838 
	#T˛_GëHo°Name
 \

4839 (
t˛StubsPå
->
t˛_GëHo°Name
Ë

	)

4841 #i‚de‡
T˛_GëI¡îpP©h


4842 
	#T˛_GëI¡îpP©h
 \

4843 (
t˛StubsPå
->
t˛_GëI¡îpP©h
Ë

	)

4845 #i‚de‡
T˛_GëMa°î


4846 
	#T˛_GëMa°î
 \

4847 (
t˛StubsPå
->
t˛_GëMa°î
Ë

	)

4849 #i‚de‡
T˛_GëNameOfExecuèbÀ


4850 
	#T˛_GëNameOfExecuèbÀ
 \

4851 (
t˛StubsPå
->
t˛_GëNameOfExecuèbÀ
Ë

	)

4853 #i‚de‡
T˛_GëObjResu…


4854 
	#T˛_GëObjResu…
 \

4855 (
t˛StubsPå
->
t˛_GëObjResu…
Ë

	)

4857 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

4858 #i‚de‡
T˛_GëO≥nFûe


4859 
	#T˛_GëO≥nFûe
 \

4860 (
t˛StubsPå
->
t˛_GëO≥nFûe
Ë

	)

4863 #ifde‡
MAC_OSX_TCL


4864 #i‚de‡
T˛_GëO≥nFûe


4865 
	#T˛_GëO≥nFûe
 \

4866 (
t˛StubsPå
->
t˛_GëO≥nFûe
Ë

	)

4869 #i‚de‡
T˛_GëP©hTy≥


4870 
	#T˛_GëP©hTy≥
 \

4871 (
t˛StubsPå
->
t˛_GëP©hTy≥
Ë

	)

4873 #i‚de‡
T˛_Gës


4874 
	#T˛_Gës
 \

4875 (
t˛StubsPå
->
t˛_Gës
Ë

	)

4877 #i‚de‡
T˛_GësObj


4878 
	#T˛_GësObj
 \

4879 (
t˛StubsPå
->
t˛_GësObj
Ë

	)

4881 #i‚de‡
T˛_GëSîvi˚Mode


4882 
	#T˛_GëSîvi˚Mode
 \

4883 (
t˛StubsPå
->
t˛_GëSîvi˚Mode
Ë

	)

4885 #i‚de‡
T˛_GëSœve


4886 
	#T˛_GëSœve
 \

4887 (
t˛StubsPå
->
t˛_GëSœve
Ë

	)

4889 #i‚de‡
T˛_GëStdCh™√l


4890 
	#T˛_GëStdCh™√l
 \

4891 (
t˛StubsPå
->
t˛_GëStdCh™√l
Ë

	)

4893 #i‚de‡
T˛_GëSåögResu…


4894 
	#T˛_GëSåögResu…
 \

4895 (
t˛StubsPå
->
t˛_GëSåögResu…
Ë

	)

4897 #i‚de‡
T˛_GëV¨


4898 
	#T˛_GëV¨
 \

4899 (
t˛StubsPå
->
t˛_GëV¨
Ë

	)

4901 #i‚de‡
T˛_GëV¨2


4902 
	#T˛_GëV¨2
 \

4903 (
t˛StubsPå
->
t˛_GëV¨2
Ë

	)

4905 #i‚de‡
T˛_GlobÆEvÆ


4906 
	#T˛_GlobÆEvÆ
 \

4907 (
t˛StubsPå
->
t˛_GlobÆEvÆ
Ë

	)

4909 #i‚de‡
T˛_GlobÆEvÆObj


4910 
	#T˛_GlobÆEvÆObj
 \

4911 (
t˛StubsPå
->
t˛_GlobÆEvÆObj
Ë

	)

4913 #i‚de‡
T˛_HideComm™d


4914 
	#T˛_HideComm™d
 \

4915 (
t˛StubsPå
->
t˛_HideComm™d
Ë

	)

4917 #i‚de‡
T˛_Inô


4918 
	#T˛_Inô
 \

4919 (
t˛StubsPå
->
t˛_Inô
Ë

	)

4921 #i‚de‡
T˛_InôHashTabÀ


4922 
	#T˛_InôHashTabÀ
 \

4923 (
t˛StubsPå
->
t˛_InôHashTabÀ
Ë

	)

4925 #i‚de‡
T˛_I≈utBlocked


4926 
	#T˛_I≈utBlocked
 \

4927 (
t˛StubsPå
->
t˛_I≈utBlocked
Ë

	)

4929 #i‚de‡
T˛_I≈utBuf„ªd


4930 
	#T˛_I≈utBuf„ªd
 \

4931 (
t˛StubsPå
->
t˛_I≈utBuf„ªd
Ë

	)

4933 #i‚de‡
T˛_I¡îpDñëed


4934 
	#T˛_I¡îpDñëed
 \

4935 (
t˛StubsPå
->
t˛_I¡îpDñëed
Ë

	)

4937 #i‚de‡
T˛_IsSa„


4938 
	#T˛_IsSa„
 \

4939 (
t˛StubsPå
->
t˛_IsSa„
Ë

	)

4941 #i‚de‡
T˛_JoöP©h


4942 
	#T˛_JoöP©h
 \

4943 (
t˛StubsPå
->
t˛_JoöP©h
Ë

	)

4945 #i‚de‡
T˛_LökV¨


4946 
	#T˛_LökV¨
 \

4947 (
t˛StubsPå
->
t˛_LökV¨
Ë

	)

4950 #i‚de‡
T˛_MakeFûeCh™√l


4951 
	#T˛_MakeFûeCh™√l
 \

4952 (
t˛StubsPå
->
t˛_MakeFûeCh™√l
Ë

	)

4954 #i‚de‡
T˛_MakeSa„


4955 
	#T˛_MakeSa„
 \

4956 (
t˛StubsPå
->
t˛_MakeSa„
Ë

	)

4958 #i‚de‡
T˛_MakeT˝Clõ¡Ch™√l


4959 
	#T˛_MakeT˝Clõ¡Ch™√l
 \

4960 (
t˛StubsPå
->
t˛_MakeT˝Clõ¡Ch™√l
Ë

	)

4962 #i‚de‡
T˛_Mîge


4963 
	#T˛_Mîge
 \

4964 (
t˛StubsPå
->
t˛_Mîge
Ë

	)

4966 #i‚de‡
T˛_NextHashE¡ry


4967 
	#T˛_NextHashE¡ry
 \

4968 (
t˛StubsPå
->
t˛_NextHashE¡ry
Ë

	)

4970 #i‚de‡
T˛_NŸifyCh™√l


4971 
	#T˛_NŸifyCh™√l
 \

4972 (
t˛StubsPå
->
t˛_NŸifyCh™√l
Ë

	)

4974 #i‚de‡
T˛_ObjGëV¨2


4975 
	#T˛_ObjGëV¨2
 \

4976 (
t˛StubsPå
->
t˛_ObjGëV¨2
Ë

	)

4978 #i‚de‡
T˛_ObjSëV¨2


4979 
	#T˛_ObjSëV¨2
 \

4980 (
t˛StubsPå
->
t˛_ObjSëV¨2
Ë

	)

4982 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

4983 #i‚de‡
T˛_O≥nComm™dCh™√l


4984 
	#T˛_O≥nComm™dCh™√l
 \

4985 (
t˛StubsPå
->
t˛_O≥nComm™dCh™√l
Ë

	)

4988 #ifde‡
__WIN32__


4989 #i‚de‡
T˛_O≥nComm™dCh™√l


4990 
	#T˛_O≥nComm™dCh™√l
 \

4991 (
t˛StubsPå
->
t˛_O≥nComm™dCh™√l
Ë

	)

4994 #ifde‡
MAC_OSX_TCL


4995 #i‚de‡
T˛_O≥nComm™dCh™√l


4996 
	#T˛_O≥nComm™dCh™√l
 \

4997 (
t˛StubsPå
->
t˛_O≥nComm™dCh™√l
Ë

	)

5000 #i‚de‡
T˛_O≥nFûeCh™√l


5001 
	#T˛_O≥nFûeCh™√l
 \

5002 (
t˛StubsPå
->
t˛_O≥nFûeCh™√l
Ë

	)

5004 #i‚de‡
T˛_O≥nT˝Clõ¡


5005 
	#T˛_O≥nT˝Clõ¡
 \

5006 (
t˛StubsPå
->
t˛_O≥nT˝Clõ¡
Ë

	)

5008 #i‚de‡
T˛_O≥nT˝Sîvî


5009 
	#T˛_O≥nT˝Sîvî
 \

5010 (
t˛StubsPå
->
t˛_O≥nT˝Sîvî
Ë

	)

5012 #i‚de‡
T˛_Pª£rve


5013 
	#T˛_Pª£rve
 \

5014 (
t˛StubsPå
->
t˛_Pª£rve
Ë

	)

5016 #i‚de‡
T˛_PrötDoubÀ


5017 
	#T˛_PrötDoubÀ
 \

5018 (
t˛StubsPå
->
t˛_PrötDoubÀ
Ë

	)

5020 #i‚de‡
T˛_PutEnv


5021 
	#T˛_PutEnv
 \

5022 (
t˛StubsPå
->
t˛_PutEnv
Ë

	)

5024 #i‚de‡
T˛_PosixEº‹


5025 
	#T˛_PosixEº‹
 \

5026 (
t˛StubsPå
->
t˛_PosixEº‹
Ë

	)

5028 #i‚de‡
T˛_QueueEvít


5029 
	#T˛_QueueEvít
 \

5030 (
t˛StubsPå
->
t˛_QueueEvít
Ë

	)

5032 #i‚de‡
T˛_Ród


5033 
	#T˛_Ród
 \

5034 (
t˛StubsPå
->
t˛_Ród
Ë

	)

5036 #i‡!
deföed
(
__WIN32__
Ë&& !deföed(
MAC_OSX_TCL
)

5037 #i‚de‡
T˛_RópDëachedProcs


5038 
	#T˛_RópDëachedProcs
 \

5039 (
t˛StubsPå
->
t˛_RópDëachedProcs
Ë

	)

5042 #ifde‡
__WIN32__


5043 #i‚de‡
T˛_RópDëachedProcs


5044 
	#T˛_RópDëachedProcs
 \

5045 (
t˛StubsPå
->
t˛_RópDëachedProcs
Ë

	)

5048 #ifde‡
MAC_OSX_TCL


5049 #i‚de‡
T˛_RópDëachedProcs


5050 
	#T˛_RópDëachedProcs
 \

5051 (
t˛StubsPå
->
t˛_RópDëachedProcs
Ë

	)

5054 #i‚de‡
T˛_Rec‹dAndEvÆ


5055 
	#T˛_Rec‹dAndEvÆ
 \

5056 (
t˛StubsPå
->
t˛_Rec‹dAndEvÆ
Ë

	)

5058 #i‚de‡
T˛_Rec‹dAndEvÆObj


5059 
	#T˛_Rec‹dAndEvÆObj
 \

5060 (
t˛StubsPå
->
t˛_Rec‹dAndEvÆObj
Ë

	)

5062 #i‚de‡
T˛_Regi°îCh™√l


5063 
	#T˛_Regi°îCh™√l
 \

5064 (
t˛StubsPå
->
t˛_Regi°îCh™√l
Ë

	)

5066 #i‚de‡
T˛_Regi°îObjTy≥


5067 
	#T˛_Regi°îObjTy≥
 \

5068 (
t˛StubsPå
->
t˛_Regi°îObjTy≥
Ë

	)

5070 #i‚de‡
T˛_RegExpCompûe


5071 
	#T˛_RegExpCompûe
 \

5072 (
t˛StubsPå
->
t˛_RegExpCompûe
Ë

	)

5074 #i‚de‡
T˛_RegExpExec


5075 
	#T˛_RegExpExec
 \

5076 (
t˛StubsPå
->
t˛_RegExpExec
Ë

	)

5078 #i‚de‡
T˛_RegExpM©ch


5079 
	#T˛_RegExpM©ch
 \

5080 (
t˛StubsPå
->
t˛_RegExpM©ch
Ë

	)

5082 #i‚de‡
T˛_RegExpR™ge


5083 
	#T˛_RegExpR™ge
 \

5084 (
t˛StubsPå
->
t˛_RegExpR™ge
Ë

	)

5086 #i‚de‡
T˛_Rñó£


5087 
	#T˛_Rñó£
 \

5088 (
t˛StubsPå
->
t˛_Rñó£
Ë

	)

5090 #i‚de‡
T˛_Re£tResu…


5091 
	#T˛_Re£tResu…
 \

5092 (
t˛StubsPå
->
t˛_Re£tResu…
Ë

	)

5094 #i‚de‡
T˛_SˇnEÀmít


5095 
	#T˛_SˇnEÀmít
 \

5096 (
t˛StubsPå
->
t˛_SˇnEÀmít
Ë

	)

5098 #i‚de‡
T˛_SˇnCou¡edEÀmít


5099 
	#T˛_SˇnCou¡edEÀmít
 \

5100 (
t˛StubsPå
->
t˛_SˇnCou¡edEÀmít
Ë

	)

5102 #i‚de‡
T˛_SìkOld


5103 
	#T˛_SìkOld
 \

5104 (
t˛StubsPå
->
t˛_SìkOld
Ë

	)

5106 #i‚de‡
T˛_Sîvi˚AŒ


5107 
	#T˛_Sîvi˚AŒ
 \

5108 (
t˛StubsPå
->
t˛_Sîvi˚AŒ
Ë

	)

5110 #i‚de‡
T˛_Sîvi˚Evít


5111 
	#T˛_Sîvi˚Evít
 \

5112 (
t˛StubsPå
->
t˛_Sîvi˚Evít
Ë

	)

5114 #i‚de‡
T˛_SëAssocD©a


5115 
	#T˛_SëAssocD©a
 \

5116 (
t˛StubsPå
->
t˛_SëAssocD©a
Ë

	)

5118 #i‚de‡
T˛_SëCh™√lBuf„rSize


5119 
	#T˛_SëCh™√lBuf„rSize
 \

5120 (
t˛StubsPå
->
t˛_SëCh™√lBuf„rSize
Ë

	)

5122 #i‚de‡
T˛_SëCh™√lO±i⁄


5123 
	#T˛_SëCh™√lO±i⁄
 \

5124 (
t˛StubsPå
->
t˛_SëCh™√lO±i⁄
Ë

	)

5126 #i‚de‡
T˛_SëComm™dInfo


5127 
	#T˛_SëComm™dInfo
 \

5128 (
t˛StubsPå
->
t˛_SëComm™dInfo
Ë

	)

5130 #i‚de‡
T˛_SëEºno


5131 
	#T˛_SëEºno
 \

5132 (
t˛StubsPå
->
t˛_SëEºno
Ë

	)

5134 #i‚de‡
T˛_SëEº‹Code


5135 
	#T˛_SëEº‹Code
 \

5136 (
t˛StubsPå
->
t˛_SëEº‹Code
Ë

	)

5138 #i‚de‡
T˛_SëMaxBlockTime


5139 
	#T˛_SëMaxBlockTime
 \

5140 (
t˛StubsPå
->
t˛_SëMaxBlockTime
Ë

	)

5142 #i‚de‡
T˛_SëP™icProc


5143 
	#T˛_SëP™icProc
 \

5144 (
t˛StubsPå
->
t˛_SëP™icProc
Ë

	)

5146 #i‚de‡
T˛_SëRecursi⁄Limô


5147 
	#T˛_SëRecursi⁄Limô
 \

5148 (
t˛StubsPå
->
t˛_SëRecursi⁄Limô
Ë

	)

5150 #i‚de‡
T˛_SëResu…


5151 
	#T˛_SëResu…
 \

5152 (
t˛StubsPå
->
t˛_SëResu…
Ë

	)

5154 #i‚de‡
T˛_SëSîvi˚Mode


5155 
	#T˛_SëSîvi˚Mode
 \

5156 (
t˛StubsPå
->
t˛_SëSîvi˚Mode
Ë

	)

5158 #i‚de‡
T˛_SëObjEº‹Code


5159 
	#T˛_SëObjEº‹Code
 \

5160 (
t˛StubsPå
->
t˛_SëObjEº‹Code
Ë

	)

5162 #i‚de‡
T˛_SëObjResu…


5163 
	#T˛_SëObjResu…
 \

5164 (
t˛StubsPå
->
t˛_SëObjResu…
Ë

	)

5166 #i‚de‡
T˛_SëStdCh™√l


5167 
	#T˛_SëStdCh™√l
 \

5168 (
t˛StubsPå
->
t˛_SëStdCh™√l
Ë

	)

5170 #i‚de‡
T˛_SëV¨


5171 
	#T˛_SëV¨
 \

5172 (
t˛StubsPå
->
t˛_SëV¨
Ë

	)

5174 #i‚de‡
T˛_SëV¨2


5175 
	#T˛_SëV¨2
 \

5176 (
t˛StubsPå
->
t˛_SëV¨2
Ë

	)

5178 #i‚de‡
T˛_Sig«lId


5179 
	#T˛_Sig«lId
 \

5180 (
t˛StubsPå
->
t˛_Sig«lId
Ë

	)

5182 #i‚de‡
T˛_Sig«lMsg


5183 
	#T˛_Sig«lMsg
 \

5184 (
t˛StubsPå
->
t˛_Sig«lMsg
Ë

	)

5186 #i‚de‡
T˛_Sour˚RCFûe


5187 
	#T˛_Sour˚RCFûe
 \

5188 (
t˛StubsPå
->
t˛_Sour˚RCFûe
Ë

	)

5190 #i‚de‡
T˛_S∂ôLi°


5191 
	#T˛_S∂ôLi°
 \

5192 (
t˛StubsPå
->
t˛_S∂ôLi°
Ë

	)

5194 #i‚de‡
T˛_S∂ôP©h


5195 
	#T˛_S∂ôP©h
 \

5196 (
t˛StubsPå
->
t˛_S∂ôP©h
Ë

	)

5198 #i‚de‡
T˛_SèticPackage


5199 
	#T˛_SèticPackage
 \

5200 (
t˛StubsPå
->
t˛_SèticPackage
Ë

	)

5202 #i‚de‡
T˛_SåögM©ch


5203 
	#T˛_SåögM©ch
 \

5204 (
t˛StubsPå
->
t˛_SåögM©ch
Ë

	)

5206 #i‚de‡
T˛_TñlOld


5207 
	#T˛_TñlOld
 \

5208 (
t˛StubsPå
->
t˛_TñlOld
Ë

	)

5210 #i‚de‡
T˛_Tø˚V¨


5211 
	#T˛_Tø˚V¨
 \

5212 (
t˛StubsPå
->
t˛_Tø˚V¨
Ë

	)

5214 #i‚de‡
T˛_Tø˚V¨2


5215 
	#T˛_Tø˚V¨2
 \

5216 (
t˛StubsPå
->
t˛_Tø˚V¨2
Ë

	)

5218 #i‚de‡
T˛_Tøn¶©eFûeName


5219 
	#T˛_Tøn¶©eFûeName
 \

5220 (
t˛StubsPå
->
t˛_Tøn¶©eFûeName
Ë

	)

5222 #i‚de‡
T˛_Ungës


5223 
	#T˛_Ungës
 \

5224 (
t˛StubsPå
->
t˛_Ungës
Ë

	)

5226 #i‚de‡
T˛_U∆ökV¨


5227 
	#T˛_U∆ökV¨
 \

5228 (
t˛StubsPå
->
t˛_U∆ökV¨
Ë

	)

5230 #i‚de‡
T˛_Uƒegi°îCh™√l


5231 
	#T˛_Uƒegi°îCh™√l
 \

5232 (
t˛StubsPå
->
t˛_Uƒegi°îCh™√l
Ë

	)

5234 #i‚de‡
T˛_Un£tV¨


5235 
	#T˛_Un£tV¨
 \

5236 (
t˛StubsPå
->
t˛_Un£tV¨
Ë

	)

5238 #i‚de‡
T˛_Un£tV¨2


5239 
	#T˛_Un£tV¨2
 \

5240 (
t˛StubsPå
->
t˛_Un£tV¨2
Ë

	)

5242 #i‚de‡
T˛_U¡ø˚V¨


5243 
	#T˛_U¡ø˚V¨
 \

5244 (
t˛StubsPå
->
t˛_U¡ø˚V¨
Ë

	)

5246 #i‚de‡
T˛_U¡ø˚V¨2


5247 
	#T˛_U¡ø˚V¨2
 \

5248 (
t˛StubsPå
->
t˛_U¡ø˚V¨2
Ë

	)

5250 #i‚de‡
T˛_Upd©eLökedV¨


5251 
	#T˛_Upd©eLökedV¨
 \

5252 (
t˛StubsPå
->
t˛_Upd©eLökedV¨
Ë

	)

5254 #i‚de‡
T˛_UpV¨


5255 
	#T˛_UpV¨
 \

5256 (
t˛StubsPå
->
t˛_UpV¨
Ë

	)

5258 #i‚de‡
T˛_UpV¨2


5259 
	#T˛_UpV¨2
 \

5260 (
t˛StubsPå
->
t˛_UpV¨2
Ë

	)

5262 #i‚de‡
T˛_V¨EvÆ


5263 
	#T˛_V¨EvÆ
 \

5264 (
t˛StubsPå
->
t˛_V¨EvÆ
Ë

	)

5266 #i‚de‡
T˛_V¨Tø˚Info


5267 
	#T˛_V¨Tø˚Info
 \

5268 (
t˛StubsPå
->
t˛_V¨Tø˚Info
Ë

	)

5270 #i‚de‡
T˛_V¨Tø˚Info2


5271 
	#T˛_V¨Tø˚Info2
 \

5272 (
t˛StubsPå
->
t˛_V¨Tø˚Info2
Ë

	)

5274 #i‚de‡
T˛_Wrôe


5275 
	#T˛_Wrôe
 \

5276 (
t˛StubsPå
->
t˛_Wrôe
Ë

	)

5278 #i‚de‡
T˛_Wr⁄gNumArgs


5279 
	#T˛_Wr⁄gNumArgs
 \

5280 (
t˛StubsPå
->
t˛_Wr⁄gNumArgs
Ë

	)

5282 #i‚de‡
T˛_DumpA˘iveMem‹y


5283 
	#T˛_DumpA˘iveMem‹y
 \

5284 (
t˛StubsPå
->
t˛_DumpA˘iveMem‹y
Ë

	)

5286 #i‚de‡
T˛_VÆid©eAŒMem‹y


5287 
	#T˛_VÆid©eAŒMem‹y
 \

5288 (
t˛StubsPå
->
t˛_VÆid©eAŒMem‹y
Ë

	)

5290 #i‚de‡
T˛_AµídResu…VA


5291 
	#T˛_AµídResu…VA
 \

5292 (
t˛StubsPå
->
t˛_AµídResu…VA
Ë

	)

5294 #i‚de‡
T˛_AµídSåögsToObjVA


5295 
	#T˛_AµídSåögsToObjVA
 \

5296 (
t˛StubsPå
->
t˛_AµídSåögsToObjVA
Ë

	)

5298 #i‚de‡
T˛_HashSèts


5299 
	#T˛_HashSèts
 \

5300 (
t˛StubsPå
->
t˛_HashSèts
Ë

	)

5302 #i‚de‡
T˛_P¨£V¨


5303 
	#T˛_P¨£V¨
 \

5304 (
t˛StubsPå
->
t˛_P¨£V¨
Ë

	)

5306 #i‚de‡
T˛_PkgPª£¡


5307 
	#T˛_PkgPª£¡
 \

5308 (
t˛StubsPå
->
t˛_PkgPª£¡
Ë

	)

5310 #i‚de‡
T˛_PkgPª£¡Ex


5311 
	#T˛_PkgPª£¡Ex
 \

5312 (
t˛StubsPå
->
t˛_PkgPª£¡Ex
Ë

	)

5314 #i‚de‡
T˛_PkgProvide


5315 
	#T˛_PkgProvide
 \

5316 (
t˛StubsPå
->
t˛_PkgProvide
Ë

	)

5318 #i‚de‡
T˛_PkgRequúe


5319 
	#T˛_PkgRequúe
 \

5320 (
t˛StubsPå
->
t˛_PkgRequúe
Ë

	)

5322 #i‚de‡
T˛_SëEº‹CodeVA


5323 
	#T˛_SëEº‹CodeVA
 \

5324 (
t˛StubsPå
->
t˛_SëEº‹CodeVA
Ë

	)

5326 #i‚de‡
T˛_V¨EvÆVA


5327 
	#T˛_V¨EvÆVA
 \

5328 (
t˛StubsPå
->
t˛_V¨EvÆVA
Ë

	)

5330 #i‚de‡
T˛_WaôPid


5331 
	#T˛_WaôPid
 \

5332 (
t˛StubsPå
->
t˛_WaôPid
Ë

	)

5334 #i‚de‡
T˛_P™icVA


5335 
	#T˛_P™icVA
 \

5336 (
t˛StubsPå
->
t˛_P™icVA
Ë

	)

5338 #i‚de‡
T˛_GëVîsi⁄


5339 
	#T˛_GëVîsi⁄
 \

5340 (
t˛StubsPå
->
t˛_GëVîsi⁄
Ë

	)

5342 #i‚de‡
T˛_InôMem‹y


5343 
	#T˛_InôMem‹y
 \

5344 (
t˛StubsPå
->
t˛_InôMem‹y
Ë

	)

5346 #i‚de‡
T˛_SèckCh™√l


5347 
	#T˛_SèckCh™√l
 \

5348 (
t˛StubsPå
->
t˛_SèckCh™√l
Ë

	)

5350 #i‚de‡
T˛_Un°ackCh™√l


5351 
	#T˛_Un°ackCh™√l
 \

5352 (
t˛StubsPå
->
t˛_Un°ackCh™√l
Ë

	)

5354 #i‚de‡
T˛_GëSèckedCh™√l


5355 
	#T˛_GëSèckedCh™√l
 \

5356 (
t˛StubsPå
->
t˛_GëSèckedCh™√l
Ë

	)

5358 #i‚de‡
T˛_SëMaöLo›


5359 
	#T˛_SëMaöLo›
 \

5360 (
t˛StubsPå
->
t˛_SëMaöLo›
Ë

	)

5363 #i‚de‡
T˛_AµídObjToObj


5364 
	#T˛_AµídObjToObj
 \

5365 (
t˛StubsPå
->
t˛_AµídObjToObj
Ë

	)

5367 #i‚de‡
T˛_Cª©eEncodög


5368 
	#T˛_Cª©eEncodög
 \

5369 (
t˛StubsPå
->
t˛_Cª©eEncodög
Ë

	)

5371 #i‚de‡
T˛_Cª©eThªadExôH™dÀr


5372 
	#T˛_Cª©eThªadExôH™dÀr
 \

5373 (
t˛StubsPå
->
t˛_Cª©eThªadExôH™dÀr
Ë

	)

5375 #i‚de‡
T˛_DñëeThªadExôH™dÀr


5376 
	#T˛_DñëeThªadExôH™dÀr
 \

5377 (
t˛StubsPå
->
t˛_DñëeThªadExôH™dÀr
Ë

	)

5379 #i‚de‡
T˛_DisˇrdResu…


5380 
	#T˛_DisˇrdResu…
 \

5381 (
t˛StubsPå
->
t˛_DisˇrdResu…
Ë

	)

5383 #i‚de‡
T˛_EvÆEx


5384 
	#T˛_EvÆEx
 \

5385 (
t˛StubsPå
->
t˛_EvÆEx
Ë

	)

5387 #i‚de‡
T˛_EvÆObjv


5388 
	#T˛_EvÆObjv
 \

5389 (
t˛StubsPå
->
t˛_EvÆObjv
Ë

	)

5391 #i‚de‡
T˛_EvÆObjEx


5392 
	#T˛_EvÆObjEx
 \

5393 (
t˛StubsPå
->
t˛_EvÆObjEx
Ë

	)

5395 #i‚de‡
T˛_ExôThªad


5396 
	#T˛_ExôThªad
 \

5397 (
t˛StubsPå
->
t˛_ExôThªad
Ë

	)

5399 #i‚de‡
T˛_Exã∫ÆToUtf


5400 
	#T˛_Exã∫ÆToUtf
 \

5401 (
t˛StubsPå
->
t˛_Exã∫ÆToUtf
Ë

	)

5403 #i‚de‡
T˛_Exã∫ÆToUtfDSåög


5404 
	#T˛_Exã∫ÆToUtfDSåög
 \

5405 (
t˛StubsPå
->
t˛_Exã∫ÆToUtfDSåög
Ë

	)

5407 #i‚de‡
T˛_FöÆizeThªad


5408 
	#T˛_FöÆizeThªad
 \

5409 (
t˛StubsPå
->
t˛_FöÆizeThªad
Ë

	)

5411 #i‚de‡
T˛_FöÆizeNŸifõr


5412 
	#T˛_FöÆizeNŸifõr
 \

5413 (
t˛StubsPå
->
t˛_FöÆizeNŸifõr
Ë

	)

5415 #i‚de‡
T˛_FªeEncodög


5416 
	#T˛_FªeEncodög
 \

5417 (
t˛StubsPå
->
t˛_FªeEncodög
Ë

	)

5419 #i‚de‡
T˛_GëCuºítThªad


5420 
	#T˛_GëCuºítThªad
 \

5421 (
t˛StubsPå
->
t˛_GëCuºítThªad
Ë

	)

5423 #i‚de‡
T˛_GëEncodög


5424 
	#T˛_GëEncodög
 \

5425 (
t˛StubsPå
->
t˛_GëEncodög
Ë

	)

5427 #i‚de‡
T˛_GëEncodögName


5428 
	#T˛_GëEncodögName
 \

5429 (
t˛StubsPå
->
t˛_GëEncodögName
Ë

	)

5431 #i‚de‡
T˛_GëEncodögNames


5432 
	#T˛_GëEncodögNames
 \

5433 (
t˛StubsPå
->
t˛_GëEncodögNames
Ë

	)

5435 #i‚de‡
T˛_GëIndexFromObjSåu˘


5436 
	#T˛_GëIndexFromObjSåu˘
 \

5437 (
t˛StubsPå
->
t˛_GëIndexFromObjSåu˘
Ë

	)

5439 #i‚de‡
T˛_GëThªadD©a


5440 
	#T˛_GëThªadD©a
 \

5441 (
t˛StubsPå
->
t˛_GëThªadD©a
Ë

	)

5443 #i‚de‡
T˛_GëV¨2Ex


5444 
	#T˛_GëV¨2Ex
 \

5445 (
t˛StubsPå
->
t˛_GëV¨2Ex
Ë

	)

5447 #i‚de‡
T˛_InôNŸifõr


5448 
	#T˛_InôNŸifõr
 \

5449 (
t˛StubsPå
->
t˛_InôNŸifõr
Ë

	)

5451 #i‚de‡
T˛_MuãxLock


5452 
	#T˛_MuãxLock
 \

5453 (
t˛StubsPå
->
t˛_MuãxLock
Ë

	)

5455 #i‚de‡
T˛_MuãxU∆ock


5456 
	#T˛_MuãxU∆ock
 \

5457 (
t˛StubsPå
->
t˛_MuãxU∆ock
Ë

	)

5459 #i‚de‡
T˛_C⁄dôi⁄NŸify


5460 
	#T˛_C⁄dôi⁄NŸify
 \

5461 (
t˛StubsPå
->
t˛_C⁄dôi⁄NŸify
Ë

	)

5463 #i‚de‡
T˛_C⁄dôi⁄Waô


5464 
	#T˛_C⁄dôi⁄Waô
 \

5465 (
t˛StubsPå
->
t˛_C⁄dôi⁄Waô
Ë

	)

5467 #i‚de‡
T˛_NumUtfCh¨s


5468 
	#T˛_NumUtfCh¨s
 \

5469 (
t˛StubsPå
->
t˛_NumUtfCh¨s
Ë

	)

5471 #i‚de‡
T˛_RódCh¨s


5472 
	#T˛_RódCh¨s
 \

5473 (
t˛StubsPå
->
t˛_RódCh¨s
Ë

	)

5475 #i‚de‡
T˛_Re°‹eResu…


5476 
	#T˛_Re°‹eResu…
 \

5477 (
t˛StubsPå
->
t˛_Re°‹eResu…
Ë

	)

5479 #i‚de‡
T˛_SaveResu…


5480 
	#T˛_SaveResu…
 \

5481 (
t˛StubsPå
->
t˛_SaveResu…
Ë

	)

5483 #i‚de‡
T˛_SëSy°emEncodög


5484 
	#T˛_SëSy°emEncodög
 \

5485 (
t˛StubsPå
->
t˛_SëSy°emEncodög
Ë

	)

5487 #i‚de‡
T˛_SëV¨2Ex


5488 
	#T˛_SëV¨2Ex
 \

5489 (
t˛StubsPå
->
t˛_SëV¨2Ex
Ë

	)

5491 #i‚de‡
T˛_ThªadAÀπ


5492 
	#T˛_ThªadAÀπ
 \

5493 (
t˛StubsPå
->
t˛_ThªadAÀπ
Ë

	)

5495 #i‚de‡
T˛_ThªadQueueEvít


5496 
	#T˛_ThªadQueueEvít
 \

5497 (
t˛StubsPå
->
t˛_ThªadQueueEvít
Ë

	)

5499 #i‚de‡
T˛_UniCh¨AtIndex


5500 
	#T˛_UniCh¨AtIndex
 \

5501 (
t˛StubsPå
->
t˛_UniCh¨AtIndex
Ë

	)

5503 #i‚de‡
T˛_UniCh¨ToLowî


5504 
	#T˛_UniCh¨ToLowî
 \

5505 (
t˛StubsPå
->
t˛_UniCh¨ToLowî
Ë

	)

5507 #i‚de‡
T˛_UniCh¨ToTôÀ


5508 
	#T˛_UniCh¨ToTôÀ
 \

5509 (
t˛StubsPå
->
t˛_UniCh¨ToTôÀ
Ë

	)

5511 #i‚de‡
T˛_UniCh¨ToUµî


5512 
	#T˛_UniCh¨ToUµî
 \

5513 (
t˛StubsPå
->
t˛_UniCh¨ToUµî
Ë

	)

5515 #i‚de‡
T˛_UniCh¨ToUtf


5516 
	#T˛_UniCh¨ToUtf
 \

5517 (
t˛StubsPå
->
t˛_UniCh¨ToUtf
Ë

	)

5519 #i‚de‡
T˛_UtfAtIndex


5520 
	#T˛_UtfAtIndex
 \

5521 (
t˛StubsPå
->
t˛_UtfAtIndex
Ë

	)

5523 #i‚de‡
T˛_UtfCh¨Com∂ëe


5524 
	#T˛_UtfCh¨Com∂ëe
 \

5525 (
t˛StubsPå
->
t˛_UtfCh¨Com∂ëe
Ë

	)

5527 #i‚de‡
T˛_UtfBack¶ash


5528 
	#T˛_UtfBack¶ash
 \

5529 (
t˛StubsPå
->
t˛_UtfBack¶ash
Ë

	)

5531 #i‚de‡
T˛_UtfFödFú°


5532 
	#T˛_UtfFödFú°
 \

5533 (
t˛StubsPå
->
t˛_UtfFödFú°
Ë

	)

5535 #i‚de‡
T˛_UtfFödLa°


5536 
	#T˛_UtfFödLa°
 \

5537 (
t˛StubsPå
->
t˛_UtfFödLa°
Ë

	)

5539 #i‚de‡
T˛_UtfNext


5540 
	#T˛_UtfNext
 \

5541 (
t˛StubsPå
->
t˛_UtfNext
Ë

	)

5543 #i‚de‡
T˛_UtfPªv


5544 
	#T˛_UtfPªv
 \

5545 (
t˛StubsPå
->
t˛_UtfPªv
Ë

	)

5547 #i‚de‡
T˛_UtfToExã∫Æ


5548 
	#T˛_UtfToExã∫Æ
 \

5549 (
t˛StubsPå
->
t˛_UtfToExã∫Æ
Ë

	)

5551 #i‚de‡
T˛_UtfToExã∫ÆDSåög


5552 
	#T˛_UtfToExã∫ÆDSåög
 \

5553 (
t˛StubsPå
->
t˛_UtfToExã∫ÆDSåög
Ë

	)

5555 #i‚de‡
T˛_UtfToLowî


5556 
	#T˛_UtfToLowî
 \

5557 (
t˛StubsPå
->
t˛_UtfToLowî
Ë

	)

5559 #i‚de‡
T˛_UtfToTôÀ


5560 
	#T˛_UtfToTôÀ
 \

5561 (
t˛StubsPå
->
t˛_UtfToTôÀ
Ë

	)

5563 #i‚de‡
T˛_UtfToUniCh¨


5564 
	#T˛_UtfToUniCh¨
 \

5565 (
t˛StubsPå
->
t˛_UtfToUniCh¨
Ë

	)

5567 #i‚de‡
T˛_UtfToUµî


5568 
	#T˛_UtfToUµî
 \

5569 (
t˛StubsPå
->
t˛_UtfToUµî
Ë

	)

5571 #i‚de‡
T˛_WrôeCh¨s


5572 
	#T˛_WrôeCh¨s
 \

5573 (
t˛StubsPå
->
t˛_WrôeCh¨s
Ë

	)

5575 #i‚de‡
T˛_WrôeObj


5576 
	#T˛_WrôeObj
 \

5577 (
t˛StubsPå
->
t˛_WrôeObj
Ë

	)

5579 #i‚de‡
T˛_GëSåög


5580 
	#T˛_GëSåög
 \

5581 (
t˛StubsPå
->
t˛_GëSåög
Ë

	)

5583 #i‚de‡
T˛_GëDeÁu…EncodögDú


5584 
	#T˛_GëDeÁu…EncodögDú
 \

5585 (
t˛StubsPå
->
t˛_GëDeÁu…EncodögDú
Ë

	)

5587 #i‚de‡
T˛_SëDeÁu…EncodögDú


5588 
	#T˛_SëDeÁu…EncodögDú
 \

5589 (
t˛StubsPå
->
t˛_SëDeÁu…EncodögDú
Ë

	)

5591 #i‚de‡
T˛_AÀπNŸifõr


5592 
	#T˛_AÀπNŸifõr
 \

5593 (
t˛StubsPå
->
t˛_AÀπNŸifõr
Ë

	)

5595 #i‚de‡
T˛_Sîvi˚ModeHook


5596 
	#T˛_Sîvi˚ModeHook
 \

5597 (
t˛StubsPå
->
t˛_Sîvi˚ModeHook
Ë

	)

5599 #i‚de‡
T˛_UniCh¨IsA um


5600 
	#T˛_UniCh¨IsA um
 \

5601 (
t˛StubsPå
->
t˛_UniCh¨IsA um
Ë

	)

5603 #i‚de‡
T˛_UniCh¨IsAÕha


5604 
	#T˛_UniCh¨IsAÕha
 \

5605 (
t˛StubsPå
->
t˛_UniCh¨IsAÕha
Ë

	)

5607 #i‚de‡
T˛_UniCh¨IsDigô


5608 
	#T˛_UniCh¨IsDigô
 \

5609 (
t˛StubsPå
->
t˛_UniCh¨IsDigô
Ë

	)

5611 #i‚de‡
T˛_UniCh¨IsLowî


5612 
	#T˛_UniCh¨IsLowî
 \

5613 (
t˛StubsPå
->
t˛_UniCh¨IsLowî
Ë

	)

5615 #i‚de‡
T˛_UniCh¨IsS∑˚


5616 
	#T˛_UniCh¨IsS∑˚
 \

5617 (
t˛StubsPå
->
t˛_UniCh¨IsS∑˚
Ë

	)

5619 #i‚de‡
T˛_UniCh¨IsUµî


5620 
	#T˛_UniCh¨IsUµî
 \

5621 (
t˛StubsPå
->
t˛_UniCh¨IsUµî
Ë

	)

5623 #i‚de‡
T˛_UniCh¨IsW‹dCh¨


5624 
	#T˛_UniCh¨IsW‹dCh¨
 \

5625 (
t˛StubsPå
->
t˛_UniCh¨IsW‹dCh¨
Ë

	)

5627 #i‚de‡
T˛_UniCh¨Lí


5628 
	#T˛_UniCh¨Lí
 \

5629 (
t˛StubsPå
->
t˛_UniCh¨Lí
Ë

	)

5631 #i‚de‡
T˛_UniCh¨Ncmp


5632 
	#T˛_UniCh¨Ncmp
 \

5633 (
t˛StubsPå
->
t˛_UniCh¨Ncmp
Ë

	)

5635 #i‚de‡
T˛_UniCh¨ToUtfDSåög


5636 
	#T˛_UniCh¨ToUtfDSåög
 \

5637 (
t˛StubsPå
->
t˛_UniCh¨ToUtfDSåög
Ë

	)

5639 #i‚de‡
T˛_UtfToUniCh¨DSåög


5640 
	#T˛_UtfToUniCh¨DSåög
 \

5641 (
t˛StubsPå
->
t˛_UtfToUniCh¨DSåög
Ë

	)

5643 #i‚de‡
T˛_GëRegExpFromObj


5644 
	#T˛_GëRegExpFromObj
 \

5645 (
t˛StubsPå
->
t˛_GëRegExpFromObj
Ë

	)

5647 #i‚de‡
T˛_EvÆTokís


5648 
	#T˛_EvÆTokís
 \

5649 (
t˛StubsPå
->
t˛_EvÆTokís
Ë

	)

5651 #i‚de‡
T˛_FªeP¨£


5652 
	#T˛_FªeP¨£
 \

5653 (
t˛StubsPå
->
t˛_FªeP¨£
Ë

	)

5655 #i‚de‡
T˛_LogComm™dInfo


5656 
	#T˛_LogComm™dInfo
 \

5657 (
t˛StubsPå
->
t˛_LogComm™dInfo
Ë

	)

5659 #i‚de‡
T˛_P¨£Bø˚s


5660 
	#T˛_P¨£Bø˚s
 \

5661 (
t˛StubsPå
->
t˛_P¨£Bø˚s
Ë

	)

5663 #i‚de‡
T˛_P¨£Comm™d


5664 
	#T˛_P¨£Comm™d
 \

5665 (
t˛StubsPå
->
t˛_P¨£Comm™d
Ë

	)

5667 #i‚de‡
T˛_P¨£Ex¥


5668 
	#T˛_P¨£Ex¥
 \

5669 (
t˛StubsPå
->
t˛_P¨£Ex¥
Ë

	)

5671 #i‚de‡
T˛_P¨£QuŸedSåög


5672 
	#T˛_P¨£QuŸedSåög
 \

5673 (
t˛StubsPå
->
t˛_P¨£QuŸedSåög
Ë

	)

5675 #i‚de‡
T˛_P¨£V¨Name


5676 
	#T˛_P¨£V¨Name
 \

5677 (
t˛StubsPå
->
t˛_P¨£V¨Name
Ë

	)

5679 #i‚de‡
T˛_GëCwd


5680 
	#T˛_GëCwd
 \

5681 (
t˛StubsPå
->
t˛_GëCwd
Ë

	)

5683 #i‚de‡
T˛_Chdú


5684 
	#T˛_Chdú
 \

5685 (
t˛StubsPå
->
t˛_Chdú
Ë

	)

5687 #i‚de‡
T˛_Ac˚ss


5688 
	#T˛_Ac˚ss
 \

5689 (
t˛StubsPå
->
t˛_Ac˚ss
Ë

	)

5691 #i‚de‡
T˛_Sèt


5692 
	#T˛_Sèt
 \

5693 (
t˛StubsPå
->
t˛_Sèt
Ë

	)

5695 #i‚de‡
T˛_UtfNcmp


5696 
	#T˛_UtfNcmp
 \

5697 (
t˛StubsPå
->
t˛_UtfNcmp
Ë

	)

5699 #i‚de‡
T˛_UtfNˇ£cmp


5700 
	#T˛_UtfNˇ£cmp
 \

5701 (
t˛StubsPå
->
t˛_UtfNˇ£cmp
Ë

	)

5703 #i‚de‡
T˛_SåögCa£M©ch


5704 
	#T˛_SåögCa£M©ch
 \

5705 (
t˛StubsPå
->
t˛_SåögCa£M©ch
Ë

	)

5707 #i‚de‡
T˛_UniCh¨IsC⁄åﬁ


5708 
	#T˛_UniCh¨IsC⁄åﬁ
 \

5709 (
t˛StubsPå
->
t˛_UniCh¨IsC⁄åﬁ
Ë

	)

5711 #i‚de‡
T˛_UniCh¨IsGøph


5712 
	#T˛_UniCh¨IsGøph
 \

5713 (
t˛StubsPå
->
t˛_UniCh¨IsGøph
Ë

	)

5715 #i‚de‡
T˛_UniCh¨IsPröt


5716 
	#T˛_UniCh¨IsPröt
 \

5717 (
t˛StubsPå
->
t˛_UniCh¨IsPröt
Ë

	)

5719 #i‚de‡
T˛_UniCh¨IsPun˘


5720 
	#T˛_UniCh¨IsPun˘
 \

5721 (
t˛StubsPå
->
t˛_UniCh¨IsPun˘
Ë

	)

5723 #i‚de‡
T˛_RegExpExecObj


5724 
	#T˛_RegExpExecObj
 \

5725 (
t˛StubsPå
->
t˛_RegExpExecObj
Ë

	)

5727 #i‚de‡
T˛_RegExpGëInfo


5728 
	#T˛_RegExpGëInfo
 \

5729 (
t˛StubsPå
->
t˛_RegExpGëInfo
Ë

	)

5731 #i‚de‡
T˛_NewUnicodeObj


5732 
	#T˛_NewUnicodeObj
 \

5733 (
t˛StubsPå
->
t˛_NewUnicodeObj
Ë

	)

5735 #i‚de‡
T˛_SëUnicodeObj


5736 
	#T˛_SëUnicodeObj
 \

5737 (
t˛StubsPå
->
t˛_SëUnicodeObj
Ë

	)

5739 #i‚de‡
T˛_GëCh¨Lígth


5740 
	#T˛_GëCh¨Lígth
 \

5741 (
t˛StubsPå
->
t˛_GëCh¨Lígth
Ë

	)

5743 #i‚de‡
T˛_GëUniCh¨


5744 
	#T˛_GëUniCh¨
 \

5745 (
t˛StubsPå
->
t˛_GëUniCh¨
Ë

	)

5747 #i‚de‡
T˛_GëUnicode


5748 
	#T˛_GëUnicode
 \

5749 (
t˛StubsPå
->
t˛_GëUnicode
Ë

	)

5751 #i‚de‡
T˛_GëR™ge


5752 
	#T˛_GëR™ge
 \

5753 (
t˛StubsPå
->
t˛_GëR™ge
Ë

	)

5755 #i‚de‡
T˛_AµídUnicodeToObj


5756 
	#T˛_AµídUnicodeToObj
 \

5757 (
t˛StubsPå
->
t˛_AµídUnicodeToObj
Ë

	)

5759 #i‚de‡
T˛_RegExpM©chObj


5760 
	#T˛_RegExpM©chObj
 \

5761 (
t˛StubsPå
->
t˛_RegExpM©chObj
Ë

	)

5763 #i‚de‡
T˛_SëNŸifõr


5764 
	#T˛_SëNŸifõr
 \

5765 (
t˛StubsPå
->
t˛_SëNŸifõr
Ë

	)

5767 #i‚de‡
T˛_GëAŒocMuãx


5768 
	#T˛_GëAŒocMuãx
 \

5769 (
t˛StubsPå
->
t˛_GëAŒocMuãx
Ë

	)

5771 #i‚de‡
T˛_GëCh™√lNames


5772 
	#T˛_GëCh™√lNames
 \

5773 (
t˛StubsPå
->
t˛_GëCh™√lNames
Ë

	)

5775 #i‚de‡
T˛_GëCh™√lNamesEx


5776 
	#T˛_GëCh™√lNamesEx
 \

5777 (
t˛StubsPå
->
t˛_GëCh™√lNamesEx
Ë

	)

5779 #i‚de‡
T˛_ProcObjCmd


5780 
	#T˛_ProcObjCmd
 \

5781 (
t˛StubsPå
->
t˛_ProcObjCmd
Ë

	)

5783 #i‚de‡
T˛_C⁄dôi⁄FöÆize


5784 
	#T˛_C⁄dôi⁄FöÆize
 \

5785 (
t˛StubsPå
->
t˛_C⁄dôi⁄FöÆize
Ë

	)

5787 #i‚de‡
T˛_MuãxFöÆize


5788 
	#T˛_MuãxFöÆize
 \

5789 (
t˛StubsPå
->
t˛_MuãxFöÆize
Ë

	)

5791 #i‚de‡
T˛_Cª©eThªad


5792 
	#T˛_Cª©eThªad
 \

5793 (
t˛StubsPå
->
t˛_Cª©eThªad
Ë

	)

5795 #i‚de‡
T˛_RódRaw


5796 
	#T˛_RódRaw
 \

5797 (
t˛StubsPå
->
t˛_RódRaw
Ë

	)

5799 #i‚de‡
T˛_WrôeRaw


5800 
	#T˛_WrôeRaw
 \

5801 (
t˛StubsPå
->
t˛_WrôeRaw
Ë

	)

5803 #i‚de‡
T˛_GëT›Ch™√l


5804 
	#T˛_GëT›Ch™√l
 \

5805 (
t˛StubsPå
->
t˛_GëT›Ch™√l
Ë

	)

5807 #i‚de‡
T˛_Ch™√lBuf„ªd


5808 
	#T˛_Ch™√lBuf„ªd
 \

5809 (
t˛StubsPå
->
t˛_Ch™√lBuf„ªd
Ë

	)

5811 #i‚de‡
T˛_Ch™√lName


5812 
	#T˛_Ch™√lName
 \

5813 (
t˛StubsPå
->
t˛_Ch™√lName
Ë

	)

5815 #i‚de‡
T˛_Ch™√lVîsi⁄


5816 
	#T˛_Ch™√lVîsi⁄
 \

5817 (
t˛StubsPå
->
t˛_Ch™√lVîsi⁄
Ë

	)

5819 #i‚de‡
T˛_Ch™√lBlockModeProc


5820 
	#T˛_Ch™√lBlockModeProc
 \

5821 (
t˛StubsPå
->
t˛_Ch™√lBlockModeProc
Ë

	)

5823 #i‚de‡
T˛_Ch™√lClo£Proc


5824 
	#T˛_Ch™√lClo£Proc
 \

5825 (
t˛StubsPå
->
t˛_Ch™√lClo£Proc
Ë

	)

5827 #i‚de‡
T˛_Ch™√lClo£2Proc


5828 
	#T˛_Ch™√lClo£2Proc
 \

5829 (
t˛StubsPå
->
t˛_Ch™√lClo£2Proc
Ë

	)

5831 #i‚de‡
T˛_Ch™√lI≈utProc


5832 
	#T˛_Ch™√lI≈utProc
 \

5833 (
t˛StubsPå
->
t˛_Ch™√lI≈utProc
Ë

	)

5835 #i‚de‡
T˛_Ch™√lOuçutProc


5836 
	#T˛_Ch™√lOuçutProc
 \

5837 (
t˛StubsPå
->
t˛_Ch™√lOuçutProc
Ë

	)

5839 #i‚de‡
T˛_Ch™√lSìkProc


5840 
	#T˛_Ch™√lSìkProc
 \

5841 (
t˛StubsPå
->
t˛_Ch™√lSìkProc
Ë

	)

5843 #i‚de‡
T˛_Ch™√lSëO±i⁄Proc


5844 
	#T˛_Ch™√lSëO±i⁄Proc
 \

5845 (
t˛StubsPå
->
t˛_Ch™√lSëO±i⁄Proc
Ë

	)

5847 #i‚de‡
T˛_Ch™√lGëO±i⁄Proc


5848 
	#T˛_Ch™√lGëO±i⁄Proc
 \

5849 (
t˛StubsPå
->
t˛_Ch™√lGëO±i⁄Proc
Ë

	)

5851 #i‚de‡
T˛_Ch™√lW©chProc


5852 
	#T˛_Ch™√lW©chProc
 \

5853 (
t˛StubsPå
->
t˛_Ch™√lW©chProc
Ë

	)

5855 #i‚de‡
T˛_Ch™√lGëH™dÀProc


5856 
	#T˛_Ch™√lGëH™dÀProc
 \

5857 (
t˛StubsPå
->
t˛_Ch™√lGëH™dÀProc
Ë

	)

5859 #i‚de‡
T˛_Ch™√lFlushProc


5860 
	#T˛_Ch™√lFlushProc
 \

5861 (
t˛StubsPå
->
t˛_Ch™√lFlushProc
Ë

	)

5863 #i‚de‡
T˛_Ch™√lH™dÀrProc


5864 
	#T˛_Ch™√lH™dÀrProc
 \

5865 (
t˛StubsPå
->
t˛_Ch™√lH™dÀrProc
Ë

	)

5867 #i‚de‡
T˛_JoöThªad


5868 
	#T˛_JoöThªad
 \

5869 (
t˛StubsPå
->
t˛_JoöThªad
Ë

	)

5871 #i‚de‡
T˛_IsCh™√lSh¨ed


5872 
	#T˛_IsCh™√lSh¨ed
 \

5873 (
t˛StubsPå
->
t˛_IsCh™√lSh¨ed
Ë

	)

5875 #i‚de‡
T˛_IsCh™√lRegi°îed


5876 
	#T˛_IsCh™√lRegi°îed
 \

5877 (
t˛StubsPå
->
t˛_IsCh™√lRegi°îed
Ë

	)

5879 #i‚de‡
T˛_CutCh™√l


5880 
	#T˛_CutCh™√l
 \

5881 (
t˛StubsPå
->
t˛_CutCh™√l
Ë

	)

5883 #i‚de‡
T˛_S∂i˚Ch™√l


5884 
	#T˛_S∂i˚Ch™√l
 \

5885 (
t˛StubsPå
->
t˛_S∂i˚Ch™√l
Ë

	)

5887 #i‚de‡
T˛_CÀ¨Ch™√lH™dÀrs


5888 
	#T˛_CÀ¨Ch™√lH™dÀrs
 \

5889 (
t˛StubsPå
->
t˛_CÀ¨Ch™√lH™dÀrs
Ë

	)

5891 #i‚de‡
T˛_IsCh™√lExi°ög


5892 
	#T˛_IsCh™√lExi°ög
 \

5893 (
t˛StubsPå
->
t˛_IsCh™√lExi°ög
Ë

	)

5895 #i‚de‡
T˛_UniCh¨Nˇ£cmp


5896 
	#T˛_UniCh¨Nˇ£cmp
 \

5897 (
t˛StubsPå
->
t˛_UniCh¨Nˇ£cmp
Ë

	)

5899 #i‚de‡
T˛_UniCh¨Ca£M©ch


5900 
	#T˛_UniCh¨Ca£M©ch
 \

5901 (
t˛StubsPå
->
t˛_UniCh¨Ca£M©ch
Ë

	)

5903 #i‚de‡
T˛_FödHashE¡ry


5904 
	#T˛_FödHashE¡ry
 \

5905 (
t˛StubsPå
->
t˛_FödHashE¡ry
Ë

	)

5907 #i‚de‡
T˛_Cª©eHashE¡ry


5908 
	#T˛_Cª©eHashE¡ry
 \

5909 (
t˛StubsPå
->
t˛_Cª©eHashE¡ry
Ë

	)

5911 #i‚de‡
T˛_InôCu°omHashTabÀ


5912 
	#T˛_InôCu°omHashTabÀ
 \

5913 (
t˛StubsPå
->
t˛_InôCu°omHashTabÀ
Ë

	)

5915 #i‚de‡
T˛_InôObjHashTabÀ


5916 
	#T˛_InôObjHashTabÀ
 \

5917 (
t˛StubsPå
->
t˛_InôObjHashTabÀ
Ë

	)

5919 #i‚de‡
T˛_Comm™dTø˚Info


5920 
	#T˛_Comm™dTø˚Info
 \

5921 (
t˛StubsPå
->
t˛_Comm™dTø˚Info
Ë

	)

5923 #i‚de‡
T˛_Tø˚Comm™d


5924 
	#T˛_Tø˚Comm™d
 \

5925 (
t˛StubsPå
->
t˛_Tø˚Comm™d
Ë

	)

5927 #i‚de‡
T˛_U¡ø˚Comm™d


5928 
	#T˛_U¡ø˚Comm™d
 \

5929 (
t˛StubsPå
->
t˛_U¡ø˚Comm™d
Ë

	)

5931 #i‚de‡
T˛_Aâem±AŒoc


5932 
	#T˛_Aâem±AŒoc
 \

5933 (
t˛StubsPå
->
t˛_Aâem±AŒoc
Ë

	)

5935 #i‚de‡
T˛_Aâem±DbCkÆloc


5936 
	#T˛_Aâem±DbCkÆloc
 \

5937 (
t˛StubsPå
->
t˛_Aâem±DbCkÆloc
Ë

	)

5939 #i‚de‡
T˛_Aâem±RóŒoc


5940 
	#T˛_Aâem±RóŒoc
 \

5941 (
t˛StubsPå
->
t˛_Aâem±RóŒoc
Ë

	)

5943 #i‚de‡
T˛_Aâem±DbCkªÆloc


5944 
	#T˛_Aâem±DbCkªÆloc
 \

5945 (
t˛StubsPå
->
t˛_Aâem±DbCkªÆloc
Ë

	)

5947 #i‚de‡
T˛_Aâem±SëObjLígth


5948 
	#T˛_Aâem±SëObjLígth
 \

5949 (
t˛StubsPå
->
t˛_Aâem±SëObjLígth
Ë

	)

5951 #i‚de‡
T˛_GëCh™√lThªad


5952 
	#T˛_GëCh™√lThªad
 \

5953 (
t˛StubsPå
->
t˛_GëCh™√lThªad
Ë

	)

5955 #i‚de‡
T˛_GëUnicodeFromObj


5956 
	#T˛_GëUnicodeFromObj
 \

5957 (
t˛StubsPå
->
t˛_GëUnicodeFromObj
Ë

	)

5959 #i‚de‡
T˛_GëM©hFuncInfo


5960 
	#T˛_GëM©hFuncInfo
 \

5961 (
t˛StubsPå
->
t˛_GëM©hFuncInfo
Ë

	)

5963 #i‚de‡
T˛_Li°M©hFuncs


5964 
	#T˛_Li°M©hFuncs
 \

5965 (
t˛StubsPå
->
t˛_Li°M©hFuncs
Ë

	)

5967 #i‚de‡
T˛_Sub°Obj


5968 
	#T˛_Sub°Obj
 \

5969 (
t˛StubsPå
->
t˛_Sub°Obj
Ë

	)

5971 #i‚de‡
T˛_DëachCh™√l


5972 
	#T˛_DëachCh™√l
 \

5973 (
t˛StubsPå
->
t˛_DëachCh™√l
Ë

	)

5975 #i‚de‡
T˛_IsSènd¨dCh™√l


5976 
	#T˛_IsSènd¨dCh™√l
 \

5977 (
t˛StubsPå
->
t˛_IsSènd¨dCh™√l
Ë

	)

5979 #i‚de‡
T˛_FSC›yFûe


5980 
	#T˛_FSC›yFûe
 \

5981 (
t˛StubsPå
->
t˛_FSC›yFûe
Ë

	)

5983 #i‚de‡
T˛_FSC›yDúe˘‹y


5984 
	#T˛_FSC›yDúe˘‹y
 \

5985 (
t˛StubsPå
->
t˛_FSC›yDúe˘‹y
Ë

	)

5987 #i‚de‡
T˛_FSCª©eDúe˘‹y


5988 
	#T˛_FSCª©eDúe˘‹y
 \

5989 (
t˛StubsPå
->
t˛_FSCª©eDúe˘‹y
Ë

	)

5991 #i‚de‡
T˛_FSDñëeFûe


5992 
	#T˛_FSDñëeFûe
 \

5993 (
t˛StubsPå
->
t˛_FSDñëeFûe
Ë

	)

5995 #i‚de‡
T˛_FSLﬂdFûe


5996 
	#T˛_FSLﬂdFûe
 \

5997 (
t˛StubsPå
->
t˛_FSLﬂdFûe
Ë

	)

5999 #i‚de‡
T˛_FSM©chInDúe˘‹y


6000 
	#T˛_FSM©chInDúe˘‹y
 \

6001 (
t˛StubsPå
->
t˛_FSM©chInDúe˘‹y
Ë

	)

6003 #i‚de‡
T˛_FSLök


6004 
	#T˛_FSLök
 \

6005 (
t˛StubsPå
->
t˛_FSLök
Ë

	)

6007 #i‚de‡
T˛_FSRemoveDúe˘‹y


6008 
	#T˛_FSRemoveDúe˘‹y
 \

6009 (
t˛StubsPå
->
t˛_FSRemoveDúe˘‹y
Ë

	)

6011 #i‚de‡
T˛_FSRíameFûe


6012 
	#T˛_FSRíameFûe
 \

6013 (
t˛StubsPå
->
t˛_FSRíameFûe
Ë

	)

6015 #i‚de‡
T˛_FSL°©


6016 
	#T˛_FSL°©
 \

6017 (
t˛StubsPå
->
t˛_FSL°©
Ë

	)

6019 #i‚de‡
T˛_FSUtime


6020 
	#T˛_FSUtime
 \

6021 (
t˛StubsPå
->
t˛_FSUtime
Ë

	)

6023 #i‚de‡
T˛_FSFûeAârsGë


6024 
	#T˛_FSFûeAârsGë
 \

6025 (
t˛StubsPå
->
t˛_FSFûeAârsGë
Ë

	)

6027 #i‚de‡
T˛_FSFûeAârsSë


6028 
	#T˛_FSFûeAârsSë
 \

6029 (
t˛StubsPå
->
t˛_FSFûeAârsSë
Ë

	)

6031 #i‚de‡
T˛_FSFûeAârSåögs


6032 
	#T˛_FSFûeAârSåögs
 \

6033 (
t˛StubsPå
->
t˛_FSFûeAârSåögs
Ë

	)

6035 #i‚de‡
T˛_FSSèt


6036 
	#T˛_FSSèt
 \

6037 (
t˛StubsPå
->
t˛_FSSèt
Ë

	)

6039 #i‚de‡
T˛_FSAc˚ss


6040 
	#T˛_FSAc˚ss
 \

6041 (
t˛StubsPå
->
t˛_FSAc˚ss
Ë

	)

6043 #i‚de‡
T˛_FSO≥nFûeCh™√l


6044 
	#T˛_FSO≥nFûeCh™√l
 \

6045 (
t˛StubsPå
->
t˛_FSO≥nFûeCh™√l
Ë

	)

6047 #i‚de‡
T˛_FSGëCwd


6048 
	#T˛_FSGëCwd
 \

6049 (
t˛StubsPå
->
t˛_FSGëCwd
Ë

	)

6051 #i‚de‡
T˛_FSChdú


6052 
	#T˛_FSChdú
 \

6053 (
t˛StubsPå
->
t˛_FSChdú
Ë

	)

6055 #i‚de‡
T˛_FSC⁄vîtToP©hTy≥


6056 
	#T˛_FSC⁄vîtToP©hTy≥
 \

6057 (
t˛StubsPå
->
t˛_FSC⁄vîtToP©hTy≥
Ë

	)

6059 #i‚de‡
T˛_FSJoöP©h


6060 
	#T˛_FSJoöP©h
 \

6061 (
t˛StubsPå
->
t˛_FSJoöP©h
Ë

	)

6063 #i‚de‡
T˛_FSS∂ôP©h


6064 
	#T˛_FSS∂ôP©h
 \

6065 (
t˛StubsPå
->
t˛_FSS∂ôP©h
Ë

	)

6067 #i‚de‡
T˛_FSEquÆP©hs


6068 
	#T˛_FSEquÆP©hs
 \

6069 (
t˛StubsPå
->
t˛_FSEquÆP©hs
Ë

	)

6071 #i‚de‡
T˛_FSGëN‹mÆizedP©h


6072 
	#T˛_FSGëN‹mÆizedP©h
 \

6073 (
t˛StubsPå
->
t˛_FSGëN‹mÆizedP©h
Ë

	)

6075 #i‚de‡
T˛_FSJoöToP©h


6076 
	#T˛_FSJoöToP©h
 \

6077 (
t˛StubsPå
->
t˛_FSJoöToP©h
Ë

	)

6079 #i‚de‡
T˛_FSGëI¡î«lRï


6080 
	#T˛_FSGëI¡î«lRï
 \

6081 (
t˛StubsPå
->
t˛_FSGëI¡î«lRï
Ë

	)

6083 #i‚de‡
T˛_FSGëTøn¶©edP©h


6084 
	#T˛_FSGëTøn¶©edP©h
 \

6085 (
t˛StubsPå
->
t˛_FSGëTøn¶©edP©h
Ë

	)

6087 #i‚de‡
T˛_FSEvÆFûe


6088 
	#T˛_FSEvÆFûe
 \

6089 (
t˛StubsPå
->
t˛_FSEvÆFûe
Ë

	)

6091 #i‚de‡
T˛_FSNewN©iveP©h


6092 
	#T˛_FSNewN©iveP©h
 \

6093 (
t˛StubsPå
->
t˛_FSNewN©iveP©h
Ë

	)

6095 #i‚de‡
T˛_FSGëN©iveP©h


6096 
	#T˛_FSGëN©iveP©h
 \

6097 (
t˛StubsPå
->
t˛_FSGëN©iveP©h
Ë

	)

6099 #i‚de‡
T˛_FSFûeSy°emInfo


6100 
	#T˛_FSFûeSy°emInfo
 \

6101 (
t˛StubsPå
->
t˛_FSFûeSy°emInfo
Ë

	)

6103 #i‚de‡
T˛_FSP©hSï¨©‹


6104 
	#T˛_FSP©hSï¨©‹
 \

6105 (
t˛StubsPå
->
t˛_FSP©hSï¨©‹
Ë

	)

6107 #i‚de‡
T˛_FSLi°Vﬁumes


6108 
	#T˛_FSLi°Vﬁumes
 \

6109 (
t˛StubsPå
->
t˛_FSLi°Vﬁumes
Ë

	)

6111 #i‚de‡
T˛_FSRegi°î


6112 
	#T˛_FSRegi°î
 \

6113 (
t˛StubsPå
->
t˛_FSRegi°î
Ë

	)

6115 #i‚de‡
T˛_FSUƒegi°î


6116 
	#T˛_FSUƒegi°î
 \

6117 (
t˛StubsPå
->
t˛_FSUƒegi°î
Ë

	)

6119 #i‚de‡
T˛_FSD©a


6120 
	#T˛_FSD©a
 \

6121 (
t˛StubsPå
->
t˛_FSD©a
Ë

	)

6123 #i‚de‡
T˛_FSGëTøn¶©edSåögP©h


6124 
	#T˛_FSGëTøn¶©edSåögP©h
 \

6125 (
t˛StubsPå
->
t˛_FSGëTøn¶©edSåögP©h
Ë

	)

6127 #i‚de‡
T˛_FSGëFûeSy°emF‹P©h


6128 
	#T˛_FSGëFûeSy°emF‹P©h
 \

6129 (
t˛StubsPå
->
t˛_FSGëFûeSy°emF‹P©h
Ë

	)

6131 #i‚de‡
T˛_FSGëP©hTy≥


6132 
	#T˛_FSGëP©hTy≥
 \

6133 (
t˛StubsPå
->
t˛_FSGëP©hTy≥
Ë

	)

6135 #i‚de‡
T˛_OuçutBuf„ªd


6136 
	#T˛_OuçutBuf„ªd
 \

6137 (
t˛StubsPå
->
t˛_OuçutBuf„ªd
Ë

	)

6139 #i‚de‡
T˛_FSMou¡sCh™ged


6140 
	#T˛_FSMou¡sCh™ged
 \

6141 (
t˛StubsPå
->
t˛_FSMou¡sCh™ged
Ë

	)

6143 #i‚de‡
T˛_EvÆTokísSènd¨d


6144 
	#T˛_EvÆTokísSènd¨d
 \

6145 (
t˛StubsPå
->
t˛_EvÆTokísSènd¨d
Ë

	)

6147 #i‚de‡
T˛_GëTime


6148 
	#T˛_GëTime
 \

6149 (
t˛StubsPå
->
t˛_GëTime
Ë

	)

6151 #i‚de‡
T˛_Cª©eObjTø˚


6152 
	#T˛_Cª©eObjTø˚
 \

6153 (
t˛StubsPå
->
t˛_Cª©eObjTø˚
Ë

	)

6155 #i‚de‡
T˛_GëComm™dInfoFromTokí


6156 
	#T˛_GëComm™dInfoFromTokí
 \

6157 (
t˛StubsPå
->
t˛_GëComm™dInfoFromTokí
Ë

	)

6159 #i‚de‡
T˛_SëComm™dInfoFromTokí


6160 
	#T˛_SëComm™dInfoFromTokí
 \

6161 (
t˛StubsPå
->
t˛_SëComm™dInfoFromTokí
Ë

	)

6163 #i‚de‡
T˛_DbNewWideI¡Obj


6164 
	#T˛_DbNewWideI¡Obj
 \

6165 (
t˛StubsPå
->
t˛_DbNewWideI¡Obj
Ë

	)

6167 #i‚de‡
T˛_GëWideI¡FromObj


6168 
	#T˛_GëWideI¡FromObj
 \

6169 (
t˛StubsPå
->
t˛_GëWideI¡FromObj
Ë

	)

6171 #i‚de‡
T˛_NewWideI¡Obj


6172 
	#T˛_NewWideI¡Obj
 \

6173 (
t˛StubsPå
->
t˛_NewWideI¡Obj
Ë

	)

6175 #i‚de‡
T˛_SëWideI¡Obj


6176 
	#T˛_SëWideI¡Obj
 \

6177 (
t˛StubsPå
->
t˛_SëWideI¡Obj
Ë

	)

6179 #i‚de‡
T˛_AŒocSètBuf


6180 
	#T˛_AŒocSètBuf
 \

6181 (
t˛StubsPå
->
t˛_AŒocSètBuf
Ë

	)

6183 #i‚de‡
T˛_Sìk


6184 
	#T˛_Sìk
 \

6185 (
t˛StubsPå
->
t˛_Sìk
Ë

	)

6187 #i‚de‡
T˛_Tñl


6188 
	#T˛_Tñl
 \

6189 (
t˛StubsPå
->
t˛_Tñl
Ë

	)

6191 #i‚de‡
T˛_Ch™√lWideSìkProc


6192 
	#T˛_Ch™√lWideSìkProc
 \

6193 (
t˛StubsPå
->
t˛_Ch™√lWideSìkProc
Ë

	)

6195 #i‚de‡
T˛_Di˘ObjPut


6196 
	#T˛_Di˘ObjPut
 \

6197 (
t˛StubsPå
->
t˛_Di˘ObjPut
Ë

	)

6199 #i‚de‡
T˛_Di˘ObjGë


6200 
	#T˛_Di˘ObjGë
 \

6201 (
t˛StubsPå
->
t˛_Di˘ObjGë
Ë

	)

6203 #i‚de‡
T˛_Di˘ObjRemove


6204 
	#T˛_Di˘ObjRemove
 \

6205 (
t˛StubsPå
->
t˛_Di˘ObjRemove
Ë

	)

6207 #i‚de‡
T˛_Di˘ObjSize


6208 
	#T˛_Di˘ObjSize
 \

6209 (
t˛StubsPå
->
t˛_Di˘ObjSize
Ë

	)

6211 #i‚de‡
T˛_Di˘ObjFú°


6212 
	#T˛_Di˘ObjFú°
 \

6213 (
t˛StubsPå
->
t˛_Di˘ObjFú°
Ë

	)

6215 #i‚de‡
T˛_Di˘ObjNext


6216 
	#T˛_Di˘ObjNext
 \

6217 (
t˛StubsPå
->
t˛_Di˘ObjNext
Ë

	)

6219 #i‚de‡
T˛_Di˘ObjD⁄e


6220 
	#T˛_Di˘ObjD⁄e
 \

6221 (
t˛StubsPå
->
t˛_Di˘ObjD⁄e
Ë

	)

6223 #i‚de‡
T˛_Di˘ObjPutKeyLi°


6224 
	#T˛_Di˘ObjPutKeyLi°
 \

6225 (
t˛StubsPå
->
t˛_Di˘ObjPutKeyLi°
Ë

	)

6227 #i‚de‡
T˛_Di˘ObjRemoveKeyLi°


6228 
	#T˛_Di˘ObjRemoveKeyLi°
 \

6229 (
t˛StubsPå
->
t˛_Di˘ObjRemoveKeyLi°
Ë

	)

6231 #i‚de‡
T˛_NewDi˘Obj


6232 
	#T˛_NewDi˘Obj
 \

6233 (
t˛StubsPå
->
t˛_NewDi˘Obj
Ë

	)

6235 #i‚de‡
T˛_DbNewDi˘Obj


6236 
	#T˛_DbNewDi˘Obj
 \

6237 (
t˛StubsPå
->
t˛_DbNewDi˘Obj
Ë

	)

6239 #i‚de‡
T˛_Regi°îC⁄fig


6240 
	#T˛_Regi°îC⁄fig
 \

6241 (
t˛StubsPå
->
t˛_Regi°îC⁄fig
Ë

	)

6243 #i‚de‡
T˛_Cª©eName•a˚


6244 
	#T˛_Cª©eName•a˚
 \

6245 (
t˛StubsPå
->
t˛_Cª©eName•a˚
Ë

	)

6247 #i‚de‡
T˛_DñëeName•a˚


6248 
	#T˛_DñëeName•a˚
 \

6249 (
t˛StubsPå
->
t˛_DñëeName•a˚
Ë

	)

6251 #i‚de‡
T˛_AµídExp‹tLi°


6252 
	#T˛_AµídExp‹tLi°
 \

6253 (
t˛StubsPå
->
t˛_AµídExp‹tLi°
Ë

	)

6255 #i‚de‡
T˛_Exp‹t


6256 
	#T˛_Exp‹t
 \

6257 (
t˛StubsPå
->
t˛_Exp‹t
Ë

	)

6259 #i‚de‡
T˛_Imp‹t


6260 
	#T˛_Imp‹t
 \

6261 (
t˛StubsPå
->
t˛_Imp‹t
Ë

	)

6263 #i‚de‡
T˛_F‹gëImp‹t


6264 
	#T˛_F‹gëImp‹t
 \

6265 (
t˛StubsPå
->
t˛_F‹gëImp‹t
Ë

	)

6267 #i‚de‡
T˛_GëCuºítName•a˚


6268 
	#T˛_GëCuºítName•a˚
 \

6269 (
t˛StubsPå
->
t˛_GëCuºítName•a˚
Ë

	)

6271 #i‚de‡
T˛_GëGlobÆName•a˚


6272 
	#T˛_GëGlobÆName•a˚
 \

6273 (
t˛StubsPå
->
t˛_GëGlobÆName•a˚
Ë

	)

6275 #i‚de‡
T˛_FödName•a˚


6276 
	#T˛_FödName•a˚
 \

6277 (
t˛StubsPå
->
t˛_FödName•a˚
Ë

	)

6279 #i‚de‡
T˛_FödComm™d


6280 
	#T˛_FödComm™d
 \

6281 (
t˛StubsPå
->
t˛_FödComm™d
Ë

	)

6283 #i‚de‡
T˛_GëComm™dFromObj


6284 
	#T˛_GëComm™dFromObj
 \

6285 (
t˛StubsPå
->
t˛_GëComm™dFromObj
Ë

	)

6287 #i‚de‡
T˛_GëComm™dFuŒName


6288 
	#T˛_GëComm™dFuŒName
 \

6289 (
t˛StubsPå
->
t˛_GëComm™dFuŒName
Ë

	)

6291 #i‚de‡
T˛_FSEvÆFûeEx


6292 
	#T˛_FSEvÆFûeEx
 \

6293 (
t˛StubsPå
->
t˛_FSEvÆFûeEx
Ë

	)

6295 #i‚de‡
T˛_SëExôProc


6296 
	#T˛_SëExôProc
 \

6297 (
t˛StubsPå
->
t˛_SëExôProc
Ë

	)

6299 #i‚de‡
T˛_LimôAddH™dÀr


6300 
	#T˛_LimôAddH™dÀr
 \

6301 (
t˛StubsPå
->
t˛_LimôAddH™dÀr
Ë

	)

6303 #i‚de‡
T˛_LimôRemoveH™dÀr


6304 
	#T˛_LimôRemoveH™dÀr
 \

6305 (
t˛StubsPå
->
t˛_LimôRemoveH™dÀr
Ë

	)

6307 #i‚de‡
T˛_LimôRódy


6308 
	#T˛_LimôRódy
 \

6309 (
t˛StubsPå
->
t˛_LimôRódy
Ë

	)

6311 #i‚de‡
T˛_LimôCheck


6312 
	#T˛_LimôCheck
 \

6313 (
t˛StubsPå
->
t˛_LimôCheck
Ë

	)

6315 #i‚de‡
T˛_LimôEx˚eded


6316 
	#T˛_LimôEx˚eded
 \

6317 (
t˛StubsPå
->
t˛_LimôEx˚eded
Ë

	)

6319 #i‚de‡
T˛_LimôSëComm™ds


6320 
	#T˛_LimôSëComm™ds
 \

6321 (
t˛StubsPå
->
t˛_LimôSëComm™ds
Ë

	)

6323 #i‚de‡
T˛_LimôSëTime


6324 
	#T˛_LimôSëTime
 \

6325 (
t˛StubsPå
->
t˛_LimôSëTime
Ë

	)

6327 #i‚de‡
T˛_LimôSëGønuœrôy


6328 
	#T˛_LimôSëGønuœrôy
 \

6329 (
t˛StubsPå
->
t˛_LimôSëGønuœrôy
Ë

	)

6331 #i‚de‡
T˛_LimôTy≥E«bÀd


6332 
	#T˛_LimôTy≥E«bÀd
 \

6333 (
t˛StubsPå
->
t˛_LimôTy≥E«bÀd
Ë

	)

6335 #i‚de‡
T˛_LimôTy≥Ex˚eded


6336 
	#T˛_LimôTy≥Ex˚eded
 \

6337 (
t˛StubsPå
->
t˛_LimôTy≥Ex˚eded
Ë

	)

6339 #i‚de‡
T˛_LimôTy≥Së


6340 
	#T˛_LimôTy≥Së
 \

6341 (
t˛StubsPå
->
t˛_LimôTy≥Së
Ë

	)

6343 #i‚de‡
T˛_LimôTy≥Re£t


6344 
	#T˛_LimôTy≥Re£t
 \

6345 (
t˛StubsPå
->
t˛_LimôTy≥Re£t
Ë

	)

6347 #i‚de‡
T˛_LimôGëComm™ds


6348 
	#T˛_LimôGëComm™ds
 \

6349 (
t˛StubsPå
->
t˛_LimôGëComm™ds
Ë

	)

6351 #i‚de‡
T˛_LimôGëTime


6352 
	#T˛_LimôGëTime
 \

6353 (
t˛StubsPå
->
t˛_LimôGëTime
Ë

	)

6355 #i‚de‡
T˛_LimôGëGønuœrôy


6356 
	#T˛_LimôGëGønuœrôy
 \

6357 (
t˛StubsPå
->
t˛_LimôGëGønuœrôy
Ë

	)

6359 #i‚de‡
T˛_SaveI¡îpSèã


6360 
	#T˛_SaveI¡îpSèã
 \

6361 (
t˛StubsPå
->
t˛_SaveI¡îpSèã
Ë

	)

6363 #i‚de‡
T˛_Re°‹eI¡îpSèã


6364 
	#T˛_Re°‹eI¡îpSèã
 \

6365 (
t˛StubsPå
->
t˛_Re°‹eI¡îpSèã
Ë

	)

6367 #i‚de‡
T˛_DisˇrdI¡îpSèã


6368 
	#T˛_DisˇrdI¡îpSèã
 \

6369 (
t˛StubsPå
->
t˛_DisˇrdI¡îpSèã
Ë

	)

6371 #i‚de‡
T˛_SëRëu∫O±i⁄s


6372 
	#T˛_SëRëu∫O±i⁄s
 \

6373 (
t˛StubsPå
->
t˛_SëRëu∫O±i⁄s
Ë

	)

6375 #i‚de‡
T˛_GëRëu∫O±i⁄s


6376 
	#T˛_GëRëu∫O±i⁄s
 \

6377 (
t˛StubsPå
->
t˛_GëRëu∫O±i⁄s
Ë

	)

6379 #i‚de‡
T˛_IsEn£mbÀ


6380 
	#T˛_IsEn£mbÀ
 \

6381 (
t˛StubsPå
->
t˛_IsEn£mbÀ
Ë

	)

6383 #i‚de‡
T˛_Cª©eEn£mbÀ


6384 
	#T˛_Cª©eEn£mbÀ
 \

6385 (
t˛StubsPå
->
t˛_Cª©eEn£mbÀ
Ë

	)

6387 #i‚de‡
T˛_FödEn£mbÀ


6388 
	#T˛_FödEn£mbÀ
 \

6389 (
t˛StubsPå
->
t˛_FödEn£mbÀ
Ë

	)

6391 #i‚de‡
T˛_SëEn£mbÀSubcomm™dLi°


6392 
	#T˛_SëEn£mbÀSubcomm™dLi°
 \

6393 (
t˛StubsPå
->
t˛_SëEn£mbÀSubcomm™dLi°
Ë

	)

6395 #i‚de‡
T˛_SëEn£mbÀM≠pögDi˘


6396 
	#T˛_SëEn£mbÀM≠pögDi˘
 \

6397 (
t˛StubsPå
->
t˛_SëEn£mbÀM≠pögDi˘
Ë

	)

6399 #i‚de‡
T˛_SëEn£mbÀUnknownH™dÀr


6400 
	#T˛_SëEn£mbÀUnknownH™dÀr
 \

6401 (
t˛StubsPå
->
t˛_SëEn£mbÀUnknownH™dÀr
Ë

	)

6403 #i‚de‡
T˛_SëEn£mbÀFœgs


6404 
	#T˛_SëEn£mbÀFœgs
 \

6405 (
t˛StubsPå
->
t˛_SëEn£mbÀFœgs
Ë

	)

6407 #i‚de‡
T˛_GëEn£mbÀSubcomm™dLi°


6408 
	#T˛_GëEn£mbÀSubcomm™dLi°
 \

6409 (
t˛StubsPå
->
t˛_GëEn£mbÀSubcomm™dLi°
Ë

	)

6411 #i‚de‡
T˛_GëEn£mbÀM≠pögDi˘


6412 
	#T˛_GëEn£mbÀM≠pögDi˘
 \

6413 (
t˛StubsPå
->
t˛_GëEn£mbÀM≠pögDi˘
Ë

	)

6415 #i‚de‡
T˛_GëEn£mbÀUnknownH™dÀr


6416 
	#T˛_GëEn£mbÀUnknownH™dÀr
 \

6417 (
t˛StubsPå
->
t˛_GëEn£mbÀUnknownH™dÀr
Ë

	)

6419 #i‚de‡
T˛_GëEn£mbÀFœgs


6420 
	#T˛_GëEn£mbÀFœgs
 \

6421 (
t˛StubsPå
->
t˛_GëEn£mbÀFœgs
Ë

	)

6423 #i‚de‡
T˛_GëEn£mbÀName•a˚


6424 
	#T˛_GëEn£mbÀName•a˚
 \

6425 (
t˛StubsPå
->
t˛_GëEn£mbÀName•a˚
Ë

	)

6427 #i‚de‡
T˛_SëTimeProc


6428 
	#T˛_SëTimeProc
 \

6429 (
t˛StubsPå
->
t˛_SëTimeProc
Ë

	)

6431 #i‚de‡
T˛_QuîyTimeProc


6432 
	#T˛_QuîyTimeProc
 \

6433 (
t˛StubsPå
->
t˛_QuîyTimeProc
Ë

	)

6435 #i‚de‡
T˛_Ch™√lThªadA˘i⁄Proc


6436 
	#T˛_Ch™√lThªadA˘i⁄Proc
 \

6437 (
t˛StubsPå
->
t˛_Ch™√lThªadA˘i⁄Proc
Ë

	)

6439 #i‚de‡
T˛_NewBignumObj


6440 
	#T˛_NewBignumObj
 \

6441 (
t˛StubsPå
->
t˛_NewBignumObj
Ë

	)

6443 #i‚de‡
T˛_DbNewBignumObj


6444 
	#T˛_DbNewBignumObj
 \

6445 (
t˛StubsPå
->
t˛_DbNewBignumObj
Ë

	)

6447 #i‚de‡
T˛_SëBignumObj


6448 
	#T˛_SëBignumObj
 \

6449 (
t˛StubsPå
->
t˛_SëBignumObj
Ë

	)

6451 #i‚de‡
T˛_GëBignumFromObj


6452 
	#T˛_GëBignumFromObj
 \

6453 (
t˛StubsPå
->
t˛_GëBignumFromObj
Ë

	)

6455 #i‚de‡
T˛_TakeBignumFromObj


6456 
	#T˛_TakeBignumFromObj
 \

6457 (
t˛StubsPå
->
t˛_TakeBignumFromObj
Ë

	)

6459 #i‚de‡
T˛_TrunˇãCh™√l


6460 
	#T˛_TrunˇãCh™√l
 \

6461 (
t˛StubsPå
->
t˛_TrunˇãCh™√l
Ë

	)

6463 #i‚de‡
T˛_Ch™√lTrunˇãProc


6464 
	#T˛_Ch™√lTrunˇãProc
 \

6465 (
t˛StubsPå
->
t˛_Ch™√lTrunˇãProc
Ë

	)

6467 #i‚de‡
T˛_SëCh™√lEº‹I¡îp


6468 
	#T˛_SëCh™√lEº‹I¡îp
 \

6469 (
t˛StubsPå
->
t˛_SëCh™√lEº‹I¡îp
Ë

	)

6471 #i‚de‡
T˛_GëCh™√lEº‹I¡îp


6472 
	#T˛_GëCh™√lEº‹I¡îp
 \

6473 (
t˛StubsPå
->
t˛_GëCh™√lEº‹I¡îp
Ë

	)

6475 #i‚de‡
T˛_SëCh™√lEº‹


6476 
	#T˛_SëCh™√lEº‹
 \

6477 (
t˛StubsPå
->
t˛_SëCh™√lEº‹
Ë

	)

6479 #i‚de‡
T˛_GëCh™√lEº‹


6480 
	#T˛_GëCh™√lEº‹
 \

6481 (
t˛StubsPå
->
t˛_GëCh™√lEº‹
Ë

	)

6483 #i‚de‡
T˛_InôBignumFromDoubÀ


6484 
	#T˛_InôBignumFromDoubÀ
 \

6485 (
t˛StubsPå
->
t˛_InôBignumFromDoubÀ
Ë

	)

6487 #i‚de‡
T˛_GëName•a˚UnknownH™dÀr


6488 
	#T˛_GëName•a˚UnknownH™dÀr
 \

6489 (
t˛StubsPå
->
t˛_GëName•a˚UnknownH™dÀr
Ë

	)

6491 #i‚de‡
T˛_SëName•a˚UnknownH™dÀr


6492 
	#T˛_SëName•a˚UnknownH™dÀr
 \

6493 (
t˛StubsPå
->
t˛_SëName•a˚UnknownH™dÀr
Ë

	)

6495 #i‚de‡
T˛_GëEncodögFromObj


6496 
	#T˛_GëEncodögFromObj
 \

6497 (
t˛StubsPå
->
t˛_GëEncodögFromObj
Ë

	)

6499 #i‚de‡
T˛_GëEncodögSórchP©h


6500 
	#T˛_GëEncodögSórchP©h
 \

6501 (
t˛StubsPå
->
t˛_GëEncodögSórchP©h
Ë

	)

6503 #i‚de‡
T˛_SëEncodögSórchP©h


6504 
	#T˛_SëEncodögSórchP©h
 \

6505 (
t˛StubsPå
->
t˛_SëEncodögSórchP©h
Ë

	)

6507 #i‚de‡
T˛_GëEncodögNameFromEnvú⁄mít


6508 
	#T˛_GëEncodögNameFromEnvú⁄mít
 \

6509 (
t˛StubsPå
->
t˛_GëEncodögNameFromEnvú⁄mít
Ë

	)

6511 #i‚de‡
T˛_PkgRequúeProc


6512 
	#T˛_PkgRequúeProc
 \

6513 (
t˛StubsPå
->
t˛_PkgRequúeProc
Ë

	)

6515 #i‚de‡
T˛_AµídObjToEº‹Info


6516 
	#T˛_AµídObjToEº‹Info
 \

6517 (
t˛StubsPå
->
t˛_AµídObjToEº‹Info
Ë

	)

6519 #i‚de‡
T˛_AµídLimôedToObj


6520 
	#T˛_AµídLimôedToObj
 \

6521 (
t˛StubsPå
->
t˛_AµídLimôedToObj
Ë

	)

6523 #i‚de‡
T˛_F‹m©


6524 
	#T˛_F‹m©
 \

6525 (
t˛StubsPå
->
t˛_F‹m©
Ë

	)

6527 #i‚de‡
T˛_AµídF‹m©ToObj


6528 
	#T˛_AµídF‹m©ToObj
 \

6529 (
t˛StubsPå
->
t˛_AµídF‹m©ToObj
Ë

	)

6531 #i‚de‡
T˛_ObjPrötf


6532 
	#T˛_ObjPrötf
 \

6533 (
t˛StubsPå
->
t˛_ObjPrötf
Ë

	)

6535 #i‚de‡
T˛_AµídPrötfToObj


6536 
	#T˛_AµídPrötfToObj
 \

6537 (
t˛StubsPå
->
t˛_AµídPrötfToObj
Ë

	)

6544 #unde‡
TCL_STORAGE_CLASS


6545 
	#TCL_STORAGE_CLASS
 
DLLIMPORT


	)

	@/usr/include/tclPlatDecls.h

12 #i‚de‡
_TCLPLATDECLS


13 
	#_TCLPLATDECLS


	)

15 #unde‡
TCL_STORAGE_CLASS


16 #ifde‡
BUILD_t˛


17 
	#TCL_STORAGE_CLASS
 
DLLEXPORT


	)

19 #ifde‡
USE_TCL_STUBS


20 
	#TCL_STORAGE_CLASS


	)

22 
	#TCL_STORAGE_CLASS
 
DLLIMPORT


	)

29 #i‡
deföed
(
__CYGWIN__
)

30 
	tTCHAR
;

31 #ñi‡
deföed
(
__WIN32__
Ë&& !deföed(
_TCHAR_DEFINED
)

32 
	~<tch¨.h
>

33 #i‚de‡
_TCHAR_DEFINED


35 
_TCHAR
 
	tTCHAR
;

36 
	#_TCHAR_DEFINED


	)

38 #i‡
deföed
(
_MSC_VER
Ë&& deföed(
__STDC__
)

40 
_TCHAR
 
	tTCHAR
;

50 #ifde‡
__WIN32__


51 #i‚de‡
T˛_WöUtfToTCh¨_TCL_DECLARED


52 
	#T˛_WöUtfToTCh¨_TCL_DECLARED


	)

54 
EXTERN
 
TCHAR
 * 
T˛_WöUtfToTCh¨
 (
CONST
 * 
°r
, 
Àn
,

55 
T˛_DSåög
 * 
dsPå
);

57 #i‚de‡
T˛_WöTCh¨ToUtf_TCL_DECLARED


58 
	#T˛_WöTCh¨ToUtf_TCL_DECLARED


	)

60 
EXTERN
 * 
T˛_WöTCh¨ToUtf
 (
CONST
 
TCHAR
 * 
°r
, 
Àn
,

61 
T˛_DSåög
 * 
dsPå
);

64 #ifde‡
MAC_OSX_TCL


65 #i‚de‡
T˛_MacOSXO≥nBundÀResour˚s_TCL_DECLARED


66 
	#T˛_MacOSXO≥nBundÀResour˚s_TCL_DECLARED


	)

68 
EXTERN
 
T˛_MacOSXO≥nBundÀResour˚s
 (
T˛_I¡îp
 * 
öãΩ
,

69 
CONST
 * 
bundÀName
, 
hasResour˚Fûe
,

70 
maxP©hLí
, * 
libøryP©h
);

72 #i‚de‡
T˛_MacOSXO≥nVîsi⁄edBundÀResour˚s_TCL_DECLARED


73 
	#T˛_MacOSXO≥nVîsi⁄edBundÀResour˚s_TCL_DECLARED


	)

75 
EXTERN
 
T˛_MacOSXO≥nVîsi⁄edBundÀResour˚s
 (

76 
T˛_I¡îp
 * 
öãΩ
, 
CONST
 * 
bundÀName
,

77 
CONST
 * 
bundÀVîsi⁄
,

78 
hasResour˚Fûe
, 
maxP©hLí
,

79 * 
libøryP©h
);

83 
	sT˛PœtStubs
 {

84 
	mmagic
;

85 
T˛PœtStubHooks
 *
	mhooks
;

87 #ifde‡
__WIN32__


88 
	mTCHAR
 * (*
	mt˛_WöUtfToTCh¨
Ë(
CONST
 * 
	m°r
, 
	mÀn
, 
T˛_DSåög
 * 
	mdsPå
);

89 * (*
	mt˛_WöTCh¨ToUtf
Ë(
CONST
 
TCHAR
 * 
	m°r
, 
	mÀn
, 
T˛_DSåög
 * 
	mdsPå
);

91 #ifde‡
MAC_OSX_TCL


92 (*
	mt˛_MacOSXO≥nBundÀResour˚s
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mbundÀName
, 
	mhasResour˚Fûe
, 
	mmaxP©hLí
, * 
	mlibøryP©h
);

93 (*
	mt˛_MacOSXO≥nVîsi⁄edBundÀResour˚s
Ë(
T˛_I¡îp
 * 
	möãΩ
, 
CONST
 * 
	mbundÀName
, CONST * 
	mbundÀVîsi⁄
, 
	mhasResour˚Fûe
, 
	mmaxP©hLí
, * 
	mlibøryP©h
);

95 } 
	tT˛PœtStubs
;

97 #ifde‡
__˝lu•lus


100 
T˛PœtStubs
 *
t˛PœtStubsPå
;

101 #ifde‡
__˝lu•lus


105 #i‡
deföed
(
USE_TCL_STUBS
Ë&& !deföed(
USE_TCL_STUB_PROCS
)

111 #ifde‡
__WIN32__


112 #i‚de‡
T˛_WöUtfToTCh¨


113 
	#T˛_WöUtfToTCh¨
 \

114 (
t˛PœtStubsPå
->
t˛_WöUtfToTCh¨
Ë

	)

116 #i‚de‡
T˛_WöTCh¨ToUtf


117 
	#T˛_WöTCh¨ToUtf
 \

118 (
t˛PœtStubsPå
->
t˛_WöTCh¨ToUtf
Ë

	)

121 #ifde‡
MAC_OSX_TCL


122 #i‚de‡
T˛_MacOSXO≥nBundÀResour˚s


123 
	#T˛_MacOSXO≥nBundÀResour˚s
 \

124 (
t˛PœtStubsPå
->
t˛_MacOSXO≥nBundÀResour˚s
Ë

	)

126 #i‚de‡
T˛_MacOSXO≥nVîsi⁄edBundÀResour˚s


127 
	#T˛_MacOSXO≥nVîsi⁄edBundÀResour˚s
 \

128 (
t˛PœtStubsPå
->
t˛_MacOSXO≥nVîsi⁄edBundÀResour˚s
Ë

	)

136 #unde‡
TCL_STORAGE_CLASS


137 
	#TCL_STORAGE_CLASS
 
DLLIMPORT


	)

	@
1
.
1
/usr/include
231
4373
acpi.c
adb.c
adlib.c
apb_pci.c
apic.c
arm_boot.c
arm_gic.c
arm_pic.c
arm_pic.h
arm_sysctl.c
arm_timer.c
cdrom.c
cirrus_vga.c
cirrus_vga_rop.h
cirrus_vga_rop2.h
cs4231.c
cuda.c
dma.c
e100.c
es1370.c
esp.c
fdc.c
fmopl.c
fmopl.h
grackle_pci.c
gt64xxx.c
heathrow_pic.c
i8254.c
i8259.c
ide.c
integratorcp.c
iommu.c
isa_mmio.c
lsi53c895a.c
m48t59.c
m48t59.h
mc146818rtc.c
mips_int.c
mips_malta.c
mips_r4k.c
mips_timer.c
ne2000.c
openpic.c
parallel.c
pass-through.c
pass-through.h
pc.c
pci.c
pci_host.h
pckbd.c
pcnet.c
pcspk.c
pflash_cfi02.c
piix4acpi.c
piix_pci.c
pl011.c
pl050.c
pl080.c
pl110.c
pl110_template.h
pl190.c
ppc.c
ppc_chrp.c
ppc_prep.c
prep_pci.c
ps2.c
realview.c
rtl8139.c
sb16.c
scsi-disk.c
serial.c
sh7750.c
sh7750_regnames.c
sh7750_regnames.h
sh7750_regs.h
shix.c
slavio_intctl.c
slavio_misc.c
slavio_serial.c
slavio_timer.c
smbus.h
smbus_eeprom.c
smc91c111.c
sparc32_dma.c
sun4m.c
sun4u.c
tc58128.c
tcx.c
tpm_tis.c
unin_pci.c
usb-hid.c
usb-hub.c
usb-msd.c
usb-ohci.c
usb-uhci.c
usb.c
usb.h
versatile_pci.c
versatilepb.c
vga.c
vga_int.h
vga_template.h
xen_console.c
xen_console.h
xen_machine_fv.c
xen_machine_pv.c
xen_platform.c
xenfb.c
xenfb.h
/usr/include/assert.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/malloc.h
/usr/include/math.h
/usr/include/setjmp.h
/usr/include/signal.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/sys/ioctl.h
/usr/include/sys/mman.h
/usr/include/sys/select.h
/usr/include/sys/socket.h
/usr/include/sys/stat.h
/usr/include/sys/time.h
/usr/include/sys/types.h
/usr/include/sys/un.h
/usr/include/termios.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/zlib.h
/usr/include/alloca.h
/usr/include/bits/confname.h
/usr/include/bits/environments.h
/usr/include/bits/errno.h
/usr/include/bits/fcntl.h
/usr/include/bits/fcntl2.h
/usr/include/bits/huge_val.h
/usr/include/bits/huge_valf.h
/usr/include/bits/huge_vall.h
/usr/include/bits/inf.h
/usr/include/bits/ioctl-types.h
/usr/include/bits/ioctls.h
/usr/include/bits/mathcalls.h
/usr/include/bits/mathdef.h
/usr/include/bits/mathinline.h
/usr/include/bits/mman.h
/usr/include/bits/nan.h
/usr/include/bits/posix_opt.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/select.h
/usr/include/bits/setjmp.h
/usr/include/bits/sigaction.h
/usr/include/bits/sigcontext.h
/usr/include/bits/siginfo.h
/usr/include/bits/signum.h
/usr/include/bits/sigset.h
/usr/include/bits/sigstack.h
/usr/include/bits/sigthread.h
/usr/include/bits/sockaddr.h
/usr/include/bits/socket.h
/usr/include/bits/socket2.h
/usr/include/bits/stat.h
/usr/include/bits/stdio-ldbl.h
/usr/include/bits/stdio.h
/usr/include/bits/stdio2.h
/usr/include/bits/stdio_lim.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/string.h
/usr/include/bits/string2.h
/usr/include/bits/string3.h
/usr/include/bits/sys_errlist.h
/usr/include/bits/termios.h
/usr/include/bits/time.h
/usr/include/bits/types.h
/usr/include/bits/unistd.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/sys/cdefs.h
/usr/include/sys/sysmacros.h
/usr/include/sys/ttydefaults.h
/usr/include/sys/ucontext.h
/usr/include/sys/uio.h
/usr/include/xlocale.h
/usr/include/zconf.h
/usr/include/_G_config.h
/usr/include/asm/ioctls.h
/usr/include/asm/sigcontext.h
/usr/include/asm/socket.h
/usr/include/bits/endian.h
/usr/include/bits/libio-ldbl.h
/usr/include/bits/stdio-lock.h
/usr/include/bits/typesizes.h
/usr/include/bits/uio.h
/usr/include/bits/wordsize.h
/usr/include/ctype.h
/usr/include/gnu/stubs.h
/usr/include/limits.h
/usr/include/linux/errno.h
/usr/include/asm/errno.h
/usr/include/asm/ioctl.h
/usr/include/asm/sockios.h
/usr/include/asm/types.h
/usr/include/bits/libc-lock.h
/usr/include/bits/posix1_lim.h
/usr/include/bits/posix2_lim.h
/usr/include/bits/xopen_lim.h
/usr/include/gconv.h
/usr/include/gnu/stubs-32.h
/usr/include/wchar.h
/usr/include/asm-generic/errno.h
/usr/include/asm-generic/ioctl.h
/usr/include/bits/local_lim.h
/usr/include/bits/wchar-ldbl.h
/usr/include/bits/wchar.h
/usr/include/bits/wchar2.h
/usr/include/pthread.h
/usr/include/tls.h
/usr/include/wctype.h
/usr/include/asm-generic/errno-base.h
/usr/include/linux/limits.h
/usr/include/sched.h
/usr/include/tcl.h
/usr/include/bits/sched.h
/usr/include/tclDecls.h
/usr/include/tclPlatDecls.h
